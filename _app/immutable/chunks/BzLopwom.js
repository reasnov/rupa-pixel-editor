const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DJqvaw-w.js","./B78w-WDr.js","./wyFoAZCh.js","./12FXUTh6.js"])))=>i.map(i=>d[i]);
import{a as S,f as P,t as ot,c as Xe,d as jt}from"./95UOdi75.js";import{i as Ye}from"./sLWPApZc.js";import{o as sa}from"./B-fWDP72.js";import{aL as vr,C as tr,h as vt,L as ar,a as ya,aM as rr,N as _a,G as pr,l as i,P as hr,Q as fr,R as Va,S as Aa,e as va,ab as xr,aF as gr,an as Ua,c as aa,aN as Rt,b as La,aO as br,s as mr,a6 as da,aP as yr,aD as Ra,aQ as _r,aR as Ar,aI as ba,aa as Ta,aS as wr,r as sr,p as ir,aT as wa,W as Da,aU as kr,aV as Er,aC as Sr,d as Lr,az as Tr,I as Cr,E as Ir,aW as Pr,K as Mr,U as fa,i as Dt,aX as Or,aY as Rr,aZ as na,av as or,a_ as Dr,a$ as jr,b0 as Fr,b1 as $r,b2 as Br,b3 as Gr,b4 as Nr,b5 as Vr,aJ as Ur,V as Hr,b6 as zr,F as k,D as T,$ as He,g as pt,aK as q,z as G,v as d,B as h,w as c,x as oe,A as ne,ao as bt,y as Ie,b7 as at,b8 as Ca,b9 as Yr}from"./wyFoAZCh.js";import{_ as Ha,i as z,p as Ge,b as Yt}from"./B78w-WDr.js";import{_ as A,s as Kr}from"./5LaUY2kz.js";import{a as qr,s as E,d as je,e as Ze}from"./RFUEos6G.js";import{B as Qr}from"./12FXUTh6.js";const Xr=Symbol("NaN");function Wr(f,e,t){vt&&ar();var r=new Qr(f),s=!vr();tr(()=>{var o=e();o!==o&&(o=Xr),s&&o!==null&&typeof o=="object"&&(o={}),r.ensure(o,t)})}function Ue(f,e){return e}function Zr(f,e,t){for(var r=[],s=e.length,o,l=e.length,n=0;n<s;n++){let x=e[n];ir(x,()=>{if(o){if(o.pending.delete(x),o.done.add(x),o.pending.size===0){var b=f.outrogroups;Ia(Ra(o.done)),b.delete(o),b.size===0&&(f.outrogroups=null)}}else l-=1},!1)}if(l===0){var u=r.length===0&&t!==null;if(u){var v=t,p=v.parentNode;Sr(p),p.append(v),f.items.clear()}Ia(e,!u)}else o={pending:new Set(e),done:new Set},(f.outrogroups??=new Set).add(o)}function Ia(f,e=!0){for(var t=0;t<f.length;t++)Lr(f[t],e)}var za;function De(f,e,t,r,s,o=null){var l=f,n=new Map,u=(e&rr)!==0;if(u){var v=f;l=vt?_a(pr(v)):v.appendChild(ya())}vt&&ar();var p=null,x=da(()=>{var w=t();return yr(w)?w:w==null?[]:Ra(w)}),b,g=!0;function m(){y.fallback=p,Jr(y,b,l,e,r),p!==null&&(b.length===0?(p.f&Rt)===0?sr(p):(p.f^=Rt,ca(p,null,l)):ir(p,()=>{p=null}))}var _=tr(()=>{b=i(x);var w=b.length;let C=!1;if(vt){var R=hr(l)===fr;R!==(w===0)&&(l=Va(),_a(l),Aa(!1),C=!0)}for(var F=new Set,B=aa,U=mr(),M=0;M<w;M+=1){vt&&va.nodeType===xr&&va.data===gr&&(l=va,C=!0,Aa(!1));var j=b[M],$=r(j,M),V=g?null:n.get($);V?(V.v&&Ua(V.v,j),V.i&&Ua(V.i,M),U&&B.unskip_effect(V.e)):(V=es(n,g?l:za??=ya(),j,$,M,s,e,t),g||(V.e.f|=Rt),n.set($,V)),F.add($)}if(w===0&&o&&!p&&(g?p=La(()=>o(l)):(p=La(()=>o(za??=ya())),p.f|=Rt)),w>F.size&&br(),vt&&w>0&&_a(Va()),!g)if(U){for(const[K,Y]of n)F.has(K)||B.skip_effect(Y.e);B.oncommit(m),B.ondiscard(()=>{})}else m();C&&Aa(!0),i(x)}),y={effect:_,items:n,outrogroups:null,fallback:p};g=!1,vt&&(l=va)}function la(f){for(;f!==null&&(f.f&kr)===0;)f=f.next;return f}function Jr(f,e,t,r,s){var o=(r&Er)!==0,l=e.length,n=f.items,u=la(f.effect.first),v,p=null,x,b=[],g=[],m,_,y,w;if(o)for(w=0;w<l;w+=1)m=e[w],_=s(m,w),y=n.get(_).e,(y.f&Rt)===0&&(y.nodes?.a?.measure(),(x??=new Set).add(y));for(w=0;w<l;w+=1){if(m=e[w],_=s(m,w),y=n.get(_).e,f.outrogroups!==null)for(const V of f.outrogroups)V.pending.delete(y),V.done.delete(y);if((y.f&Rt)!==0)if(y.f^=Rt,y===u)ca(y,null,t);else{var C=p?p.next:u;y===f.effect.last&&(f.effect.last=y.prev),y.prev&&(y.prev.next=y.next),y.next&&(y.next.prev=y.prev),Ht(f,p,y),Ht(f,y,C),ca(y,C,t),p=y,b=[],g=[],u=la(p.next);continue}if((y.f&wa)!==0&&(sr(y),o&&(y.nodes?.a?.unfix(),(x??=new Set).delete(y))),y!==u){if(v!==void 0&&v.has(y)){if(b.length<g.length){var R=g[0],F;p=R.prev;var B=b[0],U=b[b.length-1];for(F=0;F<b.length;F+=1)ca(b[F],R,t);for(F=0;F<g.length;F+=1)v.delete(g[F]);Ht(f,B.prev,U.next),Ht(f,p,B),Ht(f,U,R),u=R,p=U,w-=1,b=[],g=[]}else v.delete(y),ca(y,u,t),Ht(f,y.prev,y.next),Ht(f,y,p===null?f.effect.first:p.next),Ht(f,p,y),p=y;continue}for(b=[],g=[];u!==null&&u!==y;)(v??=new Set).add(u),g.push(u),u=la(u.next);if(u===null)continue}(y.f&Rt)===0&&b.push(y),p=y,u=la(y.next)}if(f.outrogroups!==null){for(const V of f.outrogroups)V.pending.size===0&&(Ia(Ra(V.done)),f.outrogroups?.delete(V));f.outrogroups.size===0&&(f.outrogroups=null)}if(u!==null||v!==void 0){var M=[];if(v!==void 0)for(y of v)(y.f&wa)===0&&M.push(y);for(;u!==null;)(u.f&wa)===0&&u!==f.fallback&&M.push(u),u=la(u.next);var j=M.length;if(j>0){var $=(r&rr)!==0&&l===0?t:null;if(o){for(w=0;w<j;w+=1)M[w].nodes?.a?.measure();for(w=0;w<j;w+=1)M[w].nodes?.a?.fix()}Zr(f,M,$)}}o&&Da(()=>{if(x!==void 0)for(y of x)y.nodes?.a?.apply()})}function es(f,e,t,r,s,o,l,n){var u=(l&_r)!==0?(l&Ar)===0?ba(t,!1,!1):Ta(t):null,v=(l&wr)!==0?Ta(s):null;return{v:u,i:v,e:La(()=>(o(e,u??t,v??s,n),()=>{f.delete(r)}))}}function ca(f,e,t){if(f.nodes)for(var r=f.nodes.start,s=f.nodes.end,o=e&&(e.f&Rt)===0?e.nodes.start:t;r!==null;){var l=Tr(r);if(o.before(r),r===s)return;r=l}}function Ht(f,e,t){e===null?f.effect.first=t:e.next=t,t===null?f.effect.last=e:t.prev=e}const ts=()=>performance.now(),Ot={tick:f=>requestAnimationFrame(f),now:()=>ts(),tasks:new Set};function nr(){const f=Ot.now();Ot.tasks.forEach(e=>{e.c(f)||(Ot.tasks.delete(e),e.f())}),Ot.tasks.size!==0&&Ot.tick(nr)}function as(f){let e;return Ot.tasks.size===0&&Ot.tick(nr),{promise:new Promise(t=>{Ot.tasks.add(e={c:f,f:t})}),abort(){Ot.tasks.delete(e)}}}function xa(f,e){or(()=>{f.dispatchEvent(new CustomEvent(e))})}function rs(f){if(f==="float")return"cssFloat";if(f==="offset")return"cssOffset";if(f.startsWith("--"))return f;const e=f.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Ya(f){const e={},t=f.split(";");for(const r of t){const[s,o]=r.split(":");if(!s||o===void 0)break;const l=rs(s.trim());e[l]=o.trim()}return e}const ss=f=>f;function de(f,e,t,r){var s=(f&Dr)!==0,o=(f&jr)!==0,l=s&&o,n=(f&Or)!==0,u=l?"both":s?"in":"out",v,p=e.inert,x=e.style.overflow,b,g;function m(){return or(()=>v??=t()(e,r?.()??{},{direction:u}))}var _={is_global:n,in(){if(e.inert=p,!s){g?.abort(),g?.reset?.();return}o||b?.abort(),b=Pa(e,m(),g,1,()=>{xa(e,"introend"),b?.abort(),b=v=void 0,e.style.overflow=x})},out(R){if(!o){R?.(),v=void 0;return}e.inert=!0,g=Pa(e,m(),b,0,()=>{xa(e,"outroend"),R?.()})},stop:()=>{b?.abort(),g?.abort()}},y=Cr;if((y.nodes.t??=[]).push(_),s&&qr){var w=n;if(!w){for(var C=y.parent;C&&(C.f&Ir)!==0;)for(;(C=C.parent)&&(C.f&Pr)===0;);w=!C||(C.f&Mr)!==0}w&&fa(()=>{Dt(()=>_.in())})}}function Pa(f,e,t,r,s){var o=r===1;if(Rr(e)){var l,n=!1;return Da(()=>{if(!n){var y=e({direction:o?"in":"out"});l=Pa(f,y,t,r,s)}}),{abort:()=>{n=!0,l?.abort()},deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:()=>l.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return xa(f,o?"introstart":"outrostart"),s(),{abort:na,deactivate:na,reset:na,t:()=>r};const{delay:u=0,css:v,tick:p,easing:x=ss}=e;var b=[];if(o&&t===void 0&&(p&&p(0,1),v)){var g=Ya(v(0,1));b.push(g,g)}var m=()=>1-r,_=f.animate(b,{duration:u,fill:"forwards"});return _.onfinish=()=>{_.cancel(),xa(f,o?"introstart":"outrostart");var y=t?.t()??1-r;t?.abort();var w=r-y,C=e.duration*Math.abs(w),R=[];if(C>0){var F=!1;if(v)for(var B=Math.ceil(C/16.666666666666668),U=0;U<=B;U+=1){var M=y+w*x(U/B),j=Ya(v(M,1-M));R.push(j),F||=j.overflow==="hidden"}F&&(f.style.overflow="hidden"),m=()=>{var $=_.currentTime;return y+w*x($/C)},p&&as(()=>{if(_.playState!=="running")return!1;var $=m();return p($,1-$),!0})}_=f.animate(R,{duration:C,fill:"forwards"}),_.onfinish=()=>{m=()=>r,p?.(r,1-r),s()}},{abort:()=>{_&&(_.cancel(),_.effect=null,_.onfinish=na)},deactivate:()=>{s=na},reset:()=>{r===0&&p?.(1,0)},t:()=>m()}}function Ka(f,e,t){fa(()=>{var r=Dt(()=>e(f,t?.())||{});if(r?.destroy)return()=>r.destroy()})}function lr(f){var e,t,r="";if(typeof f=="string"||typeof f=="number")r+=f;else if(typeof f=="object")if(Array.isArray(f)){var s=f.length;for(e=0;e<s;e++)f[e]&&(t=lr(f[e]))&&(r&&(r+=" "),r+=t)}else for(t in f)f[t]&&(r&&(r+=" "),r+=t);return r}function is(){for(var f,e,t=0,r="",s=arguments.length;t<s;t++)(f=arguments[t])&&(e=lr(f))&&(r&&(r+=" "),r+=e);return r}function os(f){return typeof f=="object"?is(f):f??""}const qa=[...` 	
\r\f \v\uFEFF`];function ns(f,e,t){var r=f==null?"":""+f;if(e&&(r=r?r+" "+e:e),t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,l=0;(l=r.indexOf(s,l))>=0;){var n=l+o;(l===0||qa.includes(r[l-1]))&&(n===r.length||qa.includes(r[n]))?r=(l===0?"":r.substring(0,l))+r.substring(n+1):l=n}}return r===""?null:r}function ls(f,e){return f==null?null:String(f)}function J(f,e,t,r,s,o){var l=f.__className;if(vt||l!==t||l===void 0){var n=ns(t,r,o);(!vt||n!==f.getAttribute("class"))&&(n==null?f.removeAttribute("class"):e?f.className=n:f.setAttribute("class",n)),f.__className=t}else if(o&&s!==o)for(var u in o){var v=!!o[u];(s==null||v!==!!s[u])&&f.classList.toggle(u,v)}return o}function be(f,e,t,r){var s=f.__style;if(vt||s!==e){var o=ls(e);(!vt||o!==f.getAttribute("style"))&&(o==null?f.removeAttribute("style"):f.style.cssText=o),f.__style=e}return r}const cs=Symbol("is custom element"),ds=Symbol("is html");function Me(f){if(vt){var e=!1,t=()=>{if(!e){if(e=!0,f.hasAttribute("value")){var r=f.value;D(f,"value",null),f.value=r}if(f.hasAttribute("checked")){var s=f.checked;D(f,"checked",null),f.checked=s}}};f.__on_r=t,Da(t),Nr()}}function us(f,e){var t=cr(f);t.value===(t.value=e??void 0)||f.value===e&&(e!==0||f.nodeName!=="PROGRESS")||(f.value=e??"")}function D(f,e,t,r){var s=cr(f);vt&&(s[e]=f.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&f.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(f[Fr]=t),t==null?f.removeAttribute(e):typeof t!="string"&&vs(f).includes(e)?f[e]=t:f.setAttribute(e,t))}function cr(f){return f.__attributes??={[cs]:f.nodeName.includes("-"),[ds]:f.namespaceURI===$r}}var Qa=new Map;function vs(f){var e=f.getAttribute("is")||f.nodeName,t=Qa.get(e);if(t)return t;Qa.set(e,t=[]);for(var r,s=f,o=Element.prototype;o!==s;){r=Gr(s);for(var l in r)r[l].set&&t.push(l);s=Br(s)}return t}function Oe(f,e,t=e){var r=new WeakSet;Vr(f,"input",async s=>{var o=s?f.defaultValue:f.value;if(o=ka(f)?Ea(o):o,t(o),aa!==null&&r.add(aa),await Ur(),o!==(o=e())){var l=f.selectionStart,n=f.selectionEnd,u=f.value.length;if(f.value=o??"",n!==null){var v=f.value.length;l===n&&n===u&&v>u?(f.selectionStart=v,f.selectionEnd=v):(f.selectionStart=l,f.selectionEnd=Math.min(n,v))}}}),(vt&&f.defaultValue!==f.value||Dt(e)==null&&f.value)&&(t(ka(f)?Ea(f.value):f.value),aa!==null&&r.add(aa)),Hr(()=>{var s=e();if(f===document.activeElement){var o=zr??aa;if(r.has(o))return}ka(f)&&s===Ea(f.value)||f.type==="date"&&!s&&!f.value||s!==f.value&&(f.value=s??"")})}function ka(f){var e=f.type;return e==="number"||e==="range"}function Ea(f){return f===""?null:+f}function ua(f){var e=Ta(0);return function(){return arguments.length===1?(k(e,i(e)+1),arguments[0]):(i(e),f())}}class ps{project;#e=T(0);get renderPulse(){return i(this.#e)}set renderPulse(e){k(this.#e,e,!0)}triggerPulse(){this.renderPulse++}#t=T(He([]));get pixelBuffer(){return i(this.#t)}set pixelBuffer(e){k(this.#t,e,!0)}#a=T(He([]));get strokePoints(){return i(this.#a)}set strokePoints(e){k(this.#a,e,!0)}internalBuffer=new Set;constructor(e){this.project=e}mount(){pt(()=>{this.compositePixels,this.project.activeFrameIndex,this.project.activeFrame.activeLayerIndex,this.triggerPulse()})}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get pixels(){return this.project.activeFrame.activeLayer.pixels}get compositePixels(){return this.project.activeFrame.compositePixels}set pixels(e){const t=this.project.activeFrame,r=t.activeLayerIndex,s=t.activeLayer;s.pixels=e,s.isLinked&&this.project.frames.forEach((o,l)=>{if(l!==this.project.activeFrameIndex){const n=o.layers[r];n&&(n.pixels=e)}})}clearBuffer(){this.internalBuffer.clear(),this.pixelBuffer=[],this.strokePoints=[]}addBatchToBuffer(e){const t=[...this.strokePoints];e.forEach(r=>{const s=Math.floor(r.x),o=Math.floor(r.y);this.isValidCoord(s,o)&&(this.internalBuffer.add(this.getIndex(s,o)),t.push({x:r.x,y:r.y}))}),this.strokePoints=t,this.pixelBuffer=Array.from(this.internalBuffer)}addToBuffer(e,t){this.addBatchToBuffer([{x:e,y:t}])}reset(e,t,r){this.width=e,this.height=t,this.pixels=r,this.triggerPulse()}clear(){this.project.activeFrame.activeLayer.clear(),this.triggerPulse()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.compositePixels[this.getIndex(e,t)]}setColor(e,t,r){this.pixels[this.getIndex(e,t)]=r}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}#r=q(()=>`calc((100cqi - 20px) * ${this.width} / (${this.width} + 2))`);get fitWidth(){return i(this.#r)}set fitWidth(e){k(this.#r,e)}#s=q(()=>`calc((100cqb - 20px) * ${this.height} / (${this.height} + 2))`);get fitHeight(){return i(this.#s)}set fitHeight(e){k(this.#s,e)}getFitDimension(e){const t=this.width,r=this.height;return e==="horizontal"?`min(${this.fitWidth}, calc(${this.fitHeight} * (${t} / ${r})))`:`min(${this.fitHeight}, calc(${this.fitWidth} * (${r} / ${t})))`}}class hs{#e=T(He({x:0,y:0}));get pos(){return i(this.#e)}set pos(e){k(this.#e,e,!0)}#t=T(!0);get isVisible(){return i(this.#t)}set isVisible(e){k(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}const fs=["#2d3319","#4b5d16","#859900","#a2ad59","#eee8d5","#fdf6e3","#93a1a1","#586e75","#073642","#002b36"],xs=["#002b36","#073642","#586e75","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#2aa198","#859900"],pa={default:["#333333","#999999","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"],botanical:fs,sunset:xs};class ue{static toHex(e){const{h:t,s:r,l:s,a:o}=e,l=t/360,n=r/100,u=s/100;let v,p,x;if(n===0)v=p=x=u;else{const _=u<.5?u*(1+n):u+n-u*n,y=2*u-_,w=C=>(C<0&&(C+=1),C>1&&(C-=1),C<1/6?y+(_-y)*6*C:C<1/2?_:C<2/3?y+(_-y)*(2/3-C)*6:y);v=w(l+1/3),p=w(l),x=w(l-1/3)}const b=_=>Math.round(_*255).toString(16).padStart(2,"0"),g=Math.round(o*255).toString(16).padStart(2,"0"),m=`#${b(v)}${b(p)}${b(x)}`;return g==="ff"?m:m+g}static toHSLA(e){let t=0,r=0,s=0,o=1;const l=e.replace("#","");l.length===3||l.length===4?(t=parseInt(l[0]+l[0],16),r=parseInt(l[1]+l[1],16),s=parseInt(l[2]+l[2],16),l.length===4&&(o=parseInt(l[3]+l[3],16)/255)):(l.length===6||l.length===8)&&(t=parseInt(l.substring(0,2),16),r=parseInt(l.substring(2,4),16),s=parseInt(l.substring(4,6),16),l.length===8&&(o=parseInt(l.substring(6,8),16)/255)),t/=255,r/=255,s/=255;const n=Math.max(t,r,s),u=Math.min(t,r,s);let v=0,p=0,x=(n+u)/2;if(n!==u){const b=n-u;switch(p=x>.5?b/(2-n-u):b/(n+u),n){case t:v=(r-s)/b+(r<s?6:0);break;case r:v=(s-t)/b+2;break;case s:v=(t-r)/b+4;break}v/=6}return{h:Math.round(v*360),s:Math.round(p*100),l:Math.round(x*100),a:parseFloat(o.toFixed(2))}}static adjustBrightness(e,t){const r=this.toHSLA(e);return r.l=Math.max(0,Math.min(100,r.l+t*100)),this.toHex(r)}static adjustSaturation(e,t){const r=this.toHSLA(e);return r.s=Math.max(0,Math.min(100,r.s+t*100)),this.toHex(r)}static adjustOpacity(e,t){const r=this.toHSLA(e);return r.a=Math.max(0,Math.min(1,t)),this.toHex(r)}static mix(e,t,r=.5){const s=this.hexToRgb(e),o=this.hexToRgb(t),l={r:Math.round(s.r*(1-r)+o.r*r),g:Math.round(s.g*(1-r)+o.g*r),b:Math.round(s.b*(1-r)+o.b*r),a:s.a*(1-r)+o.a*r};return this.rgbToHex(l.r,l.g,l.b,l.a)}static rgbaCache=new Map;static toRGBA(e){if(this.rgbaCache.has(e))return this.rgbaCache.get(e);const{r:t,g:r,b:s,a:o}=this.hexToRgb(e),l=new Uint8ClampedArray([t,r,s,Math.round(o*255)]);return this.rgbaCache.set(e,l),l}static hexToUint32(e){if(!e)return 0;const{r:t,g:r,b:s,a:o}=this.hexToRgb(e);return(Math.round(o*255)<<24|s<<16|r<<8|t)>>>0}static uint32ToHex(e){if(e===0)return null;const t=e&255,r=e>>8&255,s=e>>16&255,o=e>>24&255;return this.rgbToHex(t,r,s,o/255)}static hexToRgb(e){const t=e.replace("#","");let r=0,s=0,o=0,l=1;return(t.length===6||t.length===8)&&(r=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),o=parseInt(t.substring(4,6),16),t.length===8&&(l=parseInt(t.substring(6,8),16)/255)),{r,g:s,b:o,a:l}}static rgbToHex(e,t,r,s){const o=u=>Math.round(u).toString(16).padStart(2,"0"),l=Math.round(s*255).toString(16).padStart(2,"0"),n=`#${o(e)}${o(t)}${o(r)}`;return l==="ff"?n:n+l}static toGPL(e,t){let r=`GIMP Palette
Name: ${e}
Columns: 4
#
`;return t.forEach(s=>{const{r:o,g:l,b:n}=this.hexToRgb(s);r+=`${o.toString().padStart(3)} ${l.toString().padStart(3)} ${n.toString().padStart(3)} Untitled
`}),r}static parsePaletteText(e){const t=[],r=/#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}|[A-Fa-f0-9]{8})/g;let s;for(;(s=r.exec(e))!==null;)t.push(s[0]);return t.length>0||e.split(`
`).forEach(l=>{const n=l.trim();if(!n||n.startsWith("GIMP")||n.startsWith("Name:")||n.startsWith("#"))return;const u=n.split(/\s+/).filter(v=>v.length>0);if(u.length>=3){const v=parseInt(u[0],10),p=parseInt(u[1],10),x=parseInt(u[2],10);!isNaN(v)&&!isNaN(p)&&!isNaN(x)&&t.push(this.rgbToHex(v,p,x,1))}}),t}}class gs{#e=T(He(pa.default[0]));get activeColor(){return i(this.#e)}set activeColor(e){k(this.#e,e,!0)}#t=T(He(pa.default));get swatches(){return i(this.#t)}set swatches(e){k(this.#t,e,!0)}#a=T(He([]));get presets(){return i(this.#a)}set presets(e){k(this.#a,e,!0)}constructor(){this.restoreDefaultPresets()}restoreDefaultPresets(){const e=Object.entries(pa).map(([t,r])=>({id:`default-${t}`,name:t.charAt(0).toUpperCase()+t.slice(1),colors:r,isDefault:!0}));this.presets=e}select(e){e>=0&&e<this.swatches.length&&(this.activeColor=this.swatches[e])}setColor(e){this.activeColor=e}addSwatch(e){this.swatches.includes(e)||this.swatches.push(e),this.activeColor=e}removeSwatch(e){this.swatches.length<=1||(this.swatches.splice(e,1),this.swatches.includes(this.activeColor)||(this.activeColor=this.swatches[0]))}newPalette(){this.swatches=[this.activeColor]}importPalette(e){const t=ue.parsePaletteText(e);return t.length>0?(this.swatches=t,this.activeColor=t[0],!0):!1}savePreset(e){const t={id:crypto.randomUUID(),name:e,colors:[...this.swatches],isDefault:!1};return this.presets.push(t),t}applyPreset(e){const t=this.presets.find(r=>r.id===e);t&&(this.swatches=[...t.colors],this.activeColor=this.swatches[0])}deletePreset(e){const t=this.presets.find(r=>r.id===e);t&&!t.isDefault&&(this.presets=this.presets.filter(r=>r.id!==e))}loadPalette(e){this.swatches=pa[e],this.activeColor=this.swatches[0]}}const bs=["showColorPicker","showAudioSettings","showCommandPalette","showGuideMenu","showGuideBook","showExportMenu","showPaletteLibrary","showCanvasSettings","showPersistenceMenu","showUnderlayMenu","showGoTo","showPourBasin"],ms={managed:bs};class ys{#e=T(1);get zoomLevel(){return i(this.#e)}set zoomLevel(e){k(this.#e,e,!0)}#t=T(!1);get isMuted(){return i(this.#t)}set isMuted(e){k(this.#t,e,!0)}#a=T(!0);get isAmbientPlaying(){return i(this.#a)}set isAmbientPlaying(e){k(this.#a,e,!0)}#r=T(!1);get isAppReady(){return i(this.#r)}set isAppReady(e){k(this.#r,e,!0)}#s=T(!1);get isPicking(){return i(this.#s)}set isPicking(e){k(this.#s,e,!0)}#i=T(!1);get isTimelineMinimized(){return i(this.#i)}set isTimelineMinimized(e){k(this.#i,e,!0)}#o=T(!1);get isTimelineMaximized(){return i(this.#o)}set isTimelineMaximized(e){k(this.#o,e,!0)}#n=T(1);get brushSize(){return i(this.#n)}set brushSize(e){k(this.#n,e,!0)}#l=T(100);get brushHardness(){return i(this.#l)}set brushHardness(e){k(this.#l,e,!0)}#c=T(!1);get isDitherBlendActive(){return i(this.#c)}set isDitherBlendActive(e){k(this.#c,e,!0)}#d=T("SQUARE");get brushShape(){return i(this.#d)}set brushShape(e){k(this.#d,e,!0)}#u=T("OFF");get symmetryMode(){return i(this.#u)}set symmetryMode(e){k(this.#u,e,!0)}#v=T(!1);get isTilingEnabled(){return i(this.#v)}set isTilingEnabled(e){k(this.#v,e,!0)}#p=T(!1);get isAlphaLocked(){return i(this.#p)}set isAlphaLocked(e){k(this.#p,e,!0)}#h=T(!1);get isColorLocked(){return i(this.#h)}set isColorLocked(e){k(this.#h,e,!0)}#f=T(!1);get isPixelPerfect(){return i(this.#f)}set isPixelPerfect(e){k(this.#f,e,!0)}#x=T(null);get colorLockSource(){return i(this.#x)}set colorLockSource(e){k(this.#x,e,!0)}#g=T(!1);get isAirbrushActive(){return i(this.#g)}set isAirbrushActive(e){k(this.#g,e,!0)}#b=T(.2);get airbrushDensity(){return i(this.#b)}set airbrushDensity(e){k(this.#b,e,!0)}#m=T("BRUSH");get activeTool(){return i(this.#m)}set activeTool(e){k(this.#m,e,!0)}#y=T(null);get shapeAnchor(){return i(this.#y)}set shapeAnchor(e){k(this.#y,e,!0)}#_=T(3);get polygonSides(){return i(this.#_)}set polygonSides(e){k(this.#_,e,!0)}#A=T(0);get polygonIndentation(){return i(this.#A)}set polygonIndentation(e){k(this.#A,e,!0)}#w=T(50);get stabilization(){return i(this.#w)}set stabilization(e){k(this.#w,e,!0)}#k=T(.5);get bgmVolume(){return i(this.#k)}set bgmVolume(e){k(this.#k,e,!0)}#E=T(.5);get sfxVolume(){return i(this.#E)}set sfxVolume(e){k(this.#E,e,!0)}#S=T(!1);get isKineticMode(){return i(this.#S)}set isKineticMode(e){k(this.#S,e,!0)}#L=T(!1);get showGhostLayers(){return i(this.#L)}set showGhostLayers(e){k(this.#L,e,!0)}#T=T(1);get timelineZoom(){return i(this.#T)}set timelineZoom(e){k(this.#T,e,!0)}sessionStartTime=Date.now();#C=T(0);get usageMinutes(){return i(this.#C)}set usageMinutes(e){k(this.#C,e,!0)}#I=T(0);get usageSeconds(){return i(this.#I)}set usageSeconds(e){k(this.#I,e,!0)}#P=q(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),r=Math.floor(e%3600/60),s=e%60;return`${t>0?t+":":""}${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`});get sessionTimeLabel(){return i(this.#P)}set sessionTimeLabel(e){k(this.#P,e)}#M=T(!1);get showColorPicker(){return i(this.#M)}set showColorPicker(e){k(this.#M,e,!0)}#O=T(!1);get showAudioSettings(){return i(this.#O)}set showAudioSettings(e){k(this.#O,e,!0)}#R=T(!1);get showCommandPalette(){return i(this.#R)}set showCommandPalette(e){k(this.#R,e,!0)}#D=T(!1);get showGuideMenu(){return i(this.#D)}set showGuideMenu(e){k(this.#D,e,!0)}#j=T(!1);get showGuideBook(){return i(this.#j)}set showGuideBook(e){k(this.#j,e,!0)}#F=T(!1);get showExportMenu(){return i(this.#F)}set showExportMenu(e){k(this.#F,e,!0)}#$=T(!1);get showPaletteLibrary(){return i(this.#$)}set showPaletteLibrary(e){k(this.#$,e,!0)}#B=T(!1);get showCanvasSettings(){return i(this.#B)}set showCanvasSettings(e){k(this.#B,e,!0)}#G=T(!1);get showPersistenceMenu(){return i(this.#G)}set showPersistenceMenu(e){k(this.#G,e,!0)}#N=T(!1);get showUnderlayMenu(){return i(this.#N)}set showUnderlayMenu(e){k(this.#N,e,!0)}#V=T(!1);get showGoTo(){return i(this.#V)}set showGoTo(e){k(this.#V,e,!0)}#U=T(!1);get showPourBasin(){return i(this.#U)}set showPourBasin(e){k(this.#U,e,!0)}#H=T(!0);get showMinimap(){return i(this.#H)}set showMinimap(e){k(this.#H,e,!0)}#z=T(null);get underlayImage(){return i(this.#z)}set underlayImage(e){k(this.#z,e,!0)}#Y=T(!0);get isUnderlayVisible(){return i(this.#Y)}set isUnderlayVisible(e){k(this.#Y,e,!0)}#K=T(.2);get underlayOpacity(){return i(this.#K)}set underlayOpacity(e){k(this.#K,e,!0)}#q=T(He({x:0,y:0}));get underlayOffset(){return i(this.#q)}set underlayOffset(e){k(this.#q,e,!0)}#Q=T(1);get underlayScale(){return i(this.#Q)}set underlayScale(e){k(this.#Q,e,!0)}#X=T(He({x:0,y:0}));get panOffset(){return i(this.#X)}set panOffset(e){k(this.#X,e,!0)}#W=T(!1);get isHandToolActive(){return i(this.#W)}set isHandToolActive(e){k(this.#W,e,!0)}#Z=T(!1);get isTransforming(){return i(this.#Z)}set isTransforming(e){k(this.#Z,e,!0)}#J=T(!1);get isShadingLighten(){return i(this.#J)}set isShadingLighten(e){k(this.#J,e,!0)}#ee=T(!1);get isShadingDarken(){return i(this.#ee)}set isShadingDarken(e){k(this.#ee,e,!0)}#te=T(!1);get isShadingDither(){return i(this.#te)}set isShadingDither(e){k(this.#te,e,!0)}#ae=T(!1);get isPatternBrushActive(){return i(this.#ae)}set isPatternBrushActive(e){k(this.#ae,e,!0)}#re=T(null);get patternBrushData(){return i(this.#re)}set patternBrushData(e){k(this.#re,e,!0)}#se=T("layers");get projectActiveTab(){return i(this.#se)}set projectActiveTab(e){k(this.#se,e,!0)}#ie=T("");get toastMessage(){return i(this.#ie)}set toastMessage(e){k(this.#ie,e,!0)}#oe=T(!1);get showToast(){return i(this.#oe)}set showToast(e){k(this.#oe,e,!0)}toastTimer=null;#ne=T(null);get contextMenu(){return i(this.#ne)}set contextMenu(e){k(this.#ne,e,!0)}show(e){this.toastMessage=e,this.showToast=!0,this.toastTimer&&clearTimeout(this.toastTimer),this.toastTimer=setTimeout(()=>{this.showToast=!1},2e3)}#le=T("#eee8d5");get backgroundColor(){return i(this.#le)}set backgroundColor(e){k(this.#le,e,!0)}#ce=T(10);get exportScale(){return i(this.#ce)}set exportScale(e){k(this.#ce,e,!0)}#de=T("transparent");get exportBgColor(){return i(this.#de)}set exportBgColor(e){k(this.#de,e,!0)}#ue=T("ACTIVE");get exportFrameSelection(){return i(this.#ue)}set exportFrameSelection(e){k(this.#ue,e,!0)}#ve=T(0);get exportProgress(){return i(this.#ve)}set exportProgress(e){k(this.#ve,e,!0)}#pe=T(!1);get includePixelBorders(){return i(this.#pe)}set includePixelBorders(e){k(this.#pe,e,!0)}escapeStack=[];#he=T(He([]));get _overlayStack(){return i(this.#he)}set _overlayStack(e){k(this.#he,e,!0)}_managedOverlays=ms.managed;constructor(){setInterval(()=>{const e=Date.now()-this.sessionStartTime;this.usageMinutes=Math.floor(e/6e4),this.usageSeconds=Math.floor(e/1e3)},1e3)}mount(){pt(()=>{for(const e of this._managedOverlays)this[e]?Dt(()=>this._overlayStack.includes(e))||(this._overlayStack=[...Dt(()=>this._overlayStack),e]):Dt(()=>this._overlayStack.includes(e))&&(this._overlayStack=Dt(()=>this._overlayStack.filter(r=>r!==e)))})}setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.1,Math.min(10,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}resetPan(){this.panOffset={x:0,y:0}}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();if(e)return e(),!0;const t=this._overlayStack[this._overlayStack.length-1];return t?(this[t]=!1,!0):!1}}class ra{id=crypto.randomUUID();#e=T("New Layer");get name(){return i(this.#e)}set name(e){k(this.#e,e,!0)}#t=T(!0);get isVisible(){return i(this.#t)}set isVisible(e){k(this.#t,e,!0)}#a=T(!1);get isLocked(){return i(this.#a)}set isLocked(e){k(this.#a,e,!0)}#r=T(1);get opacity(){return i(this.#r)}set opacity(e){k(this.#r,e,!0)}#s=T(!1);get isLinked(){return i(this.#s)}set isLinked(e){k(this.#s,e,!0)}#i=T(0);get wiggleAmount(){return i(this.#i)}set wiggleAmount(e){k(this.#i,e,!0)}#o=T(0);get swayAmount(){return i(this.#o)}set swayAmount(e){k(this.#o,e,!0)}#n=T(1);get swaySpeed(){return i(this.#n)}set swaySpeed(e){k(this.#n,e,!0)}#l=T(0);get pulseAmount(){return i(this.#l)}set pulseAmount(e){k(this.#l,e,!0)}#c=T(1);get pulseSpeed(){return i(this.#c)}set pulseSpeed(e){k(this.#c,e,!0)}#d=T("LAYER");get type(){return i(this.#d)}set type(e){k(this.#d,e,!0)}#u=T(null);get parentId(){return i(this.#u)}set parentId(e){k(this.#u,e,!0)}#v=T(!1);get isCollapsed(){return i(this.#v)}set isCollapsed(e){k(this.#v,e,!0)}#p=T(new Uint32Array(0));get pixels(){return i(this.#p)}set pixels(e){k(this.#p,e)}#h=q(()=>{if(this.type==="FOLDER")return!1;for(let e=0;e<this.pixels.length;e++)if(this.pixels[e]!==0)return!0;return!1});get hasContent(){return i(this.#h)}set hasContent(e){k(this.#h,e)}constructor(e,t,r,s="LAYER"){this.name=e,this.type=s,s==="LAYER"&&(this.pixels=new Uint32Array(t*r))}clone(e,t){const r=new ra(this.name,e,t,this.type);return r.pixels=this.type==="LAYER"?new Uint32Array(this.pixels):new Uint32Array(0),r.isVisible=this.isVisible,r.isLocked=this.isLocked,r.opacity=this.opacity,r.parentId=this.parentId,r.isCollapsed=this.isCollapsed,r}clear(){const e=new Uint32Array(this.pixels.length);e.fill(0),this.pixels=e}hasPixel(e){return this.pixels[e]!==0}}class _s{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const ja=new _s,As={"c-major":[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25]},ws={move:{freq:450,duration:.08,volume:.15},draw:{freq:1200,duration:.15,volume:.03},startup:{freq:220,duration:.8,volume:.1},ready:[523.25,659.25,783.99,1046.5]},ks={scale:[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25],chords:[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]],fade:{startMins:20,fullMins:50}},zt={scales:As,tones:ws,ambient:ks};class Es{get ctx(){return ja.ctx}playTone(e,t,r="sine",s=.1,o=1e-4){if(a.isMuted)return;const l=this.ctx.createOscillator(),n=this.ctx.createGain();l.type=r,l.frequency.setValueAtTime(e,this.ctx.currentTime);const u=s*a.sfxVolume;n.gain.setValueAtTime(u,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(o,this.ctx.currentTime+t),l.connect(n),n.connect(this.ctx.destination),l.start(),l.stop(this.ctx.currentTime+t)}playMove(){const{freq:e,duration:t,volume:r}=zt.tones.move;this.playTone(e,t,"sine",r)}playDraw(){const{freq:e,duration:t,volume:r}=zt.tones.draw;this.playTone(e,t,"sine",r),setTimeout(()=>this.playTone(e*1.25,t*.6,"sine",r*.6),50)}playScale(e){const t=zt.scales["c-major"],r=t[e%t.length];this.playTone(r,.15,"sine",.12)}playErase(){if(a.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,r=this.ctx.createBuffer(1,t,this.ctx.sampleRate),s=r.getChannelData(0);for(let v=0;v<t;v++)s[v]=Math.random()*2-1;const o=this.ctx.createBufferSource();o.buffer=r;const l=this.ctx.createBiquadFilter();l.type="lowpass",l.frequency.setValueAtTime(1500,this.ctx.currentTime),l.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const n=this.ctx.createGain(),u=.1*a.sfxVolume;n.gain.setValueAtTime(u,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),o.connect(l),l.connect(n),n.connect(this.ctx.destination),o.start()}playStartup(){const{freq:e,duration:t,volume:r}=zt.tones.startup;this.playTone(e,t,"sine",r),this.playTone(e/2,t*1.5,"sine",r/2)}playReady(){zt.tones.ready.forEach((t,r)=>{setTimeout(()=>this.playTone(t,.4,"sine",.05),r*100)})}}const se=new Es;class Ss{interval=null;#e=T(0);get elapsedTime(){return i(this.#e)}set elapsedTime(e){k(this.#e,e,!0)}#t=q(()=>{const e=1e3/a.project.fps;return a.project.frames.length*e});get totalDuration(){return i(this.#t)}set totalDuration(e){k(this.#t,e)}startPlayback(){if(a.project.isPlaying)return;if(a.project.frames.length<=1){se.playErase();return}a.project.isPlaying=!0,this.elapsedTime=0;const e=1e3/a.project.fps;for(let t=0;t<a.project.activeFrameIndex;t++)this.elapsedTime+=e;se.playDraw(),this.tick()}stopPlayback(){a.project.isPlaying=!1,this.interval&&(clearTimeout(this.interval),this.interval=null)}togglePlayback(){a.project.isPlaying?this.stopPlayback():this.startPlayback()}tick(){if(!a.project.isPlaying)return;a.project.activeFrame;const e=Math.max(16,1e3/a.project.fps);let t=(a.project.activeFrameIndex+1)%a.project.frames.length,r=0;for(;!a.project.frames[t].isVisible&&r<a.project.frames.length;)t=(t+1)%a.project.frames.length,r++;if(!a.project.frames[t].isVisible){this.stopPlayback();return}this.interval=setTimeout(()=>{a.project.activeFrameIndex=t,t===0?this.elapsedTime=0:this.elapsedTime+=e,this.tick()},e)}}const Fa=new Ss;class ga{id=crypto.randomUUID();#e=T("Untitled Frame");get name(){return i(this.#e)}set name(e){k(this.#e,e,!0)}#t=T(32);get width(){return i(this.#t)}set width(e){k(this.#t,e,!0)}#a=T(32);get height(){return i(this.#a)}set height(e){k(this.#a,e,!0)}#r=T(1);get opacity(){return i(this.#r)}set opacity(e){k(this.#r,e,!0)}#s=T(!0);get isVisible(){return i(this.#s)}set isVisible(e){k(this.#s,e,!0)}#i=T(He([]));get layers(){return i(this.#i)}set layers(e){k(this.#i,e,!0)}#o=T(0);get activeLayerIndex(){return i(this.#o)}set activeLayerIndex(e){k(this.#o,e,!0)}#n=T(He(new Set([0])));get selectedLayerIndices(){return i(this.#n)}set selectedLayerIndices(e){k(this.#n,e,!0)}constructor(e,t=32,r=32){this.name=e,this.width=t,this.height=r,this.layers=[new ra("Base Layer",t,r)]}get activeLayer(){return this.layers[this.activeLayerIndex]}addLayer(e){const t=e||`Layer ${this.layers.length+1}`,r=new ra(t,this.width,this.height),s=this.activeLayer;return s.type==="FOLDER"?r.parentId=s.id:s.parentId&&(r.parentId=s.parentId),this.layers.push(r),this.activeLayerIndex=this.layers.length-1,r}addGroup(e){const t=e||`Group ${this.layers.length+1}`,r=new ra(t,this.width,this.height,"FOLDER");return this.layers.push(r),this.activeLayerIndex=this.layers.length-1,r}removeLayer(e){if(this.layers.length<=1)return;const t=this.layers[e];t.type==="FOLDER"&&this.layers.forEach(r=>{r.parentId===t.id&&(r.parentId=null)}),this.layers.splice(e,1),this.activeLayerIndex>=this.layers.length&&(this.activeLayerIndex=this.layers.length-1)}#l=q(()=>{const e=new Uint32Array(this.width*this.height),t=Fa.elapsedTime/1e3,r=new Map;this.layers.forEach(s=>{s.type==="FOLDER"&&r.set(s.id,s.isVisible)});for(const s of this.layers){if(s.type==="FOLDER"||!s.isVisible||s.parentId&&r.get(s.parentId)===!1)continue;let o=0,l=0;s.swayAmount>0&&(o+=Math.sin(t*s.swaySpeed*Math.PI)*s.swayAmount),s.wiggleAmount>0&&(o+=(Math.sin(t*20)+Math.cos(t*13))*(s.wiggleAmount/2),l+=(Math.cos(t*17)+Math.sin(t*11))*(s.wiggleAmount/2));const n=s.pixels;for(let u=0;u<e.length;u++){const v=n[u];if(v!==0)if(o!==0||l!==0){const p=u%this.width,x=Math.floor(u/this.width),b=Math.round(p+o),g=Math.round(x+l);b>=0&&b<this.width&&g>=0&&g<this.height&&(e[g*this.width+b]=v)}else e[u]=v}}return e});get compositePixels(){return i(this.#l)}set compositePixels(e){k(this.#l,e)}}class Ls{#e=T(null);get currentFilePath(){return i(this.#e)}set currentFilePath(e){k(this.#e,e,!0)}#t=T(null);get lastSaved(){return i(this.#t)}set lastSaved(e){k(this.#t,e,!0)}#a=T(He([]));get frames(){return i(this.#a)}set frames(e){k(this.#a,e,!0)}#r=T(He([]));get tags(){return i(this.#r)}set tags(e){k(this.#r,e,!0)}#s=T(0);get activeFrameIndex(){return i(this.#s)}set activeFrameIndex(e){k(this.#s,e,!0)}#i=T(He(new Set([0])));get selectedFrameIndices(){return i(this.#i)}set selectedFrameIndices(e){k(this.#i,e,!0)}#o=T(!1);get isPlaying(){return i(this.#o)}set isPlaying(e){k(this.#o,e,!0)}#n=T(10);get fps(){return i(this.#n)}set fps(e){k(this.#n,e,!0)}#l=T(null);get clipboard(){return i(this.#l)}set clipboard(e){k(this.#l,e,!0)}constructor(){this.frames=[new ga("Main Art")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,r=new ga(t);return this.frames.push(r),this.activeFrameIndex=this.frames.length-1,r}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e=null){this.currentFilePath=e,this.lastSaved=new Date}}class Ts{#e=T(null);get start(){return i(this.#e)}set start(e){k(this.#e,e,!0)}#t=T(null);get end(){return i(this.#t)}set end(e){k(this.#t,e,!0)}#a=T(He([]));get indices(){return i(this.#a)}set indices(e){k(this.#a,e,!0)}#r=T(He([]));get vertices(){return i(this.#r)}set vertices(e){k(this.#r,e,!0)}#s=q(()=>{const e=new Set,t=a.canvas.width;this.indices.forEach(s=>e.add(s));const r=this.rectangularBounds;if(r)for(let s=r.y1;s<=r.y2;s++)for(let o=r.x1;o<=r.x2;o++)e.add(s*t+o);return e});get activeIndicesSet(){return i(this.#s)}set activeIndicesSet(e){k(this.#s,e)}get isActive(){return this.indices.length>0||this.start!==null||this.vertices.length>0}begin(e,t){this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.indices=[],this.vertices=[]}getPoints(e){const t=new Map;this.indices.forEach(s=>{t.set(s,{x:s%e,y:Math.floor(s/e)})});const r=this.rectangularBounds;if(r)for(let s=r.y1;s<=r.y2;s++)for(let o=r.x1;o<=r.x2;o++){const l=s*e+o;t.set(l,{x:o,y:s})}return Array.from(t.values())}getBoundaryEdges(e){const t=[],r=this.getPoints(e);if(r.length===0)return t;const s=new Set(r.map(o=>`${o.x},${o.y}`));return r.forEach(o=>{s.has(`${o.x},${o.y-1}`)||t.push({x1:o.x,y1:o.y,x2:o.x+1,y2:o.y}),s.has(`${o.x},${o.y+1}`)||t.push({x1:o.x,y1:o.y+1,x2:o.x+1,y2:o.y+1}),s.has(`${o.x-1},${o.y}`)||t.push({x1:o.x,y1:o.y,x2:o.x,y2:o.y+1}),s.has(`${o.x+1},${o.y}`)||t.push({x1:o.x+1,y1:o.y,x2:o.x+1,y2:o.y+1})}),t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){const t=this.getPoints(e);if(t.length===0)return null;let r=1/0,s=-1/0,o=1/0,l=-1/0;return t.forEach(n=>{n.x<r&&(r=n.x),n.x>s&&(s=n.x),n.y<o&&(o=n.y),n.y>l&&(l=n.y)}),{x1:r,x2:s,y1:o,y2:l,width:s-r+1,height:l-o+1}}}class Cs{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){!("isStructural"in e)&&!Array.isArray(e)&&e.oldColor===e.newColor||(this.currentBatch&&!("isStructural"in e)&&!Array.isArray(e)?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const he=new Cs;class Je{static getLinePoints(e,t,r,s,o=0){e=Math.floor(e),t=Math.floor(t),r=Math.floor(r),s=Math.floor(s);const l=[],n=Math.abs(r-e),u=Math.abs(s-t),v=e<r?1:-1,p=t<s?1:-1;let x=n-u;for(;;){l.push({x:e,y:t});const b=n===u,g=n===0||u===0;if(o>.9&&!b&&!g&&(n>u?l.push({x:e,y:t+p}):l.push({x:e+v,y:t})),e===r&&t===s)break;const m=2*x;m>-u&&(x-=u,e+=v),m<n&&(x+=n,t+=p)}return l}static getCirclePoints(e,t,r){e=Math.floor(e),t=Math.floor(t),r=Math.round(r);const s=[];let o=r,l=0,n=0;for(;o>=l;)[{x:e+o,y:t+l},{x:e+l,y:t+o},{x:e-l,y:t+o},{x:e-o,y:t+l},{x:e-o,y:t-l},{x:e-l,y:t-o},{x:e+l,y:t-o},{x:e+o,y:t-l}].forEach(v=>s.push(v)),n<=0&&(l+=1,n+=2*l+1),n>0&&(o-=1,n-=2*o+1);return s}static fitArc(e,t){if(e.length<10)return null;let r=0,s=0;e.forEach(M=>{r+=M.x,s+=M.y});const o=r/e.length,l=s/e.length;let n=0;const u=e.map(M=>{const j=Math.sqrt((M.x-o)**2+(M.y-l)**2);return n+=j,j}),v=n/e.length;let p=0;if(u.forEach(M=>{p+=(M-v)**2}),Math.sqrt(p/e.length)/(v||1)>t)return null;const g=e[0],m=e[e.length-1],y=Math.sqrt((g.x-m.x)**2+(g.y-m.y)**2)<v*1.5||e.length>v*Math.PI*1.5,w=[],C=Math.atan2(e[0].y-l,e[0].x-o),R=Math.atan2(e[e.length-1].y-l,e[e.length-1].x-o),F=Math.max(32,Math.floor(v*10));let B=R-C;for(;B>Math.PI;)B-=Math.PI*2;for(;B<-Math.PI;)B+=Math.PI*2;const U=y?Math.PI*2:B;for(let M=0;M<=F;M++){const j=C+U*(M/F);w.push({x:o+Math.cos(j)*v,y:l+Math.sin(j)*v})}return{cx:o,cy:l,r:v,isFull:y,points:w}}static perpendicularDistance(e,t,r){const s=r.x-t.x,o=r.y-t.y;return s===0&&o===0?Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2):Math.abs(o*e.x-s*e.y+r.x*t.y-r.y*t.x)/Math.sqrt(s*s+o*o)}static toCartesianLabel(e,t,r=!1){const s=Math.floor(t/2),o=t%2===0?e<s?e-s:e-s+1:e-s;return r?-o:o}static getGuidePosition(e,t){return 50+e/t*100}static mapScreenToGrid(e,t,r,s,o){const l=(e-r.left)/r.width,n=(t-r.top)/r.height;return{x:l*s,y:n*o}}static calculateCameraTransform(e,t,r,s,o){const{x:l,y:n}=t;if(e<=1)return`translate(calc(-50% + ${l}px), calc(-50% + ${n}px)) scale(${e})`;const u=(r.x+.5)/s*100,v=(r.y+.5)/o*100;return`translate(calc(-${u}% + ${l}px), calc(-${v}% + ${n}px)) scale(${e})`}static calculatePanDelta(e,t,r,s){return{dx:e-r,dy:t-s}}}class st{static getSymmetryPoints(e,t,r,s,o){const l=[],n=r-1-e,u=s-1-t;return o==="HORIZONTAL"?l.push({x:n,y:t}):o==="VERTICAL"?l.push({x:e,y:u}):o==="QUADRANT"&&(l.push({x:n,y:t}),l.push({x:e,y:u}),l.push({x:n,y:u})),l}static wrap(e,t,r,s){return{x:(e%r+r)%r,y:(t%s+s)%s}}static floodFill(e,t,r,s,o,l){const n=e[o*t+s];if(n===l)return e;const u=[...e],v=[[s,o]];for(;v.length>0;){let[p,x]=v.pop(),b=p;for(;b>0&&u[x*t+(b-1)]===n;)u[x*t+(b-1)]=l,b--;for(;p<t&&u[x*t+p]===n;)u[x*t+p]=l,p++;this.scan(b,p-1,x-1,t,r,u,n,v),this.scan(b,p-1,x+1,t,r,u,n,v)}return u}static scan(e,t,r,s,o,l,n,u){if(r<0||r>=o)return;let v=!1;for(let p=e;p<=t;p++)l[r*s+p]===n?v||(u.push([p,r]),v=!0):v=!1}static recolor(e,t,r){return e.map(s=>s===t?r:s)}static getPaletteUsage(e){const t=new Set;return e.forEach(r=>{r&&t.add(r)}),t}static pixelPerfectFilter(e){if(e.length<3)return e;const t=[e[0]];for(let r=1;r<e.length;r++){const s=e[r],o=t[t.length-1];if(!(s.x===o.x&&s.y===o.y)){if(t.length>=2){const l=t[t.length-2],n=Math.abs(s.x-l.x),u=Math.abs(s.y-l.y);n<=1&&u<=1&&t.pop()}t.push(s)}}return t}static BAYER_4X4=[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]];static orderedDither(e,t,r){if(r>=1)return!0;if(r<=0)return!1;const s=(e%4+4)%4,o=(t%4+4)%4,l=this.BAYER_4X4[o][s]/16;return r>l}static getRectanglePoints(e,t,r,s){const o=[],l=Math.min(e,r),n=Math.max(e,r),u=Math.min(t,s),v=Math.max(t,s);for(let p=l;p<=n;p++)o.push({x:p,y:u}),o.push({x:p,y:v});for(let p=u+1;p<v;p++)o.push({x:l,y:p}),o.push({x:n,y:p});return o}static getEllipsePoints(e,t,r,s){const o=(e+r)/2,l=(t+s)/2,n=Math.abs(r-e)/2,u=Math.abs(s-t)/2;if(n===0||u===0)return[];const v=[];let p=0,x=u,b=u*u-n*n*u+.25*n*n,g=2*u*u*p,m=2*n*n*x;for(;g<m;)this.addEllipsePoints(v,o,l,p,x),b<0?(p++,g=g+2*u*u,b=b+g+u*u):(p++,x--,g=g+2*u*u,m=m-2*n*n,b=b+g-m+u*u);let _=u*u*((p+.5)*(p+.5))+n*n*((x-1)*(x-1))-n*n*u*u;for(;x>=0;)this.addEllipsePoints(v,o,l,p,x),_>0?(x--,m=m-2*n*n,_=_+n*n-m):(x--,p++,g=g+2*u*u,m=m-2*n*n,_=_+g-m+n*n);return v}static addEllipsePoints(e,t,r,s,o){e.push({x:Math.round(t+s),y:Math.round(r+o)}),e.push({x:Math.round(t-s),y:Math.round(r+o)}),e.push({x:Math.round(t+s),y:Math.round(r-o)}),e.push({x:Math.round(t-s),y:Math.round(r-o)})}static getPolygonPoints(e,t,r,s,o,l=0){const n=(e+r)/2,u=(t+s)/2,v=Math.abs(r-e)/2,p=Math.abs(s-t)/2,x=Math.max(v,p);if(x===0)return[];const b=[],g=-Math.PI/2;if(l>0){const _=x*(1-l/100);for(let y=0;y<o*2;y++){const w=g+y*Math.PI/o,C=y%2===0?x:_;b.push({x:Math.round(n+Math.cos(w)*C),y:Math.round(u+Math.sin(w)*C)})}}else for(let _=0;_<o;_++){const y=g+_*2*Math.PI/o;b.push({x:Math.round(n+Math.cos(y)*x),y:Math.round(u+Math.sin(y)*x)})}const m=[];for(let _=0;_<b.length;_++){const y=b[_],w=b[(_+1)%b.length];m.push(...Je.getLinePoints(y.x,y.y,w.x,w.y))}return m}static getLinearGradientMap(e,t,r,s,o,l){const n=[],u=r-e,v=s-t,p=u*u+v*v;return p===0?o.map(x=>({index:x,ratio:0})):(o.forEach(x=>{const b=x%l,g=Math.floor(x/l),m=((b-e)*u+(g-t)*v)/p,_=Math.max(0,Math.min(1,m));n.push({index:x,ratio:_})}),n)}}class Is{move(e,t){let r=a.cursor.pos.x+e,s=a.cursor.pos.y+t;if(a.studio.isTilingEnabled){const o=st.wrap(r,s,a.canvas.width,a.canvas.height);r=o.x,s=o.y}else r=Math.max(0,Math.min(a.canvas.width-1,r)),s=Math.max(0,Math.min(a.canvas.height-1,s));return r!==a.cursor.pos.x||s!==a.cursor.pos.y?(a.cursor.setPos(r,s),se.playMove(),!0):!1}internalToCartesian(e,t,r,s){const o=(l,n)=>{const u=Math.floor(n/2);return n%2===0?l<u?l-u:l-u+1:l-u};return{x:o(e,r),y:-o(t,s)}}cartesianToInternal(e,t,r,s){const o=Math.floor(r/2),l=Math.floor(s/2);let n,u;r%2===0?n=e<0?e+o:e+o-1:n=e+o;const v=-t;return s%2===0?u=v<0?v+l:v+l-1:u=v+l,{x:Math.max(0,Math.min(r-1,n)),y:Math.max(0,Math.min(s-1,u))}}jumpTo(e,t){const{x:r,y:s}=this.cartesianToInternal(e,t,a.canvas.width,a.canvas.height);a.cursor.setPos(r,s)}jumpHome(){this.jumpTo(1,1),se.playMove()}}class Sa{static getKernel(e,t){if(e<=1)return[{x:0,y:0,weight:1}];const r=[],s=(e-1)/2,o=-Math.floor(s),l=Math.ceil(s);for(let n=o;n<=l;n++)for(let u=o;u<=l;u++){const v=Math.sqrt(u*u+n*n);if(t==="CIRCLE"&&v>s+.1||t==="SQUARE"&&(Math.abs(u)>s||Math.abs(n)>s))continue;const x=(t==="CIRCLE"?s:Math.max(Math.abs(u),Math.abs(n)))===0?1:Math.max(0,1-v/(s+.5));r.push({x:u,y:n,weight:x})}return r}static getSpans(e,t){if(e<=1)return[{y:0,x1:0,x2:0}];const r=[],s=(e-1)/2,o=-Math.floor(s),l=Math.ceil(s);for(let n=o;n<=l;n++)if(t==="SQUARE")r.push({y:n,x1:o,x2:l});else{const u=Math.sqrt(s*s-n*n),v=Math.floor(u);isNaN(v)||r.push({y:n,x1:-v,x2:v})}return r}}class Xa{static simplify(e,t){if(e.length<=2||t<=0)return e;let r=0,s=0;const o=e[0],l=e[e.length-1];for(let n=1;n<e.length-1;n++){const u=Je.perpendicularDistance(e[n],o,l);u>r&&(s=n,r=u)}if(r>t){const n=this.simplify(e.slice(0,s+1),t),u=this.simplify(e.slice(s),t);return[...n.slice(0,-1),...u]}else return[o,l]}static smooth(e,t){if(e.length<=2||t<=0)return e;const r=[...e],s=Math.floor(t/10)+1;for(let o=1;o<e.length-1;o++){let l=0,n=0,u=0;for(let v=o-s;v<=o+s;v++)v>=0&&v<e.length&&(l+=e[v].x,n+=e[v].y,u++);r[o]={x:l/u,y:n/u}}return r}static traceCluster(e,t){const r=new Set;for(const o of e){const l=o%t,n=Math.floor(o/t);[{x:l,y:n-1,id:"top"},{x:l+1,y:n,id:"right"},{x:l,y:n+1,id:"bottom"},{x:l-1,y:n,id:"left"}].forEach(v=>{const p=v.y*t+v.x;if(v.x<0||v.x>=t||v.y<0||!e.has(p)){let b;v.id==="top"?b=`${l},${n}-${l+1},${n}`:v.id==="right"?b=`${l+1},${n}-${l+1},${n+1}`:v.id==="bottom"?b=`${l+1},${n+1}-${l},${n+1}`:b=`${l},${n+1}-${l},${n}`,r.add(b)}})}const s=[];for(;r.size>0;){const o=r.values().next().value;if(!o)break;r.delete(o);const[l,n]=o.split("-");let u=n,v=`M ${l.replace(","," ")} L ${n.replace(","," ")}`,p=!0;for(;p;){p=!1;for(const x of r)if(x.startsWith(u+"-")){const[b,g]=x.split("-");v+=` L ${g.replace(","," ")}`,u=g,r.delete(x),p=!0;break}}v+=" Z",s.push(v)}return s.join(" ")}}const Ps={MOVE_UP:{label:"Move Up",keys:["ArrowUp"],group:"Navigation"},MOVE_DOWN:{label:"Move Down",keys:["ArrowDown"],group:"Navigation"},MOVE_LEFT:{label:"Move Left",keys:["ArrowLeft"],group:"Navigation"},MOVE_RIGHT:{label:"Move Right",keys:["ArrowRight"],group:"Navigation"},GOTO:{label:"Jump to Coordinate",keys:["Alt+j"],group:"Navigation"},JUMP_HOME:{label:"Return to Center",keys:["Ctrl+h"],group:"Navigation"},PAN_VIEWPORT:{label:"Pan Viewport (Hold)",keys:["q"],group:"Navigation"},RESET_PAN:{label:"Reset Panning",keys:["Alt+q"],group:"Navigation"},RESET_VIEWPORT:{label:"Reset Pan/Zoom",keys:["Alt+Backspace"],group:"View"}},Ms={PAINT:{label:"Paint (Apply Color)",keys:["Space","Enter"],group:"Tools"},ERASE:{label:"Erase Pixel",keys:["Backspace","Delete"],group:"Tools"},PICK_COLOR:{label:"Sample Color",keys:["Alt+i","Alt+Space"],group:"Tools"},FLOOD_FILL:{label:"Color Fill",keys:["Alt+f"],group:"Magic"},RECOLOR:{label:"Recolor All",keys:["Alt+r"],group:"Magic"},SELECT_SAME:{label:"Magic Wand",keys:["w"],group:"Magic"},TOGGLE_DITHER_BLEND:{label:"Classic Blend",keys:["Alt+g"],group:"Magic"}},Os={FLOW_PAINT:{label:"Continuous Painting",keys:["Ctrl"],group:"Flow"},FLOW_ERASE:{label:"Continuous Erasing",keys:["Ctrl+Shift"],group:"Flow"},FLOW_SELECT:{label:"Define Selection",keys:["Shift"],group:"Flow"}},Rs={COPY:{label:"Copy",keys:["Ctrl+c"],group:"Edit"},CUT:{label:"Cut",keys:["Ctrl+x"],group:"Edit"},PASTE:{label:"Paste",keys:["Ctrl+v"],group:"Edit"},CLEAR_CANVAS:{label:"Clear All",keys:["Ctrl+l"],group:"Edit"}},Ds={FLIP_H:{label:"Flip Horizontally",keys:["Alt+h"],group:"Transform"},FLIP_V:{label:"Flip Vertically",keys:["Alt+v"],group:"Transform"},ROTATE:{label:"Rotate 90° Clockwise",keys:["r"],group:"Transform"},ZOOM_IN:{label:"Zoom In",keys:["+","="],group:"View"},ZOOM_OUT:{label:"Zoom Out",keys:["-"],group:"View"},RESET_ZOOM:{label:"Reset Zoom",keys:["Ctrl+0"],group:"View"}},js={NEXT_FRAME:{label:"Next Frame",keys:["Alt+PageDown","Tab"],group:"Timeline"},PREV_FRAME:{label:"Previous Frame",keys:["Alt+PageUp","Shift+Tab"],group:"Timeline"},PLAY_PAUSE:{label:"Play/Pause",keys:["p"],group:"Timeline"},TOGGLE_GHOST_LAYERS:{label:"Onion Skinning",keys:["Alt+o"],group:"Timeline"}},Fs={NEW_ITEM:{label:"Add New (Contextual)",keys:["Alt+Shift+n"],group:"Layers"},NEW_LAYER_GROUP:{label:"Group Layers",keys:["Ctrl+g"],group:"Layers"},DUPLICATE_ITEM:{label:"Duplicate (Contextual)",keys:["Ctrl+d"],group:"Layers"},MOVE_ITEM_UP:{label:"Bring Forward",keys:["Ctrl+]"],group:"Layers"},MOVE_ITEM_DOWN:{label:"Send Backward",keys:["Ctrl+["],group:"Layers"},MOVE_ITEM_TOP:{label:"Bring to Front",keys:["Ctrl+Shift+]"],group:"Layers"},MOVE_ITEM_BOTTOM:{label:"Send to Back",keys:["Ctrl+Shift+["],group:"Layers"},DELETE_ITEM:{label:"Remove (Contextual)",keys:["Alt+d"],group:"Layers"},MERGE_LAYERS:{label:"Merge Layer Down",keys:["Ctrl+Alt+m"],group:"Layers"},TOGGLE_LAYER_VISIBILITY:{label:"Show/Hide Layer",keys:["Ctrl+Alt+v"],group:"Layers"},TOGGLE_LAYER_LOCK:{label:"Lock/Unlock Layer",keys:["Alt+l"],group:"Layers"}},$s={BRUSH_SIZE_INC:{label:"Increase Brush Size",keys:["]"],group:"Etching"},BRUSH_SIZE_DEC:{label:"Decrease Brush Size",keys:["["],group:"Etching"},TOGGLE_PATTERN_BRUSH:{label:"Pattern Brush",keys:["Ctrl+Alt+b"],group:"Etching"},TOGGLE_BRUSH_SHAPE:{label:"Toggle Brush Shape",keys:["Alt+b"],group:"Etching"},CYCLE_SYMMETRY:{label:"Cycle Symmetry Mode",keys:["s"],group:"Etching"},TOGGLE_TILING:{label:"Toggle Seamless Tiling",keys:["t"],group:"Etching"},TOGGLE_AIRBRUSH:{label:"The Mist (Airbrush)",keys:["Alt+a"],group:"Etching"},TOGGLE_ALPHA_LOCK:{label:"Toggle Alpha Lock",keys:["a"],group:"Etching"},TOGGLE_COLOR_LOCK:{label:"Toggle Color Lock",keys:["Shift+a"],group:"Etching"},SHADE_LIGHTEN:{label:"Shade: Lighten",keys:["l"],group:"Etching"},SHADE_DARKEN:{label:"Shade: Darken",keys:["d"],group:"Etching"},SHADE_DITHER:{label:"Shade: Dither",keys:["x"],group:"Etching"},TOGGLE_PIXEL_PERFECT:{label:"Toggle Pixel-Perfect Lines",keys:["Shift+p"],group:"Etching"},TOOL_BRUSH:{label:"Brush Tool",keys:["Shift+b"],group:"Etching"},TOOL_ERASER:{label:"Eraser Tool",keys:["e"],group:"Etching"},TOOL_SELECT:{label:"Select Tool",keys:["Shift+s"],group:"Etching"},TOGGLE_HAND_TOOL:{label:"Hand Tool",keys:["h"],group:"Etching"},TOOL_RECTANGLE:{label:"Rectangle Tool",keys:["Shift+r"],group:"Etching"},TOOL_ELLIPSE:{label:"Ellipse Tool",keys:["Alt+c"],group:"Etching"},TOOL_POLYGON:{label:"Polygon Tool",keys:["Alt+p"],group:"Etching"},POLY_SIDES_INC:{label:"Increase Polygon Sides",keys:["Alt+."],group:"Etching"},POLY_SIDES_DEC:{label:"Decrease Polygon Sides",keys:["Alt+,"],group:"Etching"},POLY_INDENT_INC:{label:"Increase Indentation",keys:["Alt+Shift+]"],group:"Etching"},POLY_INDENT_DEC:{label:"Decrease Indentation",keys:["Alt+Shift+["],group:"Etching"},SET_SIDES_3:{label:"Set Sides: 3",keys:["Alt+3"],group:"Etching"},SET_SIDES_4:{label:"Set Sides: 4",keys:["Alt+4"],group:"Etching"},SET_SIDES_5:{label:"Set Sides: 5",keys:["Alt+5"],group:"Etching"},SET_SIDES_6:{label:"Set Sides: 6",keys:["Alt+6"],group:"Etching"},SET_SIDES_7:{label:"Set Sides: 7",keys:["Alt+7"],group:"Etching"},SET_SIDES_8:{label:"Set Sides: 8",keys:["Alt+8"],group:"Etching"},SET_SIDES_9:{label:"Set Sides: 9",keys:["Alt+9"],group:"Etching"},SET_SIDES_10:{label:"Set Sides: 10",keys:["Alt+0"],group:"Etching"},TOGGLE_UNDERLAY:{label:"Toggle Underlay Visibility",keys:["Ctrl+Alt+u"],group:"View"},OPEN_UNDERLAY_MENU:{label:"Underlay Menu",keys:["Alt+u"],group:"View"},TOOL_TRANSFORM:{label:"Transform Selection",keys:["m"],group:"Edit"}},Bs={OPEN_MENU:{label:"Command Palette",keys:["Ctrl+k"],group:"System"},OPEN_EXPORT:{label:"Export",keys:["Ctrl+e"],group:"System"},SAVE:{label:"Save",keys:["Ctrl+s"],group:"System"},OPEN_SETTINGS:{label:"Settings",keys:["Ctrl+,"],group:"System"},OPEN_MANUAL:{label:"Barista Manual",keys:["F1"],group:"System"},OPEN_PALETTE:{label:"Color Picker",keys:["b"],group:"System"},OPEN_HELP:{label:"Quick Guide",keys:["F2"],group:"System"},OPEN_AUDIO:{label:"Audio Settings",keys:["Ctrl+Shift+a"],group:"System"},TOGGLE_MUTE:{label:"Mute Audio",keys:["Ctrl+Shift+m"],group:"System"},TOGGLE_MINIMAP:{label:"Minimap",keys:["Ctrl+m"],group:"System"},UNDO:{label:"Undo",keys:["Ctrl+z"],group:"System"},REDO:{label:"Redo",keys:["Ctrl+Shift+z","Ctrl+y"],group:"System"},ESCAPE:{label:"Close/Cancel",keys:["Escape"],group:"System"}},Gs={SELECT_COLOR_1:{label:"Select Color 1",keys:["1"],group:"Colors"},SELECT_COLOR_2:{label:"Select Color 2",keys:["2"],group:"Colors"},SELECT_COLOR_3:{label:"Select Color 3",keys:["3"],group:"Colors"},SELECT_COLOR_4:{label:"Select Color 4",keys:["4"],group:"Colors"},SELECT_COLOR_5:{label:"Select Color 5",keys:["5"],group:"Colors"},SELECT_COLOR_6:{label:"Select Color 6",keys:["6"],group:"Colors"},SELECT_COLOR_7:{label:"Select Color 7",keys:["7"],group:"Colors"},SELECT_COLOR_8:{label:"Select Color 8",keys:["8"],group:"Colors"},SELECT_COLOR_9:{label:"Select Color 9",keys:["9"],group:"Colors"},SELECT_COLOR_0:{label:"Select Color 0",keys:["0"],group:"Colors"}},Ns={TAB_TIMELINE:{label:"Focus Timeline",keys:["Alt+1"],group:"System"},TAB_LAYERS:{label:"Focus Layers",keys:["Alt+2"],group:"System"}},Vs={navigation:Ps,painting:Ms,flows:Os,manipulation:Rs,transform:Ds,animation:js,layering:Fs,etching:$s,system:Bs,colors:Gs,tabs:Ns};class Us{buffer=[];timeout=null;#e=T(He([]));get currentSequence(){return i(this.#e)}set currentSequence(e){k(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const r=this.buffer.join(","),s={"g,c":"GOTO","f,n":"NEW_ITEM","i,n":"NEW_ITEM","i,l":"TOGGLE_LAYER_LOCK","i,h":"TOGGLE_LAYER_VISIBILITY","i,m":"MERGE_LAYERS"};if(s[r]){const o=s[r];return this.reset(),o}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const Ma=new Us;class Hs{patterns=[];#e=T(He([]));get activeKeys(){return i(this.#e)}set activeKeys(e){k(this.#e,e,!0)}#t=T(!1);get isCtrlActive(){return i(this.#t)}set isCtrlActive(e){k(this.#t,e,!0)}#a=T(!1);get isShiftActive(){return i(this.#a)}set isShiftActive(e){k(this.#a,e,!0)}#r=T(!1);get isAltActive(){return i(this.#r)}set isAltActive(e){k(this.#r,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){this.patterns=[],Object.values(Vs).forEach(e=>{Object.entries(e).forEach(([t,r])=>{const{keys:s,group:o}=r,l=A({key:`labels.${t}`}),n=o.toLowerCase().replace(/ & /g,"_").replace(/ /g,"_"),u=A({key:`shortcut_groups.${n}`});s.forEach(v=>{const p=v.toLowerCase();let x="",b=!1,g=!1,m=!1;if(p==="+")x="+";else{const _=p.split("+");x=_[_.length-1].trim(),x===""&&p.endsWith("++")&&(x="+"),b=_.includes("ctrl")||_.includes("control"),g=_.includes("shift"),m=_.includes("alt")}x==="space"&&(x=" "),(x==="ctrl"||x==="control")&&(x="control"),this.patterns.push({intent:t,key:x,ctrl:b,shift:g,alt:m,label:l,group:u})})})}),this.patterns.sort((e,t)=>{const r=s=>(s.ctrl?1:0)+(s.shift?1:0)+(s.alt?1:0);return r(t)-r(e)})}getActions(){const e=new Set,t=[];return this.patterns.forEach(r=>{e.has(r.intent)||(e.add(r.intent),t.push({intent:r.intent,label:r.label,group:r.group,shortcut:this.getLabel(r.intent)}))}),t}getGroupedActions(){const e=this.getActions(),t={},r={MOVE_UP:"navigation",MOVE_DOWN:"navigation",MOVE_LEFT:"navigation",MOVE_RIGHT:"navigation",SELECT_COLOR_1:"colors",SELECT_COLOR_2:"colors",SELECT_COLOR_3:"colors",SELECT_COLOR_4:"colors",SELECT_COLOR_5:"colors",SELECT_COLOR_6:"colors",SELECT_COLOR_7:"colors",SELECT_COLOR_8:"colors",SELECT_COLOR_9:"colors",SELECT_COLOR_0:"colors"},s=[],o=new Set;e.forEach(u=>{const v=r[u.intent];if(v){if(!o.has(v)){o.add(v);const p=A({key:`shortcut_groups.${v}`});s.push({...u,label:p,customKey:v.toUpperCase()})}}else s.push(u)}),s.forEach(u=>{t[u.group]||(t[u.group]=[]),t[u.group].push(u)});const l=[A({key:"shortcut_groups.rhythms"}),A({key:"shortcut_groups.navigation"}),A({key:"shortcut_groups.tools"}),A({key:"shortcut_groups.magic"}),A({key:"shortcut_groups.etching"}),A({key:"shortcut_groups.flow"}),A({key:"shortcut_groups.selection"}),A({key:"shortcut_groups.transform"}),A({key:"shortcut_groups.geometry"}),A({key:"shortcut_groups.timeline"}),A({key:"shortcut_groups.layers"}),A({key:"shortcut_groups.edit"}),A({key:"shortcut_groups.view"}),A({key:"shortcut_groups.menu"}),A({key:"shortcut_groups.colors"}),A({key:"shortcut_groups.system"})],n=Object.keys(t);return n.sort((u,v)=>{const p=l.indexOf(u),x=l.indexOf(v);return(p===-1?999:p)-(x===-1?999:x)}),n.map(u=>({group:u,items:t[u]}))}updatePhysicalState(e,t){const r=e.key.toLowerCase();t==="down"?this.activeKeys.includes(r)||this.activeKeys.push(r):(this.activeKeys=this.activeKeys.filter(s=>s!==r),r==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="control"&&s!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const r=Ma.process(t);if(r)return r}else Ma.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const r of this.patterns)if(t===r.key&&this.isCtrlActive===r.ctrl&&this.isShiftActive===r.shift&&this.isAltActive===r.alt)return r.intent;return null}getLabel(e){const t=this.patterns.find(u=>u.intent===e);if(!t)return"Unassigned";const r=[];t.ctrl&&r.push("Ctrl"),t.shift&&r.push("Shift"),t.alt&&r.push("Alt");let s=t.key;const o={" ":"Space",control:"Ctrl",meta:"Cmd",alt:"Alt",shift:"Shift",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right",backspace:"Backspace",delete:"Delete",enter:"Enter",escape:"Esc",tab:"Tab"},l=s.toLowerCase();o[l]?s=o[l]:s=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();const n=r.filter(u=>u.toLowerCase()!==s.toLowerCase());return n.length===0?s:n.join("+")+"+"+s}}const it=new Hs;class zs{#e=q(()=>a.studio.isHandToolActive||it.activeKeys.includes("q")?{type:"PAN",label:A({key:"labels.PAN_VIEWPORT"}),icon:"🤚",color:"var(--color-brand)",isPulse:!1}:Ma.isActive?{type:"FLOW",label:A({key:"timeline.mode_labels.brewing"}),icon:"📑",color:"var(--color-brand)",isPulse:!0}:a.isPicking?{type:"PICK",label:A({key:"timeline.mode_labels.tasting"}),icon:"📍",color:"var(--color-brand)",isPulse:!0}:it.isCtrlActive&&it.isShiftActive||a.studio.activeTool==="ERASER"?{type:"ERASE",label:A({key:"timeline.mode_labels.clearing"}),icon:"🧹",color:"var(--color-brand)",isPulse:!0}:it.isShiftActive||a.studio.activeTool==="SELECT"?{type:"SELECT",label:A({key:"timeline.mode_labels.selecting"}),icon:"✨",color:"var(--color-brand)",isPulse:!0}:it.isCtrlActive||a.studio.isShadingLighten||a.studio.isShadingDarken||a.studio.isShadingDither?{type:"PAINT",label:A({key:"timeline.mode_labels.pouring"}),icon:"☕",color:"var(--color-green-leaves)",isPulse:!0}:{type:"READY",label:A({key:"timeline.mode_labels.ready"}),icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return i(this.#e)}set current(e){k(this.#e,e)}}const ze=new zs;class Ys{draw(e,t){const r=e!==void 0?Math.floor(e):a.cursor.pos.x,s=t!==void 0?Math.floor(t):a.cursor.pos.y,o=[],l=new Uint32Array(a.canvas.pixels);if(a.studio.isPatternBrushActive&&a.studio.patternBrushData){const n=a.studio.patternBrushData,u=Math.floor(n.width/2),v=Math.floor(n.height/2);for(let p=0;p<n.height;p++)for(let x=0;x<n.width;x++){const b=r+x-u,g=s+p-v;if(a.canvas.isValidCoord(b,g)){const m=p*n.width+x,_=n.data[m];if(_===0)continue;const y=a.canvas.getIndex(b,g);if(a.selection.isActive&&!a.selection.activeIndicesSet.has(y)||a.studio.isAlphaLocked&&!a.project.activeFrame.activeLayer.hasPixel(y))continue;const C=ze.current.type==="ERASE"?0:_,R=l[y];R!==C&&(o.push({index:y,oldColor:ue.uint32ToHex(R),newColor:ue.uint32ToHex(C)}),l[y]=C)}}}else{const n=Sa.getKernel(a.studio.brushSize,a.studio.brushShape),u=a.studio.brushHardness;n.forEach(v=>{const p=r+v.x,x=s+v.y,b=[{x:p,y:x,weight:v.weight}];a.studio.symmetryMode!=="OFF"&&st.getSymmetryPoints(p,x,a.canvas.width,a.canvas.height,a.studio.symmetryMode).forEach(m=>b.push({...m,weight:v.weight})),b.forEach(g=>{let m=g;if(a.studio.isTilingEnabled)m={...st.wrap(g.x,g.y,a.canvas.width,a.canvas.height),weight:g.weight};else if(!a.canvas.isValidCoord(g.x,g.y))return;const _=a.canvas.getIndex(m.x,m.y),y=a.studio.isDitherBlendActive?g.weight+(1-g.weight)*(u/100):1;if(!st.orderedDither(m.x,m.y,y)||a.studio.isAirbrushActive&&Math.random()>a.studio.airbrushDensity||a.selection.isActive&&!a.selection.activeIndicesSet.has(_)||a.studio.isAlphaLocked&&!a.project.activeFrame.activeLayer.hasPixel(_)||a.studio.isColorLocked&&a.studio.colorLockSource!==null&&l[_]!==ue.hexToUint32(a.studio.colorLockSource))return;const w=this.getEffectColorForPoint(m.x,m.y,l[_]),C=l[_];C!==w&&(o.push({index:_,oldColor:ue.uint32ToHex(C),newColor:ue.uint32ToHex(w)}),l[_]=w)})})}o.length>0&&(a.canvas.pixels=l,a.canvas.triggerPulse(),he.push(o),ze.current.type==="ERASE"?se.playErase():se.playDraw())}erase(e,t){const r=e!==void 0?Math.floor(e):a.cursor.pos.x,s=t!==void 0?Math.floor(t):a.cursor.pos.y,l=Sa.getKernel(a.studio.brushSize,a.studio.brushShape).map(p=>({x:r+p.x,y:s+p.y}));if(a.studio.symmetryMode!=="OFF"){const p=a.studio.symmetryMode,{width:x,height:b}=a.canvas,g=[];l.forEach(m=>{const _=st.getSymmetryPoints(m.x,m.y,x,b,p);g.push(..._)}),l.push(...g)}const n=a.studio.isTilingEnabled?l.map(p=>st.wrap(p.x,p.y,a.canvas.width,a.canvas.height)):l.filter(p=>a.canvas.isValidCoord(p.x,p.y)),u=[],v=new Uint32Array(a.canvas.pixels);n.forEach(p=>{const x=a.canvas.getIndex(p.x,p.y);if(a.selection.isActive&&!a.selection.activeIndicesSet.has(x)||a.studio.isAlphaLocked&&!a.project.activeFrame.activeLayer.hasPixel(x))return;const b=v[x];b!==0&&(u.push({index:x,oldColor:ue.uint32ToHex(b),newColor:null}),v[x]=0)}),u.length>0&&(a.canvas.pixels=v,a.canvas.triggerPulse(),he.push(u),se.playErase())}getEffectColorForPoint(e,t,r){if(ze.current.type==="ERASE")return 0;const s=a.paletteState.activeColor,o=ue.hexToUint32(s);if(a.studio.isShadingDither)return(e+t)%2===0?o:0;if(r===0)return o;if(a.studio.isShadingLighten){const l=ue.uint32ToHex(r);return ue.hexToUint32(ue.adjustBrightness(l,.1))}if(a.studio.isShadingDarken){const l=ue.uint32ToHex(r);return ue.hexToUint32(ue.adjustBrightness(l,-.1))}return o}beginStroke(e,t){a.canvas.clearBuffer(),a.canvas.addToBuffer(e,t)}continueStroke(e,t,r,s){const o=Je.getLinePoints(r,s,e,t,0);if(a.studio.isPixelPerfect){const l=[...a.canvas.strokePoints,...o],n=st.pixelPerfectFilter(l);a.canvas.clearBuffer(),a.canvas.addBatchToBuffer(n)}else a.canvas.addBatchToBuffer(o)}endStroke(){this.commitBuffer()}cancelStroke(){a.canvas.clearBuffer(),se.playErase()}snapCurrentStroke(){const e=a.canvas.strokePoints;if(e.length<5)return;const t=a.studio.stabilization,r=Xa.smooth(e,t/10),s=.05+t/100*.35,o=Je.fitArc(r,s);a.canvas.clearBuffer();let l=[],n=[];if(o&&o.isFull)n=o.points,l=Je.getCirclePoints(o.cx,o.cy,o.r);else{const u=Xa.simplify(r,t/100*2);if(u.length===2){let v={...u[0]},p={...u[u.length-1]};const x=Math.abs(p.x-v.x),b=Math.abs(p.y-v.y),g=3;if(x<g)p.x=v.x;else if(b<g)p.y=v.y;else if(Math.abs(x-b)<g){const m=Math.max(x,b);p.x=v.x+m*Math.sign(p.x-v.x),p.y=v.y+m*Math.sign(p.y-v.y)}n=[v,p],l=Je.getLinePoints(v.x,v.y,p.x,p.y,0)}else if(o){n=o.points;for(let v=0;v<n.length-1;v++)l.push(...Je.getLinePoints(n[v].x,n[v].y,n[v+1].x,n[v+1].y,t/100))}else{n=u;for(let v=0;v<n.length-1;v++)l.push(...Je.getLinePoints(n[v].x,n[v].y,n[v+1].x,n[v+1].y,t/100))}}a.canvas.addBatchToBuffer(l),a.canvas.strokePoints=n,se.playDraw()}commitBuffer(){const e=a.canvas.pixelBuffer;if(e.length===0){a.canvas.clearBuffer();return}const t=[],r=new Uint32Array(a.canvas.pixels);if(a.studio.isPatternBrushActive&&a.studio.patternBrushData){const s=a.studio.patternBrushData,o=Math.floor(s.width/2),l=Math.floor(s.height/2);e.forEach(n=>{const u=n%a.canvas.width,v=Math.floor(n/a.canvas.width);for(let p=0;p<s.height;p++)for(let x=0;x<s.width;x++){const b=u+x-o,g=v+p-l;if(a.canvas.isValidCoord(b,g)){const m=p*s.width+x,_=s.data[m];if(_===0)continue;const y=a.canvas.getIndex(b,g);if(a.selection.isActive&&!a.selection.activeIndicesSet.has(y)||a.studio.isAlphaLocked&&!a.project.activeFrame.activeLayer.hasPixel(y))continue;const C=ze.current.type==="ERASE"?0:_,R=r[y];R!==C&&(t.push({index:y,oldColor:ue.uint32ToHex(R),newColor:ue.uint32ToHex(C)}),r[y]=C)}}})}else{const s=Sa.getKernel(a.studio.brushSize,a.studio.brushShape),o=a.studio.brushHardness;e.forEach(l=>{const n=l%a.canvas.width,u=Math.floor(l/a.canvas.width);s.forEach(v=>{const p=n+v.x,x=u+v.y,b=[{x:p,y:x,weight:v.weight}];a.studio.symmetryMode!=="OFF"&&st.getSymmetryPoints(p,x,a.canvas.width,a.canvas.height,a.studio.symmetryMode).forEach(m=>b.push({...m,weight:v.weight})),b.forEach(g=>{let m=g;if(a.studio.isTilingEnabled)m={...st.wrap(g.x,g.y,a.canvas.width,a.canvas.height),weight:g.weight};else if(!a.canvas.isValidCoord(g.x,g.y))return;const _=a.canvas.getIndex(m.x,m.y),y=a.studio.isDitherBlendActive?g.weight+(1-g.weight)*(o/100):1;if(!st.orderedDither(m.x,m.y,y)||a.selection.isActive&&!a.selection.activeIndicesSet.has(_)||a.studio.isAlphaLocked&&!a.project.activeFrame.activeLayer.hasPixel(_))return;const w=this.getEffectColorForPoint(m.x,m.y,r[_]),C=r[_];C!==w&&(t.push({index:_,oldColor:ue.uint32ToHex(C),newColor:ue.uint32ToHex(w)}),r[_]=w)})})})}t.length>0&&(a.canvas.pixels=r,a.canvas.triggerPulse(),he.push(t),ze.current.type==="ERASE"?se.playErase():se.playDraw()),a.canvas.clearBuffer()}commitShape(){const e=a.studio.shapeAnchor;if(!e)return;const{x:t,y:r}=a.cursor.pos,s=a.studio.activeTool;let o=[];if(s==="RECTANGLE"?o=st.getRectanglePoints(e.x,e.y,t,r):s==="ELLIPSE"?o=st.getEllipsePoints(e.x,e.y,t,r):s==="POLYGON"&&(o=st.getPolygonPoints(e.x,e.y,t,r,a.studio.polygonSides,a.studio.polygonIndentation)),o.length>0){const l=a.paletteState.activeColor,n=ue.hexToUint32(l),u=[],v=new Uint32Array(a.canvas.pixels);o.forEach(p=>{if(a.canvas.isValidCoord(p.x,p.y)){const x=a.canvas.getIndex(p.x,p.y),b=v[x];b!==n&&(u.push({index:x,oldColor:ue.uint32ToHex(b),newColor:l}),v[x]=n)}}),u.length>0&&(a.canvas.pixels=v,a.canvas.triggerPulse(),he.push(u),se.playDraw())}a.studio.activeTool="BRUSH",a.studio.shapeAnchor=null}}class Ks{resize(e,t){const r=new Uint32Array(e*t),s=ue.hexToUint32(a.backgroundColor);r.fill(s);for(let o=0;o<Math.min(a.canvas.height,t);o++)for(let l=0;l<Math.min(a.canvas.width,e);l++){const n=o*a.canvas.width+l,u=o*e+l;r[u]=a.canvas.pixels[n]}a.canvas.reset(e,t,r),he.clear(),se.playDraw()}flip(e){const{width:t,height:r}=a.canvas,s=a.project.activeFrame;he.beginBatch(),s.layers.forEach(o=>{if(o.type!=="LAYER")return;const l=o.pixels,n=new Uint32Array(l.length);if(e==="horizontal")for(let u=0;u<r;u++){const v=u*t,p=l.subarray(v,v+t),x=new Uint32Array(p).reverse();n.set(x,v)}else for(let u=0;u<r;u++){const v=u*t,p=(r-1-u)*t;n.set(l.subarray(v,v+t),p)}o.pixels=n}),a.canvas.triggerPulse(),he.endBatch(),a.studio.show(e==="horizontal"?"Flipped Horizontally":"Flipped Vertically"),se.playDraw()}rotate(){const{width:e,height:t}=a.canvas;if(e!==t){a.studio.show("Only square cups can be rotated");return}const r=a.project.activeFrame;he.beginBatch(),r.layers.forEach(s=>{if(s.type!=="LAYER")return;const o=s.pixels,l=new Uint32Array(e*t);for(let n=0;n<t;n++)for(let u=0;u<e;u++){const v=n*e+u,p=u*e+(t-1-n);l[p]=o[v]}s.pixels=l}),a.canvas.triggerPulse(),he.endBatch(),a.studio.show("Rotated 90°"),se.playDraw()}clearAll(){confirm("Are you sure you want to clear the entire canvas?")&&(a.canvas.clear(),he.clear(),a.studio.show("Foam Cleared"),se.playErase())}bleach(){const{x:e,y:t}=a.cursor.pos,r=a.canvas.getColor(e,t),s=ue.hexToUint32(a.activeColor);if(r===s)return;const{pixels:o}=a.canvas,l=[],n=a.selection.isActive,u=a.selection.activeIndicesSet,v=new Uint32Array(o);o.forEach((p,x)=>{const b=p===r,g=!n||u.has(x);b&&g&&(l.push({index:x,oldColor:ue.uint32ToHex(r),newColor:ue.uint32ToHex(s)}),v[x]=s)}),l.length>0&&(a.canvas.pixels=v,a.canvas.triggerPulse(),he.beginBatch(),l.forEach(p=>he.push(p)),he.endBatch(),se.playDraw())}}class qs{copy(){const e=a.canvas.width,t=a.selection.getPoints(e),r=a.selection.getEffectiveBounds(e);if(!r||t.length===0)return;const s=new Uint32Array(r.width*r.height),o=a.canvas.compositePixels;t.forEach(l=>{const n=l.y*e+l.x,u=l.x-r.x1,p=(l.y-r.y1)*r.width+u;s[p]=o[n]}),a.project.clipboard={width:r.width,height:r.height,data:s},se.playDraw()}cut(){this.copy();const e=a.canvas.width,t=a.selection.getPoints(e);if(t.length===0)return;he.beginBatch();const r=new Uint32Array(a.canvas.pixels);t.forEach(s=>{const o=s.y*e+s.x,l=r[o];he.push({index:o,oldColor:ue.uint32ToHex(l),newColor:null}),r[o]=0}),a.canvas.pixels=r,a.canvas.triggerPulse(),he.endBatch(),se.playErase(),a.selection.clear()}paste(){const e=a.project.clipboard;if(!e)return;const{x:t,y:r}=a.cursor.pos,{width:s,height:o}=a.canvas;he.beginBatch();const l=new Uint32Array(a.canvas.pixels);let n=!1;for(let u=0;u<e.height;u++)for(let v=0;v<e.width;v++){const p=t+v,x=r+u;if(p>=0&&p<s&&x>=0&&x<o){const b=u*e.width+v,g=e.data[b];if(g!==0){const m=x*s+p,_=l[m];he.push({index:m,oldColor:ue.uint32ToHex(_),newColor:ue.uint32ToHex(g)}),l[m]=g,n=!0}}}n&&(a.canvas.pixels=l,a.canvas.triggerPulse(),se.playDraw()),he.endBatch()}}class Qs{serialize(){return JSON.stringify({version:a.version,metadata:{name:"Untitled Project",lastModified:new Date().toISOString()},palette:a.paletteState.swatches,presets:a.paletteState.presets,project:{frames:a.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,layers:e.layers.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,type:t.type,parentId:t.parentId,isCollapsed:t.isCollapsed,pixels:Array.from(t.pixels)}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,a.project.currentFilePath||void 0);t&&(a.project.setMetadata(t),se.playDraw())}webDownload(e){const t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download="rupa-project.rupa",s.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),a.project.setMetadata(e.filePath),se.playDraw())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const r=t.target.files?.[0];if(r){const s=new FileReader;s.onload=o=>this.deserialize(o.target?.result),s.readAsText(r)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),a.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}autoSaveSession(){try{const e=this.serialize();localStorage.setItem("rupa_autosave_session",e),a.project.lastSaved=new Date,console.log("Session autosaved.")}catch(e){console.warn("Autosave failed (likely quota exceeded):",e)}}restoreLastSession(){const e=localStorage.getItem("rupa_autosave_session");return e?(this.deserialize(e),!0):!1}saveGlobalPalettes(){try{const e=JSON.stringify(a.paletteState.presets);localStorage.setItem("rupa_palette_library",e)}catch(e){console.warn("Failed to save global palettes:",e)}}loadGlobalPalettes(){try{const e=localStorage.getItem("rupa_palette_library");if(e){const t=JSON.parse(e),r=a.paletteState.presets.filter(o=>o.isDefault),s=t.filter(o=>!o.isDefault);a.paletteState.presets=[...r,...s]}}catch(e){console.warn("Failed to load global palettes:",e)}}deserialize(e){try{const t=JSON.parse(e);t.palette&&(a.paletteState.swatches=t.palette),t.presets&&(a.paletteState.presets=t.presets);const r=t.project||t.folio;if(r)a.project.frames=r.frames.map(s=>{const o=new ga(s.name,s.width,s.height),l=s.layers||s.veils||[];return o.layers=l.map(n=>{const u=new ra(n.name,s.width,s.height,n.type||"LAYER");u.isVisible=n.isVisible,u.isLocked=n.isLocked,u.parentId=n.parentId||null,u.isCollapsed=n.isCollapsed||!1;const v=n.pixels||n.stitches||[];if(u.type==="LAYER")if(v.length>0&&typeof v[0]=="string"){const p=new Uint32Array(v.length);for(let x=0;x<v.length;x++)p[x]=ue.hexToUint32(v[x]);u.pixels=p}else u.pixels=new Uint32Array(v);return u}),o});else if(t.pixelData){const s=new ga("Restored Project",t.dimensions.width,t.dimensions.height),o=new Uint32Array(t.pixelData.length);for(let l=0;l<t.pixelData.length;l++)o[l]=ue.hexToUint32(t.pixelData[l]);s.layers[0].pixels=o,a.project.frames=[s]}a.project.activeFrameIndex=0,a.canvas.triggerPulse(),he.clear()}catch(t){console.error("Failed to restore project:",t)}}}class Xs{addFrame(e){const t=a.project,r=t.activeFrameIndex,s=t.addFrame(e),o=t.activeFrameIndex;return he.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(o,1),t.activeFrameIndex=r},redo:()=>{t.frames.splice(o,0,s),t.activeFrameIndex=o}}),se.playDraw(),s}removeFrame(e){const t=a.project;if(t.frames.length<=1)return;const r=t.frames[e],s=t.activeFrameIndex;t.removeFrame(e);const o=t.activeFrameIndex;he.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,r),t.activeFrameIndex=s},redo:()=>{t.removeFrame(e),t.activeFrameIndex=o}}),se.playErase()}duplicateFrame(e){const t=a.project,r=t.frames[e],s=t.activeFrameIndex,o=t.addFrame(`${r.name} (Copy)`),l=t.activeFrameIndex;o.width=r.width,o.height=r.height,o.layers=r.layers.map(n=>n.clone(r.width,r.height)),he.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(l,1),t.activeFrameIndex=s},redo:()=>{t.frames.splice(l,0,o),t.activeFrameIndex=l}}),se.playDraw()}nextFrame(){const e=a.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,he.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),se.playMove()}prevFrame(){const e=a.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,he.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),se.playMove()}addLayer(e){const t=a.project.activeFrame,r=t.activeLayerIndex,s=t.addLayer(e),o=t.activeLayerIndex;return he.push({isStructural:!0,label:"Add Layer",undo:()=>{t.layers.splice(o,1),t.activeLayerIndex=r},redo:()=>{t.layers.splice(o,0,s),t.activeLayerIndex=o}}),se.playDraw(),s}addGroup(e){const t=a.project.activeFrame,r=t.activeLayerIndex,s=t.addGroup(e),o=t.activeLayerIndex;return he.push({isStructural:!0,label:"Add Group",undo:()=>{t.layers.splice(o,1),t.activeLayerIndex=r},redo:()=>{t.layers.splice(o,0,s),t.activeLayerIndex=o}}),se.playDraw(),s}removeLayer(e){const t=a.project.activeFrame;if(t.layers.length<=1)return;const r=t.layers[e],s=t.activeLayerIndex;t.removeLayer(e);const o=t.activeLayerIndex;he.push({isStructural:!0,label:"Remove Layer",undo:()=>{t.layers.splice(e,0,r),t.activeLayerIndex=s},redo:()=>{t.removeLayer(e),t.activeLayerIndex=o}}),se.playErase()}duplicateLayer(e){const t=a.project.activeFrame,r=t.layers[e],s=t.activeLayerIndex,o=r.clone(t.width,t.height);o.name=`${r.name} (Copy)`;const l=e+1;t.layers.splice(l,0,o),t.activeLayerIndex=l,he.push({isStructural:!0,label:"Duplicate Layer",undo:()=>{t.layers.splice(l,1),t.activeLayerIndex=s},redo:()=>{t.layers.splice(l,0,o),t.activeLayerIndex=l}}),se.playDraw()}nextLayer(){const e=a.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex+1)%e.layers.length,he.push({isStructural:!0,label:"Next Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t+1)%e.layers.length}),se.playMove()}prevLayer(){const e=a.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex-1+e.layers.length)%e.layers.length,he.push({isStructural:!0,label:"Prev Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t-1+e.layers.length)%e.layers.length}),se.playMove()}toggleLock(e){const t=e!==void 0?a.project.activeFrame.layers[e]:a.project.activeFrame.activeLayer;t&&(t.isLocked=!t.isLocked,se.playDraw())}toggleVisibility(e){const t=e!==void 0?a.project.activeFrame.layers[e]:a.project.activeFrame.activeLayer;t&&(t.isVisible=!t.isVisible,se.playDraw())}toggleFrameVisibility(e){const t=a.project,r=e!==void 0?e:t.activeFrameIndex,s=t.frames[r];s&&(s.isVisible=!s.isVisible,se.playDraw(),he.push({isStructural:!0,label:"Toggle Frame Visibility",undo:()=>s.isVisible=!s.isVisible,redo:()=>s.isVisible=!s.isVisible}))}reorderLayer(e,t){const r=a.project.activeFrame;if(e===t||t<0||t>=r.layers.length)return;const s=r.activeLayerIndex;((n,u)=>{const[v]=r.layers.splice(n,1);r.layers.splice(u,0,v),r.activeLayerIndex===n?r.activeLayerIndex=u:n<r.activeLayerIndex&&u>=r.activeLayerIndex?r.activeLayerIndex--:n>r.activeLayerIndex&&u<=r.activeLayerIndex&&r.activeLayerIndex++})(e,t);const l=r.activeLayerIndex;he.push({isStructural:!0,label:"Reorder Layer",undo:()=>{const[n]=r.layers.splice(t,1);r.layers.splice(e,0,n),r.activeLayerIndex=s},redo:()=>{const[n]=r.layers.splice(e,1);r.layers.splice(t,0,n),r.activeLayerIndex=l}}),se.playMove()}reorderFrame(e,t){const r=a.project;if(e===t||t<0||t>=r.frames.length)return;const s=r.activeFrameIndex;((n,u)=>{const[v]=r.frames.splice(n,1);r.frames.splice(u,0,v),r.activeFrameIndex===n?r.activeFrameIndex=u:n<r.activeFrameIndex&&u>=r.activeFrameIndex?r.activeFrameIndex--:n>r.activeFrameIndex&&u<=r.activeFrameIndex&&r.activeFrameIndex++})(e,t);const l=r.activeFrameIndex;he.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[n]=r.frames.splice(t,1);r.frames.splice(e,0,n),r.activeFrameIndex=s},redo:()=>{const[n]=r.frames.splice(e,1);r.frames.splice(t,0,n),r.activeFrameIndex=l}}),se.playMove()}moveLayerUp(){const e=a.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,t+1)}moveLayerDown(){const t=a.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,t-1)}moveLayerToTop(){const e=a.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,e.layers.length-1)}moveLayerToBottom(){const t=a.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,0)}mergeLayerDown(){const e=a.project.activeFrame,t=e.activeLayerIndex;if(t<=0)return;const r=t-1,s=e.layers[t],o=e.layers[r],l=new Uint32Array(o.pixels),n=s.pixels,u=new Uint32Array(o.pixels);for(let v=0;v<n.length;v++){const p=n[v];p!==0&&(u[v]=p)}o.pixels=u,e.layers.splice(t,1),e.activeLayerIndex=r,a.canvas.triggerPulse(),he.push({isStructural:!0,label:"Merge Layer",undo:()=>{o.pixels=l,e.layers.splice(t,0,s),e.activeLayerIndex=t,a.canvas.triggerPulse()},redo:()=>{o.pixels=u,e.layers.splice(t,1),e.activeLayerIndex=r,a.canvas.triggerPulse()}}),se.playDraw()}addTag(e,t,r,s="#d33682"){const o={id:crypto.randomUUID(),name:e,color:s,from:t,to:r};return a.project.tags.push(o),se.playDraw(),o}removeTag(e){a.project.tags=a.project.tags.filter(t=>t.id!==e),se.playErase()}}class Ws{begin(e,t){a.selection.begin(e,t)}update(e,t){a.selection.isActive&&a.selection.update(e,t)}clear(){a.selection.clear()}fillSelection(){const e=a.selection.getPoints(a.canvas.width);if(e.length===0)return;const t=a.paletteState.activeColor,r=ue.hexToUint32(t),s=a.canvas.width;he.beginBatch();let o=!1;const l=new Uint32Array(a.canvas.pixels);e.forEach(n=>{const u=n.y*s+n.x,v=l[u];v!==r&&(he.push({index:u,oldColor:ue.uint32ToHex(v),newColor:t}),l[u]=r,o=!0)}),o&&(a.canvas.pixels=l,a.canvas.triggerPulse(),se.playDraw()),he.endBatch()}commit(){a.canvas.triggerPulse()}spiritPick(){const{x:e,y:t}=a.cursor.pos;a.canvas.getColor(e,t);const{width:r,height:s,pixels:o}=a.canvas,l=4294967295,n=st.floodFill(Array.from(o),r,s,e,t,l),u=[];for(let v=0;v<n.length;v++)n[v]===l&&u.push(v);a.selection.clear(),u.length>0&&(a.selection.indices=u,a.canvas.triggerPulse(),se.playScale(4))}addVertex(e,t){a.selection.vertices.push({x:e,y:t}),se.playDraw()}sealBinding(){const e=a.selection.vertices;if(e.length<3)return;const t=a.canvas.width,r=a.canvas.height,s=[];for(let o=0;o<r;o++)for(let l=0;l<t;l++)this.isPointInPoly(l,o,e)&&s.push(o*t+l);s.length>0&&(a.selection.indices=s,a.selection.vertices=[],se.playScale(6))}isPointInPoly(e,t,r){let s=!1;for(let o=0,l=r.length-1;o<r.length;l=o++){const n=r[o].x,u=r[o].y,v=r[l].x,p=r[l].y;u>t!=p>t&&e<(v-n)*(t-u)/(p-u)+n&&(s=!s)}return s}nudge(e,t){if(a.selection.indices.length===0)return;const r=a.canvas.width,s=a.canvas.height,o=new Uint32Array(a.canvas.pixels),l=new Map;a.selection.indices.forEach(u=>{l.set(u,o[u]),o[u]=0});const n=[];l.forEach((u,v)=>{const p=v%r,x=Math.floor(v/r),b=p+e,g=x+t;if(b>=0&&b<r&&g>=0&&g<s){const m=g*r+b;o[m]=u,n.push(m)}}),a.canvas.pixels=o,a.canvas.triggerPulse(),a.selection.indices=n,se.playMove()}propagate(e,t,r){if(a.selection.indices.length===0)return;const s=a.project,o=s.activeFrameIndex,l=s.activeFrame.activeLayerIndex,n=a.canvas.width,u=a.canvas.height,v=s.activeFrame.activeLayer,p=[];a.selection.indices.forEach(m=>{p.push({x:m%n,y:Math.floor(m/n),val:v.pixels[m]})});const x=new Map,b=new Map;for(let m=1;m<=e;m++){const _=o+m;if(_>=s.frames.length)break;const y=s.frames[_].layers[l];if(!y||y.isLocked)continue;x.set(_,new Uint32Array(y.pixels));const w=new Uint32Array(y.pixels),C=t*m,R=r*m;p.forEach(F=>{const B=F.x+C,U=F.y+R;B>=0&&B<n&&U>=0&&U<u&&(w[U*n+B]=F.val)}),b.set(_,w)}const g=m=>{m.forEach((_,y)=>{const w=s.frames[y].layers[l];w&&(w.pixels=_)}),a.canvas.triggerPulse()};g(b),he.push({isStructural:!0,label:"Syrup Flow",undo:()=>g(x),redo:()=>g(b)}),se.playDraw(),a.studio.show(`Poured across ${b.size} cups`)}}class Zs{select(e){a.paletteState.select(e),se.playScale(e)}setColor(e){a.paletteState.setColor(e),se.playDraw()}pickFromCanvas(){const{x:e,y:t}=a.cursor.pos,r=a.canvas.getColor(e,t),s=ue.uint32ToHex(r);s!==null&&(this.setColor(s),a.studio.isPicking=!0,setTimeout(()=>{a.studio.isPicking=!1},1500))}weatherPalette(e){a.paletteState.swatches=a.paletteState.swatches.map(t=>ue.adjustBrightness(t,e)),se.playDraw()}mixActiveColor(e,t=.5){const r=ue.mix(a.activeColor,e,t);this.setColor(r)}floodFill(){const{x:e,y:t}=a.cursor.pos,r=a.canvas.getColor(e,t),s=a.activeColor,o=ue.hexToUint32(s);if(r===o)return;const{width:l,height:n,pixels:u}=a.canvas,v=st.floodFill(Array.from(u),l,n,e,t,o),p=new Uint32Array(v),x=[],b=a.selection.isActive,g=a.selection.activeIndicesSet;for(let m=0;m<p.length;m++)if(p[m]!==u[m]){if(b&&!g.has(m)){p[m]=u[m];continue}x.push({index:m,oldColor:ue.uint32ToHex(u[m]),newColor:s})}x.length>0&&(a.canvas.pixels=p,a.canvas.triggerPulse(),he.beginBatch(),x.forEach(m=>he.push(m)),he.endBatch(),se.playDraw())}}class Js{_movement=null;_draw=null;_manipulation=null;_clipboard=null;_persistence=null;_project=null;_selection=null;_color=null;get movement(){return this._movement||(this._movement=new Is),this._movement}get draw(){return this._draw||(this._draw=new Ys),this._draw}get manipulation(){return this._manipulation||(this._manipulation=new Ks),this._manipulation}get clipboard(){return this._clipboard||(this._clipboard=new qs),this._clipboard}get persistence(){return this._persistence||(this._persistence=new Qs),this._persistence}get project(){return this._project||(this._project=new Xs),this._project}get selection(){return this._selection||(this._selection=new Ws),this._selection}get color(){return this._color||(this._color=new Zs),this._color}moveCursor(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}jumpHome(){this.movement.jumpHome()}paint(){this.draw.draw()}erase(){this.draw.erase()}pickColor(){this.color.pickFromCanvas()}startSelection(){this.selection.begin(a.cursor.pos.x,a.cursor.pos.y)}updateSelection(){this.selection.update(a.cursor.pos.x,a.cursor.pos.y)}commitSelection(){this.selection.fillSelection()}clearCanvas(){this.manipulation.clearAll()}resizeCanvas(e,t){this.manipulation.resize(e,t)}flipCanvas(e){this.manipulation.flip(e)}rotateCanvas(){this.manipulation.rotate()}mergeLayerDown(){this.project.mergeLayerDown()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),a.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async asyncCreateArtifact(e,t=10,r="transparent"){a.studio.show("Preparing Cup..."),a.studio.exportProgress=0;const{ExportEngine:s}=await Ha(async()=>{const{ExportEngine:g}=await import("./DJqvaw-w.js");return{ExportEngine:g}},__vite__mapDeps([0,1,2,3]),import.meta.url),{width:o,height:l}=a.canvas,n=a.studio.includePixelBorders,u=["webm","gif","mp4"].includes(e),v=g=>{a.studio.exportProgress=Math.round(g*100)};let p=[];if(u)p=a.project.frames.filter(g=>g.isVisible);else switch(a.studio.exportFrameSelection){case"ACTIVE":p=[a.project.activeFrame];break;case"VISIBLE":p=a.project.frames.filter(g=>g.isVisible);break;case"SELECTED":p=Array.from(a.project.selectedFrameIndices).sort((g,m)=>g-m).map(g=>a.project.frames[g]);break;case"ALL":p=a.project.frames;break;default:p=[a.project.activeFrame]}if(p.length===0){a.studio.show("No frames to export"),a.studio.exportProgress=0;return}const x=p.length<=1&&u?"png":e,b=1e3/a.project.fps;if(x==="svg")if(p.length>1){const g=p.map(w=>w.compositePixels),m=p.map(()=>b),_=await s.toAnimatedSVG(o,l,g,m,r,n,v),y=new Blob([_],{type:"image/svg+xml"});this.download(URL.createObjectURL(y),"rupa-image.svg")}else{const g=p[0],m=await s.toSVG(o,l,g.compositePixels,r,n,v),_=new Blob([m],{type:"image/svg+xml"});this.download(URL.createObjectURL(_),"rupa-image.svg")}else if(x==="webm"||x==="mp4"){const g=p.map(w=>w.compositePixels),m=p.map(()=>b),_=await s.toVideo(o,l,g,m,t,x,r,n,v),y=_.type.includes("mp4")?"mp4":"webm";this.download(URL.createObjectURL(_),`rupa-video.${y}`)}else if(x==="gif"){const g=p.map(y=>y.compositePixels),m=p.map(()=>b),_=await s.toGIF(o,l,g,m,t,r,n,v);this.download(URL.createObjectURL(_),"rupa-animation.gif")}else if(p.length>1){const g=(await Ha(async()=>{const{default:y}=await import("./D7KnG0-e.js").then(w=>w.j);return{default:y}},[],import.meta.url)).default,m=new g;for(let y=0;y<p.length;y++){const w=p[y],R=(await s.toRaster(o,l,w.compositePixels,t,x,r,n)).split(",")[1];m.file(`${w.name.toLowerCase().replace(/\s+/g,"-")}-${y}.${x}`,R,{base64:!0}),v((y+1)/p.length),await new Promise(F=>setTimeout(F,0))}const _=await m.generateAsync({type:"blob"});this.download(URL.createObjectURL(_),"rupa-export.zip")}else{const g=p[0],m=await s.toRaster(o,l,g.compositePixels,t,x,r,n);this.download(m,`rupa-image.${x}`),v(1)}a.studio.exportProgress=100,await new Promise(g=>setTimeout(g,300)),a.studio.showExportMenu=!1,a.studio.exportProgress=0}createArtifact(e,t=10,r="transparent"){return this.asyncCreateArtifact(e,t,r)}download(e,t){const r=document.createElement("a");r.href=e,r.download=t.toLowerCase().replace(/\s+/g,"-"),r.click()}}const H=new Js;class ei{#e=T("KEYBOARD");get activeSource(){return i(this.#e)}set activeSource(e){k(this.#e,e,!0)}listeners=[];constructor(){}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}emit(e,t,r){this.activeSource=t;const s={intent:e,source:t,meta:r};this.listeners.forEach(o=>o(s))}mount(e,t){const r=o=>{if(!a.isAppReady)return;const l=o.target;if((l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement||l.isContentEditable)&&o.key!=="Escape")return;it.updatePhysicalState(o,"down");const n=it.getIntent(o);n&&(o.preventDefault(),this.emit(n,"KEYBOARD"))},s=o=>{it.updatePhysicalState(o,"up")};if(t){const o=u=>{const v=u.pointerType==="pen"?"PEN":u.pointerType==="touch"?"TOUCH":"MOUSE";Ct.handleStart(u,t),this.activeSource=v},l=u=>{Ct.handleMove(u,t)},n=u=>{Ct.handleEnd()};t.addEventListener("pointerdown",o),e.addEventListener("pointermove",l),e.addEventListener("pointerup",n)}return e.addEventListener("keydown",r),e.addEventListener("keyup",s),()=>{e.removeEventListener("keydown",r),e.removeEventListener("keyup",s)}}}const Wa=new ei;class ti{isPlaying=!1;nextNoteTime=0;timer=null;get ctx(){return ja.ctx}scale=zt.ambient.scale;chords=zt.ambient.chords;currentChordIndex=0;toggle(){this.isPlaying?this.stop():this.start()}start(){this.isPlaying||(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||a.studio.isMuted||!a.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){const t=this.chords[this.currentChordIndex],s=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(s,e),this.pianoPluck(s*2,e,.08),Math.random()>.7&&this.pianoPluck(s*.5,e+.05,.1)}pianoPluck(e,t,r=.3){const{startMins:s,fullMins:o}=zt.ambient.fade,l=a.usageMinutes;let n=0;l>=s&&l<o?n=(l-s)/(o-s):l>=o&&(n=1);const u=r*n*a.bgmVolume;if(u<.001)return;const v=this.ctx.createOscillator(),p=this.ctx.createGain(),x=this.ctx.createBiquadFilter();v.type=Math.random()>.5?"sine":"triangle",v.frequency.setValueAtTime(e,t),x.type="lowpass",x.frequency.setValueAtTime(1200,t),x.frequency.exponentialRampToValueAtTime(400,t+1.5),p.gain.setValueAtTime(0,t),p.gain.linearRampToValueAtTime(u,t+.02),p.gain.exponentialRampToValueAtTime(1e-4,t+2.5),v.connect(x),x.connect(p),p.connect(this.ctx.destination),v.start(t),v.stop(t+2.6)}}const ai=new ti;class ri{#e=T(!0);get isEnabled(){return i(this.#e)}set isEnabled(e){k(this.#e,e,!0)}#t=T(!1);get screenShake(){return i(this.#t)}set screenShake(e){k(this.#t,e,!0)}#a=T(null);get flashColor(){return i(this.#a)}set flashColor(e){k(this.#a,e,!0)}emit(e){this.isEnabled&&(this.playAudio(e),this.triggerVisual(e),typeof navigator.vibrate=="function"&&this.triggerHaptic(e))}playAudio(e){switch(e){case"DRAW":se.playDraw();break;case"ERASE":se.playErase();break;case"MOVE":se.playMove();break;case"STARTUP":se.playStartup();break;case"READY":se.playReady();break}}triggerVisual(e){e==="CLEAR_CANVAS"&&(this.screenShake=!0,setTimeout(()=>this.screenShake=!1,200)),e==="READY"&&(this.flashColor="rgba(211, 54, 130, 0.1)",setTimeout(()=>this.flashColor=null,500))}triggerHaptic(e){e==="DRAW"&&navigator.vibrate(5),e==="ERASE"&&navigator.vibrate(10)}}const Ae=new ri;class si{backupInterval=null;autoSaveTimer=null;unsubscribeInput=null;mount(e=null){this.backupInterval=setInterval(()=>H.persistence.backup(),600*1e3),a.studio.mount(),a.canvas.mount(),ai.start(),H.persistence.restoreLastSession(),H.persistence.loadGlobalPalettes(),this.unsubscribeInput=Wa.subscribe(r=>{this.handleIntent(r.intent)});const t=Wa.mount(window,e);return()=>{this.unsubscribeInput&&this.unsubscribeInput(),t(),clearInterval(this.backupInterval),this.autoSaveTimer&&clearTimeout(this.autoSaveTimer)}}handleIntent(e){if(ja.resume(),a.cursor.resetInactivityTimer(),this.resetAutoSaveTimer(),it.isCtrlActive&&it.isAltActive&&["MOVE_UP","MOVE_DOWN","MOVE_LEFT","MOVE_RIGHT"].includes(e)){const t=e==="MOVE_LEFT"?-1:e==="MOVE_RIGHT"?1:0,r=e==="MOVE_UP"?-1:e==="MOVE_DOWN"?1:0;a.studio.underlayOffset.x+=t,a.studio.underlayOffset.y+=r;return}switch(e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"JUMP_HOME":return H.jumpHome();case"GOTO":return a.showGoTo=!0;case"RESET_PAN":return a.studio.resetPan(),Ae.emit("READY");case"PAINT":if(a.selection.isActive)return H.commitSelection();if(a.studio.activeTool!=="BRUSH"){H.draw.commitShape();return}return H.draw.draw();case"ERASE":return H.draw.erase();case"FLOOD_FILL":return H.color.floodFill();case"BIND_VERTEX":return H.selection.addVertex(a.cursor.pos.x,a.cursor.pos.y);case"SEAL_BINDING":if(a.selection.vertices.length>=3)return H.selection.sealBinding();if(a.selection.isActive)return H.commitSelection();if(a.studio.activeTool!=="BRUSH"){H.draw.commitShape();return}return H.draw.draw();case"PICK_COLOR":return H.color.pickFromCanvas();case"COPY":return H.clipboard.copy();case"CUT":return H.clipboard.cut();case"PASTE":return H.clipboard.paste();case"RECOLOR":return H.manipulation.bleach();case"UNDO":return a.undo();case"REDO":return a.redo();case"SAVE":return a.showPersistenceMenu=!0;case"OPEN":return H.persistence.load();case"OPEN_MENU":return a.showCommandPalette=!a.showCommandPalette;case"OPEN_SETTINGS":return a.showCanvasSettings=!a.showCanvasSettings;case"ESCAPE":return a.handleEscape();case"OPEN_PALETTE":return a.showColorPicker=!a.showColorPicker;case"OPEN_AUDIO":return a.showAudioSettings=!a.showAudioSettings;case"OPEN_EXPORT":return a.showExportMenu=!0;case"OPEN_HELP":return a.showGuideMenu=!0;case"OPEN_MANUAL":return a.showGuideBook=!0;case"PLAY_PAUSE":return Fa.togglePlayback();case"TOGGLE_GHOST_LAYERS":return a.showGhostLayers=!a.showGhostLayers;case"ZOOM_IN":return a.studio.setZoom(.1);case"ZOOM_OUT":return a.studio.setZoom(-.1);case"RESET_ZOOM":return a.studio.resetZoom();case"RESET_VIEWPORT":return a.studio.resetZoom(),a.studio.resetPan(),Ae.emit("READY");case"CLEAR_CANVAS":return H.manipulation.clearAll();case"TOGGLE_MUTE":return a.studio.toggleMute();case"TOGGLE_MINIMAP":return a.studio.showMinimap=!a.studio.showMinimap,Ae.emit("READY");case"SELECT_SAME":return H.selection.spiritPick();case"FLIP_H":return H.manipulation.flip("horizontal");case"FLIP_V":return H.manipulation.flip("vertical");case"ROTATE":return H.manipulation.rotate();case"TAB_TIMELINE":return a.studio.projectActiveTab="frames",Ae.emit("READY");case"TAB_LAYERS":return a.studio.projectActiveTab="layers",Ae.emit("READY");case"NEW_ITEM":return a.studio.projectActiveTab==="frames"?H.project.addFrame():H.project.addLayer();case"NEW_LAYER_GROUP":return H.project.addGroup();case"DUPLICATE_ITEM":return a.studio.projectActiveTab==="frames"?H.project.duplicateFrame(a.project.activeFrameIndex):H.project.duplicateLayer(a.project.activeFrame.activeLayerIndex);case"DELETE_ITEM":return a.studio.projectActiveTab==="frames"?H.project.removeFrame(a.project.activeFrameIndex):H.project.removeLayer(a.project.activeFrame.activeLayerIndex);case"TOGGLE_LAYER_LOCK":return H.project.toggleLock();case"TOGGLE_LAYER_VISIBILITY":return H.project.toggleVisibility();case"MOVE_ITEM_UP":if(a.studio.projectActiveTab==="frames"){const s=a.project.activeFrameIndex;s<a.project.frames.length-1&&H.project.reorderFrame(s,s+1)}else H.project.moveLayerUp();return;case"MOVE_ITEM_DOWN":if(a.studio.projectActiveTab==="frames"){const s=a.project.activeFrameIndex;s>0&&H.project.reorderFrame(s,s-1)}else H.project.moveLayerDown();return;case"MOVE_ITEM_TOP":a.studio.projectActiveTab==="frames"?H.project.reorderFrame(a.project.activeFrameIndex,a.project.frames.length-1):H.project.moveLayerToTop();return;case"MOVE_ITEM_BOTTOM":a.studio.projectActiveTab==="frames"?H.project.reorderFrame(a.project.activeFrameIndex,0):H.project.moveLayerToBottom();return;case"MERGE_LAYERS":return H.project.mergeLayerDown();case"BRUSH_SIZE_INC":return a.studio.brushSize=Math.min(100,a.studio.brushSize+1),Ae.emit("READY");case"BRUSH_SIZE_DEC":return a.studio.brushSize=Math.max(1,a.studio.brushSize-1),Ae.emit("READY");case"TOGGLE_PATTERN_BRUSH":if(a.studio.isPatternBrushActive)a.studio.isPatternBrushActive=!1;else if(a.project.clipboard){const s=a.project.clipboard,o=new Uint32Array(s.data.length);for(let l=0;l<s.data.length;l++)o[l]=s.data[l];a.studio.patternBrushData={width:s.width,height:s.height,data:o},a.studio.isPatternBrushActive=!0}return Ae.emit("READY");case"TOGGLE_BRUSH_SHAPE":return a.studio.brushShape=a.studio.brushShape==="SQUARE"?"CIRCLE":"SQUARE",Ae.emit("READY");case"TOGGLE_HAND_TOOL":return a.studio.isHandToolActive=!a.studio.isHandToolActive,Ae.emit("READY");case"CYCLE_SYMMETRY":const t=["OFF","HORIZONTAL","VERTICAL","QUADRANT"],r=t.indexOf(a.studio.symmetryMode);return a.studio.symmetryMode=t[(r+1)%t.length],Ae.emit("READY");case"TOGGLE_TILING":return a.studio.isTilingEnabled=!a.studio.isTilingEnabled,Ae.emit("READY");case"TOGGLE_AIRBRUSH":return a.studio.isAirbrushActive=!a.studio.isAirbrushActive,a.studio.show(a.studio.isAirbrushActive?"Mist Active":"Mist Off"),Ae.emit("READY");case"TOGGLE_ALPHA_LOCK":return a.studio.isAlphaLocked=!a.studio.isAlphaLocked,Ae.emit("READY");case"TOGGLE_PIXEL_PERFECT":return a.studio.isPixelPerfect=!a.studio.isPixelPerfect,Ae.emit("READY");case"TOGGLE_SHADE_LIGHTEN":return a.studio.isShadingLighten=!a.studio.isShadingLighten,a.studio.isShadingLighten&&(a.studio.isShadingDarken=!1,a.studio.isShadingDither=!1),a.studio.show(a.studio.isShadingLighten?"Light Roast Active":"Light Roast Off"),Ae.emit("READY");case"TOGGLE_SHADE_DARKEN":return a.studio.isShadingDarken=!a.studio.isShadingDarken,a.studio.isShadingDarken&&(a.studio.isShadingLighten=!1,a.studio.isShadingDither=!1),a.studio.show(a.studio.isShadingDarken?"Dark Roast Active":"Dark Roast Off"),Ae.emit("READY");case"TOGGLE_SHADE_DITHER":return a.studio.isShadingDither=!a.studio.isShadingDither,a.studio.isShadingDither&&(a.studio.isShadingLighten=!1,a.studio.isShadingDarken=!1),a.studio.show(a.studio.isShadingDither?"Texture Active":"Texture Off"),Ae.emit("READY");case"SHADE_LIGHTEN":return a.studio.isShadingLighten=!a.studio.isShadingLighten,a.studio.isShadingLighten&&(a.studio.isShadingDarken=!1,a.studio.isShadingDither=!1),a.studio.show(a.studio.isShadingLighten?"Light Roast Active":"Light Roast Off"),Ae.emit("READY");case"SHADE_DARKEN":return a.studio.isShadingDarken=!a.studio.isShadingDarken,a.studio.isShadingDarken&&(a.studio.isShadingLighten=!1,a.studio.isShadingDither=!1),a.studio.show(a.studio.isShadingDarken?"Dark Roast Active":"Dark Roast Off"),Ae.emit("READY");case"SHADE_DITHER":return a.studio.isShadingDither=!a.studio.isShadingDither,a.studio.isShadingDither&&(a.studio.isShadingLighten=!1,a.studio.isShadingDarken=!1),a.studio.show(a.studio.isShadingDither?"Texture Active":"Texture Off"),Ae.emit("READY");case"TOGGLE_COLOR_LOCK":if(a.studio.isColorLocked)a.studio.isColorLocked=!1,a.studio.colorLockSource=null;else{a.studio.isColorLocked=!0;const s=a.canvas.getColor(a.cursor.pos.x,a.cursor.pos.y);a.studio.colorLockSource=ue.uint32ToHex(s)}return Ae.emit("READY");case"TOGGLE_UNDERLAY":return a.studio.isUnderlayVisible=!a.studio.isUnderlayVisible,Ae.emit("READY");case"OPEN_UNDERLAY_MENU":return a.studio.showUnderlayMenu=!a.studio.showUnderlayMenu,Ae.emit("READY");case"TOOL_RECTANGLE":return a.studio.activeTool="RECTANGLE",a.studio.shapeAnchor={...a.cursor.pos},Ae.emit("READY");case"TOOL_ELLIPSE":return a.studio.activeTool="ELLIPSE",a.studio.shapeAnchor={...a.cursor.pos},Ae.emit("READY");case"TOOL_BRUSH":return a.studio.activeTool="BRUSH",Ae.emit("READY");case"TOOL_ERASER":return a.studio.activeTool="ERASER",Ae.emit("READY");case"TOOL_SELECT":return a.studio.activeTool="SELECT",Ae.emit("READY");case"TOOL_POLYGON":return a.studio.activeTool="POLYGON",a.studio.shapeAnchor={...a.cursor.pos},Ae.emit("READY");case"POLY_SIDES_INC":return a.studio.polygonSides=Math.min(12,a.studio.polygonSides+1),a.studio.show(`${a.studio.polygonSides} Facets`),Ae.emit("READY");case"POLY_SIDES_DEC":return a.studio.polygonSides=Math.max(3,a.studio.polygonSides-1),a.studio.show(`${a.studio.polygonSides} Facets`),Ae.emit("READY");case"POLY_INDENT_INC":return a.studio.polygonIndentation=Math.min(100,a.studio.polygonIndentation+10),a.studio.show(`${a.studio.polygonIndentation}% Steeping`),Ae.emit("READY");case"POLY_INDENT_DEC":return a.studio.polygonIndentation=Math.max(0,a.studio.polygonIndentation-10),a.studio.show(`${a.studio.polygonIndentation}% Steeping`),Ae.emit("READY");case"TOGGLE_DITHER_BLEND":return a.studio.isDitherBlendActive=!a.studio.isDitherBlendActive,a.studio.show(a.studio.isDitherBlendActive?"Classic Blend ON":"Classic Blend OFF"),Ae.emit("READY");case"TOOL_TRANSFORM":return a.selection.isActive?(a.studio.isTransforming=!a.studio.isTransforming,Ae.emit("READY")):void 0;default:if(e.startsWith("SET_SIDES_")){const s=parseInt(e.split("_")[2]);return a.studio.polygonSides=s,a.studio.show(`${s} Facets`),Ae.emit("READY")}if(e.startsWith("SELECT_COLOR_")){const s=parseInt(e.split("_")[2]);return H.color.select(s===0?9:s-1)}}}executeMove(e,t){if(a.studio.isTransforming&&a.selection.isActive){H.selection.nudge(e,t);return}if(H.movement.move(e,t)){const r=ze.current.type;r==="SELECT"&&(a.selection.isActive||H.startSelection(),H.updateSelection()),r==="PAINT"&&H.draw.draw(),r==="ERASE"&&H.draw.erase()}}resetAutoSaveTimer(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{H.persistence.autoSaveSession()},1e4)}}const Tt=new si;class ii{isPointerDown=!1;#e=T(!1);get isPointerDownActive(){return i(this.#e)}set isPointerDownActive(e){k(this.#e,e,!0)}lastPosition={x:-1,y:-1};lastScreenPos=null;buttonType=null;holdTimer=null;isSnapped=!1;rafId=null;#t=T(!1);get isSnappedState(){return i(this.#t)}set isSnappedState(e){k(this.#t,e,!0)}mapToGrid(e,t,r){const s=r.getBoundingClientRect();return Je.mapScreenToGrid(e,t,s,a.canvas.width,a.canvas.height)}handleStart(e,t){Tt.resetAutoSaveTimer(),this.isPointerDown=!0,this.isPointerDownActive=!0,this.isSnapped=!1,this.buttonType=e.button===2?"secondary":"primary",this.lastScreenPos={x:e.clientX,y:e.clientY};const r=this.mapToGrid(e.clientX,e.clientY,t);if(this.lastPosition={x:r.x,y:r.y},e.ctrlKey||e.metaKey){a.cursor.pos={x:Math.floor(r.x),y:Math.floor(r.y)},this.isPointerDown=!1,this.isPointerDownActive=!1;return}const s=ze.current.type;if(s==="PAN")return;a.cursor.pos={x:Math.floor(r.x),y:Math.floor(r.y)};const o=a.studio.activeTool;if(this.buttonType==="primary"&&o==="SELECT"){H.selection.begin(a.cursor.pos.x,a.cursor.pos.y);return}if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(o)){a.studio.shapeAnchor={...a.cursor.pos};return}const l=a.studio.isShadingLighten||a.studio.isShadingDarken||a.studio.isShadingDither;this.buttonType==="primary"&&s!=="SELECT"&&(l?H.draw.draw(r.x,r.y):(H.draw.beginStroke(r.x,r.y),this.startHoldTimer()))}handleMove(e,t){this.isPointerDown&&(Tt.resetAutoSaveTimer(),!this.rafId&&(this.rafId=requestAnimationFrame(()=>{const r=this.mapToGrid(e.clientX,e.clientY,t),s=ze.current.type,o=a.studio.activeTool;if(s==="PAN"){const n=Je.calculatePanDelta(e.clientX,e.clientY,this.lastScreenPos?.x||e.clientX,this.lastScreenPos?.y||e.clientY);a.studio.panOffset.x+=n.dx,a.studio.panOffset.y+=n.dy,this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null;return}if(a.cursor.pos={x:Math.floor(r.x),y:Math.floor(r.y)},this.buttonType==="primary"&&o==="SELECT"){H.selection.update(a.cursor.pos.x,a.cursor.pos.y),this.rafId=null;return}const l=a.studio.isShadingLighten||a.studio.isShadingDarken||a.studio.isShadingDither;if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(o)){this.lastPosition={x:r.x,y:r.y},this.rafId=null;return}this.buttonType==="primary"&&s!=="SELECT"&&(l?H.draw.draw(r.x,r.y):this.isSnapped||(H.draw.continueStroke(r.x,r.y,this.lastPosition.x,this.lastPosition.y),this.resetHoldTimer())),this.lastPosition={x:r.x,y:r.y},this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null})))}handleEnd(){if(!this.isPointerDown)return;this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);const e=ze.current.type,t=a.studio.activeTool;this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(t)?H.draw.commitShape():this.buttonType==="primary"&&t==="SELECT"?H.selection.commit():this.buttonType==="primary"&&e!=="SELECT"?H.draw.endStroke():a.canvas.clearBuffer(),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1}cancel(){this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1,H.draw.cancelStroke()}startHoldTimer(){this.clearHoldTimer(),this.holdTimer=setTimeout(()=>{this.isPointerDown&&this.triggerSnap()},600)}resetHoldTimer(){this.isSnapped||this.startHoldTimer()}clearHoldTimer(){this.holdTimer&&clearTimeout(this.holdTimer),this.holdTimer=null}triggerSnap(){this.isSnapped=!0,this.isSnappedState=!0,H.draw.snapCurrentStroke()}}const Ct=new ii;class oi{version="0.9.2";project=new Ls;canvas=new ps(this.project);cursor=new hs;paletteState=new gs;studio=new ys;selection=new Ts;get pixels(){return this.canvas.pixels}set pixels(e){this.canvas.pixels=e}get canvasWidth(){return this.canvas.width}set canvasWidth(e){this.canvas.width=e}get canvasHeight(){return this.canvas.height}set canvasHeight(e){this.canvas.height=e}get activeColor(){return this.paletteState.activeColor}set activeColor(e){this.paletteState.activeColor=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get usageMinutes(){return this.studio.usageMinutes}get backgroundColor(){return this.studio.backgroundColor}set backgroundColor(e){this.studio.backgroundColor=e}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isCursorVisible(){return this.cursor.isVisible}set isCursorVisible(e){this.cursor.isVisible=e}get showColorPicker(){return this.studio.showColorPicker}set showColorPicker(e){this.studio.showColorPicker=e}get showAudioSettings(){return this.studio.showAudioSettings}set showAudioSettings(e){this.studio.showAudioSettings=e}get showCommandPalette(){return this.studio.showCommandPalette}set showCommandPalette(e){this.studio.showCommandPalette=e}get showGuideBook(){return this.studio.showGuideBook}set showGuideBook(e){this.studio.showGuideBook=e}get showGuideMenu(){return this.studio.showGuideMenu}set showGuideMenu(e){this.studio.showGuideMenu=e}get showExportMenu(){return this.studio.showExportMenu}set showExportMenu(e){this.studio.showExportMenu=e}get showCanvasSettings(){return this.studio.showCanvasSettings}set showCanvasSettings(e){this.studio.showCanvasSettings=e}get showPersistenceMenu(){return this.studio.showPersistenceMenu}set showPersistenceMenu(e){this.studio.showPersistenceMenu=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get showGhostLayers(){return this.studio.showGhostLayers}set showGhostLayers(e){this.studio.showGhostLayers=e}#e=q(()=>({x:Je.toCartesianLabel(this.cursor.pos.x,this.canvas.width),y:Je.toCartesianLabel(this.cursor.pos.y,this.canvas.height,!0)}));get displayCoords(){return i(this.#e)}set displayCoords(e){k(this.#e,e)}#t=q(()=>Je.calculateCameraTransform(this.studio.zoomLevel,this.studio.panOffset,this.cursor.pos,this.canvas.width,this.canvas.height));get cameraTransform(){return i(this.#t)}set cameraTransform(e){k(this.#t,e)}#a=q(()=>{const e=new Set;return this.canvas.compositePixels.forEach(t=>{const r=ue.uint32ToHex(t);r!==null&&e.add(r)}),Array.from(e)});get usedColors(){return i(this.#a)}set usedColors(e){k(this.#a,e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}toggleMute(){this.studio.toggleMute()}handleEscape(){if(this.studio.handleEscape())return!0;let t=!1;this.project.selectedFrameIndices.size>1&&(this.project.selectedFrameIndices=new Set([this.project.activeFrameIndex]),t=!0);const r=this.project.activeFrame;return r.selectedLayerIndices.size>1&&(r.selectedLayerIndices=new Set([r.activeLayerIndex]),t=!0),t?!0:Ct.isPointerDownActive?(Ct.cancel(),!0):this.selection.isActive?this.studio.isTransforming?(this.studio.isTransforming=!1,!0):(this.selection.clear(),!0):this.studio.activeTool!=="BRUSH"?(this.studio.activeTool="BRUSH",this.studio.shapeAnchor=null,!0):this.studio.isShadingLighten||this.studio.isShadingDarken||this.studio.isShadingDither?(this.studio.isShadingLighten=!1,this.studio.isShadingDarken=!1,this.studio.isShadingDither=!1,this.studio.show("Shading Reset"),!0):!1}undo(){const e=he.undo();if(e)if("isStructural"in e)e.undo(),se.playErase();else if(Array.isArray(e)){const t=new Uint32Array(this.canvas.pixels);for(let r=e.length-1;r>=0;r--){const s=e[r];t[s.index]=ue.hexToUint32(s.oldColor)}this.canvas.pixels=t,this.canvas.triggerPulse(),se.playErase()}else{const t=new Uint32Array(this.canvas.pixels);t[e.index]=ue.hexToUint32(e.oldColor),this.canvas.pixels=t,this.canvas.triggerPulse(),se.playErase()}this.cursor.resetInactivityTimer()}redo(){const e=he.redo();if(e)if("isStructural"in e)e.redo(),se.playDraw();else if(Array.isArray(e)){const t=new Uint32Array(this.canvas.pixels);for(const r of e)t[r.index]=ue.hexToUint32(r.newColor);this.canvas.pixels=t,this.canvas.triggerPulse(),se.playDraw()}else{const t=new Uint32Array(this.canvas.pixels);t[e.index]=ue.hexToUint32(e.newColor),this.canvas.pixels=t,this.canvas.triggerPulse(),se.playDraw()}this.cursor.resetInactivityTimer()}clearCanvas(){H.clearCanvas()}pickColor(){H.pickColor()}loadProject(){H.load()}copySelection(){H.copy()}cutSelection(){H.cut()}pasteSelection(){H.paste()}flipCanvas(e){H.flipCanvas(e)}rotateCanvas(){H.rotateCanvas()}}const a=new oi;var ni=P('<div class="h-3 w-px bg-brand/20" aria-hidden="true"></div>'),li=P("<div><h1>Rupa</h1> <!> <p>The Barista's Café</p></div>");function dr(f,e){let t=Ge(e,"size",3,"md");const r={sm:{h1:"text-2xl",p:"text-[9px]",gap:"gap-3"},md:{h1:"text-4xl",p:"text-[11px]",gap:"gap-2"},lg:{h1:"text-7xl",p:"text-[14px]",gap:"gap-4"}};let s=q(()=>r[t()]),o=q(()=>t()==="sm"?"flex-row items-center":"flex-col items-center");var l=li(),n=d(l),u=h(n,2);{var v=x=>{var b=ni();S(x,b)};z(u,x=>{t()==="sm"&&x(v)})}var p=h(u,2);c(l),G(()=>{J(l,1,`flex ${i(o)??""} ${i(s).gap??""} justify-center text-center select-none`),J(n,1,`font-tiny5 leading-none text-brand ${i(s).h1??""} tracking-tighter`),J(p,1,`font-serif font-bold tracking-[0.4em] text-charcoal/40 uppercase ${i(s).p??""}`)}),S(f,l)}var gt=ua(()=>a),ci=P('<nav class="flex items-center gap-2" aria-label="Editor Tools"><div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">📖</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true">🍶</span> <span class="hidden xl:inline"> </span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">🧼</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true"> </span> <span class="hidden xl:inline"> </span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">📜</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true">⌨️</span> <span class="hidden xl:inline"> </span></button></div></nav>');function di(f,e){oe(e,!1),Ye();var t=ci(),r=d(t),s=d(r);s.__click=()=>gt(gt().showCommandPalette=!0);var o=h(d(s),2),l=d(o,!0);c(o),c(s);var n=h(s,2);n.__click=()=>gt(gt().showExportMenu=!0);var u=h(d(n),2),v=d(u,!0);c(u),c(n),c(r);var p=h(r,4),x=d(p);x.__click=()=>gt().clearCanvas();var b=h(d(x),2),g=d(b,!0);c(b),c(x);var m=h(x,2);m.__click=()=>gt(gt().showAudioSettings=!0);var _=d(m),y=d(_,!0);c(_);var w=h(_,2),C=d(w,!0);c(w),c(m),c(p);var R=h(p,4),F=d(R);F.__click=()=>gt(gt().showGuideBook=!0);var B=h(d(F),2),U=d(B,!0);c(B),c(F);var M=h(F,2);M.__click=()=>gt(gt().showGuideMenu=!0);var j=h(d(M),2),$=d(j,!0);c(j),c(M),c(R),c(t),G((V,K,Y,ae,re,ee,te,ce,we,Te,fe,me)=>{D(s,"title",`${V??""} (Ctrl+K)`),E(l,K),D(n,"title",`${Y??""} (Ctrl+E)`),E(v,ae),D(x,"title",`${re??""} (Ctrl+L)`),E(g,ee),D(m,"title",`${te??""} (Ctrl+Shift+A)`),E(y,gt().isMuted?"🔇":"🔊"),E(C,ce),D(F,"title",`${we??""} (F1)`),E(U,Te),D(M,"title",`${fe??""} (F2)`),E($,me)},[()=>A({key:"hud.menu.catalog_title"}),()=>A({key:"hud.menu.catalog_title"}),()=>A({key:"export.title"}),()=>A({key:"export.title"}),()=>A({key:"hud.actions.clear_canvas"}),()=>A({key:"hud.actions.clear_canvas"}),()=>A({key:"hud.audio.title"}),()=>A({key:"hud.audio.title"}),()=>A({key:"manual.title"}),()=>A({key:"manual.title"}),()=>A({key:"shortcuts.title"}),()=>A({key:"shortcuts.title"})]),S(f,t),ne()}je(["click"]);const ui=f=>f;function $a(f){const e=f-1;return e*e*e+1}function Za(f){const e=typeof f=="string"&&f.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[f,"px"]}function Le(f,{delay:e=0,duration:t=400,easing:r=ui}={}){const s=+getComputedStyle(f).opacity;return{delay:e,duration:t,easing:r,css:o=>`opacity: ${o*s}`}}function Ba(f,{delay:e=0,duration:t=400,easing:r=$a,x:s=0,y:o=0,opacity:l=0}={}){const n=getComputedStyle(f),u=+n.opacity,v=n.transform==="none"?"":n.transform,p=u*(1-l),[x,b]=Za(s),[g,m]=Za(o);return{delay:e,duration:t,easing:r,css:(_,y)=>`
			transform: ${v} translate(${(1-_)*x}${b}, ${(1-_)*g}${m});
			opacity: ${u-p*y}`}}function ur(f,{delay:e=0,duration:t=400,easing:r=$a,axis:s="y"}={}){const o=getComputedStyle(f),l=+o.opacity,n=s==="y"?"height":"width",u=parseFloat(o[n]),v=s==="y"?["top","bottom"]:["left","right"],p=v.map(w=>`${w[0].toUpperCase()}${w.slice(1)}`),x=parseFloat(o[`padding${p[0]}`]),b=parseFloat(o[`padding${p[1]}`]),g=parseFloat(o[`margin${p[0]}`]),m=parseFloat(o[`margin${p[1]}`]),_=parseFloat(o[`border${p[0]}Width`]),y=parseFloat(o[`border${p[1]}Width`]);return{delay:e,duration:t,easing:r,css:w=>`overflow: hidden;opacity: ${Math.min(w*20,1)*l};${n}: ${w*u}px;padding-${v[0]}: ${w*x}px;padding-${v[1]}: ${w*b}px;margin-${v[0]}: ${w*g}px;margin-${v[1]}: ${w*m}px;border-${v[0]}-width: ${w*_}px;border-${v[1]}-width: ${w*y}px;min-${n}: 0`}}function Zt(f,{delay:e=0,duration:t=400,easing:r=$a,start:s=0,opacity:o=0}={}){const l=getComputedStyle(f),n=+l.opacity,u=l.transform==="none"?"":l.transform,v=1-s,p=n*(1-o);return{delay:e,duration:t,easing:r,css:(x,b)=>`
			transform: ${u} scale(${1-v*b});
			opacity: ${n-p*b}
		`}}var vi=P('<div class="flex items-center gap-2 rounded-full border border-charcoal/10 bg-foam-white/50 px-3 py-1"><div class="h-1.5 w-1.5 rounded-full bg-brand/40" aria-hidden="true"></div> <span class="font-mono text-[9px] font-bold tracking-widest text-charcoal/40 uppercase"> </span></div>'),pi=P('<div class="flex items-center gap-4 px-4"><!></div>');function hi(f,e){oe(e,!1),Ye();var t=pi(),r=d(t);{var s=o=>{var l=vi(),n=h(d(l),2),u=d(n,!0);c(n),c(l),G(v=>E(u,v),[()=>A({key:"project.saved",replace:{time:a.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}})]),de(3,l,()=>Le),S(o,l)};z(r,o=>{a.project.lastSaved&&o(s)})}c(t),S(f,t),ne()}var fi=P('<header class="hud-panel flex h-14 w-full items-center justify-between px-8 py-2 select-none svelte-zd3ruq"><div class="flex items-center gap-12"><!> <div class="h-6 w-px bg-charcoal/10" aria-hidden="true"></div> <!></div> <!></header>');function xi(f){var e=fi(),t=d(e),r=d(t);dr(r,{size:"sm"});var s=h(r,4);di(s,{}),c(t);var o=h(t,2);hi(o,{}),c(e),S(f,e)}var gi=P('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/40 uppercase">Steeped</span> <span class="font-serif text-[8px] text-charcoal/30 italic">Sync across all cups</span></div> <button aria-label="Toggle Steeped"><div></div></button></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-2"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/40 uppercase"> </span> <div class="flex items-center gap-1"><span class="font-tiny5 text-[9px] font-bold text-brand"> </span> <span class="font-tiny5 text-[8px] text-charcoal/30 uppercase">px</span></div></div> <input type="range" min="0" max="5" step="0.5" class="editor-slider"/></div> <div class="flex flex-col gap-2"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/40 uppercase"> </span> <div class="flex items-center gap-1"><span class="font-tiny5 text-[9px] font-bold text-brand"> </span> <span class="font-tiny5 text-[8px] text-charcoal/30 uppercase">px</span></div></div> <input type="range" min="0" max="20" step="1" class="editor-slider"/></div>',1),bi=P(`<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-1 rounded-lg bg-brand/5 p-2 ring-1 ring-brand/10"><span class="font-serif text-[10px] font-bold tracking-widest text-brand uppercase">Master Pace</span> <span class="font-serif text-[8px] leading-tight text-brand/60 italic">This cup follows the project's global rhythm (FPS).</span></div>`,1),mi=P('<div class="mr-2 mb-2 flex flex-col gap-4 rounded-xl border border-charcoal/5 bg-white/40 p-4 pt-2 shadow-sm backdrop-blur-sm"><div class="flex flex-col gap-2"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/40 uppercase">Density</span> <div class="flex items-center gap-1"><input type="number" min="0" max="100" class="editor-input-number w-10"/> <span class="font-tiny5 text-[8px] text-charcoal/30">%</span></div></div> <input type="range" min="0" max="1" step="0.01" class="editor-slider"/></div> <!> <!></div>');function Ja(f,e){oe(e,!0);let t=Ge(e,"target",7),r=q(()=>"isLinked"in t()),s=q(()=>"duration"in t());var o=mi(),l=d(o),n=d(l),u=h(d(n),2),v=d(u);Me(v),v.__input=_=>t().opacity=Math.max(0,Math.min(100,Number(_.currentTarget.value)))/100,bt(2),c(u),c(n);var p=h(n,2);Me(p),c(l);var x=h(l,2);{var b=_=>{var y=gi(),w=h(Ie(y),2),C=h(d(w),2);C.__click=()=>t().isLinked=!t().isLinked;var R=d(C);c(C),c(w);var F=h(w,4),B=d(F),U=d(B),M=d(U,!0);c(U);var j=h(U,2),$=d(j),V=d($,!0);c($),bt(2),c(j),c(B);var K=h(B,2);Me(K),c(F);var Y=h(F,2),ae=d(Y),re=d(ae),ee=d(re,!0);c(re);var te=h(re,2),ce=d(te),we=d(ce,!0);c(ce),bt(2),c(te),c(ae);var Te=h(ae,2);Me(Te),c(Y),G((fe,me)=>{J(C,1,`flex h-4 w-8 items-center rounded-full transition-colors ${t().isLinked?"bg-brand":"bg-charcoal/10"}`),J(R,1,`h-2.5 w-2.5 rounded-full bg-white shadow-sm transition-transform ${t().isLinked?"translate-x-4.5":"translate-x-1"}`),E(M,fe),E(V,t().wiggleAmount),E(ee,me),E(we,t().swayAmount)},[()=>A({key:"export.wiggle_modifier"}),()=>A({key:"export.sway_modifier"})]),Oe(K,()=>t().wiggleAmount,fe=>t().wiggleAmount=fe),Oe(Te,()=>t().swayAmount,fe=>t().swayAmount=fe),S(_,y)};z(x,_=>{i(r)&&_(b)})}var g=h(x,2);{var m=_=>{var y=bi();bt(2),S(_,y)};z(g,_=>{i(s)&&_(m)})}c(o),G(_=>us(v,_),[()=>Math.round(t().opacity*100)]),Oe(p,()=>t().opacity,_=>t().opacity=_),de(3,o,()=>Le,()=>({duration:100})),S(f,o),ne()}je(["input","click"]);var yi=P('<input type="text" class="w-full bg-brand/5 font-serif text-sm font-medium text-brand ring-1 ring-brand/30 outline-none"/>'),_i=P('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">🗑️</button>'),Ai=P('<div role="button" tabindex="0" draggable="true"><div class="flex flex-1 items-center gap-2 overflow-hidden"><span class="w-4 shrink-0 text-center font-mono text-[9px] font-bold opacity-20" aria-hidden="true"></span> <button> </button> <button><!></button></div> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Cup Properties"> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">📋</button> <!></div></div> <!>',1),wi=P('<div class="flex flex-col gap-1" role="list"></div>'),ki=P('<button class="w-4 shrink-0 text-center text-[10px] opacity-40 hover:opacity-100"> </button>'),Ei=P('<div class="w-4 shrink-0"></div>'),Si=P('<input type="text" class="w-full bg-brand/5 font-serif text-sm font-medium text-brand ring-1 ring-brand/30 outline-none"/>'),Li=P('<div role="button" tabindex="0" draggable="true"><div class="flex flex-1 items-center gap-2 overflow-hidden"><!> <button> </button> <button><!></button></div> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Infusion Properties"> </button> <button> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">🗑️</button></div></div> <!>',1),Ti=P('<div class="flex flex-col gap-1" role="list"></div>'),Ci=P('<button class="flex items-center gap-1 font-serif text-[9px] font-bold tracking-[0.1em] text-charcoal/40 uppercase hover:text-charcoal/80"><span aria-hidden="true">📁</span> Group</button>'),Ii=P('<div class="flex h-full w-full flex-col overflow-hidden bg-transparent" role="region" aria-label="Project Explorer"><div class="flex border-b border-charcoal/10 bg-charcoal/5 p-1" role="tablist"><button role="tab"><span aria-hidden="true">🖼️</span> </button> <button role="tab"><span aria-hidden="true">🧵</span> </button></div> <div class="custom-scrollbar flex-1 overflow-y-auto p-2" role="presentation"><!></div> <div class="flex items-center justify-between border-t border-charcoal/5 bg-charcoal/5 px-4 py-2"><div class="flex items-center gap-3"><button class="flex items-center gap-1 font-serif text-[9px] font-bold tracking-[0.1em] text-charcoal/40 uppercase hover:text-charcoal/80"><span aria-hidden="true">＋</span> </button> <!></div> <span class="font-mono text-[8px] font-bold text-charcoal/20 uppercase"> </span></div></div>');function Pi(f,e){oe(e,!0);let t=T(null),r=T(null),s=T(null),o=T(""),l=T(null),n=T(null);function u(L,I,N){N.stopPropagation(),i(l)===L&&i(n)===I?(k(l,null),k(n,null)):(k(l,L,!0),k(n,I,!0))}function v(L,I){k(s,L,!0),k(o,I,!0)}function p(L){L.focus(),L.select()}function x(){i(s)!==null&&(a.studio.projectActiveTab==="layers"?a.project.activeFrame.layers[i(s)].name=i(o):a.project.frames[i(s)].name=i(o),k(s,null))}function b(L){k(t,L,!0)}function g(L,I){L.preventDefault(),k(r,I,!0)}function m(L,I){L.preventDefault(),i(t)!==null&&(a.studio.projectActiveTab==="layers"?H.project.reorderLayer(i(t),I):H.project.reorderFrame(i(t),I)),k(t,null),k(r,null)}function _(){k(t,null),k(r,null)}function y(){const L=a.project;L.selectedFrameIndices=new Set([L.activeFrameIndex]);const I=L.activeFrame;I.selectedLayerIndices=new Set([I.activeLayerIndex])}function w(L,I){const N=a.project;if(I.ctrlKey||I.metaKey)N.selectedFrameIndices.has(L)&&N.selectedFrameIndices.size>1?N.selectedFrameIndices.delete(L):N.selectedFrameIndices.add(L);else if(I.shiftKey){const O=Math.min(N.activeFrameIndex,L),Q=Math.max(N.activeFrameIndex,L),ve=new Set;for(let Z=O;Z<=Q;Z++)ve.add(Z);N.selectedFrameIndices=ve}else N.selectedFrameIndices=new Set([L]);N.activeFrameIndex=L}function C(L,I){const N=a.project.activeFrame;if(I.ctrlKey||I.metaKey)N.selectedLayerIndices.has(L)&&N.selectedLayerIndices.size>1?N.selectedLayerIndices.delete(L):N.selectedLayerIndices.add(L);else if(I.shiftKey){const O=Math.min(N.activeLayerIndex,L),Q=Math.max(N.activeLayerIndex,L),ve=new Set;for(let Z=O;Z<=Q;Z++)ve.add(Z);N.selectedLayerIndices=ve}else N.selectedLayerIndices=new Set([L]);N.activeLayerIndex=L}function R(L,I){L.preventDefault();const N=a.project;N.selectedFrameIndices.has(I)||(N.selectedFrameIndices=new Set([I]),N.activeFrameIndex=I);const O=N.selectedFrameIndices.size>1;a.studio.contextMenu={x:L.clientX,y:L.clientY,items:[{label:O?`Duplicate ${N.selectedFrameIndices.size} Cups`:A({key:"hud.actions.duplicate"}),icon:"📋",action:()=>{H.project.duplicateFrame(I)}},{label:"Add Flavor Tag",icon:"🏷️",action:()=>{const Q=prompt("Tag Name:","New Sequence");if(Q){const ve=Array.from(N.selectedFrameIndices).sort((Z,ke)=>Z-ke);H.project.addTag(Q,ve[0],ve[ve.length-1])}}},{label:O?`Spill ${N.selectedFrameIndices.size} Cups`:A({key:"hud.actions.delete"}),icon:"🗑️",danger:!0,disabled:N.frames.length<=N.selectedFrameIndices.size,action:()=>{Array.from(N.selectedFrameIndices).sort((ve,Z)=>Z-ve).forEach(ve=>H.project.removeFrame(ve)),N.selectedFrameIndices=new Set([N.activeFrameIndex])}}]}}function F(L,I){const N=a.project.activeFrame;L.preventDefault(),N.selectedLayerIndices.has(I)||(N.selectedLayerIndices=new Set([I]),N.activeLayerIndex=I);const O=N.selectedLayerIndices.size>1,Q=N.layers[I];a.studio.contextMenu={x:L.clientX,y:L.clientY,items:[{label:O?"Group Selected":"Group",icon:"📁",action:()=>{const ve=H.project.addGroup();O?Array.from(N.selectedLayerIndices).forEach(ke=>{const Ce=N.layers[ke];Ce!==ve&&(Ce.parentId=ve.id)}):Q.parentId=ve.id}},{label:O?`Duplicate ${N.selectedLayerIndices.size} Infusions`:A({key:"hud.actions.duplicate"}),icon:"📋",disabled:O,action:()=>H.project.duplicateLayer(I)},{label:O?"Show/Hide Selected":Q.isVisible?"Hide Infusion":"Show Infusion",icon:Q.isVisible?"🕶️":"👁️",action:()=>{const ve=Array.from(N.selectedLayerIndices),Z=!Q.isVisible;ve.forEach(ke=>N.layers[ke].isVisible=Z),a.canvas.triggerPulse()}},{label:O?"Seal/Unseal Selected":Q.isLocked?"Unlock Infusion":"Lock Infusion",icon:Q.isLocked?"🔓":"🔒",action:()=>{Array.from(N.selectedLayerIndices).forEach(Z=>H.project.toggleLock(Z))}},{label:A({key:"hud.actions.delete"}),icon:"🗑️",danger:!0,disabled:N.layers.length<=N.selectedLayerIndices.size,action:()=>{Array.from(N.selectedLayerIndices).sort((Z,ke)=>ke-Z).forEach(Z=>H.project.removeLayer(Z)),N.selectedLayerIndices=new Set([N.activeLayerIndex])}}]}}var B=Ii(),U=d(B),M=d(U);M.__click=()=>a.studio.projectActiveTab="frames";var j=h(d(M));c(M);var $=h(M,2);$.__click=()=>a.studio.projectActiveTab="layers";var V=h(d($));c($),c(U);var K=h(U,2);K.__click=y,K.__keydown=L=>{L.key==="Escape"&&y()};var Y=d(K);{var ae=L=>{var I=wi();De(I,21,()=>a.project.frames,Ue,(N,O,Q)=>{var ve=Ai(),Z=Ie(ve);Z.__click=le=>le.stopPropagation(),Z.__keydown=le=>{(le.key==="Enter"||le.key===" ")&&w(Q,le)},Z.__contextmenu=le=>R(le,Q);var ke=d(Z),Ce=d(ke);Ce.textContent=Q+1;var Ne=h(Ce,2);Ne.__click=le=>{le.stopPropagation(),H.project.toggleFrameVisibility(Q)};var qe=d(Ne,!0);c(Ne);var Re=h(Ne,2);Re.__click=le=>w(Q,le),Re.__dblclick=()=>v(Q,i(O).name);var xe=d(Re);{var Ve=le=>{var ye=yi();Me(ye),ye.__keydown=Ee=>{Ee.key==="Enter"&&x(),Ee.key==="Escape"&&k(s,null)},fa(()=>Oe(ye,()=>i(o),Ee=>k(o,Ee))),Ka(ye,Ee=>p?.(Ee)),Ze("blur",ye,x),S(le,ye)},Ke=le=>{var ye=ot();G(()=>E(ye,i(O).name)),S(le,ye)};z(xe,le=>{i(s)===Q&&a.studio.projectActiveTab==="frames"?le(Ve):le(Ke,!1)})}c(Re),c(ke);var nt=h(ke,2),Fe=d(nt);Fe.__click=le=>u("frame",Q,le);var ge=d(Fe,!0);c(Fe);var Se=h(Fe,2);Se.__click=le=>{le.stopPropagation(),H.project.duplicateFrame(Q)};var $e=h(Se,2);{var lt=le=>{var ye=_i();ye.__click=Ee=>{Ee.stopPropagation(),H.project.removeFrame(Q)},G(Ee=>D(ye,"title",Ee),[()=>A({key:"hud.actions.delete"})]),S(le,ye)};z($e,le=>{a.project.frames.length>1&&le(lt)})}c(nt),c(Z);var We=h(Z,2);{var ct=le=>{Ja(le,{get target(){return i(O)}})};z(We,le=>{i(l)==="frame"&&i(n)===Q&&le(ct)})}G((le,ye)=>{J(Z,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${le??""} ${Q===a.project.activeFrameIndex?"bg-brand/5 font-bold":""} ${i(r)===Q&&i(t)!==Q?"shadow-[0_-2px_0_var(--color-brand)]":""} ${i(t)===Q?"opacity-40":""}`),D(Z,"aria-current",Q===a.project.activeFrameIndex?"true":void 0),J(Ne,1,`text-xs transition-opacity ${i(O).isVisible?"opacity-100":"opacity-20"}`),D(Ne,"title",i(O).isVisible?"Hide Cup":"Show Cup"),E(qe,i(O).isVisible?"👁️":"🕶️"),J(Re,1,`flex-1 truncate py-2 text-left font-serif text-sm font-medium text-charcoal ${i(O).isVisible?"":"opacity-40"}`),E(ge,i(l)==="frame"&&i(n)===Q?"🔼":"⚙️"),D(Se,"title",ye)},[()=>a.project.selectedFrameIndices.has(Q)?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-charcoal/5",()=>A({key:"hud.actions.duplicate"})]),Ze("dragstart",Z,()=>b(Q)),Ze("dragover",Z,le=>g(le,Q)),Ze("drop",Z,le=>m(le,Q)),Ze("dragend",Z,_),S(N,ve)}),c(I),de(3,I,()=>Le,()=>({duration:150})),S(L,I)},re=L=>{var I=Ti();De(I,21,()=>a.project.activeFrame.layers,Ue,(N,O,Q)=>{const ve=q(()=>i(O).parentId?a.project.activeFrame.layers.find(Ne=>Ne.id===i(O).parentId):null);var Z=Xe(),ke=Ie(Z);{var Ce=Ne=>{const qe=q(()=>i(O).parentId!==null);var Re=Li(),xe=Ie(Re);xe.__click=W=>W.stopPropagation(),xe.__keydown=W=>{(W.key==="Enter"||W.key===" ")&&C(Q,W)},xe.__contextmenu=W=>F(W,Q);var Ve=d(xe),Ke=d(Ve);{var nt=W=>{var ie=ki();ie.__click=Pe=>{Pe.stopPropagation(),i(O).isCollapsed=!i(O).isCollapsed};var _e=d(ie,!0);c(ie),G(()=>E(_e,i(O).isCollapsed?"▶":"▼")),S(W,ie)},Fe=W=>{var ie=Ei();S(W,ie)};z(Ke,W=>{i(O).type==="FOLDER"?W(nt):W(Fe,!1)})}var ge=h(Ke,2);ge.__click=W=>{W.stopPropagation(),H.project.toggleVisibility(Q)};var Se=d(ge,!0);c(ge);var $e=h(ge,2);$e.__click=W=>C(Q,W),$e.__dblclick=()=>v(Q,i(O).name);var lt=d($e);{var We=W=>{var ie=Si();Me(ie),ie.__keydown=_e=>{_e.key==="Enter"&&x(),_e.key==="Escape"&&k(s,null)},fa(()=>Oe(ie,()=>i(o),_e=>k(o,_e))),Ka(ie,_e=>p?.(_e)),Ze("blur",ie,x),S(W,ie)},ct=W=>{var ie=ot();G(()=>E(ie,i(O).name)),S(W,ie)};z(lt,W=>{i(s)===Q&&a.studio.projectActiveTab==="layers"?W(We):W(ct,!1)})}c($e),c(Ve);var le=h(Ve,2),ye=d(le);ye.__click=W=>u("layer",Q,W);var Ee=d(ye,!0);c(ye);var Be=h(ye,2);Be.__click=W=>{W.stopPropagation(),H.project.toggleLock(Q)};var mt=d(Be,!0);c(Be);var wt=h(Be,2);wt.__click=W=>{W.stopPropagation(),H.project.removeLayer(Q)},c(le),c(xe);var Ft=h(xe,2);{var yt=W=>{Ja(W,{get target(){return i(O)}})};z(Ft,W=>{i(l)==="layer"&&i(n)===Q&&W(yt)})}G((W,ie,_e,Pe)=>{J(xe,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${W??""} ${Q===a.project.activeFrame.activeLayerIndex?"bg-brand/5 font-bold":""} ${i(r)===Q&&i(t)!==Q?"shadow-[0_-2px_0_var(--color-brand)]":""} ${i(t)===Q?"opacity-40":""}`),be(xe,i(qe)?"margin-left: 12px;":""),D(xe,"aria-current",Q===a.project.activeFrame.activeLayerIndex?"true":void 0),J(ge,1,`text-xs transition-opacity ${i(O).isVisible?"opacity-100":"opacity-20"}`),D(ge,"title",ie),E(Se,i(O).isVisible?i(O).type==="FOLDER"?"📂":"👁️":i(O).type==="FOLDER"?"📁":"🕶️"),J($e,1,`flex-1 truncate py-2 text-left font-serif text-sm font-medium text-charcoal ${i(O).isVisible?"":"opacity-40"}`),E(Ee,i(l)==="layer"&&i(n)===Q?"🔼":"⚙️"),J(Be,1,`text-[10px] transition-opacity ${i(O).isLocked?"opacity-100":"opacity-20"}`),D(Be,"title",_e),E(mt,i(O).isLocked?"🔒":"🔓"),D(wt,"title",Pe)},[()=>a.project.activeFrame.selectedLayerIndices.has(Q)?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-charcoal/5",()=>A({key:"hud.project_panel.visibility"}),()=>A({key:"hud.project_panel.lock"}),()=>A({key:"hud.actions.delete"})]),Ze("dragstart",xe,()=>b(Q)),Ze("dragover",xe,W=>g(W,Q)),Ze("drop",xe,W=>m(W,Q)),Ze("dragend",xe,_),S(Ne,Re)};z(ke,Ne=>{(!i(ve)||!i(ve).isCollapsed)&&Ne(Ce)})}S(N,Z)}),c(I),de(3,I,()=>Le,()=>({duration:150})),S(L,I)};z(Y,L=>{a.studio.projectActiveTab==="frames"?L(ae):L(re,!1)})}c(K);var ee=h(K,2),te=d(ee),ce=d(te);ce.__click=()=>{a.studio.projectActiveTab==="frames"?H.project.addFrame():H.project.addLayer()};var we=h(d(ce));c(ce);var Te=h(ce,2);{var fe=L=>{var I=Ci();I.__click=()=>H.project.addGroup(),S(L,I)};z(Te,L=>{a.studio.projectActiveTab==="layers"&&L(fe)})}c(te);var me=h(te,2),X=d(me,!0);c(me),c(ee),c(B),G((L,I,N,O,Q)=>{D(M,"aria-selected",a.studio.projectActiveTab==="frames"),D(M,"title",L),J(M,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${a.studio.projectActiveTab==="frames"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),E(j,` ${I??""}`),D($,"aria-selected",a.studio.projectActiveTab==="layers"),D($,"title",N),J($,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${a.studio.projectActiveTab==="layers"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),E(V,` ${O??""}`),E(we,` ${Q??""}`),E(X,a.studio.projectActiveTab==="frames"?a.project.frames.length:a.project.activeFrame.layers.length)},[()=>A({key:"labels.TAB_TIMELINE"})+" (Alt+1)",()=>A({key:"hud.project_panel.frames"}),()=>A({key:"labels.TAB_LAYERS"})+" (Alt+2)",()=>A({key:"hud.project_panel.layers"}),()=>a.studio.projectActiveTab==="frames"?A({key:"hud.actions.add_frame"}):A({key:"hud.actions.add_layer"})]),S(f,B),ne()}je(["click","keydown","contextmenu","dblclick"]);var Mi=P('<div class="minimap-container border-b border-charcoal/10 bg-charcoal/5 p-3 transition-all duration-300 svelte-17kdxrh"><div class="relative flex items-center justify-center overflow-hidden rounded border border-charcoal/5 bg-stone-light/20 p-2 shadow-inner"><canvas class="h-auto w-full max-w-[180px] shadow-sm" style="image-rendering: pixelated;"></canvas> <div class="pointer-events-none absolute inset-0 ring-1 ring-brand ring-inset" style="opacity: 0.4;"></div></div></div>');function Oi(f,e){oe(e,!0);let t=T(null);pt(()=>{a.canvas.renderPulse;const l=i(t)?.getContext("2d");if(!l||!i(t))return;const{width:n,height:u}=a.canvas,v=a.canvas.compositePixels,p=l.createImageData(n,u);new Uint32Array(p.data.buffer).set(v),l.putImageData(p,0,0)});var r=Mi(),s=d(r),o=d(s);Yt(o,l=>k(t,l),()=>i(t)),bt(2),c(s),c(r),G(()=>{D(o,"width",a.canvas.width),D(o,"height",a.canvas.height)}),S(f,r),ne()}var Ri=P('<aside class="side-panel-left flex h-full w-full flex-col overflow-hidden border-r border-charcoal/10 bg-stone-light/50"><!> <div class="flex-1 overflow-y-auto"><!></div></aside>');function Di(f,e){oe(e,!1),Ye();var t=Ri(),r=d(t);{var s=n=>{Oi(n,{})};z(r,n=>{a.studio.showMinimap&&n(s)})}var o=h(r,2),l=d(o);Pi(l,{}),c(o),c(t),S(f,t),ne()}var ji=P('<button class="group editor-checker-small relative h-5 w-5 shrink-0 rounded border border-charcoal/10 shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[8px]">📍</span></div></button>'),Fi=P('<div class="flex h-5 w-5 items-center justify-center rounded border border-dashed border-charcoal/10"><span class="text-[8px] opacity-20">🎨</span></div>'),$i=P('<div class="editor-panel flex w-full flex-col gap-4 border-none bg-foam-white p-3 shadow-sm"><div class="flex flex-col items-center gap-2 py-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Active Flavor</span> <div class="editor-checker-small h-10 w-10 rounded border border-charcoal/10 shadow-inner transition-colors"></div> <div class="flex items-center gap-2"><span class="font-mono text-[9px] font-bold tracking-tight text-charcoal/40 uppercase"> </span> <button class="flex h-4 w-4 items-center justify-center rounded bg-brand/10 text-[8px] text-brand transition-all hover:bg-brand hover:text-white" title="Add to Current Palette">＋</button></div></div> <div class="h-px w-full bg-charcoal/5"></div> <div class="flex flex-col gap-2"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Recent Brews</span> <div class="custom-scrollbar flex max-h-[120px] flex-row flex-wrap gap-1.5 overflow-y-auto px-1"></div></div></div>');function Bi(f,e){oe(e,!1),Ye();var t=$i(),r=d(t),s=h(d(r),2),o=h(s,2),l=d(o),n=d(l,!0);c(l);var u=h(l,2);u.__click=()=>a.paletteState.addSwatch(a.paletteState.activeColor),c(o),c(r);var v=h(r,4),p=h(d(v),2);De(p,5,()=>a.usedColors,x=>x,(x,b)=>{var g=ji();g.__click=()=>H.color.setColor(i(b)),G(()=>{be(g,`background-color: ${i(b)??""};`),D(g,"title",i(b))}),de(3,g,()=>ur,()=>({duration:200})),S(x,g)},x=>{var b=Fi();S(x,b)}),c(p),c(v),c(t),G(()=>{be(s,`background-color: ${a.paletteState.activeColor??""};`),E(n,a.paletteState.activeColor)}),S(f,t),ne()}je(["click"]);var Gi=P('<div class="editor-panel w-full border-none bg-stone-light/50 p-3 shadow-sm" role="status"><div class="flex flex-col gap-3"><div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div> <div class="h-px w-full bg-charcoal/5" aria-hidden="true"></div> <div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div></div></div>');function Ni(f,e){oe(e,!1),Ye();var t=Gi(),r=d(t),s=d(r),o=d(s),l=d(o,!0);c(o);var n=h(o,2),u=d(n);c(n),c(s);var v=h(s,4),p=d(v),x=d(p,!0);c(p);var b=h(p,2),g=d(b);c(b),c(v),c(r),c(t),G((m,_)=>{E(l,m),E(u,`${a.displayCoords.x??""}, ${a.displayCoords.y??""}`),E(x,_),E(g,`${a.canvas.width??""}×${a.canvas.height??""}`)},[()=>A({key:"stats.cursor_focus"}),()=>A({key:"stats.canvas_size"})]),S(f,t),ne()}var At=ua(()=>a),Vi=P('<button role="radio"></button>'),Ui=P('<div class="editor-panel flex w-full flex-col gap-3 border-none bg-stone-light/30 p-3 shadow-sm" role="region" aria-label="Color Palette"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <div class="grid grid-cols-4 gap-2" role="radiogroup"><!> <button class="flex h-8 w-8 items-center justify-center rounded border border-dashed border-charcoal/20 bg-charcoal/5 transition-all hover:scale-110 hover:border-brand/40 hover:bg-white"><span class="text-xs opacity-40" aria-hidden="true">＋</span></button> <button class="flex h-8 w-8 items-center justify-center rounded border border-dashed border-charcoal/20 bg-charcoal/5 transition-all hover:scale-110 hover:border-brand/40 hover:bg-white"><span class="text-xs opacity-40" aria-hidden="true">🎨</span></button></div></div>');function Hi(f,e){oe(e,!1),Ye();var t=Ui(),r=d(t),s=d(r,!0);c(r);var o=h(r,2),l=d(o);De(l,1,()=>At().palette,Ue,(v,p,x)=>{var b=Vi();b.__click=()=>H.color.select(x),b.__contextmenu=g=>{g.preventDefault(),At(At().studio.contextMenu={x:g.clientX,y:g.clientY,items:[{label:"Spill Flavor",icon:"🗑️",danger:!0,disabled:At().palette.length<=1,action:()=>At().paletteState.removeSwatch(x)}]})},G((g,m)=>{J(b,1,`editor-checker-small h-8 w-8 rounded transition-all ${At().activeColor===i(p)?"z-10 scale-110 border-2 border-brand shadow-md":"border border-charcoal/5 opacity-80 hover:scale-105 hover:opacity-100"}`),be(b,`background-color: ${i(p)??""};`),D(b,"aria-label",g),D(b,"title",m),D(b,"aria-checked",At().activeColor===i(p))},[()=>A({key:`labels.SELECT_COLOR_${(x+1)%10}`}),()=>A({key:`labels.SELECT_COLOR_${(x+1)%10}`})+` (${(x+1)%10})`]),S(v,b)});var n=h(l,2);n.__click=()=>At(At().showColorPicker=!0);var u=h(n,2);u.__click=()=>At(At().studio.showPaletteLibrary=!0),c(o),c(t),G((v,p,x,b,g)=>{E(s,v),D(n,"title",`${p??""} (B)`),D(n,"aria-label",x),D(u,"title",b),D(u,"aria-label",g)},[()=>A({key:"shortcut_groups.colors"}),()=>A({key:"color_picker.title"}),()=>A({key:"color_picker.title"}),()=>A({key:"palette_library.title"}),()=>A({key:"palette_library.title"})]),S(f,t),ne()}je(["click","contextmenu"]);var zi=P('<div class="absolute top-0 -left-12 flex flex-col items-center gap-1 rounded-md bg-white p-1 shadow-md ring-1 ring-black/5"><button class="flex h-4 w-4 items-center justify-center text-[10px] hover:text-brand">+</button> <span class="font-tiny5 text-[8px] text-brand"> </span> <button class="flex h-4 w-4 items-center justify-center text-[10px] hover:text-brand">-</button> <div class="my-1 h-px w-2 bg-charcoal/10"></div> <div class="flex flex-col items-center gap-0.5"><button class="text-[8px] hover:text-brand">▴</button> <span class="text-[7px] font-bold text-brand/60"> </span> <button class="text-[8px] hover:text-brand">▾</button></div></div>'),Yi=P('<button><span class="text-sm"> </span></button> <!>',1),Ki=P('<button><span class="text-sm"> </span></button>'),qi=P('<button><span class="text-sm"> </span></button>'),Qi=P('<div class="absolute -top-1 -right-1 text-[8px]">🔒</div>'),Xi=P('<button><span class="text-[10px]"> </span> <!></button>'),Wi=P('<div class="vessel-toolbar custom-scrollbar flex h-full flex-col items-center gap-4 overflow-y-auto py-4 svelte-9w26m7"><div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div></div>');function Zi(f,e){oe(e,!1);const t=ba(a.studio),r=[{id:"BRUSH",icon:"🖋️",intent:"TOOL_BRUSH",label:"TOOL_BRUSH"},{id:"ERASER",icon:"🧹",intent:"TOOL_ERASER",label:"TOOL_ERASER"},{id:"SELECT",icon:"✨",intent:"TOOL_SELECT",label:"TOOL_SELECT"},{id:"RECTANGLE",icon:"📦",intent:"TOOL_RECTANGLE",label:"TOOL_RECTANGLE"},{id:"ELLIPSE",icon:"⭕",intent:"TOOL_ELLIPSE",label:"TOOL_ELLIPSE"},{id:"POLYGON",icon:"⭐",intent:"TOOL_POLYGON",label:"TOOL_POLYGON"},{id:"HAND",icon:"🤚",intent:"TOGGLE_HAND_TOOL",label:"TOGGLE_HAND_TOOL"}],s=[{id:"lighten",icon:"☀️",intent:"SHADE_LIGHTEN",active:()=>i(t).isShadingLighten,label:"SHADE_LIGHTEN"},{id:"darken",icon:"🌙",intent:"SHADE_DARKEN",active:()=>i(t).isShadingDarken,label:"SHADE_DARKEN"},{id:"dither",icon:"🏁",intent:"SHADE_DITHER",active:()=>i(t).isShadingDither,label:"SHADE_DITHER"}],o=[{id:"symmetry",icon:"🪞",intent:"CYCLE_SYMMETRY",active:()=>i(t).symmetryMode!=="OFF",label:"CYCLE_SYMMETRY"},{id:"tiling",icon:"∞",intent:"TOGGLE_TILING",active:()=>i(t).isTilingEnabled,label:"TOGGLE_TILING"},{id:"perfect",icon:"✨",intent:"TOGGLE_PIXEL_PERFECT",active:()=>i(t).isPixelPerfect,label:"TOGGLE_PIXEL_PERFECT"},{id:"stencil",icon:"🎨",intent:"TOGGLE_PATTERN_BRUSH",active:()=>i(t).isPatternBrushActive,label:"TOGGLE_PATTERN_BRUSH",disabled:()=>!a.project.clipboard}],l=[{id:"alpha",icon:"A",intent:"TOGGLE_ALPHA_LOCK",active:()=>i(t).isAlphaLocked,label:"TOGGLE_ALPHA_LOCK"},{id:"color",icon:"C",intent:"TOGGLE_COLOR_LOCK",active:()=>i(t).isColorLocked,label:"TOGGLE_COLOR_LOCK"}];Ye();var n=Wi(),u=d(n);De(u,5,()=>r,Ue,(b,g)=>{var m=Yi(),_=Ie(m);_.__click=()=>Tt.handleIntent(i(g).intent);var y=d(_),w=d(y,!0);c(y),c(_);var C=h(_,2);{var R=F=>{var B=zi(),U=d(B);U.__click=()=>Tt.handleIntent("POLY_SIDES_INC");var M=h(U,2),j=d(M,!0);c(M);var $=h(M,2);$.__click=()=>Tt.handleIntent("POLY_SIDES_DEC");var V=h($,4),K=d(V);K.__click=()=>at(t,i(t).polygonIndentation=Math.min(100,i(t).polygonIndentation+10));var Y=h(K,2),ae=d(Y);c(Y);var re=h(Y,2);re.__click=()=>at(t,i(t).polygonIndentation=Math.max(0,i(t).polygonIndentation-10)),c(V),c(B),G(()=>{E(j,i(t).polygonSides),E(ae,`${i(t).polygonIndentation??""}%`)}),de(3,B,()=>Le),S(F,B)};z(C,F=>{i(g).id==="POLYGON"&&i(t).activeTool==="POLYGON"&&F(R)})}G(F=>{J(_,1,`tool-button ${i(t).activeTool===i(g).id?"is-active":""}`,"svelte-9w26m7"),D(_,"title",F),E(w,i(g).icon)},[()=>A({key:`labels.${i(g).label}`})]),S(b,m)}),c(u);var v=h(u,4);De(v,5,()=>s,Ue,(b,g)=>{var m=Ki();m.__click=()=>Tt.handleIntent(i(g).intent);var _=d(m),y=d(_,!0);c(_),c(m),G((w,C)=>{J(m,1,`tool-button ${w??""}`,"svelte-9w26m7"),D(m,"title",C),E(y,i(g).icon)},[()=>i(g).active()?"is-active":"",()=>A({key:`labels.${i(g).label}`})]),S(b,m)}),c(v);var p=h(v,4);De(p,5,()=>o,Ue,(b,g)=>{var m=qi();m.__click=()=>!i(g).disabled?.()&&Tt.handleIntent(i(g).intent);var _=d(m),y=d(_,!0);c(_),c(m),G((w,C,R)=>{J(m,1,`tool-button ${w??""} ${C??""}`,"svelte-9w26m7"),D(m,"title",R),E(y,i(g).icon)},[()=>i(g).active()?"is-active":"",()=>i(g).disabled?.()?"cursor-not-allowed opacity-20 grayscale":"",()=>A({key:`labels.${i(g).label}`})]),S(b,m)}),c(p);var x=h(p,4);De(x,5,()=>l,Ue,(b,g)=>{var m=Xi();m.__click=()=>Tt.handleIntent(i(g).intent);var _=d(m),y=d(_,!0);c(_);var w=h(_,2);{var C=R=>{var F=Qi();de(3,F,()=>Zt),S(R,F)};z(w,R=>{i(g).active()&&R(C)})}c(m),G((R,F)=>{J(m,1,`tool-button ${R??""} font-bold`,"svelte-9w26m7"),D(m,"title",F),E(y,i(g).icon)},[()=>i(g).active()?"is-active":"",()=>A({key:`labels.${i(g).label}`})]),S(b,m)}),c(x),c(n),S(f,n),ne()}je(["click"]);var Ji=P('<div class="flex flex-col gap-2"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase">Frothiness</span> <div class="flex items-center gap-1"><input type="number" min="0" max="100" class="editor-input-number w-10"/> <span class="font-tiny5 text-[8px] text-charcoal/30">%</span></div></div> <input type="range" min="0" max="100" step="1" class="editor-slider"/></div>'),eo=P('<div class="editor-panel flex w-full flex-col gap-4 border-none bg-foam-white p-3 shadow-sm"><div class="flex items-center justify-between"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Brush Settings</span> <div class="flex items-center gap-1.5"><button title="Square Vessel"><span class="text-[10px]">■</span></button> <button title="Circle Vessel"><span class="text-[10px]">●</span></button></div></div> <div class="flex flex-col gap-2"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase">Grind Size</span> <div class="flex items-center gap-1"><input type="number" min="1" max="100" class="editor-input-number w-10"/> <span class="font-tiny5 text-[8px] text-charcoal/30">px</span></div></div> <input type="range" min="1" max="100" step="1" class="editor-slider"/></div> <div class="h-px w-full bg-charcoal/5"></div> <div class="flex items-center justify-between"><div class="flex flex-col"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase">Aroma Blend</span> <span class="font-serif text-[8px] text-charcoal/30 italic">Checkerboard dithering</span></div> <button aria-label="Toggle Aroma Blend"><div></div></button></div> <!></div>');function to(f,e){oe(e,!1);const t=ba(a.studio);Ye();var r=eo(),s=d(r),o=h(d(s),2),l=d(o);l.__click=()=>at(t,i(t).brushShape="SQUARE");var n=h(l,2);n.__click=()=>at(t,i(t).brushShape="CIRCLE"),c(o),c(s);var u=h(s,2),v=d(u),p=h(d(v),2),x=d(p);Me(x),bt(2),c(p),c(v);var b=h(v,2);Me(b),c(u);var g=h(u,4),m=h(d(g),2);m.__click=()=>at(t,i(t).isDitherBlendActive=!i(t).isDitherBlendActive);var _=d(m);c(m),c(g);var y=h(g,2);{var w=C=>{var R=Ji(),F=d(R),B=h(d(F),2),U=d(B);Me(U),bt(2),c(B),c(F);var M=h(F,2);Me(M),c(R),Oe(U,()=>i(t).brushHardness,j=>at(t,i(t).brushHardness=j)),Oe(M,()=>i(t).brushHardness,j=>at(t,i(t).brushHardness=j)),de(3,R,()=>Le,()=>({duration:150})),S(C,R)};z(y,C=>{i(t).isDitherBlendActive&&C(w)})}c(r),G(()=>{J(l,1,`h-5 w-5 rounded border transition-all ${i(t).brushShape==="SQUARE"?"border-brand bg-brand text-white shadow-sm":"border-transparent bg-charcoal/5 text-charcoal/40 hover:bg-charcoal/10"}`),J(n,1,`h-5 w-5 rounded border transition-all ${i(t).brushShape==="CIRCLE"?"border-brand bg-brand text-white shadow-sm":"border-transparent bg-charcoal/5 text-charcoal/40 hover:bg-charcoal/10"}`),J(m,1,`flex h-4 w-8 items-center rounded-full transition-colors ${i(t).isDitherBlendActive?"bg-brand":"bg-charcoal/10"}`),J(_,1,`h-2.5 w-2.5 rounded-full bg-white shadow-sm transition-transform ${i(t).isDitherBlendActive?"translate-x-4.5":"translate-x-1"}`)}),Oe(x,()=>i(t).brushSize,C=>at(t,i(t).brushSize=C)),Oe(b,()=>i(t).brushSize,C=>at(t,i(t).brushSize=C)),S(f,r),ne()}je(["click"]);var ao=P('<aside class="side-panel-right flex h-full w-full border-l border-charcoal/10 bg-foam-white/50"><div class="flex h-full flex-col border-r border-charcoal/5 bg-charcoal/[0.02] px-2"><!></div> <div class="custom-scrollbar flex flex-1 flex-col gap-4 overflow-y-auto p-3"><div class="flex flex-col gap-3"><!> <!> <!></div> <div class="flex-1"></div> <!></div></aside>');function ro(f){var e=ao(),t=d(e),r=d(t);Zi(r,{}),c(t);var s=h(t,2),o=d(s),l=d(o);to(l,{});var n=h(l,2);Bi(n,{});var u=h(n,2);Hi(u,{}),c(o);var v=h(o,4);Ni(v,{}),c(s),c(e),S(f,e)}var so=P('<span class="text-xs" aria-hidden="true"> </span>'),io=P('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),oo=P("<div><!> <span> </span> <!></div>"),no=P('<div class="text-[8px] font-bold tracking-[0.2em] text-studio-text/20 uppercase"> </div>'),lo=P('<div class="flex items-center gap-4 transition-opacity duration-1000" role="status" aria-live="polite"><div class="flex w-[180px] items-center"><!></div> <!></div>');function co(f,e){oe(e,!1),Ye();var t=lo(),r=d(t),s=d(r);Wr(s,()=>ze.current.type,n=>{var u=oo(),v=d(u);{var p=_=>{var y=so(),w=d(y,!0);c(y),G(()=>E(w,ze.current.icon)),S(_,y)};z(v,_=>{ze.current.icon&&_(p)})}var x=h(v,2),b=d(x,!0);c(x);var g=h(x,2);{var m=_=>{var y=io(),w=d(y);c(y),G(()=>E(w,`v${a.version??""}`)),S(_,y)};z(g,_=>{ze.current.type==="READY"&&_(m)})}c(u),G(()=>{J(u,1,`status-tag flex items-center gap-2 ${ze.current.isPulse?"animate-pulse":""}`),be(u,`
					border-color: color-mix(in srgb, ${ze.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${ze.current.color??""} 10%, transparent);
					color: ${ze.current.color??""};
				`),J(x,1,os(ze.current.type==="READY"?"font-serif italic opacity-60":"font-bold")),E(b,ze.current.label)}),S(n,u)}),c(r);var o=h(r,2);{var l=n=>{const u=da(()=>a.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var v=no(),p=d(v,!0);c(v),G((x,b)=>{D(v,"aria-label",x),E(p,b)},[()=>A({key:"project.saved",replace:{time:i(u)}}),()=>A({key:"project.saved",replace:{time:i(u)}})]),S(n,v)};z(o,n=>{a.project.lastSaved&&n(l)})}c(t),S(f,t),ne()}var uo=P('<span class="rounded border border-charcoal/20 bg-charcoal/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-charcoal uppercase"> </span>'),vo=P('<span class="font-mono text-[9px] text-charcoal/40 italic"> </span>'),po=P('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"> </span> <div class="flex min-w-[80px] gap-1.5"><!></div></div>');function ho(f,e){oe(e,!1),Ye();var t=po(),r=d(t),s=d(r);c(r);var o=h(r,2),l=d(o);{var n=v=>{var p=Xe(),x=Ie(p);De(x,1,()=>it.activeKeys,Ue,(b,g)=>{var m=uo(),_=d(m,!0);c(m),G(()=>E(_,i(g)===" "?"Space":i(g))),S(b,m)}),S(v,p)},u=v=>{var p=vo(),x=d(p,!0);c(p),G(b=>E(x,b),[()=>A({key:"timeline.waiting"})]),S(v,p)};z(l,v=>{it.activeKeys.length>0?v(n):v(u,!1)})}c(o),c(t),G(v=>E(s,`${v??""}:`),[()=>A({key:"timeline.rhythm"})]),S(f,t),ne()}var fo=P('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"> </span> <span class="font-mono text-[9px] font-bold text-charcoal uppercase"> </span></div>');function xo(f,e){oe(e,!1),Ye();var t=fo(),r=d(t),s=d(r);c(r);var o=h(r,2),l=d(o,!0);c(o),c(t),G(n=>{E(s,`${n??""}:`),E(l,ze.current.type)},[()=>A({key:"timeline.mode"})]),S(f,t),ne()}var go=P('<div class="flex items-center gap-1.5"><span aria-hidden="true">🎹</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"><!></span></div>');function bo(f,e){oe(e,!1),Ye();var t=go(),r=d(t),s=h(r,2),o=d(s);{var l=u=>{var v=ot();G(p=>E(v,p),[()=>A({key:"timeline.audio_status.silent"})]),S(u,v)},n=u=>{var v=Xe(),p=Ie(v);{var x=g=>{var m=ot();G(_=>E(m,_),[()=>A({key:"timeline.audio_status.brewing"})]),S(g,m)},b=g=>{var m=ot();G(_=>E(m,_),[()=>A({key:"timeline.audio_status.resonant"})]),S(g,m)};z(p,g=>{a.usageMinutes<60?g(x):g(b,!1)},!0)}S(u,v)};z(o,u=>{a.usageMinutes<30?u(l):u(n,!1)})}c(s),c(t),G(u=>{D(t,"title",u),J(r,1,`text-[9px] ${a.usageMinutes>=30?"animate-pulse":"opacity-40 grayscale"}`)},[()=>A({key:"timeline.audio_status.title"})]),S(f,t),ne()}var mo=P('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">⏱️</span> <span class="font-mono text-[9px] font-bold text-charcoal/80 tabular-nums"> </span></div>');function yo(f,e){oe(e,!1),Ye();var t=mo(),r=h(d(t),2),s=d(r,!0);c(r),c(t),G(o=>{D(t,"title",o),E(s,a.studio.sessionTimeLabel)},[()=>A({key:"timeline.duration"})]),S(f,t),ne()}var ta=ua(()=>a),_o=P('<button class="flex items-center gap-1 rounded bg-brand/10 px-2 py-0.5 font-serif text-[8px] font-bold tracking-widest text-brand uppercase transition-all hover:bg-brand hover:text-white" title="Selection Propagation (Syrup Flow)"><span aria-hidden="true">🍯</span> </button>'),Ao=P('<div class="flex items-center gap-3"><div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">✨</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/60 uppercase italic"> </span></div> <!></div>');function wo(f,e){oe(e,!1),Ye();var t=Ao(),r=d(t),s=h(d(r),2),o=d(s,!0);c(s),c(r);var l=h(r,2);{var n=u=>{var v=_o();v.__click=()=>ta(ta().studio.showPourBasin=!0);var p=h(d(v));c(v),G(x=>E(p,` ${x??""}`),[()=>A({key:"export.propagation.title"})]),S(u,v)};z(l,u=>{ta().selection.isActive&&ta().project.frames.length>1&&u(n)})}c(t),G(u=>E(o,u),[()=>A({key:ta().selection.indices.length>1?"timeline.pixel_count_plural":"timeline.pixel_count",replace:{count:ta().selection.indices.length}})]),S(f,t),ne()}je(["click"]);var ko=P('<div class="flex items-center gap-1.5"><span class="text-[10px]" aria-hidden="true">💾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand/80 uppercase"> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div>',1),Eo=P('<div class="flex items-center gap-3 text-charcoal/40" role="status"><!> <div class="flex gap-3 font-mono text-[9px] font-bold tracking-tight text-charcoal/60 uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div> <span class="font-mono text-[10px] font-black tracking-widest text-brand/60 uppercase"> </span></div>');function So(f,e){oe(e,!1),Ye();var t=Eo(),r=d(t);{var s=m=>{var _=ko(),y=Ie(_),w=h(d(y),2),C=d(w,!0);c(w),c(y),bt(2),G(R=>E(C,R),[()=>A({key:"project.saved",replace:{time:a.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}})]),de(3,y,()=>Le),S(m,_)};z(r,m=>{a.project.lastSaved&&m(s)})}var o=h(r,2),l=d(o),n=d(l);c(l);var u=h(l,2),v=d(u);c(u);var p=h(u,2),x=d(p);c(p),c(o);var b=h(o,4),g=d(b,!0);c(b),c(t),G((m,_)=>{E(n,`POS: ${a.cursor.pos.x??""},${a.cursor.pos.y??""}`),E(v,`SIZE: ${a.canvas.width??""}x${a.canvas.height??""}`),E(x,`ZOOM: ${m??""}%`),E(g,_)},[()=>Math.round(a.studio.zoomLevel*100),()=>A({key:"stats.technical_details"})]),S(f,t),ne()}var Lo=P('<div class="flex items-center gap-1 rounded-sm bg-brand/5 px-1.5 py-0.5 text-brand"><span class="text-[8px] font-bold">SYM:</span> <span class="font-black"><!></span></div>'),To=P("<span>🔒A</span>"),Co=P("<span>🔒C</span>"),Io=P('<div class="flex items-center gap-1 text-brand"><!> <!></div>'),Po=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">∞</div>'),Mo=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">☁️ MIST</div>'),Oo=P('<div class="bg-green-leaves/10 text-green-leaves flex items-center gap-1 rounded-sm px-1.5 py-0.5 font-bold">✨ PURE</div>'),Ro=P('<div class="flex animate-pulse items-center gap-1 rounded-sm bg-brand/20 px-1.5 py-0.5 font-bold text-brand">🚚 MOVING</div>'),Do=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🎨 STENCIL</div>'),jo=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand"> </div>'),Fo=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">📦 BOX</div>'),$o=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">⭕ ROUND</div>'),Bo=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand"> </div>'),Go=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">☀️ LIGHT</div>'),No=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🌙 DARK</div>'),Vo=P('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🏁 DITHER</div>'),Uo=P('<div class="flex items-center gap-3 font-serif text-[10px] tracking-wide text-charcoal/60"><div class="flex items-center gap-1"><span class="text-[8px] uppercase opacity-40"> </span> <span class="font-bold text-brand"> </span> <span class="opacity-40"> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!></div>');function Ho(f,e){oe(e,!1);const t=a.studio;Ye();var r=Uo(),s=d(r),o=d(s),l=d(o,!0);c(o);var n=h(o,2),u=d(n);c(n);var v=h(n,2),p=d(v,!0);c(v),c(s);var x=h(s,2);{var b=L=>{var I=Lo(),N=h(d(I),2),O=d(N);{var Q=Z=>{var ke=ot("—");S(Z,ke)},ve=Z=>{var ke=Xe(),Ce=Ie(ke);{var Ne=Re=>{var xe=ot("|");S(Re,xe)},qe=Re=>{var xe=ot("+");S(Re,xe)};z(Ce,Re=>{t.symmetryMode==="VERTICAL"?Re(Ne):Re(qe,!1)},!0)}S(Z,ke)};z(O,Z=>{t.symmetryMode==="HORIZONTAL"?Z(Q):Z(ve,!1)})}c(N),c(I),G(Z=>D(I,"title",Z),[()=>A({key:"labels.CYCLE_SYMMETRY"})]),de(3,I,()=>Le),S(L,I)};z(x,L=>{t.symmetryMode!=="OFF"&&L(b)})}var g=h(x,2);{var m=L=>{var I=Io(),N=d(I);{var O=Z=>{var ke=To();G(Ce=>D(ke,"title",Ce),[()=>A({key:"labels.TOGGLE_ALPHA_LOCK"})]),S(Z,ke)};z(N,Z=>{t.isAlphaLocked&&Z(O)})}var Q=h(N,2);{var ve=Z=>{var ke=Co();G(Ce=>D(ke,"title",Ce),[()=>A({key:"labels.TOGGLE_COLOR_LOCK"})]),S(Z,ke)};z(Q,Z=>{t.isColorLocked&&Z(ve)})}c(I),de(3,I,()=>Le),S(L,I)};z(g,L=>{(t.isAlphaLocked||t.isColorLocked)&&L(m)})}var _=h(g,2);{var y=L=>{var I=Po();G(N=>D(I,"title",N),[()=>A({key:"labels.TOGGLE_TILING"})]),de(3,I,()=>Le),S(L,I)};z(_,L=>{t.isTilingEnabled&&L(y)})}var w=h(_,2);{var C=L=>{var I=Mo();G(N=>D(I,"title",N),[()=>A({key:"labels.TOGGLE_AIRBRUSH"})]),de(3,I,()=>Le),S(L,I)};z(w,L=>{t.isAirbrushActive&&L(C)})}var R=h(w,2);{var F=L=>{var I=Oo();G(N=>D(I,"title",N),[()=>A({key:"labels.TOGGLE_PIXEL_PERFECT"})]),de(3,I,()=>Le),S(L,I)};z(R,L=>{t.isPixelPerfect&&L(F)})}var B=h(R,2);{var U=L=>{var I=Ro();G(N=>D(I,"title",N),[()=>A({key:"labels.TOOL_TRANSFORM"})]),de(3,I,()=>Le),S(L,I)};z(B,L=>{t.isTransforming&&L(U)})}var M=h(B,2);{var j=L=>{var I=Do();G(N=>D(I,"title",N),[()=>A({key:"labels.TOGGLE_PATTERN_BRUSH"})]),de(3,I,()=>Le),S(L,I)};z(M,L=>{t.isPatternBrushActive&&L(j)})}var $=h(M,2);{var V=L=>{var I=jo(),N=d(I);c(I),G(O=>{D(I,"title",O),E(N,`🍷 BLEND (${t.brushHardness??""}%)`)},[()=>A({key:"labels.TOGGLE_DITHER_BLEND"})]),de(3,I,()=>Le),S(L,I)};z($,L=>{t.isDitherBlendActive&&L(V)})}var K=h($,2);{var Y=L=>{var I=Fo();G(N=>D(I,"title",N),[()=>A({key:"labels.TOOL_RECTANGLE"})]),de(3,I,()=>Le),S(L,I)};z(K,L=>{t.activeTool==="RECTANGLE"&&L(Y)})}var ae=h(K,2);{var re=L=>{var I=$o();G(N=>D(I,"title",N),[()=>A({key:"labels.TOOL_ELLIPSE"})]),de(3,I,()=>Le),S(L,I)};z(ae,L=>{t.activeTool==="ELLIPSE"&&L(re)})}var ee=h(ae,2);{var te=L=>{var I=Bo(),N=d(I);c(I),G(O=>{D(I,"title",O),E(N,`⭐ POLY (${t.polygonSides??""})`)},[()=>A({key:"labels.TOOL_POLYGON"})]),de(3,I,()=>Le),S(L,I)};z(ee,L=>{t.activeTool==="POLYGON"&&L(te)})}var ce=h(ee,2);{var we=L=>{var I=Go();G(N=>D(I,"title",N),[()=>A({key:"labels.TOGGLE_SHADE_LIGHTEN"})]),de(3,I,()=>Le),S(L,I)};z(ce,L=>{t.isShadingLighten&&L(we)})}var Te=h(ce,2);{var fe=L=>{var I=No();G(N=>D(I,"title",N),[()=>A({key:"labels.TOGGLE_SHADE_DARKEN"})]),de(3,I,()=>Le),S(L,I)};z(Te,L=>{t.isShadingDarken&&L(fe)})}var me=h(Te,2);{var X=L=>{var I=Vo();G(N=>D(I,"title",N),[()=>A({key:"labels.TOGGLE_SHADE_DITHER"})]),de(3,I,()=>Le),S(L,I)};z(me,L=>{t.isShadingDither&&L(X)})}c(r),G((L,I)=>{D(s,"title",L),E(l,I),E(u,`${t.brushSize??""}px`),E(p,t.brushShape==="SQUARE"?"■":"●")},[()=>A({key:"labels.BRUSH_SIZE_INC"}),()=>A({key:"shortcut_groups.etching"})]),S(f,r),ne()}var zo=P('<div class="flex flex-1 items-center justify-between px-3 opacity-80 transition-opacity hover:opacity-100"><div class="flex items-center gap-4"><!> <div class="h-3 w-px bg-charcoal/20"></div> <!> <div class="h-3 w-px bg-charcoal/20"></div> <div class="flex items-center gap-3"><!> <div class="h-3 w-px bg-charcoal/20"></div> <!> <!> <div class="h-3 w-px bg-charcoal/20"></div> <!></div></div> <!></div>');function Yo(f){var e=zo(),t=d(e),r=d(t);ho(r,{});var s=h(r,4);xo(s,{});var o=h(s,4),l=d(o);Ho(l,{});var n=h(l,4);yo(n,{});var u=h(n,2);bo(u,{});var v=h(u,4);wo(v,{}),c(o),c(t);var p=h(t,2);So(p,{}),c(e),S(f,e)}var ut=ua(()=>a),Ko=P('<div class="flex items-center gap-4 border-r border-black/5 pr-4" role="toolbar" aria-label="Timeline Controls"><button><span class="text-xs" aria-hidden="true"> </span> <span class="font-tiny5 tracking-widest uppercase"> </span></button> <div class="flex items-center gap-2 rounded-xl bg-black/5 px-3 py-1 ring-1 ring-black/5"><label for="pace-input" class="font-serif text-[11px] font-black tracking-tight text-studio-text/50 uppercase"> </label> <input id="pace-input" type="number" min="1" max="60" class="w-10 bg-transparent text-center font-mono text-sm font-bold text-studio-text focus:outline-none"/> <span class="font-serif text-[10px] font-black text-studio-text/30" aria-hidden="true">FPS</span></div> <button><span class="text-xs" aria-hidden="true">👻</span> <span class="font-serif text-[11px] font-black tracking-wider text-studio-text/70 uppercase">Ghosts</span></button> <div class="flex items-center gap-2 border-l border-black/5 pl-4"><span class="text-xs opacity-40" aria-hidden="true">🔍</span> <input type="range" min="0.5" max="4" step="0.1" class="editor-range w-20 svelte-cffdjb" title="Timeline Zoom"/> <span class="w-8 font-mono text-[10px] font-bold text-studio-text/40"> </span></div></div>');function qo(f,e){oe(e,!1),Ye();var t=Ko(),r=d(t);r.__click=()=>Fa.togglePlayback();var s=d(r),o=d(s,!0);c(s);var l=h(s,2),n=d(l,!0);c(l),c(r);var u=h(r,2),v=d(u),p=d(v,!0);c(v);var x=h(v,2);Me(x),bt(2),c(u);var b=h(u,2);b.__click=()=>ut(ut().studio.showGhostLayers=!ut().studio.showGhostLayers);var g=h(b,2),m=h(d(g),2);Me(m);var _=h(m,2),y=d(_);c(_),c(g),c(t),G((w,C,R,F,B,U)=>{J(r,1,`editor-primary-btn flex items-center gap-2 !px-4 !py-1.5 text-xs ${ut().project.isPlaying?"bg-brand":"bg-slate-700"}`),D(r,"title",w),D(r,"aria-label",C),E(o,ut().project.isPlaying?"⏹":"▶"),E(n,ut().project.isPlaying?"Stop":"Play"),E(p,R),J(b,1,`flex items-center gap-2 rounded-xl px-3 py-1.5 transition-all ${ut().studio.showGhostLayers?"bg-brand/10 text-brand ring-1 ring-brand/20":"bg-black/5 opacity-40 shadow-sm hover:bg-white/60 hover:opacity-100"}`),D(b,"title",F),D(b,"aria-label",B),E(y,`${U??""}%`)},[()=>A({key:"labels.PLAY_PAUSE"})+" (P)",()=>A({key:"labels.PLAY_PAUSE"}),()=>A({key:"export.fps_label"}),()=>A({key:"labels.TOGGLE_GHOST_LAYERS"})+" (Alt+G)",()=>A({key:"labels.TOGGLE_GHOST_LAYERS"}),()=>Math.round(ut().studio.timelineZoom*100)]),Oe(x,()=>ut().project.fps,w=>ut(ut().project.fps=w)),Oe(m,()=>ut().studio.timelineZoom,w=>ut(ut().studio.timelineZoom=w)),S(f,t),ne()}je(["click"]);var Qo=P('<div style="width: var(--frame-width);"><div></div></div>');function Xo(f,e){oe(e,!0);let t=q(()=>e.layer?.hasContent||!1);var r=Qo();r.__click=function(...o){e.onclick?.apply(this,o)};var s=d(r);c(r),G(()=>{J(r,1,`flex h-6 items-center justify-center border-r border-black/5 transition-colors ${e.isActive?"bg-brand/10":"hover:bg-black/5"}`),J(s,1,`h-2 w-2 rounded-full transition-all ${i(t)?"scale-110 bg-brand shadow-sm":"border border-charcoal/20 bg-transparent opacity-30"} ${e.isActive?"ring-4 ring-brand/20":""}`)}),S(f,r),ne()}je(["click"]);var Wo=P('<div class="group absolute top-0 flex h-4 items-center justify-center rounded-t border-x border-t border-black/10 px-2 transition-all hover:h-5"><span class="truncate font-serif text-[8px] font-black text-studio-text/60 uppercase"> </span> <button class="ml-1 hidden h-3 w-3 items-center justify-center rounded-full bg-black/10 text-[6px] group-hover:flex hover:bg-brand hover:text-white">✕</button></div>');function Zo(f,e){oe(e,!0);const t=32;let r=q(()=>e.tag.from*t),s=q(()=>(e.tag.to-e.tag.from+1)*t);function o(){H.project.removeTag(e.tag.id)}var l=Wo(),n=d(l),u=d(n,!0);c(n);var v=h(n,2);v.__click=o,c(l),G(()=>{be(l,`left: ${i(r)??""}px; width: ${i(s)??""}px; background-color: ${e.tag.color??""}44; border-top-color: ${e.tag.color??""};`),D(l,"title",e.tag.name),E(u,e.tag.name)}),S(f,l),ne()}je(["click"]);var Jo=P('<div class="h-4 shrink-0 overflow-hidden bg-black/5"><div class="relative h-full"></div></div>'),en=P("<span> </span>"),tn=P('<span class="mt-0.5 font-mono text-[7px] leading-none font-bold text-charcoal/20"> </span>'),an=P("<div><div></div> <!></div>"),rn=P('<button><span class="truncate font-serif text-[9px] font-bold uppercase"> </span></button>'),sn=P('<div class="flex h-6 border-b border-black/5"></div>'),on=P('<div class="relative flex min-h-0 flex-1 flex-col overflow-hidden rounded border border-charcoal/10 bg-stone-light/30 shadow-inner"><!> <div class="flex h-6 shrink-0 border-b border-charcoal/5 bg-foam-white/95"><div class="z-40 flex w-32 shrink-0 items-center border-r border-charcoal/10 bg-foam-white px-2 font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Infusions</div> <div class="relative flex-1 overflow-hidden" role="presentation"><div class="absolute inset-0 flex items-center"></div></div></div> <div class="custom-scrollbar min-h-0 flex-1 overflow-auto svelte-8wcczq" role="grid" aria-label="The Drop Matrix"><div class="relative flex"><div class="sticky left-0 z-30 flex w-32 shrink-0 flex-col border-r border-charcoal/10 bg-foam-white/95 shadow-sm"></div> <div class="relative flex flex-1 flex-col"><!> <div class="pointer-events-none absolute top-0 bottom-0 z-20 w-px bg-brand transition-all duration-75 ease-linear"><div class="absolute -top-0.5 -left-1 h-2 w-2 rotate-45 rounded-sm bg-brand shadow-sm"></div></div></div></div></div></div>');function nn(f,e){oe(e,!0);let t=T(void 0),r=T(0);const s=32;let o=q(()=>s*a.studio.timelineZoom);function l($){const V=$.target;k(r,V.scrollLeft,!0)}function n($,V){a.project.activeFrameIndex=$,a.project.activeFrame.activeLayerIndex=V}let u=q(()=>a.project.activeFrameIndex*i(o)+i(o)/2);pt(()=>{if(i(t)&&a.project.isPlaying){const $=i(t).clientWidth/2;i(u)>$&&(i(t).scrollLeft=i(u)-$)}});let v=q(()=>a.project.frames.length*i(o)+400),p=q(()=>{const $=[],V=a.project.fps,K=a.studio.timelineZoom,Y=a.project.frames.length;let ae=1;K>3?ae=.1:K>2?ae=.2:K>1.2&&(ae=.5);const re=Math.max(1,Math.round(V*ae)),ee=Math.ceil(i(v)/i(o));for(let te=0;te<ee;te++){const ce=te%re===0,we=te%V===0,Te=te%5===0,fe=te>=Y;if(ce){const me=te/V,X=me%1===0?`${me}s`:`${me.toFixed(1)}s`;$.push({index:te,isMajor:we,label:X,isFuture:fe})}else Te&&$.push({index:te,isMajor:!1,isFuture:fe})}return $});function x($){const V=$.currentTarget.getBoundingClientRect(),K=$.clientX-V.left+i(r),Y=Math.floor(K/i(o));Y>=0&&Y<a.project.frames.length&&(a.project.activeFrameIndex=Y)}function b($){if($.ctrlKey){$.preventDefault();const V=$.deltaY>0?-.1:.1;a.studio.timelineZoom=Math.max(.5,Math.min(4,a.studio.timelineZoom+V))}}var g=on(),m=d(g);{var _=$=>{var V=Jo(),K=d(V);De(K,21,()=>a.project.tags,Y=>Y.id,(Y,ae)=>{Zo(Y,{get tag(){return i(ae)}})}),c(K),c(V),G(()=>be(K,`width: ${i(v)??""}px; margin-left: 128px; transform: translateX(-${i(r)??""}px);`)),S($,V)};z(m,$=>{a.project.tags.length>0&&$(_)})}var y=h(m,2),w=h(d(y),2);w.__click=x;var C=d(w);De(C,21,()=>i(p),Ue,($,V)=>{var K=an(),Y=d(K),ae=h(Y,2);{var re=te=>{var ce=en(),we=d(ce,!0);c(ce),G(()=>{J(ce,1,`font-mono text-[7px] font-black ${i(V).isMajor&&!i(V).isFuture?"text-brand":"text-charcoal/40"} mt-0.5 leading-none`),E(we,i(V).label)}),S(te,ce)},ee=te=>{var ce=Xe(),we=Ie(ce);{var Te=fe=>{var me=tn(),X=d(me,!0);c(me),G(()=>E(X,i(V).index+1)),S(fe,me)};z(we,fe=>{i(V).index%5===0&&fe(Te)},!0)}S(te,ce)};z(ae,te=>{i(V).label?te(re):te(ee,!1)})}c(K),G(()=>{J(K,1,`absolute flex flex-col items-center transition-opacity duration-300 ${i(V).isFuture?"opacity-20":"opacity-100"}`),be(K,`left: ${i(V).index*i(o)}px; width: ${i(o)??""}px;`),J(Y,1,`w-px bg-charcoal/20 ${i(V).isMajor?"h-2":"h-1"}`)}),S($,K)}),c(C),c(w),c(y);var R=h(y,2),F=d(R),B=d(F);De(B,21,()=>a.project.activeFrame.layers,Ue,($,V,K)=>{var Y=rn();Y.__click=()=>a.project.activeFrame.activeLayerIndex=K;var ae=d(Y),re=d(ae,!0);c(ae),c(Y),G(()=>{J(Y,1,`flex h-6 w-full items-center px-2 text-left transition-colors ${K===a.project.activeFrame.activeLayerIndex?"bg-brand/5 text-brand":"text-charcoal/60 hover:bg-black/5"}`),E(re,i(V).name)}),S($,Y)}),c(B);var U=h(B,2),M=d(U);De(M,17,()=>a.project.activeFrame.layers,Ue,($,V,K)=>{var Y=sn();De(Y,21,()=>a.project.frames,Ue,(ae,re,ee)=>{{let te=q(()=>ee===a.project.activeFrameIndex&&K===a.project.activeFrame.activeLayerIndex);Xo(ae,{get layer(){return i(re).layers[K]},frameIndex:ee,get isActive(){return i(te)},onclick:()=>n(ee,K)})}}),c(Y),S($,Y)});var j=h(M,2);c(U),c(F),c(R),Yt(R,$=>k(t,$),()=>i(t)),c(g),G(()=>{be(C,`width: ${i(v)??""}px; min-width: 100%; transform: translateX(-${i(r)??""}px);`),be(F,`width: ${i(v)+128}px; min-height: 100%; --frame-width: ${i(o)??""}px;`),be(j,`left: ${i(u)??""}px;`)}),Ze("scroll",R,l),Ze("wheel",R,b),S(f,g),ne()}je(["click"]);var ln=P('<div role="region" aria-label="Timeline"><div class="flex items-center justify-between border-b border-charcoal/5 pb-1"><div class="flex items-center gap-6"><div class="flex items-center gap-2"><span class="text-[10px] opacity-30" aria-hidden="true">⏳</span> <span class="font-tiny5 text-[9px] tracking-[0.2em] text-charcoal/40 uppercase"> </span></div> <!></div> <div class="flex items-center gap-4"><div class="mr-4 flex flex-col items-end"><span class="font-serif text-[7px] font-black tracking-widest text-charcoal/20 uppercase"> </span> <span class="font-mono text-[9px] font-bold text-brand/40"> </span></div> <div class="flex items-center gap-1 border-l border-charcoal/10 pl-4"><button class="flex h-5 w-5 items-center justify-center rounded transition-colors hover:bg-black/5"><span class="text-[10px] opacity-40"> </span></button> <button class="flex h-5 w-5 items-center justify-center rounded transition-colors hover:bg-black/5"><span class="text-[10px] opacity-40"> </span></button></div></div></div> <div><!></div></div>');function cn(f,e){oe(e,!0);let t=q(()=>a.studio.isTimelineMinimized?"h-12":a.studio.isTimelineMaximized?"h-[75vh]":"h-40");function r(){a.studio.isTimelineMinimized=!a.studio.isTimelineMinimized,a.studio.isTimelineMinimized&&(a.studio.isTimelineMaximized=!1)}function s(){a.studio.isTimelineMaximized=!a.studio.isTimelineMaximized,a.studio.isTimelineMaximized&&(a.studio.isTimelineMinimized=!1)}var o=ln(),l=d(o),n=d(l),u=d(n),v=h(d(u),2),p=d(v,!0);c(v),c(u);var x=h(u,2);qo(x,{}),c(n);var b=h(n,2),g=d(b),m=d(g),_=d(m,!0);c(m);var y=h(m,2),w=d(y,!0);c(y),c(g);var C=h(g,2),R=d(C);R.__click=r;var F=d(R),B=d(F,!0);c(F),c(R);var U=h(R,2);U.__click=s;var M=d(U),j=d(M,!0);c(M),c(U),c(C),c(b),c(l);var $=h(l,2),V=d($);nn(V,{}),c($),c(o),G((K,Y,ae)=>{J(o,1,`flex ${i(t)??""} w-full flex-col gap-1 overflow-hidden bg-transparent px-4 py-2 transition-all duration-300 ease-in-out`),E(p,K),E(_,Y),E(w,ae),D(R,"title",a.studio.isTimelineMinimized?"Restore":"Minimize"),E(B,a.studio.isTimelineMinimized?"🔼":"🔽"),D(U,"title",a.studio.isTimelineMaximized?"Restore":"Maximize"),E(j,a.studio.isTimelineMaximized?"🗗":"⏫"),J($,1,`flex min-h-0 flex-1 flex-col overflow-hidden ${a.studio.isTimelineMinimized?"pointer-events-none opacity-0":"opacity-100"} transition-opacity duration-300`)},[()=>A({key:"timeline.title"}),()=>A({key:"timeline.track"}),()=>A({key:"timeline.frame_count",replace:{count:a.project.frames.length}})]),S(f,o),ne()}je(["click"]);var dn=P('<footer class="hud-panel flex w-full flex-col border-t border-charcoal/10 bg-foam-white p-1 svelte-1tnr1yh"><!> <div class="flex h-7 w-full items-center justify-between px-4"><div class="flex items-center gap-4"><!></div> <!></div></footer>');function un(f){var e=dn(),t=d(e);cn(t,{});var r=h(t,2),s=d(r),o=d(s);co(o,{}),c(s);var l=h(s,2);Yo(l),c(r),c(e),S(f,e)}var vn=P('<div class="absolute top-0 bottom-0 left-1/2 z-30 w-px -translate-x-1/2 border-l border-dashed border-brand shadow-sm"></div>'),pn=P('<div class="absolute top-1/2 right-0 left-0 z-30 h-px -translate-y-1/2 border-t border-dashed border-brand shadow-sm"></div>'),hn=P('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-charcoal/20"></div>'),fn=P('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-charcoal/20"></div>'),xn=P('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-charcoal/40"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-charcoal/40"></div> <!> <!> <!> <!></div>');function gn(f,e){oe(e,!1);const t=a.studio;Ye();var r=xn(),s=h(d(r),4);{var o=p=>{var x=vn();de(3,x,()=>Le),S(p,x)};z(s,p=>{(t.symmetryMode==="HORIZONTAL"||t.symmetryMode==="QUADRANT")&&p(o)})}var l=h(s,2);{var n=p=>{var x=pn();de(3,x,()=>Le),S(p,x)};z(l,p=>{(t.symmetryMode==="VERTICAL"||t.symmetryMode==="QUADRANT")&&p(n)})}var u=h(l,2);De(u,0,()=>[-24,-16,-8,8,16,24],Ue,(p,x)=>{const b=da(()=>Je.getGuidePosition(x,a.canvas.width));var g=Xe(),m=Ie(g);{var _=y=>{var w=hn();G(()=>be(w,`left: ${i(b)??""}%`)),S(y,w)};z(m,y=>{i(b)>0&&i(b)<100&&y(_)})}S(p,g)});var v=h(u,2);De(v,0,()=>[-24,-16,-8,8,16,24],Ue,(p,x)=>{const b=da(()=>Je.getGuidePosition(x,a.canvas.height));var g=Xe(),m=Ie(g);{var _=y=>{var w=fn();G(()=>be(w,`top: ${i(b)??""}%`)),S(y,w)};z(m,y=>{i(b)>0&&i(b)<100&&y(_)})}S(p,g)}),c(r),S(f,r),ne()}var bn=jt('<line stroke-dasharray="0.2, 0.2" class="marching-ants-svg svelte-1onh8x1"></line>'),mn=jt('<line stroke="var(--color-brand)" stroke-width="0.05" stroke-dasharray="0.1, 0.1"></line>'),yn=jt('<circle r="0.2" fill="var(--color-brand)"></circle><!>',1),_n=jt('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><defs><pattern id="ants" width="1" height="1" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="1" y2="0" stroke="var(--ants-color)" stroke-width="0.1" stroke-dasharray="0.2, 0.2"></line></pattern></defs><!><!></svg><svg class="pointer-events-none absolute inset-0 z-[39] h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><path fill="var(--color-brand)" fill-opacity="0.1"></path></svg>',1);function An(f,e){oe(e,!0);let t=q(()=>a.selection.getBoundaryEdges(a.canvas.width)),r=q(()=>a.selection.vertices),s=q(()=>ze.current.type==="SELECT");var o=Xe(),l=Ie(o);{var n=u=>{var v=_n(),p=Ie(v),x=h(d(p));De(x,17,()=>i(t),Ue,(y,w)=>{var C=bn();D(C,"stroke-width",.08),G(()=>{D(C,"x1",i(w).x1),D(C,"y1",i(w).y1),D(C,"x2",i(w).x2),D(C,"y2",i(w).y2),D(C,"stroke",i(s)?"var(--color-brand)":"rgba(211, 54, 130, 0.8)")}),S(y,C)});var b=h(x);{var g=y=>{var w=Xe(),C=Ie(w);De(C,17,()=>i(r),Ue,(R,F,B)=>{const U=q(()=>i(r)[B+1]||i(r)[0]);var M=yn(),j=Ie(M),$=h(j);{var V=K=>{var Y=mn();G(()=>{D(Y,"x1",i(F).x+.5),D(Y,"y1",i(F).y+.5),D(Y,"x2",i(U).x+.5),D(Y,"y2",i(U).y+.5)}),S(K,Y)};z($,K=>{i(r).length>1&&B<i(r).length-(i(r).length>=3?0:1)&&K(V)})}G(()=>{D(j,"cx",i(F).x+.5),D(j,"cy",i(F).y+.5)}),S(R,M)}),S(y,w)};z(b,y=>{i(r).length>0&&y(g)})}c(p);var m=h(p),_=d(m);c(m),G(y=>{D(p,"viewBox",`0 0 ${a.canvas.width??""} ${a.canvas.height??""}`),D(m,"viewBox",`0 0 ${a.canvas.width??""} ${a.canvas.height??""}`),D(_,"d",y)},[()=>a.selection.getPoints(a.canvas.width).map(y=>`M${y.x},${y.y}h1v1h-1z`).join(" ")]),S(u,v)};z(l,u=>{a.selection.isActive&&u(n)})}S(f,o),ne()}var wn=P('<canvas class="pointer-events-none absolute inset-0 z-0 h-full w-full"></canvas>');function kn(f,e){oe(e,!0);let t=Ge(e,"opacity",3,.2),r=Ge(e,"tint",3,null),s=T(null);pt(()=>{const l=i(s)?.getContext("2d");if(!(!l||!i(s))){l.imageSmoothingEnabled=!1,l.clearRect(0,0,e.width,e.height);for(let n=0;n<e.pixels.length;n++){const u=e.pixels[n];if(u!==0){const v=r()||ue.uint32ToHex(u);l.fillStyle=v;const p=n%e.width,x=Math.floor(n/e.width);l.fillRect(p,x,1,1)}}}});var o=wn();Yt(o,l=>k(s,l),()=>i(s)),G(()=>{D(o,"width",e.width),D(o,"height",e.height),be(o,`opacity: ${t()??""}; image-rendering: pixelated;`)}),S(f,o),ne()}var En=P('<div class="absolute flex items-center justify-center"><span class="font-mono text-[8px] font-bold text-charcoal/40"> </span></div>'),Sn=P('<div class="pointer-events-none relative h-full w-full overflow-hidden bg-latte-foam/80 backdrop-blur-sm" role="presentation"><div><div></div> <div></div> <!> <div class="absolute z-20 bg-brand transition-all duration-75 ease-out"><div class="absolute top-1/2 left-1/2 rounded-sm bg-brand px-1 py-0.5 shadow-sm"><span class="font-mono text-[9px] leading-none font-bold text-white"> </span></div></div></div></div>');function er(f,e){oe(e,!0);let t=Ge(e,"orientation",3,"horizontal"),r=q(()=>a.canvas.width),s=q(()=>a.canvas.height),o=q(()=>t()==="horizontal"?i(r):i(s)),l=q(()=>t()==="horizontal"?a.cursor.pos.x:a.cursor.pos.y),n=q(()=>{const B=a.studio.zoomLevel;return B<=.5?16:B<=1.5?8:B<=4?4:2}),u=q(()=>a.canvas.getFitDimension(t())),v=q(()=>a.studio.zoomLevel),p=q(()=>{const B=[];for(let U=0;U<i(o);U++){const M=Je.toCartesianLabel(U,i(o),t()==="vertical");(M%i(n)===0||U===0||U===i(o)-1)&&B.push({pos:U,label:M})}return B}),x=q(()=>{if(i(v)<=1)return t()==="horizontal"?"translate(-50%, 0)":"translate(0, -50%)";const B=(i(l)+.5)/i(o)*100;return t()==="horizontal"?`translate(-${B}%, 0)`:`translate(0, -${B}%)`});var b=Sn(),g=d(b),m=d(g),_=h(m,2),y=h(_,2);De(y,17,()=>i(p),B=>B.pos,(B,U)=>{var M=En(),j=d(M),$=d(j,!0);c(j),c(M),G(()=>{be(M,`
					${t()==="horizontal"?"left":"top"}: ${i(U).pos/i(o)*100}%;
					${t()==="horizontal"?"width":"height"}: ${100/i(o)}%;
					${t()==="horizontal"?"height":"width"}: 100%;
					${t()==="horizontal"?"padding-bottom: 4px;":"padding-right: 4px;"}
				`),be(j,`transform: ${t()==="vertical"?"rotate(-90deg)":"none"};`),E($,i(U).label)}),S(B,M)});var w=h(y,2),C=d(w),R=d(C),F=d(R,!0);c(R),c(C),c(w),c(g),c(b),G(B=>{J(g,1,`absolute flex ${t()==="vertical"?"flex-col":""}`),be(g,`
			left: ${t()==="horizontal"?"50%":"0"};
			top: ${t()==="vertical"?"50%":"0"};
			transform: ${i(x)??""}; 
			${t()==="horizontal"?"width":"height"}: calc(${i(u)??""} * ${i(v)??""});
			${t()==="vertical"?"width":"height"}: 100%;
		`),J(m,1,`absolute opacity-10 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-1/2":"top-0 right-0 bottom-0 w-1/2"}`),be(m,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1px, transparent 1px);
				background-size: ${t()==="horizontal"?`calc(100% / ${i(o)}) 100%`:`100% calc(100% / ${i(o)})`};
			`),J(_,1,`absolute opacity-20 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-3/4":"top-0 right-0 bottom-0 w-3/4"}`),be(_,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1.5px, transparent 1.5px);
				background-size: ${t()==="horizontal"?`calc(100% / ${i(o)} * ${i(n)}) 100%`:`100% calc(100% / ${i(o)} * ${i(n)})`};
			`),be(w,`
				${t()==="horizontal"?"left":"top"}: ${(i(l)+.5)/i(o)*100}%;
				${t()==="horizontal"?"width: 1px; top: 0; bottom: 0;":"height: 1px; left: 0; right: 0;"}
			`),be(C,`transform: translate(-50%, -50%) ${t()==="vertical"?"rotate(-90deg)":""};`),E(F,B)},[()=>Je.toCartesianLabel(i(l),i(o),t()==="vertical")]),S(f,b),ne()}var Ln=P('<div class="absolute -top-3 -right-3 flex items-center justify-center rounded-full border-2 border-white bg-brand p-1 text-[8px] font-bold text-white shadow-lg ring-1 ring-black/5"><!></div>'),Tn=P('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),Cn=P('<div class="cursor-container absolute inset-0 svelte-13i93z"><div class="cursor-bloom transition-transform duration-200 svelte-13i93z"><div class="petal p-top svelte-13i93z"></div> <div class="petal p-bottom svelte-13i93z"></div> <div class="petal p-left svelte-13i93z"></div> <div class="petal p-right svelte-13i93z"></div> <div class="center-dot svelte-13i93z"></div></div> <!> <!></div>');function In(f,e){oe(e,!1);const t=a.studio;Ye();var r=Xe(),s=Ie(r);{var o=l=>{var n=Cn(),u=d(n),v=h(u,2);{var p=g=>{var m=Ln(),_=d(m);{var y=C=>{var R=ot("🔒");S(C,R)},w=C=>{var R=Xe(),F=Ie(R);{var B=M=>{var j=ot("☀️");S(M,j)},U=M=>{var j=Xe(),$=Ie(j);{var V=Y=>{var ae=ot("🌙");S(Y,ae)},K=Y=>{var ae=Xe(),re=Ie(ae);{var ee=te=>{var ce=ot("🏁");S(te,ce)};z(re,te=>{t.isShadingDither&&te(ee)},!0)}S(Y,ae)};z($,Y=>{t.isShadingDarken?Y(V):Y(K,!1)},!0)}S(M,j)};z(F,M=>{t.isShadingLighten?M(B):M(U,!1)},!0)}S(C,R)};z(_,C=>{t.isAlphaLocked||t.isColorLocked?C(y):C(w,!1)})}c(m),de(3,m,()=>Zt),S(g,m)};z(v,g=>{(t.isAlphaLocked||t.isColorLocked||t.isShadingLighten||t.isShadingDarken||t.isShadingDither)&&g(p)})}var x=h(v,2);{var b=g=>{var m=Tn(),_=Ie(m),y=h(_,2),w=d(y),C=d(w);c(w),bt(2),c(y),G(()=>{be(_,`background-color: ${a.activeColor??""};`),be(C,`background-color: ${a.activeColor??""};`)}),de(3,_,()=>Le,()=>({duration:400})),de(1,y,()=>Ba,()=>({y:-10,duration:400})),de(2,y,()=>Le,()=>({duration:400})),S(g,m)};z(x,g=>{a.isPicking&&g(b)})}c(n),G(()=>be(u,`transform: scale(${t.brushSize??""})`)),de(3,n,()=>Le,()=>({duration:800})),S(l,n)};z(s,l=>{a.isCursorVisible&&l(o)})}S(f,r),ne()}var Pn=P('<div class="pointer-events-none absolute inset-0 z-0 opacity-20 blur-[1px] grayscale"></div>'),Mn=P('<div class="pointer-events-none absolute inset-0 z-[5] overflow-hidden"><img alt="Underlay" class="absolute origin-top-left"/></div>'),On=jt('<rect fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></rect>'),Rn=jt('<ellipse fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></ellipse>'),Dn=jt('<polyline fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></polyline><line stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></line>',1),jn=jt('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg>'),Fn=jt('<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline>'),$n=P('<div class="canvas-viewport relative grid h-full w-full grid-cols-[20px_1fr] grid-rows-[20px_1fr] overflow-hidden svelte-e4xfdd"><div class="z-[110] border-r border-b border-charcoal/10 bg-foam-white/90 backdrop-blur-md" aria-hidden="true"></div> <div class="relative z-[100] border-b border-charcoal/10"><!></div> <div class="relative z-[100] border-r border-charcoal/10"><!></div> <div class="relative flex flex-1 items-center justify-center overflow-hidden bg-charcoal/[0.02]"><!> <div class="canvas-container absolute top-1/2 left-1/2 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] svelte-e4xfdd"><div class="relative h-full w-full shadow-[0_20px_60px_rgba(0,0,0,0.12)] ring-1 ring-charcoal/5 outline-none focus:ring-2 focus:ring-brand" role="grid" tabindex="0"><!> <!> <!> <canvas class="pointer-events-none absolute inset-0 h-full w-full" style="image-rendering: pixelated;"></canvas> <!> <div class="pixel-grid-surface pointer-events-none absolute inset-0 z-10 h-full w-full"></div> <div class="pointer-events-none absolute inset-0 z-30 overflow-hidden"><div class="absolute transition-all duration-75 ease-out"><!></div></div> <svg class="pointer-events-none absolute inset-0 z-[20] h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg> <!></div></div></div></div>');function Bn(f,e){oe(e,!0);let t=T(null),r=T(null),s=q(()=>a.canvas.width),o=q(()=>a.canvas.height),l=q(()=>{if(!a.showGhostLayers)return[];const X=a.project.activeFrameIndex,L=a.project.frames,I=[];for(let N=1;N<=3;N++){const O=X-N;O>=0&&I.push({id:`past-${O}`,pixels:L[O].compositePixels,opacity:.4/N,tint:"#268bd2"})}for(let N=1;N<=3;N++){const O=X+N;O<L.length&&I.push({id:`future-${O}`,pixels:L[O].compositePixels,opacity:.4/N,tint:"#859900"})}return I}),n=q(()=>Ct.isSnappedState),u=q(()=>a.canvas.strokePoints.map(X=>`${X.x},${X.y}`).join(" ")),v=q(()=>a.studio.isTilingEnabled),p=T("");function x(X){if(X.ctrlKey){X.preventDefault();const L=X.deltaY>0?-.1:.1;a.studio.setZoom(L)}}pt(()=>{if(a.canvas.renderPulse===-1)return;const X=i(r)?.getContext("2d",{alpha:!0}),L=a.canvas.compositePixels;if(!X||!i(r))return;X.imageSmoothingEnabled=!1;const I=X.createImageData(i(s),i(o));new Uint32Array(I.data.buffer).set(L),X.putImageData(I,0,0),i(v)&&k(p,i(r).toDataURL(),!0)});var b=$n();Ze("pointermove",Ca,X=>i(t)&&Ct.handleMove(X,i(t))),Ze("pointerup",Ca,()=>Ct.handleEnd());var g=h(d(b),2),m=d(g);er(m,{orientation:"horizontal"}),c(g);var _=h(g,2),y=d(_);er(y,{orientation:"vertical"}),c(_);var w=h(_,2),C=d(w);{var R=X=>{var L=Pn();G((I,N)=>be(L,`
					background-image: url(${i(p)??""});
					background-repeat: repeat;
					background-size: ${I??""} ${N??""};
					background-position: center;
					transform: ${a.cameraTransform??""};
				`),[()=>a.canvas.getFitDimension("horizontal"),()=>a.canvas.getFitDimension("vertical")]),de(3,L,()=>Le),S(X,L)};z(C,X=>{i(v)&&X(R)})}var F=h(C,2),B=d(F);B.__contextmenu=X=>X.preventDefault(),B.__pointerdown=X=>i(t)&&Ct.handleStart(X,i(t));var U=d(B);gn(U,{});var M=h(U,2);{var j=X=>{var L=Mn(),I=d(L);c(L),G(()=>{be(L,`opacity: ${a.studio.underlayOpacity??""}`),D(I,"src",a.studio.underlayImage),be(I,`
								transform: translate(${a.studio.underlayOffset.x??""}px, ${a.studio.underlayOffset.y??""}px) scale(${a.studio.underlayScale??""});
								image-rendering: auto;
							`)}),de(3,L,()=>Le),S(X,L)};z(M,X=>{a.studio.underlayImage&&a.studio.isUnderlayVisible&&X(j)})}var $=h(M,2);{var V=X=>{var L=Xe(),I=Ie(L);De(I,17,()=>i(l),N=>N.id,(N,O)=>{kn(N,{get pixels(){return i(O).pixels},get width(){return i(s)},get height(){return i(o)},get opacity(){return i(O).opacity},get tint(){return i(O).tint}})}),S(X,L)};z($,X=>{a.showGhostLayers&&X(V)})}var K=h($,2);Yt(K,X=>k(r,X),()=>i(r));var Y=h(K,2);{var ae=X=>{const L=q(()=>a.studio.shapeAnchor),I=q(()=>a.cursor.pos),N=q(()=>Math.min(i(L).x,i(I).x)),O=q(()=>Math.min(i(L).y,i(I).y)),Q=q(()=>Math.max(i(L).x,i(I).x)),ve=q(()=>Math.max(i(L).y,i(I).y)),Z=q(()=>i(Q)-i(N)+1),ke=q(()=>i(ve)-i(O)+1);var Ce=jn(),Ne=d(Ce);{var qe=xe=>{var Ve=On();G(()=>{D(Ve,"x",i(N)),D(Ve,"y",i(O)),D(Ve,"width",i(Z)),D(Ve,"height",i(ke))}),S(xe,Ve)},Re=xe=>{var Ve=Xe(),Ke=Ie(Ve);{var nt=ge=>{var Se=Rn();G(()=>{D(Se,"cx",i(N)+i(Z)/2),D(Se,"cy",i(O)+i(ke)/2),D(Se,"rx",i(Z)/2),D(Se,"ry",i(ke)/2)}),S(ge,Se)},Fe=ge=>{var Se=Xe(),$e=Ie(Se);{var lt=We=>{const ct=q(()=>(i(L).x+i(I).x)/2),le=q(()=>(i(L).y+i(I).y)/2),ye=q(()=>Math.max(Math.abs(i(I).x-i(L).x),Math.abs(i(I).y-i(L).y))/2),Ee=q(()=>a.studio.polygonSides),Be=q(()=>a.studio.polygonIndentation),mt=q(()=>Array.from({length:i(Be)>0?i(Ee)*2:i(Ee)}).map((W,ie)=>{const _e=-Math.PI/2+ie*2*Math.PI/(i(Be)>0?i(Ee)*2:i(Ee)),Pe=i(Be)>0?ie%2===0?i(ye):i(ye)*(1-i(Be)/100):i(ye);return`${i(ct)+.5+Math.cos(_e)*Pe},${i(le)+.5+Math.sin(_e)*Pe}`}));var wt=Dn(),Ft=Ie(wt),yt=h(Ft);G((W,ie,_e,Pe,Qe)=>{D(Ft,"points",W),D(yt,"x1",ie),D(yt,"y1",_e),D(yt,"x2",Pe),D(yt,"y2",Qe)},[()=>i(mt).join(" "),()=>i(ct)+.5+Math.cos(-Math.PI/2+((i(Be)>0?i(Ee)*2:i(Ee))-1)*2*Math.PI/(i(Be)>0?i(Ee)*2:i(Ee)))*(i(Be)>0?((i(Be)>0?i(Ee)*2:i(Ee))-1)%2===0?i(ye):i(ye)*(1-i(Be)/100):i(ye)),()=>i(le)+.5+Math.sin(-Math.PI/2+((i(Be)>0?i(Ee)*2:i(Ee))-1)*2*Math.PI/(i(Be)>0?i(Ee)*2:i(Ee)))*(i(Be)>0?((i(Be)>0?i(Ee)*2:i(Ee))-1)%2===0?i(ye):i(ye)*(1-i(Be)/100):i(ye)),()=>i(ct)+.5+Math.cos(-Math.PI/2)*i(ye),()=>i(le)+.5+Math.sin(-Math.PI/2)*i(ye)]),S(We,wt)};z($e,We=>{a.studio.activeTool==="POLYGON"&&We(lt)},!0)}S(ge,Se)};z(Ke,ge=>{a.studio.activeTool==="ELLIPSE"?ge(nt):ge(Fe,!1)},!0)}S(xe,Ve)};z(Ne,xe=>{a.studio.activeTool==="RECTANGLE"?xe(qe):xe(Re,!1)})}c(Ce),G(()=>D(Ce,"viewBox",`0 0 ${i(s)??""} ${i(o)??""}`)),S(X,Ce)};z(Y,X=>{a.studio.activeTool!=="BRUSH"&&a.studio.shapeAnchor&&X(ae)})}var re=h(Y,2),ee=h(re,2),te=d(ee),ce=d(te);In(ce,{}),c(te),c(ee);var we=h(ee,2),Te=d(we);{var fe=X=>{var L=Fn();G(()=>{D(L,"points",i(u)),D(L,"stroke",a.paletteState.activeColor),D(L,"stroke-width",i(n)?"0.08":"0.03"),D(L,"stroke-dasharray",i(n)?"none":"0.1 0.1"),J(L,0,`${i(n)?"drop-shadow-md":"marching-ants"} transition-all duration-300`,"svelte-e4xfdd"),be(L,`opacity: ${i(n)?"1":"0.4"}`)}),S(X,L)};z(Te,X=>{a.canvas.strokePoints.length>1&&X(fe)})}c(we);var me=h(we,2);An(me,{}),c(B),Yt(B,X=>k(t,X),()=>i(t)),c(F),c(w),c(b),G(X=>{be(F,`
				transform: ${a.cameraTransform??""};
				aspect-ratio: ${i(s)??""} / ${i(o)??""};
				width: ${X??""};
			`),be(B,`
										background-color: ${a.backgroundColor??""};
										touch-action: none;
										cursor: ${ze.current.type==="PAN"?Ct.isPointerDownActive?"grabbing":"grab":"crosshair"};
									`),D(K,"width",i(s)),D(K,"height",i(o)),be(re,`--grid-cols: ${i(s)??""}; --grid-rows: ${i(o)??""};`),be(te,`
							left: ${a.cursor.pos.x/i(s)*100}%; 
							top: ${a.cursor.pos.y/i(o)*100}%; 
							width: ${100/i(s)}%; 
							height: ${100/i(o)}%;
						`),D(we,"viewBox",`0 0 ${i(s)??""} ${i(o)??""}`)},[()=>a.canvas.getFitDimension("horizontal")]),Ze("wheel",b,x),S(f,b),ne()}je(["contextmenu","pointerdown"]);function Oa(f){return--f*f*f*f*f+1}const Gn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var Nn=P(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-canvas-bg" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');" role="dialog" aria-modal="true"><div class="absolute h-[500px] w-[500px] animate-pulse rounded-full bg-charcoal/5 blur-[120px]" aria-hidden="true"></div> <div class="relative flex flex-col items-center gap-2"><div class="mb-8 flex animate-bounce items-center justify-center"><img alt="Rupa Café Logo" class="h-32 w-auto drop-shadow-2xl transition-transform duration-[3s] ease-in-out"/></div> <div><!></div></div> <div class="absolute bottom-24 flex flex-col items-center gap-8"><div class="flex flex-col items-center gap-4"><div class="h-1 w-48 overflow-hidden rounded-full bg-charcoal/5 ring-1 ring-charcoal/10" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div></div></div> <div class="flex flex-col items-center gap-1 text-center"><span class="h-4 font-serif text-[11px] tracking-wide text-charcoal/60 italic"> </span> <span class="font-mono text-[8px] font-bold tracking-[0.3em] text-charcoal/20 uppercase"> </span></div></div></div></div>`);function Vn(f,e){oe(e,!0);let t=T(!0),r=T(0),s=T(0),o=T(!1);const l=5;function n(){Ae.emit("READY"),k(t,!1),setTimeout(()=>{a.isAppReady=!0,a.showGuideBook=!0},800)}sa(()=>{Ae.emit("STARTUP");const x=setInterval(()=>{if(i(r)<100){const b=Math.random()*15;k(r,Math.min(100,i(r)+b),!0),k(s,Math.min(l-1,Math.floor(i(r)/100*l)),!0)}else clearInterval(x),setTimeout(()=>{k(o,!0),n()},600)},400);return()=>{clearInterval(x)}});var u=Xe(),v=Ie(u);{var p=x=>{var b=Nn(),g=h(d(b),2),m=d(g),_=d(m);be(_,`transform: scale(${1+Math.sin(Date.now()/1500)*.05});`),c(m);var y=h(m,2),w=d(y);dr(w,{size:"lg"}),c(y),c(g);var C=h(g,2),R=d(C),F=d(R),B=d(F);c(F);var U=h(F,2),M=d(U),j=d(M,!0);c(M);var $=h(M,2),V=d($,!0);c($),c(U),c(R),c(C),c(b),G((K,Y,ae)=>{D(b,"aria-busy",!i(o)),D(b,"aria-label",K),D(_,"src",Gn),D(F,"aria-valuenow",i(r)),J(B,1,`h-full bg-charcoal/20 transition-all duration-500 ease-out ${i(o)?"bg-brand/40":""}`),be(B,`width: ${i(r)??""}%`),E(j,Y),E(V,ae)},[()=>A({key:"manual.title"}),()=>i(o)?A({key:"splash.welcome"}):A({key:`splash.phases.${i(s)}`}),()=>A({key:"splash.version",replace:{version:a.version}})]),de(1,m,()=>Zt,()=>({duration:1500,start:.9,easing:Oa})),de(1,y,()=>Ba,()=>({y:15,duration:1e3,delay:400,easing:Oa})),de(2,b,()=>Le,()=>({duration:1e3})),S(x,b)};z(v,x=>{i(t)&&x(p)})}S(f,u),ne()}var Un=P('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><div class="flex items-center gap-1.5"><span> </span> <span> </span></div> <span> </span></div> <input type="range"/></div>');function ha(f,e){oe(e,!0);let t=Ge(e,"value",15),r=Ge(e,"min",3,0),s=Ge(e,"step",3,1),o=Ge(e,"unit",3,""),l=Ge(e,"isHue",3,!1);var n=Un(),u=d(n),v=d(u),p=d(v),x=d(p,!0);c(p);var b=h(p,2),g=d(b,!0);c(b),c(v);var m=h(v,2),_=d(m);c(m),c(u);var y=h(u,2);Me(y);let w;c(n),G(C=>{E(x,e.icon),E(g,e.label),E(_,`${C??""}${o()??""}`),D(y,"min",r()),D(y,"max",e.max),D(y,"step",s()),w=J(y,1,"custom-slider svelte-6nviod",null,w,{"hue-slider":l()})},[()=>s()<1?t().toFixed(2):Math.round(t())]),Oe(y,t),S(f,n),ne()}var Hn=P('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="presentation"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-canvas-bg p-10 shadow-2xl" role="dialog" aria-labelledby="flavor-basin-title" aria-modal="true"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl" aria-hidden="true">⛲</span> <div class="flex flex-col"><h2 id="flavor-basin-title" class="font-tiny5 text-3xl leading-none text-brand"> </h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/40 uppercase"> </span></div></div> <div class="editor-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner" aria-label="Color Preview"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><label for="hex-input" class="font-mono text-xs font-bold text-studio-text/40"> </label> <input id="hex-input" type="text" class="w-full bg-transparent font-mono text-lg font-bold text-studio-text uppercase focus:outline-none"/></div> <div class="flex gap-3"><button class="editor-secondary-btn flex h-14 w-14 items-center justify-center p-0 text-xl"><span aria-hidden="true">🖌️</span></button> <button class="editor-primary-btn flex-1 py-4"> </button></div></div></div></div>');function Ga(f,e){oe(e,!0);let t=Ge(e,"value",15),r=T(0),s=T(0),o=T(0),l=T(1);pt(()=>{const ee=ue.toHSLA(t());Dt(()=>{k(r,ee.h,!0),k(s,ee.s,!0),k(o,ee.l,!0),k(l,ee.a,!0)})}),pt(()=>{const ee=ue.toHex({h:i(r),s:i(s),l:i(o),a:i(l)});Dt(()=>{t(ee)})}),pt(()=>(a.pushEscapeAction(e.onClose),()=>a.popEscapeAction(e.onClose)));var n=Hn();n.__mousedown=ee=>ee.target===ee.currentTarget&&e.onClose();var u=d(n),v=d(u),p=d(v),x=h(d(p),2),b=d(x),g=d(b,!0);c(b);var m=h(b,2),_=d(m,!0);c(m),c(x),c(p);var y=h(p,2);c(v);var w=h(v,2),C=d(w);{let ee=q(()=>A({key:"color_picker.label.hue"}));ha(C,{get label(){return i(ee)},icon:"🌈",max:360,unit:"°",isHue:!0,get value(){return i(r)},set value(te){k(r,te,!0)}})}var R=h(C,2);{let ee=q(()=>A({key:"color_picker.label.saturation"}));ha(R,{get label(){return i(ee)},icon:"🏺",max:100,unit:"%",get value(){return i(s)},set value(te){k(s,te,!0)}})}var F=h(R,2);{let ee=q(()=>A({key:"color_picker.label.lightness"}));ha(F,{get label(){return i(ee)},icon:"☀️",max:100,unit:"%",get value(){return i(o)},set value(te){k(o,te,!0)}})}var B=h(F,2);{let ee=q(()=>A({key:"color_picker.label.alpha"}));ha(B,{get label(){return i(ee)},icon:"💧",min:0,max:1,step:.01,unit:"",get value(){return i(l)},set value(te){k(l,te,!0)}})}c(w);var U=h(w,2),M=d(U),j=d(M),$=d(j,!0);c(j);var V=h(j,2);Me(V),c(M);var K=h(M,2),Y=d(K);Y.__click=()=>{H.pickColor(),e.onClose()};var ae=h(Y,2);ae.__click=function(...ee){e.onClose?.apply(this,ee)};var re=d(ae,!0);c(ae),c(K),c(U),c(u),c(n),G((ee,te,ce,we,Te,fe)=>{E(g,ee),E(_,te),be(y,`background-color: ${t()??""};`),E($,ce),D(Y,"title",we),D(Y,"aria-label",Te),E(re,fe)},[()=>A({key:"color_picker.title"}),()=>A({key:"color_picker.subtitle"}),()=>A({key:"color_picker.label.hex"}),()=>A({key:"color_picker.button.eye_dropper"}),()=>A({key:"color_picker.button.eye_dropper"}),()=>A({key:"color_picker.button.confirm"})]),Oe(V,t),de(1,u,()=>Zt,()=>({duration:200,start:.95})),de(2,u,()=>Zt,()=>({duration:150,start:1,opacity:0})),de(3,n,()=>Le,()=>({duration:150})),S(f,n),ne()}je(["mousedown","click"]);var zn=P("<span> </span>"),Yn=P('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function Kn(f,e){oe(e,!0);var t=Yn();t.__click=()=>{e.action.action(),e.onSelect()};var r=d(t),s=d(r,!0);c(r);var o=h(r,2);{var l=n=>{var u=zn(),v=d(u,!0);c(u),G(()=>{J(u,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),E(v,e.action.shortcut)}),S(n,u)};z(o,n=>{e.action.shortcut&&n(l)})}c(t),G(()=>{J(t,1,`editor-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),E(s,e.action.label)}),Ze("mouseenter",t,function(...n){e.onSelect?.apply(this,n)}),S(f,t),ne()}je(["click"]);var qn=P('<div class="p-8 text-center font-serif text-sm text-studio-text/40 italic"> </div>'),Qn=P('<div class="flex flex-col gap-1"></div>'),Xn=P('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="presentation"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/95 shadow-2xl" role="dialog" aria-labelledby="palette-title" aria-modal="true"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40" aria-hidden="true">📖</span> <h2 id="palette-title" class="sr-only"> </h2> <input id="palette-search" type="text" class="w-full bg-transparent font-serif text-xl text-studio-text focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-h74ewr" role="list"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div></div>');function Wn(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.showCommandPalette=!1),r=T(""),s=T(0);const l=it.getActions().map(j=>({...j,id:j.intent.toLowerCase().replace(/_/g,"-"),action:()=>{Tt.handleIntent(j.intent)}}));let n=q(()=>l.filter(j=>j.label.toLowerCase().includes(i(r).toLowerCase())));pt(()=>{i(r),k(s,0)}),pt(()=>{i(s),i(n);const j=document.querySelector(".editor-action-btn.active");j&&j.scrollIntoView({block:"nearest"})});function u(j){j.key==="ArrowDown"?(j.preventDefault(),k(s,(i(s)+1)%i(n).length)):j.key==="ArrowUp"?(j.preventDefault(),k(s,(i(s)-1+i(n).length)%i(n).length)):j.key==="Enter"?(j.preventDefault(),i(n)[i(s)]&&(i(n)[i(s)].action(),t()())):j.key==="Escape"&&t()()}sa(()=>document.getElementById("palette-search")?.focus());var v=Xn();v.__mousedown=j=>j.target===j.currentTarget&&t()(),v.__keydown=u;var p=d(v),x=d(p),b=h(d(x),2),g=d(b,!0);c(b);var m=h(b,2);Me(m),c(x);var _=h(x,2),y=d(_);{var w=j=>{var $=qn(),V=d($,!0);c($),G(K=>E(V,K),[()=>A({key:"hud.menu.catalog_no_results",replace:{query:i(r)}})]),S(j,$)},C=j=>{var $=Qn();De($,21,()=>i(n),Ue,(V,K,Y)=>{{let ae=q(()=>i(s)===Y);Kn(V,{get action(){return i(K)},get isSelected(){return i(ae)},onSelect:()=>k(s,Y,!0)})}}),c($),S(j,$)};z(y,j=>{i(n).length===0?j(w):j(C,!1)})}c(_);var R=h(_,2),F=d(R),B=d(F,!0);c(F);var U=h(F,2),M=d(U,!0);c(U),c(R),c(p),c(v),G((j,$,V,K)=>{E(g,j),D(m,"placeholder",$),E(B,V),E(M,K)},[()=>A({key:"hud.menu.catalog_title"}),()=>A({key:"hud.menu.catalog_search"}),()=>A({key:"hud.menu.catalog_footer"}),()=>A({key:"hud.menu.catalog_count",replace:{count:i(n).length}})]),Oe(m,()=>i(r),j=>k(r,j)),de(3,p,()=>Zt,()=>({duration:150,start:.98})),S(f,v),ne()}je(["mousedown","keydown"]);var Zn=P('<span class="text-2xl opacity-40"> </span>'),Jn=P('<span class="mt-1 font-serif text-[9px] font-black tracking-[0.2em] text-charcoal/30 uppercase"> </span>'),el=P('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-charcoal/20 backdrop-blur-md"><div class="flex flex-col gap-6 overflow-hidden rounded-xl border border-charcoal/10 bg-foam-white p-8 shadow-2xl" role="dialog" aria-modal="true" tabindex="-1"><div class="flex items-center justify-between border-b border-charcoal/5 pb-4"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-2xl leading-none text-charcoal"> </h2> <!></div></div> <button class="rounded-lg border border-charcoal/10 bg-stone-light/50 px-4 py-1.5 text-[9px] font-bold tracking-widest text-charcoal/40 uppercase transition-all hover:border-brand hover:bg-brand hover:text-white">Close</button></div> <div><!></div></div></div>');function It(f,e){oe(e,!0);let t=Ge(e,"title",3,""),r=Ge(e,"subtitle",3,""),s=Ge(e,"icon",3,""),o=Ge(e,"width",3,"500px"),l=Ge(e,"maxHeight",3,"85vh"),n=Ge(e,"scrollable",3,!0);pt(()=>(a.pushEscapeAction(e.onClose),()=>a.popEscapeAction(e.onClose)));function u(M,{duration:j=300}){return{duration:j,css:$=>{const V=Oa($);return`
					opacity: ${$};
					transform: scale(${.95+V*.05});
				`}}}var v=el();v.__mousedown=M=>{M.stopPropagation(),M.target===M.currentTarget&&e.onClose()};var p=d(v);p.__mousedown=M=>M.stopPropagation();var x=d(p),b=d(x),g=d(b);{var m=M=>{var j=Zn(),$=d(j,!0);c(j),G(()=>E($,s())),S(M,j)};z(g,M=>{s()&&M(m)})}var _=h(g,2),y=d(_),w=d(y,!0);c(y);var C=h(y,2);{var R=M=>{var j=Jn(),$=d(j,!0);c(j),G(()=>E($,r())),S(M,j)};z(C,M=>{r()&&M(R)})}c(_),c(b);var F=h(b,2);F.__click=function(...M){e.onClose?.apply(this,M)},c(x);var B=h(x,2),U=d(B);Kr(U,()=>e.children),c(B),c(p),c(v),G(()=>{be(p,`width: ${o()??""}; max-height: ${l()??""};`),E(w,t()),J(B,1,`custom-scrollbar flex-1 ${n()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),de(1,p,()=>u,()=>({duration:300})),de(2,p,()=>Le,()=>({duration:150})),de(3,v,()=>Le,()=>({duration:150})),S(f,v),ne()}je(["mousedown","click"]);var tl=P('<div class="flex flex-col items-center gap-3"><div class="editor-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function al(f,e){oe(e,!0);let t=T(null);pt(()=>{if(!i(t))return;const x=i(t).getContext("2d");if(!x)return;const b=a.canvas.width,g=a.canvas.height,m=a.canvas.compositePixels,_=a.studio.includePixelBorders,y=400,w=Math.min(y/b,y/g);i(t).width=b*w,i(t).height=g*w,x.imageSmoothingEnabled=!1,e.bgColor==="transparent"?x.clearRect(0,0,i(t).width,i(t).height):(x.fillStyle=e.bgColor,x.fillRect(0,0,i(t).width,i(t).height)),m.forEach((C,R)=>{if(C===0)return;const F=ue.uint32ToHex(C),B=R%b,U=Math.floor(R/b),M=Math.floor(B*w),j=Math.floor(U*w),$=Math.ceil(w),V=Math.ceil(w);x.fillStyle=F,x.fillRect(M,j,$,V),_&&(x.strokeStyle="rgba(0, 0, 0, 0.15)",x.lineWidth=1,x.strokeRect(M+.5,j+.5,$-1,V-1))})});var r=tl(),s=d(r),o=d(s);Yt(o,x=>k(t,x),()=>i(t)),c(s);var l=h(s,2),n=d(l),u=d(n,!0);c(n);var v=h(n,2),p=d(v,!0);c(v),c(l),c(r),G((x,b)=>{E(u,x),E(p,b)},[()=>A({key:"export.file_label",replace:{format:e.format}}),()=>A({key:"export.dimensions_label",replace:{width:Math.round(a.canvas.width*e.scale),height:Math.round(a.canvas.height*e.scale)}})]),S(f,r),ne()}var rl=P('<button role="radio"><span class="font-serif text-[9px] font-bold tracking-tight uppercase"> <!></span></button>'),sl=P('<div class="flex flex-col gap-3"><div role="radiogroup"><button role="radio"><span class="text-2xl" aria-hidden="true">🖼️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">🕸️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📷</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📐</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button></div> <div><div class="flex flex-col gap-1"><span class="font-serif text-[10px] font-bold tracking-widest text-studio-text/60 uppercase"> </span> <span class="font-serif text-[9px] text-studio-text/40"> </span></div> <div class="grid grid-cols-2 gap-2" role="radiogroup"></div></div></div>'),il=P('<div class="rounded-xl border border-brand/20 bg-brand/5 p-4 text-center"><span class="font-serif text-xs font-bold text-brand italic"> </span></div>'),ol=P('<div class="flex flex-col gap-3"><!> <div role="radiogroup"><button role="radio"><span class="text-2xl" aria-hidden="true">🎀</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">🎬</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📽️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📐</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button></div> <div><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/60 uppercase"> </label> <span class="font-serif text-[9px] text-studio-text/40"> </span></div> <input id="fps-input" type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div></div>'),nl=P('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span aria-hidden="true">🎨</span> </button>'),ll=P('<div class="flex flex-col gap-2"><div class="flex items-center justify-between font-serif text-[10px] font-bold tracking-widest text-brand uppercase"><span> </span> <span> </span></div> <div class="h-1.5 w-full overflow-hidden rounded-full bg-black/5 ring-1 ring-black/5"><div class="h-full bg-brand transition-all duration-300 ease-out"></div></div></div>'),cl=P('<span class="animate-spin text-2xl">⏳</span> <span> </span>',1),dl=P("<span> </span>"),ul=P('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5" role="img"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-6 overflow-y-auto pr-4" role="group"><div><button> </button> <button> </button></div> <!> <div><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="scale-input" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/60 uppercase"> </label> <span class="font-serif text-[9px] text-studio-text/40"> </span></div> <input id="scale-input" type="number" min="1" max="100" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/60 uppercase"> </span> <span class="font-serif text-[9px] text-charcoal/40"> </span></div> <button><div></div></button></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-[10px] font-bold tracking-widest text-studio-text/60 uppercase"> </span> <span class="font-serif text-[9px] text-studio-text/40"> </span></div> <div class="flex flex-wrap items-center gap-3" role="radiogroup"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" role="radio"></button> <button role="radio"></button> <button role="radio"></button> <div class="flex items-center gap-2"><button role="radio"></button></div></div> <!></div></div> <div class="flex flex-col gap-3"><!> <button><!></button></div></div></div>'),vl=P("<!> <!>",1);function pl(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.showExportMenu=!1),r=T("image"),s=T("png"),o=T(!1),l=T(!1),n=T(!1),u=T(He(a.backgroundColor)),v=q(()=>a.project.frames.length>1);function p(w){i(n)||(k(r,w,!0),w==="image"?k(s,"png"):i(v)?k(s,"gif"):(k(r,"image"),k(s,"png")))}function x(){if(i(n)){a.studio.show("Please wait, brewing in progress...");return}t()()}async function b(){if(i(n))return;if((["webm","gif","mp4"].includes(i(s))||i(s)==="svg"&&i(r)==="video")&&!i(v)){a.studio.show(A({key:"export.status.requires_frames"}));return}k(n,!0);try{await e.onExport(i(s),a.studio.exportScale,a.studio.exportBgColor)}finally{k(n,!1)}}sa(()=>{a.backgroundColor!=="#eee8d5"&&(a.studio.exportBgColor=a.backgroundColor,k(u,a.backgroundColor,!0),k(l,!0))}),pt(()=>{i(l)&&(a.studio.exportBgColor=i(u))});var g=vl(),m=Ie(g);{var _=w=>{Ga(w,{onClose:()=>k(o,!1),get value(){return i(u)},set value(C){k(u,C,!0)}})};z(m,w=>{i(o)&&w(_)})}var y=h(m,2);{let w=q(()=>A({key:"export.title"})),C=q(()=>A({key:"export.subtitle"}));It(y,{get title(){return i(w)},get subtitle(){return i(C)},icon:"🧺",onClose:x,width:"1000px",scrollable:!1,children:(R,F)=>{var B=ul(),U=d(B),M=d(U);al(M,{get format(){return i(s)},get scale(){return a.studio.exportScale},get bgColor(){return a.studio.exportBgColor}}),c(U);var j=h(U,2),$=d(j),V=d($);V.__click=()=>p("image");var K=d(V,!0);c(V);var Y=h(V,2);Y.__click=()=>p("video");var ae=d(Y,!0);c(Y),c($);var re=h($,2);{var ee=W=>{var ie=sl(),_e=d(ie),Pe=d(_e);Pe.__click=()=>k(s,"png");var Qe=h(d(Pe),2),et=d(Qe),kt=d(et,!0);c(et),c(Qe),c(Pe);var tt=h(Pe,2);tt.__click=()=>k(s,"webp");var Et=h(d(tt),2),rt=d(Et),$t=d(rt,!0);c(rt),c(Et),c(tt);var ht=h(tt,2);ht.__click=()=>k(s,"jpg");var Bt=h(d(ht),2),ft=d(Bt),Gt=d(ft,!0);c(ft),c(Bt),c(ht);var St=h(ht,2);St.__click=()=>k(s,"svg");var Jt=h(d(St),2),Lt=d(Jt),ea=d(Lt,!0);c(Lt),c(Jt),c(St),c(_e);var Nt=h(_e,2),Kt=d(Nt),Pt=d(Kt),qt=d(Pt,!0);c(Pt);var Vt=h(Pt,2),ia=d(Vt,!0);c(Vt),c(Kt);var Qt=h(Kt,2);De(Qt,20,()=>["ACTIVE","VISIBLE","SELECTED","ALL"],Ue,(Xt,xt)=>{const _t=q(()=>xt==="ACTIVE"?1:xt==="VISIBLE"?a.project.frames.filter(Wt=>Wt.isVisible).length:xt==="SELECTED"?a.project.selectedFrameIndices.size:a.project.frames.length);var dt=rl();dt.__click=()=>a.studio.exportFrameSelection=xt;var Mt=d(dt),Ut=d(Mt),oa=h(Ut);{var ma=Wt=>{var Na=ot();G(()=>E(Na,`(${i(_t)??""})`)),S(Wt,Na)};z(oa,Wt=>{xt!=="ACTIVE"&&Wt(ma)})}c(Mt),c(dt),G(Wt=>{J(dt,1,`rounded-lg border px-2 py-2 text-center transition-all ${a.studio.exportFrameSelection===xt?"border-brand bg-white text-brand shadow-sm":"border-transparent bg-white/20 text-studio-text/50 hover:bg-white/40"}`),D(dt,"aria-checked",a.studio.exportFrameSelection===xt),E(Ut,`${Wt??""} `)},[()=>A({key:`export.selection.${xt.toLowerCase()}`})]),S(Xt,dt)}),c(Qt),c(Nt),c(ie),G((Xt,xt,_t,dt,Mt,Ut)=>{J(_e,1,`grid grid-cols-2 gap-3 ${i(n)?"pointer-events-none opacity-50":""}`),J(Pe,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(Pe,"aria-checked",i(s)==="png"),E(kt,Xt),J(tt,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="webp"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(tt,"aria-checked",i(s)==="webp"),E($t,xt),J(ht,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="jpg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(ht,"aria-checked",i(s)==="jpg"),E(Gt,_t),J(St,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="svg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(St,"aria-checked",i(s)==="svg"),E(ea,dt),J(Nt,1,`mt-2 flex flex-col gap-4 rounded-xl border border-black/5 bg-black/5 p-4 ${i(n)?"pointer-events-none opacity-50":""}`),E(qt,Mt),E(ia,Ut)},[()=>A({key:"export.format.png"}),()=>A({key:"export.format.webp"}),()=>A({key:"export.format.jpg"}),()=>A({key:"export.format.svg_static"}),()=>A({key:"export.label.selection"}),()=>A({key:"export.description.selection"})]),de(3,ie,()=>Le,()=>({duration:150})),S(W,ie)},te=W=>{var ie=ol(),_e=d(ie);{var Pe=_t=>{var dt=il(),Mt=d(dt),Ut=d(Mt,!0);c(Mt),c(dt),G(oa=>E(Ut,oa),[()=>A({key:"export.status.requires_frames"})]),S(_t,dt)};z(_e,_t=>{i(v)||_t(Pe)})}var Qe=h(_e,2),et=d(Qe);et.__click=()=>k(s,"gif");var kt=h(d(et),2),tt=d(kt),Et=d(tt,!0);c(tt),c(kt),c(et);var rt=h(et,2);rt.__click=()=>k(s,"webm");var $t=h(d(rt),2),ht=d($t),Bt=d(ht,!0);c(ht),c($t),c(rt);var ft=h(rt,2);ft.__click=()=>k(s,"mp4");var Gt=h(d(ft),2),St=d(Gt),Jt=d(St,!0);c(St),c(Gt),c(ft);var Lt=h(ft,2);Lt.__click=()=>k(s,"svg");var ea=h(d(Lt),2),Nt=d(ea),Kt=d(Nt,!0);c(Nt),c(ea),c(Lt),c(Qe);var Pt=h(Qe,2),qt=d(Pt),Vt=d(qt),ia=d(Vt,!0);c(Vt);var Qt=h(Vt,2),Xt=d(Qt,!0);c(Qt),c(qt);var xt=h(qt,2);Me(xt),c(Pt),c(ie),G((_t,dt,Mt,Ut,oa,ma)=>{J(Qe,1,`grid grid-cols-2 gap-3 ${!i(v)||i(n)?"pointer-events-none opacity-40":""}`),J(et,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="gif"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(et,"aria-checked",i(s)==="gif"),E(Et,_t),J(rt,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="webm"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(rt,"aria-checked",i(s)==="webm"),E(Bt,dt),J(ft,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="mp4"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(ft,"aria-checked",i(s)==="mp4"),E(Jt,Mt),J(Lt,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${i(s)==="svg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),D(Lt,"aria-checked",i(s)==="svg"),E(Kt,Ut),J(Pt,1,`mt-2 flex items-center justify-between rounded-xl bg-black/5 p-4 ${i(n)?"pointer-events-none opacity-50":""}`),E(ia,oa),E(Xt,ma)},[()=>A({key:"export.format.gif"}),()=>A({key:"export.format.webm"}),()=>A({key:"export.format.mp4"}),()=>A({key:"export.format.svg_kinetic"}),()=>A({key:"export.label.fps"}),()=>A({key:"export.description.fps"})]),Oe(xt,()=>a.project.fps,_t=>a.project.fps=_t),de(3,ie,()=>Le,()=>({duration:150})),S(W,ie)};z(re,W=>{i(r)==="image"?W(ee):W(te,!1)})}var ce=h(re,2),we=d(ce),Te=d(we),fe=d(Te),me=d(fe,!0);c(fe);var X=h(fe,2),L=d(X,!0);c(X),c(Te);var I=h(Te,2);Me(I),c(we);var N=h(we,4),O=d(N),Q=d(O),ve=d(Q,!0);c(Q);var Z=h(Q,2),ke=d(Z,!0);c(Z),c(O);var Ce=h(O,2);Ce.__click=()=>a.studio.includePixelBorders=!a.studio.includePixelBorders;var Ne=d(Ce);c(Ce),c(N);var qe=h(N,4),Re=d(qe),xe=d(Re),Ve=d(xe,!0);c(xe);var Ke=h(xe,2),nt=d(Ke,!0);c(Ke),c(Re);var Fe=h(Re,2),ge=d(Fe);ge.__click=()=>{a.studio.exportBgColor="transparent",k(l,!1)};var Se=h(ge,2);Se.__click=()=>{a.studio.exportBgColor="#eee8d5",k(l,!1)};var $e=h(Se,2);$e.__click=()=>{a.studio.exportBgColor="#000000",k(l,!1)};var lt=h($e,2),We=d(lt);We.__click=()=>{k(l,!0),a.studio.exportBgColor=i(u),k(o,!0)},c(lt),c(Fe);var ct=h(Fe,2);{var le=W=>{var ie=nl();ie.__click=()=>{k(u,a.backgroundColor,!0),a.studio.exportBgColor=i(u)};var _e=h(d(ie));c(ie),G(Pe=>E(_e,` ${Pe??""}`),[()=>A({key:"export.background.match_canvas"})]),S(W,ie)};z(ct,W=>{a.backgroundColor!=="#eee8d5"&&W(le)})}c(qe),c(ce);var ye=h(ce,2),Ee=d(ye);{var Be=W=>{var ie=ll(),_e=d(ie),Pe=d(_e),Qe=d(Pe,!0);c(Pe);var et=h(Pe,2),kt=d(et);c(et),c(_e);var tt=h(_e,2),Et=d(tt);c(tt),c(ie),G(rt=>{E(Qe,rt),E(kt,`${a.studio.exportProgress??""}%`),be(Et,`width: ${a.studio.exportProgress??""}%`)},[()=>A({key:"export.status.progress"})]),de(3,ie,()=>Le),S(W,ie)};z(Ee,W=>{i(n)&&W(Be)})}var mt=h(Ee,2);mt.__click=b;var wt=d(mt);{var Ft=W=>{var ie=cl(),_e=h(Ie(ie),2),Pe=d(_e,!0);c(_e),G(Qe=>E(Pe,Qe),[()=>A({key:"export.status.brewing"})]),S(W,ie)},yt=W=>{var ie=dl(),_e=d(ie,!0);c(ie),G(Pe=>E(_e,Pe),[()=>A({key:"export.button.submit"})]),S(W,ie)};z(wt,W=>{i(n)?W(Ft):W(yt,!1)})}c(mt),c(ye),c(j),c(B),G((W,ie,_e,Pe,Qe,et,kt,tt,Et,rt,$t,ht,Bt,ft,Gt)=>{D(U,"aria-label",W),D(j,"aria-label",ie),J($,1,`flex rounded-xl bg-black/5 p-1 ${i(n)?"pointer-events-none opacity-50":""}`),J(V,1,`flex-1 rounded-lg py-2 font-serif text-[10px] font-bold tracking-widest uppercase transition-all ${i(r)==="image"?"bg-white text-brand shadow-sm":"text-studio-text/40 hover:text-studio-text"}`),E(K,_e),J(Y,1,`flex-1 rounded-lg py-2 font-serif text-[10px] font-bold tracking-widest uppercase transition-all ${i(r)==="video"?"bg-white text-brand shadow-sm":"text-studio-text/40 hover:text-studio-text"}`),E(ae,Pe),J(ce,1,`flex flex-col gap-5 rounded-xl border border-black/5 bg-white/40 p-6 ${i(n)?"pointer-events-none opacity-50":""}`),E(me,Qe),E(L,et),E(ve,kt),E(ke,tt),J(Ce,1,`flex h-6 w-12 items-center rounded-full transition-colors ${a.studio.includePixelBorders?"bg-brand":"bg-charcoal/10"}`),D(Ce,"aria-label",Et),J(Ne,1,`h-4 w-4 rounded-full bg-white shadow-sm transition-transform ${a.studio.includePixelBorders?"translate-x-7":"translate-x-1"}`),E(Ve,rt),E(nt,$t),J(ge,1,`h-10 w-10 rounded-xl border-2 ${a.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),D(ge,"title",ht),D(ge,"aria-checked",a.studio.exportBgColor==="transparent"),J(Se,1,`h-10 w-10 rounded-xl border-2 ${a.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),D(Se,"title",Bt),D(Se,"aria-checked",a.studio.exportBgColor==="#eee8d5"),J($e,1,`h-10 w-10 rounded-xl border-2 ${a.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),D($e,"title",ft),D($e,"aria-checked",a.studio.exportBgColor==="#000000"),J(We,1,`h-10 w-16 rounded-xl border-2 ${i(l)?"border-brand":"border-black/5"} editor-checker-small transition-transform hover:scale-105`),be(We,`background-color: ${i(u)??""};`),D(We,"title",Gt),D(We,"aria-checked",i(l)),J(mt,1,`editor-primary-btn flex w-full items-center justify-center gap-3 py-5 text-xl transition-all ${i(n)?"opacity-80":""}`),mt.disabled=i(n)||i(r)==="video"&&!i(v)},[()=>A({key:"export.preview_label"}),()=>A({key:"export.settings_label"}),()=>A({key:"export.tabs.image"}),()=>A({key:"export.tabs.video"}),()=>A({key:"export.label.scale"}),()=>A({key:"export.description.scale"}),()=>A({key:"export.label.borders"}),()=>A({key:"export.description.borders"}),()=>A({key:"export.label.borders"}),()=>A({key:"export.label.background"}),()=>A({key:"export.description.background"}),()=>A({key:"export.background.transparent"}),()=>A({key:"export.background.cream"}),()=>A({key:"export.background.black"}),()=>A({key:"export.background.custom"})]),Oe(I,()=>a.studio.exportScale,W=>a.studio.exportScale=W),S(R,B)},$$slots:{default:!0}})}S(f,g),ne()}je(["click"]);var hl=P('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function fl(f,e){oe(e,!0);var t=hl(),r=d(t),s=d(r,!0);c(r);var o=h(r,2),l=d(o,!0);c(o),c(t),G(n=>{E(s,e.label),E(l,n)},[()=>e.customKey||it.getLabel(e.intent)]),S(f,t),ne()}var xl=P('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function gl(f,e){oe(e,!0);var t=xl(),r=d(t),s=d(r,!0);c(r);var o=h(r,2);De(o,21,()=>e.group.items,Ue,(l,n)=>{fl(l,{get intent(){return i(n).intent},get label(){return i(n).label},get customKey(){return i(n).customKey}})}),c(o),c(t),G(()=>E(s,e.group.group)),S(f,t),ne()}var bl=P('<div class="flex flex-col"><span class="font-tiny5 text-[10px] text-brand uppercase"> </span> <span class="font-serif text-[10px] text-charcoal/40 italic"> </span></div>'),ml=P('<div class="flex flex-col gap-12" role="document"><header class="flex flex-col gap-2 rounded-xl bg-charcoal/5 p-6 ring-1 ring-charcoal/10" aria-labelledby="guide-header-title"><h3 id="guide-header-title" class="font-tiny5 text-xl text-charcoal uppercase"> </h3> <p class="font-serif text-xs leading-relaxed text-charcoal/60"> </p> <div class="mt-4 grid grid-cols-3 gap-4 border-t border-charcoal/5 pt-4"></div></header> <div class="grid grid-cols-2 gap-x-16 gap-y-12"></div> <footer class="mt-4 border-t border-charcoal/5 pt-8 text-center"><p class="font-serif text-[11px] text-charcoal/40 italic"> </p></footer></div>');function yl(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.showGuideMenu=!1);const r=q(()=>it.getGroupedActions());{let s=q(()=>A({key:"shortcuts.title"})),o=q(()=>A({key:"shortcuts.subtitle"}));It(f,{get title(){return i(s)},get subtitle(){return i(o)},icon:"☕",get onClose(){return t()},width:"1000px",children:(l,n)=>{var u=ml(),v=d(u),p=d(v),x=d(p,!0);c(p);var b=h(p,2),g=d(b,!0);c(b);var m=h(b,2);De(m,20,()=>[["Cup","Frame"],["Infusion","Layer"],["Flavor","Color"],["Vessel","Brush/Tool"],["Pour","Paint"],["Spill","Delete"]],Ue,(R,F)=>{var B=q(()=>Yr(F,2));let U=()=>i(B)[0],M=()=>i(B)[1];var j=bl(),$=d(j),V=d($,!0);c($);var K=h($,2),Y=d(K);c(K),c(j),G(()=>{E(V,U()),E(Y,`meaning ${M()??""}`)}),S(R,j)}),c(m),c(v);var _=h(v,2);De(_,21,()=>i(r),Ue,(R,F)=>{gl(R,{get group(){return i(F)}})}),c(_);var y=h(_,2),w=d(y),C=d(w);c(w),c(y),c(u),G((R,F,B)=>{E(x,R),E(g,F),E(C,`"${B??""}"`)},[()=>A({key:"shortcuts.header_title"}),()=>A({key:"shortcuts.header_desc"}),()=>A({key:"shortcuts.footer_quote"})]),S(l,u)},$$slots:{default:!0}})}ne()}var _l=P(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Recipe Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your art as a dedicated recipe file on your machine or in your browser's local store.</p></div> <div class="flex flex-col gap-3"><button class="editor-primary-btn w-full">Store Recipe to File</button> <button class="editor-secondary-btn w-full">Load Recipe from File</button></div></div>`);function Al(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.showPersistenceMenu=!1);It(f,{title:"Recipe Store",subtitle:"Managing Digital Creations",icon:"💾",get onClose(){return t()},width:"400px",children:(r,s)=>{var o=_l(),l=h(d(o),2),n=d(l);n.__click=()=>{H.persistence.save(),t()()};var u=h(n,2);u.__click=()=>{H.persistence.load(),t()()},c(l),c(o),S(r,o)},$$slots:{default:!0}}),ne()}je(["click"]);var wl=P('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="stab-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <span class="font-mono text-sm font-bold text-brand"> </span></div> <input id="stab-input" type="range" min="0" max="100" class="h-1.5 w-full cursor-pointer appearance-none rounded-lg bg-black/5 accent-brand"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="fps-input" type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </span> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <button class="group relative flex items-center gap-3" aria-label="Change Backdrop Color"><div class="editor-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">🎨</div></button></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="editor-primary-btn w-full py-4 text-lg"> </button></div>'),kl=P("<!> <!>",1);function El(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.showCanvasSettings=!1),r=T(He(a.canvas.width)),s=T(He(a.canvas.height)),o=T(!1);function l(){H.manipulation.resize(i(r),i(s)),t()()}var n=kl(),u=Ie(n);{var v=x=>{Ga(x,{onClose:()=>k(o,!1),get value(){return a.backgroundColor},set value(b){a.backgroundColor=b}})};z(u,x=>{i(o)&&x(v)})}var p=h(u,2);{let x=q(()=>A({key:"settings.title"})),b=q(()=>A({key:"settings.subtitle"}));It(p,{get title(){return i(x)},get subtitle(){return i(b)},icon:"📐",get onClose(){return t()},width:"450px",children:(g,m)=>{var _=wl(),y=d(_),w=d(y),C=d(w),R=d(C),F=d(R,!0);c(R);var B=h(R,2);Me(B),c(C);var U=h(C,2),M=d(U),j=d(M,!0);c(M);var $=h(M,2);Me($),c(U),c(w);var V=h(w,4),K=d(V),Y=d(K),ae=d(Y),re=d(ae,!0);c(ae);var ee=h(ae,2),te=d(ee,!0);c(ee),c(Y);var ce=h(Y,2),we=d(ce);c(ce),c(K);var Te=h(K,2);Me(Te),c(V);var fe=h(V,4),me=d(fe),X=d(me),L=d(X,!0);c(X);var I=h(X,2),N=d(I,!0);c(I),c(me);var O=h(me,2);Me(O),c(fe);var Q=h(fe,4),ve=d(Q),Z=d(ve),ke=d(Z,!0);c(Z);var Ce=h(Z,2),Ne=d(Ce,!0);c(Ce),c(ve);var qe=h(ve,2);qe.__click=()=>k(o,!0);var Re=d(qe);bt(2),c(qe),c(Q);var xe=h(Q,2),Ve=d(xe,!0);c(xe),c(y);var Ke=h(y,2);Ke.__click=l;var nt=d(Ke,!0);c(Ke),c(_),G((Fe,ge,Se,$e,lt,We,ct,le,ye,Ee)=>{E(F,Fe),E(j,ge),E(re,Se),E(te,$e),E(we,`${a.studio.stabilization??""}%`),E(L,lt),E(N,We),E(ke,ct),E(Ne,le),be(Re,`background-color: ${a.backgroundColor??""};`),E(Ve,ye),E(nt,Ee)},[()=>A({key:"settings.width"}),()=>A({key:"settings.height"}),()=>A({key:"settings.stabilization"}),()=>A({key:"settings.stabilization_desc"}),()=>A({key:"settings.fps_label"}),()=>A({key:"settings.fps_desc"}),()=>A({key:"settings.background_label"}),()=>A({key:"settings.background_desc"}),()=>A({key:"settings.note"}),()=>A({key:"settings.apply"})]),Oe(B,()=>i(r),Fe=>k(r,Fe)),Oe($,()=>i(s),Fe=>k(s,Fe)),Oe(Te,()=>a.studio.stabilization,Fe=>a.studio.stabilization=Fe),Oe(O,()=>a.project.fps,Fe=>a.project.fps=Fe),S(g,_)},$$slots:{default:!0}})}S(f,n),ne()}je(["click"]);var Sl=P('<span class="rounded-full bg-charcoal/5 px-2 py-0.5 font-mono text-[8px] text-charcoal/40 uppercase">Default</span>'),Ll=P('<div class="h-3 w-3 rounded-sm shadow-inner"></div>'),Tl=P('<span class="font-mono text-[8px] opacity-20"> </span>'),Cl=P('<button class="flex h-8 w-8 items-center justify-center rounded-lg border border-charcoal/10 bg-stone-light/50 text-[10px] transition-all hover:border-red-500 hover:bg-red-500 hover:text-white">🗑️</button>'),Il=P('<div class="group flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-4 transition-all hover:bg-white/80"><div class="flex flex-col gap-2 overflow-hidden"><div class="flex items-center gap-3"><span class="font-serif text-sm font-bold text-charcoal"> </span> <!></div> <div class="flex flex-wrap gap-1"><!> <!></div></div> <div class="flex items-center gap-2 opacity-0 transition-opacity group-hover:opacity-100"><button class="rounded-lg border border-brand/20 bg-brand/5 px-4 py-1.5 font-serif text-[10px] font-bold text-brand uppercase transition-all hover:bg-brand hover:text-white"> </button> <button class="flex h-8 w-8 items-center justify-center rounded-lg border border-charcoal/10 bg-stone-light/50 text-[10px] transition-all hover:border-brand hover:bg-brand hover:text-white" title="Export Recipe (.gpl)">📥</button> <!></div></div>'),Pl=P('<div class="flex flex-col gap-8"><div class="flex items-center gap-3"><button class="flex flex-1 items-center justify-center gap-2 rounded-xl border-2 border-dashed border-charcoal/10 bg-white/40 py-4 transition-all hover:border-brand/40 hover:bg-white"><span class="text-lg">🥣</span> <div class="flex flex-col items-start"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/60 uppercase">New Recipe</span> <span class="font-serif text-[8px] text-charcoal/30 italic">Start from a blank cup</span></div></button> <button class="flex flex-1 items-center justify-center gap-2 rounded-xl border-2 border-dashed border-charcoal/10 bg-white/40 py-4 transition-all hover:border-brand/40 hover:bg-white"><span class="text-lg">📦</span> <div class="flex flex-col items-start"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/60 uppercase">Import Ingredients</span> <span class="font-serif text-[8px] text-charcoal/30 italic">Load .GPL or HEX list</span></div></button></div> <div class="flex flex-col gap-3 rounded-xl border border-brand/10 bg-brand/5 p-6"><div class="flex flex-col gap-1"><span class="font-serif text-[10px] font-bold tracking-widest text-brand uppercase"> </span> <span class="font-serif text-[9px] text-brand/60 italic"> </span></div> <div class="flex gap-2"><input type="text" class="flex-1 rounded-lg border border-brand/20 bg-white px-4 py-2 font-serif text-sm focus:border-brand focus:outline-none"/> <button class="editor-primary-btn px-6 py-2 text-xs"> </button></div></div> <div class="flex flex-col gap-4"><span class="font-serif text-[10px] font-bold tracking-widest text-charcoal/30 uppercase"> </span> <div class="flex flex-col gap-2"></div></div></div>'),Ml=P('<input type="file" accept=".gpl,.txt" class="hidden"/> <!>',1);function Ol(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.studio.showPaletteLibrary=!1),r=T(""),s=T(void 0);function o(){i(r).trim()&&(a.paletteState.savePreset(i(r).trim()),k(r,""),H.persistence.backup(),H.persistence.saveGlobalPalettes())}function l(_){a.paletteState.applyPreset(_),a.studio.show("Flavor Swatch Applied")}function n(_){a.paletteState.deletePreset(_),H.persistence.backup(),H.persistence.saveGlobalPalettes()}function u(){a.paletteState.newPalette(),a.studio.show("Empty Cup Ready for New Flavors")}function v(){i(s)?.click()}async function p(_){const y=_.target.files?.[0];if(!y)return;const w=await y.text();a.paletteState.importPalette(w)?a.studio.show(`Imported ${y.name}`):a.studio.show("Invalid Ingredients (File Format Error)"),_.target.value=""}function x(_){const y=a.paletteState.presets.find(B=>B.id===_);if(!y)return;const w=ue.toGPL(y.name,y.colors),C=new Blob([w],{type:"text/plain"}),R=URL.createObjectURL(C),F=document.createElement("a");F.href=R,F.download=`${y.name.toLowerCase().replace(/\s+/g,"-")}.gpl`,F.click(),URL.revokeObjectURL(R)}var b=Ml(),g=Ie(b);g.__change=p,Yt(g,_=>k(s,_),()=>i(s));var m=h(g,2);{let _=q(()=>A({key:"palette_library.title"})),y=q(()=>A({key:"palette_library.subtitle"}));It(m,{get title(){return i(_)},get subtitle(){return i(y)},icon:"🎨",get onClose(){return t()},width:"600px",children:(w,C)=>{var R=Pl(),F=d(R),B=d(F);B.__click=u;var U=h(B,2);U.__click=v,c(F);var M=h(F,2),j=d(M),$=d(j),V=d($,!0);c($);var K=h($,2),Y=d(K,!0);c(K),c(j);var ae=h(j,2),re=d(ae);Me(re),re.__keydown=me=>me.key==="Enter"&&o();var ee=h(re,2);ee.__click=o;var te=d(ee,!0);c(ee),c(ae),c(M);var ce=h(M,2),we=d(ce),Te=d(we,!0);c(we);var fe=h(we,2);De(fe,21,()=>a.paletteState.presets,me=>me.id,(me,X)=>{var L=Il(),I=d(L),N=d(I),O=d(N),Q=d(O,!0);c(O);var ve=h(O,2);{var Z=ge=>{var Se=Sl();S(ge,Se)};z(ve,ge=>{i(X).isDefault&&ge(Z)})}c(N);var ke=h(N,2),Ce=d(ke);De(Ce,17,()=>i(X).colors.slice(0,12),Ue,(ge,Se)=>{var $e=Ll();G(()=>be($e,`background-color: ${i(Se)??""};`)),S(ge,$e)});var Ne=h(Ce,2);{var qe=ge=>{var Se=Tl(),$e=d(Se);c(Se),G(()=>E($e,`+${i(X).colors.length-12}`)),S(ge,Se)};z(Ne,ge=>{i(X).colors.length>12&&ge(qe)})}c(ke),c(I);var Re=h(I,2),xe=d(Re);xe.__click=()=>l(i(X).id);var Ve=d(xe,!0);c(xe);var Ke=h(xe,2);Ke.__click=()=>x(i(X).id);var nt=h(Ke,2);{var Fe=ge=>{var Se=Cl();Se.__click=()=>n(i(X).id),G($e=>D(Se,"title",$e),[()=>A({key:"palette_library.button.delete"})]),S(ge,Se)};z(nt,ge=>{i(X).isDefault||ge(Fe)})}c(Re),c(L),G(ge=>{E(Q,i(X).name),E(Ve,ge)},[()=>A({key:"palette_library.button.apply"})]),de(3,L,()=>ur,()=>({duration:200})),S(me,L)}),c(fe),c(ce),c(R),G((me,X,L,I,N,O)=>{E(V,me),E(Y,X),D(re,"placeholder",L),ee.disabled=I,E(te,N),E(Te,O)},[()=>A({key:"palette_library.save_label"}),()=>A({key:"palette_library.save_desc"}),()=>A({key:"palette_library.name_placeholder"}),()=>!i(r).trim(),()=>A({key:"palette_library.button.save"}),()=>A({key:"palette_library.list_title"})]),Oe(re,()=>i(r),me=>k(r,me)),S(w,R)},$$slots:{default:!0}})}S(f,b),ne()}je(["change","click","keydown"]);var Rl=P('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="editor-primary-btn w-full py-4 text-lg"> </button></div>');function Dl(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.studio.showGoTo=!1),r=T(He(a.displayCoords.x)),s=T(He(a.displayCoords.y));function o(){H.jumpTo(i(r),i(s)),t()()}function l(n){n.key==="Enter"&&o()}sa(()=>{document.getElementById("goto-x")?.focus()});{let n=q(()=>A({key:"goto.title"})),u=q(()=>A({key:"goto.subtitle"}));It(f,{get title(){return i(n)},get subtitle(){return i(u)},icon:"📍",get onClose(){return t()},width:"400px",children:(v,p)=>{var x=Rl(),b=d(x),g=d(b),m=d(g),_=d(m),y=d(_,!0);c(_);var w=h(_,2);Me(w),w.__keydown=l,c(m);var C=h(m,2),R=d(C),F=d(R,!0);c(R);var B=h(R,2);Me(B),B.__keydown=l,c(C),c(g);var U=h(g,2),M=d(U,!0);c(U),c(b);var j=h(b,2);j.__click=o;var $=d(j,!0);c(j),c(x),G((V,K,Y,ae)=>{E(y,V),E(F,K),E(M,Y),E($,ae)},[()=>A({key:"goto.label_x"}),()=>A({key:"goto.label_y"}),()=>A({key:"goto.current",replace:{x:a.displayCoords.x,y:a.displayCoords.y}}),()=>A({key:"goto.action"})]),Oe(w,()=>i(r),V=>k(r,V)),Oe(B,()=>i(s),V=>k(s,V)),S(v,x)},$$slots:{default:!0}})}ne()}je(["keydown","click"]);var jl=P('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all café resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Sound Effects (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Ambiance Flow</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="editor-primary-btn w-full py-4">Apply Settings</button></div>');function Fl(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.showAudioSettings=!1);It(f,{title:"Audio Settings",subtitle:"Harmony & Ambiance Tuning",icon:"🔊",get onClose(){return t()},width:"450px",children:(r,s)=>{var o=jl(),l=d(o),n=h(d(l),2);n.__click=()=>a.toggleMute();var u=d(n,!0);c(n),c(l);var v=h(l,2),p=d(v),x=d(p),b=h(d(x),2),g=d(b);c(b),c(x);var m=h(x,2);Me(m),c(p);var _=h(p,2),y=d(_),w=h(d(y),2),C=d(w);c(w),c(y);var R=h(y,2);Me(R),c(_),c(v);var F=h(v,2),B=h(d(F),2),U=d(B),M=h(d(U),2),j=d(M);c(M),c(U);var $=h(U,2),V=d($);{var K=re=>{var ee=ot(`The piano awaits in silence. It will begin to play its melody after 30 minutes of
						creativity.`);S(re,ee)},Y=re=>{var ee=ot("The piano has begun its flow. Volume will reach full depth at 60 minutes.");S(re,ee)};z(V,re=>{a.usageMinutes<30?re(K):re(Y,!1)})}c($),c(B),c(F);var ae=h(F,2);ae.__click=function(...re){t()?.apply(this,re)},c(o),G((re,ee)=>{J(n,1,`editor-secondary-btn !px-6 !py-2 ${a.isMuted?"bg-brand text-white":""}`),E(u,a.isMuted?"🔇 Muted":"🔊 Active"),E(g,`${re??""}%`),E(C,`${ee??""}%`),E(j,`${a.usageMinutes??""} minutes`)},[()=>Math.round(a.sfxVolume*100),()=>Math.round(a.bgmVolume*100)]),Oe(m,()=>a.sfxVolume,re=>a.sfxVolume=re),Oe(R,()=>a.bgmVolume,re=>a.bgmVolume=re),S(r,o)},$$slots:{default:!0}}),ne()}je(["click"]);var $l=P('<div class="flex flex-col gap-12" role="document"><section class="flex flex-col gap-6" aria-labelledby="philosophy-title"><div class="flex items-center gap-4 border-b border-black/5 pb-4"><span class="text-3xl" aria-hidden="true">🕯️</span> <h3 id="philosophy-title" class="font-tiny5 text-3xl tracking-tighter text-brand uppercase"> </h3></div> <div class="space-y-4 font-serif text-base leading-relaxed text-studio-text/80"><p> </p> <p> </p> <p class="text-brand/60 italic"> </p></div></section> <div class="grid grid-cols-3 gap-6" role="list"><div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">☕</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">🧪</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">🥞</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div></div> <section class="flex flex-col gap-8 rounded-3xl bg-brand/5 p-10 ring-1 ring-brand/10" aria-labelledby="techniques-title"><h3 id="techniques-title" class="font-tiny5 text-2xl tracking-tighter text-brand uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-8"><div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🥛</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🪄</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">⏳</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🎹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div></div></section> <footer class="flex flex-col items-center gap-6 border-t border-black/5 pt-10 text-center"><div class="flex flex-col items-center gap-2"><p class="font-serif text-sm text-studio-text/50 italic"> </p> <span class="font-tiny5 text-[10px] tracking-[0.3em] text-studio-text/30 uppercase"> </span></div> <div class="flex items-center gap-4"><button class="editor-secondary-btn px-10 py-4"> </button> <button class="editor-primary-btn px-16 py-4 text-xl"> </button></div></footer></div>');function Bl(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.showGuideBook=!1);{let r=q(()=>A({key:"manual.title"})),s=q(()=>A({key:"manual.subtitle"}));It(f,{get title(){return i(r)},get subtitle(){return i(s)},icon:"📜",get onClose(){return t()},width:"850px",children:(o,l)=>{var n=$l(),u=d(n),v=d(u),p=h(d(v),2),x=d(p,!0);c(p),c(v);var b=h(v,2),g=d(b),m=d(g,!0);c(g);var _=h(g,2),y=d(_,!0);c(_);var w=h(_,2),C=d(w,!0);c(w),c(b),c(u);var R=h(u,2),F=d(R),B=h(d(F),2),U=d(B,!0);c(B);var M=h(B,2),j=d(M,!0);c(M),c(F);var $=h(F,2),V=h(d($),2),K=d(V,!0);c(V);var Y=h(V,2),ae=d(Y,!0);c(Y),c($);var re=h($,2),ee=h(d(re),2),te=d(ee,!0);c(ee);var ce=h(ee,2),we=d(ce,!0);c(ce),c(re),c(R);var Te=h(R,2),fe=d(Te),me=d(fe,!0);c(fe);var X=h(fe,2),L=d(X),I=h(d(L),2),N=d(I),O=d(N,!0);c(N);var Q=h(N,2),ve=d(Q,!0);c(Q),c(I),c(L);var Z=h(L,2),ke=h(d(Z),2),Ce=d(ke),Ne=d(Ce,!0);c(Ce);var qe=h(Ce,2),Re=d(qe,!0);c(qe),c(ke),c(Z);var xe=h(Z,2),Ve=h(d(xe),2),Ke=d(Ve),nt=d(Ke,!0);c(Ke);var Fe=h(Ke,2),ge=d(Fe,!0);c(Fe),c(Ve),c(xe);var Se=h(xe,2),$e=h(d(Se),2),lt=d($e),We=d(lt,!0);c(lt);var ct=h(lt,2),le=d(ct,!0);c(ct),c($e),c(Se),c(X),c(Te);var ye=h(Te,2),Ee=d(ye),Be=d(Ee),mt=d(Be);c(Be);var wt=h(Be,2),Ft=d(wt,!0);c(wt),c(Ee);var yt=h(Ee,2),W=d(yt);W.__click=()=>{t()(),a.showGuideMenu=!0};var ie=d(W,!0);c(W);var _e=h(W,2);_e.__click=function(...Qe){t()?.apply(this,Qe)};var Pe=d(_e,!0);c(_e),c(yt),c(ye),c(n),G((Qe,et,kt,tt,Et,rt,$t,ht,Bt,ft,Gt,St,Jt,Lt,ea,Nt,Kt,Pt,qt,Vt,ia,Qt,Xt)=>{E(x,Qe),E(m,et),E(y,kt),E(C,tt),E(U,Et),E(j,rt),E(K,$t),E(ae,ht),E(te,Bt),E(we,ft),E(me,Gt),E(O,St),E(ve,Jt),E(Ne,Lt),E(Re,ea),E(nt,Nt),E(ge,Kt),E(We,Pt),E(le,qt),E(mt,`"${Vt??""}"`),E(Ft,ia),E(ie,Qt),E(Pe,Xt)},[()=>A({key:"manual.philosophy.title"}),()=>A({key:"manual.philosophy.p1"}),()=>A({key:"manual.philosophy.p2"}),()=>A({key:"manual.philosophy.p3"}),()=>A({key:"manual.pillars.cursor.title"}),()=>A({key:"manual.pillars.cursor.desc"}),()=>A({key:"manual.pillars.colors.title"}),()=>A({key:"manual.pillars.colors.desc"}),()=>A({key:"manual.pillars.layers.title"}),()=>A({key:"manual.pillars.layers.desc"}),()=>A({key:"manual.techniques.title"}),()=>A({key:"manual.techniques.continuous.title"}),()=>A({key:"manual.techniques.continuous.desc"}),()=>A({key:"manual.techniques.magic_select.title"}),()=>A({key:"manual.techniques.magic_select.desc"}),()=>A({key:"manual.techniques.timeline.title"}),()=>A({key:"manual.techniques.timeline.desc"}),()=>A({key:"manual.techniques.audio.title"}),()=>A({key:"manual.techniques.audio.desc"}),()=>A({key:"manual.footer.quote"}),()=>A({key:"manual.footer.guild"}),()=>A({key:"manual.footer.all_shortcuts"}),()=>A({key:"manual.footer.enter"})]),S(o,n)},$$slots:{default:!0}})}ne()}je(["click"]);var Gl=P('<div class="grid grid-cols-2 gap-4"><div class="flex flex-col gap-2"><span class="text-xs font-bold text-charcoal/60 uppercase">Visibility</span> <button class="editor-tool-btn justify-center"> </button></div> <div class="flex flex-col gap-2"><label class="text-xs font-bold text-charcoal/60 uppercase" for="underlay-opacity"> </label> <input id="underlay-opacity" type="range" min="0" max="1" step="0.05" class="accent-brand"/></div></div> <div class="flex flex-col gap-2"><span class="text-xs font-bold text-charcoal/60 uppercase">Manual Positioning</span> <div class="flex items-center gap-4"><button class="editor-tool-btn text-xs">Reset View</button> <span class="text-[10px] text-charcoal/40 italic">Use Ctrl + Alt + Arrows to nudge on canvas.</span></div></div> <div class="border-t border-charcoal/5 pt-4"><button class="w-full text-xs text-red-500 hover:underline">Clear Reference Image</button></div>',1),Nl=P('<div class="flex flex-col gap-6 p-2"><div class="flex flex-col gap-2"><label class="text-xs font-bold text-charcoal/60 uppercase" for="underlay-file">Upload Reference Image</label> <input id="underlay-file" type="file" accept="image/*" class="text-xs text-charcoal/80"/></div> <!></div>');function Vl(f,e){oe(e,!1);const t=ba(a.studio);function r(o){const l=o.target;if(l.files&&l.files[0]){const n=new FileReader;n.onload=u=>{at(t,i(t).underlayImage=u.target?.result)},n.readAsDataURL(l.files[0])}}function s(){at(t,i(t).underlayOffset={x:0,y:0}),at(t,i(t).underlayScale=1)}Ye();{let o=da(()=>A({key:"OPEN_UNDERLAY_MENU"}));It(f,{get title(){return i(o)},onClose:()=>at(t,i(t).showUnderlayMenu=!1),children:(l,n)=>{var u=Nl(),v=d(u),p=h(d(v),2);p.__change=r,c(v);var x=h(v,2);{var b=g=>{var m=Gl(),_=Ie(m),y=d(_),w=h(d(y),2);w.__click=()=>at(t,i(t).isUnderlayVisible=!i(t).isUnderlayVisible);var C=d(w,!0);c(w),c(y);var R=h(y,2),F=d(R),B=d(F);c(F);var U=h(F,2);Me(U),c(R),c(_);var M=h(_,2),j=h(d(M),2),$=d(j);$.__click=s,bt(2),c(j),c(M);var V=h(M,2),K=d(V);K.__click=()=>at(t,i(t).underlayImage=null),c(V),G(Y=>{E(C,i(t).isUnderlayVisible?"Hide Underlay":"Show Underlay"),E(B,`Vapor Opacity (${Y??""}%)`)},[()=>Math.round(i(t).underlayOpacity*100)]),Oe(U,()=>i(t).underlayOpacity,Y=>at(t,i(t).underlayOpacity=Y)),S(g,m)};z(x,g=>{i(t).underlayImage&&g(b)})}c(u),S(l,u)},$$slots:{default:!0}})}ne()}je(["change","click"]);var Ul=P('<div class="flex flex-col gap-8 p-2"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="cups-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="cups-input" type="number" min="1" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </span> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <div class="grid grid-cols-2 gap-4"><div class="flex items-center gap-3 rounded-xl border border-black/5 bg-white/40 p-3"><span class="font-mono text-[10px] font-bold text-studio-text/30">X</span> <input type="number" class="w-full bg-transparent font-mono text-sm font-bold text-studio-text focus:outline-none"/></div> <div class="flex items-center gap-3 rounded-xl border border-black/5 bg-white/40 p-3"><span class="font-mono text-[10px] font-bold text-studio-text/30">Y</span> <input type="number" class="w-full bg-transparent font-mono text-sm font-bold text-studio-text focus:outline-none"/></div></div></div> <button class="editor-primary-btn mt-4 w-full py-4 text-lg"> </button></div>');function Hl(f,e){oe(e,!0);let t=Ge(e,"onClose",3,()=>a.studio.showPourBasin=!1),r=T(5),s=T(1),o=T(0);function l(){H.selection.propagate(i(r),i(s),i(o)),t()()}{let n=q(()=>A({key:"export.propagation.title"})),u=q(()=>A({key:"export.propagation.subtitle"}));It(f,{get title(){return i(n)},get subtitle(){return i(u)},icon:"🍯",get onClose(){return t()},width:"400px",children:(v,p)=>{var x=Ul(),b=d(x),g=d(b),m=d(g),_=d(m,!0);c(m);var y=h(m,2),w=d(y,!0);c(y),c(g);var C=h(g,2);Me(C),c(b);var R=h(b,2),F=d(R),B=d(F),U=d(B,!0);c(B);var M=h(B,2),j=d(M,!0);c(M),c(F);var $=h(F,2),V=d($),K=h(d(V),2);Me(K),c(V);var Y=h(V,2),ae=h(d(Y),2);Me(ae),c(Y),c($),c(R);var re=h(R,2);re.__click=l;var ee=d(re,!0);c(re),c(x),G((te,ce,we,Te,fe)=>{E(_,te),E(w,ce),D(C,"max",a.project.frames.length-a.project.activeFrameIndex-1),E(U,we),E(j,Te),re.disabled=i(r)<=0,E(ee,fe)},[()=>A({key:"export.propagation.frames_label"}),()=>A({key:"export.propagation.frames_desc"}),()=>A({key:"export.propagation.offset_label"}),()=>A({key:"export.propagation.offset_desc"}),()=>A({key:"export.propagation.action"})]),Oe(C,()=>i(r),te=>k(r,te)),Oe(K,()=>i(s),te=>k(s,te)),Oe(ae,()=>i(o),te=>k(o,te)),S(v,x)},$$slots:{default:!0}})}ne()}je(["click"]);var zl=P('<span class="text-xs opacity-60"> </span>'),Yl=P('<button><div class="flex items-center gap-3"><!> <span class="font-serif text-xs font-medium"> </span></div></button>'),Kl=P('<div class="fixed z-[2000] min-w-[160px] overflow-hidden rounded-lg border border-charcoal/10 bg-foam-white/95 p-1 shadow-xl backdrop-blur-md" role="menu" tabindex="-1"><div class="flex flex-col gap-0.5"></div></div>');function ql(f,e){oe(e,!0);let t=T(null),r=T(160),s=T(100),o=q(()=>e.x+i(r)>(typeof window<"u"?window.innerWidth:1e3)?e.x-i(r):e.x),l=q(()=>e.y+i(s)>(typeof window<"u"?window.innerHeight:1e3)?e.y-i(s):e.y);sa(()=>{i(t)&&(k(r,i(t).offsetWidth,!0),k(s,i(t).offsetHeight,!0))});var n=Kl();Ze("mousedown",Ca,v=>!i(t)?.contains(v.target)&&e.onClose()),n.__contextmenu=v=>v.preventDefault();var u=d(n);De(u,21,()=>e.items,Ue,(v,p)=>{var x=Yl();x.__click=()=>{i(p).disabled||(i(p).action(),e.onClose())};var b=d(x),g=d(b);{var m=w=>{var C=zl(),R=d(C,!0);c(C),G(()=>E(R,i(p).icon)),S(w,C)};z(g,w=>{i(p).icon&&w(m)})}var _=h(g,2),y=d(_,!0);c(_),c(b),c(x),G(()=>{x.disabled=i(p).disabled,J(x,1,`flex w-full items-center justify-between rounded px-3 py-2 text-left transition-colors ${i(p).danger?"text-red-600 hover:bg-red-50":"text-charcoal hover:bg-brand/5"} ${i(p).disabled?"cursor-not-allowed opacity-30 grayscale":""}`),E(y,i(p).label)}),S(v,x)}),c(u),c(n),Yt(n,v=>k(t,v),()=>i(t)),G(()=>be(n,`left: ${i(o)??""}px; top: ${i(l)??""}px;`)),de(3,n,()=>Zt,()=>({duration:100,start:.95,opacity:0})),S(f,n),ne()}je(["contextmenu","click"]);var Ql=P('<div class="pointer-events-none fixed bottom-24 left-1/2 z-[2000] -translate-x-1/2 rounded-full border border-brand/20 bg-white/90 px-6 py-2 shadow-2xl backdrop-blur-md"><div class="flex items-center gap-3"><span class="font-tiny5 text-lg tracking-widest text-brand uppercase"> </span></div></div>');function Xl(f,e){oe(e,!1);const t=a.studio;Ye();var r=Xe(),s=Ie(r);{var o=l=>{var n=Ql(),u=d(n),v=d(u),p=d(v,!0);c(v),c(u),c(n),G(()=>E(p,t.toastMessage)),de(3,n,()=>Ba,()=>({y:20,duration:300})),S(l,n)};z(s,l=>{t.showToast&&l(o)})}S(f,r),ne()}var pe=ua(()=>a),Wl=P('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg selection:bg-brand/20"><!> <div class="flex flex-1 overflow-hidden"><aside class="flex w-64 flex-col overflow-hidden"><!></aside> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20 p-6"><div><!></div></main> <aside class="flex w-72 flex-col overflow-hidden"><!></aside></div> <!></div>',1);function oc(f,e){oe(e,!1),sa(()=>Tt.mount()),Ye();var t=Wl(),r=Ie(t);Vn(r,{});var s=h(r,2);{var o=O=>{Bl(O,{onClose:()=>pe(pe().showGuideBook=!1)})};z(s,O=>{pe().showGuideBook&&O(o)})}var l=h(s,2);{var n=O=>{Wn(O,{onClose:()=>pe(pe().showCommandPalette=!1)})};z(l,O=>{pe().showCommandPalette&&O(n)})}var u=h(l,2);{var v=O=>{Ga(O,{onClose:()=>pe(pe().showColorPicker=!1),get value(){return pe().paletteState.activeColor},set value(Q){pe(pe().paletteState.activeColor=Q)},$$legacy:!0})};z(u,O=>{pe().showColorPicker&&O(v)})}var p=h(u,2);{var x=O=>{pl(O,{onExport:(Q,ve,Z)=>H.createArtifact(Q,ve,Z),onClose:()=>pe(pe().showExportMenu=!1)})};z(p,O=>{pe().showExportMenu&&O(x)})}var b=h(p,2);{var g=O=>{Al(O,{onClose:()=>pe(pe().showPersistenceMenu=!1)})};z(b,O=>{pe().showPersistenceMenu&&O(g)})}var m=h(b,2);{var _=O=>{Ol(O,{onClose:()=>pe(pe().studio.showPaletteLibrary=!1)})};z(m,O=>{pe().studio.showPaletteLibrary&&O(_)})}var y=h(m,2);{var w=O=>{El(O,{onClose:()=>pe(pe().showCanvasSettings=!1)})};z(y,O=>{pe().showCanvasSettings&&O(w)})}var C=h(y,2);{var R=O=>{Dl(O,{onClose:()=>pe(pe().showGoTo=!1)})};z(C,O=>{pe().showGoTo&&O(R)})}var F=h(C,2);{var B=O=>{Hl(O,{onClose:()=>pe(pe().studio.showPourBasin=!1)})};z(F,O=>{pe().studio.showPourBasin&&O(B)})}var U=h(F,2);{var M=O=>{Fl(O,{onClose:()=>pe(pe().showAudioSettings=!1)})};z(U,O=>{pe().showAudioSettings&&O(M)})}var j=h(U,2);{var $=O=>{yl(O,{onClose:()=>pe(pe().showGuideMenu=!1)})};z(j,O=>{pe().showGuideMenu&&O($)})}var V=h(j,2);{var K=O=>{Vl(O,{})};z(V,O=>{pe().studio.showUnderlayMenu&&O(K)})}var Y=h(V,2);{var ae=O=>{ql(O,{get x(){return pe().studio.contextMenu.x},get y(){return pe().studio.contextMenu.y},get items(){return pe().studio.contextMenu.items},onClose:()=>pe(pe().studio.contextMenu=null)})};z(Y,O=>{pe().studio.contextMenu&&O(ae)})}var re=h(Y,2);Xl(re,{});var ee=h(re,2),te=d(ee);xi(te);var ce=h(te,2),we=d(ce),Te=d(we);Di(Te,{}),c(we);var fe=h(we,2),me=d(fe),X=d(me);Bn(X,{}),c(me),c(fe);var L=h(fe,2),I=d(L);ro(I),c(L),c(ce);var N=h(ce,2);un(N),c(ee),G(()=>J(me,1,`editor-frame flex h-full w-full items-center justify-center overflow-hidden shadow-2xl transition-all duration-700 ease-out ${pe().project.isPlaying&&pe().project.frames.length>1?"ring-palette-0 animate-pulse ring-8 ring-inset":""}`)),S(f,t),ne()}export{ue as C,Xa as P,oc as _};
