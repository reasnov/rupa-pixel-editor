function I(e,n,v,a){var r=0,a=a===void 0?{}:a,s=a.loop===void 0?null:a.loop,f=a.palette===void 0?null:a.palette;if(n<=0||v<=0||n>65535||v>65535)throw new Error("Width/Height invalid.");function p(o){var l=o.length;if(l<2||l>256||l&l-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return l}e[r++]=71,e[r++]=73,e[r++]=70,e[r++]=56,e[r++]=57,e[r++]=97;var x=0,i=0;if(f!==null){for(var d=p(f);d>>=1;)++x;if(d=1<<x,--x,a.background!==void 0){if(i=a.background,i>=d)throw new Error("Background index out of range.");if(i===0)throw new Error("Background index explicitly passed as 0.")}}if(e[r++]=n&255,e[r++]=n>>8&255,e[r++]=v&255,e[r++]=v>>8&255,e[r++]=(f!==null?128:0)|x,e[r++]=i,e[r++]=0,f!==null)for(var u=0,E=f.length;u<E;++u){var c=f[u];e[r++]=c>>16&255,e[r++]=c>>8&255,e[r++]=c&255}if(s!==null){if(s<0||s>65535)throw new Error("Loop count invalid.");e[r++]=33,e[r++]=255,e[r++]=11,e[r++]=78,e[r++]=69,e[r++]=84,e[r++]=83,e[r++]=67,e[r++]=65,e[r++]=80,e[r++]=69,e[r++]=50,e[r++]=46,e[r++]=48,e[r++]=3,e[r++]=1,e[r++]=s&255,e[r++]=s>>8&255,e[r++]=0}var h=!1;this.addFrame=function(o,l,w,_,k,t){if(h===!0&&(--r,h=!1),t=t===void 0?{}:t,o<0||l<0||o>65535||l>65535)throw new Error("x/y invalid.");if(w<=0||_<=0||w>65535||_>65535)throw new Error("Width/Height invalid.");if(k.length<w*_)throw new Error("Not enough pixels for the frame size.");var y=!0,g=t.palette;if(g==null&&(y=!1,g=f),g==null)throw new Error("Must supply either a local or global palette.");for(var G=p(g),B=0;G>>=1;)++B;G=1<<B;var H=t.delay===void 0?0:t.delay,m=t.disposal===void 0?0:t.disposal;if(m<0||m>3)throw new Error("Disposal out of range.");var L=!1,O=0;if(t.transparent!==void 0&&t.transparent!==null&&(L=!0,O=t.transparent,O<0||O>=G))throw new Error("Transparent color index.");if((m!==0||L||H!==0)&&(e[r++]=33,e[r++]=249,e[r++]=4,e[r++]=m<<2|(L===!0?1:0),e[r++]=H&255,e[r++]=H>>8&255,e[r++]=O,e[r++]=0),e[r++]=44,e[r++]=o&255,e[r++]=o>>8&255,e[r++]=l&255,e[r++]=l>>8&255,e[r++]=w&255,e[r++]=w>>8&255,e[r++]=_&255,e[r++]=_>>8&255,e[r++]=y===!0?128|B-1:0,y===!0)for(var P=0,D=g.length;P<D;++P){var C=g[P];e[r++]=C>>16&255,e[r++]=C>>8&255,e[r++]=C&255}return r=F(e,r,B<2?2:B,k),r},this.end=function(){return h===!1&&(e[r++]=59,h=!0),r},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(o){e=o},this.getOutputBufferPosition=function(){return r},this.setOutputBufferPosition=function(o){r=o}}function F(e,n,v,W){e[n++]=v;var r=n++,a=1<<v,s=a-1,f=a+1,p=f+1,x=v+1,i=0,d=0;function u(t){for(;i>=t;)e[n++]=d&255,d>>=8,i-=8,n===r+256&&(e[r]=255,r=n++)}function E(t){d|=t<<i,i+=x,u(8)}var c=W[0]&s,h={};E(a);for(var o=1,l=W.length;o<l;++o){var w=W[o]&s,_=c<<8|w,k=h[_];if(k===void 0){for(d|=c<<i,i+=x;i>=8;)e[n++]=d&255,d>>=8,i-=8,n===r+256&&(e[r]=255,r=n++);p===4096?(E(a),p=f+1,x=v+1,h={}):(p>=1<<x&&++x,h[_]=p++),c=w}else c=k}return E(c),E(f),u(1),r+1===n?e[r]=0:(e[r]=n-r-1,e[n++]=0),n}export{I as GifWriter};
