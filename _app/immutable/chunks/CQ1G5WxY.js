const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CpWpvAaI.js","./u7-2yxVl.js","./DnXmPbpO.js","./DpdFPL9-.js"])))=>i.map(i=>d[i]);
import{a as C,f as M,c as Ve,t as Je,d as tt}from"./BKE_8Qky.js";import{i as be}from"./z6XNcR_a.js";import{o as it}from"./DdJ8-sRX.js";import{aL as Pi,b as li,h as Ae,J as ci,a as wt,aM as di,L as kt,D as Li,n as l,N as Mi,O as Vi,P as Xt,Q as St,f as dt,aa as Fi,aE as Bi,am as Zt,c as Ke,aN as je,e as Lt,aO as Di,s as ji,a5 as ht,aP as $i,aC as Dt,aQ as Ri,aR as Oi,aH as Ni,a9 as Mt,aS as Gi,r as ui,p as hi,aT as Ct,U as jt,aU as zi,aV as Hi,aB as Ui,d as Ki,ay as qi,G as Yi,E as Qi,aW as Xi,I as Zi,R as Wi,j as Ge,aX as Ji,aY as es,aZ as Qe,au as vi,a_ as ts,a$ as is,b0 as ss,b1 as as,b2 as rs,b3 as ns,b4 as os,b5 as ls,aI as cs,S as ds,b6 as us,_,aJ as T,Z as ve,aK as Y,i as Te,y as z,A as v,C as p,B as u,w as X,z as Z,x as he,an as st,b7 as Wt}from"./DnXmPbpO.js";import{_ as pi,p as ae,i as q,b as qe}from"./u7-2yxVl.js";import{a as hs,s as H,d as pe,e as ue}from"./Dt61PMF7.js";import{B as vs}from"./DpdFPL9-.js";import{s as ps}from"./ri7ydiIA.js";const fs=Symbol("NaN");function gs(c,e,t){Ae&&ci();var i=new vs(c),s=!Pi();li(()=>{var a=e();a!==a&&(a=fs),s&&a!==null&&typeof a=="object"&&(a={}),i.ensure(a,t)})}function ke(c,e){return e}function xs(c,e,t){for(var i=[],s=e.length,a,n=e.length,o=0;o<s;o++){let g=e[o];hi(g,()=>{if(a){if(a.pending.delete(g),a.done.add(g),a.pending.size===0){var x=c.outrogroups;Vt(Dt(a.done)),x.delete(a),x.size===0&&(c.outrogroups=null)}}else n-=1},!1)}if(n===0){var d=i.length===0&&t!==null;if(d){var h=t,f=h.parentNode;Ui(f),f.append(h),c.items.clear()}Vt(e,!d)}else a={pending:new Set(e),done:new Set},(c.outrogroups??=new Set).add(a)}function Vt(c,e=!0){for(var t=0;t<c.length;t++)Ki(c[t],e)}var Jt;function xe(c,e,t,i,s,a=null){var n=c,o=new Map,d=(e&di)!==0;if(d){var h=c;n=Ae?kt(Li(h)):h.appendChild(wt())}Ae&&ci();var f=null,g=ht(()=>{var A=t();return $i(A)?A:A==null?[]:Dt(A)}),x,b=!0;function y(){m.fallback=f,bs(m,x,n,e,i),f!==null&&(x.length===0?(f.f&je)===0?ui(f):(f.f^=je,We(f,null,n)):hi(f,()=>{f=null}))}var k=li(()=>{x=l(g);var A=x.length;let I=!1;if(Ae){var $=Mi(n)===Vi;$!==(A===0)&&(n=Xt(),kt(n),St(!1),I=!0)}for(var B=new Set,P=Ke,E=ji(),w=0;w<A;w+=1){Ae&&dt.nodeType===Fi&&dt.data===Bi&&(n=dt,I=!0,St(!1));var L=x[w],R=i(L,w),G=b?null:o.get(R);G?(G.v&&Zt(G.v,L),G.i&&Zt(G.i,w),E&&P.unskip_effect(G.e)):(G=ms(o,b?n:Jt??=wt(),L,R,w,s,e,t),b||(G.e.f|=je),o.set(R,G)),B.add(R)}if(A===0&&a&&!f&&(b?f=Lt(()=>a(n)):(f=Lt(()=>a(Jt??=wt())),f.f|=je)),A>B.size&&Di(),Ae&&A>0&&kt(Xt()),!b)if(E){for(const[S,O]of o)B.has(S)||P.skip_effect(O.e);P.oncommit(y),P.ondiscard(()=>{})}else y();I&&St(!0),l(g)}),m={effect:k,items:o,outrogroups:null,fallback:f};b=!1,Ae&&(n=dt)}function Xe(c){for(;c!==null&&(c.f&zi)===0;)c=c.next;return c}function bs(c,e,t,i,s){var a=(i&Hi)!==0,n=e.length,o=c.items,d=Xe(c.effect.first),h,f=null,g,x=[],b=[],y,k,m,A;if(a)for(A=0;A<n;A+=1)y=e[A],k=s(y,A),m=o.get(k).e,(m.f&je)===0&&(m.nodes?.a?.measure(),(g??=new Set).add(m));for(A=0;A<n;A+=1){if(y=e[A],k=s(y,A),m=o.get(k).e,c.outrogroups!==null)for(const G of c.outrogroups)G.pending.delete(m),G.done.delete(m);if((m.f&je)!==0)if(m.f^=je,m===d)We(m,null,t);else{var I=f?f.next:d;m===c.effect.last&&(c.effect.last=m.prev),m.prev&&(m.prev.next=m.next),m.next&&(m.next.prev=m.prev),Re(c,f,m),Re(c,m,I),We(m,I,t),f=m,x=[],b=[],d=Xe(f.next);continue}if((m.f&Ct)!==0&&(ui(m),a&&(m.nodes?.a?.unfix(),(g??=new Set).delete(m))),m!==d){if(h!==void 0&&h.has(m)){if(x.length<b.length){var $=b[0],B;f=$.prev;var P=x[0],E=x[x.length-1];for(B=0;B<x.length;B+=1)We(x[B],$,t);for(B=0;B<b.length;B+=1)h.delete(b[B]);Re(c,P.prev,E.next),Re(c,f,P),Re(c,E,$),d=$,f=E,A-=1,x=[],b=[]}else h.delete(m),We(m,d,t),Re(c,m.prev,m.next),Re(c,m,f===null?c.effect.first:f.next),Re(c,f,m),f=m;continue}for(x=[],b=[];d!==null&&d!==m;)(h??=new Set).add(d),b.push(d),d=Xe(d.next);if(d===null)continue}(m.f&je)===0&&x.push(m),f=m,d=Xe(m.next)}if(c.outrogroups!==null){for(const G of c.outrogroups)G.pending.size===0&&(Vt(Dt(G.done)),c.outrogroups?.delete(G));c.outrogroups.size===0&&(c.outrogroups=null)}if(d!==null||h!==void 0){var w=[];if(h!==void 0)for(m of h)(m.f&Ct)===0&&w.push(m);for(;d!==null;)(d.f&Ct)===0&&d!==c.fallback&&w.push(d),d=Xe(d.next);var L=w.length;if(L>0){var R=(i&di)!==0&&n===0?t:null;if(a){for(A=0;A<L;A+=1)w[A].nodes?.a?.measure();for(A=0;A<L;A+=1)w[A].nodes?.a?.fix()}xs(c,w,R)}}a&&jt(()=>{if(g!==void 0)for(m of g)m.nodes?.a?.apply()})}function ms(c,e,t,i,s,a,n,o){var d=(n&Ri)!==0?(n&Oi)===0?Ni(t,!1,!1):Mt(t):null,h=(n&Gi)!==0?Mt(s):null;return{v:d,i:h,e:Lt(()=>(a(e,d??t,h??s,o),()=>{c.delete(i)}))}}function We(c,e,t){if(c.nodes)for(var i=c.nodes.start,s=c.nodes.end,a=e&&(e.f&je)===0?e.nodes.start:t;i!==null;){var n=qi(i);if(a.before(i),i===s)return;i=n}}function Re(c,e,t){e===null?c.effect.first=t:e.next=t,t===null?c.effect.last=e:t.prev=e}const _s=()=>performance.now(),De={tick:c=>requestAnimationFrame(c),now:()=>_s(),tasks:new Set};function fi(){const c=De.now();De.tasks.forEach(e=>{e.c(c)||(De.tasks.delete(e),e.f())}),De.tasks.size!==0&&De.tick(fi)}function ys(c){let e;return De.tasks.size===0&&De.tick(fi),{promise:new Promise(t=>{De.tasks.add(e={c,f:t})}),abort(){De.tasks.delete(e)}}}function vt(c,e){vi(()=>{c.dispatchEvent(new CustomEvent(e))})}function As(c){if(c==="float")return"cssFloat";if(c==="offset")return"cssOffset";if(c.startsWith("--"))return c;const e=c.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function ei(c){const e={},t=c.split(";");for(const i of t){const[s,a]=i.split(":");if(!s||a===void 0)break;const n=As(s.trim());e[n]=a.trim()}return e}const ws=c=>c;function de(c,e,t,i){var s=(c&ts)!==0,a=(c&is)!==0,n=s&&a,o=(c&Ji)!==0,d=n?"both":s?"in":"out",h,f=e.inert,g=e.style.overflow,x,b;function y(){return vi(()=>h??=t()(e,i?.()??{},{direction:d}))}var k={is_global:o,in(){if(e.inert=f,!s){b?.abort(),b?.reset?.();return}a||x?.abort(),x=Ft(e,y(),b,1,()=>{vt(e,"introend"),x?.abort(),x=h=void 0,e.style.overflow=g})},out($){if(!a){$?.(),h=void 0;return}e.inert=!0,b=Ft(e,y(),x,0,()=>{vt(e,"outroend"),$?.()})},stop:()=>{x?.abort(),b?.abort()}},m=Yi;if((m.nodes.t??=[]).push(k),s&&hs){var A=o;if(!A){for(var I=m.parent;I&&(I.f&Qi)!==0;)for(;(I=I.parent)&&(I.f&Xi)===0;);A=!I||(I.f&Zi)!==0}A&&Wi(()=>{Ge(()=>k.in())})}}function Ft(c,e,t,i,s){var a=i===1;if(es(e)){var n,o=!1;return jt(()=>{if(!o){var m=e({direction:a?"in":"out"});n=Ft(c,m,t,i,s)}}),{abort:()=>{o=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return vt(c,a?"introstart":"outrostart"),s(),{abort:Qe,deactivate:Qe,reset:Qe,t:()=>i};const{delay:d=0,css:h,tick:f,easing:g=ws}=e;var x=[];if(a&&t===void 0&&(f&&f(0,1),h)){var b=ei(h(0,1));x.push(b,b)}var y=()=>1-i,k=c.animate(x,{duration:d,fill:"forwards"});return k.onfinish=()=>{k.cancel(),vt(c,a?"introstart":"outrostart");var m=t?.t()??1-i;t?.abort();var A=i-m,I=e.duration*Math.abs(A),$=[];if(I>0){var B=!1;if(h)for(var P=Math.ceil(I/16.666666666666668),E=0;E<=P;E+=1){var w=m+A*g(E/P),L=ei(h(w,1-w));$.push(L),B||=L.overflow==="hidden"}B&&(c.style.overflow="hidden"),y=()=>{var R=k.currentTime;return m+A*g(R/I)},f&&ys(()=>{if(k.playState!=="running")return!1;var R=y();return f(R,1-R),!0})}k=c.animate($,{duration:I,fill:"forwards"}),k.onfinish=()=>{y=()=>i,f?.(i,1-i),s()}},{abort:()=>{k&&(k.cancel(),k.effect=null,k.onfinish=Qe)},deactivate:()=>{s=Qe},reset:()=>{i===0&&f?.(1,0)},t:()=>y()}}function gi(c){var e,t,i="";if(typeof c=="string"||typeof c=="number")i+=c;else if(typeof c=="object")if(Array.isArray(c)){var s=c.length;for(e=0;e<s;e++)c[e]&&(t=gi(c[e]))&&(i&&(i+=" "),i+=t)}else for(t in c)c[t]&&(i&&(i+=" "),i+=t);return i}function ks(){for(var c,e,t=0,i="",s=arguments.length;t<s;t++)(c=arguments[t])&&(e=gi(c))&&(i&&(i+=" "),i+=e);return i}function Ss(c){return typeof c=="object"?ks(c):c??""}const ti=[...` 	
\r\fÂ \v\uFEFF`];function Cs(c,e,t){var i=c==null?"":""+c;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var a=s.length,n=0;(n=i.indexOf(s,n))>=0;){var o=n+a;(n===0||ti.includes(i[n-1]))&&(o===i.length||ti.includes(i[o]))?i=(n===0?"":i.substring(0,n))+i.substring(o+1):n=o}}return i===""?null:i}function Es(c,e){return c==null?null:String(c)}function K(c,e,t,i,s,a){var n=c.__className;if(Ae||n!==t||n===void 0){var o=Cs(t,i,a);(!Ae||o!==c.getAttribute("class"))&&(o==null?c.removeAttribute("class"):e?c.className=o:c.setAttribute("class",o)),c.__className=t}else if(a&&s!==a)for(var d in a){var h=!!a[d];(s==null||h!==!!s[d])&&c.classList.toggle(d,h)}return a}function ee(c,e,t,i){var s=c.__style;if(Ae||s!==e){var a=Es(e);(!Ae||a!==c.getAttribute("style"))&&(a==null?c.removeAttribute("style"):c.style.cssText=a),c.__style=e}return i}const Ts=Symbol("is custom element"),Is=Symbol("is html");function me(c){if(Ae){var e=!1,t=()=>{if(!e){if(e=!0,c.hasAttribute("value")){var i=c.value;F(c,"value",null),c.value=i}if(c.hasAttribute("checked")){var s=c.checked;F(c,"checked",null),c.checked=s}}};c.__on_r=t,jt(t),os()}}function F(c,e,t,i){var s=Ps(c);Ae&&(s[e]=c.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&c.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(c[ss]=t),t==null?c.removeAttribute(e):typeof t!="string"&&Ls(c).includes(e)?c[e]=t:c.setAttribute(e,t))}function Ps(c){return c.__attributes??={[Ts]:c.nodeName.includes("-"),[Is]:c.namespaceURI===as}}var ii=new Map;function Ls(c){var e=c.getAttribute("is")||c.nodeName,t=ii.get(e);if(t)return t;ii.set(e,t=[]);for(var i,s=c,a=Element.prototype;a!==s;){i=ns(s);for(var n in i)i[n].set&&t.push(n);s=rs(s)}return t}function _e(c,e,t=e){var i=new WeakSet;ls(c,"input",async s=>{var a=s?c.defaultValue:c.value;if(a=Et(c)?Tt(a):a,t(a),Ke!==null&&i.add(Ke),await cs(),a!==(a=e())){var n=c.selectionStart,o=c.selectionEnd,d=c.value.length;if(c.value=a??"",o!==null){var h=c.value.length;n===o&&o===d&&h>d?(c.selectionStart=h,c.selectionEnd=h):(c.selectionStart=n,c.selectionEnd=Math.min(o,h))}}}),(Ae&&c.defaultValue!==c.value||Ge(e)==null&&c.value)&&(t(Et(c)?Tt(c.value):c.value),Ke!==null&&i.add(Ke)),ds(()=>{var s=e();if(c===document.activeElement){var a=us??Ke;if(i.has(a))return}Et(c)&&s===Tt(c.value)||c.type==="date"&&!s&&!c.value||s!==c.value&&(c.value=s??"")})}function Et(c){var e=c.type;return e==="number"||e==="range"}function Tt(c){return c===""?null:+c}function xt(c){var e=Mt(0);return function(){return arguments.length===1?(_(e,l(e)+1),arguments[0]):(l(e),c())}}class Ms{project;#e=T(ve([]));get stitchBuffer(){return l(this.#e)}set stitchBuffer(e){_(this.#e,e,!0)}#t=T(ve([]));get strokePoints(){return l(this.#t)}set strokePoints(e){_(this.#t,e,!0)}internalBuffer=new Set;constructor(e){this.project=e}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get stitches(){return this.project.activeFrame.activeVeil.stitches}get compositeStitches(){return this.project.activeFrame.compositeStitches}set stitches(e){this.project.activeFrame.activeVeil.stitches=e}clearBuffer(){this.internalBuffer.clear(),this.stitchBuffer=[],this.strokePoints=[]}addBatchToBuffer(e){const t=[...this.strokePoints];e.forEach(i=>{const s=Math.floor(i.x),a=Math.floor(i.y);this.isValidCoord(s,a)&&(this.internalBuffer.add(this.getIndex(s,a)),t.push({x:i.x,y:i.y}))}),this.strokePoints=t,this.stitchBuffer=Array.from(this.internalBuffer)}addToBuffer(e,t){this.addBatchToBuffer([{x:e,y:t}])}reset(e,t,i){this.width=e,this.height=t,this.stitches=i}clear(){this.project.activeFrame.activeVeil.clear()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.compositeStitches[this.getIndex(e,t)]}setColor(e,t,i){this.stitches[this.getIndex(e,t)]=i}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}#i=Y(()=>`calc((100cqi - 20px) * ${this.width} / (${this.width} + 2))`);get fitWidth(){return l(this.#i)}set fitWidth(e){_(this.#i,e)}#s=Y(()=>`calc((100cqb - 20px) * ${this.height} / (${this.height} + 2))`);get fitHeight(){return l(this.#s)}set fitHeight(e){_(this.#s,e)}getFitDimension(e){const t=this.width,i=this.height;return e==="horizontal"?`min(${this.fitWidth}, calc(${this.fitHeight} * (${t} / ${i})))`:`min(${this.fitHeight}, calc(${this.fitWidth} * (${i} / ${t})))`}}class Vs{#e=T(ve({x:0,y:0}));get pos(){return l(this.#e)}set pos(e){_(this.#e,e,!0)}#t=T(!0);get isVisible(){return l(this.#t)}set isVisible(e){_(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}const Fs=["#2d3319","#4b5d16","#859900","#a2ad59","#eee8d5","#fdf6e3","#93a1a1","#586e75","#073642","#002b36"],Bs=["#002b36","#073642","#586e75","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#2aa198","#859900"],It={default:["#073642","#586e75","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"],botanical:Fs,sunset:Bs};class Ds{#e=T(ve(It.default[0]));get activeDye(){return l(this.#e)}set activeDye(e){_(this.#e,e,!0)}#t=T(ve(It.default));get swatches(){return l(this.#t)}set swatches(e){_(this.#t,e,!0)}select(e){e>=0&&e<this.swatches.length&&(this.activeDye=this.swatches[e])}setDye(e){this.activeDye=e}loadPalette(e){this.swatches=It[e],this.activeDye=this.swatches[0]}}const js=["showDyeBasin","showAudioBasin","showPatternCatalog","showArtisanGuide","showArtisanCodex","showArtifactCrate","showLinenSettings","showArchivePattern","showGoTo"],$s={managed:js};class Rs{#e=T(1);get zoomLevel(){return l(this.#e)}set zoomLevel(e){_(this.#e,e,!0)}#t=T(!1);get isMuted(){return l(this.#t)}set isMuted(e){_(this.#t,e,!0)}#i=T(!0);get isAmbientPlaying(){return l(this.#i)}set isAmbientPlaying(e){_(this.#i,e,!0)}#s=T(!1);get isAppReady(){return l(this.#s)}set isAppReady(e){_(this.#s,e,!0)}#a=T(!1);get isPicking(){return l(this.#a)}set isPicking(e){_(this.#a,e,!0)}#r=T(50);get stabilization(){return l(this.#r)}set stabilization(e){_(this.#r,e,!0)}#n=T(.5);get bgmVolume(){return l(this.#n)}set bgmVolume(e){_(this.#n,e,!0)}#o=T(.5);get sfxVolume(){return l(this.#o)}set sfxVolume(e){_(this.#o,e,!0)}#l=T(10);get fps(){return l(this.#l)}set fps(e){_(this.#l,e,!0)}#c=T(!1);get isKineticMode(){return l(this.#c)}set isKineticMode(e){_(this.#c,e,!0)}#d=T(!1);get showGhostThreads(){return l(this.#d)}set showGhostThreads(e){_(this.#d,e,!0)}#u=T(1);get timelineZoom(){return l(this.#u)}set timelineZoom(e){_(this.#u,e,!0)}sessionStartTime=Date.now();#h=T(0);get usageMinutes(){return l(this.#h)}set usageMinutes(e){_(this.#h,e,!0)}#v=T(0);get usageSeconds(){return l(this.#v)}set usageSeconds(e){_(this.#v,e,!0)}#p=Y(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),i=Math.floor(e%3600/60),s=e%60;return`${t>0?t+":":""}${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`});get sessionTimeLabel(){return l(this.#p)}set sessionTimeLabel(e){_(this.#p,e)}#f=T(!1);get showDyeBasin(){return l(this.#f)}set showDyeBasin(e){_(this.#f,e,!0)}#g=T(!1);get showAudioBasin(){return l(this.#g)}set showAudioBasin(e){_(this.#g,e,!0)}#x=T(!1);get showPatternCatalog(){return l(this.#x)}set showPatternCatalog(e){_(this.#x,e,!0)}#b=T(!1);get showArtisanGuide(){return l(this.#b)}set showArtisanGuide(e){_(this.#b,e,!0)}#m=T(!1);get showArtisanCodex(){return l(this.#m)}set showArtisanCodex(e){_(this.#m,e,!0)}#_=T(!1);get showArtifactCrate(){return l(this.#_)}set showArtifactCrate(e){_(this.#_,e,!0)}#y=T(!1);get showLinenSettings(){return l(this.#y)}set showLinenSettings(e){_(this.#y,e,!0)}#A=T(!1);get showArchivePattern(){return l(this.#A)}set showArchivePattern(e){_(this.#A,e,!0)}#w=T(!1);get showGoTo(){return l(this.#w)}set showGoTo(e){_(this.#w,e,!0)}#k=T("veils");get folioActiveTab(){return l(this.#k)}set folioActiveTab(e){_(this.#k,e,!0)}#S=T("#eee8d5");get canvasBgColor(){return l(this.#S)}set canvasBgColor(e){_(this.#S,e,!0)}#C=T(10);get exportScale(){return l(this.#C)}set exportScale(e){_(this.#C,e,!0)}#E=T("transparent");get exportBgColor(){return l(this.#E)}set exportBgColor(e){_(this.#E,e,!0)}escapeStack=[];#T=T(ve([]));get _overlayStack(){return l(this.#T)}set _overlayStack(e){_(this.#T,e,!0)}_managedOverlays=$s.managed;constructor(){setInterval(()=>{const e=Date.now()-this.sessionStartTime;this.usageMinutes=Math.floor(e/6e4),this.usageSeconds=Math.floor(e/1e3)},1e3)}mount(){Te(()=>{for(const e of this._managedOverlays)this[e]?Ge(()=>this._overlayStack.includes(e))||(this._overlayStack=[...Ge(()=>this._overlayStack),e]):Ge(()=>this._overlayStack.includes(e))&&(this._overlayStack=Ge(()=>this._overlayStack.filter(i=>i!==e)))})}setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.1,Math.min(10,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();if(e)return e(),!0;const t=this._overlayStack[this._overlayStack.length-1];return t?(this[t]=!1,!0):!1}}class et{id=crypto.randomUUID();#e=T("New Veil");get name(){return l(this.#e)}set name(e){_(this.#e,e,!0)}#t=T(!0);get isVisible(){return l(this.#t)}set isVisible(e){_(this.#t,e,!0)}#i=T(!1);get isLocked(){return l(this.#i)}set isLocked(e){_(this.#i,e,!0)}#s=T(1);get opacity(){return l(this.#s)}set opacity(e){_(this.#s,e,!0)}#a=T(ve([]));get stitches(){return l(this.#a)}set stitches(e){_(this.#a,e,!0)}constructor(e,t,i){this.name=e,this.stitches=Array(t*i).fill(null)}clone(e,t){const i=new et(this.name,e,t);return i.stitches=[...this.stitches],i.isVisible=this.isVisible,i.isLocked=this.isLocked,i.opacity=this.opacity,i}clear(){this.stitches.fill(null)}hasStitch(e){return this.stitches[e]!==null}}class pt{id=crypto.randomUUID();#e=T("Untitled Frame");get name(){return l(this.#e)}set name(e){_(this.#e,e,!0)}#t=T(32);get width(){return l(this.#t)}set width(e){_(this.#t,e,!0)}#i=T(32);get height(){return l(this.#i)}set height(e){_(this.#i,e,!0)}#s=T(100);get duration(){return l(this.#s)}set duration(e){_(this.#s,e,!0)}#a=T(ve([]));get veils(){return l(this.#a)}set veils(e){_(this.#a,e,!0)}#r=T(0);get activeVeilIndex(){return l(this.#r)}set activeVeilIndex(e){_(this.#r,e,!0)}constructor(e,t=32,i=32){this.name=e,this.width=t,this.height=i,this.veils=[new et("Base Veil",t,i)]}get activeVeil(){return this.veils[this.activeVeilIndex]}addVeil(e){const t=e||`Veil ${this.veils.length+1}`,i=new et(t,this.width,this.height);return this.veils.push(i),this.activeVeilIndex=this.veils.length-1,i}removeVeil(e){this.veils.length<=1||(this.veils.splice(e,1),this.activeVeilIndex>=this.veils.length&&(this.activeVeilIndex=this.veils.length-1))}get compositeStitches(){const e=new Array(this.width*this.height).fill(null);for(const t of this.veils)if(t.isVisible)for(let i=0;i<e.length;i++){const s=t.stitches[i];s!==null&&(e[i]=s)}return e}}class Os{#e=T(null);get currentFilePath(){return l(this.#e)}set currentFilePath(e){_(this.#e,e,!0)}#t=T(null);get lastSaved(){return l(this.#t)}set lastSaved(e){_(this.#t,e,!0)}#i=T(ve([]));get frames(){return l(this.#i)}set frames(e){_(this.#i,e,!0)}#s=T(0);get activeFrameIndex(){return l(this.#s)}set activeFrameIndex(e){_(this.#s,e,!0)}#a=T(!1);get isPlaying(){return l(this.#a)}set isPlaying(e){_(this.#a,e,!0)}#r=T(null);get clipboard(){return l(this.#r)}set clipboard(e){_(this.#r,e,!0)}constructor(){this.frames=[new pt("Main Motif")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,i=new pt(t);return this.frames.push(i),this.activeFrameIndex=this.frames.length-1,i}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e=null){this.currentFilePath=e,this.lastSaved=new Date}}class Ns{#e=T(null);get start(){return l(this.#e)}set start(e){_(this.#e,e,!0)}#t=T(null);get end(){return l(this.#t)}set end(e){_(this.#t,e,!0)}#i=T(ve([]));get indices(){return l(this.#i)}set indices(e){_(this.#i,e,!0)}#s=T(ve([]));get vertices(){return l(this.#s)}set vertices(e){_(this.#s,e,!0)}get isActive(){return this.indices.length>0||this.start!==null||this.vertices.length>0}begin(e,t){this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.indices=[],this.vertices=[]}getPoints(e){const t=new Map;this.indices.forEach(s=>{t.set(s,{x:s%e,y:Math.floor(s/e)})});const i=this.rectangularBounds;if(i)for(let s=i.y1;s<=i.y2;s++)for(let a=i.x1;a<=i.x2;a++){const n=s*e+a;t.set(n,{x:a,y:s})}return Array.from(t.values())}getBoundaryEdges(e){const t=[],i=this.getPoints(e);if(i.length===0)return t;const s=new Set(i.map(a=>`${a.x},${a.y}`));return i.forEach(a=>{s.has(`${a.x},${a.y-1}`)||t.push({x1:a.x,y1:a.y,x2:a.x+1,y2:a.y}),s.has(`${a.x},${a.y+1}`)||t.push({x1:a.x,y1:a.y+1,x2:a.x+1,y2:a.y+1}),s.has(`${a.x-1},${a.y}`)||t.push({x1:a.x,y1:a.y,x2:a.x,y2:a.y+1}),s.has(`${a.x+1},${a.y}`)||t.push({x1:a.x+1,y1:a.y,x2:a.x+1,y2:a.y+1})}),t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){const t=this.getPoints(e);if(t.length===0)return null;let i=1/0,s=-1/0,a=1/0,n=-1/0;return t.forEach(o=>{o.x<i&&(i=o.x),o.x>s&&(s=o.x),o.y<a&&(a=o.y),o.y>n&&(n=o.y)}),{x1:i,x2:s,y1:a,y2:n,width:s-i+1,height:n-a+1}}}class Gs{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){!("isStructural"in e)&&!Array.isArray(e)&&e.oldColor===e.newColor||(this.currentBatch&&!("isStructural"in e)&&!Array.isArray(e)?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const W=new Gs;class zs{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const $t=new zs,Hs={"c-major":[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25]},Us={move:{freq:450,duration:.08,volume:.15},stitch:{freq:1200,duration:.15,volume:.03},startup:{freq:220,duration:.8,volume:.1},ready:[523.25,659.25,783.99,1046.5]},Ks={scale:[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25],chords:[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]],fade:{startMins:30,fullMins:60}},Ne={scales:Hs,tones:Us,ambient:Ks};class qs{get ctx(){return $t.ctx}playTone(e,t,i="sine",s=.1,a=1e-4){if(r.isMuted)return;const n=this.ctx.createOscillator(),o=this.ctx.createGain();n.type=i,n.frequency.setValueAtTime(e,this.ctx.currentTime);const d=s*r.sfxVolume;o.gain.setValueAtTime(d,this.ctx.currentTime),o.gain.exponentialRampToValueAtTime(a,this.ctx.currentTime+t),n.connect(o),o.connect(this.ctx.destination),n.start(),n.stop(this.ctx.currentTime+t)}playMove(){const{freq:e,duration:t,volume:i}=Ne.tones.move;this.playTone(e,t,"sine",i)}playStitch(){const{freq:e,duration:t,volume:i}=Ne.tones.stitch;this.playTone(e,t,"sine",i),setTimeout(()=>this.playTone(e*1.25,t*.6,"sine",i*.6),50)}playScale(e){const t=Ne.scales["c-major"],i=t[e%t.length];this.playTone(i,.15,"sine",.12)}playUnstitch(){if(r.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,i=this.ctx.createBuffer(1,t,this.ctx.sampleRate),s=i.getChannelData(0);for(let h=0;h<t;h++)s[h]=Math.random()*2-1;const a=this.ctx.createBufferSource();a.buffer=i;const n=this.ctx.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(1500,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const o=this.ctx.createGain(),d=.1*r.sfxVolume;o.gain.setValueAtTime(d,this.ctx.currentTime),o.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),a.connect(n),n.connect(o),o.connect(this.ctx.destination),a.start()}playStartup(){const{freq:e,duration:t,volume:i}=Ne.tones.startup;this.playTone(e,t,"sine",i),this.playTone(e/2,t*1.5,"sine",i/2)}playReady(){Ne.tones.ready.forEach((t,i)=>{setTimeout(()=>this.playTone(t,.4,"sine",.05),i*100)})}}const U=new qs;class Ys{move(e,t){const i=Math.max(0,Math.min(r.linen.width-1,r.needle.pos.x+e)),s=Math.max(0,Math.min(r.linen.height-1,r.needle.pos.y+t));return i!==r.needle.pos.x||s!==r.needle.pos.y?(r.needle.setPos(i,s),U.playMove(),!0):!1}internalToCartesian(e,t,i,s){const a=(n,o)=>{const d=Math.floor(o/2);return o%2===0?n<d?n-d:n-d+1:n-d};return{x:a(e,i),y:-a(t,s)}}cartesianToInternal(e,t,i,s){const a=Math.floor(i/2),n=Math.floor(s/2);let o,d;i%2===0?o=e<0?e+a:e+a-1:o=e+a;const h=-t;return s%2===0?d=h<0?h+n:h+n-1:d=h+n,{x:Math.max(0,Math.min(i-1,o)),y:Math.max(0,Math.min(s-1,d))}}jumpTo(e,t){const{x:i,y:s}=this.cartesianToInternal(e,t,r.linen.width,r.linen.height);r.needle.setPos(i,s)}jumpHome(){this.jumpTo(1,1),U.playMove()}}class ze{static getLinePoints(e,t,i,s,a=0){e=Math.floor(e),t=Math.floor(t),i=Math.floor(i),s=Math.floor(s);const n=[],o=Math.abs(i-e),d=Math.abs(s-t),h=e<i?1:-1,f=t<s?1:-1;let g=o-d;for(;;){n.push({x:e,y:t});const x=o===d,b=o===0||d===0;if(a>.9&&!x&&!b&&(o>d?n.push({x:e,y:t+f}):n.push({x:e+h,y:t})),e===i&&t===s)break;const y=2*g;y>-d&&(g-=d,e+=h),y<o&&(g+=o,t+=f)}return n}static getCirclePoints(e,t,i){e=Math.floor(e),t=Math.floor(t),i=Math.round(i);const s=[];let a=i,n=0,o=0;for(;a>=n;)[{x:e+a,y:t+n},{x:e+n,y:t+a},{x:e-n,y:t+a},{x:e-a,y:t+n},{x:e-a,y:t-n},{x:e-n,y:t-a},{x:e+n,y:t-a},{x:e+a,y:t-n}].forEach(h=>s.push(h)),o<=0&&(n+=1,o+=2*n+1),o>0&&(a-=1,o-=2*a+1);return s}static fitArc(e,t){if(e.length<10)return null;let i=0,s=0;e.forEach(w=>{i+=w.x,s+=w.y});const a=i/e.length,n=s/e.length;let o=0;const d=e.map(w=>{const L=Math.sqrt((w.x-a)**2+(w.y-n)**2);return o+=L,L}),h=o/e.length;let f=0;if(d.forEach(w=>{f+=(w-h)**2}),Math.sqrt(f/e.length)/(h||1)>t)return null;const b=e[0],y=e[e.length-1],m=Math.sqrt((b.x-y.x)**2+(b.y-y.y)**2)<h*1.5||e.length>h*Math.PI*1.5,A=[],I=Math.atan2(e[0].y-n,e[0].x-a),$=Math.atan2(e[e.length-1].y-n,e[e.length-1].x-a),B=Math.max(32,Math.floor(h*10));let P=$-I;for(;P>Math.PI;)P-=Math.PI*2;for(;P<-Math.PI;)P+=Math.PI*2;const E=m?Math.PI*2:P;for(let w=0;w<=B;w++){const L=I+E*(w/B);A.push({x:a+Math.cos(L)*h,y:n+Math.sin(L)*h})}return{cx:a,cy:n,r:h,isFull:m,points:A}}static perpendicularDistance(e,t,i){const s=i.x-t.x,a=i.y-t.y;return s===0&&a===0?Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2):Math.abs(a*e.x-s*e.y+i.x*t.y-i.y*t.x)/Math.sqrt(s*s+a*a)}static toCartesianLabel(e,t,i=!1){const s=Math.floor(t/2),a=t%2===0?e<s?e-s:e-s+1:e-s;return i?-a:a}static getGuidePosition(e,t){return 50+e/t*100}}class si{static simplify(e,t){if(e.length<=2||t<=0)return e;let i=0,s=0;const a=e[0],n=e[e.length-1];for(let o=1;o<e.length-1;o++){const d=ze.perpendicularDistance(e[o],a,n);d>i&&(s=o,i=d)}if(i>t){const o=this.simplify(e.slice(0,s+1),t),d=this.simplify(e.slice(s),t);return[...o.slice(0,-1),...d]}else return[a,n]}static smooth(e,t){if(e.length<=2||t<=0)return e;const i=[...e],s=Math.floor(t/10)+1;for(let a=1;a<e.length-1;a++){let n=0,o=0,d=0;for(let h=a-s;h<=a+s;h++)h>=0&&h<e.length&&(n+=e[h].x,o+=e[h].y,d++);i[a]={x:n/d,y:o/d}}return i}static traceCluster(e,t){const i=new Set;for(const a of e){const n=a%t,o=Math.floor(a/t);[{x:n,y:o-1,id:"top"},{x:n+1,y:o,id:"right"},{x:n,y:o+1,id:"bottom"},{x:n-1,y:o,id:"left"}].forEach(h=>{const f=h.y*t+h.x;if(h.x<0||h.x>=t||h.y<0||!e.has(f)){let x;h.id==="top"?x=`${n},${o}-${n+1},${o}`:h.id==="right"?x=`${n+1},${o}-${n+1},${o+1}`:h.id==="bottom"?x=`${n+1},${o+1}-${n},${o+1}`:x=`${n},${o+1}-${n},${o}`,i.add(x)}})}const s=[];for(;i.size>0;){const a=i.values().next().value;if(!a)break;i.delete(a);const[n,o]=a.split("-");let d=o,h=`M ${n.replace(","," ")} L ${o.replace(","," ")}`,f=!0;for(;f;){f=!1;for(const g of i)if(g.startsWith(d+"-")){const[x,b]=g.split("-");h+=` L ${b.replace(","," ")}`,d=b,i.delete(g),f=!0;break}}h+=" Z",s.push(h)}return s.join(" ")}}class Oe{static getLinePoints(e,t,i,s,a=0){return ze.getLinePoints(e,t,i,s,a)}static simplifyPath(e,t){return si.simplify(e,t)}static smoothPath(e,t){return si.smooth(e,t)}static fitArc(e,t){if(t<10)return null;const i=.05+t/100*.35;return ze.fitArc(e,i)}static getCirclePoints(e,t,i){return ze.getCirclePoints(e,t,i)}static floodFill(e,t,i,s,a,n){const o=e[a*t+s];if(o===n)return e;const d=[...e],h=[[s,a]],f=new Set;for(;h.length>0;){const[g,x]=h.pop(),b=x*t+g;if(!f.has(b)){f.add(b),d[b]=n;const y=[[g+1,x],[g-1,x],[g,x+1],[g,x-1]];for(const[k,m]of y)k>=0&&k<t&&m>=0&&m<i&&d[m*t+k]===o&&h.push([k,m])}}return d}static recolor(e,t,i){return e.map(s=>s===t?i:s)}static getPaletteUsage(e){const t=new Set;return e.forEach(i=>{i&&t.add(i)}),t}}class Qs{stitch(e,t){const i=e!==void 0?Math.floor(e):r.needle.pos.x,s=t!==void 0?Math.floor(t):r.needle.pos.y,a=r.linen.getIndex(i,s),n=r.linen.stitches[a],o=r.paletteState.activeDye;if(n!==o){const d=[...r.linen.stitches];d[a]=o,r.linen.stitches=d,W.push({index:a,oldColor:n,newColor:o}),U.playStitch()}}unstitch(e,t){const i=e!==void 0?Math.floor(e):r.needle.pos.x,s=t!==void 0?Math.floor(t):r.needle.pos.y,a=r.linen.getIndex(i,s),n=r.linen.stitches[a];if(n!==null){const o=[...r.linen.stitches];o[a]=null,r.linen.stitches=o,W.push({index:a,oldColor:n,newColor:null}),U.playUnstitch()}}beginStroke(e,t){r.linen.clearBuffer(),r.linen.addToBuffer(e,t)}continueStroke(e,t,i,s){const a=Oe.getLinePoints(i,s,e,t,0);r.linen.addBatchToBuffer(a)}endStroke(){this.commitBuffer()}cancelStroke(){r.linen.clearBuffer(),U.playUnstitch()}snapCurrentStroke(){const e=r.linen.strokePoints;if(e.length<5)return;const t=r.studio.stabilization,i=Oe.smoothPath(e,t/10),s=Oe.fitArc(i,t);r.linen.clearBuffer();let a=[],n=[];if(s&&s.isFull)n=s.points,a=Oe.getCirclePoints(s.cx,s.cy,s.r);else{const o=Oe.simplifyPath(i,t/100*2);if(o.length===2){let d={...o[0]},h={...o[o.length-1]};const f=Math.abs(h.x-d.x),g=Math.abs(h.y-d.y),x=3;if(f<x)h.x=d.x;else if(g<x)h.y=d.y;else if(Math.abs(f-g)<x){const b=Math.max(f,g);h.x=d.x+b*Math.sign(h.x-d.x),h.y=d.y+b*Math.sign(h.y-d.y)}n=[d,h],a=Oe.getLinePoints(d.x,d.y,h.x,h.y,0)}else if(s){n=s.points;for(let d=0;d<n.length-1;d++)a.push(...Oe.getLinePoints(n[d].x,n[d].y,n[d+1].x,n[d+1].y,t/100))}else{n=o;for(let d=0;d<n.length-1;d++)a.push(...Oe.getLinePoints(n[d].x,n[d].y,n[d+1].x,n[d+1].y,t/100))}}r.linen.addBatchToBuffer(a),r.linen.strokePoints=n,U.playStitch()}commitBuffer(){const e=r.linen.stitchBuffer;if(e.length===0){r.linen.clearBuffer();return}const t=r.paletteState.activeDye,i=[],s=[...r.linen.stitches];e.forEach(a=>{const n=s[a];n!==t&&(i.push({index:a,oldColor:n,newColor:t}),s[a]=t)}),i.length>0&&(r.linen.stitches=s,W.push(i),U.playStitch()),r.linen.clearBuffer()}}class Xs{resize(e,t){const i=Array(e*t).fill("#eee8d5");for(let s=0;s<Math.min(r.linen.height,t);s++)for(let a=0;a<Math.min(r.linen.width,e);a++){const n=s*r.linen.width+a,o=s*e+a;i[o]=r.linen.stitches[n]}r.linen.reset(e,t,i),W.clear(),U.playStitch()}flip(e){const{width:t,height:i,stitches:s}=r.linen,a=[...s];if(e==="horizontal")for(let n=0;n<i;n++){const o=s.slice(n*t,(n+1)*t);o.reverse();for(let d=0;d<t;d++)a[n*t+d]=o[d]}else for(let n=0;n<i;n++)for(let o=0;o<t;o++){const d=n*t+o,h=(i-1-n)*t+o;a[h]=s[d]}r.linen.stitches=a,W.clear(),U.playStitch()}rotate(){const{width:e,height:t,stitches:i}=r.linen;if(e!==t)return;const s=Array(e*t).fill("#eee8d5");for(let a=0;a<t;a++)for(let n=0;n<e;n++){const o=a*e+n,d=n*e+(t-1-a);s[d]=i[o]}r.linen.stitches=s,W.clear(),U.playStitch()}clearAll(){confirm("Are you sure you want to unravel the entire project?")&&(r.linen.clear(),W.clear(),U.playUnstitch())}bleach(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t),s=r.activeDye;if(i===s)return;const{stitches:a}=r.linen,n=[],o=r.selection.isActive,d=r.selection.indices;a.forEach((h,f)=>{const g=h===i,x=!o||d.includes(f);g&&x&&(n.push({index:f,oldColor:i,newColor:s}),r.linen.stitches[f]=s)}),n.length>0&&(W.beginBatch(),n.forEach(h=>W.push(h)),W.endBatch(),U.playStitch())}}class Zs{copy(){const e=r.linen.width,t=r.selection.getPoints(e),i=r.selection.getEffectiveBounds(e);if(!i||t.length===0)return;const s=new Array(i.width*i.height).fill(null),a=r.linen.compositeStitches;t.forEach(n=>{const o=n.y*e+n.x,d=n.x-i.x1,f=(n.y-i.y1)*i.width+d;s[f]=a[o]}),r.project.clipboard={width:i.width,height:i.height,data:s},U.playStitch()}cut(){this.copy();const e=r.linen.width,t=r.selection.getPoints(e);t.length!==0&&(W.beginBatch(),t.forEach(i=>{const s=i.y*e+i.x,a=r.linen.stitches[s];W.push({index:s,oldColor:a,newColor:null}),r.linen.stitches[s]=null}),W.endBatch(),U.playUnstitch(),r.selection.clear())}paste(){const e=r.project.clipboard;if(!e)return;const{x:t,y:i}=r.needle.pos,{width:s,height:a}=r.linen;W.beginBatch();for(let n=0;n<e.height;n++)for(let o=0;o<e.width;o++){const d=t+o,h=i+n;if(d>=0&&d<s&&h>=0&&h<a){const f=n*e.width+o,g=e.data[f];if(g!==null){const x=h*s+d,b=r.linen.stitches[x];W.push({index:x,oldColor:b,newColor:g}),r.linen.stitches[x]=g}}}W.endBatch(),U.playStitch()}}class Ws{serialize(){return JSON.stringify({version:r.version,metadata:{name:"Artisan Pattern",lastModified:new Date().toISOString()},palette:r.paletteState.swatches,folio:{frames:r.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,veils:e.veils.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,stitches:t.stitches}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,r.project.currentFilePath||void 0);t&&(r.project.setMetadata(t),U.playStitch())}webDownload(e){const t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download="rupa-motif.rupa",s.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),r.project.setMetadata(e.filePath),U.playStitch())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const i=t.target.files?.[0];if(i){const s=new FileReader;s.onload=a=>this.deserialize(a.target?.result),s.readAsText(i)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),r.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}deserialize(e){try{const t=JSON.parse(e);if(r.paletteState.swatches=t.palette,t.folio)r.project.frames=t.folio.frames.map(i=>{const s=new pt(i.name,i.width,i.height);return s.veils=i.veils.map(a=>{const n=new et(a.name,i.width,i.height);return n.isVisible=a.isVisible,n.isLocked=a.isLocked,n.stitches=a.stitches,n}),s});else if(t.pixelData){const i=new pt("Restored Motif",t.dimensions.width,t.dimensions.height);i.veils[0].stitches=t.pixelData,r.project.frames=[i]}r.project.activeFrameIndex=0,W.clear()}catch(t){console.error("Failed to restore pattern book:",t)}}}class Js{addFrame(e){const t=r.project,i=t.activeFrameIndex,s=t.addFrame(e),a=t.activeFrameIndex;return W.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(a,1),t.activeFrameIndex=i},redo:()=>{t.frames.splice(a,0,s),t.activeFrameIndex=a}}),U.playStitch(),s}removeFrame(e){const t=r.project;if(t.frames.length<=1)return;const i=t.frames[e],s=t.activeFrameIndex;t.removeFrame(e);const a=t.activeFrameIndex;W.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,i),t.activeFrameIndex=s},redo:()=>{t.removeFrame(e),t.activeFrameIndex=a}}),U.playUnstitch()}duplicateFrame(e){const t=r.project,i=t.frames[e],s=t.activeFrameIndex,a=t.addFrame(`${i.name} (Copy)`),n=t.activeFrameIndex;a.width=i.width,a.height=i.height,a.duration=i.duration,a.veils=i.veils.map(o=>o.clone(i.width,i.height)),W.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(n,1),t.activeFrameIndex=s},redo:()=>{t.frames.splice(n,0,a),t.activeFrameIndex=n}}),U.playStitch()}nextFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,W.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),U.playMove()}prevFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,W.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),U.playMove()}addVeil(e){const t=r.project.activeFrame,i=t.activeVeilIndex,s=t.addVeil(e),a=t.activeVeilIndex;return W.push({isStructural:!0,label:"Add Veil",undo:()=>{t.veils.splice(a,1),t.activeVeilIndex=i},redo:()=>{t.veils.splice(a,0,s),t.activeVeilIndex=a}}),U.playStitch(),s}removeVeil(e){const t=r.project.activeFrame;if(t.veils.length<=1)return;const i=t.veils[e],s=t.activeVeilIndex;t.removeVeil(e);const a=t.activeVeilIndex;W.push({isStructural:!0,label:"Remove Veil",undo:()=>{t.veils.splice(e,0,i),t.activeVeilIndex=s},redo:()=>{t.removeVeil(e),t.activeVeilIndex=a}}),U.playUnstitch()}duplicateVeil(e){const t=r.project.activeFrame,i=t.veils[e],s=t.activeVeilIndex,a=i.clone(t.width,t.height);a.name=`${i.name} (Copy)`;const n=e+1;t.veils.splice(n,0,a),t.activeVeilIndex=n,W.push({isStructural:!0,label:"Duplicate Veil",undo:()=>{t.veils.splice(n,1),t.activeVeilIndex=s},redo:()=>{t.veils.splice(n,0,a),t.activeVeilIndex=n}}),U.playStitch()}nextVeil(){const e=r.project.activeFrame,t=e.activeVeilIndex;e.activeVeilIndex=(e.activeVeilIndex+1)%e.veils.length,W.push({isStructural:!0,label:"Next Veil",undo:()=>e.activeVeilIndex=t,redo:()=>e.activeVeilIndex=(t+1)%e.veils.length}),U.playMove()}prevVeil(){const e=r.project.activeFrame,t=e.activeVeilIndex;e.activeVeilIndex=(e.activeVeilIndex-1+e.veils.length)%e.veils.length,W.push({isStructural:!0,label:"Prev Veil",undo:()=>e.activeVeilIndex=t,redo:()=>e.activeVeilIndex=(t-1+e.veils.length)%e.veils.length}),U.playMove()}toggleLock(e){const t=e!==void 0?r.project.activeFrame.veils[e]:r.project.activeFrame.activeVeil;if(t){const i=t.isLocked;t.isLocked=!t.isLocked,W.push({isStructural:!0,label:"Toggle Veil Lock",undo:()=>t.isLocked=i,redo:()=>t.isLocked=!i}),U.playStitch()}}toggleVisibility(e){const t=e!==void 0?r.project.activeFrame.veils[e]:r.project.activeFrame.activeVeil;if(t){const i=t.isVisible;t.isVisible=!t.isVisible,W.push({isStructural:!0,label:"Toggle Veil Visibility",undo:()=>t.isVisible=i,redo:()=>t.isVisible=!i}),U.playStitch()}}reorderVeil(e,t){const i=r.project.activeFrame;if(e===t||t<0||t>=i.veils.length)return;const s=i.activeVeilIndex;((o,d)=>{const[h]=i.veils.splice(o,1);i.veils.splice(d,0,h),i.activeVeilIndex===o?i.activeVeilIndex=d:o<i.activeVeilIndex&&d>=i.activeVeilIndex?i.activeVeilIndex--:o>i.activeVeilIndex&&d<=i.activeVeilIndex&&i.activeVeilIndex++})(e,t);const n=i.activeVeilIndex;W.push({isStructural:!0,label:"Reorder Veil",undo:()=>{i.veils.findIndex((d,h)=>h===t);const[o]=i.veils.splice(t,1);i.veils.splice(e,0,o),i.activeVeilIndex=s},redo:()=>{const[o]=i.veils.splice(e,1);i.veils.splice(t,0,o),i.activeVeilIndex=n}}),U.playMove()}reorderFrame(e,t){const i=r.project;if(e===t||t<0||t>=i.frames.length)return;const s=i.activeFrameIndex;((o,d)=>{const[h]=i.frames.splice(o,1);i.frames.splice(d,0,h),i.activeFrameIndex===o?i.activeFrameIndex=d:o<i.activeFrameIndex&&d>=i.activeFrameIndex?i.activeFrameIndex--:o>i.activeFrameIndex&&d<=i.activeFrameIndex&&i.activeFrameIndex++})(e,t);const n=i.activeFrameIndex;W.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[o]=i.frames.splice(t,1);i.frames.splice(e,0,o),i.activeFrameIndex=s},redo:()=>{const[o]=i.frames.splice(e,1);i.frames.splice(t,0,o),i.activeFrameIndex=n}}),U.playMove()}moveVeilUp(){const e=r.project.activeFrame,t=e.activeVeilIndex;t<e.veils.length-1&&this.reorderVeil(t,t+1)}moveVeilDown(){const t=r.project.activeFrame.activeVeilIndex;t>0&&this.reorderVeil(t,t-1)}}class ea{begin(e,t){r.selection.begin(e,t)}update(e,t){r.selection.isActive&&r.selection.update(e,t)}clear(){r.selection.clear()}commit(){const e=r.selection.getPoints(r.linen.width);if(e.length===0)return;const t=r.paletteState.activeDye,i=r.linen.width;W.beginBatch();let s=!1;e.forEach(a=>{const n=a.y*i+a.x,o=r.linen.stitches[n];o!==t&&(W.push({index:n,oldColor:o,newColor:t}),r.linen.stitches[n]=t,s=!0)}),W.endBatch(),s&&U.playStitch()}spiritPick(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t),s=r.linen.width,a=r.linen.height,n=[[e,t]],o=new Set;for(r.selection.clear();n.length>0;){const[d,h]=n.shift(),f=h*s+d,g=`${d},${h}`;if(!o.has(g)&&(o.add(g),r.linen.getColor(d,h)===i)){r.selection.indices.push(f);const x=[[d+1,h],[d-1,h],[d,h+1],[d,h-1]];for(const[b,y]of x)b>=0&&b<s&&y>=0&&y<a&&n.push([b,y])}}r.selection.indices.length>0&&U.playScale(4)}addVertex(e,t){r.selection.vertices.push({x:e,y:t}),U.playStitch()}sealBinding(){const e=r.selection.vertices;if(e.length<3)return;const t=r.linen.width,i=r.linen.height,s=[];for(let a=0;a<i;a++)for(let n=0;n<t;n++)this.isPointInPoly(n,a,e)&&s.push(a*t+n);s.length>0&&(r.selection.indices=s,r.selection.vertices=[],U.playScale(6))}isPointInPoly(e,t,i){let s=!1;for(let a=0,n=i.length-1;a<i.length;n=a++){const o=i[a].x,d=i[a].y,h=i[n].x,f=i[n].y;d>t!=f>t&&e<(h-o)*(t-d)/(f-d)+o&&(s=!s)}return s}}class ft{static spin(e){const{h:t,s:i,l:s,a}=e,n=t/360,o=i/100,d=s/100;let h,f,g;if(o===0)h=f=g=d;else{const k=d<.5?d*(1+o):d+o-d*o,m=2*d-k,A=I=>(I<0&&(I+=1),I>1&&(I-=1),I<1/6?m+(k-m)*6*I:I<1/2?k:I<2/3?m+(k-m)*(2/3-I)*6:m);h=A(n+1/3),f=A(n),g=A(n-1/3)}const x=k=>Math.round(k*255).toString(16).padStart(2,"0"),b=Math.round(a*255).toString(16).padStart(2,"0"),y=`#${x(h)}${x(f)}${x(g)}`;return b==="ff"?y:y+b}static unravel(e){let t=0,i=0,s=0,a=1;const n=e.replace("#","");n.length===3||n.length===4?(t=parseInt(n[0]+n[0],16),i=parseInt(n[1]+n[1],16),s=parseInt(n[2]+n[2],16),n.length===4&&(a=parseInt(n[3]+n[3],16)/255)):(n.length===6||n.length===8)&&(t=parseInt(n.substring(0,2),16),i=parseInt(n.substring(2,4),16),s=parseInt(n.substring(4,6),16),n.length===8&&(a=parseInt(n.substring(6,8),16)/255)),t/=255,i/=255,s/=255;const o=Math.max(t,i,s),d=Math.min(t,i,s);let h=0,f=0,g=(o+d)/2;if(o!==d){const x=o-d;switch(f=g>.5?x/(2-o-d):x/(o+d),o){case t:h=(i-s)/x+(i<s?6:0);break;case i:h=(s-t)/x+2;break;case s:h=(t-i)/x+4;break}h/=6}return{h:Math.round(h*360),s:Math.round(f*100),l:Math.round(g*100),a:parseFloat(a.toFixed(2))}}static weather(e,t){const i=this.unravel(e);return i.l=Math.max(0,Math.min(100,i.l+t*100)),this.spin(i)}static pigment(e,t){const i=this.unravel(e);return i.s=Math.max(0,Math.min(100,i.s+t*100)),this.spin(i)}static strength(e,t){const i=this.unravel(e);return i.a=Math.max(0,Math.min(1,t)),this.spin(i)}static entwine(e,t,i=.5){this.unravel(e),this.unravel(t);const s=this.hexToRgb(e),a=this.hexToRgb(t),n={r:Math.round(s.r*(1-i)+a.r*i),g:Math.round(s.g*(1-i)+a.g*i),b:Math.round(s.b*(1-i)+a.b*i),a:s.a*(1-i)+a.a*i};return this.rgbToHex(n.r,n.g,n.b,n.a)}static hexToRgb(e){this.unravel(e);const t=e.replace("#","");let i=0,s=0,a=0,n=1;return(t.length===6||t.length===8)&&(i=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),a=parseInt(t.substring(4,6),16),t.length===8&&(n=parseInt(t.substring(6,8),16)/255)),{r:i,g:s,b:a,a:n}}static rgbToHex(e,t,i,s){const a=d=>Math.round(d).toString(16).padStart(2,"0"),n=Math.round(s*255).toString(16).padStart(2,"0"),o=`#${a(e)}${a(t)}${a(i)}`;return n==="ff"?o:o+n}}class ta{select(e){r.paletteState.select(e),U.playScale(e)}setDye(e){r.paletteState.setDye(e),U.playStitch()}pickFromLinen(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t);i!==null&&(this.setDye(i),r.studio.isPicking=!0,setTimeout(()=>{r.studio.isPicking=!1},1500))}weatherPalette(e){r.paletteState.swatches=r.paletteState.swatches.map(t=>ft.weather(t,e)),U.playStitch()}mixActiveDye(e,t=.5){const i=ft.entwine(r.activeDye,e,t);this.setDye(i)}soak(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t),s=r.activeDye;if(i===s)return;const a=r.linen.width,n=r.linen.height,o=[[e,t]],d=new Set,h=[],f=r.selection.isActive,g=r.selection.indices;for(;o.length>0;){const[x,b]=o.shift(),y=b*a+x,k=`${x},${b}`;if(d.has(k))continue;d.add(k);const m=r.linen.getColor(x,b)===i,A=!f||g.includes(y);if(m&&A){h.push({index:y,oldColor:i,newColor:s}),r.linen.stitches[y]=s;const I=[[x+1,b],[x-1,b],[x,b+1],[x,b-1]];for(const[$,B]of I)$>=0&&$<a&&B>=0&&B<n&&o.push([$,B])}}h.length>0&&(W.beginBatch(),h.forEach(x=>W.push(x)),W.endBatch(),U.playStitch())}}class ia{movement=new Ys;stitching=new Qs;manipulation=new Xs;clipboard=new Zs;persistence=new Ws;folio=new Js;selection=new ea;dye=new ta;moveNeedle(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}jumpHome(){this.movement.jumpHome()}stitch(){this.stitching.stitch()}unstitch(){this.stitching.unstitch()}pickDye(){this.dye.pickFromLinen()}startSelection(){this.selection.begin(r.needle.pos.x,r.needle.pos.y)}updateSelection(){this.selection.update(r.needle.pos.x,r.needle.pos.y)}commitSelection(){this.selection.commit()}clearLinen(){this.manipulation.clearAll()}resizeLinen(e,t){this.manipulation.resize(e,t)}flipLinen(e){this.manipulation.flip(e)}rotateLinen(){this.manipulation.rotate()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),r.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async createArtifact(e,t=10,i="transparent"){const{ExportEngine:s}=await pi(async()=>{const{ExportEngine:f}=await import("./CpWpvAaI.js");return{ExportEngine:f}},__vite__mapDeps([0,1,2,3]),import.meta.url),{width:a,height:n,compositeStitches:o}=r.linen,d=["webm","gif","mp4"].includes(e),h=r.project.frames.length<=1&&d?"png":e;if(h==="svg")if(r.project.frames.length>1){const f=r.project.frames.map(y=>y.compositeStitches),g=r.project.frames.map(y=>y.duration),x=s.toAnimatedSVG(a,n,f,g,i),b=new Blob([x],{type:"image/svg+xml"});this.download(URL.createObjectURL(b),"rupa-kinetic.svg")}else{const f=s.toSVG(a,n,o,i),g=new Blob([f],{type:"image/svg+xml"});this.download(URL.createObjectURL(g),"rupa-motif.svg")}else if(h==="webm"||h==="mp4"){const f=r.project.frames.map(y=>y.compositeStitches),g=r.project.frames.map(y=>y.duration),x=await s.toVideo(a,n,f,g,t,h,i),b=x.type.includes("mp4")?"mp4":"webm";this.download(URL.createObjectURL(x),`rupa-stitch.${b}`)}else if(h==="gif"){const f=r.project.frames.map(b=>b.compositeStitches),g=r.project.frames.map(b=>b.duration),x=await s.toGIF(a,n,f,g,t,i);this.download(URL.createObjectURL(x),"rupa-weave.gif")}else{const f=await s.toRaster(a,n,o,t,h,i);this.download(f,`rupa-artifact.${h}`)}r.studio.showArtifactCrate=!1}download(e,t){const i=document.createElement("a");i.href=e,i.download=t.toLowerCase().replace(/\s+/g,"-"),i.click()}}const D=new ia;class sa{version="0.6.1";project=new Os;linen=new Ms(this.project);needle=new Vs;paletteState=new Ds;studio=new Rs;selection=new Ns;get stitches(){return this.linen.stitches}set stitches(e){this.linen.stitches=e}get linenWidth(){return this.linen.width}set linenWidth(e){this.linen.width=e}get linenHeight(){return this.linen.height}set linenHeight(e){this.linen.height=e}get needlePos(){return this.needle.pos}set needlePos(e){this.needle.pos=e}get activeDye(){return this.paletteState.activeDye}set activeDye(e){this.paletteState.activeDye=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get zoomLevel(){return this.studio.zoomLevel}set zoomLevel(e){this.studio.zoomLevel=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get isAmbientPlaying(){return this.studio.isAmbientPlaying}set isAmbientPlaying(e){this.studio.isAmbientPlaying=e}get isKineticMode(){return this.studio.isKineticMode}set isKineticMode(e){this.studio.isKineticMode=e}get showGhostThreads(){return this.studio.showGhostThreads}set showGhostThreads(e){this.studio.showGhostThreads=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get usageMinutes(){return this.studio.usageMinutes}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isNeedleVisible(){return this.needle.isVisible}set isNeedleVisible(e){this.needle.isVisible=e}get currentFilePath(){return this.project.currentFilePath}set currentFilePath(e){this.project.currentFilePath=e}get lastSaved(){return this.project.lastSaved}set lastSaved(e){this.project.lastSaved=e}get clipboard(){return this.project.clipboard}set clipboard(e){this.project.clipboard=e}get showDyeBasin(){return this.studio.showDyeBasin}set showDyeBasin(e){this.studio.showDyeBasin=e}get showAudioBasin(){return this.studio.showAudioBasin}set showAudioBasin(e){this.studio.showAudioBasin=e}get showPatternCatalog(){return this.studio.showPatternCatalog}set showPatternCatalog(e){this.studio.showPatternCatalog=e}get showArtisanGuide(){return this.studio.showArtisanGuide}set showArtisanGuide(e){this.studio.showArtisanGuide=e}get showArtisanCodex(){return this.studio.showArtisanCodex}set showArtisanCodex(e){this.studio.showArtisanCodex=e}get showArtifactCrate(){return this.studio.showArtifactCrate}set showArtifactCrate(e){this.studio.showArtifactCrate=e}get showLinenSettings(){return this.studio.showLinenSettings}set showLinenSettings(e){this.studio.showLinenSettings=e}get showArchivePattern(){return this.studio.showArchivePattern}set showArchivePattern(e){this.studio.showArchivePattern=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get exportScale(){return this.studio.exportScale}set exportScale(e){this.studio.exportScale=e}get exportBgColor(){return this.studio.exportBgColor}set exportBgColor(e){this.studio.exportBgColor=e}get selectionStart(){return this.selection.start}set selectionStart(e){this.selection.start=e}get selectionEnd(){return this.selection.end}set selectionEnd(e){this.selection.end=e}#e=Y(()=>{const e=this.linen.width,t=this.linen.height,i=e/(e+2),s=t/(t+2);return{x:Math.min(i,s*(e/t)),y:Math.min(s,i*(t/e))}});get fitRatios(){return l(this.#e)}set fitRatios(e){_(this.#e,e)}#t=Y(()=>{const e=new Set;return this.linen.compositeStitches.forEach(t=>{t!==null&&e.add(t)}),Array.from(e)});get usedColors(){return l(this.#t)}set usedColors(e){_(this.#t,e)}#i=Y(()=>{const e=(t,i)=>{const s=Math.floor(i/2);return i%2===0?t<s?t-s:t-s+1:t-s};return{x:e(this.needle.pos.x,this.linen.width),y:-e(this.needle.pos.y,this.linen.height)}});get displayCoords(){return l(this.#i)}set displayCoords(e){_(this.#i,e)}#s=Y(()=>{const e=this.studio.zoomLevel;if(this.studio.zoomLevel<=1)return`translate(-50%, -50%) scale(${e})`;const t=(this.needle.pos.x+.5)/this.linen.width*100,i=(this.needle.pos.y+.5)/this.linen.height*100;return`translate(-${t}%, -${i}%) scale(${e})`});get cameraTransform(){return l(this.#s)}set cameraTransform(e){_(this.#s,e)}#a=Y(()=>{if(this.studio.zoomLevel>1)return{x:50,y:50};const e=this.studio.zoomLevel,t=(this.needle.pos.x+.5)/this.linen.width*100,i=(this.needle.pos.y+.5)/this.linen.height*100;return{x:50+(t-50)*e*this.fitRatios.x,y:50+(i-50)*e*this.fitRatios.y}});get needleViewportPct(){return l(this.#a)}set needleViewportPct(e){_(this.#a,e)}resetInactivityTimer(){this.needle.resetInactivityTimer()}toggleMute(){this.studio.toggleMute()}setZoom(e){this.studio.setZoom(e)}resetZoom(){this.studio.resetZoom()}selectPalette(e){this.paletteState.select(e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}handleEscape(){return this.studio.handleEscape()}undo(){const e=W.undo();if(e)if("isStructural"in e)e.undo(),U.playUnstitch();else if(Array.isArray(e)){for(let t=e.length-1;t>=0;t--){const i=e[t];this.linen.stitches[i.index]=i.oldColor}U.playUnstitch()}else this.linen.stitches[e.index]=e.oldColor,U.playUnstitch();this.needle.resetInactivityTimer()}redo(){const e=W.redo();if(e)if("isStructural"in e)e.redo(),U.playStitch();else if(Array.isArray(e)){for(const t of e)this.linen.stitches[t.index]=t.newColor;U.playStitch()}else this.linen.stitches[e.index]=e.newColor,U.playStitch();this.needle.resetInactivityTimer()}clearLinen(){D.clearLinen()}pickDye(){D.pickDye()}loadProject(){D.load()}copySelection(){D.copy()}cutSelection(){D.cut()}pasteSelection(){D.paste()}flipLinen(e){D.flipLinen(e)}rotateLinen(){D.rotateLinen()}}const r=new sa,aa={MOVE_UP:{label:"Step the Needle Up",keys:["ArrowUp"],group:"The Needle"},MOVE_DOWN:{label:"Step the Needle Down",keys:["ArrowDown"],group:"The Needle"},MOVE_LEFT:{label:"Step the Needle Left",keys:["ArrowLeft"],group:"The Needle"},MOVE_RIGHT:{label:"Step the Needle Right",keys:["ArrowRight"],group:"The Needle"},GOTO:{label:"Jump to Coordinate",keys:["g"],group:"The Needle"},JUMP_HOME:{label:"Return to Center",keys:["Ctrl+h"],group:"The Needle"}},ra={STITCH:{label:"Stitch (Apply Active Dye)",keys:["Space","Enter"],group:"The Hand"},UNSTITCH:{label:"Clear Fiber (Unstitch)",keys:["Backspace","Delete"],group:"The Hand"},PICK_DYE:{label:"Sample Fiber (Eyedropper)",keys:["i","Alt+Space"],group:"The Hand"},SOAK:{label:"Dye Soak (Flood Fill)",keys:["f"],group:"Artisan Magic"},BLEACH:{label:"Fiber Bleach (Recolor All)",keys:["Alt+r"],group:"Artisan Magic"},SPIRIT_PICK:{label:"Spirit Pick (Magic Selection)",keys:["w"],group:"Artisan Magic"}},na={FLOW_STITCH:{label:"Continuous Threading",keys:["Ctrl"],group:"Continuous Weaving"},FLOW_UNSTITCH:{label:"Continuous Unravelling",keys:["Ctrl+Shift"],group:"Continuous Weaving"},FLOW_SELECT:{label:"Define Selection (Loom)",keys:["Shift"],group:"Continuous Weaving"}},oa={COPY:{label:"Capture to Swatch (Copy)",keys:["Ctrl+c"],group:"The Loom"},CUT:{label:"Snip to Swatch (Cut)",keys:["Ctrl+x"],group:"The Loom"},PASTE:{label:"Weave from Clipboard (Paste)",keys:["Ctrl+v"],group:"The Loom"},CLEAR_LINEN:{label:"Strip the Linen (Clear All)",keys:["Ctrl+l"],group:"The Loom"}},la={FLIP_H:{label:"Flip Horizontally",keys:["h"],group:"Dimensions & Forms"},FLIP_V:{label:"Flip Vertically",keys:["v"],group:"Dimensions & Forms"},ROTATE:{label:"Rotate 90Â° Clockwise",keys:["r"],group:"Dimensions & Forms"},ZOOM_IN:{label:"Loom Zoom In",keys:["+","="],group:"Dimensions & Forms"},ZOOM_OUT:{label:"Loom Zoom Out",keys:["-"],group:"Dimensions & Forms"},RESET_ZOOM:{label:"Reset Loom Zoom",keys:["Ctrl+0"],group:"Dimensions & Forms"}},ca={NEW_FRAME:{label:"New Time Thread (Frame)",keys:["Alt+n"],group:"The Spindle"},DUPLICATE_FRAME:{label:"Clone Current Thread",keys:["Ctrl+d"],group:"The Spindle"},DELETE_FRAME:{label:"Dissolve Thread",keys:["Alt+d"],group:"The Spindle"},NEXT_FRAME:{label:"Next Page (Frame)",keys:["Alt+PageDown","Tab"],group:"The Spindle"},PREV_FRAME:{label:"Previous Page (Frame)",keys:["Alt+PageUp","Shift+Tab"],group:"The Spindle"},PLAY_PULSE:{label:"Toggle Playback",keys:["p"],group:"The Spindle"},TOGGLE_GHOST_THREADS:{label:"See Ghost Threads (Onion Skin)",keys:["Alt+g"],group:"The Spindle"}},da={NEW_VEIL:{label:"Add New Veil (Layer)",keys:["Alt+Shift+n"],group:"The Veils"},DUPLICATE_VEIL:{label:"Clone Active Veil",keys:["Ctrl+d"],group:"The Veils"},DELETE_VEIL:{label:"Remove Active Veil",keys:["Alt+d"],group:"The Veils"},MOVE_VEIL_UP:{label:"Lift Veil Up",keys:["["],group:"The Veils"},MOVE_VEIL_DOWN:{label:"Lower Veil Down",keys:["]"],group:"The Veils"},TOGGLE_VEIL_VISIBILITY:{label:"Reveal/Hide Veil",keys:["Alt+h"],group:"The Veils"},TOGGLE_VEIL_LOCK:{label:"Seal/Unseal Veil",keys:["Alt+l"],group:"The Veils"}},ua={OPEN_PALETTE:{label:"Consult the Pattern Catalog",keys:["Ctrl+k"],group:"The Pattern Book"},OPEN_EXPORT:{label:"Open the Artifact Crate",keys:["Ctrl+e"],group:"The Pattern Book"},OPEN_ARCHIVE:{label:"Archive Pattern (Save)",keys:["Ctrl+s"],group:"The Pattern Book"},OPEN_SETTINGS:{label:"Studio Settings",keys:["Ctrl+,"],group:"The Pattern Book"},OPEN_CODEX:{label:"Open Artisan Codex",keys:["F1"],group:"The Pattern Book"},OPEN_DYES:{label:"Open Natural Dye Basin",keys:["b"],group:"The Pattern Book"},OPEN_HELP:{label:"Quick Guide",keys:["F2"],group:"The Pattern Book"},OPEN_AUDIO:{label:"Open Audio Basin",keys:["Ctrl+Shift+a"],group:"Atmosphere & Tuning"},TOGGLE_MUTE:{label:"Silence the Studio",keys:["Ctrl+m"],group:"Atmosphere & Tuning"},UNDO:{label:"Rewind Last Stitch",keys:["Ctrl+z"],group:"Atmosphere & Tuning"},REDO:{label:"Fast-Forward last Stitch",keys:["Ctrl+Shift+z","Ctrl+y"],group:"Atmosphere & Tuning"},ESCAPE:{label:"Clear Focus / Dismiss Overlays",keys:["Escape"],group:"Basic Rhythms"}},ha={SELECT_DYE_1:{label:"Select Dye 1",keys:["1"],group:"The Hand"},SELECT_DYE_2:{label:"Select Dye 2",keys:["2"],group:"The Hand"},SELECT_DYE_3:{label:"Select Dye 3",keys:["3"],group:"The Hand"},SELECT_DYE_4:{label:"Select Dye 4",keys:["4"],group:"The Hand"},SELECT_DYE_5:{label:"Select Dye 5",keys:["5"],group:"The Hand"},SELECT_DYE_6:{label:"Select Dye 6",keys:["6"],group:"The Hand"},SELECT_DYE_7:{label:"Select Dye 7",keys:["7"],group:"The Hand"},SELECT_DYE_8:{label:"Select Dye 8",keys:["8"],group:"The Hand"},SELECT_DYE_9:{label:"Select Dye 9",keys:["9"],group:"The Hand"},SELECT_DYE_0:{label:"Select Dye 0",keys:["0"],group:"The Hand"}},va={TAB_FRAMES:{label:"Focus Spindle Tab",keys:["Alt+1"],group:"The Spindle"},TAB_VEILS:{label:"Focus Veils Tab",keys:["Alt+2"],group:"The Veils"}},pa={navigation:aa,stitching:ra,flows:na,manipulation:oa,transform:la,kinetic:ca,layering:da,studio:ua,palette:ha,tabs:va};class fa{buffer=[];timeout=null;#e=T(ve([]));get currentSequence(){return l(this.#e)}set currentSequence(e){_(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const i=this.buffer.join(","),s={"g,c":"GOTO","f,n":"NEW_FRAME","v,n":"NEW_VEIL","v,l":"TOGGLE_VEIL_LOCK","v,h":"TOGGLE_VEIL_VISIBILITY","v,m":"MERGE_VEILS"};if(s[i]){const a=s[i];return this.reset(),a}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const Bt=new fa;class ga{patterns=[];#e=T(ve([]));get activeKeys(){return l(this.#e)}set activeKeys(e){_(this.#e,e,!0)}#t=T(!1);get isCtrlActive(){return l(this.#t)}set isCtrlActive(e){_(this.#t,e,!0)}#i=T(!1);get isShiftActive(){return l(this.#i)}set isShiftActive(e){_(this.#i,e,!0)}#s=T(!1);get isAltActive(){return l(this.#s)}set isAltActive(e){_(this.#s,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){this.patterns=[],Object.values(pa).forEach(e=>{Object.entries(e).forEach(([t,i])=>{const{keys:s,group:a}=i,n=__({key:`shortcuts.labels.${t}`}),o=a.toLowerCase().replace(/ & /g,"_").replace(/ /g,"_"),d=__({key:`shortcuts.groups.${o}`});s.forEach(h=>{const f=h.toLowerCase().split("+");let g=f[f.length-1].trim();g==="space"&&(g=" "),(g==="ctrl"||g==="control")&&(g="control"),this.patterns.push({intent:t,key:g,ctrl:f.includes("ctrl")||f.includes("control"),shift:f.includes("shift"),alt:f.includes("alt"),label:n,group:d})})})}),this.patterns.sort((e,t)=>{const i=s=>(s.ctrl?1:0)+(s.shift?1:0)+(s.alt?1:0);return i(t)-i(e)})}getActions(){const e=new Set,t=[];return this.patterns.forEach(i=>{e.has(i.intent)||(e.add(i.intent),t.push({intent:i.intent,label:i.label,group:i.group,shortcut:this.getLabel(i.intent)}))}),t}getGroupedActions(){const e=this.getActions(),t={},i={MOVE_UP:"Arrows",MOVE_DOWN:"Arrows",MOVE_LEFT:"Arrows",MOVE_RIGHT:"Arrows",SELECT_DYE_1:"1-0",SELECT_DYE_2:"1-0",SELECT_DYE_3:"1-0",SELECT_DYE_4:"1-0",SELECT_DYE_5:"1-0",SELECT_DYE_6:"1-0",SELECT_DYE_7:"1-0",SELECT_DYE_8:"1-0",SELECT_DYE_9:"1-0",SELECT_DYE_0:"1-0"},s=[],a=new Set;return e.forEach(o=>{const d=i[o.intent];if(d){if(!a.has(d)){a.add(d);const h=d.toLowerCase(),f=__({key:`shortcuts.groups.${h}`});s.push({...o,label:f,customKey:d})}}else s.push(o)}),s.forEach(o=>{t[o.group]||(t[o.group]=[]),t[o.group].push(o)}),[__({key:"shortcuts.groups.basic_rhythms"}),__({key:"shortcuts.groups.the_needle"}),__({key:"shortcuts.groups.the_hand"}),__({key:"shortcuts.groups.continuous_weaving"}),__({key:"shortcuts.groups.artisan_magic"}),__({key:"shortcuts.groups.the_loom"}),__({key:"shortcuts.groups.dimensions_forms"}),__({key:"shortcuts.groups.the_spindle"}),__({key:"shortcuts.groups.the_veils"}),__({key:"shortcuts.groups.the_pattern_book"}),__({key:"shortcuts.groups.atmosphere_tuning"})].filter(o=>t[o]).map(o=>({group:o,items:t[o]}))}updatePhysicalState(e,t){const i=e.key.toLowerCase();t==="down"?this.activeKeys.includes(i)||this.activeKeys.push(i):(this.activeKeys=this.activeKeys.filter(s=>s!==i),i==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="control"&&s!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const i=Bt.process(t);if(i)return i}else Bt.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const i of this.patterns)if(t===i.key&&this.isCtrlActive===i.ctrl&&this.isShiftActive===i.shift&&this.isAltActive===i.alt)return i.intent;return null}getLabel(e){const t=this.patterns.find(d=>d.intent===e);if(!t)return"Unassigned";const i=[];t.ctrl&&i.push("Ctrl"),t.shift&&i.push("Shift"),t.alt&&i.push("Alt");let s=t.key;const a={" ":"Space",control:"Ctrl",meta:"Cmd",alt:"Alt",shift:"Shift",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right",backspace:"Backspace",delete:"Delete",enter:"Enter",escape:"Esc",tab:"Tab"},n=s.toLowerCase();a[n]?s=a[n]:s=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();const o=i.filter(d=>d.toLowerCase()!==s.toLowerCase());return o.length===0?s:o.join("+")+"+"+s}}const Ce=new ga;class xa{#e=Y(()=>Bt.isActive?{type:"ORGANIZING",label:"Weaving...",icon:"ð",color:"var(--color-brand)",isPulse:!0}:r.isPicking?{type:"PICKING",label:"Picking Dye",icon:"ð",color:"var(--color-brand)",isPulse:!0}:Ce.isCtrlActive&&Ce.isShiftActive?{type:"UNRAVELLING",label:"Unravelling",icon:"ð§¶",color:"var(--color-brand)",isPulse:!0}:Ce.isShiftActive?{type:"LOOMING",label:"Block Looming",icon:"â¨",color:"var(--color-brand)",isPulse:!0}:Ce.isCtrlActive?{type:"THREADING",label:"Threading",icon:"ð§µ",color:"var(--color-studio-teal)",isPulse:!0}:{type:"RESTING",label:"Studio Ready",icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return l(this.#e)}set current(e){_(this.#e,e)}}const ge=new xa;class ba{isPointerDown=!1;lastPosition={x:-1,y:-1};buttonType=null;holdTimer=null;isSnapped=!1;rafId=null;#e=T(!1);get isSnappedState(){return l(this.#e)}set isSnappedState(e){_(this.#e,e,!0)}mapToGrid(e,t,i){const s=i.getBoundingClientRect(),{width:a,height:n}=r.linen,o=(e-s.left)/s.width,d=(t-s.top)/s.height;return{x:o*a,y:d*n}}handleStart(e,t){this.isPointerDown=!0,this.isSnapped=!1,this.buttonType=e.button===2?"secondary":"primary";const i=this.mapToGrid(e.clientX,e.clientY,t);this.lastPosition={x:i.x,y:i.y},r.needle.pos={x:Math.floor(i.x),y:Math.floor(i.y)};const s=ge.current.type;this.buttonType==="primary"&&s!=="LOOMING"&&s!=="UNRAVELLING"&&(D.stitching.beginStroke(i.x,i.y),this.startHoldTimer())}handleMove(e,t){this.isPointerDown&&(this.rafId||(this.rafId=requestAnimationFrame(()=>{const i=this.mapToGrid(e.clientX,e.clientY,t),s=ge.current.type;this.buttonType==="primary"&&s!=="LOOMING"&&s!=="UNRAVELLING"&&(this.isSnapped||(D.stitching.continueStroke(i.x,i.y,this.lastPosition.x,this.lastPosition.y),this.resetHoldTimer())),this.lastPosition={x:i.x,y:i.y},this.rafId=null})))}handleEnd(){if(!this.isPointerDown)return;this.isPointerDown=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);const e=ge.current.type;this.buttonType==="primary"&&e!=="LOOMING"&&e!=="UNRAVELLING"?D.stitching.endStroke():r.linen.clearBuffer(),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1}cancel(){this.isPointerDown=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1,D.stitching.cancelStroke()}startHoldTimer(){this.clearHoldTimer(),this.holdTimer=setTimeout(()=>{this.isPointerDown&&this.triggerSnap()},600)}resetHoldTimer(){this.isSnapped||this.startHoldTimer()}clearHoldTimer(){this.holdTimer&&clearTimeout(this.holdTimer),this.holdTimer=null}triggerSnap(){this.isSnapped=!0,this.isSnappedState=!0,D.stitching.snapCurrentStroke()}}const $e=new ba;class ma{#e=T("KEYBOARD");get activeSource(){return l(this.#e)}set activeSource(e){_(this.#e,e,!0)}listeners=[];constructor(){}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}emit(e,t,i){this.activeSource=t;const s={intent:e,source:t,meta:i};this.listeners.forEach(a=>a(s))}mount(e,t){const i=s=>{if(!r.studio.isAppReady)return;const a=s.target;if(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a.isContentEditable)return;Ce.updatePhysicalState(s,"down");const n=Ce.getIntent(s);n&&(s.preventDefault(),this.emit(n,"KEYBOARD"))};if(t){const s=o=>{const d=o.pointerType==="pen"?"PEN":o.pointerType==="touch"?"TOUCH":"MOUSE";$e.handleStart(o,t),this.activeSource=d},a=o=>{$e.handleMove(o,t)},n=o=>{$e.handleEnd()};t.addEventListener("pointerdown",s),e.addEventListener("pointermove",a),e.addEventListener("pointerup",n)}return e.addEventListener("keydown",i),e.addEventListener("keyup",s=>Ce.updatePhysicalState(s,"up")),()=>{e.removeEventListener("keydown",i)}}}const ai=new ma;class _a{isPlaying=!1;nextNoteTime=0;timer=null;get ctx(){return $t.ctx}scale=Ne.ambient.scale;chords=Ne.ambient.chords;currentChordIndex=0;toggle(){this.isPlaying?this.stop():this.start()}start(){this.isPlaying||(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||r.studio.isMuted||!r.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){const t=this.chords[this.currentChordIndex],s=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(s,e),this.pianoPluck(s*2,e,.02),Math.random()>.7&&this.pianoPluck(s*.5,e+.05,.03)}pianoPluck(e,t,i=.06){const{startMins:s,fullMins:a}=Ne.ambient.fade,n=r.usageMinutes;let o=0;n>=s&&n<a?o=(n-s)/(a-s):n>=a&&(o=1);const d=i*o*r.bgmVolume;if(d<.001)return;const h=this.ctx.createOscillator(),f=this.ctx.createGain(),g=this.ctx.createBiquadFilter();h.type=Math.random()>.5?"sine":"triangle",h.frequency.setValueAtTime(e,t),g.type="lowpass",g.frequency.setValueAtTime(1200,t),g.frequency.exponentialRampToValueAtTime(400,t+1.5),f.gain.setValueAtTime(0,t),f.gain.linearRampToValueAtTime(d,t+.02),f.gain.exponentialRampToValueAtTime(1e-4,t+2.5),h.connect(g),g.connect(f),f.connect(this.ctx.destination),h.start(t),h.stop(t+2.6)}}const ya=new _a;class Aa{interval=null;#e=T(0);get elapsedTime(){return l(this.#e)}set elapsedTime(e){_(this.#e,e,!0)}#t=Y(()=>r.project.frames.reduce((e,t)=>e+t.duration,0));get totalDuration(){return l(this.#t)}set totalDuration(e){_(this.#t,e)}startPlayback(){if(!r.project.isPlaying){if(r.project.frames.length<=1){U.playUnstitch();return}r.project.isPlaying=!0,this.elapsedTime=0;for(let e=0;e<r.project.activeFrameIndex;e++)this.elapsedTime+=r.project.frames[e].duration;U.playStitch(),this.tick()}}stopPlayback(){r.project.isPlaying=!1,this.interval&&(clearTimeout(this.interval),this.interval=null)}togglePlayback(){r.project.isPlaying?this.stopPlayback():this.startPlayback()}tick(){if(!r.project.isPlaying)return;const e=r.project.activeFrame,t=(r.project.activeFrameIndex+1)%r.project.frames.length;this.interval=setTimeout(()=>{r.project.activeFrameIndex=t,t===0?this.elapsedTime=0:this.elapsedTime+=e.duration,this.tick()},e.duration)}}const xi=new Aa;class bi{backupInterval=null;unsubscribeSynapse=null;mount(e=null){this.backupInterval=setInterval(()=>D.persistence.backup(),600*1e3),r.studio.mount(),ya.start(),this.unsubscribeSynapse=ai.subscribe(i=>{this.handleIntent(i.intent)});const t=ai.mount(window,e);return()=>{this.unsubscribeSynapse&&this.unsubscribeSynapse(),t(),clearInterval(this.backupInterval)}}handleIntent(e){switch($t.resume(),r.needle.resetInactivityTimer(),e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"JUMP_HOME":return D.jumpHome();case"GOTO":return r.studio.showGoTo=!0;case"STITCH":return r.selection.isActive?D.commitSelection():D.stitching.stitch();case"UNSTITCH":return D.stitching.unstitch();case"SOAK":return D.dye.soak();case"BIND_VERTEX":return D.selection.addVertex(r.needle.pos.x,r.needle.pos.y);case"SEAL_BINDING":return r.selection.vertices.length>=3?D.selection.sealBinding():r.selection.isActive?D.commitSelection():D.stitching.stitch();case"PICK_DYE":return D.dye.pickFromLinen();case"COPY":return D.clipboard.copy();case"CUT":return D.clipboard.cut();case"PASTE":return D.clipboard.paste();case"BLEACH":return D.manipulation.bleach();case"UNDO":return r.undo();case"REDO":return r.redo();case"SAVE":return D.persistence.save();case"OPEN":return D.persistence.load();case"OPEN_ARCHIVE":return r.studio.showArchivePattern=!0;case"OPEN_SETTINGS":return r.studio.showLinenSettings=!0;case"ESCAPE":if($e.isPointerDown){$e.cancel();return}if(r.selection.isActive){r.selection.clear();return}return r.handleEscape();case"OPEN_PALETTE":return r.studio.showPatternCatalog=!r.studio.showPatternCatalog;case"OPEN_DYES":return r.studio.showDyeBasin=!r.studio.showDyeBasin;case"OPEN_AUDIO":return r.studio.showAudioBasin=!r.studio.showAudioBasin;case"OPEN_EXPORT":return r.studio.showArtifactCrate=!0;case"OPEN_HELP":return r.studio.showArtisanGuide=!0;case"OPEN_CODEX":return r.studio.showArtisanCodex=!0;case"PLAY_PULSE":return xi.togglePlayback();case"TOGGLE_GHOST_THREADS":return r.studio.showGhostThreads=!r.studio.showGhostThreads;case"ZOOM_IN":return r.studio.setZoom(.1);case"ZOOM_OUT":return r.studio.setZoom(-.1);case"RESET_ZOOM":return r.studio.resetZoom();case"CLEAR_LINEN":return D.manipulation.clearAll();case"TOGGLE_MUTE":return r.studio.toggleMute();case"SPIRIT_PICK":return D.selection.spiritPick();case"FLIP_H":return D.manipulation.flip("horizontal");case"FLIP_V":return D.manipulation.flip("vertical");case"ROTATE":return D.manipulation.rotate();case"NEW_FRAME":return D.folio.addFrame();case"DUPLICATE_FRAME":return D.folio.duplicateFrame(r.project.activeFrameIndex);case"NEXT_FRAME":return D.folio.nextFrame();case"PREV_FRAME":return D.folio.prevFrame();case"DELETE_FRAME":return D.folio.removeFrame(r.project.activeFrameIndex);case"TAB_FRAMES":return r.studio.folioActiveTab="frames";case"TAB_VEILS":return r.studio.folioActiveTab="veils";case"NEW_VEIL":return D.folio.addVeil();case"DUPLICATE_VEIL":return D.folio.duplicateVeil(r.project.activeFrame.activeVeilIndex);case"NEXT_VEIL":return D.folio.nextVeil();case"PREV_VEIL":return D.folio.prevVeil();case"DELETE_VEIL":return D.folio.removeVeil(r.project.activeFrame.activeVeilIndex);case"TOGGLE_VEIL_LOCK":return D.folio.toggleLock();case"TOGGLE_VEIL_VISIBILITY":return D.folio.toggleVisibility();case"MOVE_VEIL_UP":return D.folio.moveVeilUp();case"MOVE_VEIL_DOWN":return D.folio.moveVeilDown();default:if(e.startsWith("SELECT_DYE_")){const t=parseInt(e.split("_")[2]);return D.dye.select(t===0?9:t-1)}}}executeMove(e,t){if(D.movement.move(e,t)){const i=ge.current.type;i==="LOOMING"&&(r.selection.isActive||D.startSelection(),D.updateSelection()),i==="THREADING"&&D.stitching.stitch(),i==="UNRAVELLING"&&D.stitching.unstitch()}}}const mi=new bi,wa=Object.freeze(Object.defineProperty({__proto__:null,TheLoom:bi,loom:mi},Symbol.toStringTag,{value:"Module"}));var ka=M(`<div class="flex flex-col items-center justify-center text-center"><h1>Rupa</h1> <p>The Weaver's Studio</p></div>`);function _i(c,e){let t=ae(e,"size",3,"md");const i={sm:{h1:"text-xl",p:"text-[6px]"},md:{h1:"text-3xl",p:"text-[8px]"},lg:{h1:"text-6xl",p:"text-[12px]"}};let s=Y(()=>i[t()]);var a=ka(),n=v(a),o=p(n,2);u(a),z(()=>{K(n,1,`font-tiny5 leading-none text-brand ${l(s).h1??""} tracking-tighter`),K(o,1,`font-serif font-bold tracking-[0.3em] uppercase opacity-40 ${l(s).p??""}`)}),C(c,a)}var Se=xt(()=>r),Sa=M('<div class="flex items-center gap-3"><button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð§º</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð¿</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true"> </span> </button> <div class="mx-1 h-6 w-px bg-grid-border" aria-hidden="true"></div> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">â¨ï¸</span> </button></div>');function Ca(c,e){X(e,!1),be();var t=Sa(),i=v(t);i.__click=()=>Se(Se().studio.showPatternCatalog=!0);var s=p(v(i));s.nodeValue=` ${__({key:"hud.basin.catalog_title"})??""}`,u(i);var a=p(i,2);a.__click=()=>Se(Se().studio.showArtifactCrate=!0);var n=p(v(a));n.nodeValue=` ${__({key:"hud.actions.preserve_weave"})??""}`,u(a);var o=p(a,2);o.__click=()=>Se().clearLinen();var d=p(v(o));d.nodeValue=` ${__({key:"hud.actions.clear_linen"})??""}`,u(o);var h=p(o,2);h.__click=()=>Se(Se().showAudioBasin=!0);var f=v(h),g=v(f,!0);u(f);var x=p(f);x.nodeValue=` ${__({key:"hud.atmosphere.title"})??""}`,u(h);var b=p(h,4);b.__click=()=>Se(Se().showArtisanCodex=!0);var y=p(v(b));y.nodeValue=` ${__({key:"codex.title"})??""}`,u(b);var k=p(b,2);k.__click=()=>Se(Se().showArtisanGuide=!0);var m=p(v(k));m.nodeValue=` ${__({key:"guide.title"})??""}`,u(k),u(t),z(()=>H(g,Se().isMuted?"ð":"ð")),C(c,t),Z()}pe(["click"]);const Ea=c=>c;function Rt(c){const e=c-1;return e*e*e+1}function ri(c){const e=typeof c=="string"&&c.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[c,"px"]}function Ee(c,{delay:e=0,duration:t=400,easing:i=Ea}={}){const s=+getComputedStyle(c).opacity;return{delay:e,duration:t,easing:i,css:a=>`opacity: ${a*s}`}}function yi(c,{delay:e=0,duration:t=400,easing:i=Rt,x:s=0,y:a=0,opacity:n=0}={}){const o=getComputedStyle(c),d=+o.opacity,h=o.transform==="none"?"":o.transform,f=d*(1-n),[g,x]=ri(s),[b,y]=ri(a);return{delay:e,duration:t,easing:i,css:(k,m)=>`
			transform: ${h} translate(${(1-k)*g}${x}, ${(1-k)*b}${y});
			opacity: ${d-f*m}`}}function Ta(c,{delay:e=0,duration:t=400,easing:i=Rt,axis:s="y"}={}){const a=getComputedStyle(c),n=+a.opacity,o=s==="y"?"height":"width",d=parseFloat(a[o]),h=s==="y"?["top","bottom"]:["left","right"],f=h.map(A=>`${A[0].toUpperCase()}${A.slice(1)}`),g=parseFloat(a[`padding${f[0]}`]),x=parseFloat(a[`padding${f[1]}`]),b=parseFloat(a[`margin${f[0]}`]),y=parseFloat(a[`margin${f[1]}`]),k=parseFloat(a[`border${f[0]}Width`]),m=parseFloat(a[`border${f[1]}Width`]);return{delay:e,duration:t,easing:i,css:A=>`overflow: hidden;opacity: ${Math.min(A*20,1)*n};${o}: ${A*d}px;padding-${h[0]}: ${A*g}px;padding-${h[1]}: ${A*x}px;margin-${h[0]}: ${A*b}px;margin-${h[1]}: ${A*y}px;border-${h[0]}-width: ${A*k}px;border-${h[1]}-width: ${A*m}px;min-${o}: 0`}}function gt(c,{delay:e=0,duration:t=400,easing:i=Rt,start:s=0,opacity:a=0}={}){const n=getComputedStyle(c),o=+n.opacity,d=n.transform==="none"?"":n.transform,h=1-s,f=o*(1-a);return{delay:e,duration:t,easing:i,css:(g,x)=>`
			transform: ${d} scale(${1-h*x});
			opacity: ${o-f*x}
		`}}var Ia=M('<span class="font-mono text-[8px] font-bold tracking-widest text-studio-text/30 uppercase"> </span>'),Pa=M('<div class="flex flex-col items-end px-4"><!></div>');function La(c,e){X(e,!1),be();var t=Pa(),i=v(t);{var s=a=>{var n=Ia(),o=v(n,!0);u(n),z(d=>H(o,d),[()=>__({key:"project.archived",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}})]),de(3,n,()=>Ee),C(a,n)};q(i,a=>{r.project.lastSaved&&a(s)})}u(t),C(c,t),Z()}var Ma=M('<div class="hud-panel flex h-16 w-full items-center justify-between px-6 py-2"><div class="flex items-center gap-10"><!> <div class="h-8 w-[2px] bg-grid-border opacity-50"></div> <!></div> <!></div>');function Va(c){var e=Ma(),t=v(e),i=v(t);_i(i,{size:"md"});var s=p(i,4);Ca(s,{}),u(t);var a=p(t,2);La(a,{}),u(e),C(c,e)}var Fa=M('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ðï¸</span></button>'),Ba=M('<div class="h-1.5 w-1.5 rounded-xl bg-brand" aria-hidden="true"></div>'),Da=M('<div role="listitem" draggable="true"><button class="flex flex-1 items-center gap-3 overflow-hidden py-3 pl-2 text-left"><span class="text-xs opacity-40" aria-hidden="true"></span> <span class="truncate font-serif text-sm font-medium text-studio-text"> </span></button> <div class="flex items-center gap-2 pr-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ð</span></button> <!> <!></div></div>'),ja=M('<div class="flex flex-col gap-1" role="list"></div>'),$a=M('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ðï¸</span></button>'),Ra=M('<div class="h-1.5 w-1.5 rounded-xl bg-brand" aria-hidden="true"></div>'),Oa=M('<div role="listitem" draggable="true"><div class="flex flex-1 items-center gap-3 overflow-hidden"><button><span aria-hidden="true"> </span></button> <button> </button></div> <div class="flex items-center gap-2 pr-2"><button><span aria-hidden="true"> </span></button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ð</span></button> <!> <!></div></div>'),Na=M('<div class="flex flex-col gap-1" role="list"></div>'),Ga=M('<div class="flex w-full flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/80 shadow-lg backdrop-blur-md" role="region" aria-label="Folio Ledger"><div class="flex border-b border-black/5 bg-black/5 p-1" role="tablist"><button role="tab"><span aria-hidden="true">ð¼ï¸</span> </button> <button role="tab"><span aria-hidden="true">ð§µ</span> </button></div> <div class="custom-scrollbar max-h-[30vh] overflow-y-auto p-3"><!></div> <div class="flex items-center justify-between bg-black/5 px-5 py-2"><button class="flex items-center gap-1 font-serif text-[8px] font-bold tracking-[0.2em] text-studio-text/30 uppercase hover:text-studio-text/60"><span aria-hidden="true">ï¼</span> </button> <span class="font-serif text-[8px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div>');function za(c,e){X(e,!0);let t=T(null),i=T(null);function s(w){_(t,w,!0)}function a(w,L){w.preventDefault(),_(i,L,!0)}function n(w,L){w.preventDefault(),l(t)!==null&&(r.studio.folioActiveTab==="veils"?D.folio.reorderVeil(l(t),L):D.folio.reorderFrame(l(t),L)),_(t,null),_(i,null)}function o(){_(t,null),_(i,null)}var d=Ga(),h=v(d),f=v(h);f.__click=()=>r.studio.folioActiveTab="frames",F(f,"title",__({key:"shortcuts.labels.TAB_FRAMES"})+" (Alt+1)");var g=p(v(f));g.nodeValue=` ${__({key:"hud.ledger.frames"})??""}`,u(f);var x=p(f,2);x.__click=()=>r.studio.folioActiveTab="veils",F(x,"title",__({key:"shortcuts.labels.TAB_VEILS"})+" (Alt+2)");var b=p(v(x));b.nodeValue=` ${__({key:"hud.ledger.veils"})??""}`,u(x),u(h);var y=p(h,2),k=v(y);{var m=w=>{var L=ja();xe(L,21,()=>r.project.frames,ke,(R,G,S)=>{var O=Da(),V=v(O);V.__click=()=>r.project.activeFrameIndex=S;var j=v(V);j.textContent=S+1;var Q=p(j,2),ie=v(Q,!0);u(Q),u(V);var N=p(V,2),te=v(N);te.__click=se=>{se.stopPropagation(),D.folio.duplicateFrame(S)},F(te,"title",__({key:"hud.actions.duplicate"})+" (Ctrl+D)");var oe=p(te,2);{var re=se=>{var le=Fa();le.__click=Le=>{Le.stopPropagation(),D.folio.removeFrame(S)},F(le,"title",__({key:"hud.actions.delete"})+" (Alt+D)"),C(se,le)};q(oe,se=>{r.project.frames.length>1&&se(re)})}var fe=p(oe,2);{var Ie=se=>{var le=Ba();C(se,le)};q(fe,se=>{S===r.project.activeFrameIndex&&se(Ie)})}u(N),u(O),z(()=>{K(O,1,`group flex cursor-grab items-center justify-between rounded-xl px-2 transition-all ${S===r.project.activeFrameIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${l(i)===S&&l(t)!==S?"border-t-2 border-brand":""} ${l(t)===S?"opacity-40":""}`),F(O,"aria-current",S===r.project.activeFrameIndex?"true":void 0),H(ie,l(G).name)}),ue("dragstart",O,()=>s(S)),ue("dragover",O,se=>a(se,S)),ue("drop",O,se=>n(se,S)),ue("dragend",O,o),C(R,O)}),u(L),de(3,L,()=>Ee,()=>({duration:150})),C(w,L)},A=w=>{var L=Na();xe(L,21,()=>r.project.activeFrame.veils,ke,(R,G,S)=>{var O=Oa(),V=v(O),j=v(V);j.__click=ne=>{ne.stopPropagation(),D.folio.toggleVisibility(S)},F(j,"title",__({key:"hud.ledger.visibility"}));var Q=v(j),ie=v(Q,!0);u(Q),u(j);var N=p(j,2);N.__click=()=>r.project.activeFrame.activeVeilIndex=S;var te=v(N,!0);u(N),u(V);var oe=p(V,2),re=v(oe);re.__click=ne=>{ne.stopPropagation(),D.folio.toggleLock(S)},F(re,"title",__({key:"hud.ledger.lock"}));var fe=v(re),Ie=v(fe,!0);u(fe),u(re);var se=p(re,2);se.__click=ne=>{ne.stopPropagation(),D.folio.duplicateVeil(S)},F(se,"title",__({key:"hud.actions.duplicate"})+" (Ctrl+D)");var le=p(se,2);{var Le=ne=>{var Be=$a();Be.__click=Pe=>{Pe.stopPropagation(),D.folio.removeVeil(S)},F(Be,"title",__({key:"hud.actions.delete"})+" (Alt+D)"),C(ne,Be)};q(le,ne=>{r.project.activeFrame.veils.length>1&&ne(Le)})}var Fe=p(le,2);{var ce=ne=>{var Be=Ra();C(ne,Be)};q(Fe,ne=>{S===r.project.activeFrame.activeVeilIndex&&ne(ce)})}u(oe),u(O),z(()=>{K(O,1,`group flex cursor-grab items-center justify-between rounded-xl px-2 transition-all ${S===r.project.activeFrame.activeVeilIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${l(i)===S&&l(t)!==S?"border-t-2 border-brand":""} ${l(t)===S?"opacity-40":""}`),F(O,"aria-current",S===r.project.activeFrame.activeVeilIndex?"true":void 0),K(j,1,`ml-2 text-xs transition-opacity ${l(G).isVisible?"opacity-100":"opacity-20"}`),H(ie,l(G).isVisible?"ðï¸":"ð¶ï¸"),K(N,1,`flex-1 truncate py-3 text-left font-serif text-sm font-medium text-studio-text ${l(G).isVisible?"":"opacity-40"}`),H(te,l(G).name),K(re,1,`text-[10px] transition-opacity ${l(G).isLocked?"opacity-100":"opacity-20"}`),H(Ie,l(G).isLocked?"ð":"ð")}),ue("dragstart",O,()=>s(S)),ue("dragover",O,ne=>a(ne,S)),ue("drop",O,ne=>n(ne,S)),ue("dragend",O,o),C(R,O)}),u(L),de(3,L,()=>Ee,()=>({duration:150})),C(w,L)};q(k,w=>{r.studio.folioActiveTab==="frames"?w(m):w(A,!1)})}u(y);var I=p(y,2),$=v(I);$.__click=()=>{r.studio.folioActiveTab==="frames"?D.folio.addFrame():D.folio.addVeil()};var B=p(v($));u($);var P=p($,2),E=v(P,!0);u(P),u(I),u(d),z((w,L)=>{F(f,"aria-selected",r.studio.folioActiveTab==="frames"),K(f,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.folioActiveTab==="frames"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),F(x,"aria-selected",r.studio.folioActiveTab==="veils"),K(x,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.folioActiveTab==="veils"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),H(B,` ${w??""}`),H(E,L)},[()=>r.studio.folioActiveTab==="frames"?__({key:"hud.actions.add_frame"}):__({key:"hud.actions.add_veil"}),()=>r.studio.folioActiveTab==="frames"?r.project.frames.length+" "+__({key:"hud.ledger.frames"}):r.project.activeFrame.veils.length+" "+__({key:"hud.ledger.veils"})]),C(c,d),Z()}pe(["click"]);var Ha=M('<aside class="side-panel-left flex h-full w-full flex-col gap-6 p-4"><div class="flex-1 overflow-y-auto"><!></div></aside>');function Ua(c){var e=Ha(),t=v(e),i=v(t);za(i,{}),u(t),u(e),C(c,e)}var Ka=M('<button class="group artisan-checker-small relative h-5 w-5 shrink-0 rounded-md border-2 border-white shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[6px] drop-shadow-sm">ð</span></div></button>'),qa=M('<div class="flex h-5 w-5 items-center justify-center rounded-md border-2 border-dashed border-studio-text/10"><span class="text-[6px] opacity-20">ð§µ</span></div>'),Ya=M('<div class="artisan-panel flex w-full flex-col gap-4 px-3 py-4 shadow-sm"><div class="flex flex-col items-center gap-2"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Active Dye</span> <div class="artisan-checker-small h-8 w-8 rounded-lg border-2 border-white shadow-md transition-colors"></div> <span class="font-mono text-[8px] font-bold tracking-tighter uppercase opacity-40"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col gap-3"><span class="text-center font-serif text-[7px] font-bold uppercase opacity-30">Used Dyes</span> <div class="no-scrollbar flex max-h-[150px] flex-row flex-wrap gap-1.5 overflow-y-auto svelte-1dy8mnv"></div></div></div>');function Qa(c,e){X(e,!1),be();var t=Ya(),i=v(t),s=p(v(i),2),a=p(s,2),n=v(a,!0);u(a),u(i);var o=p(i,4),d=p(v(o),2);xe(d,5,()=>r.usedColors,h=>h,(h,f)=>{var g=Ka();g.__click=()=>D.dye.setDye(l(f)),z(()=>{ee(g,`background-color: ${l(f)??""};`),F(g,"title",l(f))}),de(3,g,()=>Ta,()=>({duration:200})),C(h,g)},h=>{var f=qa();C(h,f)}),u(d),u(o),u(t),z(()=>{ee(s,`background-color: ${r.paletteState.activeDye??""};`),H(n,r.paletteState.activeDye)}),C(c,t),Z()}pe(["click"]);var Xa=M('<div class="artisan-panel stats-panel w-full rounded-xl px-4 py-3 shadow-sm" role="status"><div class="flex flex-col gap-2"><div class="flex flex-col"><span class="font-serif text-[7px] font-bold text-studio-text/30 uppercase"></span> <span class="font-mono text-[10px] font-bold text-studio-text tabular-nums"> </span></div> <div class="h-px w-full bg-studio-text/10" aria-hidden="true"></div> <div class="flex flex-col"><span class="font-serif text-[7px] font-bold text-studio-text/30 uppercase"></span> <span class="font-mono text-[10px] font-bold text-studio-text tabular-nums"> </span></div></div></div>');function Za(c,e){X(e,!1),be();var t=Xa(),i=v(t),s=v(i),a=v(s);a.textContent=__({key:"stats.needle_focus"});var n=p(a,2),o=v(n);u(n),u(s);var d=p(s,4),h=v(d);h.textContent=__({key:"stats.linen_size"});var f=p(h,2),g=v(f);u(f),u(d),u(i),u(t),z(()=>{H(o,`${r.displayCoords.x??""}, ${r.displayCoords.y??""}`),H(g,`${r.linen.width??""}Ã${r.linen.height??""}`)}),C(c,t),Z()}var Ze=xt(()=>r),Wa=M('<button role="radio"></button>'),Ja=M('<div class="artisan-panel flex w-full flex-col gap-3 rounded-xl p-3 shadow-sm" role="region"><span class="text-center font-serif text-[7px] font-bold text-studio-text/30 uppercase"></span> <div class="grid grid-cols-4 gap-2" role="radiogroup"><!> <button class="flex h-8 w-8 items-center justify-center rounded-lg border-2 border-dashed border-brand/40 bg-gradient-to-tr from-rose-200 to-sky-200 shadow-sm transition-all hover:scale-110 hover:border-brand"><span class="text-xs" aria-hidden="true">ï¼</span></button></div></div>');function er(c,e){X(e,!1),be();var t=Ja();F(t,"aria-label",__({key:"shortcuts.groups.the_hand"}));var i=v(t);i.textContent=__({key:"shortcuts.groups.swatches"});var s=p(i,2),a=v(s);xe(a,1,()=>Ze().palette,ke,(o,d,h)=>{var f=Wa();f.__click=()=>D.dye.select(h),z((g,x)=>{K(f,1,`artisan-checker-small h-8 w-8 rounded-lg border-2 transition-all ${Ze().activeDye===l(d)?"scale-110 border-brand shadow-md ring-2 ring-white":"border-white opacity-70 hover:scale-105 hover:opacity-100"}`),ee(f,`background-color: ${l(d)??""};`),F(f,"aria-label",g),F(f,"title",x),F(f,"aria-checked",Ze().activeDye===l(d))},[()=>__({key:"shortcuts.labels.SELECT_DYE",replace:{index:h+1}}),()=>__({key:"shortcuts.labels.SELECT_DYE",replace:{index:h+1}})+` (${(h+1)%10})`]),C(o,f)});var n=p(a,2);n.__click=()=>Ze(Ze().studio.showDyeBasin=!0),F(n,"title",__({key:"dye_basin.title"})+" (B)"),F(n,"aria-label",__({key:"dye_basin.title"})),u(s),u(t),C(c,t),Z()}pe(["click"]);var tr=M('<aside class="side-panel-right flex h-full w-full flex-col gap-6 p-4"><div class="flex flex-col gap-4"><!> <!></div> <div class="flex-1"></div> <!></aside>');function ir(c){var e=tr(),t=v(e),i=v(t);Qa(i,{});var s=p(i,2);er(s,{}),u(t);var a=p(t,4);Za(a,{}),u(e),C(c,e)}var sr=M('<span class="text-xs" aria-hidden="true"> </span>'),ar=M('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),rr=M("<div><!> <span> </span> <!></div>"),nr=M('<div class="text-[8px] font-bold tracking-[0.2em] text-studio-text/20 uppercase"> </div>'),or=M('<div role="status" aria-live="polite"><div class="flex w-[180px] items-center"><!></div> <!></div>');function lr(c,e){X(e,!1),be();var t=or(),i=v(t),s=v(i);gs(s,()=>ge.current.type,o=>{var d=rr(),h=v(d);{var f=k=>{var m=sr(),A=v(m,!0);u(m),z(()=>H(A,ge.current.icon)),C(k,m)};q(h,k=>{ge.current.icon&&k(f)})}var g=p(h,2),x=v(g,!0);u(g);var b=p(g,2);{var y=k=>{var m=ar(),A=v(m);u(m),z(()=>H(A,`v${r.version??""}`)),C(k,m)};q(b,k=>{ge.current.type==="RESTING"&&k(y)})}u(d),z(()=>{K(d,1,`status-tag flex items-center gap-2 ${ge.current.isPulse?"animate-pulse":""}`),ee(d,`
					border-color: color-mix(in srgb, ${ge.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${ge.current.color??""} 10%, transparent);
					color: ${ge.current.color??""};
				`),K(g,1,Ss(ge.current.type==="RESTING"?"font-serif italic opacity-60":"font-bold")),H(x,ge.current.label)}),C(o,d)}),u(i);var a=p(i,2);{var n=o=>{const d=ht(()=>r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var h=nr(),f=v(h,!0);u(h),z((g,x)=>{F(h,"aria-label",g),H(f,x)},[()=>__({key:"project.archived",replace:{time:l(d)}}),()=>__({key:"project.archived",replace:{time:l(d)}})]),C(o,h)};q(a,o=>{r.project.lastSaved&&o(n)})}u(t),z(()=>K(t,1,`flex items-center gap-4 transition-opacity duration-1000 ${r.needle.isVisible?"opacity-100":"opacity-0"}`)),C(c,t),Z()}var cr=M('<span class="rounded bg-brand/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-brand uppercase"> </span>'),dr=M('<span class="font-mono text-[9px] text-studio-text/20 italic"></span>'),ur=M('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic"></span> <div class="flex min-w-[100px] gap-1.5"><!></div></div>');function hr(c,e){X(e,!1),be();var t=ur(),i=v(t);i.textContent=`${__({key:"ledger.chord"})??""}:`;var s=p(i,2),a=v(s);{var n=d=>{var h=Ve(),f=he(h);xe(f,1,()=>Ce.activeKeys,ke,(g,x)=>{var b=cr(),y=v(b,!0);u(b),z(()=>H(y,l(x)===" "?"Space":l(x))),C(g,b)}),C(d,h)},o=d=>{var h=dr();h.textContent=__({key:"ledger.none"}),C(d,h)};q(a,d=>{Ce.activeKeys.length>0?d(n):d(o,!1)})}u(s),u(t),C(c,t),Z()}var vr=M('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic"></span> <span class="font-mono text-[9px] font-bold text-brand uppercase"> </span></div>');function pr(c,e){X(e,!1),be();var t=vr(),i=v(t);i.textContent=`${__({key:"ledger.stance"})??""}:`;var s=p(i,2),a=v(s,!0);u(s),u(t),z(()=>H(a,ge.current.type)),C(c,t),Z()}var fr=M('<div class="flex items-center gap-1.5"><span aria-hidden="true">ð¹</span> <span class="font-serif text-[8px] font-bold tracking-wider text-brand/40 uppercase italic"><!></span></div>');function gr(c,e){X(e,!1),be();var t=fr();F(t,"title",__({key:"ledger.atmosphere.title"}));var i=v(t),s=p(i,2),a=v(s);{var n=d=>{var h=Je();h.nodeValue=__({key:"ledger.atmosphere.silent"}),C(d,h)},o=d=>{var h=Ve(),f=he(h);{var g=b=>{var y=Je();y.nodeValue=__({key:"ledger.atmosphere.weaving"}),C(b,y)},x=b=>{var y=Je();y.nodeValue=__({key:"ledger.atmosphere.resonance"}),C(b,y)};q(f,b=>{r.usageMinutes<60?b(g):b(x,!1)},!0)}C(d,h)};q(a,d=>{r.usageMinutes<30?d(n):d(o,!1)})}u(s),u(t),z(()=>K(i,1,`text-[9px] ${r.usageMinutes>=30?"animate-pulse":"opacity-20 grayscale"}`)),C(c,t),Z()}var xr=M('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">â³</span> <span class="font-mono text-[9px] font-bold text-brand/60 tabular-nums"> </span></div>');function br(c,e){X(e,!1),be();var t=xr();F(t,"title",__({key:"ledger.timer"}));var i=p(v(t),2),s=v(i,!0);u(i),u(t),z(()=>H(s,r.studio.sessionTimeLabel)),C(c,t),Z()}var mr=M('<div class="flex items-center gap-1.5" role="status"><span class="text-[9px] text-brand/60" aria-hidden="true">ð¸ï¸</span> <span class="font-serif text-[8px] font-bold tracking-wider text-brand/60 uppercase italic"> </span></div>');function _r(c,e){X(e,!0);let t=Y(()=>r.selection.getPoints(r.linen.width).length);var i=Ve(),s=he(i);{var a=n=>{var o=mr(),d=p(v(o),2),h=v(d,!0);u(d),u(o),z((f,g)=>{F(o,"title",f),H(h,g)},[()=>__({key:"stats.active_motif",replace:{count:l(t)}}),()=>__({key:"stats.active_motif",replace:{count:l(t)}})]),de(3,o,()=>Ee),C(n,o)};q(s,n=>{l(t)>0&&n(a)})}C(c,i),Z()}var yr=M('<div class="flex items-center gap-1.5"><span class="text-[10px]" aria-hidden="true">ð¾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand uppercase"> </span></div> <div class="h-3 w-px bg-brand/20" aria-hidden="true"></div>',1),Ar=M('<div class="flex items-center gap-3 text-studio-text/40" role="status"><!> <div class="flex gap-2 font-mono text-[8px] font-bold tracking-tighter uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-brand/20" aria-hidden="true"></div> <span class="font-mono text-[9px] font-black tracking-widest text-brand/60 uppercase"></span></div>');function wr(c,e){X(e,!1),be();var t=Ar(),i=v(t);{var s=b=>{var y=yr(),k=he(y),m=p(v(k),2),A=v(m,!0);u(m),u(k),st(2),z(I=>H(A,I),[()=>__({key:"project.archived",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}})]),de(3,k,()=>Ee),C(b,y)};q(i,b=>{r.project.lastSaved&&b(s)})}var a=p(i,2),n=v(a),o=v(n);u(n);var d=p(n,2),h=v(d);u(d);var f=p(d,2),g=v(f);u(f),u(a);var x=p(a,4);x.textContent=__({key:"stats.technical_ledger"}),u(t),z(b=>{H(o,`Pos: ${r.needle.pos.x??""},${r.needle.pos.y??""}`),H(h,`Size: ${r.linen.width??""}x${r.linen.height??""}`),H(g,`Zoom: ${b??""}%`)},[()=>Math.round(r.studio.zoomLevel*100)]),C(c,t),Z()}var kr=M('<div class="flex flex-1 items-center justify-between px-3 opacity-60 transition-opacity hover:opacity-100"><div class="flex items-center gap-4"><!> <div class="h-3 w-px bg-brand/10"></div> <!> <div class="h-3 w-px bg-brand/10"></div> <div class="flex items-center gap-3"><!> <!> <div class="h-3 w-px bg-brand/10"></div> <!></div></div> <!></div>');function Sr(c){var e=kr(),t=v(e),i=v(t);hr(i,{});var s=p(i,4);pr(s,{});var a=p(s,4),n=v(a);br(n,{});var o=p(n,2);gr(o,{});var d=p(o,4);_r(d,{}),u(a),u(t);var h=p(t,2);wr(h,{}),u(e),C(c,e)}var ye=xt(()=>r),Cr=M('<div class="flex items-center gap-4 border-r border-black/5 pr-4" role="toolbar" aria-label="Spindle Controls"><button><span class="text-xs" aria-hidden="true"> </span> <span class="font-tiny5 tracking-widest uppercase"> </span></button> <div class="flex items-center gap-2 rounded-xl bg-black/5 px-3 py-1 ring-1 ring-black/5"><label for="pace-input" class="font-serif text-[11px] font-black tracking-tight text-studio-text/50 uppercase"></label> <input id="pace-input" type="number" min="1" max="60" class="w-10 bg-transparent text-center font-mono text-sm font-bold text-studio-text focus:outline-none"/> <span class="font-serif text-[10px] font-black text-studio-text/30" aria-hidden="true">FPS</span></div> <button><span class="text-xs" aria-hidden="true">ð»</span> <span class="font-serif text-[11px] font-black tracking-wider text-studio-text/70 uppercase">Ghosts</span></button> <div class="flex items-center gap-2 border-l border-black/5 pl-4"><span class="text-xs opacity-40" aria-hidden="true">ð</span> <input type="range" min="0.5" max="4" step="0.1" class="artisan-range w-20 svelte-113d3cf" title="Timeline Zoom"/> <span class="w-8 font-mono text-[10px] font-bold text-studio-text/40"> </span></div></div>');function Er(c,e){X(e,!1),be();var t=Cr(),i=v(t);i.__click=()=>xi.togglePlayback(),F(i,"title",__({key:"shortcuts.labels.PLAY_PULSE"})+" (P)"),F(i,"aria-label",__({key:"shortcuts.labels.PLAY_PULSE"}));var s=v(i),a=v(s,!0);u(s);var n=p(s,2),o=v(n,!0);u(n),u(i);var d=p(i,2),h=v(d);h.textContent=__({key:"artifact.fps_label"});var f=p(h,2);me(f),st(2),u(d);var g=p(d,2);g.__click=()=>ye(ye().studio.showGhostThreads=!ye().studio.showGhostThreads),F(g,"title",__({key:"shortcuts.labels.TOGGLE_GHOST_THREADS"})+" (Alt+G)"),F(g,"aria-label",__({key:"shortcuts.labels.TOGGLE_GHOST_THREADS"}));var x=p(g,2),b=p(v(x),2);me(b);var y=p(b,2),k=v(y);u(y),u(x),u(t),z(m=>{K(i,1,`artisan-primary-btn flex items-center gap-2 !px-4 !py-1.5 text-xs ${ye().project.isPlaying?"bg-brand":"bg-slate-700"}`),H(a,ye().project.isPlaying?"â¹":"â¶"),H(o,ye().project.isPlaying?"Stop":"Play"),K(g,1,`flex items-center gap-2 rounded-xl px-3 py-1.5 transition-all ${ye().studio.showGhostThreads?"bg-brand/10 text-brand ring-1 ring-brand/20":"bg-black/5 opacity-40 shadow-sm hover:bg-white/60 hover:opacity-100"}`),H(k,`${m??""}%`)},[()=>Math.round(ye().studio.timelineZoom*100)]),_e(f,()=>ye().studio.fps,m=>ye(ye().studio.fps=m)),_e(b,()=>ye().studio.timelineZoom,m=>ye(ye().studio.timelineZoom=m)),C(c,t),Z()}pe(["click"]);class Pt{static getRulerMarks(e,t,i=1e4){const s=[];let a=500;t>2&&(a=100),t<.6&&(a=1e3);const n=Math.max(e+i,3e4/t);for(let o=0;o<=n;o+=a)s.push(o);return s}static formatTimeLabel(e){return e>=1e3?(e/1e3).toFixed(e%1e3===0?0:1)+"s":e+"ms"}static getFrameOffset(e,t,i,s){let a=0;for(let n=0;n<t;n++)a+=Math.max(s,e[n].duration*i);return a}static getTrackWidth(e,t,i){return e.reduce((s,a)=>s+Math.max(i,a.duration*t),0)}}var Tr=M('<div><div role="button" tabindex="0"><div></div> <div class="absolute top-1 left-1 flex h-4 min-w-4 items-center justify-center rounded-sm bg-black/40 px-1 backdrop-blur-sm"><span class="font-mono text-[9px] font-black text-white"> </span></div> <div class="absolute right-1 bottom-1 rounded bg-white/80 px-1.5 py-0.5 font-mono text-[9px] font-bold text-black/50 shadow-sm"> </div></div>  <div class="absolute top-0 right-0 bottom-0 z-30 w-2 cursor-col-resize rounded-r-md transition-colors hover:bg-brand/40 active:bg-brand"><div class="absolute top-1/2 left-1/2 h-6 w-0.5 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/10 group-hover:bg-white/60"></div></div></div>');function Ir(c,e){X(e,!0);let t=ae(e,"frame",7),i=Y(()=>.25*r.studio.timelineZoom);const s=50;let a=Y(()=>Math.max(s,t().duration*l(i))),n=T(!1),o=0,d=0;function h(P){P.stopPropagation(),P.preventDefault(),_(n,!0),o=P.clientX,d=t().duration,window.addEventListener("mousemove",f),window.addEventListener("mouseup",g),document.body.style.cursor="col-resize"}function f(P){if(!l(n))return;const E=P.clientX-o,w=Math.round(E/l(i)),L=Math.max(10,d+w);t().duration=Math.round(L/10)*10}function g(){_(n,!1),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",g),document.body.style.cursor=""}var x=Tr(),b=v(x);b.__click=()=>r.project.activeFrameIndex=e.index,b.__keydown=P=>P.key==="Enter"&&(r.project.activeFrameIndex=e.index);var y=v(b),k=p(y,2),m=v(k),A=v(m,!0);u(m),u(k);var I=p(k,2),$=v(I);u(I),u(b);var B=p(b,2);B.__mousedown=h,u(x),z(()=>{K(x,1,`relative h-full flex-shrink-0 transition-transform duration-200 select-none ${e.isDragged?"scale-95 opacity-40":""} ${e.isDropTarget?"translate-x-4":""}`),ee(x,`width: ${l(a)??""}px;`),K(b,1,`group relative h-full w-full cursor-pointer overflow-hidden rounded-md border border-black/10 transition-all ${e.isActive?"border-brand bg-white shadow-lg ring-2 ring-brand/20":"bg-white/60 hover:bg-white/90 hover:shadow-md"}`),K(y,1,`absolute inset-1 rounded-sm shadow-inner transition-colors ${e.isActive?"bg-brand/10":"bg-black/5"}`),H(A,e.index+1),H($,`${t().duration??""}ms`)}),C(c,x),Z()}pe(["click","keydown","mousedown"]);var Pr=M('<div class="absolute flex flex-col items-start"><div class="h-2 w-px bg-black/30"></div> <span class="-mt-0.5 ml-1 font-mono text-[9px] font-bold whitespace-nowrap text-black/50"> </span></div>'),Lr=M("<div></div>"),Mr=M('<div draggable="true" role="listitem" class="relative h-[55px]"><!> <!></div>'),Vr=M('<div class="relative flex flex-1 flex-col overflow-hidden rounded-lg border border-black/10 bg-[#e8e2d2] shadow-inner"><div class="relative h-5 w-full cursor-pointer overflow-hidden border-b border-black/5 bg-[#f5f2e9]"><div class="absolute top-0 bottom-0"></div></div> <div class="custom-scrollbar relative flex flex-1 items-start overflow-x-auto overflow-y-hidden svelte-n1ejs0" role="list" aria-label="Spindle Timeline"><div class="flex h-full items-center bg-black/5 py-2 pl-1"><!> <button class="group ml-2 flex h-[55px] w-10 shrink-0 flex-col items-center justify-center gap-1 rounded-lg border-2 border-dashed border-black/10 bg-white/20 text-black/30 transition-all hover:border-brand/40 hover:bg-white hover:text-brand" title="New Frame (Alt+N)"><span class="text-xl leading-none">ï¼</span></button> <div class="w-40 shrink-0"></div></div> <div class="pointer-events-none absolute top-0 bottom-0 z-20 w-px bg-brand shadow-[0_0_4px_rgba(211,54,130,0.5)] transition-all duration-100 ease-out"><div class="absolute -top-1 -left-1 h-2 w-2 rotate-45 rounded-sm border-2 border-brand bg-[#fdf6e3] shadow-sm"></div></div></div></div>');function Fr(c,e){X(e,!0);let t=T(null),i=T(null),s=T(void 0),a=T(void 0),n=T(0),o=Y(()=>.25*r.studio.timelineZoom);const d=50;function h(S){const O=S.target;_(n,O.scrollLeft,!0)}function f(S){_(t,S,!0)}function g(S,O){S.preventDefault(),_(i,O,!0)}function x(S,O){S.preventDefault(),l(t)!==null&&l(t)!==O&&D.folio.reorderFrame(l(t),O),_(t,null),_(i,null)}let b=Y(()=>Pt.getFrameOffset(r.project.frames,r.project.activeFrameIndex,l(o),d));Te(()=>{if(l(s)&&r.project.isPlaying){const S=l(s).clientWidth/2;l(b)>S&&(l(s).scrollLeft=l(b)-S)}});let y=Y(()=>r.project.frames.reduce((S,O)=>S+O.duration,0)),k=Y(()=>Pt.getRulerMarks(l(y),r.studio.timelineZoom)),m=Y(()=>l(k)[l(k).length-1]*l(o)+100);function A(S){if(!l(a))return;const O=l(a).getBoundingClientRect(),V=l(s)?.scrollLeft||0,j=S.clientX-O.left+V;let Q=0;for(let ie=0;ie<r.project.frames.length;ie++){const N=Math.max(d,r.project.frames[ie].duration*l(o));if(j>=Q&&j<Q+N){r.project.activeFrameIndex=ie;break}Q+=N}}function I(S){if(S.ctrlKey){S.preventDefault();const O=S.deltaY>0?-.1:.1;r.studio.timelineZoom=Math.max(.5,Math.min(4,r.studio.timelineZoom+O))}}var $=Vr(),B=v($);B.__click=A;var P=v(B);xe(P,21,()=>l(k),ke,(S,O)=>{var V=Pr(),j=p(v(V),2),Q=v(j,!0);u(j),u(V),z(ie=>{ee(V,`left: ${l(O)*l(o)}px;`),H(Q,ie)},[()=>Pt.formatTimeLabel(l(O))]),C(S,V)}),u(P),u(B),qe(B,S=>_(a,S),()=>l(a));var E=p(B,2),w=v(E),L=v(w);xe(L,19,()=>r.project.frames,S=>S.id,(S,O,V)=>{var j=Mr(),Q=v(j);{let te=Y(()=>l(V)===r.project.activeFrameIndex),oe=Y(()=>l(t)===l(V)),re=Y(()=>l(i)===l(V)&&l(t)!==l(V));Ir(Q,{get frame(){return l(O)},get index(){return l(V)},get isActive(){return l(te)},get isDragged(){return l(oe)},get isDropTarget(){return l(re)}})}var ie=p(Q,2);{var N=te=>{var oe=Lr();z(()=>K(oe,1,`absolute top-0 bottom-0 z-50 w-1 rounded-full bg-brand shadow-[0_0_10px_rgba(211,54,130,0.8)] ${l(V)<(l(t)||0)?"-left-1":"-right-1"}`)),C(te,oe)};q(ie,te=>{l(i)===l(V)&&l(t)!==l(V)&&te(N)})}u(j),ue("dragstart",j,()=>f(l(V))),ue("dragover",j,te=>g(te,l(V))),ue("drop",j,te=>x(te,l(V))),ue("dragend",j,()=>{_(t,null),_(i,null)}),C(S,j)});var R=p(L,2);R.__click=()=>D.folio.addFrame(),st(2),u(w);var G=p(w,2);u(E),qe(E,S=>_(s,S),()=>l(s)),u($),z(()=>{ee(P,`width: ${l(m)??""}px; transform: translateX(-${l(n)??""}px);`),ee(w,`width: ${l(m)??""}px;`),ee(G,`left: ${l(b)??""}px;`)}),ue("wheel",$,I),ue("scroll",E,h),C(c,$),Z()}pe(["click"]);var Br=M('<div class="artisan-panel flex h-36 w-full flex-col gap-1.5 overflow-hidden px-4 py-2 shadow-2xl transition-all hover:bg-white/40" role="region"><div class="flex items-center justify-between border-b border-black/5 pb-1"><div class="flex items-center gap-4"><div class="flex items-center gap-1.5"><span class="text-[10px] opacity-40" aria-hidden="true">â³</span> <span class="font-tiny5 text-[9px] tracking-[0.2em] text-brand uppercase"></span></div> <!></div> <div class="flex items-center gap-4"><div class="flex flex-col items-end gap-0"><span class="font-serif text-[7px] font-black tracking-widest text-studio-text/20 uppercase"></span> <span class="font-mono text-[8px] font-bold text-brand/60"> </span></div></div></div> <!></div>');function Dr(c,e){X(e,!1),be();var t=Br();F(t,"aria-label",__({key:"ledger.spindle_title"}));var i=v(t),s=v(i),a=v(s),n=p(v(a),2);n.textContent=__({key:"ledger.spindle_title"}),u(a);var o=p(a,2);Er(o,{}),u(s);var d=p(s,2),h=v(d),f=v(h);f.textContent=__({key:"ledger.kinetic_track"});var g=p(f,2),x=v(g,!0);u(g),u(h),u(d),u(i);var b=p(i,2);Fr(b,{}),u(t),z(y=>H(x,y),[()=>__({key:"ledger.thread_count",replace:{count:r.project.frames.length}})]),C(c,t),Z()}var jr=M('<footer class="hud-panel flex w-full flex-col border-t-2 border-grid-border bg-canvas-bg px-4 py-0.5"><!> <div class="flex h-8 w-full items-center justify-between"><div class="flex items-center gap-4"><!></div> <!></div></footer>');function $r(c){var e=jr(),t=v(e);Dr(t,{});var i=p(t,2),s=v(i),a=v(s);lr(a,{}),u(s);var n=p(s,2);Sr(n),u(i),u(e),C(c,e)}var Rr=M('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-studio-text/10"></div>'),Or=M('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-studio-text/10"></div>'),Nr=M('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-studio-text/30"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-studio-text/30"></div> <!> <!></div>');function Gr(c,e){X(e,!1),be();var t=Nr(),i=p(v(t),4);xe(i,0,()=>[-24,-16,-8,8,16,24],ke,(a,n)=>{const o=ht(()=>ze.getGuidePosition(n,r.linen.width));var d=Ve(),h=he(d);{var f=g=>{var x=Rr();z(()=>ee(x,`left: ${l(o)??""}%`)),C(g,x)};q(h,g=>{l(o)>0&&l(o)<100&&g(f)})}C(a,d)});var s=p(i,2);xe(s,0,()=>[-24,-16,-8,8,16,24],ke,(a,n)=>{const o=ht(()=>ze.getGuidePosition(n,r.linen.height));var d=Ve(),h=he(d);{var f=g=>{var x=Or();z(()=>ee(x,`top: ${l(o)??""}%`)),C(g,x)};q(h,g=>{l(o)>0&&l(o)<100&&g(f)})}C(a,d)}),u(t),C(c,t),Z()}var zr=tt('<line stroke-dasharray="0.2, 0.2" class="marching-ants-svg svelte-1onh8x1"></line>'),Hr=tt('<line stroke="var(--color-brand)" stroke-width="0.05" stroke-dasharray="0.1, 0.1"></line>'),Ur=tt('<circle r="0.2" fill="var(--color-brand)"></circle><!>',1),Kr=tt('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><defs><pattern id="ants" width="1" height="1" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="1" y2="0" stroke="var(--ants-color)" stroke-width="0.1" stroke-dasharray="0.2, 0.2"></line></pattern></defs><!><!></svg><svg class="pointer-events-none absolute inset-0 z-[39] h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><path fill="var(--color-brand)" fill-opacity="0.1"></path></svg>',1);function qr(c,e){X(e,!0);let t=Y(()=>r.selection.getBoundaryEdges(r.linen.width)),i=Y(()=>r.selection.vertices),s=Y(()=>ge.current.type==="LOOMING");var a=Ve(),n=he(a);{var o=d=>{var h=Kr(),f=he(h),g=p(v(f));xe(g,17,()=>l(t),ke,(m,A)=>{var I=zr();F(I,"stroke-width",.08),z(()=>{F(I,"x1",l(A).x1),F(I,"y1",l(A).y1),F(I,"x2",l(A).x2),F(I,"y2",l(A).y2),F(I,"stroke",l(s)?"var(--color-brand)":"rgba(211, 54, 130, 0.8)")}),C(m,I)});var x=p(g);{var b=m=>{var A=Ve(),I=he(A);xe(I,17,()=>l(i),ke,($,B,P)=>{const E=Y(()=>l(i)[P+1]||l(i)[0]);var w=Ur(),L=he(w),R=p(L);{var G=S=>{var O=Hr();z(()=>{F(O,"x1",l(B).x+.5),F(O,"y1",l(B).y+.5),F(O,"x2",l(E).x+.5),F(O,"y2",l(E).y+.5)}),C(S,O)};q(R,S=>{l(i).length>1&&P<l(i).length-(l(i).length>=3?0:1)&&S(G)})}z(()=>{F(L,"cx",l(B).x+.5),F(L,"cy",l(B).y+.5)}),C($,w)}),C(m,A)};q(x,m=>{l(i).length>0&&m(b)})}u(f);var y=p(f),k=v(y);u(y),z(m=>{F(f,"viewBox",`0 0 ${r.linen.width??""} ${r.linen.height??""}`),F(y,"viewBox",`0 0 ${r.linen.width??""} ${r.linen.height??""}`),F(k,"d",m)},[()=>r.selection.getPoints(r.linen.width).map(m=>`M${m.x},${m.y}h1v1h-1z`).join(" ")]),C(d,h)};q(n,d=>{r.selection.isActive&&d(o)})}C(c,a),Z()}var Yr=M('<canvas class="pointer-events-none absolute inset-0 z-0 h-full w-full"></canvas>');function Qr(c,e){X(e,!0);let t=ae(e,"opacity",3,.2),i=T(null);Te(()=>{const a=l(i)?.getContext("2d");if(!(!a||!l(i))){a.imageSmoothingEnabled=!1,a.clearRect(0,0,e.width,e.height);for(let n=0;n<e.stitches.length;n++){const o=e.stitches[n];if(o){a.fillStyle=o;const d=n%e.width,h=Math.floor(n/e.width);a.fillRect(d,h,1,1)}}}});var s=Yr();qe(s,a=>_(i,a),()=>l(i)),z(()=>{F(s,"width",e.width),F(s,"height",e.height),ee(s,`opacity: ${t()??""}; image-rendering: pixelated;`)}),C(c,s),Z()}var Xr=M('<div class="absolute flex items-center justify-center"><div><span class="font-mono text-[12px] font-medium whitespace-nowrap text-black/50"> </span></div></div>'),Zr=M('<div class="pointer-events-none relative h-full w-full overflow-hidden bg-[#fdf6e3] backdrop-blur-sm" role="presentation"><div><div></div> <div></div> <!> <div><div class="absolute top-1/2 left-1/2 rounded-sm border border-white/20 bg-brand/90 px-1.5 py-0.5 shadow-lg backdrop-blur-sm"><span class="font-mono text-[12px] leading-none font-bold text-white"> </span></div></div></div></div>');function ni(c,e){X(e,!0);let t=ae(e,"orientation",3,"horizontal"),i=Y(()=>r.linen.width),s=Y(()=>r.linen.height),a=Y(()=>t()==="horizontal"?l(i):l(s)),n=Y(()=>t()==="horizontal"?r.needle.pos.x:r.needle.pos.y),o=Y(()=>{const P=r.studio.zoomLevel;return P<=.5?16:P<=1.5?8:P<=4?4:2}),d=Y(()=>r.linen.getFitDimension(t())),h=Y(()=>{const P=[];for(let E=0;E<l(a);E++){const w=ze.toCartesianLabel(E,l(a),t()==="vertical");(w%l(o)===0||E===0||E===l(a)-1)&&P.push({pos:E,label:w})}return P}),f=Y(()=>{const P=r.studio.zoomLevel,E=(l(n)+.5)/l(a)*100;return r.studio.zoomLevel<=1?t()==="horizontal"?`translate(-50%, 0) scale(${P})`:`translate(0, -50%) scale(${P})`:t()==="horizontal"?`translate(-${E}%, 0) scale(${P})`:`translate(0, -${E}%) scale(${P})`}),g=Y(()=>1/r.studio.zoomLevel);var x=Zr(),b=v(x),y=v(b),k=p(y,2),m=p(k,2);xe(m,17,()=>l(h),P=>P.pos,(P,E)=>{var w=Xr(),L=v(w),R=v(L),G=v(R,!0);u(R),u(L),u(w),z(()=>{ee(w,`
					${t()==="horizontal"?"left":"top"}: ${l(E).pos/l(a)*100}%;
					${t()==="horizontal"?"width":"height"}: ${100/l(a)}%;
					${t()==="horizontal"?"height":"width"}: 100%;
				`),ee(L,`transform: scale(${l(g)??""}) ${t()==="vertical"?"rotate(-90deg)":""};`),H(G,l(E).label)}),C(P,w)});var A=p(m,2),I=v(A),$=v(I),B=v($,!0);u($),u(I),u(A),u(b),u(x),z(P=>{F(x,"aria-label",`${t()??""} ruler`),K(b,1,`absolute flex ${t()==="vertical"?"flex-col":""}`),ee(b,`
			left: ${t()==="horizontal"?"50%":"0"};
			top: ${t()==="vertical"?"50%":"0"};
			transform: ${l(f)??""}; 
			transform-origin: ${t()==="horizontal"?"center top":"left center"};
			${t()==="horizontal"?"width":"height"}: ${l(d)??""};
			${t()==="vertical"?"width":"height"}: 100%;
		`),K(y,1,`absolute opacity-10 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-1/2":"top-0 right-0 bottom-0 w-1/2"}`),ee(y,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					rgba(0,0,0,1) 1px, transparent 1px);
				background-size: ${t()==="horizontal"?`calc(100% / ${l(a)}) 100%`:`100% calc(100% / ${l(a)})`};
			`),K(k,1,`absolute opacity-20 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-3/4":"top-0 right-0 bottom-0 w-3/4"}`),ee(k,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					rgba(0,0,0,1) 1.5px, transparent 1.5px);
				background-size: ${t()==="horizontal"?`calc(100% / ${l(a)} * ${l(o)}) 100%`:`100% calc(100% / ${l(a)} * ${l(o)})`};
			`),K(A,1,`absolute z-20 transition-all duration-75 ease-out ${t()==="horizontal"?"top-0 bottom-0 bg-brand shadow-[0_0_8px_rgba(211,54,130,0.5)]":"right-0 left-0 bg-brand shadow-[0_0_8px_rgba(211,54,130,0.5)]"}`),ee(A,`
				${t()==="horizontal"?"left":"top"}: ${(l(n)+.5)/l(a)*100}%;
				${t()==="horizontal"?"width":"height"}: calc(1px * ${l(g)??""});
			`),ee(I,`transform: translate(-50%, -50%) scale(${l(g)??""}) ${t()==="vertical"?"rotate(-90deg)":""};`),H(B,P)},[()=>ze.toCartesianLabel(l(n),l(a),t()==="vertical")]),C(c,x),Z()}var Wr=M('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),Jr=M('<div class="cursor-container absolute inset-0 svelte-4tpgo2"><div class="bloom-wrapper svelte-4tpgo2"><div class="petal p-top svelte-4tpgo2"></div> <div class="petal p-bottom svelte-4tpgo2"></div> <div class="petal p-left svelte-4tpgo2"></div> <div class="petal p-right svelte-4tpgo2"></div> <div class="center-dot svelte-4tpgo2"></div></div> <!></div>');function en(c,e){X(e,!1),be();var t=Ve(),i=he(t);{var s=a=>{var n=Jr(),o=p(v(n),2);{var d=h=>{var f=Wr(),g=he(f),x=p(g,2),b=v(x),y=v(b);u(b),st(2),u(x),z(()=>{ee(g,`background-color: ${r.activeDye??""};`),ee(y,`background-color: ${r.activeDye??""};`)}),de(3,g,()=>Ee,()=>({duration:400})),de(1,x,()=>yi,()=>({y:-10,duration:400})),de(2,x,()=>Ee,()=>({duration:400})),C(h,f)};q(o,h=>{r.isPicking&&h(d)})}u(n),de(3,n,()=>Ee,()=>({duration:800})),C(a,n)};q(i,a=>{r.isNeedleVisible&&a(s)})}C(c,t),Z()}var tn=tt('<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline>'),sn=M('<div class="loom-viewport relative grid h-full w-full grid-cols-[20px_1fr] grid-rows-[20px_1fr] overflow-hidden svelte-jw6f5"><div class="z-[110] border-r border-b border-black/10 bg-[#fdf6e3]/90 backdrop-blur-md" aria-hidden="true"></div> <div class="relative z-[100] border-b border-black/10"><!></div> <div class="relative z-[100] border-r border-black/10"><!></div> <div class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/5"><div class="loom-container absolute top-1/2 left-1/2 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] svelte-jw6f5"><div class="stitch-grid-pattern artisan-checker-small relative h-full w-full shadow-[0_10px_40px_rgba(0,0,0,0.06)] ring-1 ring-black/5" role="grid" tabindex="0"><!> <!> <canvas class="pointer-events-none absolute inset-0 h-full w-full" style="image-rendering: pixelated;"></canvas> <div class="pointer-events-none absolute inset-0 z-30 overflow-hidden"><div class="absolute transition-all duration-75 ease-out"><!></div></div> <svg class="pointer-events-none absolute inset-0 z-[20] h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg> <!></div></div></div></div>');function an(c,e){X(e,!0);let t=T(null),i=T(null),s=Y(()=>r.linen.width),a=Y(()=>r.linen.height),n=Y(()=>{if(!r.studio.showGhostThreads)return[];const V=r.project.activeFrameIndex,j=[];return V>0&&j.push({stitches:r.project.frames[V-1].compositeStitches,opacity:.3}),V>1&&j.push({stitches:r.project.frames[V-2].compositeStitches,opacity:.1}),j}),o=Y(()=>$e.isSnappedState),d=Y(()=>r.linen.strokePoints.map(V=>`${V.x},${V.y}`).join(" "));function h(V){if(V.ctrlKey){V.preventDefault();const j=V.deltaY>0?-.1:.1;r.studio.setZoom(j)}}Te(()=>{const V=l(i)?.getContext("2d",{alpha:!0}),j=r.linen.compositeStitches;if(!(!V||!l(i))){V.imageSmoothingEnabled=!1,V.clearRect(0,0,l(s),l(a));for(let Q=0;Q<j.length;Q++){const ie=j[Q];if(ie){const N=Q%l(s),te=Math.floor(Q/l(s));V.fillStyle=ie,V.fillRect(N,te,1,1)}}}});var f=sn();ue("pointermove",Wt,V=>l(t)&&$e.handleMove(V,l(t))),ue("pointerup",Wt,()=>$e.handleEnd());var g=p(v(f),2),x=v(g);ni(x,{orientation:"horizontal"}),u(g);var b=p(g,2),y=v(b);ni(y,{orientation:"vertical"}),u(b);var k=p(b,2),m=v(k),A=v(m);A.__contextmenu=V=>V.preventDefault(),A.__pointerdown=V=>l(t)&&$e.handleStart(V,l(t));var I=v(A);Gr(I,{});var $=p(I,2);{var B=V=>{var j=Ve(),Q=he(j);xe(Q,17,()=>l(n),ke,(ie,N)=>{Qr(ie,{get stitches(){return l(N).stitches},get width(){return l(s)},get height(){return l(a)},get opacity(){return l(N).opacity}})}),C(V,j)};q($,V=>{r.studio.showGhostThreads&&V(B)})}var P=p($,2);qe(P,V=>_(i,V),()=>l(i));var E=p(P,2),w=v(E),L=v(w);en(L,{}),u(w),u(E);var R=p(E,2),G=v(R);{var S=V=>{var j=tn();z(()=>{F(j,"points",l(d)),F(j,"stroke",r.paletteState.activeDye),F(j,"stroke-width",l(o)?"0.08":"0.03"),F(j,"stroke-dasharray",l(o)?"none":"0.1 0.1"),K(j,0,`${l(o)?"drop-shadow-md":"marching-ants"} transition-all duration-300`,"svelte-jw6f5"),ee(j,`opacity: ${l(o)?"1":"0.4"}`)}),C(V,j)};q(G,V=>{r.linen.strokePoints.length>1&&V(S)})}u(R);var O=p(R,2);qr(O,{}),u(A),qe(A,V=>_(t,V),()=>l(t)),u(m),u(k),u(f),z(V=>{ee(m,`
				transform: ${r.cameraTransform??""};
				aspect-ratio: ${l(s)??""} / ${l(a)??""};
				width: ${V??""};
			`),ee(A,`
					--grid-cols: ${l(s)??""}; 
					--grid-rows: ${l(a)??""}; 
					background-color: ${r.studio.canvasBgColor??""};
					touch-action: none;
				`),F(P,"width",l(s)),F(P,"height",l(a)),ee(w,`
							left: ${r.needle.pos.x/l(s)*100}%; 
							top: ${r.needle.pos.y/l(a)*100}%; 
							width: ${100/l(s)}%; 
							height: ${100/l(a)}%;
						`),F(R,"viewBox",`0 0 ${l(s)??""} ${l(a)??""}`)},[()=>r.linen.getFitDimension("horizontal")]),ue("wheel",f,h),C(c,f),Z()}pe(["contextmenu","pointerdown"]);class rn{#e=T(!0);get isEnabled(){return l(this.#e)}set isEnabled(e){_(this.#e,e,!0)}#t=T(!1);get screenShake(){return l(this.#t)}set screenShake(e){_(this.#t,e,!0)}#i=T(null);get flashColor(){return l(this.#i)}set flashColor(e){_(this.#i,e,!0)}emit(e){this.isEnabled&&(this.playAudio(e),this.triggerVisual(e),typeof navigator.vibrate=="function"&&this.triggerHaptic(e))}playAudio(e){switch(e){case"STITCH":U.playStitch();break;case"UNSTITCH":U.playUnstitch();break;case"MOVE":U.playMove();break;case"STARTUP":U.playStartup();break;case"READY":U.playReady();break}}triggerVisual(e){e==="CLEAR_LINEN"&&(this.screenShake=!0,setTimeout(()=>this.screenShake=!1,200)),e==="READY"&&(this.flashColor="rgba(211, 54, 130, 0.1)",setTimeout(()=>this.flashColor=null,500))}triggerHaptic(e){e==="STITCH"&&navigator.vibrate(5),e==="UNSTITCH"&&navigator.vibrate(10)}}const oi=new rn;function Ai(c){return--c*c*c*c*c+1}const nn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var on=M(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-canvas-bg" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');" role="dialog" aria-modal="true"><div class="absolute h-[500px] w-[500px] animate-pulse rounded-full bg-brand/5 blur-[120px]" aria-hidden="true"></div> <div class="relative flex flex-col items-center gap-2"><div class="mb-8 flex animate-bounce items-center justify-center"><img alt="Rupa Artisan Icon" class="h-32 w-auto drop-shadow-2xl transition-transform duration-[3s] ease-in-out"/></div> <div><!></div></div> <div class="absolute bottom-24 flex flex-col items-center gap-8"><div class="flex flex-col items-center gap-4"><div class="h-1.5 w-64 overflow-hidden rounded-full bg-studio-text/5 ring-1 ring-studio-text/10" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div></div></div> <div class="flex flex-col items-center gap-1 text-center"><span class="h-4 font-serif text-[12px] text-studio-text/60 italic"> </span> <span class="font-mono text-[9px] font-bold tracking-widest text-studio-text/20 uppercase"> </span></div></div></div></div>`);function ln(c,e){X(e,!0);let t=T(!0),i=T(0),s=T(0),a=T(!1);const n=5;function o(){oi.emit("READY"),_(t,!1),setTimeout(()=>{r.isAppReady=!0,r.showArtisanCodex=!0},800)}it(()=>{oi.emit("STARTUP");const g=setInterval(()=>{if(l(i)<100){const x=Math.random()*15;_(i,Math.min(100,l(i)+x),!0),_(s,Math.min(n-1,Math.floor(l(i)/100*n)),!0)}else clearInterval(g),setTimeout(()=>{_(a,!0),o()},600)},400);return()=>{clearInterval(g)}});var d=Ve(),h=he(d);{var f=g=>{var x=on();F(x,"aria-label",__({key:"codex.title"}));var b=p(v(x),2),y=v(b),k=v(y);ee(k,`transform: scale(${1+Math.sin(Date.now()/1e3)*.05});`),u(y);var m=p(y,2),A=v(m);_i(A,{size:"lg"}),u(m),u(b);var I=p(b,2),$=v(I),B=v($),P=v(B);u(B);var E=p(B,2),w=v(E),L=v(w,!0);u(w);var R=p(w,2),G=v(R,!0);u(R),u(E),u($),u(I),u(x),z((S,O)=>{F(x,"aria-busy",!l(a)),F(k,"src",nn),F(B,"aria-valuenow",l(i)),K(P,1,`h-full bg-brand/60 transition-all duration-500 ease-out ${l(a)?"opacity-0":""}`),ee(P,`width: ${l(i)??""}%`),H(L,S),H(G,O)},[()=>l(a)?__({key:"common:splash.welcome"}):__({key:`common:splash.phases.${l(s)}`}),()=>__({key:"common:splash.version",replace:{version:r.version}})]),de(1,y,()=>gt,()=>({duration:1500,start:.9,easing:Ai})),de(1,m,()=>yi,()=>({y:20,duration:1e3,delay:400})),de(2,x,()=>Ee,()=>({duration:1e3})),C(g,x)};q(h,g=>{l(t)&&g(f)})}C(c,d),Z()}var cn=M('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><span> </span> <span> </span></div> <input type="range"/></div>');function ut(c,e){X(e,!0);let t=ae(e,"value",15),i=ae(e,"min",3,0),s=ae(e,"step",3,1),a=ae(e,"unit",3,""),n=ae(e,"isHue",3,!1);var o=cn(),d=v(o),h=v(d),f=v(h,!0);u(h);var g=p(h,2),x=v(g);u(g),u(d);var b=p(d,2);me(b);let y;u(o),z(k=>{H(f,e.label),H(x,`${k??""}${a()??""}`),F(b,"min",i()),F(b,"max",e.max),F(b,"step",s()),y=K(b,1,"custom-slider svelte-7qe4gg",null,y,{"hue-slider":n()})},[()=>s()<1?t().toFixed(2):Math.round(t())]),_e(b,t),C(c,o),Z()}var dn=M('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="presentation"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-canvas-bg p-10 shadow-2xl" role="dialog" aria-labelledby="dye-basin-title" aria-modal="true"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl" aria-hidden="true">â²</span> <div class="flex flex-col"><h2 id="dye-basin-title" class="font-tiny5 text-3xl leading-none text-brand"></h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/40 uppercase"></span></div></div> <div class="artisan-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner" aria-label="Color Preview"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><label for="hex-input" class="font-mono text-xs font-bold text-studio-text/40"></label> <input id="hex-input" type="text" class="w-full bg-transparent font-mono text-lg font-bold text-studio-text uppercase focus:outline-none"/></div> <div class="flex gap-3"><button class="artisan-secondary-btn flex h-14 w-14 items-center justify-center p-0 text-xl"><span aria-hidden="true">ð</span></button> <button class="artisan-primary-btn flex-1 py-4"></button></div></div></div></div>');function Ot(c,e){X(e,!0);let t=ae(e,"value",15),i=T(0),s=T(0),a=T(0),n=T(1);Te(()=>{const S=ft.unravel(t());Ge(()=>{_(i,S.h,!0),_(s,S.s,!0),_(a,S.l,!0),_(n,S.a,!0)})}),Te(()=>{const S=ft.spin({h:l(i),s:l(s),l:l(a),a:l(n)});Ge(()=>{t(S)})});var o=dn();o.__mousedown=S=>S.target===S.currentTarget&&e.onClose();var d=v(o),h=v(d),f=v(h),g=p(v(f),2),x=v(g);x.textContent=__({key:"dye_basin.title"});var b=p(x,2);b.textContent=__({key:"dye_basin.subtitle"}),u(g),u(f);var y=p(f,2);u(h);var k=p(h,2),m=v(k);ut(m,{label:__({key:"dye_basin.sliders.hue"}),max:360,unit:"Â°",isHue:!0,get value(){return l(i)},set value(S){_(i,S,!0)}});var A=p(m,2);ut(A,{label:__({key:"dye_basin.sliders.saturation"}),max:100,unit:"%",get value(){return l(s)},set value(S){_(s,S,!0)}});var I=p(A,2);ut(I,{label:__({key:"dye_basin.sliders.lightness"}),max:100,unit:"%",get value(){return l(a)},set value(S){_(a,S,!0)}});var $=p(I,2);ut($,{label:__({key:"dye_basin.sliders.alpha"}),min:0,max:1,step:.01,unit:"",get value(){return l(n)},set value(S){_(n,S,!0)}}),u(k);var B=p(k,2),P=v(B),E=v(P);E.textContent=__({key:"dye_basin.hex_label"});var w=p(E,2);me(w),u(P);var L=p(P,2),R=v(L);R.__click=()=>{D.pickDye(),e.onClose()},F(R,"title",__({key:"dye_basin.eye_drop"})),F(R,"aria-label",__({key:"dye_basin.eye_drop"}));var G=p(R,2);G.__click=function(...S){e.onClose?.apply(this,S)},G.textContent=__({key:"dye_basin.seal"}),u(L),u(B),u(d),u(o),z(()=>ee(y,`background-color: ${t()??""};`)),_e(w,t),de(1,d,()=>gt,()=>({duration:200,start:.95})),de(2,d,()=>gt,()=>({duration:150,start:1,opacity:0})),de(3,o,()=>Ee,()=>({duration:150})),C(c,o),Z()}pe(["mousedown","click"]);var un=M("<span> </span>"),hn=M('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function vn(c,e){X(e,!0);var t=hn();t.__click=()=>{e.action.action(),e.onSelect()};var i=v(t),s=v(i,!0);u(i);var a=p(i,2);{var n=o=>{var d=un(),h=v(d,!0);u(d),z(()=>{K(d,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),H(h,e.action.shortcut)}),C(o,d)};q(a,o=>{e.action.shortcut&&o(n)})}u(t),z(()=>{K(t,1,`artisan-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),H(s,e.action.label)}),ue("mouseenter",t,function(...o){e.onSelect?.apply(this,o)}),C(c,t),Z()}pe(["click"]);var pn=M('<div class="p-8 text-center font-serif text-sm text-studio-text/40 italic"> </div>'),fn=M('<div class="flex flex-col gap-1"></div>'),gn=M('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="presentation"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/95 shadow-2xl" role="dialog" aria-labelledby="catalog-title" aria-modal="true"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40" aria-hidden="true">ð</span> <h2 id="catalog-title" class="sr-only"></h2> <input id="catalog-search" type="text" class="w-full bg-transparent font-serif text-xl text-studio-text focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-1fnfmu0" role="list"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"></span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div></div>');function xn(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.studio.showPatternCatalog=!1),i=T(""),s=T(0);const n=Ce.getActions().map(E=>({...E,id:E.intent.toLowerCase().replace(/_/g,"-"),action:()=>{pi(async()=>{const{loom:w}=await Promise.resolve().then(()=>wa);return{loom:w}},void 0,import.meta.url).then(({loom:w})=>{w.handleIntent(E.intent)})}}));let o=Y(()=>n.filter(E=>E.label.toLowerCase().includes(l(i).toLowerCase())));Te(()=>{l(i),_(s,0)}),Te(()=>{l(s),l(o);const E=document.querySelector(".artisan-action-btn.active");E&&E.scrollIntoView({block:"nearest"})});function d(E){E.key==="ArrowDown"?(E.preventDefault(),_(s,(l(s)+1)%l(o).length)):E.key==="ArrowUp"?(E.preventDefault(),_(s,(l(s)-1+l(o).length)%l(o).length)):E.key==="Enter"?(E.preventDefault(),l(o)[l(s)]&&(l(o)[l(s)].action(),t()())):E.key==="Escape"&&t()()}it(()=>document.getElementById("catalog-search")?.focus());var h=gn();h.__mousedown=E=>E.target===E.currentTarget&&t()(),h.__keydown=d;var f=v(h),g=v(f),x=p(v(g),2);x.textContent=__({key:"hud.basin.catalog_title"});var b=p(x,2);me(b),F(b,"placeholder",__({key:"hud.basin.catalog_search"})),u(g);var y=p(g,2),k=v(y);{var m=E=>{var w=pn(),L=v(w,!0);u(w),z(R=>H(L,R),[()=>__({key:"hud.basin.catalog_no_results",replace:{query:l(i)}})]),C(E,w)},A=E=>{var w=fn();xe(w,21,()=>l(o),ke,(L,R,G)=>{{let S=Y(()=>l(s)===G);vn(L,{get action(){return l(R)},get isSelected(){return l(S)},onSelect:()=>_(s,G,!0)})}}),u(w),C(E,w)};q(k,E=>{l(o).length===0?E(m):E(A,!1)})}u(y);var I=p(y,2),$=v(I);$.textContent=__({key:"hud.basin.catalog_footer"});var B=p($,2),P=v(B,!0);u(B),u(I),u(f),u(h),z(E=>H(P,E),[()=>__({key:"hud.basin.catalog_count",replace:{count:l(o).length}})]),_e(b,()=>l(i),E=>_(i,E)),de(3,f,()=>gt,()=>({duration:150,start:.98})),C(c,h),Z()}pe(["mousedown","keydown"]);var bn=M('<span class="text-3xl"> </span>'),mn=M('<span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30"> </span>'),_n=M('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/25 backdrop-blur-md"><div class="flex flex-col gap-8 overflow-hidden rounded-xl border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between border-b border-studio-text/5 pb-6"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand"> </h2> <!></div></div> <button class="rounded-xl border border-black/5 bg-white/50 px-4 py-2 text-[10px] font-bold tracking-widest uppercase opacity-40 transition-all hover:opacity-100">Close</button></div> <div><!></div></div></div>');function He(c,e){X(e,!0);let t=ae(e,"title",3,""),i=ae(e,"subtitle",3,""),s=ae(e,"icon",3,""),a=ae(e,"width",3,"500px"),n=ae(e,"maxHeight",3,"85vh"),o=ae(e,"scrollable",3,!0);Te(()=>(r.pushEscapeAction(e.onClose),()=>r.popEscapeAction(e.onClose)));function d(w,{duration:L=600}){return{duration:L,css:R=>{const G=Ai(R);return`
					opacity: ${R};
					transform: scaleX(${.9+G*.1}) scaleY(${.4+G*.6});
					clip-path: inset(0 ${(1-G)*50}% 0 ${(1-G)*50}%);
				`}}}var h=_n();h.__mousedown=w=>{w.stopPropagation(),w.target===w.currentTarget&&e.onClose()};var f=v(h);f.__mousedown=w=>w.stopPropagation();var g=v(f),x=v(g),b=v(x);{var y=w=>{var L=bn(),R=v(L,!0);u(L),z(()=>H(R,s())),C(w,L)};q(b,w=>{s()&&w(y)})}var k=p(b,2),m=v(k),A=v(m,!0);u(m);var I=p(m,2);{var $=w=>{var L=mn(),R=v(L,!0);u(L),z(()=>H(R,i())),C(w,L)};q(I,w=>{i()&&w($)})}u(k),u(x);var B=p(x,2);B.__click=function(...w){e.onClose?.apply(this,w)},u(g);var P=p(g,2),E=v(P);ps(E,()=>e.children),u(P),u(f),u(h),z(()=>{ee(f,`width: ${a()??""}; max-height: ${n()??""};`),H(A,t()),K(P,1,`custom-scrollbar flex-1 ${o()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),de(1,f,()=>d,()=>({duration:500})),de(2,f,()=>Ee,()=>({duration:150})),de(3,h,()=>Ee,()=>({duration:200})),C(c,h),Z()}pe(["mousedown","click"]);var yn=M('<div class="flex flex-col items-center gap-3"><div class="artisan-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function An(c,e){X(e,!0);let t=T(null);Te(()=>{if(!l(t))return;const g=l(t).getContext("2d");if(!g)return;const x=r.linen.width,b=r.linen.height,y=r.linen.compositeStitches,k=400,m=Math.min(k/x,k/b);l(t).width=x*m,l(t).height=b*m,g.imageSmoothingEnabled=!1,e.bgColor==="transparent"?g.clearRect(0,0,l(t).width,l(t).height):(g.fillStyle=e.bgColor,g.fillRect(0,0,l(t).width,l(t).height)),y.forEach((A,I)=>{if(A===null)return;const $=I%x,B=Math.floor(I/x);g.fillStyle=A,g.fillRect(Math.floor($*m),Math.floor(B*m),Math.ceil(m),Math.ceil(m))})});var i=yn(),s=v(i),a=v(s);qe(a,g=>_(t,g),()=>l(t)),u(s);var n=p(s,2),o=v(n),d=v(o);u(o);var h=p(o,2),f=v(h);u(h),u(n),u(i),z((g,x)=>{H(d,`${e.format??""} Artifact`),H(f,`${g??""} Ã ${x??""} pixels`)},[()=>Math.round(r.linen.width*e.scale),()=>Math.round(r.linen.height*e.scale)]),C(c,i),Z()}var wn=M('<span class="font-serif text-[9px] font-bold text-brand italic opacity-60"></span>'),kn=M('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="fps-input" type="number" min="1" max="60" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div>',1),Sn=M('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span aria-hidden="true">ð¨</span> </button>'),Cn=M('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5" role="img" aria-label="Artifact Preview"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-8 overflow-y-auto pr-4" role="group" aria-label="Export Settings"><div class="flex flex-col gap-3"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"></span> <div class="grid grid-cols-2 gap-3" role="radiogroup" aria-label="Static Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">ð¼ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð¸ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð·</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button></div></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"></span> <!></div> <div role="radiogroup" aria-label="Kinetic Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">ð¬</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð½ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button></div></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="scale-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="scale-input" type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <!> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></span> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <div class="flex flex-wrap items-center gap-3" role="radiogroup" aria-label="Background Type"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" title="Transparent" role="radio"></button> <button title="Studio Cream" role="radio"></button> <button title="Deep Black" role="radio"></button> <div class="flex items-center gap-2"><button title="Custom Backdrop" role="radio"></button></div></div> <!></div></div> <button class="artisan-primary-btn w-full py-5 text-xl"></button></div></div>'),En=M("<!> <!>",1);function Tn(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.showArtifactCrate=!1),i=T("png"),s=T(!1),a=T(ve(r.studio.canvasBgColor));it(()=>{r.studio.canvasBgColor!=="#eee8d5"&&(r.studio.exportBgColor=r.studio.canvasBgColor,_(a,r.studio.canvasBgColor,!0))}),Te(()=>{r.studio.exportBgColor!=="transparent"&&r.studio.exportBgColor!=="#eee8d5"&&r.studio.exportBgColor!=="#000000"&&(r.studio.exportBgColor=l(a))}),Te(()=>{const f=["webm","gif","mp4"].includes(l(i))||l(i)==="svg"&&r.project.frames.length>1;r.project.frames.length<=1&&f&&_(i,"png")});var n=En(),o=he(n);{var d=f=>{Ot(f,{onClose:()=>_(s,!1),get value(){return l(a)},set value(g){_(a,g,!0)}})};q(o,f=>{l(s)&&f(d)})}var h=p(o,2);He(h,{title:__({key:"artifact.title"}),subtitle:__({key:"artifact.subtitle"}),icon:"ð§º",get onClose(){return t()},width:"1000px",scrollable:!1,children:(f,g)=>{var x=Cn(),b=v(x),y=v(b);An(y,{get format(){return l(i)},get scale(){return r.studio.exportScale},get bgColor(){return r.studio.exportBgColor}}),u(b);var k=p(b,2),m=v(k),A=v(m);A.textContent=__({key:"artifact.static_title"});var I=p(A,2),$=v(I);$.__click=()=>_(i,"png");var B=p(v($),2),P=v(B);P.textContent=__({key:"artifact.formats.png"}),u(B),u($);var E=p($,2);E.__click=()=>_(i,"webp");var w=p(v(E),2),L=v(w);L.textContent=__({key:"artifact.formats.webp"}),u(w),u(E);var R=p(E,2);R.__click=()=>_(i,"jpg");var G=p(v(R),2),S=v(G);S.textContent=__({key:"artifact.formats.jpg"}),u(G),u(R);var O=p(R,2);O.__click=()=>_(i,"svg");var V=p(v(O),2),j=v(V);j.textContent=__({key:"artifact.formats.svg_static"}),u(V),u(O),u(I),u(m);var Q=p(m,2),ie=v(Q),N=v(ie);N.textContent=__({key:"artifact.kinetic_title"});var te=p(N,2);{var oe=we=>{var Me=wn();Me.textContent=__({key:"artifact.requires_frames"}),C(we,Me)};q(te,we=>{r.project.frames.length<=1&&we(oe)})}u(ie);var re=p(ie,2),fe=v(re);fe.__click=()=>_(i,"webm");var Ie=p(v(fe),2),se=v(Ie);se.textContent=__({key:"artifact.formats.webm"}),u(Ie),u(fe);var le=p(fe,2);le.__click=()=>_(i,"gif");var Le=p(v(le),2),Fe=v(Le);Fe.textContent=__({key:"artifact.formats.gif"}),u(Le),u(le);var ce=p(le,2);ce.__click=()=>_(i,"mp4");var ne=p(v(ce),2),Be=v(ne);Be.textContent=__({key:"artifact.formats.mp4"}),u(ne),u(ce);var Pe=p(ce,2);Pe.__click=()=>_(i,"svg");var Ue=p(v(Pe),2),at=v(Ue);at.textContent=__({key:"artifact.formats.svg_kinetic"}),u(Ue),u(Pe),u(re),u(Q);var Ye=p(Q,2),bt=v(Ye),mt=v(bt),Nt=v(mt);Nt.textContent=__({key:"artifact.scale_label"});var wi=p(Nt,2);wi.textContent=__({key:"artifact.scale_desc"}),u(mt);var Gt=p(mt,2);me(Gt),u(bt);var zt=p(bt,2);{var ki=we=>{var Me=kn(),ct=p(he(Me),2),At=v(ct),Yt=v(At);Yt.textContent=__({key:"artifact.fps_label"});var Ti=p(Yt,2);Ti.textContent=__({key:"artifact.fps_desc"}),u(At);var Qt=p(At,2);me(Qt),u(ct),_e(Qt,()=>r.studio.fps,Ii=>r.studio.fps=Ii),C(we,Me)};q(zt,we=>{(l(i)==="webm"||l(i)==="gif"||l(i)==="mp4"||l(i)==="svg"&&r.project.frames.length>1)&&we(ki)})}var Ht=p(zt,4),_t=v(Ht),Ut=v(_t);Ut.textContent=__({key:"artifact.bg_label"});var Si=p(Ut,2);Si.textContent=__({key:"artifact.bg_desc"}),u(_t);var yt=p(_t,2),rt=v(yt);rt.__click=()=>r.studio.exportBgColor="transparent";var nt=p(rt,2);nt.__click=()=>r.studio.exportBgColor="#eee8d5";var ot=p(nt,2);ot.__click=()=>r.studio.exportBgColor="#000000";var Kt=p(ot,2),lt=v(Kt);lt.__click=()=>{_(a,l(a),!0),r.studio.exportBgColor=l(a),_(s,!0)},u(Kt),u(yt);var Ci=p(yt,2);{var Ei=we=>{var Me=Sn();Me.__click=()=>{_(a,r.studio.canvasBgColor,!0),r.studio.exportBgColor=l(a)};var ct=p(v(Me));ct.nodeValue=` ${__({key:"artifact.match_linen"})??""}`,u(Me),C(we,Me)};q(Ci,we=>{r.studio.canvasBgColor!=="#eee8d5"&&we(Ei)})}u(Ht),u(Ye);var qt=p(Ye,2);qt.__click=()=>e.onExport(l(i),r.studio.exportScale,r.studio.exportBgColor),qt.textContent=__({key:"artifact.export_action"}),u(k),u(x),z(()=>{K($,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F($,"aria-checked",l(i)==="png"),K(E,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="webp"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F(E,"aria-checked",l(i)==="webp"),K(R,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="jpg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F(R,"aria-checked",l(i)==="jpg"),K(O,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="svg"&&r.project.frames.length<=1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F(O,"aria-checked",l(i)==="svg"&&r.project.frames.length<=1),K(re,1,`grid grid-cols-2 gap-3 ${r.project.frames.length<=1?"opacity-40":""}`),K(fe,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="webm"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),fe.disabled=r.project.frames.length<=1,F(fe,"aria-checked",l(i)==="webm"),K(le,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="gif"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),le.disabled=r.project.frames.length<=1,F(le,"aria-checked",l(i)==="gif"),K(ce,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="mp4"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),ce.disabled=r.project.frames.length<=1,F(ce,"aria-checked",l(i)==="mp4"),K(Pe,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(i)==="svg"&&r.project.frames.length>1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Pe.disabled=r.project.frames.length<=1,F(Pe,"aria-checked",l(i)==="svg"&&r.project.frames.length>1),K(rt,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),F(rt,"aria-checked",r.studio.exportBgColor==="transparent"),K(nt,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),F(nt,"aria-checked",r.studio.exportBgColor==="#eee8d5"),K(ot,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),F(ot,"aria-checked",r.studio.exportBgColor==="#000000"),K(lt,1,`h-10 w-16 rounded-xl border-2 ${r.studio.exportBgColor===l(a)?"border-brand":"border-black/5"} artisan-checker-small transition-transform hover:scale-105`),ee(lt,`background-color: ${l(a)??""};`),F(lt,"aria-checked",r.studio.exportBgColor===l(a))}),_e(Gt,()=>r.studio.exportScale,we=>r.studio.exportScale=we),C(f,x)},$$slots:{default:!0}}),C(c,n),Z()}pe(["click"]);var In=M('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function Pn(c,e){X(e,!0);var t=In(),i=v(t),s=v(i,!0);u(i);var a=p(i,2),n=v(a,!0);u(a),u(t),z(o=>{H(s,e.label),H(n,o)},[()=>e.customKey||Ce.getLabel(e.intent)]),C(c,t),Z()}var Ln=M('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function Mn(c,e){X(e,!0);var t=Ln(),i=v(t),s=v(i,!0);u(i);var a=p(i,2);xe(a,21,()=>e.group.items,ke,(n,o)=>{Pn(n,{get intent(){return l(o).intent},get label(){return l(o).label},get customKey(){return l(o).customKey}})}),u(a),u(t),z(()=>H(s,e.group.group)),C(c,t),Z()}var Vn=M('<div class="flex flex-col gap-12" role="document"><header class="flex flex-col gap-2 rounded-2xl bg-brand/5 p-6 ring-1 ring-brand/10" aria-labelledby="guide-header-title"><h3 id="guide-header-title" class="font-tiny5 text-xl text-brand uppercase"></h3> <p class="font-serif text-xs leading-relaxed text-studio-text/60"></p></header> <div class="grid grid-cols-2 gap-x-16 gap-y-12"></div> <footer class="mt-4 border-t border-black/5 pt-8 text-center"><p class="font-serif text-[10px] text-studio-text/40 italic"></p></footer></div>');function Fn(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.studio.showArtisanGuide=!1);const i=Y(()=>Ce.getGroupedActions());He(c,{title:__({key:"guide.title"}),subtitle:__({key:"guide.subtitle"}),icon:"ðª¡",get onClose(){return t()},width:"1000px",children:(s,a)=>{var n=Vn(),o=v(n),d=v(o);d.textContent=__({key:"guide.header_title"});var h=p(d,2);h.textContent=__({key:"guide.header_desc"}),u(o);var f=p(o,2);xe(f,21,()=>l(i),ke,(b,y)=>{Mn(b,{get group(){return l(y)}})}),u(f);var g=p(f,2),x=v(g);x.textContent=`"${__({key:"guide.footer_quote"})??""}"`,u(g),u(n),C(s,n)},$$slots:{default:!0}}),Z()}var Bn=M(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Pattern Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your work as a dedicated file on your machine or in your browser's archive.</p></div> <div class="flex flex-col gap-3"><button class="artisan-primary-btn w-full">Archive to Pattern Book</button> <button class="artisan-secondary-btn w-full">Restore from Pattern Book</button></div></div>`);function Dn(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.studio.showArchivePattern=!1);He(c,{title:"Archive Pattern",subtitle:"Preserving Digital Stitches",icon:"ð¾",get onClose(){return t()},width:"400px",children:(i,s)=>{var a=Bn(),n=p(v(a),2),o=v(n);o.__click=()=>{D.persistence.save(),t()()};var d=p(o,2);d.__click=()=>{D.persistence.load(),t()()},u(n),u(a),C(i,a)},$$slots:{default:!0}}),Z()}pe(["click"]);var jn=M('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="stab-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <span class="font-mono text-sm font-bold text-brand"> </span></div> <input id="stab-input" type="range" min="0" max="100" class="h-1.5 w-full cursor-pointer appearance-none rounded-lg bg-black/5 accent-brand"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="fps-input" type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></span> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <button class="group relative flex items-center gap-3" aria-label="Change Backdrop Color"><div class="artisan-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">ð¨</div></button></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"></p></div> <button class="artisan-primary-btn w-full py-4 text-lg"></button></div>'),$n=M("<!> <!>",1);function Rn(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.studio.showLinenSettings=!1),i=T(ve(r.linen.width)),s=T(ve(r.linen.height)),a=T(!1);function n(){D.manipulation.resize(l(i),l(s)),t()()}var o=$n(),d=he(o);{var h=g=>{Ot(g,{onClose:()=>_(a,!1),get value(){return r.studio.canvasBgColor},set value(x){r.studio.canvasBgColor=x}})};q(d,g=>{l(a)&&g(h)})}var f=p(d,2);He(f,{title:__({key:"settings.title"}),subtitle:__({key:"settings.subtitle"}),icon:"ð",get onClose(){return t()},width:"450px",children:(g,x)=>{var b=jn(),y=v(b),k=v(y),m=v(k),A=v(m);A.textContent=__({key:"settings.width"});var I=p(A,2);me(I),u(m);var $=p(m,2),B=v($);B.textContent=__({key:"settings.height"});var P=p(B,2);me(P),u($),u(k);var E=p(k,4),w=v(E),L=v(w),R=v(L);R.textContent=__({key:"settings.stabilization"});var G=p(R,2);G.textContent=__({key:"settings.stabilization_desc"}),u(L);var S=p(L,2),O=v(S);u(S),u(w);var V=p(w,2);me(V),u(E);var j=p(E,4),Q=v(j),ie=v(Q);ie.textContent=__({key:"settings.weave_pace"});var N=p(ie,2);N.textContent=__({key:"settings.fps_desc"}),u(Q);var te=p(Q,2);me(te),u(j);var oe=p(j,4),re=v(oe),fe=v(re);fe.textContent=__({key:"settings.backdrop"});var Ie=p(fe,2);Ie.textContent=__({key:"settings.backdrop_desc"}),u(re);var se=p(re,2);se.__click=()=>_(a,!0);var le=v(se);st(2),u(se),u(oe);var Le=p(oe,2);Le.textContent=__({key:"settings.note"}),u(y);var Fe=p(y,2);Fe.__click=n,Fe.textContent=__({key:"settings.apply"}),u(b),z(()=>{H(O,`${r.studio.stabilization??""}%`),ee(le,`background-color: ${r.studio.canvasBgColor??""};`)}),_e(I,()=>l(i),ce=>_(i,ce)),_e(P,()=>l(s),ce=>_(s,ce)),_e(V,()=>r.studio.stabilization,ce=>r.studio.stabilization=ce),_e(te,()=>r.studio.fps,ce=>r.studio.fps=ce),C(g,b)},$$slots:{default:!0}}),C(c,o),Z()}pe(["click"]);var On=M('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="artisan-primary-btn w-full py-4 text-lg"></button></div>');function Nn(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.studio.showGoTo=!1),i=T(ve(r.displayCoords.x)),s=T(ve(r.displayCoords.y));function a(){D.jumpTo(l(i),l(s)),t()()}function n(o){o.key==="Enter"&&a()}it(()=>{document.getElementById("goto-x")?.focus()}),He(c,{title:__({key:"goto.title"}),subtitle:__({key:"goto.subtitle"}),icon:"ð",get onClose(){return t()},width:"400px",children:(o,d)=>{var h=On(),f=v(h),g=v(f),x=v(g),b=v(x);b.textContent=__({key:"goto.label_x"});var y=p(b,2);me(y),y.__keydown=n,u(x);var k=p(x,2),m=v(k);m.textContent=__({key:"goto.label_y"});var A=p(m,2);me(A),A.__keydown=n,u(k),u(g);var I=p(g,2),$=v(I,!0);u(I),u(f);var B=p(f,2);B.__click=a,B.textContent=__({key:"goto.action"}),u(h),z(P=>H($,P),[()=>__({key:"goto.current",replace:{x:r.displayCoords.x,y:r.displayCoords.y}})]),_e(y,()=>l(i),P=>_(i,P)),_e(A,()=>l(s),P=>_(s,P)),C(o,h)},$$slots:{default:!0}}),Z()}pe(["keydown","click"]);var Gn=M('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all studio resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Stitch Resonance (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Atmosphere Protocol</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="artisan-primary-btn w-full py-4">Seal Settings</button></div>');function zn(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.studio.showAudioBasin=!1);He(c,{title:"Audio Basin",subtitle:"Harmony & Atmosphere Tuning",icon:"ð",get onClose(){return t()},width:"450px",children:(i,s)=>{var a=Gn(),n=v(a),o=p(v(n),2);o.__click=()=>r.toggleMute();var d=v(o,!0);u(o),u(n);var h=p(n,2),f=v(h),g=v(f),x=p(v(g),2),b=v(x);u(x),u(g);var y=p(g,2);me(y),u(f);var k=p(f,2),m=v(k),A=p(v(m),2),I=v(A);u(A),u(m);var $=p(m,2);me($),u(k),u(h);var B=p(h,2),P=p(v(B),2),E=v(P),w=p(v(E),2),L=v(w);u(w),u(E);var R=p(E,2),G=v(R);{var S=j=>{var Q=Je(`The piano awaits in silence. It will begin to weave its melody after 30 minutes of
						artisanry.`);C(j,Q)},O=j=>{var Q=Je("The piano has begun its weave. Volume will reach full depth at 60 minutes.");C(j,Q)};q(G,j=>{r.usageMinutes<30?j(S):j(O,!1)})}u(R),u(P),u(B);var V=p(B,2);V.__click=function(...j){t()?.apply(this,j)},u(a),z((j,Q)=>{K(o,1,`artisan-secondary-btn !px-6 !py-2 ${r.isMuted?"bg-brand text-white":""}`),H(d,r.isMuted?"ð Muted":"ð Active"),H(b,`${j??""}%`),H(I,`${Q??""}%`),H(L,`${r.usageMinutes??""} minutes`)},[()=>Math.round(r.sfxVolume*100),()=>Math.round(r.bgmVolume*100)]),_e(y,()=>r.sfxVolume,j=>r.sfxVolume=j),_e($,()=>r.bgmVolume,j=>r.bgmVolume=j),C(i,a)},$$slots:{default:!0}}),Z()}pe(["click"]);var Hn=M('<div class="flex flex-col gap-12" role="document"><section class="flex flex-col gap-6" aria-labelledby="philosophy-title"><div class="flex items-center gap-4 border-b border-black/5 pb-4"><span class="text-3xl" aria-hidden="true">ð¯ï¸</span> <h3 id="philosophy-title" class="font-tiny5 text-3xl tracking-tighter text-brand uppercase"></h3></div> <div class="space-y-4 font-serif text-base leading-relaxed text-studio-text/80"><p></p> <p></p> <p class="text-brand/60 italic"></p></div></section> <div class="grid grid-cols-3 gap-6" role="list"><div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ðª¡</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ðº</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ð¡ï¸</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div></div> <section class="flex flex-col gap-8 rounded-3xl bg-brand/5 p-10 ring-1 ring-brand/10" aria-labelledby="techniques-title"><h3 id="techniques-title" class="font-tiny5 text-2xl tracking-tighter text-brand uppercase"></h3> <div class="grid grid-cols-2 gap-x-12 gap-y-8"><div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ð§µ</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ðª</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">â³</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ð¹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div></div></section> <footer class="flex flex-col items-center gap-6 border-t border-black/5 pt-10 text-center"><div class="flex flex-col items-center gap-2"><p class="font-serif text-sm text-studio-text/50 italic"></p> <span class="font-tiny5 text-[10px] tracking-[0.3em] text-studio-text/30 uppercase"></span></div> <div class="flex items-center gap-4"><button class="artisan-secondary-btn px-10 py-4"></button> <button class="artisan-primary-btn px-16 py-4 text-xl"></button></div></footer></div>');function Un(c,e){X(e,!0);let t=ae(e,"onClose",3,()=>r.studio.showArtisanCodex=!1);He(c,{title:__({key:"codex.title"}),subtitle:__({key:"codex.subtitle"}),icon:"ð",get onClose(){return t()},width:"850px",children:(i,s)=>{var a=Hn(),n=v(a),o=v(n),d=p(v(o),2);d.textContent=__({key:"codex.philosophy.title"}),u(o);var h=p(o,2),f=v(h);f.textContent=__({key:"codex.philosophy.p1"});var g=p(f,2);g.textContent=__({key:"codex.philosophy.p2"});var x=p(g,2);x.textContent=__({key:"codex.philosophy.p3"}),u(h),u(n);var b=p(n,2),y=v(b),k=p(v(y),2);k.textContent=__({key:"codex.pillars.needle.title"});var m=p(k,2);m.textContent=__({key:"codex.pillars.needle.desc"}),u(y);var A=p(y,2),I=p(v(A),2);I.textContent=__({key:"codex.pillars.dyes.title"});var $=p(I,2);$.textContent=__({key:"codex.pillars.dyes.desc"}),u(A);var B=p(A,2),P=p(v(B),2);P.textContent=__({key:"codex.pillars.veils.title"});var E=p(P,2);E.textContent=__({key:"codex.pillars.veils.desc"}),u(B),u(b);var w=p(b,2),L=v(w);L.textContent=__({key:"codex.techniques.title"});var R=p(L,2),G=v(R),S=p(v(G),2),O=v(S);O.textContent=__({key:"codex.techniques.threading.title"});var V=p(O,2);V.textContent=__({key:"codex.techniques.threading.desc"}),u(S),u(G);var j=p(G,2),Q=p(v(j),2),ie=v(Q);ie.textContent=__({key:"codex.techniques.spirit_pick.title"});var N=p(ie,2);N.textContent=__({key:"codex.techniques.spirit_pick.desc"}),u(Q),u(j);var te=p(j,2),oe=p(v(te),2),re=v(oe);re.textContent=__({key:"codex.techniques.spindle.title"});var fe=p(re,2);fe.textContent=__({key:"codex.techniques.spindle.desc"}),u(oe),u(te);var Ie=p(te,2),se=p(v(Ie),2),le=v(se);le.textContent=__({key:"codex.techniques.resonance.title"});var Le=p(le,2);Le.textContent=__({key:"codex.techniques.resonance.desc"}),u(se),u(Ie),u(R),u(w);var Fe=p(w,2),ce=v(Fe),ne=v(ce);ne.textContent=`"${__({key:"codex.footer.quote"})??""}"`;var Be=p(ne,2);Be.textContent=__({key:"codex.footer.guild"}),u(ce);var Pe=p(ce,2),Ue=v(Pe);Ue.__click=()=>{t()(),r.studio.showArtisanGuide=!0},Ue.textContent=__({key:"codex.footer.all_shortcuts"});var at=p(Ue,2);at.__click=function(...Ye){t()?.apply(this,Ye)},at.textContent=__({key:"codex.footer.enter"}),u(Pe),u(Fe),u(a),C(i,a)},$$slots:{default:!0}}),Z()}pe(["click"]);var J=xt(()=>r),Kn=M('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg selection:bg-brand/20"><!> <div class="flex flex-1 overflow-hidden"><aside class="flex w-64 flex-col overflow-hidden"><!></aside> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20 p-6"><div><!></div></main> <aside class="flex w-72 flex-col overflow-hidden"><!></aside></div> <!></div>',1);function to(c,e){X(e,!1),it(()=>mi.mount()),be();var t=Kn(),i=he(t);ln(i,{});var s=p(i,2);{var a=N=>{Fn(N,{onClose:()=>J(J().studio.showArtisanGuide=!1)})};q(s,N=>{J().studio.showArtisanGuide&&N(a)})}var n=p(s,2);{var o=N=>{xn(N,{onClose:()=>J(J().studio.showPatternCatalog=!1)})};q(n,N=>{J().studio.showPatternCatalog&&N(o)})}var d=p(n,2);{var h=N=>{Ot(N,{onClose:()=>J(J().studio.showDyeBasin=!1),get value(){return J().paletteState.activeDye},set value(te){J(J().paletteState.activeDye=te)},$$legacy:!0})};q(d,N=>{J().studio.showDyeBasin&&N(h)})}var f=p(d,2);{var g=N=>{Tn(N,{onExport:(te,oe,re)=>D.createArtifact(te,oe,re),onClose:()=>J(J().studio.showArtifactCrate=!1)})};q(f,N=>{J().studio.showArtifactCrate&&N(g)})}var x=p(f,2);{var b=N=>{Dn(N,{onClose:()=>J(J().studio.showArchivePattern=!1)})};q(x,N=>{J().studio.showArchivePattern&&N(b)})}var y=p(x,2);{var k=N=>{Rn(N,{onClose:()=>J(J().studio.showLinenSettings=!1)})};q(y,N=>{J().studio.showLinenSettings&&N(k)})}var m=p(y,2);{var A=N=>{Nn(N,{onClose:()=>J(J().studio.showGoTo=!1)})};q(m,N=>{J().studio.showGoTo&&N(A)})}var I=p(m,2);{var $=N=>{zn(N,{onClose:()=>J(J().studio.showAudioBasin=!1)})};q(I,N=>{J().studio.showAudioBasin&&N($)})}var B=p(I,2);{var P=N=>{Un(N,{onClose:()=>J(J().studio.showArtisanCodex=!1)})};q(B,N=>{J().studio.showArtisanCodex&&N(P)})}var E=p(B,2),w=v(E);Va(w);var L=p(w,2),R=v(L),G=v(R);Ua(G),u(R);var S=p(R,2),O=v(S),V=v(O);an(V,{}),u(O),u(S);var j=p(S,2),Q=v(j);ir(Q),u(j),u(L);var ie=p(L,2);$r(ie),u(E),z(()=>K(O,1,`artisan-frame flex h-full w-full items-center justify-center overflow-hidden shadow-2xl transition-all duration-700 ease-out ${J().project.isPlaying&&J().project.frames.length>1?"animate-pulse ring-8 ring-palette-0 ring-inset":""}`)),C(c,t),Z()}export{si as P,to as _};
