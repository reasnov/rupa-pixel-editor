const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Bhn0297J.js","./DfnHKFoC.js","./BSw0shFi.js","./DaRTe1EO.js"])))=>i.map(i=>d[i]);
import{a as T,f as O,c as Ye,t as dt,d as mt}from"./BBtnBUhA.js";import{i as $e}from"./JVkUYqxQ.js";import{o as Vt}from"./Di8NBSml.js";import{aL as Tr,C as tr,h as lt,L as ar,a as ya,aM as rr,N as _a,G as Lr,l as o,P as Cr,Q as Ir,R as Va,S as Aa,e as na,ab as Pr,aF as Mr,an as Ha,c as Nt,aN as wt,b as La,aO as Or,s as Rr,a6 as ea,aP as Dr,aD as Da,aQ as jr,aR as Fr,aI as ja,a9 as Ca,aS as Gr,r as sr,p as ir,aT as wa,W as Fa,aU as Br,aV as $r,aC as Nr,d as Ur,az as Vr,I as Hr,E as zr,aW as Yr,K as Kr,U as ca,i as kt,aX as qr,aY as Qr,aZ as Xt,av as or,a_ as Xr,a$ as Wr,b0 as Zr,b1 as Jr,b2 as es,b3 as ts,b4 as as,b5 as rs,aJ as ss,V as is,b6 as os,F as w,D as C,$ as Ge,g as st,aK as K,z as N,v as d,B as f,w as c,x as ie,A as oe,ao as Pt,y as be,b7 as _t,b8 as Ia,b9 as ns}from"./BSw0shFi.js";import{_ as ls,i as H,p as Le,b as jt}from"./DfnHKFoC.js";import{_ as A,s as cs}from"./DFNAalGC.js";import{a as ds,s as S,d as Ie,e as We}from"./UcfjgllK.js";import{B as us}from"./DaRTe1EO.js";const vs=Symbol("NaN");function hs(p,e,t){lt&&ar();var a=new us(p),s=!Tr();tr(()=>{var i=e();i!==i&&(i=vs),s&&i!==null&&typeof i=="object"&&(i={}),a.ensure(i,t)})}function Be(p,e){return e}function ps(p,e,t){for(var a=[],s=e.length,i,n=e.length,l=0;l<s;l++){let g=e[l];ir(g,()=>{if(i){if(i.pending.delete(g),i.done.add(g),i.pending.size===0){var x=p.outrogroups;Pa(Da(i.done)),x.delete(i),x.size===0&&(p.outrogroups=null)}}else n-=1},!1)}if(n===0){var u=a.length===0&&t!==null;if(u){var v=t,h=v.parentNode;Nr(h),h.append(v),p.items.clear()}Pa(e,!u)}else i={pending:new Set(e),done:new Set},(p.outrogroups??=new Set).add(i)}function Pa(p,e=!0){for(var t=0;t<p.length;t++)Ur(p[t],e)}var za;function Oe(p,e,t,a,s,i=null){var n=p,l=new Map,u=(e&rr)!==0;if(u){var v=p;n=lt?_a(Lr(v)):v.appendChild(ya())}lt&&ar();var h=null,g=ea(()=>{var E=t();return Dr(E)?E:E==null?[]:Da(E)}),x,b=!0;function m(){y.fallback=h,fs(y,x,n,e,a),h!==null&&(x.length===0?(h.f&wt)===0?sr(h):(h.f^=wt,Jt(h,null,n)):ir(h,()=>{h=null}))}var _=tr(()=>{x=o(g);var E=x.length;let I=!1;if(lt){var G=Cr(n)===Ir;G!==(E===0)&&(n=Va(),_a(n),Aa(!1),I=!0)}for(var j=new Set,B=Nt,U=Rr(),P=0;P<E;P+=1){lt&&na.nodeType===Pr&&na.data===Mr&&(n=na,I=!0,Aa(!1));var R=x[P],F=a(R,P),$=b?null:l.get(F);$?($.v&&Ha($.v,R),$.i&&Ha($.i,P),U&&B.unskip_effect($.e)):($=gs(l,b?n:za??=ya(),R,F,P,s,e,t),b||($.e.f|=wt),l.set(F,$)),j.add(F)}if(E===0&&i&&!h&&(b?h=La(()=>i(n)):(h=La(()=>i(za??=ya())),h.f|=wt)),E>j.size&&Or(),lt&&E>0&&_a(Va()),!b)if(U){for(const[z,Y]of l)j.has(z)||B.skip_effect(Y.e);B.oncommit(m),B.ondiscard(()=>{})}else m();I&&Aa(!0),o(g)}),y={effect:_,items:l,outrogroups:null,fallback:h};b=!1,lt&&(n=na)}function Wt(p){for(;p!==null&&(p.f&Br)===0;)p=p.next;return p}function fs(p,e,t,a,s){var i=(a&$r)!==0,n=e.length,l=p.items,u=Wt(p.effect.first),v,h=null,g,x=[],b=[],m,_,y,E;if(i)for(E=0;E<n;E+=1)m=e[E],_=s(m,E),y=l.get(_).e,(y.f&wt)===0&&(y.nodes?.a?.measure(),(g??=new Set).add(y));for(E=0;E<n;E+=1){if(m=e[E],_=s(m,E),y=l.get(_).e,p.outrogroups!==null)for(const $ of p.outrogroups)$.pending.delete(y),$.done.delete(y);if((y.f&wt)!==0)if(y.f^=wt,y===u)Jt(y,null,t);else{var I=h?h.next:u;y===p.effect.last&&(p.effect.last=y.prev),y.prev&&(y.prev.next=y.next),y.next&&(y.next.prev=y.prev),Ct(p,h,y),Ct(p,y,I),Jt(y,I,t),h=y,x=[],b=[],u=Wt(h.next);continue}if((y.f&wa)!==0&&(sr(y),i&&(y.nodes?.a?.unfix(),(g??=new Set).delete(y))),y!==u){if(v!==void 0&&v.has(y)){if(x.length<b.length){var G=b[0],j;h=G.prev;var B=x[0],U=x[x.length-1];for(j=0;j<x.length;j+=1)Jt(x[j],G,t);for(j=0;j<b.length;j+=1)v.delete(b[j]);Ct(p,B.prev,U.next),Ct(p,h,B),Ct(p,U,G),u=G,h=U,E-=1,x=[],b=[]}else v.delete(y),Jt(y,u,t),Ct(p,y.prev,y.next),Ct(p,y,h===null?p.effect.first:h.next),Ct(p,h,y),h=y;continue}for(x=[],b=[];u!==null&&u!==y;)(v??=new Set).add(u),b.push(u),u=Wt(u.next);if(u===null)continue}(y.f&wt)===0&&x.push(y),h=y,u=Wt(y.next)}if(p.outrogroups!==null){for(const $ of p.outrogroups)$.pending.size===0&&(Pa(Da($.done)),p.outrogroups?.delete($));p.outrogroups.size===0&&(p.outrogroups=null)}if(u!==null||v!==void 0){var P=[];if(v!==void 0)for(y of v)(y.f&wa)===0&&P.push(y);for(;u!==null;)(u.f&wa)===0&&u!==p.fallback&&P.push(u),u=Wt(u.next);var R=P.length;if(R>0){var F=(a&rr)!==0&&n===0?t:null;if(i){for(E=0;E<R;E+=1)P[E].nodes?.a?.measure();for(E=0;E<R;E+=1)P[E].nodes?.a?.fix()}ps(p,P,F)}}i&&Fa(()=>{if(g!==void 0)for(y of g)y.nodes?.a?.apply()})}function gs(p,e,t,a,s,i,n,l){var u=(n&jr)!==0?(n&Fr)===0?ja(t,!1,!1):Ca(t):null,v=(n&Gr)!==0?Ca(s):null;return{v:u,i:v,e:La(()=>(i(e,u??t,v??s,l),()=>{p.delete(a)}))}}function Jt(p,e,t){if(p.nodes)for(var a=p.nodes.start,s=p.nodes.end,i=e&&(e.f&wt)===0?e.nodes.start:t;a!==null;){var n=Vr(a);if(i.before(a),a===s)return;a=n}}function Ct(p,e,t){e===null?p.effect.first=t:e.next=t,t===null?p.effect.last=e:t.prev=e}const xs=()=>performance.now(),At={tick:p=>requestAnimationFrame(p),now:()=>xs(),tasks:new Set};function nr(){const p=At.now();At.tasks.forEach(e=>{e.c(p)||(At.tasks.delete(e),e.f())}),At.tasks.size!==0&&At.tick(nr)}function ms(p){let e;return At.tasks.size===0&&At.tick(nr),{promise:new Promise(t=>{At.tasks.add(e={c:p,f:t})}),abort(){At.tasks.delete(e)}}}function da(p,e){or(()=>{p.dispatchEvent(new CustomEvent(e))})}function bs(p){if(p==="float")return"cssFloat";if(p==="offset")return"cssOffset";if(p.startsWith("--"))return p;const e=p.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Ya(p){const e={},t=p.split(";");for(const a of t){const[s,i]=a.split(":");if(!s||i===void 0)break;const n=bs(s.trim());e[n]=i.trim()}return e}const ys=p=>p;function ue(p,e,t,a){var s=(p&Xr)!==0,i=(p&Wr)!==0,n=s&&i,l=(p&qr)!==0,u=n?"both":s?"in":"out",v,h=e.inert,g=e.style.overflow,x,b;function m(){return or(()=>v??=t()(e,a?.()??{},{direction:u}))}var _={is_global:l,in(){if(e.inert=h,!s){b?.abort(),b?.reset?.();return}i||x?.abort(),x=Ma(e,m(),b,1,()=>{da(e,"introend"),x?.abort(),x=v=void 0,e.style.overflow=g})},out(G){if(!i){G?.(),v=void 0;return}e.inert=!0,b=Ma(e,m(),x,0,()=>{da(e,"outroend"),G?.()})},stop:()=>{x?.abort(),b?.abort()}},y=Hr;if((y.nodes.t??=[]).push(_),s&&ds){var E=l;if(!E){for(var I=y.parent;I&&(I.f&zr)!==0;)for(;(I=I.parent)&&(I.f&Yr)===0;);E=!I||(I.f&Kr)!==0}E&&ca(()=>{kt(()=>_.in())})}}function Ma(p,e,t,a,s){var i=a===1;if(Qr(e)){var n,l=!1;return Fa(()=>{if(!l){var y=e({direction:i?"in":"out"});n=Ma(p,y,t,a,s)}}),{abort:()=>{l=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return da(p,i?"introstart":"outrostart"),s(),{abort:Xt,deactivate:Xt,reset:Xt,t:()=>a};const{delay:u=0,css:v,tick:h,easing:g=ys}=e;var x=[];if(i&&t===void 0&&(h&&h(0,1),v)){var b=Ya(v(0,1));x.push(b,b)}var m=()=>1-a,_=p.animate(x,{duration:u,fill:"forwards"});return _.onfinish=()=>{_.cancel(),da(p,i?"introstart":"outrostart");var y=t?.t()??1-a;t?.abort();var E=a-y,I=e.duration*Math.abs(E),G=[];if(I>0){var j=!1;if(v)for(var B=Math.ceil(I/16.666666666666668),U=0;U<=B;U+=1){var P=y+E*g(U/B),R=Ya(v(P,1-P));G.push(R),j||=R.overflow==="hidden"}j&&(p.style.overflow="hidden"),m=()=>{var F=_.currentTime;return y+E*g(F/I)},h&&ms(()=>{if(_.playState!=="running")return!1;var F=m();return h(F,1-F),!0})}_=p.animate(G,{duration:I,fill:"forwards"}),_.onfinish=()=>{m=()=>a,h?.(a,1-a),s()}},{abort:()=>{_&&(_.cancel(),_.effect=null,_.onfinish=Xt)},deactivate:()=>{s=Xt},reset:()=>{a===0&&h?.(1,0)},t:()=>m()}}function Ka(p,e,t){ca(()=>{var a=kt(()=>e(p,t?.())||{});if(a?.destroy)return()=>a.destroy()})}function lr(p){var e,t,a="";if(typeof p=="string"||typeof p=="number")a+=p;else if(typeof p=="object")if(Array.isArray(p)){var s=p.length;for(e=0;e<s;e++)p[e]&&(t=lr(p[e]))&&(a&&(a+=" "),a+=t)}else for(t in p)p[t]&&(a&&(a+=" "),a+=t);return a}function _s(){for(var p,e,t=0,a="",s=arguments.length;t<s;t++)(p=arguments[t])&&(e=lr(p))&&(a&&(a+=" "),a+=e);return a}function As(p){return typeof p=="object"?_s(p):p??""}const qa=[...` 	
\r\f \v\uFEFF`];function ws(p,e,t){var a=p==null?"":""+p;if(e&&(a=a?a+" "+e:e),t){for(var s in t)if(t[s])a=a?a+" "+s:s;else if(a.length)for(var i=s.length,n=0;(n=a.indexOf(s,n))>=0;){var l=n+i;(n===0||qa.includes(a[n-1]))&&(l===a.length||qa.includes(a[l]))?a=(n===0?"":a.substring(0,n))+a.substring(l+1):n=l}}return a===""?null:a}function ks(p,e){return p==null?null:String(p)}function re(p,e,t,a,s,i){var n=p.__className;if(lt||n!==t||n===void 0){var l=ws(t,a,i);(!lt||l!==p.getAttribute("class"))&&(l==null?p.removeAttribute("class"):e?p.className=l:p.setAttribute("class",l)),p.__className=t}else if(i&&s!==i)for(var u in i){var v=!!i[u];(s==null||v!==!!s[u])&&p.classList.toggle(u,v)}return i}function ge(p,e,t,a){var s=p.__style;if(lt||s!==e){var i=ks(e);(!lt||i!==p.getAttribute("style"))&&(i==null?p.removeAttribute("style"):p.style.cssText=i),p.__style=e}return a}const Es=Symbol("is custom element"),Ss=Symbol("is html");function Ee(p){if(lt){var e=!1,t=()=>{if(!e){if(e=!0,p.hasAttribute("value")){var a=p.value;M(p,"value",null),p.value=a}if(p.hasAttribute("checked")){var s=p.checked;M(p,"checked",null),p.checked=s}}};p.__on_r=t,Fa(t),as()}}function Ts(p,e){var t=cr(p);t.value===(t.value=e??void 0)||p.value===e&&(e!==0||p.nodeName!=="PROGRESS")||(p.value=e??"")}function M(p,e,t,a){var s=cr(p);lt&&(s[e]=p.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&p.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(p[Zr]=t),t==null?p.removeAttribute(e):typeof t!="string"&&Ls(p).includes(e)?p[e]=t:p.setAttribute(e,t))}function cr(p){return p.__attributes??={[Es]:p.nodeName.includes("-"),[Ss]:p.namespaceURI===Jr}}var Qa=new Map;function Ls(p){var e=p.getAttribute("is")||p.nodeName,t=Qa.get(e);if(t)return t;Qa.set(e,t=[]);for(var a,s=p,i=Element.prototype;i!==s;){a=ts(s);for(var n in a)a[n].set&&t.push(n);s=es(s)}return t}function Ce(p,e,t=e){var a=new WeakSet;rs(p,"input",async s=>{var i=s?p.defaultValue:p.value;if(i=ka(p)?Ea(i):i,t(i),Nt!==null&&a.add(Nt),await ss(),i!==(i=e())){var n=p.selectionStart,l=p.selectionEnd,u=p.value.length;if(p.value=i??"",l!==null){var v=p.value.length;n===l&&l===u&&v>u?(p.selectionStart=v,p.selectionEnd=v):(p.selectionStart=n,p.selectionEnd=Math.min(l,v))}}}),(lt&&p.defaultValue!==p.value||kt(e)==null&&p.value)&&(t(ka(p)?Ea(p.value):p.value),Nt!==null&&a.add(Nt)),is(()=>{var s=e();if(p===document.activeElement){var i=os??Nt;if(a.has(i))return}ka(p)&&s===Ea(p.value)||p.type==="date"&&!s&&!p.value||s!==p.value&&(p.value=s??"")})}function ka(p){var e=p.type;return e==="number"||e==="range"}function Ea(p){return p===""?null:+p}function ta(p){var e=Ca(0);return function(){return arguments.length===1?(w(e,o(e)+1),arguments[0]):(o(e),p())}}class Cs{project;#e=C(0);get renderPulse(){return o(this.#e)}set renderPulse(e){w(this.#e,e,!0)}triggerPulse(){this.renderPulse++}#t=C(Ge([]));get pixelBuffer(){return o(this.#t)}set pixelBuffer(e){w(this.#t,e,!0)}#a=C(Ge([]));get strokePoints(){return o(this.#a)}set strokePoints(e){w(this.#a,e,!0)}internalBuffer=new Set;constructor(e){this.project=e}mount(){st(()=>{this.compositePixels,this.project.activeFrameIndex,this.project.activeFrame.activeLayerIndex,this.triggerPulse()})}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get pixels(){return this.project.activeFrame.activeLayer.pixels}get compositePixels(){return this.project.activeFrame.compositePixels}set pixels(e){const t=this.project.activeFrame,a=t.activeLayerIndex,s=t.activeLayer;s.pixels=e,s.isLinked&&this.project.frames.forEach((i,n)=>{if(n!==this.project.activeFrameIndex){const l=i.layers[a];l&&(l.pixels=e)}})}clearBuffer(){this.internalBuffer.clear(),this.pixelBuffer=[],this.strokePoints=[]}addBatchToBuffer(e){const t=[...this.strokePoints];e.forEach(a=>{const s=Math.floor(a.x),i=Math.floor(a.y);this.isValidCoord(s,i)&&(this.internalBuffer.add(this.getIndex(s,i)),t.push({x:a.x,y:a.y}))}),this.strokePoints=t,this.pixelBuffer=Array.from(this.internalBuffer)}addToBuffer(e,t){this.addBatchToBuffer([{x:e,y:t}])}reset(e,t,a){this.width=e,this.height=t,this.pixels=a,this.triggerPulse()}clear(){this.project.activeFrame.activeLayer.clear(),this.triggerPulse()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.compositePixels[this.getIndex(e,t)]}setColor(e,t,a){this.pixels[this.getIndex(e,t)]=a}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}#r=K(()=>`calc((100cqi - 20px) * ${this.width} / (${this.width} + 2))`);get fitWidth(){return o(this.#r)}set fitWidth(e){w(this.#r,e)}#s=K(()=>`calc((100cqb - 20px) * ${this.height} / (${this.height} + 2))`);get fitHeight(){return o(this.#s)}set fitHeight(e){w(this.#s,e)}getFitDimension(e){const t=this.width,a=this.height;return e==="horizontal"?`min(${this.fitWidth}, calc(${this.fitHeight} * (${t} / ${a})))`:`min(${this.fitHeight}, calc(${this.fitWidth} * (${a} / ${t})))`}}class Is{#e=C(Ge({x:0,y:0}));get pos(){return o(this.#e)}set pos(e){w(this.#e,e,!0)}#t=C(!0);get isVisible(){return o(this.#t)}set isVisible(e){w(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}const Ps=["#2d3319","#4b5d16","#859900","#a2ad59","#eee8d5","#fdf6e3","#93a1a1","#586e75","#073642","#002b36"],Ms=["#002b36","#073642","#586e75","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#2aa198","#859900"],Sa={default:["#333333","#999999","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"],botanical:Ps,sunset:Ms};class Os{#e=C(Ge(Sa.default[0]));get activeColor(){return o(this.#e)}set activeColor(e){w(this.#e,e,!0)}#t=C(Ge(Sa.default));get swatches(){return o(this.#t)}set swatches(e){w(this.#t,e,!0)}select(e){e>=0&&e<this.swatches.length&&(this.activeColor=this.swatches[e])}setColor(e){this.activeColor=e}loadPalette(e){this.swatches=Sa[e],this.activeColor=this.swatches[0]}}const Rs=["showColorPicker","showAudioSettings","showCommandPalette","showGuideMenu","showGuideBook","showExportMenu","showCanvasSettings","showPersistenceMenu","showUnderlayMenu","showGoTo","showPourBasin"],Ds={managed:Rs};class js{#e=C(1);get zoomLevel(){return o(this.#e)}set zoomLevel(e){w(this.#e,e,!0)}#t=C(!1);get isMuted(){return o(this.#t)}set isMuted(e){w(this.#t,e,!0)}#a=C(!0);get isAmbientPlaying(){return o(this.#a)}set isAmbientPlaying(e){w(this.#a,e,!0)}#r=C(!1);get isAppReady(){return o(this.#r)}set isAppReady(e){w(this.#r,e,!0)}#s=C(!1);get isPicking(){return o(this.#s)}set isPicking(e){w(this.#s,e,!0)}#i=C(!1);get isTimelineMinimized(){return o(this.#i)}set isTimelineMinimized(e){w(this.#i,e,!0)}#o=C(!1);get isTimelineMaximized(){return o(this.#o)}set isTimelineMaximized(e){w(this.#o,e,!0)}#n=C(1);get brushSize(){return o(this.#n)}set brushSize(e){w(this.#n,e,!0)}#l=C("SQUARE");get brushShape(){return o(this.#l)}set brushShape(e){w(this.#l,e,!0)}#c=C("OFF");get symmetryMode(){return o(this.#c)}set symmetryMode(e){w(this.#c,e,!0)}#d=C(!1);get isTilingEnabled(){return o(this.#d)}set isTilingEnabled(e){w(this.#d,e,!0)}#u=C(!1);get isAlphaLocked(){return o(this.#u)}set isAlphaLocked(e){w(this.#u,e,!0)}#v=C(!1);get isColorLocked(){return o(this.#v)}set isColorLocked(e){w(this.#v,e,!0)}#h=C(!1);get isPixelPerfect(){return o(this.#h)}set isPixelPerfect(e){w(this.#h,e,!0)}#p=C(null);get colorLockSource(){return o(this.#p)}set colorLockSource(e){w(this.#p,e,!0)}#f=C(!1);get isAirbrushActive(){return o(this.#f)}set isAirbrushActive(e){w(this.#f,e,!0)}#g=C(.2);get airbrushDensity(){return o(this.#g)}set airbrushDensity(e){w(this.#g,e,!0)}#x=C("BRUSH");get activeTool(){return o(this.#x)}set activeTool(e){w(this.#x,e,!0)}#m=C(null);get shapeAnchor(){return o(this.#m)}set shapeAnchor(e){w(this.#m,e,!0)}#b=C(3);get polygonSides(){return o(this.#b)}set polygonSides(e){w(this.#b,e,!0)}#y=C(0);get polygonIndentation(){return o(this.#y)}set polygonIndentation(e){w(this.#y,e,!0)}#_=C(null);get gradientStartColor(){return o(this.#_)}set gradientStartColor(e){w(this.#_,e,!0)}#A=C(null);get gradientEndColor(){return o(this.#A)}set gradientEndColor(e){w(this.#A,e,!0)}#w=C(50);get stabilization(){return o(this.#w)}set stabilization(e){w(this.#w,e,!0)}#k=C(.5);get bgmVolume(){return o(this.#k)}set bgmVolume(e){w(this.#k,e,!0)}#E=C(.5);get sfxVolume(){return o(this.#E)}set sfxVolume(e){w(this.#E,e,!0)}#S=C(10);get fps(){return o(this.#S)}set fps(e){w(this.#S,e,!0)}#T=C(!1);get isKineticMode(){return o(this.#T)}set isKineticMode(e){w(this.#T,e,!0)}#L=C(!1);get showGhostLayers(){return o(this.#L)}set showGhostLayers(e){w(this.#L,e,!0)}#C=C(1);get timelineZoom(){return o(this.#C)}set timelineZoom(e){w(this.#C,e,!0)}sessionStartTime=Date.now();#I=C(0);get usageMinutes(){return o(this.#I)}set usageMinutes(e){w(this.#I,e,!0)}#P=C(0);get usageSeconds(){return o(this.#P)}set usageSeconds(e){w(this.#P,e,!0)}#M=K(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),a=Math.floor(e%3600/60),s=e%60;return`${t>0?t+":":""}${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`});get sessionTimeLabel(){return o(this.#M)}set sessionTimeLabel(e){w(this.#M,e)}#O=C(!1);get showColorPicker(){return o(this.#O)}set showColorPicker(e){w(this.#O,e,!0)}#R=C(!1);get showAudioSettings(){return o(this.#R)}set showAudioSettings(e){w(this.#R,e,!0)}#D=C(!1);get showCommandPalette(){return o(this.#D)}set showCommandPalette(e){w(this.#D,e,!0)}#j=C(!1);get showGuideMenu(){return o(this.#j)}set showGuideMenu(e){w(this.#j,e,!0)}#F=C(!1);get showGuideBook(){return o(this.#F)}set showGuideBook(e){w(this.#F,e,!0)}#G=C(!1);get showExportMenu(){return o(this.#G)}set showExportMenu(e){w(this.#G,e,!0)}#B=C(!1);get showCanvasSettings(){return o(this.#B)}set showCanvasSettings(e){w(this.#B,e,!0)}#$=C(!1);get showPersistenceMenu(){return o(this.#$)}set showPersistenceMenu(e){w(this.#$,e,!0)}#N=C(!1);get showUnderlayMenu(){return o(this.#N)}set showUnderlayMenu(e){w(this.#N,e,!0)}#U=C(!1);get showGoTo(){return o(this.#U)}set showGoTo(e){w(this.#U,e,!0)}#V=C(!1);get showPourBasin(){return o(this.#V)}set showPourBasin(e){w(this.#V,e,!0)}#H=C(!0);get showMinimap(){return o(this.#H)}set showMinimap(e){w(this.#H,e,!0)}#z=C(null);get underlayImage(){return o(this.#z)}set underlayImage(e){w(this.#z,e,!0)}#Y=C(!0);get isUnderlayVisible(){return o(this.#Y)}set isUnderlayVisible(e){w(this.#Y,e,!0)}#K=C(.2);get underlayOpacity(){return o(this.#K)}set underlayOpacity(e){w(this.#K,e,!0)}#q=C(Ge({x:0,y:0}));get underlayOffset(){return o(this.#q)}set underlayOffset(e){w(this.#q,e,!0)}#Q=C(1);get underlayScale(){return o(this.#Q)}set underlayScale(e){w(this.#Q,e,!0)}#X=C(Ge({x:0,y:0}));get panOffset(){return o(this.#X)}set panOffset(e){w(this.#X,e,!0)}#W=C(!1);get isHandToolActive(){return o(this.#W)}set isHandToolActive(e){w(this.#W,e,!0)}#Z=C(!1);get isTransforming(){return o(this.#Z)}set isTransforming(e){w(this.#Z,e,!0)}#J=C(!1);get isShadingLighten(){return o(this.#J)}set isShadingLighten(e){w(this.#J,e,!0)}#ee=C(!1);get isShadingDarken(){return o(this.#ee)}set isShadingDarken(e){w(this.#ee,e,!0)}#te=C(!1);get isShadingDither(){return o(this.#te)}set isShadingDither(e){w(this.#te,e,!0)}#ae=C(!1);get isPatternBrushActive(){return o(this.#ae)}set isPatternBrushActive(e){w(this.#ae,e,!0)}#re=C(null);get patternBrushData(){return o(this.#re)}set patternBrushData(e){w(this.#re,e,!0)}#se=C("layers");get projectActiveTab(){return o(this.#se)}set projectActiveTab(e){w(this.#se,e,!0)}#ie=C("");get toastMessage(){return o(this.#ie)}set toastMessage(e){w(this.#ie,e,!0)}#oe=C(!1);get showToast(){return o(this.#oe)}set showToast(e){w(this.#oe,e,!0)}toastTimer=null;#ne=C(null);get contextMenu(){return o(this.#ne)}set contextMenu(e){w(this.#ne,e,!0)}show(e){this.toastMessage=e,this.showToast=!0,this.toastTimer&&clearTimeout(this.toastTimer),this.toastTimer=setTimeout(()=>{this.showToast=!1},2e3)}#le=C("#eee8d5");get backgroundColor(){return o(this.#le)}set backgroundColor(e){w(this.#le,e,!0)}#ce=C(10);get exportScale(){return o(this.#ce)}set exportScale(e){w(this.#ce,e,!0)}#de=C("transparent");get exportBgColor(){return o(this.#de)}set exportBgColor(e){w(this.#de,e,!0)}#ue=C(!1);get includePixelBorders(){return o(this.#ue)}set includePixelBorders(e){w(this.#ue,e,!0)}escapeStack=[];#ve=C(Ge([]));get _overlayStack(){return o(this.#ve)}set _overlayStack(e){w(this.#ve,e,!0)}_managedOverlays=Ds.managed;constructor(){setInterval(()=>{const e=Date.now()-this.sessionStartTime;this.usageMinutes=Math.floor(e/6e4),this.usageSeconds=Math.floor(e/1e3)},1e3)}mount(){st(()=>{for(const e of this._managedOverlays)this[e]?kt(()=>this._overlayStack.includes(e))||(this._overlayStack=[...kt(()=>this._overlayStack),e]):kt(()=>this._overlayStack.includes(e))&&(this._overlayStack=kt(()=>this._overlayStack.filter(a=>a!==e)))})}setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.1,Math.min(10,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}resetPan(){this.panOffset={x:0,y:0}}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();if(e)return e(),!0;const t=this._overlayStack[this._overlayStack.length-1];return t?(this[t]=!1,!0):!1}}class Ut{id=crypto.randomUUID();#e=C("New Layer");get name(){return o(this.#e)}set name(e){w(this.#e,e,!0)}#t=C(!0);get isVisible(){return o(this.#t)}set isVisible(e){w(this.#t,e,!0)}#a=C(!1);get isLocked(){return o(this.#a)}set isLocked(e){w(this.#a,e,!0)}#r=C(1);get opacity(){return o(this.#r)}set opacity(e){w(this.#r,e,!0)}#s=C(!1);get isLinked(){return o(this.#s)}set isLinked(e){w(this.#s,e,!0)}#i=C(0);get wiggleAmount(){return o(this.#i)}set wiggleAmount(e){w(this.#i,e,!0)}#o=C(0);get swayAmount(){return o(this.#o)}set swayAmount(e){w(this.#o,e,!0)}#n=C(1);get swaySpeed(){return o(this.#n)}set swaySpeed(e){w(this.#n,e,!0)}#l=C(0);get pulseAmount(){return o(this.#l)}set pulseAmount(e){w(this.#l,e,!0)}#c=C(1);get pulseSpeed(){return o(this.#c)}set pulseSpeed(e){w(this.#c,e,!0)}#d=C("LAYER");get type(){return o(this.#d)}set type(e){w(this.#d,e,!0)}#u=C(null);get parentId(){return o(this.#u)}set parentId(e){w(this.#u,e,!0)}#v=C(!1);get isCollapsed(){return o(this.#v)}set isCollapsed(e){w(this.#v,e,!0)}#h=C(new Uint32Array(0));get pixels(){return o(this.#h)}set pixels(e){w(this.#h,e)}#p=K(()=>{if(this.type==="FOLDER")return!1;for(let e=0;e<this.pixels.length;e++)if(this.pixels[e]!==0)return!0;return!1});get hasContent(){return o(this.#p)}set hasContent(e){w(this.#p,e)}constructor(e,t,a,s="LAYER"){this.name=e,this.type=s,s==="LAYER"&&(this.pixels=new Uint32Array(t*a))}clone(e,t){const a=new Ut(this.name,e,t,this.type);return a.pixels=this.type==="LAYER"?new Uint32Array(this.pixels):new Uint32Array(0),a.isVisible=this.isVisible,a.isLocked=this.isLocked,a.opacity=this.opacity,a.parentId=this.parentId,a.isCollapsed=this.isCollapsed,a}clear(){const e=new Uint32Array(this.pixels.length);e.fill(0),this.pixels=e}hasPixel(e){return this.pixels[e]!==0}}class Fs{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const Ga=new Fs,Gs={"c-major":[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25]},Bs={move:{freq:450,duration:.08,volume:.15},draw:{freq:1200,duration:.15,volume:.03},startup:{freq:220,duration:.8,volume:.1},ready:[523.25,659.25,783.99,1046.5]},$s={scale:[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25],chords:[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]],fade:{startMins:20,fullMins:50}},It={scales:Gs,tones:Bs,ambient:$s};class Ns{get ctx(){return Ga.ctx}playTone(e,t,a="sine",s=.1,i=1e-4){if(r.isMuted)return;const n=this.ctx.createOscillator(),l=this.ctx.createGain();n.type=a,n.frequency.setValueAtTime(e,this.ctx.currentTime);const u=s*r.sfxVolume;l.gain.setValueAtTime(u,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(i,this.ctx.currentTime+t),n.connect(l),l.connect(this.ctx.destination),n.start(),n.stop(this.ctx.currentTime+t)}playMove(){const{freq:e,duration:t,volume:a}=It.tones.move;this.playTone(e,t,"sine",a)}playDraw(){const{freq:e,duration:t,volume:a}=It.tones.draw;this.playTone(e,t,"sine",a),setTimeout(()=>this.playTone(e*1.25,t*.6,"sine",a*.6),50)}playScale(e){const t=It.scales["c-major"],a=t[e%t.length];this.playTone(a,.15,"sine",.12)}playErase(){if(r.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,a=this.ctx.createBuffer(1,t,this.ctx.sampleRate),s=a.getChannelData(0);for(let v=0;v<t;v++)s[v]=Math.random()*2-1;const i=this.ctx.createBufferSource();i.buffer=a;const n=this.ctx.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(1500,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const l=this.ctx.createGain(),u=.1*r.sfxVolume;l.gain.setValueAtTime(u,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),i.connect(n),n.connect(l),l.connect(this.ctx.destination),i.start()}playStartup(){const{freq:e,duration:t,volume:a}=It.tones.startup;this.playTone(e,t,"sine",a),this.playTone(e/2,t*1.5,"sine",a/2)}playReady(){It.tones.ready.forEach((t,a)=>{setTimeout(()=>this.playTone(t,.4,"sine",.05),a*100)})}}const Z=new Ns;class Us{interval=null;#e=C(0);get elapsedTime(){return o(this.#e)}set elapsedTime(e){w(this.#e,e,!0)}#t=K(()=>r.project.frames.reduce((e,t)=>e+t.duration,0));get totalDuration(){return o(this.#t)}set totalDuration(e){w(this.#t,e)}startPlayback(){if(!r.project.isPlaying){if(r.project.frames.length<=1){Z.playErase();return}r.project.isPlaying=!0,this.elapsedTime=0;for(let e=0;e<r.project.activeFrameIndex;e++)this.elapsedTime+=r.project.frames[e].duration;Z.playDraw(),this.tick()}}stopPlayback(){r.project.isPlaying=!1,this.interval&&(clearTimeout(this.interval),this.interval=null)}togglePlayback(){r.project.isPlaying?this.stopPlayback():this.startPlayback()}tick(){if(!r.project.isPlaying)return;const e=r.project.activeFrame,t=(r.project.activeFrameIndex+1)%r.project.frames.length;this.interval=setTimeout(()=>{r.project.activeFrameIndex=t,t===0?this.elapsedTime=0:this.elapsedTime+=e.duration,this.tick()},e.duration)}}const Ba=new Us;class ua{id=crypto.randomUUID();#e=C("Untitled Frame");get name(){return o(this.#e)}set name(e){w(this.#e,e,!0)}#t=C(32);get width(){return o(this.#t)}set width(e){w(this.#t,e,!0)}#a=C(32);get height(){return o(this.#a)}set height(e){w(this.#a,e,!0)}#r=C(100);get duration(){return o(this.#r)}set duration(e){w(this.#r,e,!0)}#s=C(1);get opacity(){return o(this.#s)}set opacity(e){w(this.#s,e,!0)}#i=C(Ge([]));get layers(){return o(this.#i)}set layers(e){w(this.#i,e,!0)}#o=C(0);get activeLayerIndex(){return o(this.#o)}set activeLayerIndex(e){w(this.#o,e,!0)}#n=C(Ge(new Set([0])));get selectedLayerIndices(){return o(this.#n)}set selectedLayerIndices(e){w(this.#n,e,!0)}constructor(e,t=32,a=32){this.name=e,this.width=t,this.height=a,this.layers=[new Ut("Base Layer",t,a)]}get activeLayer(){return this.layers[this.activeLayerIndex]}addLayer(e){const t=e||`Layer ${this.layers.length+1}`,a=new Ut(t,this.width,this.height),s=this.activeLayer;return s.type==="FOLDER"?a.parentId=s.id:s.parentId&&(a.parentId=s.parentId),this.layers.push(a),this.activeLayerIndex=this.layers.length-1,a}addGroup(e){const t=e||`Group ${this.layers.length+1}`,a=new Ut(t,this.width,this.height,"FOLDER");return this.layers.push(a),this.activeLayerIndex=this.layers.length-1,a}removeLayer(e){if(this.layers.length<=1)return;const t=this.layers[e];t.type==="FOLDER"&&this.layers.forEach(a=>{a.parentId===t.id&&(a.parentId=null)}),this.layers.splice(e,1),this.activeLayerIndex>=this.layers.length&&(this.activeLayerIndex=this.layers.length-1)}#l=K(()=>{const e=new Uint32Array(this.width*this.height),t=Ba.elapsedTime/1e3,a=new Map;this.layers.forEach(s=>{s.type==="FOLDER"&&a.set(s.id,s.isVisible)});for(const s of this.layers){if(s.type==="FOLDER"||!s.isVisible||s.parentId&&a.get(s.parentId)===!1)continue;let i=0,n=0;s.swayAmount>0&&(i+=Math.sin(t*s.swaySpeed*Math.PI)*s.swayAmount),s.wiggleAmount>0&&(i+=(Math.sin(t*20)+Math.cos(t*13))*(s.wiggleAmount/2),n+=(Math.cos(t*17)+Math.sin(t*11))*(s.wiggleAmount/2));const l=s.pixels;for(let u=0;u<e.length;u++){const v=l[u];if(v!==0)if(i!==0||n!==0){const h=u%this.width,g=Math.floor(u/this.width),x=Math.round(h+i),b=Math.round(g+n);x>=0&&x<this.width&&b>=0&&b<this.height&&(e[b*this.width+x]=v)}else e[u]=v}}return e});get compositePixels(){return o(this.#l)}set compositePixels(e){w(this.#l,e)}}class Vs{#e=C(null);get currentFilePath(){return o(this.#e)}set currentFilePath(e){w(this.#e,e,!0)}#t=C(null);get lastSaved(){return o(this.#t)}set lastSaved(e){w(this.#t,e,!0)}#a=C(Ge([]));get frames(){return o(this.#a)}set frames(e){w(this.#a,e,!0)}#r=C(Ge([]));get tags(){return o(this.#r)}set tags(e){w(this.#r,e,!0)}#s=C(0);get activeFrameIndex(){return o(this.#s)}set activeFrameIndex(e){w(this.#s,e,!0)}#i=C(Ge(new Set([0])));get selectedFrameIndices(){return o(this.#i)}set selectedFrameIndices(e){w(this.#i,e,!0)}#o=C(!1);get isPlaying(){return o(this.#o)}set isPlaying(e){w(this.#o,e,!0)}#n=C(null);get clipboard(){return o(this.#n)}set clipboard(e){w(this.#n,e,!0)}constructor(){this.frames=[new ua("Main Art")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,a=new ua(t);return this.frames.push(a),this.activeFrameIndex=this.frames.length-1,a}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e=null){this.currentFilePath=e,this.lastSaved=new Date}}class Hs{#e=C(null);get start(){return o(this.#e)}set start(e){w(this.#e,e,!0)}#t=C(null);get end(){return o(this.#t)}set end(e){w(this.#t,e,!0)}#a=C(Ge([]));get indices(){return o(this.#a)}set indices(e){w(this.#a,e,!0)}#r=C(Ge([]));get vertices(){return o(this.#r)}set vertices(e){w(this.#r,e,!0)}#s=K(()=>{const e=new Set,t=r.canvas.width;this.indices.forEach(s=>e.add(s));const a=this.rectangularBounds;if(a)for(let s=a.y1;s<=a.y2;s++)for(let i=a.x1;i<=a.x2;i++)e.add(s*t+i);return e});get activeIndicesSet(){return o(this.#s)}set activeIndicesSet(e){w(this.#s,e)}get isActive(){return this.indices.length>0||this.start!==null||this.vertices.length>0}begin(e,t){this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.indices=[],this.vertices=[]}getPoints(e){const t=new Map;this.indices.forEach(s=>{t.set(s,{x:s%e,y:Math.floor(s/e)})});const a=this.rectangularBounds;if(a)for(let s=a.y1;s<=a.y2;s++)for(let i=a.x1;i<=a.x2;i++){const n=s*e+i;t.set(n,{x:i,y:s})}return Array.from(t.values())}getBoundaryEdges(e){const t=[],a=this.getPoints(e);if(a.length===0)return t;const s=new Set(a.map(i=>`${i.x},${i.y}`));return a.forEach(i=>{s.has(`${i.x},${i.y-1}`)||t.push({x1:i.x,y1:i.y,x2:i.x+1,y2:i.y}),s.has(`${i.x},${i.y+1}`)||t.push({x1:i.x,y1:i.y+1,x2:i.x+1,y2:i.y+1}),s.has(`${i.x-1},${i.y}`)||t.push({x1:i.x,y1:i.y,x2:i.x,y2:i.y+1}),s.has(`${i.x+1},${i.y}`)||t.push({x1:i.x+1,y1:i.y,x2:i.x+1,y2:i.y+1})}),t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){const t=this.getPoints(e);if(t.length===0)return null;let a=1/0,s=-1/0,i=1/0,n=-1/0;return t.forEach(l=>{l.x<a&&(a=l.x),l.x>s&&(s=l.x),l.y<i&&(i=l.y),l.y>n&&(n=l.y)}),{x1:a,x2:s,y1:i,y2:n,width:s-a+1,height:n-i+1}}}class zs{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){!("isStructural"in e)&&!Array.isArray(e)&&e.oldColor===e.newColor||(this.currentBatch&&!("isStructural"in e)&&!Array.isArray(e)?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const ce=new zs;class Ze{static getLinePoints(e,t,a,s,i=0){e=Math.floor(e),t=Math.floor(t),a=Math.floor(a),s=Math.floor(s);const n=[],l=Math.abs(a-e),u=Math.abs(s-t),v=e<a?1:-1,h=t<s?1:-1;let g=l-u;for(;;){n.push({x:e,y:t});const x=l===u,b=l===0||u===0;if(i>.9&&!x&&!b&&(l>u?n.push({x:e,y:t+h}):n.push({x:e+v,y:t})),e===a&&t===s)break;const m=2*g;m>-u&&(g-=u,e+=v),m<l&&(g+=l,t+=h)}return n}static getCirclePoints(e,t,a){e=Math.floor(e),t=Math.floor(t),a=Math.round(a);const s=[];let i=a,n=0,l=0;for(;i>=n;)[{x:e+i,y:t+n},{x:e+n,y:t+i},{x:e-n,y:t+i},{x:e-i,y:t+n},{x:e-i,y:t-n},{x:e-n,y:t-i},{x:e+n,y:t-i},{x:e+i,y:t-n}].forEach(v=>s.push(v)),l<=0&&(n+=1,l+=2*n+1),l>0&&(i-=1,l-=2*i+1);return s}static fitArc(e,t){if(e.length<10)return null;let a=0,s=0;e.forEach(P=>{a+=P.x,s+=P.y});const i=a/e.length,n=s/e.length;let l=0;const u=e.map(P=>{const R=Math.sqrt((P.x-i)**2+(P.y-n)**2);return l+=R,R}),v=l/e.length;let h=0;if(u.forEach(P=>{h+=(P-v)**2}),Math.sqrt(h/e.length)/(v||1)>t)return null;const b=e[0],m=e[e.length-1],y=Math.sqrt((b.x-m.x)**2+(b.y-m.y)**2)<v*1.5||e.length>v*Math.PI*1.5,E=[],I=Math.atan2(e[0].y-n,e[0].x-i),G=Math.atan2(e[e.length-1].y-n,e[e.length-1].x-i),j=Math.max(32,Math.floor(v*10));let B=G-I;for(;B>Math.PI;)B-=Math.PI*2;for(;B<-Math.PI;)B+=Math.PI*2;const U=y?Math.PI*2:B;for(let P=0;P<=j;P++){const R=I+U*(P/j);E.push({x:i+Math.cos(R)*v,y:n+Math.sin(R)*v})}return{cx:i,cy:n,r:v,isFull:y,points:E}}static perpendicularDistance(e,t,a){const s=a.x-t.x,i=a.y-t.y;return s===0&&i===0?Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2):Math.abs(i*e.x-s*e.y+a.x*t.y-a.y*t.x)/Math.sqrt(s*s+i*i)}static toCartesianLabel(e,t,a=!1){const s=Math.floor(t/2),i=t%2===0?e<s?e-s:e-s+1:e-s;return a?-i:i}static getGuidePosition(e,t){return 50+e/t*100}static mapScreenToGrid(e,t,a,s,i){const n=(e-a.left)/a.width,l=(t-a.top)/a.height;return{x:n*s,y:l*i}}static calculateCameraTransform(e,t,a,s,i){const{x:n,y:l}=t;if(e<=1)return`translate(calc(-50% + ${n}px), calc(-50% + ${l}px)) scale(${e})`;const u=(a.x+.5)/s*100,v=(a.y+.5)/i*100;return`translate(calc(-${u}% + ${n}px), calc(-${v}% + ${l}px)) scale(${e})`}static calculatePanDelta(e,t,a,s){return{dx:e-a,dy:t-s}}}class nt{static getSymmetryPoints(e,t,a,s,i){const n=[],l=a-1-e,u=s-1-t;return i==="HORIZONTAL"?n.push({x:l,y:t}):i==="VERTICAL"?n.push({x:e,y:u}):i==="QUADRANT"&&(n.push({x:l,y:t}),n.push({x:e,y:u}),n.push({x:l,y:u})),n}static wrap(e,t,a,s){return{x:(e%a+a)%a,y:(t%s+s)%s}}static floodFill(e,t,a,s,i,n){const l=e[i*t+s];if(l===n)return e;const u=[...e],v=[[s,i]];for(;v.length>0;){let[h,g]=v.pop(),x=h;for(;x>0&&u[g*t+(x-1)]===l;)u[g*t+(x-1)]=n,x--;for(;h<t&&u[g*t+h]===l;)u[g*t+h]=n,h++;this.scan(x,h-1,g-1,t,a,u,l,v),this.scan(x,h-1,g+1,t,a,u,l,v)}return u}static scan(e,t,a,s,i,n,l,u){if(a<0||a>=i)return;let v=!1;for(let h=e;h<=t;h++)n[a*s+h]===l?v||(u.push([h,a]),v=!0):v=!1}static recolor(e,t,a){return e.map(s=>s===t?a:s)}static getPaletteUsage(e){const t=new Set;return e.forEach(a=>{a&&t.add(a)}),t}static pixelPerfectFilter(e){if(e.length<3)return e;const t=[e[0]];for(let a=1;a<e.length;a++){const s=e[a],i=t[t.length-1];if(!(s.x===i.x&&s.y===i.y)){if(t.length>=2){const n=t[t.length-2],l=Math.abs(s.x-n.x),u=Math.abs(s.y-n.y);l<=1&&u<=1&&t.pop()}t.push(s)}}return t}static getRectanglePoints(e,t,a,s){const i=[],n=Math.min(e,a),l=Math.max(e,a),u=Math.min(t,s),v=Math.max(t,s);for(let h=n;h<=l;h++)i.push({x:h,y:u}),i.push({x:h,y:v});for(let h=u+1;h<v;h++)i.push({x:n,y:h}),i.push({x:l,y:h});return i}static getEllipsePoints(e,t,a,s){const i=(e+a)/2,n=(t+s)/2,l=Math.abs(a-e)/2,u=Math.abs(s-t)/2;if(l===0||u===0)return[];const v=[];let h=0,g=u,x=u*u-l*l*u+.25*l*l,b=2*u*u*h,m=2*l*l*g;for(;b<m;)this.addEllipsePoints(v,i,n,h,g),x<0?(h++,b=b+2*u*u,x=x+b+u*u):(h++,g--,b=b+2*u*u,m=m-2*l*l,x=x+b-m+u*u);let _=u*u*((h+.5)*(h+.5))+l*l*((g-1)*(g-1))-l*l*u*u;for(;g>=0;)this.addEllipsePoints(v,i,n,h,g),_>0?(g--,m=m-2*l*l,_=_+l*l-m):(g--,h++,b=b+2*u*u,m=m-2*l*l,_=_+b-m+l*l);return v}static addEllipsePoints(e,t,a,s,i){e.push({x:Math.round(t+s),y:Math.round(a+i)}),e.push({x:Math.round(t-s),y:Math.round(a+i)}),e.push({x:Math.round(t+s),y:Math.round(a-i)}),e.push({x:Math.round(t-s),y:Math.round(a-i)})}static getPolygonPoints(e,t,a,s,i,n=0){const l=(e+a)/2,u=(t+s)/2,v=Math.abs(a-e)/2,h=Math.abs(s-t)/2,g=Math.max(v,h);if(g===0)return[];const x=[],b=-Math.PI/2;if(n>0){const _=g*(1-n/100);for(let y=0;y<i*2;y++){const E=b+y*Math.PI/i,I=y%2===0?g:_;x.push({x:Math.round(l+Math.cos(E)*I),y:Math.round(u+Math.sin(E)*I)})}}else for(let _=0;_<i;_++){const y=b+_*2*Math.PI/i;x.push({x:Math.round(l+Math.cos(y)*g),y:Math.round(u+Math.sin(y)*g)})}const m=[];for(let _=0;_<x.length;_++){const y=x[_],E=x[(_+1)%x.length];m.push(...Ze.getLinePoints(y.x,y.y,E.x,E.y))}return m}static getLinearGradientMap(e,t,a,s,i,n){const l=[],u=a-e,v=s-t,h=u*u+v*v;return h===0?i.map(g=>({index:g,ratio:0})):(i.forEach(g=>{const x=g%n,b=Math.floor(g/n),m=((x-e)*u+(b-t)*v)/h,_=Math.max(0,Math.min(1,m));l.push({index:g,ratio:_})}),l)}}class Ys{move(e,t){let a=r.cursor.pos.x+e,s=r.cursor.pos.y+t;if(r.studio.isTilingEnabled){const i=nt.wrap(a,s,r.canvas.width,r.canvas.height);a=i.x,s=i.y}else a=Math.max(0,Math.min(r.canvas.width-1,a)),s=Math.max(0,Math.min(r.canvas.height-1,s));return a!==r.cursor.pos.x||s!==r.cursor.pos.y?(r.cursor.setPos(a,s),Z.playMove(),!0):!1}internalToCartesian(e,t,a,s){const i=(n,l)=>{const u=Math.floor(l/2);return l%2===0?n<u?n-u:n-u+1:n-u};return{x:i(e,a),y:-i(t,s)}}cartesianToInternal(e,t,a,s){const i=Math.floor(a/2),n=Math.floor(s/2);let l,u;a%2===0?l=e<0?e+i:e+i-1:l=e+i;const v=-t;return s%2===0?u=v<0?v+n:v+n-1:u=v+n,{x:Math.max(0,Math.min(a-1,l)),y:Math.max(0,Math.min(s-1,u))}}jumpTo(e,t){const{x:a,y:s}=this.cartesianToInternal(e,t,r.canvas.width,r.canvas.height);r.cursor.setPos(a,s)}jumpHome(){this.jumpTo(1,1),Z.playMove()}}class Ta{static getKernel(e,t){if(e<=1)return[{x:0,y:0}];const a=[],s=(e-1)/2,i=-Math.floor(s),n=Math.ceil(s);for(let l=i;l<=n;l++)for(let u=i;u<=n;u++)t==="SQUARE"?a.push({x:u,y:l}):Math.sqrt(u*u+l*l)<=s+.1&&a.push({x:u,y:l});return a}static getSpans(e,t){if(e<=1)return[{y:0,x1:0,x2:0}];const a=[],s=(e-1)/2,i=-Math.floor(s),n=Math.ceil(s);for(let l=i;l<=n;l++)if(t==="SQUARE")a.push({y:l,x1:i,x2:n});else{const u=Math.sqrt(s*s-l*l),v=Math.floor(u);isNaN(v)||a.push({y:l,x1:-v,x2:v})}return a}}class Xa{static simplify(e,t){if(e.length<=2||t<=0)return e;let a=0,s=0;const i=e[0],n=e[e.length-1];for(let l=1;l<e.length-1;l++){const u=Ze.perpendicularDistance(e[l],i,n);u>a&&(s=l,a=u)}if(a>t){const l=this.simplify(e.slice(0,s+1),t),u=this.simplify(e.slice(s),t);return[...l.slice(0,-1),...u]}else return[i,n]}static smooth(e,t){if(e.length<=2||t<=0)return e;const a=[...e],s=Math.floor(t/10)+1;for(let i=1;i<e.length-1;i++){let n=0,l=0,u=0;for(let v=i-s;v<=i+s;v++)v>=0&&v<e.length&&(n+=e[v].x,l+=e[v].y,u++);a[i]={x:n/u,y:l/u}}return a}static traceCluster(e,t){const a=new Set;for(const i of e){const n=i%t,l=Math.floor(i/t);[{x:n,y:l-1,id:"top"},{x:n+1,y:l,id:"right"},{x:n,y:l+1,id:"bottom"},{x:n-1,y:l,id:"left"}].forEach(v=>{const h=v.y*t+v.x;if(v.x<0||v.x>=t||v.y<0||!e.has(h)){let x;v.id==="top"?x=`${n},${l}-${n+1},${l}`:v.id==="right"?x=`${n+1},${l}-${n+1},${l+1}`:v.id==="bottom"?x=`${n+1},${l+1}-${n},${l+1}`:x=`${n},${l+1}-${n},${l}`,a.add(x)}})}const s=[];for(;a.size>0;){const i=a.values().next().value;if(!i)break;a.delete(i);const[n,l]=i.split("-");let u=l,v=`M ${n.replace(","," ")} L ${l.replace(","," ")}`,h=!0;for(;h;){h=!1;for(const g of a)if(g.startsWith(u+"-")){const[x,b]=g.split("-");v+=` L ${b.replace(","," ")}`,u=b,a.delete(g),h=!0;break}}v+=" Z",s.push(v)}return s.join(" ")}}const Ks={MOVE_UP:{label:"Move Up",keys:["ArrowUp"],group:"Navigation"},MOVE_DOWN:{label:"Move Down",keys:["ArrowDown"],group:"Navigation"},MOVE_LEFT:{label:"Move Left",keys:["ArrowLeft"],group:"Navigation"},MOVE_RIGHT:{label:"Move Right",keys:["ArrowRight"],group:"Navigation"},GOTO:{label:"Jump to Coordinate",keys:["Alt+j"],group:"Navigation"},JUMP_HOME:{label:"Return to Center",keys:["Ctrl+h"],group:"Navigation"},PAN_VIEWPORT:{label:"Pan Viewport (Hold)",keys:["q"],group:"Navigation"},RESET_PAN:{label:"Reset Panning",keys:["Alt+q"],group:"Navigation"},RESET_VIEWPORT:{label:"Reset Pan/Zoom",keys:["Alt+Backspace"],group:"View"}},qs={PAINT:{label:"Paint (Apply Color)",keys:["Space","Enter"],group:"Tools"},ERASE:{label:"Erase Pixel",keys:["Backspace","Delete"],group:"Tools"},PICK_COLOR:{label:"Sample Color",keys:["Alt+i","Alt+Space"],group:"Tools"},FLOOD_FILL:{label:"Color Fill",keys:["Alt+f"],group:"Magic"},RECOLOR:{label:"Recolor All",keys:["Alt+r"],group:"Magic"},SELECT_SAME:{label:"Magic Wand",keys:["w"],group:"Magic"},TOOL_GRADIENT:{label:"Gradient Fill",keys:["Alt+g"],group:"Magic"}},Qs={FLOW_PAINT:{label:"Continuous Painting",keys:["Ctrl"],group:"Flow"},FLOW_ERASE:{label:"Continuous Erasing",keys:["Ctrl+Shift"],group:"Flow"},FLOW_SELECT:{label:"Define Selection",keys:["Shift"],group:"Flow"}},Xs={COPY:{label:"Copy",keys:["Ctrl+c"],group:"Edit"},CUT:{label:"Cut",keys:["Ctrl+x"],group:"Edit"},PASTE:{label:"Paste",keys:["Ctrl+v"],group:"Edit"},CLEAR_CANVAS:{label:"Clear All",keys:["Ctrl+l"],group:"Edit"}},Ws={FLIP_H:{label:"Flip Horizontally",keys:["Alt+h"],group:"Transform"},FLIP_V:{label:"Flip Vertically",keys:["Alt+v"],group:"Transform"},ROTATE:{label:"Rotate 90° Clockwise",keys:["r"],group:"Transform"},ZOOM_IN:{label:"Zoom In",keys:["+","="],group:"View"},ZOOM_OUT:{label:"Zoom Out",keys:["-"],group:"View"},RESET_ZOOM:{label:"Reset Zoom",keys:["Ctrl+0"],group:"View"}},Zs={NEXT_FRAME:{label:"Next Frame",keys:["Alt+PageDown","Tab"],group:"Timeline"},PREV_FRAME:{label:"Previous Frame",keys:["Alt+PageUp","Shift+Tab"],group:"Timeline"},PLAY_PAUSE:{label:"Play/Pause",keys:["p"],group:"Timeline"},TOGGLE_GHOST_LAYERS:{label:"Onion Skinning",keys:["Alt+o"],group:"Timeline"}},Js={NEW_ITEM:{label:"Add New (Contextual)",keys:["Alt+Shift+n"],group:"Layers"},NEW_LAYER_GROUP:{label:"Group Layers",keys:["Ctrl+g"],group:"Layers"},DUPLICATE_ITEM:{label:"Duplicate (Contextual)",keys:["Ctrl+d"],group:"Layers"},MOVE_ITEM_UP:{label:"Bring Forward",keys:["Ctrl+]"],group:"Layers"},MOVE_ITEM_DOWN:{label:"Send Backward",keys:["Ctrl+["],group:"Layers"},MOVE_ITEM_TOP:{label:"Bring to Front",keys:["Ctrl+Shift+]"],group:"Layers"},MOVE_ITEM_BOTTOM:{label:"Send to Back",keys:["Ctrl+Shift+["],group:"Layers"},DELETE_ITEM:{label:"Remove (Contextual)",keys:["Alt+d"],group:"Layers"},MERGE_LAYERS:{label:"Merge Layer Down",keys:["Ctrl+Alt+m"],group:"Layers"},TOGGLE_LAYER_VISIBILITY:{label:"Show/Hide Layer",keys:["Ctrl+Alt+v"],group:"Layers"},TOGGLE_LAYER_LOCK:{label:"Lock/Unlock Layer",keys:["Alt+l"],group:"Layers"}},ei={BRUSH_SIZE_INC:{label:"Increase Brush Size",keys:["]"],group:"Etching"},BRUSH_SIZE_DEC:{label:"Decrease Brush Size",keys:["["],group:"Etching"},TOGGLE_PATTERN_BRUSH:{label:"Pattern Brush",keys:["Ctrl+Alt+b"],group:"Etching"},TOGGLE_BRUSH_SHAPE:{label:"Toggle Brush Shape",keys:["Alt+b"],group:"Etching"},CYCLE_SYMMETRY:{label:"Cycle Symmetry Mode",keys:["s"],group:"Etching"},TOGGLE_TILING:{label:"Toggle Seamless Tiling",keys:["t"],group:"Etching"},TOGGLE_AIRBRUSH:{label:"The Mist (Airbrush)",keys:["Alt+a"],group:"Etching"},TOGGLE_ALPHA_LOCK:{label:"Toggle Alpha Lock",keys:["a"],group:"Etching"},TOGGLE_COLOR_LOCK:{label:"Toggle Color Lock",keys:["Shift+a"],group:"Etching"},SHADE_LIGHTEN:{label:"Shade: Lighten",keys:["l"],group:"Etching"},SHADE_DARKEN:{label:"Shade: Darken",keys:["d"],group:"Etching"},SHADE_DITHER:{label:"Shade: Dither",keys:["x"],group:"Etching"},TOGGLE_PIXEL_PERFECT:{label:"Toggle Pixel-Perfect Lines",keys:["Shift+p"],group:"Etching"},TOOL_BRUSH:{label:"Brush Tool",keys:["Shift+b"],group:"Etching"},TOOL_ERASER:{label:"Eraser Tool",keys:["e"],group:"Etching"},TOOL_SELECT:{label:"Select Tool",keys:["Shift+s"],group:"Etching"},TOGGLE_HAND_TOOL:{label:"Hand Tool",keys:["h"],group:"Etching"},TOOL_RECTANGLE:{label:"Rectangle Tool",keys:["Shift+r"],group:"Etching"},TOOL_ELLIPSE:{label:"Ellipse Tool",keys:["Alt+c"],group:"Etching"},TOOL_POLYGON:{label:"Polygon Tool",keys:["Alt+p"],group:"Etching"},POLY_SIDES_INC:{label:"Increase Polygon Sides",keys:["Alt+."],group:"Etching"},POLY_SIDES_DEC:{label:"Decrease Polygon Sides",keys:["Alt+,"],group:"Etching"},POLY_INDENT_INC:{label:"Increase Indentation",keys:["Alt+Shift+]"],group:"Etching"},POLY_INDENT_DEC:{label:"Decrease Indentation",keys:["Alt+Shift+["],group:"Etching"},SET_SIDES_3:{label:"Set Sides: 3",keys:["Alt+3"],group:"Etching"},SET_SIDES_4:{label:"Set Sides: 4",keys:["Alt+4"],group:"Etching"},SET_SIDES_5:{label:"Set Sides: 5",keys:["Alt+5"],group:"Etching"},SET_SIDES_6:{label:"Set Sides: 6",keys:["Alt+6"],group:"Etching"},SET_SIDES_7:{label:"Set Sides: 7",keys:["Alt+7"],group:"Etching"},SET_SIDES_8:{label:"Set Sides: 8",keys:["Alt+8"],group:"Etching"},SET_SIDES_9:{label:"Set Sides: 9",keys:["Alt+9"],group:"Etching"},SET_SIDES_10:{label:"Set Sides: 10",keys:["Alt+0"],group:"Etching"},TOGGLE_UNDERLAY:{label:"Toggle Underlay Visibility",keys:["Ctrl+Alt+u"],group:"View"},OPEN_UNDERLAY_MENU:{label:"Underlay Menu",keys:["Alt+u"],group:"View"},TOOL_TRANSFORM:{label:"Transform Selection",keys:["m"],group:"Edit"}},ti={OPEN_MENU:{label:"Command Palette",keys:["Ctrl+k"],group:"System"},OPEN_EXPORT:{label:"Export",keys:["Ctrl+e"],group:"System"},SAVE:{label:"Save",keys:["Ctrl+s"],group:"System"},OPEN_SETTINGS:{label:"Settings",keys:["Ctrl+,"],group:"System"},OPEN_MANUAL:{label:"Barista Manual",keys:["F1"],group:"System"},OPEN_PALETTE:{label:"Color Picker",keys:["b"],group:"System"},OPEN_HELP:{label:"Quick Guide",keys:["F2"],group:"System"},OPEN_AUDIO:{label:"Audio Settings",keys:["Ctrl+Shift+a"],group:"System"},TOGGLE_MUTE:{label:"Mute Audio",keys:["Ctrl+Shift+m"],group:"System"},TOGGLE_MINIMAP:{label:"Minimap",keys:["Ctrl+m"],group:"System"},UNDO:{label:"Undo",keys:["Ctrl+z"],group:"System"},REDO:{label:"Redo",keys:["Ctrl+Shift+z","Ctrl+y"],group:"System"},ESCAPE:{label:"Close/Cancel",keys:["Escape"],group:"System"}},ai={SELECT_COLOR_1:{label:"Select Color 1",keys:["1"],group:"Colors"},SELECT_COLOR_2:{label:"Select Color 2",keys:["2"],group:"Colors"},SELECT_COLOR_3:{label:"Select Color 3",keys:["3"],group:"Colors"},SELECT_COLOR_4:{label:"Select Color 4",keys:["4"],group:"Colors"},SELECT_COLOR_5:{label:"Select Color 5",keys:["5"],group:"Colors"},SELECT_COLOR_6:{label:"Select Color 6",keys:["6"],group:"Colors"},SELECT_COLOR_7:{label:"Select Color 7",keys:["7"],group:"Colors"},SELECT_COLOR_8:{label:"Select Color 8",keys:["8"],group:"Colors"},SELECT_COLOR_9:{label:"Select Color 9",keys:["9"],group:"Colors"},SELECT_COLOR_0:{label:"Select Color 0",keys:["0"],group:"Colors"}},ri={TAB_TIMELINE:{label:"Focus Timeline",keys:["Alt+1"],group:"System"},TAB_LAYERS:{label:"Focus Layers",keys:["Alt+2"],group:"System"}},si={navigation:Ks,painting:qs,flows:Qs,manipulation:Xs,transform:Ws,animation:Zs,layering:Js,etching:ei,system:ti,colors:ai,tabs:ri};class ii{buffer=[];timeout=null;#e=C(Ge([]));get currentSequence(){return o(this.#e)}set currentSequence(e){w(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const a=this.buffer.join(","),s={"g,c":"GOTO","f,n":"NEW_ITEM","i,n":"NEW_ITEM","i,l":"TOGGLE_LAYER_LOCK","i,h":"TOGGLE_LAYER_VISIBILITY","i,m":"MERGE_LAYERS"};if(s[a]){const i=s[a];return this.reset(),i}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const Oa=new ii;class oi{patterns=[];#e=C(Ge([]));get activeKeys(){return o(this.#e)}set activeKeys(e){w(this.#e,e,!0)}#t=C(!1);get isCtrlActive(){return o(this.#t)}set isCtrlActive(e){w(this.#t,e,!0)}#a=C(!1);get isShiftActive(){return o(this.#a)}set isShiftActive(e){w(this.#a,e,!0)}#r=C(!1);get isAltActive(){return o(this.#r)}set isAltActive(e){w(this.#r,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){this.patterns=[],Object.values(si).forEach(e=>{Object.entries(e).forEach(([t,a])=>{const{keys:s,group:i}=a,n=A({key:`labels.${t}`}),l=i.toLowerCase().replace(/ & /g,"_").replace(/ /g,"_"),u=A({key:`shortcut_groups.${l}`});s.forEach(v=>{const h=v.toLowerCase();let g="",x=!1,b=!1,m=!1;if(h==="+")g="+";else{const _=h.split("+");g=_[_.length-1].trim(),g===""&&h.endsWith("++")&&(g="+"),x=_.includes("ctrl")||_.includes("control"),b=_.includes("shift"),m=_.includes("alt")}g==="space"&&(g=" "),(g==="ctrl"||g==="control")&&(g="control"),this.patterns.push({intent:t,key:g,ctrl:x,shift:b,alt:m,label:n,group:u})})})}),this.patterns.sort((e,t)=>{const a=s=>(s.ctrl?1:0)+(s.shift?1:0)+(s.alt?1:0);return a(t)-a(e)})}getActions(){const e=new Set,t=[];return this.patterns.forEach(a=>{e.has(a.intent)||(e.add(a.intent),t.push({intent:a.intent,label:a.label,group:a.group,shortcut:this.getLabel(a.intent)}))}),t}getGroupedActions(){const e=this.getActions(),t={},a={MOVE_UP:"navigation",MOVE_DOWN:"navigation",MOVE_LEFT:"navigation",MOVE_RIGHT:"navigation",SELECT_COLOR_1:"colors",SELECT_COLOR_2:"colors",SELECT_COLOR_3:"colors",SELECT_COLOR_4:"colors",SELECT_COLOR_5:"colors",SELECT_COLOR_6:"colors",SELECT_COLOR_7:"colors",SELECT_COLOR_8:"colors",SELECT_COLOR_9:"colors",SELECT_COLOR_0:"colors"},s=[],i=new Set;e.forEach(u=>{const v=a[u.intent];if(v){if(!i.has(v)){i.add(v);const h=A({key:`shortcut_groups.${v}`});s.push({...u,label:h,customKey:v.toUpperCase()})}}else s.push(u)}),s.forEach(u=>{t[u.group]||(t[u.group]=[]),t[u.group].push(u)});const n=[A({key:"shortcut_groups.rhythms"}),A({key:"shortcut_groups.navigation"}),A({key:"shortcut_groups.tools"}),A({key:"shortcut_groups.magic"}),A({key:"shortcut_groups.etching"}),A({key:"shortcut_groups.flow"}),A({key:"shortcut_groups.selection"}),A({key:"shortcut_groups.transform"}),A({key:"shortcut_groups.geometry"}),A({key:"shortcut_groups.timeline"}),A({key:"shortcut_groups.layers"}),A({key:"shortcut_groups.edit"}),A({key:"shortcut_groups.view"}),A({key:"shortcut_groups.menu"}),A({key:"shortcut_groups.colors"}),A({key:"shortcut_groups.system"})],l=Object.keys(t);return l.sort((u,v)=>{const h=n.indexOf(u),g=n.indexOf(v);return(h===-1?999:h)-(g===-1?999:g)}),l.map(u=>({group:u,items:t[u]}))}updatePhysicalState(e,t){const a=e.key.toLowerCase();t==="down"?this.activeKeys.includes(a)||this.activeKeys.push(a):(this.activeKeys=this.activeKeys.filter(s=>s!==a),a==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="control"&&s!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const a=Oa.process(t);if(a)return a}else Oa.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const a of this.patterns)if(t===a.key&&this.isCtrlActive===a.ctrl&&this.isShiftActive===a.shift&&this.isAltActive===a.alt)return a.intent;return null}getLabel(e){const t=this.patterns.find(u=>u.intent===e);if(!t)return"Unassigned";const a=[];t.ctrl&&a.push("Ctrl"),t.shift&&a.push("Shift"),t.alt&&a.push("Alt");let s=t.key;const i={" ":"Space",control:"Ctrl",meta:"Cmd",alt:"Alt",shift:"Shift",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right",backspace:"Backspace",delete:"Delete",enter:"Enter",escape:"Esc",tab:"Tab"},n=s.toLowerCase();i[n]?s=i[n]:s=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();const l=a.filter(u=>u.toLowerCase()!==s.toLowerCase());return l.length===0?s:l.join("+")+"+"+s}}const rt=new oi;class ne{static toHex(e){const{h:t,s:a,l:s,a:i}=e,n=t/360,l=a/100,u=s/100;let v,h,g;if(l===0)v=h=g=u;else{const _=u<.5?u*(1+l):u+l-u*l,y=2*u-_,E=I=>(I<0&&(I+=1),I>1&&(I-=1),I<1/6?y+(_-y)*6*I:I<1/2?_:I<2/3?y+(_-y)*(2/3-I)*6:y);v=E(n+1/3),h=E(n),g=E(n-1/3)}const x=_=>Math.round(_*255).toString(16).padStart(2,"0"),b=Math.round(i*255).toString(16).padStart(2,"0"),m=`#${x(v)}${x(h)}${x(g)}`;return b==="ff"?m:m+b}static toHSLA(e){let t=0,a=0,s=0,i=1;const n=e.replace("#","");n.length===3||n.length===4?(t=parseInt(n[0]+n[0],16),a=parseInt(n[1]+n[1],16),s=parseInt(n[2]+n[2],16),n.length===4&&(i=parseInt(n[3]+n[3],16)/255)):(n.length===6||n.length===8)&&(t=parseInt(n.substring(0,2),16),a=parseInt(n.substring(2,4),16),s=parseInt(n.substring(4,6),16),n.length===8&&(i=parseInt(n.substring(6,8),16)/255)),t/=255,a/=255,s/=255;const l=Math.max(t,a,s),u=Math.min(t,a,s);let v=0,h=0,g=(l+u)/2;if(l!==u){const x=l-u;switch(h=g>.5?x/(2-l-u):x/(l+u),l){case t:v=(a-s)/x+(a<s?6:0);break;case a:v=(s-t)/x+2;break;case s:v=(t-a)/x+4;break}v/=6}return{h:Math.round(v*360),s:Math.round(h*100),l:Math.round(g*100),a:parseFloat(i.toFixed(2))}}static adjustBrightness(e,t){const a=this.toHSLA(e);return a.l=Math.max(0,Math.min(100,a.l+t*100)),this.toHex(a)}static adjustSaturation(e,t){const a=this.toHSLA(e);return a.s=Math.max(0,Math.min(100,a.s+t*100)),this.toHex(a)}static adjustOpacity(e,t){const a=this.toHSLA(e);return a.a=Math.max(0,Math.min(1,t)),this.toHex(a)}static mix(e,t,a=.5){const s=this.hexToRgb(e),i=this.hexToRgb(t),n={r:Math.round(s.r*(1-a)+i.r*a),g:Math.round(s.g*(1-a)+i.g*a),b:Math.round(s.b*(1-a)+i.b*a),a:s.a*(1-a)+i.a*a};return this.rgbToHex(n.r,n.g,n.b,n.a)}static rgbaCache=new Map;static toRGBA(e){if(this.rgbaCache.has(e))return this.rgbaCache.get(e);const{r:t,g:a,b:s,a:i}=this.hexToRgb(e),n=new Uint8ClampedArray([t,a,s,Math.round(i*255)]);return this.rgbaCache.set(e,n),n}static hexToUint32(e){if(!e)return 0;const{r:t,g:a,b:s,a:i}=this.hexToRgb(e);return(Math.round(i*255)<<24|s<<16|a<<8|t)>>>0}static uint32ToHex(e){if(e===0)return null;const t=e&255,a=e>>8&255,s=e>>16&255,i=e>>24&255;return this.rgbToHex(t,a,s,i/255)}static hexToRgb(e){const t=e.replace("#","");let a=0,s=0,i=0,n=1;return(t.length===6||t.length===8)&&(a=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16),t.length===8&&(n=parseInt(t.substring(6,8),16)/255)),{r:a,g:s,b:i,a:n}}static rgbToHex(e,t,a,s){const i=u=>Math.round(u).toString(16).padStart(2,"0"),n=Math.round(s*255).toString(16).padStart(2,"0"),l=`#${i(e)}${i(t)}${i(a)}`;return n==="ff"?l:l+n}}class ni{#e=K(()=>r.studio.isHandToolActive||rt.activeKeys.includes("q")?{type:"PAN",label:A({key:"labels.PAN_VIEWPORT"}),icon:"🤚",color:"var(--color-brand)",isPulse:!1}:Oa.isActive?{type:"FLOW",label:A({key:"timeline.mode_labels.brewing"}),icon:"📑",color:"var(--color-brand)",isPulse:!0}:r.isPicking?{type:"PICK",label:A({key:"timeline.mode_labels.tasting"}),icon:"📍",color:"var(--color-brand)",isPulse:!0}:rt.isCtrlActive&&rt.isShiftActive||r.studio.activeTool==="ERASER"?{type:"ERASE",label:A({key:"timeline.mode_labels.clearing"}),icon:"🧹",color:"var(--color-brand)",isPulse:!0}:rt.isShiftActive||r.studio.activeTool==="SELECT"?{type:"SELECT",label:A({key:"timeline.mode_labels.selecting"}),icon:"✨",color:"var(--color-brand)",isPulse:!0}:rt.isCtrlActive||r.studio.isShadingLighten||r.studio.isShadingDarken||r.studio.isShadingDither?{type:"PAINT",label:A({key:"timeline.mode_labels.pouring"}),icon:"☕",color:"var(--color-green-leaves)",isPulse:!0}:{type:"READY",label:A({key:"timeline.mode_labels.ready"}),icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return o(this.#e)}set current(e){w(this.#e,e)}}const Fe=new ni;class li{draw(e,t){const a=e!==void 0?Math.floor(e):r.cursor.pos.x,s=t!==void 0?Math.floor(t):r.cursor.pos.y,i=[],n=new Uint32Array(r.canvas.pixels);if(r.studio.isPatternBrushActive&&r.studio.patternBrushData){const l=r.studio.patternBrushData,u=Math.floor(l.width/2),v=Math.floor(l.height/2);for(let h=0;h<l.height;h++)for(let g=0;g<l.width;g++){const x=a+g-u,b=s+h-v;if(r.canvas.isValidCoord(x,b)){const m=h*l.width+g,_=l.data[m];if(_===0)continue;const y=r.canvas.getIndex(x,b);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(y)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(y))continue;const I=Fe.current.type==="ERASE"?0:_,G=n[y];G!==I&&(i.push({index:y,oldColor:ne.uint32ToHex(G),newColor:ne.uint32ToHex(I)}),n[y]=I)}}}else{const u=Ta.getKernel(r.studio.brushSize,r.studio.brushShape).map(h=>({x:a+h.x,y:s+h.y}));if(r.studio.symmetryMode!=="OFF"){const h=r.studio.symmetryMode,{width:g,height:x}=r.canvas,b=[];u.forEach(m=>{const _=nt.getSymmetryPoints(m.x,m.y,g,x,h);b.push(..._)}),u.push(...b)}let v=r.studio.isTilingEnabled?u.map(h=>nt.wrap(h.x,h.y,r.canvas.width,r.canvas.height)):u.filter(h=>r.canvas.isValidCoord(h.x,h.y));if(r.studio.isAirbrushActive){const h=r.studio.airbrushDensity;v=v.filter(()=>Math.random()<h)}v.forEach(h=>{const g=r.canvas.getIndex(h.x,h.y);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(g)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(g)||r.studio.isColorLocked&&r.studio.colorLockSource!==null&&n[g]!==ne.hexToUint32(r.studio.colorLockSource))return;const x=this.getEffectColorForPoint(h.x,h.y,n[g]),b=n[g];b!==x&&(i.push({index:g,oldColor:ne.uint32ToHex(b),newColor:ne.uint32ToHex(x)}),n[g]=x)})}i.length>0&&(r.canvas.pixels=n,r.canvas.triggerPulse(),ce.push(i),Fe.current.type==="ERASE"?Z.playErase():Z.playDraw())}erase(e,t){const a=e!==void 0?Math.floor(e):r.cursor.pos.x,s=t!==void 0?Math.floor(t):r.cursor.pos.y,n=Ta.getKernel(r.studio.brushSize,r.studio.brushShape).map(h=>({x:a+h.x,y:s+h.y}));if(r.studio.symmetryMode!=="OFF"){const h=r.studio.symmetryMode,{width:g,height:x}=r.canvas,b=[];n.forEach(m=>{const _=nt.getSymmetryPoints(m.x,m.y,g,x,h);b.push(..._)}),n.push(...b)}const l=r.studio.isTilingEnabled?n.map(h=>nt.wrap(h.x,h.y,r.canvas.width,r.canvas.height)):n.filter(h=>r.canvas.isValidCoord(h.x,h.y)),u=[],v=new Uint32Array(r.canvas.pixels);l.forEach(h=>{const g=r.canvas.getIndex(h.x,h.y);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(g)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(g))return;const x=v[g];x!==0&&(u.push({index:g,oldColor:ne.uint32ToHex(x),newColor:null}),v[g]=0)}),u.length>0&&(r.canvas.pixels=v,r.canvas.triggerPulse(),ce.push(u),Z.playErase())}getEffectColorForPoint(e,t,a){if(Fe.current.type==="ERASE")return 0;const s=r.paletteState.activeColor,i=ne.hexToUint32(s);if(r.studio.isShadingDither)return(e+t)%2===0?i:0;if(a===0)return i;if(r.studio.isShadingLighten){const n=ne.uint32ToHex(a);return ne.hexToUint32(ne.adjustBrightness(n,.1))}if(r.studio.isShadingDarken){const n=ne.uint32ToHex(a);return ne.hexToUint32(ne.adjustBrightness(n,-.1))}return i}beginStroke(e,t){r.canvas.clearBuffer(),r.canvas.addToBuffer(e,t)}continueStroke(e,t,a,s){const i=Ze.getLinePoints(a,s,e,t,0);if(r.studio.isPixelPerfect){const n=[...r.canvas.strokePoints,...i],l=nt.pixelPerfectFilter(n);r.canvas.clearBuffer(),r.canvas.addBatchToBuffer(l)}else r.canvas.addBatchToBuffer(i)}endStroke(){this.commitBuffer()}cancelStroke(){r.canvas.clearBuffer(),Z.playErase()}snapCurrentStroke(){const e=r.canvas.strokePoints;if(e.length<5)return;const t=r.studio.stabilization,a=Xa.smooth(e,t/10),s=.05+t/100*.35,i=Ze.fitArc(a,s);r.canvas.clearBuffer();let n=[],l=[];if(i&&i.isFull)l=i.points,n=Ze.getCirclePoints(i.cx,i.cy,i.r);else{const u=Xa.simplify(a,t/100*2);if(u.length===2){let v={...u[0]},h={...u[u.length-1]};const g=Math.abs(h.x-v.x),x=Math.abs(h.y-v.y),b=3;if(g<b)h.x=v.x;else if(x<b)h.y=v.y;else if(Math.abs(g-x)<b){const m=Math.max(g,x);h.x=v.x+m*Math.sign(h.x-v.x),h.y=v.y+m*Math.sign(h.y-v.y)}l=[v,h],n=Ze.getLinePoints(v.x,v.y,h.x,h.y,0)}else if(i){l=i.points;for(let v=0;v<l.length-1;v++)n.push(...Ze.getLinePoints(l[v].x,l[v].y,l[v+1].x,l[v+1].y,t/100))}else{l=u;for(let v=0;v<l.length-1;v++)n.push(...Ze.getLinePoints(l[v].x,l[v].y,l[v+1].x,l[v+1].y,t/100))}}r.canvas.addBatchToBuffer(n),r.canvas.strokePoints=l,Z.playDraw()}commitBuffer(){const e=r.canvas.pixelBuffer;if(e.length===0){r.canvas.clearBuffer();return}const t=[],a=new Uint32Array(r.canvas.pixels);if(r.studio.isPatternBrushActive&&r.studio.patternBrushData){const s=r.studio.patternBrushData,i=Math.floor(s.width/2),n=Math.floor(s.height/2);e.forEach(l=>{const u=l%r.canvas.width,v=Math.floor(l/r.canvas.width);for(let h=0;h<s.height;h++)for(let g=0;g<s.width;g++){const x=u+g-i,b=v+h-n;if(r.canvas.isValidCoord(x,b)){const m=h*s.width+g,_=s.data[m];if(_===0)continue;const y=r.canvas.getIndex(x,b);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(y)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(y))continue;const I=Fe.current.type==="ERASE"?0:_,G=a[y];G!==I&&(t.push({index:y,oldColor:ne.uint32ToHex(G),newColor:ne.uint32ToHex(I)}),a[y]=I)}}})}else{const s=Ta.getKernel(r.studio.brushSize,r.studio.brushShape);e.forEach(i=>{const n=i%r.canvas.width,l=Math.floor(i/r.canvas.width),u=s.map(h=>({x:n+h.x,y:l+h.y}));if(r.studio.symmetryMode!=="OFF"){const h=r.studio.symmetryMode,{width:g,height:x}=r.canvas,b=[];u.forEach(m=>{const _=nt.getSymmetryPoints(m.x,m.y,g,x,h);b.push(..._)}),u.push(...b)}(r.studio.isTilingEnabled?u.map(h=>nt.wrap(h.x,h.y,r.canvas.width,r.canvas.height)):u.filter(h=>r.canvas.isValidCoord(h.x,h.y))).forEach(h=>{const g=r.canvas.getIndex(h.x,h.y);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(g)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(g))return;const x=this.getEffectColorForPoint(h.x,h.y,a[g]),b=a[g];b!==x&&(t.push({index:g,oldColor:ne.uint32ToHex(b),newColor:ne.uint32ToHex(x)}),a[g]=x)})})}t.length>0&&(r.canvas.pixels=a,r.canvas.triggerPulse(),ce.push(t),Fe.current.type==="ERASE"?Z.playErase():Z.playDraw()),r.canvas.clearBuffer()}commitShape(){const e=r.studio.shapeAnchor;if(!e)return;const{x:t,y:a}=r.cursor.pos,s=r.studio.activeTool;if(s==="GRADIENT"){const n=r.studio.gradientStartColor,l=r.paletteState.activeColor;if(!n)return;const u=r.selection.isActive?r.selection.indices:Array.from({length:r.canvas.width*r.canvas.height},(x,b)=>b),v=nt.getLinearGradientMap(e.x,e.y,t,a,u,r.canvas.width),h=new Uint32Array(r.canvas.pixels),g=[];v.forEach(x=>{const b=ne.mix(n,l,x.ratio),m=ne.hexToUint32(b),_=h[x.index];_!==m&&(g.push({index:x.index,oldColor:ne.uint32ToHex(_),newColor:b}),h[x.index]=m)}),g.length>0&&(r.canvas.pixels=h,r.canvas.triggerPulse(),ce.push(g),Z.playDraw()),r.studio.activeTool="BRUSH",r.studio.shapeAnchor=null,r.studio.gradientStartColor=null;return}let i=[];if(s==="RECTANGLE"?i=nt.getRectanglePoints(e.x,e.y,t,a):s==="ELLIPSE"?i=nt.getEllipsePoints(e.x,e.y,t,a):s==="POLYGON"&&(i=nt.getPolygonPoints(e.x,e.y,t,a,r.studio.polygonSides,r.studio.polygonIndentation)),i.length>0){const n=r.paletteState.activeColor,l=ne.hexToUint32(n),u=[],v=new Uint32Array(r.canvas.pixels);i.forEach(h=>{if(r.canvas.isValidCoord(h.x,h.y)){const g=r.canvas.getIndex(h.x,h.y),x=v[g];x!==l&&(u.push({index:g,oldColor:ne.uint32ToHex(x),newColor:n}),v[g]=l)}}),u.length>0&&(r.canvas.pixels=v,r.canvas.triggerPulse(),ce.push(u),Z.playDraw())}r.studio.activeTool="BRUSH",r.studio.shapeAnchor=null}}class ci{resize(e,t){const a=new Uint32Array(e*t),s=ne.hexToUint32(r.backgroundColor);a.fill(s);for(let i=0;i<Math.min(r.canvas.height,t);i++)for(let n=0;n<Math.min(r.canvas.width,e);n++){const l=i*r.canvas.width+n,u=i*e+n;a[u]=r.canvas.pixels[l]}r.canvas.reset(e,t,a),ce.clear(),Z.playDraw()}flip(e){const{width:t,height:a}=r.canvas,s=r.project.activeFrame;ce.beginBatch(),s.layers.forEach(i=>{if(i.type!=="LAYER")return;const n=i.pixels,l=new Uint32Array(n.length);if(e==="horizontal")for(let u=0;u<a;u++){const v=u*t,h=n.subarray(v,v+t),g=new Uint32Array(h).reverse();l.set(g,v)}else for(let u=0;u<a;u++){const v=u*t,h=(a-1-u)*t;l.set(n.subarray(v,v+t),h)}i.pixels=l}),r.canvas.triggerPulse(),ce.endBatch(),r.studio.show(e==="horizontal"?"Flipped Horizontally":"Flipped Vertically"),Z.playDraw()}rotate(){const{width:e,height:t}=r.canvas;if(e!==t){r.studio.show("Only square cups can be rotated");return}const a=r.project.activeFrame;ce.beginBatch(),a.layers.forEach(s=>{if(s.type!=="LAYER")return;const i=s.pixels,n=new Uint32Array(e*t);for(let l=0;l<t;l++)for(let u=0;u<e;u++){const v=l*e+u,h=u*e+(t-1-l);n[h]=i[v]}s.pixels=n}),r.canvas.triggerPulse(),ce.endBatch(),r.studio.show("Rotated 90°"),Z.playDraw()}clearAll(){confirm("Are you sure you want to clear the entire canvas?")&&(r.canvas.clear(),ce.clear(),r.studio.show("Foam Cleared"),Z.playErase())}bleach(){const{x:e,y:t}=r.cursor.pos,a=r.canvas.getColor(e,t),s=ne.hexToUint32(r.activeColor);if(a===s)return;const{pixels:i}=r.canvas,n=[],l=r.selection.isActive,u=r.selection.activeIndicesSet,v=new Uint32Array(i);i.forEach((h,g)=>{const x=h===a,b=!l||u.has(g);x&&b&&(n.push({index:g,oldColor:ne.uint32ToHex(a),newColor:ne.uint32ToHex(s)}),v[g]=s)}),n.length>0&&(r.canvas.pixels=v,r.canvas.triggerPulse(),ce.beginBatch(),n.forEach(h=>ce.push(h)),ce.endBatch(),Z.playDraw())}}class di{copy(){const e=r.canvas.width,t=r.selection.getPoints(e),a=r.selection.getEffectiveBounds(e);if(!a||t.length===0)return;const s=new Uint32Array(a.width*a.height),i=r.canvas.compositePixels;t.forEach(n=>{const l=n.y*e+n.x,u=n.x-a.x1,h=(n.y-a.y1)*a.width+u;s[h]=i[l]}),r.project.clipboard={width:a.width,height:a.height,data:s},Z.playDraw()}cut(){this.copy();const e=r.canvas.width,t=r.selection.getPoints(e);if(t.length===0)return;ce.beginBatch();const a=new Uint32Array(r.canvas.pixels);t.forEach(s=>{const i=s.y*e+s.x,n=a[i];ce.push({index:i,oldColor:ne.uint32ToHex(n),newColor:null}),a[i]=0}),r.canvas.pixels=a,r.canvas.triggerPulse(),ce.endBatch(),Z.playErase(),r.selection.clear()}paste(){const e=r.project.clipboard;if(!e)return;const{x:t,y:a}=r.cursor.pos,{width:s,height:i}=r.canvas;ce.beginBatch();const n=new Uint32Array(r.canvas.pixels);let l=!1;for(let u=0;u<e.height;u++)for(let v=0;v<e.width;v++){const h=t+v,g=a+u;if(h>=0&&h<s&&g>=0&&g<i){const x=u*e.width+v,b=e.data[x];if(b!==0){const m=g*s+h,_=n[m];ce.push({index:m,oldColor:ne.uint32ToHex(_),newColor:ne.uint32ToHex(b)}),n[m]=b,l=!0}}}l&&(r.canvas.pixels=n,r.canvas.triggerPulse(),Z.playDraw()),ce.endBatch()}}class ui{serialize(){return JSON.stringify({version:r.version,metadata:{name:"Untitled Project",lastModified:new Date().toISOString()},palette:r.paletteState.swatches,project:{frames:r.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,layers:e.layers.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,type:t.type,parentId:t.parentId,isCollapsed:t.isCollapsed,pixels:Array.from(t.pixels)}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,r.project.currentFilePath||void 0);t&&(r.project.setMetadata(t),Z.playDraw())}webDownload(e){const t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="rupa-project.rupa",s.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),r.project.setMetadata(e.filePath),Z.playDraw())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const a=t.target.files?.[0];if(a){const s=new FileReader;s.onload=i=>this.deserialize(i.target?.result),s.readAsText(a)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),r.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}autoSaveSession(){try{const e=this.serialize();localStorage.setItem("rupa_autosave_session",e),r.project.lastSaved=new Date,console.log("Session autosaved.")}catch(e){console.warn("Autosave failed (likely quota exceeded):",e)}}restoreLastSession(){const e=localStorage.getItem("rupa_autosave_session");return e?(this.deserialize(e),!0):!1}deserialize(e){try{const t=JSON.parse(e);t.palette&&(r.paletteState.swatches=t.palette);const a=t.project||t.folio;if(a)r.project.frames=a.frames.map(s=>{const i=new ua(s.name,s.width,s.height),n=s.layers||s.veils||[];return i.layers=n.map(l=>{const u=new Ut(l.name,s.width,s.height,l.type||"LAYER");u.isVisible=l.isVisible,u.isLocked=l.isLocked,u.parentId=l.parentId||null,u.isCollapsed=l.isCollapsed||!1;const v=l.pixels||l.stitches||[];if(u.type==="LAYER")if(v.length>0&&typeof v[0]=="string"){const h=new Uint32Array(v.length);for(let g=0;g<v.length;g++)h[g]=ne.hexToUint32(v[g]);u.pixels=h}else u.pixels=new Uint32Array(v);return u}),i});else if(t.pixelData){const s=new ua("Restored Project",t.dimensions.width,t.dimensions.height),i=new Uint32Array(t.pixelData.length);for(let n=0;n<t.pixelData.length;n++)i[n]=ne.hexToUint32(t.pixelData[n]);s.layers[0].pixels=i,r.project.frames=[s]}r.project.activeFrameIndex=0,r.canvas.triggerPulse(),ce.clear()}catch(t){console.error("Failed to restore project:",t)}}}class vi{addFrame(e){const t=r.project,a=t.activeFrameIndex,s=t.addFrame(e),i=t.activeFrameIndex;return ce.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(i,1),t.activeFrameIndex=a},redo:()=>{t.frames.splice(i,0,s),t.activeFrameIndex=i}}),Z.playDraw(),s}removeFrame(e){const t=r.project;if(t.frames.length<=1)return;const a=t.frames[e],s=t.activeFrameIndex;t.removeFrame(e);const i=t.activeFrameIndex;ce.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,a),t.activeFrameIndex=s},redo:()=>{t.removeFrame(e),t.activeFrameIndex=i}}),Z.playErase()}duplicateFrame(e){const t=r.project,a=t.frames[e],s=t.activeFrameIndex,i=t.addFrame(`${a.name} (Copy)`),n=t.activeFrameIndex;i.width=a.width,i.height=a.height,i.duration=a.duration,i.layers=a.layers.map(l=>l.clone(a.width,a.height)),ce.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(n,1),t.activeFrameIndex=s},redo:()=>{t.frames.splice(n,0,i),t.activeFrameIndex=n}}),Z.playDraw()}nextFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,ce.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),Z.playMove()}prevFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,ce.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),Z.playMove()}addLayer(e){const t=r.project.activeFrame,a=t.activeLayerIndex,s=t.addLayer(e),i=t.activeLayerIndex;return ce.push({isStructural:!0,label:"Add Layer",undo:()=>{t.layers.splice(i,1),t.activeLayerIndex=a},redo:()=>{t.layers.splice(i,0,s),t.activeLayerIndex=i}}),Z.playDraw(),s}addGroup(e){const t=r.project.activeFrame,a=t.activeLayerIndex,s=t.addGroup(e),i=t.activeLayerIndex;return ce.push({isStructural:!0,label:"Add Group",undo:()=>{t.layers.splice(i,1),t.activeLayerIndex=a},redo:()=>{t.layers.splice(i,0,s),t.activeLayerIndex=i}}),Z.playDraw(),s}removeLayer(e){const t=r.project.activeFrame;if(t.layers.length<=1)return;const a=t.layers[e],s=t.activeLayerIndex;t.removeLayer(e);const i=t.activeLayerIndex;ce.push({isStructural:!0,label:"Remove Layer",undo:()=>{t.layers.splice(e,0,a),t.activeLayerIndex=s},redo:()=>{t.removeLayer(e),t.activeLayerIndex=i}}),Z.playErase()}duplicateLayer(e){const t=r.project.activeFrame,a=t.layers[e],s=t.activeLayerIndex,i=a.clone(t.width,t.height);i.name=`${a.name} (Copy)`;const n=e+1;t.layers.splice(n,0,i),t.activeLayerIndex=n,ce.push({isStructural:!0,label:"Duplicate Layer",undo:()=>{t.layers.splice(n,1),t.activeLayerIndex=s},redo:()=>{t.layers.splice(n,0,i),t.activeLayerIndex=n}}),Z.playDraw()}nextLayer(){const e=r.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex+1)%e.layers.length,ce.push({isStructural:!0,label:"Next Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t+1)%e.layers.length}),Z.playMove()}prevLayer(){const e=r.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex-1+e.layers.length)%e.layers.length,ce.push({isStructural:!0,label:"Prev Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t-1+e.layers.length)%e.layers.length}),Z.playMove()}toggleLock(e){const t=e!==void 0?r.project.activeFrame.layers[e]:r.project.activeFrame.activeLayer;t&&(t.isLocked=!t.isLocked,Z.playDraw())}toggleVisibility(e){const t=e!==void 0?r.project.activeFrame.layers[e]:r.project.activeFrame.activeLayer;t&&(t.isVisible=!t.isVisible,Z.playDraw())}reorderLayer(e,t){const a=r.project.activeFrame;if(e===t||t<0||t>=a.layers.length)return;const s=a.activeLayerIndex;((l,u)=>{const[v]=a.layers.splice(l,1);a.layers.splice(u,0,v),a.activeLayerIndex===l?a.activeLayerIndex=u:l<a.activeLayerIndex&&u>=a.activeLayerIndex?a.activeLayerIndex--:l>a.activeLayerIndex&&u<=a.activeLayerIndex&&a.activeLayerIndex++})(e,t);const n=a.activeLayerIndex;ce.push({isStructural:!0,label:"Reorder Layer",undo:()=>{const[l]=a.layers.splice(t,1);a.layers.splice(e,0,l),a.activeLayerIndex=s},redo:()=>{const[l]=a.layers.splice(e,1);a.layers.splice(t,0,l),a.activeLayerIndex=n}}),Z.playMove()}reorderFrame(e,t){const a=r.project;if(e===t||t<0||t>=a.frames.length)return;const s=a.activeFrameIndex;((l,u)=>{const[v]=a.frames.splice(l,1);a.frames.splice(u,0,v),a.activeFrameIndex===l?a.activeFrameIndex=u:l<a.activeFrameIndex&&u>=a.activeFrameIndex?a.activeFrameIndex--:l>a.activeFrameIndex&&u<=a.activeFrameIndex&&a.activeFrameIndex++})(e,t);const n=a.activeFrameIndex;ce.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[l]=a.frames.splice(t,1);a.frames.splice(e,0,l),a.activeFrameIndex=s},redo:()=>{const[l]=a.frames.splice(e,1);a.frames.splice(t,0,l),a.activeFrameIndex=n}}),Z.playMove()}moveLayerUp(){const e=r.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,t+1)}moveLayerDown(){const t=r.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,t-1)}moveLayerToTop(){const e=r.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,e.layers.length-1)}moveLayerToBottom(){const t=r.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,0)}mergeLayerDown(){const e=r.project.activeFrame,t=e.activeLayerIndex;if(t<=0)return;const a=t-1,s=e.layers[t],i=e.layers[a],n=new Uint32Array(i.pixels),l=s.pixels,u=new Uint32Array(i.pixels);for(let v=0;v<l.length;v++){const h=l[v];h!==0&&(u[v]=h)}i.pixels=u,e.layers.splice(t,1),e.activeLayerIndex=a,r.canvas.triggerPulse(),ce.push({isStructural:!0,label:"Merge Layer",undo:()=>{i.pixels=n,e.layers.splice(t,0,s),e.activeLayerIndex=t,r.canvas.triggerPulse()},redo:()=>{i.pixels=u,e.layers.splice(t,1),e.activeLayerIndex=a,r.canvas.triggerPulse()}}),Z.playDraw()}addTag(e,t,a,s="#d33682"){const i={id:crypto.randomUUID(),name:e,color:s,from:t,to:a};return r.project.tags.push(i),Z.playDraw(),i}removeTag(e){r.project.tags=r.project.tags.filter(t=>t.id!==e),Z.playErase()}}class hi{begin(e,t){r.selection.begin(e,t)}update(e,t){r.selection.isActive&&r.selection.update(e,t)}clear(){r.selection.clear()}fillSelection(){const e=r.selection.getPoints(r.canvas.width);if(e.length===0)return;const t=r.paletteState.activeColor,a=ne.hexToUint32(t),s=r.canvas.width;ce.beginBatch();let i=!1;const n=new Uint32Array(r.canvas.pixels);e.forEach(l=>{const u=l.y*s+l.x,v=n[u];v!==a&&(ce.push({index:u,oldColor:ne.uint32ToHex(v),newColor:t}),n[u]=a,i=!0)}),i&&(r.canvas.pixels=n,r.canvas.triggerPulse(),Z.playDraw()),ce.endBatch()}commit(){r.canvas.triggerPulse()}spiritPick(){const{x:e,y:t}=r.cursor.pos;r.canvas.getColor(e,t);const{width:a,height:s,pixels:i}=r.canvas,n=4294967295,l=nt.floodFill(Array.from(i),a,s,e,t,n),u=[];for(let v=0;v<l.length;v++)l[v]===n&&u.push(v);r.selection.clear(),u.length>0&&(r.selection.indices=u,r.canvas.triggerPulse(),Z.playScale(4))}addVertex(e,t){r.selection.vertices.push({x:e,y:t}),Z.playDraw()}sealBinding(){const e=r.selection.vertices;if(e.length<3)return;const t=r.canvas.width,a=r.canvas.height,s=[];for(let i=0;i<a;i++)for(let n=0;n<t;n++)this.isPointInPoly(n,i,e)&&s.push(i*t+n);s.length>0&&(r.selection.indices=s,r.selection.vertices=[],Z.playScale(6))}isPointInPoly(e,t,a){let s=!1;for(let i=0,n=a.length-1;i<a.length;n=i++){const l=a[i].x,u=a[i].y,v=a[n].x,h=a[n].y;u>t!=h>t&&e<(v-l)*(t-u)/(h-u)+l&&(s=!s)}return s}nudge(e,t){if(r.selection.indices.length===0)return;const a=r.canvas.width,s=r.canvas.height,i=new Uint32Array(r.canvas.pixels),n=new Map;r.selection.indices.forEach(u=>{n.set(u,i[u]),i[u]=0});const l=[];n.forEach((u,v)=>{const h=v%a,g=Math.floor(v/a),x=h+e,b=g+t;if(x>=0&&x<a&&b>=0&&b<s){const m=b*a+x;i[m]=u,l.push(m)}}),r.canvas.pixels=i,r.canvas.triggerPulse(),r.selection.indices=l,Z.playMove()}propagate(e,t,a){if(r.selection.indices.length===0)return;const s=r.project,i=s.activeFrameIndex,n=s.activeFrame.activeLayerIndex,l=r.canvas.width,u=r.canvas.height,v=s.activeFrame.activeLayer,h=[];r.selection.indices.forEach(m=>{h.push({x:m%l,y:Math.floor(m/l),val:v.pixels[m]})});const g=new Map,x=new Map;for(let m=1;m<=e;m++){const _=i+m;if(_>=s.frames.length)break;const y=s.frames[_].layers[n];if(!y||y.isLocked)continue;g.set(_,new Uint32Array(y.pixels));const E=new Uint32Array(y.pixels),I=t*m,G=a*m;h.forEach(j=>{const B=j.x+I,U=j.y+G;B>=0&&B<l&&U>=0&&U<u&&(E[U*l+B]=j.val)}),x.set(_,E)}const b=m=>{m.forEach((_,y)=>{const E=s.frames[y].layers[n];E&&(E.pixels=_)}),r.canvas.triggerPulse()};b(x),ce.push({isStructural:!0,label:"Syrup Flow",undo:()=>b(g),redo:()=>b(x)}),Z.playDraw(),r.studio.show(`Poured across ${x.size} cups`)}}class pi{select(e){r.paletteState.select(e),Z.playScale(e)}setColor(e){r.paletteState.setColor(e),Z.playDraw()}pickFromCanvas(){const{x:e,y:t}=r.cursor.pos,a=r.canvas.getColor(e,t),s=ne.uint32ToHex(a);s!==null&&(this.setColor(s),r.studio.isPicking=!0,setTimeout(()=>{r.studio.isPicking=!1},1500))}weatherPalette(e){r.paletteState.swatches=r.paletteState.swatches.map(t=>ne.adjustBrightness(t,e)),Z.playDraw()}mixActiveColor(e,t=.5){const a=ne.mix(r.activeColor,e,t);this.setColor(a)}floodFill(){const{x:e,y:t}=r.cursor.pos,a=r.canvas.getColor(e,t),s=r.activeColor,i=ne.hexToUint32(s);if(a===i)return;const{width:n,height:l,pixels:u}=r.canvas,v=nt.floodFill(Array.from(u),n,l,e,t,i),h=new Uint32Array(v),g=[],x=r.selection.isActive,b=r.selection.activeIndicesSet;for(let m=0;m<h.length;m++)if(h[m]!==u[m]){if(x&&!b.has(m)){h[m]=u[m];continue}g.push({index:m,oldColor:ne.uint32ToHex(u[m]),newColor:s})}g.length>0&&(r.canvas.pixels=h,r.canvas.triggerPulse(),ce.beginBatch(),g.forEach(m=>ce.push(m)),ce.endBatch(),Z.playDraw())}}class fi{_movement=null;_draw=null;_manipulation=null;_clipboard=null;_persistence=null;_project=null;_selection=null;_color=null;get movement(){return this._movement||(this._movement=new Ys),this._movement}get draw(){return this._draw||(this._draw=new li),this._draw}get manipulation(){return this._manipulation||(this._manipulation=new ci),this._manipulation}get clipboard(){return this._clipboard||(this._clipboard=new di),this._clipboard}get persistence(){return this._persistence||(this._persistence=new ui),this._persistence}get project(){return this._project||(this._project=new vi),this._project}get selection(){return this._selection||(this._selection=new hi),this._selection}get color(){return this._color||(this._color=new pi),this._color}moveCursor(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}jumpHome(){this.movement.jumpHome()}paint(){this.draw.draw()}erase(){this.draw.erase()}pickColor(){this.color.pickFromCanvas()}startSelection(){this.selection.begin(r.cursor.pos.x,r.cursor.pos.y)}updateSelection(){this.selection.update(r.cursor.pos.x,r.cursor.pos.y)}commitSelection(){this.selection.fillSelection()}clearCanvas(){this.manipulation.clearAll()}resizeCanvas(e,t){this.manipulation.resize(e,t)}flipCanvas(e){this.manipulation.flip(e)}rotateCanvas(){this.manipulation.rotate()}mergeLayerDown(){this.project.mergeLayerDown()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),r.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async createArtifact(e,t=10,a="transparent"){r.studio.show("Preparing Cup...");const{ExportEngine:s}=await ls(async()=>{const{ExportEngine:g}=await import("./Bhn0297J.js");return{ExportEngine:g}},__vite__mapDeps([0,1,2,3]),import.meta.url),{width:i,height:n,compositePixels:l}=r.canvas,u=r.studio.includePixelBorders,v=["webm","gif","mp4"].includes(e),h=r.project.frames.length<=1&&v?"png":e;if(h==="svg")if(r.project.frames.length>1){const g=r.project.frames.map(_=>_.compositePixels),x=r.project.frames.map(_=>_.duration),b=s.toAnimatedSVG(i,n,g,x,a,u),m=new Blob([b],{type:"image/svg+xml"});this.download(URL.createObjectURL(m),"rupa-image.svg")}else{const g=s.toSVG(i,n,l,a,u),x=new Blob([g],{type:"image/svg+xml"});this.download(URL.createObjectURL(x),"rupa-image.svg")}else if(h==="webm"||h==="mp4"){const g=r.project.frames.map(_=>_.compositePixels),x=r.project.frames.map(_=>_.duration),b=await s.toVideo(i,n,g,x,t,h,a,u),m=b.type.includes("mp4")?"mp4":"webm";this.download(URL.createObjectURL(b),`rupa-video.${m}`)}else if(h==="gif"){const g=r.project.frames.map(m=>m.compositePixels),x=r.project.frames.map(m=>m.duration),b=await s.toGIF(i,n,g,x,t,a,u);this.download(URL.createObjectURL(b),"rupa-animation.gif")}else{const g=await s.toRaster(i,n,l,t,h,a,u);this.download(g,`rupa-image.${h}`)}r.studio.showExportMenu=!1}download(e,t){const a=document.createElement("a");a.href=e,a.download=t.toLowerCase().replace(/\s+/g,"-"),a.click()}}const V=new fi;class gi{#e=C("KEYBOARD");get activeSource(){return o(this.#e)}set activeSource(e){w(this.#e,e,!0)}listeners=[];constructor(){}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}emit(e,t,a){this.activeSource=t;const s={intent:e,source:t,meta:a};this.listeners.forEach(i=>i(s))}mount(e,t){const a=i=>{if(!r.isAppReady)return;const n=i.target;if((n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement||n.isContentEditable)&&i.key!=="Escape")return;rt.updatePhysicalState(i,"down");const l=rt.getIntent(i);l&&(i.preventDefault(),this.emit(l,"KEYBOARD"))},s=i=>{rt.updatePhysicalState(i,"up")};if(t){const i=u=>{const v=u.pointerType==="pen"?"PEN":u.pointerType==="touch"?"TOUCH":"MOUSE";xt.handleStart(u,t),this.activeSource=v},n=u=>{xt.handleMove(u,t)},l=u=>{xt.handleEnd()};t.addEventListener("pointerdown",i),e.addEventListener("pointermove",n),e.addEventListener("pointerup",l)}return e.addEventListener("keydown",a),e.addEventListener("keyup",s),()=>{e.removeEventListener("keydown",a),e.removeEventListener("keyup",s)}}}const Wa=new gi;class xi{isPlaying=!1;nextNoteTime=0;timer=null;get ctx(){return Ga.ctx}scale=It.ambient.scale;chords=It.ambient.chords;currentChordIndex=0;toggle(){this.isPlaying?this.stop():this.start()}start(){this.isPlaying||(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||r.studio.isMuted||!r.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){const t=this.chords[this.currentChordIndex],s=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(s,e),this.pianoPluck(s*2,e,.08),Math.random()>.7&&this.pianoPluck(s*.5,e+.05,.1)}pianoPluck(e,t,a=.3){const{startMins:s,fullMins:i}=It.ambient.fade,n=r.usageMinutes;let l=0;n>=s&&n<i?l=(n-s)/(i-s):n>=i&&(l=1);const u=a*l*r.bgmVolume;if(u<.001)return;const v=this.ctx.createOscillator(),h=this.ctx.createGain(),g=this.ctx.createBiquadFilter();v.type=Math.random()>.5?"sine":"triangle",v.frequency.setValueAtTime(e,t),g.type="lowpass",g.frequency.setValueAtTime(1200,t),g.frequency.exponentialRampToValueAtTime(400,t+1.5),h.gain.setValueAtTime(0,t),h.gain.linearRampToValueAtTime(u,t+.02),h.gain.exponentialRampToValueAtTime(1e-4,t+2.5),v.connect(g),g.connect(h),h.connect(this.ctx.destination),v.start(t),v.stop(t+2.6)}}const mi=new xi;class bi{#e=C(!0);get isEnabled(){return o(this.#e)}set isEnabled(e){w(this.#e,e,!0)}#t=C(!1);get screenShake(){return o(this.#t)}set screenShake(e){w(this.#t,e,!0)}#a=C(null);get flashColor(){return o(this.#a)}set flashColor(e){w(this.#a,e,!0)}emit(e){this.isEnabled&&(this.playAudio(e),this.triggerVisual(e),typeof navigator.vibrate=="function"&&this.triggerHaptic(e))}playAudio(e){switch(e){case"DRAW":Z.playDraw();break;case"ERASE":Z.playErase();break;case"MOVE":Z.playMove();break;case"STARTUP":Z.playStartup();break;case"READY":Z.playReady();break}}triggerVisual(e){e==="CLEAR_CANVAS"&&(this.screenShake=!0,setTimeout(()=>this.screenShake=!1,200)),e==="READY"&&(this.flashColor="rgba(211, 54, 130, 0.1)",setTimeout(()=>this.flashColor=null,500))}triggerHaptic(e){e==="DRAW"&&navigator.vibrate(5),e==="ERASE"&&navigator.vibrate(10)}}const fe=new bi;class yi{backupInterval=null;autoSaveTimer=null;unsubscribeInput=null;mount(e=null){this.backupInterval=setInterval(()=>V.persistence.backup(),600*1e3),r.studio.mount(),r.canvas.mount(),mi.start(),V.persistence.restoreLastSession(),this.unsubscribeInput=Wa.subscribe(a=>{this.handleIntent(a.intent)});const t=Wa.mount(window,e);return()=>{this.unsubscribeInput&&this.unsubscribeInput(),t(),clearInterval(this.backupInterval),this.autoSaveTimer&&clearTimeout(this.autoSaveTimer)}}handleIntent(e){if(Ga.resume(),r.cursor.resetInactivityTimer(),this.resetAutoSaveTimer(),rt.isCtrlActive&&rt.isAltActive&&["MOVE_UP","MOVE_DOWN","MOVE_LEFT","MOVE_RIGHT"].includes(e)){const t=e==="MOVE_LEFT"?-1:e==="MOVE_RIGHT"?1:0,a=e==="MOVE_UP"?-1:e==="MOVE_DOWN"?1:0;r.studio.underlayOffset.x+=t,r.studio.underlayOffset.y+=a;return}switch(e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"JUMP_HOME":return V.jumpHome();case"GOTO":return r.showGoTo=!0;case"RESET_PAN":return r.studio.resetPan(),fe.emit("READY");case"PAINT":if(r.selection.isActive)return V.commitSelection();if(r.studio.activeTool!=="BRUSH"){V.draw.commitShape();return}return V.draw.draw();case"ERASE":return V.draw.erase();case"FLOOD_FILL":return V.color.floodFill();case"BIND_VERTEX":return V.selection.addVertex(r.cursor.pos.x,r.cursor.pos.y);case"SEAL_BINDING":if(r.selection.vertices.length>=3)return V.selection.sealBinding();if(r.selection.isActive)return V.commitSelection();if(r.studio.activeTool!=="BRUSH"){V.draw.commitShape();return}return V.draw.draw();case"PICK_COLOR":return V.color.pickFromCanvas();case"COPY":return V.clipboard.copy();case"CUT":return V.clipboard.cut();case"PASTE":return V.clipboard.paste();case"RECOLOR":return V.manipulation.bleach();case"UNDO":return r.undo();case"REDO":return r.redo();case"SAVE":return r.showPersistenceMenu=!0;case"OPEN":return V.persistence.load();case"OPEN_MENU":return r.showCommandPalette=!r.showCommandPalette;case"OPEN_SETTINGS":return r.showCanvasSettings=!r.showCanvasSettings;case"ESCAPE":return r.handleEscape();case"OPEN_PALETTE":return r.showColorPicker=!r.showColorPicker;case"OPEN_AUDIO":return r.showAudioSettings=!r.showAudioSettings;case"OPEN_EXPORT":return r.showExportMenu=!0;case"OPEN_HELP":return r.showGuideMenu=!0;case"OPEN_MANUAL":return r.showGuideBook=!0;case"PLAY_PAUSE":return Ba.togglePlayback();case"TOGGLE_GHOST_LAYERS":return r.showGhostLayers=!r.showGhostLayers;case"ZOOM_IN":return r.studio.setZoom(.1);case"ZOOM_OUT":return r.studio.setZoom(-.1);case"RESET_ZOOM":return r.studio.resetZoom();case"RESET_VIEWPORT":return r.studio.resetZoom(),r.studio.resetPan(),fe.emit("READY");case"CLEAR_CANVAS":return V.manipulation.clearAll();case"TOGGLE_MUTE":return r.studio.toggleMute();case"TOGGLE_MINIMAP":return r.studio.showMinimap=!r.studio.showMinimap,fe.emit("READY");case"SELECT_SAME":return V.selection.spiritPick();case"FLIP_H":return V.manipulation.flip("horizontal");case"FLIP_V":return V.manipulation.flip("vertical");case"ROTATE":return V.manipulation.rotate();case"TAB_TIMELINE":return r.studio.projectActiveTab="frames",fe.emit("READY");case"TAB_LAYERS":return r.studio.projectActiveTab="layers",fe.emit("READY");case"NEW_ITEM":return r.studio.projectActiveTab==="frames"?V.project.addFrame():V.project.addLayer();case"NEW_LAYER_GROUP":return V.project.addGroup();case"DUPLICATE_ITEM":return r.studio.projectActiveTab==="frames"?V.project.duplicateFrame(r.project.activeFrameIndex):V.project.duplicateLayer(r.project.activeFrame.activeLayerIndex);case"DELETE_ITEM":return r.studio.projectActiveTab==="frames"?V.project.removeFrame(r.project.activeFrameIndex):V.project.removeLayer(r.project.activeFrame.activeLayerIndex);case"TOGGLE_LAYER_LOCK":return V.project.toggleLock();case"TOGGLE_LAYER_VISIBILITY":return V.project.toggleVisibility();case"MOVE_ITEM_UP":if(r.studio.projectActiveTab==="frames"){const s=r.project.activeFrameIndex;s<r.project.frames.length-1&&V.project.reorderFrame(s,s+1)}else V.project.moveLayerUp();return;case"MOVE_ITEM_DOWN":if(r.studio.projectActiveTab==="frames"){const s=r.project.activeFrameIndex;s>0&&V.project.reorderFrame(s,s-1)}else V.project.moveLayerDown();return;case"MOVE_ITEM_TOP":r.studio.projectActiveTab==="frames"?V.project.reorderFrame(r.project.activeFrameIndex,r.project.frames.length-1):V.project.moveLayerToTop();return;case"MOVE_ITEM_BOTTOM":r.studio.projectActiveTab==="frames"?V.project.reorderFrame(r.project.activeFrameIndex,0):V.project.moveLayerToBottom();return;case"MERGE_LAYERS":return V.project.mergeLayerDown();case"BRUSH_SIZE_INC":return r.studio.brushSize=Math.min(100,r.studio.brushSize+1),fe.emit("READY");case"BRUSH_SIZE_DEC":return r.studio.brushSize=Math.max(1,r.studio.brushSize-1),fe.emit("READY");case"TOGGLE_PATTERN_BRUSH":if(r.studio.isPatternBrushActive)r.studio.isPatternBrushActive=!1;else if(r.project.clipboard){const s=r.project.clipboard,i=new Uint32Array(s.data.length);for(let n=0;n<s.data.length;n++)i[n]=s.data[n];r.studio.patternBrushData={width:s.width,height:s.height,data:i},r.studio.isPatternBrushActive=!0}return fe.emit("READY");case"TOGGLE_BRUSH_SHAPE":return r.studio.brushShape=r.studio.brushShape==="SQUARE"?"CIRCLE":"SQUARE",fe.emit("READY");case"TOGGLE_HAND_TOOL":return r.studio.isHandToolActive=!r.studio.isHandToolActive,fe.emit("READY");case"CYCLE_SYMMETRY":const t=["OFF","HORIZONTAL","VERTICAL","QUADRANT"],a=t.indexOf(r.studio.symmetryMode);return r.studio.symmetryMode=t[(a+1)%t.length],fe.emit("READY");case"TOGGLE_TILING":return r.studio.isTilingEnabled=!r.studio.isTilingEnabled,fe.emit("READY");case"TOGGLE_AIRBRUSH":return r.studio.isAirbrushActive=!r.studio.isAirbrushActive,r.studio.show(r.studio.isAirbrushActive?"Mist Active":"Mist Off"),fe.emit("READY");case"TOGGLE_ALPHA_LOCK":return r.studio.isAlphaLocked=!r.studio.isAlphaLocked,fe.emit("READY");case"TOGGLE_PIXEL_PERFECT":return r.studio.isPixelPerfect=!r.studio.isPixelPerfect,fe.emit("READY");case"TOGGLE_SHADE_LIGHTEN":return r.studio.isShadingLighten=!r.studio.isShadingLighten,r.studio.isShadingLighten&&(r.studio.isShadingDarken=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingLighten?"Light Roast Active":"Light Roast Off"),fe.emit("READY");case"TOGGLE_SHADE_DARKEN":return r.studio.isShadingDarken=!r.studio.isShadingDarken,r.studio.isShadingDarken&&(r.studio.isShadingLighten=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingDarken?"Dark Roast Active":"Dark Roast Off"),fe.emit("READY");case"TOGGLE_SHADE_DITHER":return r.studio.isShadingDither=!r.studio.isShadingDither,r.studio.isShadingDither&&(r.studio.isShadingLighten=!1,r.studio.isShadingDarken=!1),r.studio.show(r.studio.isShadingDither?"Texture Active":"Texture Off"),fe.emit("READY");case"SHADE_LIGHTEN":return r.studio.isShadingLighten=!r.studio.isShadingLighten,r.studio.isShadingLighten&&(r.studio.isShadingDarken=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingLighten?"Light Roast Active":"Light Roast Off"),fe.emit("READY");case"SHADE_DARKEN":return r.studio.isShadingDarken=!r.studio.isShadingDarken,r.studio.isShadingDarken&&(r.studio.isShadingLighten=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingDarken?"Dark Roast Active":"Dark Roast Off"),fe.emit("READY");case"SHADE_DITHER":return r.studio.isShadingDither=!r.studio.isShadingDither,r.studio.isShadingDither&&(r.studio.isShadingLighten=!1,r.studio.isShadingDarken=!1),r.studio.show(r.studio.isShadingDither?"Texture Active":"Texture Off"),fe.emit("READY");case"TOGGLE_COLOR_LOCK":if(r.studio.isColorLocked)r.studio.isColorLocked=!1,r.studio.colorLockSource=null;else{r.studio.isColorLocked=!0;const s=r.canvas.getColor(r.cursor.pos.x,r.cursor.pos.y);r.studio.colorLockSource=ne.uint32ToHex(s)}return fe.emit("READY");case"TOGGLE_UNDERLAY":return r.studio.isUnderlayVisible=!r.studio.isUnderlayVisible,fe.emit("READY");case"OPEN_UNDERLAY_MENU":return r.studio.showUnderlayMenu=!r.studio.showUnderlayMenu,fe.emit("READY");case"TOOL_RECTANGLE":return r.studio.activeTool="RECTANGLE",r.studio.shapeAnchor={...r.cursor.pos},fe.emit("READY");case"TOOL_ELLIPSE":return r.studio.activeTool="ELLIPSE",r.studio.shapeAnchor={...r.cursor.pos},fe.emit("READY");case"TOOL_BRUSH":return r.studio.activeTool="BRUSH",fe.emit("READY");case"TOOL_ERASER":return r.studio.activeTool="ERASER",fe.emit("READY");case"TOOL_SELECT":return r.studio.activeTool="SELECT",fe.emit("READY");case"TOOL_POLYGON":return r.studio.activeTool="POLYGON",r.studio.shapeAnchor={...r.cursor.pos},fe.emit("READY");case"POLY_SIDES_INC":return r.studio.polygonSides=Math.min(12,r.studio.polygonSides+1),r.studio.show(`${r.studio.polygonSides} Facets`),fe.emit("READY");case"POLY_SIDES_DEC":return r.studio.polygonSides=Math.max(3,r.studio.polygonSides-1),r.studio.show(`${r.studio.polygonSides} Facets`),fe.emit("READY");case"POLY_INDENT_INC":return r.studio.polygonIndentation=Math.min(100,r.studio.polygonIndentation+10),r.studio.show(`${r.studio.polygonIndentation}% Steeping`),fe.emit("READY");case"POLY_INDENT_DEC":return r.studio.polygonIndentation=Math.max(0,r.studio.polygonIndentation-10),r.studio.show(`${r.studio.polygonIndentation}% Steeping`),fe.emit("READY");case"TOOL_GRADIENT":return r.studio.activeTool==="GRADIENT"?(r.studio.activeTool="BRUSH",r.studio.shapeAnchor=null,r.studio.gradientStartColor=null):(r.studio.activeTool="GRADIENT",r.studio.shapeAnchor={...r.cursor.pos},r.studio.gradientStartColor=r.paletteState.activeColor),fe.emit("READY");case"TOOL_TRANSFORM":return r.selection.isActive?(r.studio.isTransforming=!r.studio.isTransforming,fe.emit("READY")):void 0;default:if(e.startsWith("SET_SIDES_")){const s=parseInt(e.split("_")[2]);return r.studio.polygonSides=s,r.studio.show(`${s} Facets`),fe.emit("READY")}if(e.startsWith("SELECT_COLOR_")){const s=parseInt(e.split("_")[2]);return V.color.select(s===0?9:s-1)}}}executeMove(e,t){if(r.studio.isTransforming&&r.selection.isActive){V.selection.nudge(e,t);return}if(V.movement.move(e,t)){const a=Fe.current.type;a==="SELECT"&&(r.selection.isActive||V.startSelection(),V.updateSelection()),a==="PAINT"&&V.draw.draw(),a==="ERASE"&&V.draw.erase()}}resetAutoSaveTimer(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{V.persistence.autoSaveSession()},1e4)}}const gt=new yi;class _i{isPointerDown=!1;#e=C(!1);get isPointerDownActive(){return o(this.#e)}set isPointerDownActive(e){w(this.#e,e,!0)}lastPosition={x:-1,y:-1};lastScreenPos=null;buttonType=null;holdTimer=null;isSnapped=!1;rafId=null;#t=C(!1);get isSnappedState(){return o(this.#t)}set isSnappedState(e){w(this.#t,e,!0)}mapToGrid(e,t,a){const s=a.getBoundingClientRect();return Ze.mapScreenToGrid(e,t,s,r.canvas.width,r.canvas.height)}handleStart(e,t){gt.resetAutoSaveTimer(),this.isPointerDown=!0,this.isPointerDownActive=!0,this.isSnapped=!1,this.buttonType=e.button===2?"secondary":"primary",this.lastScreenPos={x:e.clientX,y:e.clientY};const a=this.mapToGrid(e.clientX,e.clientY,t);if(this.lastPosition={x:a.x,y:a.y},e.ctrlKey||e.metaKey){r.cursor.pos={x:Math.floor(a.x),y:Math.floor(a.y)},this.isPointerDown=!1,this.isPointerDownActive=!1;return}const s=Fe.current.type;if(s==="PAN")return;r.cursor.pos={x:Math.floor(a.x),y:Math.floor(a.y)};const i=r.studio.activeTool;if(this.buttonType==="primary"&&i==="SELECT"){V.selection.begin(r.cursor.pos.x,r.cursor.pos.y);return}if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(i)){r.studio.shapeAnchor={...r.cursor.pos},i==="GRADIENT"&&(r.studio.gradientStartColor=r.paletteState.activeColor);return}const n=r.studio.isShadingLighten||r.studio.isShadingDarken||r.studio.isShadingDither;this.buttonType==="primary"&&s!=="SELECT"&&(n?V.draw.draw(a.x,a.y):(V.draw.beginStroke(a.x,a.y),this.startHoldTimer()))}handleMove(e,t){this.isPointerDown&&(gt.resetAutoSaveTimer(),!this.rafId&&(this.rafId=requestAnimationFrame(()=>{const a=this.mapToGrid(e.clientX,e.clientY,t),s=Fe.current.type,i=r.studio.activeTool;if(s==="PAN"){const l=Ze.calculatePanDelta(e.clientX,e.clientY,this.lastScreenPos?.x||e.clientX,this.lastScreenPos?.y||e.clientY);r.studio.panOffset.x+=l.dx,r.studio.panOffset.y+=l.dy,this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null;return}if(r.cursor.pos={x:Math.floor(a.x),y:Math.floor(a.y)},this.buttonType==="primary"&&i==="SELECT"){V.selection.update(r.cursor.pos.x,r.cursor.pos.y),this.rafId=null;return}const n=r.studio.isShadingLighten||r.studio.isShadingDarken||r.studio.isShadingDither;if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(i)){this.lastPosition={x:a.x,y:a.y},this.rafId=null;return}this.buttonType==="primary"&&s!=="SELECT"&&(n?V.draw.draw(a.x,a.y):this.isSnapped||(V.draw.continueStroke(a.x,a.y,this.lastPosition.x,this.lastPosition.y),this.resetHoldTimer())),this.lastPosition={x:a.x,y:a.y},this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null})))}handleEnd(){if(!this.isPointerDown)return;this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);const e=Fe.current.type,t=r.studio.activeTool;this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(t)?V.draw.commitShape():this.buttonType==="primary"&&t==="SELECT"?V.selection.commit():this.buttonType==="primary"&&e!=="SELECT"?V.draw.endStroke():r.canvas.clearBuffer(),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1}cancel(){this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1,V.draw.cancelStroke()}startHoldTimer(){this.clearHoldTimer(),this.holdTimer=setTimeout(()=>{this.isPointerDown&&this.triggerSnap()},600)}resetHoldTimer(){this.isSnapped||this.startHoldTimer()}clearHoldTimer(){this.holdTimer&&clearTimeout(this.holdTimer),this.holdTimer=null}triggerSnap(){this.isSnapped=!0,this.isSnappedState=!0,V.draw.snapCurrentStroke()}}const xt=new _i;class Ai{version="0.9.0";project=new Vs;canvas=new Cs(this.project);cursor=new Is;paletteState=new Os;studio=new js;selection=new Hs;get pixels(){return this.canvas.pixels}set pixels(e){this.canvas.pixels=e}get canvasWidth(){return this.canvas.width}set canvasWidth(e){this.canvas.width=e}get canvasHeight(){return this.canvas.height}set canvasHeight(e){this.canvas.height=e}get activeColor(){return this.paletteState.activeColor}set activeColor(e){this.paletteState.activeColor=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get usageMinutes(){return this.studio.usageMinutes}get backgroundColor(){return this.studio.backgroundColor}set backgroundColor(e){this.studio.backgroundColor=e}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isCursorVisible(){return this.cursor.isVisible}set isCursorVisible(e){this.cursor.isVisible=e}get showColorPicker(){return this.studio.showColorPicker}set showColorPicker(e){this.studio.showColorPicker=e}get showAudioSettings(){return this.studio.showAudioSettings}set showAudioSettings(e){this.studio.showAudioSettings=e}get showCommandPalette(){return this.studio.showCommandPalette}set showCommandPalette(e){this.studio.showCommandPalette=e}get showGuideBook(){return this.studio.showGuideBook}set showGuideBook(e){this.studio.showGuideBook=e}get showGuideMenu(){return this.studio.showGuideMenu}set showGuideMenu(e){this.studio.showGuideMenu=e}get showExportMenu(){return this.studio.showExportMenu}set showExportMenu(e){this.studio.showExportMenu=e}get showCanvasSettings(){return this.studio.showCanvasSettings}set showCanvasSettings(e){this.studio.showCanvasSettings=e}get showPersistenceMenu(){return this.studio.showPersistenceMenu}set showPersistenceMenu(e){this.studio.showPersistenceMenu=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get showGhostLayers(){return this.studio.showGhostLayers}set showGhostLayers(e){this.studio.showGhostLayers=e}#e=K(()=>({x:Ze.toCartesianLabel(this.cursor.pos.x,this.canvas.width),y:Ze.toCartesianLabel(this.cursor.pos.y,this.canvas.height,!0)}));get displayCoords(){return o(this.#e)}set displayCoords(e){w(this.#e,e)}#t=K(()=>Ze.calculateCameraTransform(this.studio.zoomLevel,this.studio.panOffset,this.cursor.pos,this.canvas.width,this.canvas.height));get cameraTransform(){return o(this.#t)}set cameraTransform(e){w(this.#t,e)}#a=K(()=>{const e=new Set;return this.canvas.compositePixels.forEach(t=>{const a=ne.uint32ToHex(t);a!==null&&e.add(a)}),Array.from(e)});get usedColors(){return o(this.#a)}set usedColors(e){w(this.#a,e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}toggleMute(){this.studio.toggleMute()}handleEscape(){if(this.studio.handleEscape())return!0;let t=!1;this.project.selectedFrameIndices.size>1&&(this.project.selectedFrameIndices=new Set([this.project.activeFrameIndex]),t=!0);const a=this.project.activeFrame;return a.selectedLayerIndices.size>1&&(a.selectedLayerIndices=new Set([a.activeLayerIndex]),t=!0),t?!0:xt.isPointerDownActive?(xt.cancel(),!0):this.selection.isActive?this.studio.isTransforming?(this.studio.isTransforming=!1,!0):(this.selection.clear(),!0):this.studio.activeTool!=="BRUSH"?(this.studio.activeTool="BRUSH",this.studio.shapeAnchor=null,!0):this.studio.isShadingLighten||this.studio.isShadingDarken||this.studio.isShadingDither?(this.studio.isShadingLighten=!1,this.studio.isShadingDarken=!1,this.studio.isShadingDither=!1,this.studio.show("Shading Reset"),!0):!1}undo(){const e=ce.undo();if(e)if("isStructural"in e)e.undo(),Z.playErase();else if(Array.isArray(e)){const t=new Uint32Array(this.canvas.pixels);for(let a=e.length-1;a>=0;a--){const s=e[a];t[s.index]=ne.hexToUint32(s.oldColor)}this.canvas.pixels=t,this.canvas.triggerPulse(),Z.playErase()}else{const t=new Uint32Array(this.canvas.pixels);t[e.index]=ne.hexToUint32(e.oldColor),this.canvas.pixels=t,this.canvas.triggerPulse(),Z.playErase()}this.cursor.resetInactivityTimer()}redo(){const e=ce.redo();if(e)if("isStructural"in e)e.redo(),Z.playDraw();else if(Array.isArray(e)){const t=new Uint32Array(this.canvas.pixels);for(const a of e)t[a.index]=ne.hexToUint32(a.newColor);this.canvas.pixels=t,this.canvas.triggerPulse(),Z.playDraw()}else{const t=new Uint32Array(this.canvas.pixels);t[e.index]=ne.hexToUint32(e.newColor),this.canvas.pixels=t,this.canvas.triggerPulse(),Z.playDraw()}this.cursor.resetInactivityTimer()}clearCanvas(){V.clearCanvas()}pickColor(){V.pickColor()}loadProject(){V.load()}copySelection(){V.copy()}cutSelection(){V.cut()}pasteSelection(){V.paste()}flipCanvas(e){V.flipCanvas(e)}rotateCanvas(){V.rotateCanvas()}}const r=new Ai;var wi=O('<div class="h-3 w-px bg-brand/20" aria-hidden="true"></div>'),ki=O("<div><h1>Rupa</h1> <!> <p>The Barista's Café</p></div>");function dr(p,e){let t=Le(e,"size",3,"md");const a={sm:{h1:"text-2xl",p:"text-[9px]",gap:"gap-3"},md:{h1:"text-4xl",p:"text-[11px]",gap:"gap-2"},lg:{h1:"text-7xl",p:"text-[14px]",gap:"gap-4"}};let s=K(()=>a[t()]),i=K(()=>t()==="sm"?"flex-row items-center":"flex-col items-center");var n=ki(),l=d(n),u=f(l,2);{var v=g=>{var x=wi();T(g,x)};H(u,g=>{t()==="sm"&&g(v)})}var h=f(u,2);c(n),N(()=>{re(n,1,`flex ${o(i)??""} ${o(s).gap??""} justify-center text-center select-none`),re(l,1,`font-tiny5 leading-none text-brand ${o(s).h1??""} tracking-tighter`),re(h,1,`font-serif font-bold tracking-[0.4em] text-charcoal/40 uppercase ${o(s).p??""}`)}),T(p,n)}var ht=ta(()=>r),Ei=O('<nav class="flex items-center gap-2" aria-label="Editor Tools"><div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">📖</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true">🍶</span> <span class="hidden xl:inline"> </span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">🧼</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true"> </span> <span class="hidden xl:inline"> </span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">📜</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true">⌨️</span> <span class="hidden xl:inline"> </span></button></div></nav>');function Si(p,e){ie(e,!1),$e();var t=Ei(),a=d(t),s=d(a);s.__click=()=>ht(ht().showCommandPalette=!0);var i=f(d(s),2),n=d(i,!0);c(i),c(s);var l=f(s,2);l.__click=()=>ht(ht().showExportMenu=!0);var u=f(d(l),2),v=d(u,!0);c(u),c(l),c(a);var h=f(a,4),g=d(h);g.__click=()=>ht().clearCanvas();var x=f(d(g),2),b=d(x,!0);c(x),c(g);var m=f(g,2);m.__click=()=>ht(ht().showAudioSettings=!0);var _=d(m),y=d(_,!0);c(_);var E=f(_,2),I=d(E,!0);c(E),c(m),c(h);var G=f(h,4),j=d(G);j.__click=()=>ht(ht().showGuideBook=!0);var B=f(d(j),2),U=d(B,!0);c(B),c(j);var P=f(j,2);P.__click=()=>ht(ht().showGuideMenu=!0);var R=f(d(P),2),F=d(R,!0);c(R),c(P),c(G),c(t),N(($,z,Y,te,ae,Q,se,me,Se,_e,Re,Ne)=>{M(s,"title",`${$??""} (Ctrl+K)`),S(n,z),M(l,"title",`${Y??""} (Ctrl+E)`),S(v,te),M(g,"title",`${ae??""} (Ctrl+L)`),S(b,Q),M(m,"title",`${se??""} (Ctrl+Shift+A)`),S(y,ht().isMuted?"🔇":"🔊"),S(I,me),M(j,"title",`${Se??""} (F1)`),S(U,_e),M(P,"title",`${Re??""} (F2)`),S(F,Ne)},[()=>A({key:"hud.menu.catalog_title"}),()=>A({key:"hud.menu.catalog_title"}),()=>A({key:"export.title"}),()=>A({key:"export.title"}),()=>A({key:"hud.actions.clear_canvas"}),()=>A({key:"hud.actions.clear_canvas"}),()=>A({key:"hud.audio.title"}),()=>A({key:"hud.audio.title"}),()=>A({key:"manual.title"}),()=>A({key:"manual.title"}),()=>A({key:"shortcuts.title"}),()=>A({key:"shortcuts.title"})]),T(p,t),oe()}Ie(["click"]);const Ti=p=>p;function $a(p){const e=p-1;return e*e*e+1}function Za(p){const e=typeof p=="string"&&p.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[p,"px"]}function ye(p,{delay:e=0,duration:t=400,easing:a=Ti}={}){const s=+getComputedStyle(p).opacity;return{delay:e,duration:t,easing:a,css:i=>`opacity: ${i*s}`}}function Na(p,{delay:e=0,duration:t=400,easing:a=$a,x:s=0,y:i=0,opacity:n=0}={}){const l=getComputedStyle(p),u=+l.opacity,v=l.transform==="none"?"":l.transform,h=u*(1-n),[g,x]=Za(s),[b,m]=Za(i);return{delay:e,duration:t,easing:a,css:(_,y)=>`
			transform: ${v} translate(${(1-_)*g}${x}, ${(1-_)*b}${m});
			opacity: ${u-h*y}`}}function Li(p,{delay:e=0,duration:t=400,easing:a=$a,axis:s="y"}={}){const i=getComputedStyle(p),n=+i.opacity,l=s==="y"?"height":"width",u=parseFloat(i[l]),v=s==="y"?["top","bottom"]:["left","right"],h=v.map(E=>`${E[0].toUpperCase()}${E.slice(1)}`),g=parseFloat(i[`padding${h[0]}`]),x=parseFloat(i[`padding${h[1]}`]),b=parseFloat(i[`margin${h[0]}`]),m=parseFloat(i[`margin${h[1]}`]),_=parseFloat(i[`border${h[0]}Width`]),y=parseFloat(i[`border${h[1]}Width`]);return{delay:e,duration:t,easing:a,css:E=>`overflow: hidden;opacity: ${Math.min(E*20,1)*n};${l}: ${E*u}px;padding-${v[0]}: ${E*g}px;padding-${v[1]}: ${E*x}px;margin-${v[0]}: ${E*b}px;margin-${v[1]}: ${E*m}px;border-${v[0]}-width: ${E*_}px;border-${v[1]}-width: ${E*y}px;min-${l}: 0`}}function Ft(p,{delay:e=0,duration:t=400,easing:a=$a,start:s=0,opacity:i=0}={}){const n=getComputedStyle(p),l=+n.opacity,u=n.transform==="none"?"":n.transform,v=1-s,h=l*(1-i);return{delay:e,duration:t,easing:a,css:(g,x)=>`
			transform: ${u} scale(${1-v*x});
			opacity: ${l-h*x}
		`}}var Ci=O('<div class="flex items-center gap-2 rounded-full border border-charcoal/10 bg-foam-white/50 px-3 py-1"><div class="h-1.5 w-1.5 rounded-full bg-brand/40" aria-hidden="true"></div> <span class="font-mono text-[9px] font-bold tracking-widest text-charcoal/40 uppercase"> </span></div>'),Ii=O('<div class="flex items-center gap-4 px-4"><!></div>');function Pi(p,e){ie(e,!1),$e();var t=Ii(),a=d(t);{var s=i=>{var n=Ci(),l=f(d(n),2),u=d(l,!0);c(l),c(n),N(v=>S(u,v),[()=>A({key:"project.saved",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}})]),ue(3,n,()=>ye),T(i,n)};H(a,i=>{r.project.lastSaved&&i(s)})}c(t),T(p,t),oe()}var Mi=O('<header class="hud-panel flex h-14 w-full items-center justify-between px-8 py-2 select-none svelte-zd3ruq"><div class="flex items-center gap-12"><!> <div class="h-6 w-px bg-charcoal/10" aria-hidden="true"></div> <!></div> <!></header>');function Oi(p){var e=Mi(),t=d(e),a=d(t);dr(a,{size:"sm"});var s=f(a,4);Si(s,{}),c(t);var i=f(t,2);Pi(i,{}),c(e),T(p,e)}var Ri=O('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase">Steeped</span> <span class="font-serif text-[8px] text-charcoal/30">Sync across all cups</span></div> <button aria-label="Toggle Steeped (Sync across all cups)"><div></div></button></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between gap-4"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase"> </span> <div class="flex flex-1 items-center gap-2"><input type="range" min="0" max="5" step="0.5" class="editor-slider h-1 flex-1"/> <span class="font-mono text-[8px] opacity-30"> </span></div></div> <div class="flex items-center justify-between gap-4"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase"> </span> <div class="flex flex-1 items-center gap-2"><input type="range" min="0" max="20" step="1" class="editor-slider h-1 flex-1"/> <span class="font-mono text-[8px] opacity-30"> </span></div></div>',1),Di=O('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between gap-4"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase">Shift</span> <div class="flex flex-1 items-center gap-2"><input type="range" min="10" max="2000" step="10" class="editor-slider h-1 flex-1"/> <input type="number" min="10" max="5000" class="w-12 rounded border border-charcoal/10 bg-white p-0.5 text-center font-mono text-[10px]"/> <span class="font-mono text-[8px] opacity-30">ms</span></div></div>',1),ji=O('<div class="mr-2 mb-2 flex flex-col gap-3 rounded-b-lg border-x border-b border-charcoal/5 bg-charcoal/[0.02] p-3 pt-1"><div class="flex items-center justify-between gap-4"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase">Density</span> <div class="flex flex-1 items-center gap-2"><input type="range" min="0" max="1" step="0.01" class="editor-slider h-1 flex-1"/> <input type="number" min="0" max="100" class="w-10 rounded border border-charcoal/10 bg-white p-0.5 text-center font-mono text-[10px]"/> <span class="font-mono text-[8px] opacity-30">%</span></div></div> <!> <!></div>');function Ja(p,e){ie(e,!0);let t=Le(e,"target",7),a=K(()=>"isLinked"in t()),s=K(()=>"duration"in t());var i=ji(),n=d(i),l=f(d(n),2),u=d(l);Ee(u);var v=f(u,2);Ee(v),v.__input=m=>t().opacity=Math.max(0,Math.min(100,Number(m.currentTarget.value)))/100,Pt(2),c(l),c(n);var h=f(n,2);{var g=m=>{var _=Ri(),y=f(be(_),2),E=f(d(y),2);E.__click=()=>t().isLinked=!t().isLinked;var I=d(E);c(E),c(y);var G=f(y,4),j=d(G),B=d(j,!0);c(j);var U=f(j,2),P=d(U);Ee(P);var R=f(P,2),F=d(R);c(R),c(U),c(G);var $=f(G,2),z=d($),Y=d(z,!0);c(z);var te=f(z,2),ae=d(te);Ee(ae);var Q=f(ae,2),se=d(Q);c(Q),c(te),c($),N((me,Se)=>{re(E,1,`flex h-4 w-8 items-center rounded-full transition-colors ${t().isLinked?"bg-brand":"bg-charcoal/10"}`),re(I,1,`h-2.5 w-2.5 rounded-full bg-white shadow-sm transition-transform ${t().isLinked?"translate-x-4.5":"translate-x-1"}`),S(B,me),S(F,`${t().wiggleAmount??""}px`),S(Y,Se),S(se,`${t().swayAmount??""}px`)},[()=>A({key:"export.wiggle_modifier"}),()=>A({key:"export.sway_modifier"})]),Ce(P,()=>t().wiggleAmount,me=>t().wiggleAmount=me),Ce(ae,()=>t().swayAmount,me=>t().swayAmount=me),T(m,_)};H(h,m=>{o(a)&&m(g)})}var x=f(h,2);{var b=m=>{var _=Di(),y=f(be(_),2),E=f(d(y),2),I=d(E);Ee(I);var G=f(I,2);Ee(G),Pt(2),c(E),c(y),Ce(I,()=>t().duration,j=>t().duration=j),Ce(G,()=>t().duration,j=>t().duration=j),T(m,_)};H(x,m=>{o(s)&&m(b)})}c(i),N(m=>Ts(v,m),[()=>Math.round(t().opacity*100)]),Ce(u,()=>t().opacity,m=>t().opacity=m),ue(3,i,()=>ye,()=>({duration:100})),T(p,i),oe()}Ie(["input","click"]);var Fi=O('<input type="text" class="w-full bg-brand/5 font-serif text-sm font-medium text-brand ring-1 ring-brand/30 outline-none"/>'),Gi=O('<span class="truncate font-serif text-sm font-medium text-charcoal"> </span>'),Bi=O('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">🗑️</button>'),$i=O('<div role="button" tabindex="0" draggable="true"><button class="flex flex-1 items-center gap-3 overflow-hidden py-2 pl-1 text-left"><span class="font-mono text-[10px] opacity-30" aria-hidden="true"></span> <!></button> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Cup Properties"> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">📋</button> <!></div></div> <!>',1),Ni=O('<div class="flex flex-col gap-1" role="list"></div>'),Ui=O('<button class="text-[10px] opacity-40 hover:opacity-100"> </button>'),Vi=O('<input type="text" class="w-full bg-brand/5 font-serif text-sm font-medium text-brand ring-1 ring-brand/30 outline-none"/>'),Hi=O('<div role="button" tabindex="0" draggable="true"><div class="flex flex-1 items-center gap-2 overflow-hidden"><!> <button> </button> <button><!></button></div> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Infusion Properties"> </button> <button> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">🗑️</button></div></div> <!>',1),zi=O('<div class="flex flex-col gap-1" role="list"></div>'),Yi=O('<button class="flex items-center gap-1 font-serif text-[9px] font-bold tracking-[0.1em] text-charcoal/40 uppercase hover:text-charcoal/80"><span aria-hidden="true">📁</span> Group</button>'),Ki=O('<div class="flex h-full w-full flex-col overflow-hidden bg-transparent" role="region" aria-label="Project Explorer"><div class="flex border-b border-charcoal/10 bg-charcoal/5 p-1" role="tablist"><button role="tab"><span aria-hidden="true">🖼️</span> </button> <button role="tab"><span aria-hidden="true">🧵</span> </button></div> <div class="custom-scrollbar flex-1 overflow-y-auto p-2" role="presentation"><!></div> <div class="flex items-center justify-between border-t border-charcoal/5 bg-charcoal/5 px-4 py-2"><div class="flex items-center gap-3"><button class="flex items-center gap-1 font-serif text-[9px] font-bold tracking-[0.1em] text-charcoal/40 uppercase hover:text-charcoal/80"><span aria-hidden="true">＋</span> </button> <!></div> <span class="font-mono text-[8px] font-bold text-charcoal/20 uppercase"> </span></div></div>');function qi(p,e){ie(e,!0);let t=C(null),a=C(null),s=C(null),i=C(""),n=C(null),l=C(null);function u(L,k,D){D.stopPropagation(),o(n)===L&&o(l)===k?(w(n,null),w(l,null)):(w(n,L,!0),w(l,k,!0))}function v(L,k){w(s,L,!0),w(i,k,!0)}function h(L){L.focus(),L.select()}function g(){o(s)!==null&&(r.studio.projectActiveTab==="layers"?r.project.activeFrame.layers[o(s)].name=o(i):r.project.frames[o(s)].name=o(i),w(s,null))}function x(L){w(t,L,!0)}function b(L,k){L.preventDefault(),w(a,k,!0)}function m(L,k){L.preventDefault(),o(t)!==null&&(r.studio.projectActiveTab==="layers"?V.project.reorderLayer(o(t),k):V.project.reorderFrame(o(t),k)),w(t,null),w(a,null)}function _(){w(t,null),w(a,null)}function y(){const L=r.project;L.selectedFrameIndices=new Set([L.activeFrameIndex]);const k=L.activeFrame;k.selectedLayerIndices=new Set([k.activeLayerIndex])}function E(L,k){const D=r.project;if(k.ctrlKey||k.metaKey)D.selectedFrameIndices.has(L)&&D.selectedFrameIndices.size>1?D.selectedFrameIndices.delete(L):D.selectedFrameIndices.add(L);else if(k.shiftKey){const W=Math.min(D.activeFrameIndex,L),q=Math.max(D.activeFrameIndex,L),he=new Set;for(let X=W;X<=q;X++)he.add(X);D.selectedFrameIndices=he}else D.selectedFrameIndices=new Set([L]);D.activeFrameIndex=L}function I(L,k){const D=r.project.activeFrame;if(k.ctrlKey||k.metaKey)D.selectedLayerIndices.has(L)&&D.selectedLayerIndices.size>1?D.selectedLayerIndices.delete(L):D.selectedLayerIndices.add(L);else if(k.shiftKey){const W=Math.min(D.activeLayerIndex,L),q=Math.max(D.activeLayerIndex,L),he=new Set;for(let X=W;X<=q;X++)he.add(X);D.selectedLayerIndices=he}else D.selectedLayerIndices=new Set([L]);D.activeLayerIndex=L}function G(L,k){L.preventDefault();const D=r.project;D.selectedFrameIndices.has(k)||(D.selectedFrameIndices=new Set([k]),D.activeFrameIndex=k);const W=D.selectedFrameIndices.size>1;r.studio.contextMenu={x:L.clientX,y:L.clientY,items:[{label:W?`Duplicate ${D.selectedFrameIndices.size} Cups`:A({key:"hud.actions.duplicate"}),icon:"📋",action:()=>{V.project.duplicateFrame(k)}},{label:"Add Flavor Tag",icon:"🏷️",action:()=>{const q=prompt("Tag Name:","New Sequence");if(q){const he=Array.from(D.selectedFrameIndices).sort((X,de)=>X-de);V.project.addTag(q,he[0],he[he.length-1])}}},{label:W?`Spill ${D.selectedFrameIndices.size} Cups`:A({key:"hud.actions.delete"}),icon:"🗑️",danger:!0,disabled:D.frames.length<=D.selectedFrameIndices.size,action:()=>{Array.from(D.selectedFrameIndices).sort((he,X)=>X-he).forEach(he=>V.project.removeFrame(he)),D.selectedFrameIndices=new Set([D.activeFrameIndex])}}]}}function j(L,k){const D=r.project.activeFrame;L.preventDefault(),D.selectedLayerIndices.has(k)||(D.selectedLayerIndices=new Set([k]),D.activeLayerIndex=k);const W=D.selectedLayerIndices.size>1,q=D.layers[k];r.studio.contextMenu={x:L.clientX,y:L.clientY,items:[{label:W?"Group Selected":"Group",icon:"📁",action:()=>{const he=V.project.addGroup();W?Array.from(D.selectedLayerIndices).forEach(de=>{const we=D.layers[de];we!==he&&(we.parentId=he.id)}):q.parentId=he.id}},{label:W?`Duplicate ${D.selectedLayerIndices.size} Infusions`:A({key:"hud.actions.duplicate"}),icon:"📋",disabled:W,action:()=>V.project.duplicateLayer(k)},{label:W?"Show/Hide Selected":q.isVisible?"Hide Infusion":"Show Infusion",icon:q.isVisible?"🕶️":"👁️",action:()=>{const he=Array.from(D.selectedLayerIndices),X=!q.isVisible;he.forEach(de=>D.layers[de].isVisible=X),r.canvas.triggerPulse()}},{label:W?"Seal/Unseal Selected":q.isLocked?"Unlock Infusion":"Lock Infusion",icon:q.isLocked?"🔓":"🔒",action:()=>{Array.from(D.selectedLayerIndices).forEach(X=>V.project.toggleLock(X))}},{label:A({key:"hud.actions.delete"}),icon:"🗑️",danger:!0,disabled:D.layers.length<=D.selectedLayerIndices.size,action:()=>{Array.from(D.selectedLayerIndices).sort((X,de)=>de-X).forEach(X=>V.project.removeLayer(X)),D.selectedLayerIndices=new Set([D.activeLayerIndex])}}]}}var B=Ki(),U=d(B),P=d(U);P.__click=()=>r.studio.projectActiveTab="frames";var R=f(d(P));c(P);var F=f(P,2);F.__click=()=>r.studio.projectActiveTab="layers";var $=f(d(F));c(F),c(U);var z=f(U,2);z.__click=y,z.__keydown=L=>{L.key==="Escape"&&y()};var Y=d(z);{var te=L=>{var k=Ni();Oe(k,21,()=>r.project.frames,Be,(D,W,q)=>{var he=$i(),X=be(he);X.__click=le=>le.stopPropagation(),X.__keydown=le=>{(le.key==="Enter"||le.key===" ")&&E(q,le)},X.__contextmenu=le=>G(le,q);var de=d(X);de.__click=le=>E(q,le),de.__dblclick=()=>v(q,o(W).name);var we=d(de);we.textContent=q+1;var Ve=f(we,2);{var Je=le=>{var ke=Fi();Ee(ke),ke.__keydown=Ae=>{Ae.key==="Enter"&&g(),Ae.key==="Escape"&&w(s,null)},ca(()=>Ce(ke,()=>o(i),Ae=>w(i,Ae))),Ka(ke,Ae=>h?.(Ae)),We("blur",ke,g),T(le,ke)},Pe=le=>{var ke=Gi(),Ae=d(ke,!0);c(ke),N(()=>S(Ae,o(W).name)),T(le,ke)};H(Ve,le=>{o(s)===q&&r.studio.projectActiveTab==="frames"?le(Je):le(Pe,!1)})}c(de);var xe=f(de,2),Me=d(xe);Me.__click=le=>u("frame",q,le);var et=d(Me,!0);c(Me);var Ue=f(Me,2);Ue.__click=le=>{le.stopPropagation(),V.project.duplicateFrame(q)};var Te=f(Ue,2);{var Ke=le=>{var ke=Bi();ke.__click=Ae=>{Ae.stopPropagation(),V.project.removeFrame(q)},N(Ae=>M(ke,"title",Ae),[()=>A({key:"hud.actions.delete"})]),T(le,ke)};H(Te,le=>{r.project.frames.length>1&&le(Ke)})}c(xe),c(X);var De=f(X,2);{var qe=le=>{Ja(le,{get target(){return o(W)}})};H(De,le=>{o(n)==="frame"&&o(l)===q&&le(qe)})}N((le,ke)=>{re(X,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${le??""} ${q===r.project.activeFrameIndex?"bg-brand/5 font-bold":""} ${o(a)===q&&o(t)!==q?"shadow-[0_-2px_0_var(--color-brand)]":""} ${o(t)===q?"opacity-40":""}`),M(X,"aria-current",q===r.project.activeFrameIndex?"true":void 0),S(et,o(n)==="frame"&&o(l)===q?"🔼":"⚙️"),M(Ue,"title",ke)},[()=>r.project.selectedFrameIndices.has(q)?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-charcoal/5",()=>A({key:"hud.actions.duplicate"})]),We("dragstart",X,()=>x(q)),We("dragover",X,le=>b(le,q)),We("drop",X,le=>m(le,q)),We("dragend",X,_),T(D,he)}),c(k),ue(3,k,()=>ye,()=>({duration:150})),T(L,k)},ae=L=>{var k=zi();Oe(k,21,()=>r.project.activeFrame.layers,Be,(D,W,q)=>{const he=K(()=>o(W).parentId?r.project.activeFrame.layers.find(Ve=>Ve.id===o(W).parentId):null);var X=Ye(),de=be(X);{var we=Ve=>{const Je=K(()=>o(W).parentId!==null);var Pe=Hi(),xe=be(Pe);xe.__click=ee=>ee.stopPropagation(),xe.__keydown=ee=>{(ee.key==="Enter"||ee.key===" ")&&I(q,ee)},xe.__contextmenu=ee=>j(ee,q);var Me=d(xe),et=d(Me);{var Ue=ee=>{var pe=Ui();pe.__click=it=>{it.stopPropagation(),o(W).isCollapsed=!o(W).isCollapsed};var at=d(pe,!0);c(pe),N(()=>S(at,o(W).isCollapsed?"▶":"▼")),T(ee,pe)};H(et,ee=>{o(W).type==="FOLDER"&&ee(Ue)})}var Te=f(et,2);Te.__click=ee=>{ee.stopPropagation(),V.project.toggleVisibility(q)};var Ke=d(Te,!0);c(Te);var De=f(Te,2);De.__click=ee=>I(q,ee),De.__dblclick=()=>v(q,o(W).name);var qe=d(De);{var le=ee=>{var pe=Vi();Ee(pe),pe.__keydown=at=>{at.key==="Enter"&&g(),at.key==="Escape"&&w(s,null)},ca(()=>Ce(pe,()=>o(i),at=>w(i,at))),Ka(pe,at=>h?.(at)),We("blur",pe,g),T(ee,pe)},ke=ee=>{var pe=dt();N(()=>S(pe,o(W).name)),T(ee,pe)};H(qe,ee=>{o(s)===q&&r.studio.projectActiveTab==="layers"?ee(le):ee(ke,!1)})}c(De),c(Me);var Ae=f(Me,2),He=d(Ae);He.__click=ee=>u("layer",q,ee);var ze=d(He,!0);c(He);var je=f(He,2);je.__click=ee=>{ee.stopPropagation(),V.project.toggleLock(q)};var tt=d(je,!0);c(je);var ft=f(je,2);ft.__click=ee=>{ee.stopPropagation(),V.project.removeLayer(q)},c(Ae),c(xe);var pt=f(xe,2);{var Qe=ee=>{Ja(ee,{get target(){return o(W)}})};H(pt,ee=>{o(n)==="layer"&&o(l)===q&&ee(Qe)})}N((ee,pe,at,it)=>{re(xe,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${ee??""} ${q===r.project.activeFrame.activeLayerIndex?"bg-brand/5 font-bold":""} ${o(a)===q&&o(t)!==q?"shadow-[0_-2px_0_var(--color-brand)]":""} ${o(t)===q?"opacity-40":""}`),ge(xe,o(Je)?"margin-left: 12px;":""),M(xe,"aria-current",q===r.project.activeFrame.activeLayerIndex?"true":void 0),re(Te,1,`text-xs transition-opacity ${o(W).isVisible?"opacity-100":"opacity-20"}`),M(Te,"title",pe),S(Ke,o(W).isVisible?o(W).type==="FOLDER"?"📂":"👁️":o(W).type==="FOLDER"?"📁":"🕶️"),re(De,1,`flex-1 truncate py-2 text-left font-serif text-sm font-medium text-charcoal ${o(W).isVisible?"":"opacity-40"}`),S(ze,o(n)==="layer"&&o(l)===q?"🔼":"⚙️"),re(je,1,`text-[10px] transition-opacity ${o(W).isLocked?"opacity-100":"opacity-20"}`),M(je,"title",at),S(tt,o(W).isLocked?"🔒":"🔓"),M(ft,"title",it)},[()=>r.project.activeFrame.selectedLayerIndices.has(q)?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-charcoal/5",()=>A({key:"hud.project_panel.visibility"}),()=>A({key:"hud.project_panel.lock"}),()=>A({key:"hud.actions.delete"})]),We("dragstart",xe,()=>x(q)),We("dragover",xe,ee=>b(ee,q)),We("drop",xe,ee=>m(ee,q)),We("dragend",xe,_),T(Ve,Pe)};H(de,Ve=>{(!o(he)||!o(he).isCollapsed)&&Ve(we)})}T(D,X)}),c(k),ue(3,k,()=>ye,()=>({duration:150})),T(L,k)};H(Y,L=>{r.studio.projectActiveTab==="frames"?L(te):L(ae,!1)})}c(z);var Q=f(z,2),se=d(Q),me=d(se);me.__click=()=>{r.studio.projectActiveTab==="frames"?V.project.addFrame():V.project.addLayer()};var Se=f(d(me));c(me);var _e=f(me,2);{var Re=L=>{var k=Yi();k.__click=()=>V.project.addGroup(),T(L,k)};H(_e,L=>{r.studio.projectActiveTab==="layers"&&L(Re)})}c(se);var Ne=f(se,2),J=d(Ne,!0);c(Ne),c(Q),c(B),N((L,k,D,W,q)=>{M(P,"aria-selected",r.studio.projectActiveTab==="frames"),M(P,"title",L),re(P,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.projectActiveTab==="frames"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),S(R,` ${k??""}`),M(F,"aria-selected",r.studio.projectActiveTab==="layers"),M(F,"title",D),re(F,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.projectActiveTab==="layers"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),S($,` ${W??""}`),S(Se,` ${q??""}`),S(J,r.studio.projectActiveTab==="frames"?r.project.frames.length:r.project.activeFrame.layers.length)},[()=>A({key:"labels.TAB_TIMELINE"})+" (Alt+1)",()=>A({key:"hud.project_panel.frames"}),()=>A({key:"labels.TAB_LAYERS"})+" (Alt+2)",()=>A({key:"hud.project_panel.layers"}),()=>r.studio.projectActiveTab==="frames"?A({key:"hud.actions.add_frame"}):A({key:"hud.actions.add_layer"})]),T(p,B),oe()}Ie(["click","keydown","contextmenu","dblclick"]);var Qi=O('<div class="minimap-container border-b border-charcoal/10 bg-charcoal/5 p-3 transition-all duration-300 svelte-17kdxrh"><div class="relative flex items-center justify-center overflow-hidden rounded border border-charcoal/5 bg-stone-light/20 p-2 shadow-inner"><canvas class="h-auto w-full max-w-[180px] shadow-sm" style="image-rendering: pixelated;"></canvas> <div class="pointer-events-none absolute inset-0 ring-1 ring-brand ring-inset" style="opacity: 0.4;"></div></div></div>');function Xi(p,e){ie(e,!0);let t=C(null);st(()=>{r.canvas.renderPulse;const n=o(t)?.getContext("2d");if(!n||!o(t))return;const{width:l,height:u}=r.canvas,v=r.canvas.compositePixels,h=n.createImageData(l,u);new Uint32Array(h.data.buffer).set(v),n.putImageData(h,0,0)});var a=Qi(),s=d(a),i=d(s);jt(i,n=>w(t,n),()=>o(t)),Pt(2),c(s),c(a),N(()=>{M(i,"width",r.canvas.width),M(i,"height",r.canvas.height)}),T(p,a),oe()}var Wi=O('<aside class="side-panel-left flex h-full w-full flex-col overflow-hidden border-r border-charcoal/10 bg-stone-light/50"><!> <div class="flex-1 overflow-y-auto"><!></div></aside>');function Zi(p,e){ie(e,!1),$e();var t=Wi(),a=d(t);{var s=l=>{Xi(l,{})};H(a,l=>{r.studio.showMinimap&&l(s)})}var i=f(a,2),n=d(i);qi(n,{}),c(i),c(t),T(p,t),oe()}var Ji=O('<button class="group editor-checker-small relative h-5 w-5 shrink-0 rounded border border-charcoal/10 shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[8px]">📍</span></div></button>'),eo=O('<div class="flex h-5 w-5 items-center justify-center rounded border border-dashed border-charcoal/10"><span class="text-[8px] opacity-20">🎨</span></div>'),to=O('<div class="editor-panel flex w-full flex-col gap-4 border-none bg-foam-white p-3 shadow-sm"><div class="flex flex-col items-center gap-2 py-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Active Flavor</span> <div class="editor-checker-small h-10 w-10 rounded border border-charcoal/10 shadow-inner transition-colors"></div> <span class="font-mono text-[9px] font-bold tracking-tight text-charcoal/40 uppercase"> </span></div> <div class="h-px w-full bg-charcoal/5"></div> <div class="flex flex-col gap-2"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Recent Brews</span> <div class="custom-scrollbar flex max-h-[120px] flex-row flex-wrap gap-1.5 overflow-y-auto px-1"></div></div></div>');function ao(p,e){ie(e,!1),$e();var t=to(),a=d(t),s=f(d(a),2),i=f(s,2),n=d(i,!0);c(i),c(a);var l=f(a,4),u=f(d(l),2);Oe(u,5,()=>r.usedColors,v=>v,(v,h)=>{var g=Ji();g.__click=()=>V.color.setColor(o(h)),N(()=>{ge(g,`background-color: ${o(h)??""};`),M(g,"title",o(h))}),ue(3,g,()=>Li,()=>({duration:200})),T(v,g)},v=>{var h=eo();T(v,h)}),c(u),c(l),c(t),N(()=>{ge(s,`background-color: ${r.paletteState.activeColor??""};`),S(n,r.paletteState.activeColor)}),T(p,t),oe()}Ie(["click"]);var ro=O('<div class="editor-panel w-full border-none bg-stone-light/50 p-3 shadow-sm" role="status"><div class="flex flex-col gap-3"><div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div> <div class="h-px w-full bg-charcoal/5" aria-hidden="true"></div> <div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div></div></div>');function so(p,e){ie(e,!1),$e();var t=ro(),a=d(t),s=d(a),i=d(s),n=d(i,!0);c(i);var l=f(i,2),u=d(l);c(l),c(s);var v=f(s,4),h=d(v),g=d(h,!0);c(h);var x=f(h,2),b=d(x);c(x),c(v),c(a),c(t),N((m,_)=>{S(n,m),S(u,`${r.displayCoords.x??""}, ${r.displayCoords.y??""}`),S(g,_),S(b,`${r.canvas.width??""}×${r.canvas.height??""}`)},[()=>A({key:"stats.cursor_focus"}),()=>A({key:"stats.canvas_size"})]),T(p,t),oe()}var Zt=ta(()=>r),io=O('<button role="radio"></button>'),oo=O('<div class="editor-panel flex w-full flex-col gap-3 border-none bg-stone-light/30 p-3 shadow-sm" role="region" aria-label="Color Palette"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <div class="grid grid-cols-4 gap-2" role="radiogroup"><!> <button class="flex h-8 w-8 items-center justify-center rounded border border-dashed border-charcoal/20 bg-charcoal/5 transition-all hover:scale-110 hover:border-brand/40 hover:bg-white"><span class="text-xs opacity-40" aria-hidden="true">＋</span></button></div></div>');function no(p,e){ie(e,!1),$e();var t=oo(),a=d(t),s=d(a,!0);c(a);var i=f(a,2),n=d(i);Oe(n,1,()=>Zt().palette,Be,(u,v,h)=>{var g=io();g.__click=()=>V.color.select(h),N((x,b)=>{re(g,1,`editor-checker-small h-8 w-8 rounded transition-all ${Zt().activeColor===o(v)?"z-10 scale-110 border-2 border-brand shadow-md":"border border-charcoal/5 opacity-80 hover:scale-105 hover:opacity-100"}`),ge(g,`background-color: ${o(v)??""};`),M(g,"aria-label",x),M(g,"title",b),M(g,"aria-checked",Zt().activeColor===o(v))},[()=>A({key:`labels.SELECT_COLOR_${(h+1)%10}`}),()=>A({key:`labels.SELECT_COLOR_${(h+1)%10}`})+` (${(h+1)%10})`]),T(u,g)});var l=f(n,2);l.__click=()=>Zt(Zt().showColorPicker=!0),c(i),c(t),N((u,v,h)=>{S(s,u),M(l,"title",`${v??""} (B)`),M(l,"aria-label",h)},[()=>A({key:"shortcut_groups.colors"}),()=>A({key:"color_picker.title"}),()=>A({key:"color_picker.title"})]),T(p,t),oe()}Ie(["click"]);var lo=O('<div class="absolute top-0 -left-12 flex flex-col items-center gap-1 rounded-md bg-white p-1 shadow-md ring-1 ring-black/5"><button class="flex h-4 w-4 items-center justify-center text-[10px] hover:text-brand">+</button> <span class="font-tiny5 text-[8px] text-brand"> </span> <button class="flex h-4 w-4 items-center justify-center text-[10px] hover:text-brand">-</button> <div class="my-1 h-px w-2 bg-charcoal/10"></div> <div class="flex flex-col items-center gap-0.5"><button class="text-[8px] hover:text-brand">▴</button> <span class="text-[7px] font-bold text-brand/60"> </span> <button class="text-[8px] hover:text-brand">▾</button></div></div>'),co=O('<button><span class="text-sm"> </span></button> <!>',1),uo=O('<button><span class="text-sm"> </span></button>'),vo=O('<button><span class="text-sm"> </span></button>'),ho=O('<div class="absolute -top-1 -right-1 text-[8px]">🔒</div>'),po=O('<button><span class="text-[10px]"> </span> <!></button>'),fo=O('<div class="vessel-toolbar custom-scrollbar flex h-full flex-col items-center gap-4 overflow-y-auto py-4 svelte-9w26m7"><div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div></div>');function go(p,e){ie(e,!1);const t=ja(r.studio),a=[{id:"BRUSH",icon:"🖋️",intent:"TOOL_BRUSH",label:"TOOL_BRUSH"},{id:"ERASER",icon:"🧹",intent:"TOOL_ERASER",label:"TOOL_ERASER"},{id:"SELECT",icon:"✨",intent:"TOOL_SELECT",label:"TOOL_SELECT"},{id:"RECTANGLE",icon:"📦",intent:"TOOL_RECTANGLE",label:"TOOL_RECTANGLE"},{id:"ELLIPSE",icon:"⭕",intent:"TOOL_ELLIPSE",label:"TOOL_ELLIPSE"},{id:"POLYGON",icon:"⭐",intent:"TOOL_POLYGON",label:"TOOL_POLYGON"},{id:"GRADIENT",icon:"🌈",intent:"TOOL_GRADIENT",label:"TOOL_GRADIENT"},{id:"HAND",icon:"🤚",intent:"TOGGLE_HAND_TOOL",label:"TOGGLE_HAND_TOOL"}],s=[{id:"lighten",icon:"☀️",intent:"SHADE_LIGHTEN",active:()=>o(t).isShadingLighten,label:"SHADE_LIGHTEN"},{id:"darken",icon:"🌙",intent:"SHADE_DARKEN",active:()=>o(t).isShadingDarken,label:"SHADE_DARKEN"},{id:"dither",icon:"🏁",intent:"SHADE_DITHER",active:()=>o(t).isShadingDither,label:"SHADE_DITHER"}],i=[{id:"symmetry",icon:"🪞",intent:"CYCLE_SYMMETRY",active:()=>o(t).symmetryMode!=="OFF",label:"CYCLE_SYMMETRY"},{id:"tiling",icon:"∞",intent:"TOGGLE_TILING",active:()=>o(t).isTilingEnabled,label:"TOGGLE_TILING"},{id:"perfect",icon:"✨",intent:"TOGGLE_PIXEL_PERFECT",active:()=>o(t).isPixelPerfect,label:"TOGGLE_PIXEL_PERFECT"},{id:"stencil",icon:"🎨",intent:"TOGGLE_PATTERN_BRUSH",active:()=>o(t).isPatternBrushActive,label:"TOGGLE_PATTERN_BRUSH",disabled:()=>!r.project.clipboard}],n=[{id:"alpha",icon:"A",intent:"TOGGLE_ALPHA_LOCK",active:()=>o(t).isAlphaLocked,label:"TOGGLE_ALPHA_LOCK"},{id:"color",icon:"C",intent:"TOGGLE_COLOR_LOCK",active:()=>o(t).isColorLocked,label:"TOGGLE_COLOR_LOCK"}];$e();var l=fo(),u=d(l);Oe(u,5,()=>a,Be,(x,b)=>{var m=co(),_=be(m);_.__click=()=>gt.handleIntent(o(b).intent);var y=d(_),E=d(y,!0);c(y),c(_);var I=f(_,2);{var G=j=>{var B=lo(),U=d(B);U.__click=()=>gt.handleIntent("POLY_SIDES_INC");var P=f(U,2),R=d(P,!0);c(P);var F=f(P,2);F.__click=()=>gt.handleIntent("POLY_SIDES_DEC");var $=f(F,4),z=d($);z.__click=()=>_t(t,o(t).polygonIndentation=Math.min(100,o(t).polygonIndentation+10));var Y=f(z,2),te=d(Y);c(Y);var ae=f(Y,2);ae.__click=()=>_t(t,o(t).polygonIndentation=Math.max(0,o(t).polygonIndentation-10)),c($),c(B),N(()=>{S(R,o(t).polygonSides),S(te,`${o(t).polygonIndentation??""}%`)}),ue(3,B,()=>ye),T(j,B)};H(I,j=>{o(b).id==="POLYGON"&&o(t).activeTool==="POLYGON"&&j(G)})}N(j=>{re(_,1,`tool-button ${o(t).activeTool===o(b).id?"is-active":""}`,"svelte-9w26m7"),M(_,"title",j),S(E,o(b).icon)},[()=>A({key:`labels.${o(b).label}`})]),T(x,m)}),c(u);var v=f(u,4);Oe(v,5,()=>s,Be,(x,b)=>{var m=uo();m.__click=()=>gt.handleIntent(o(b).intent);var _=d(m),y=d(_,!0);c(_),c(m),N((E,I)=>{re(m,1,`tool-button ${E??""}`,"svelte-9w26m7"),M(m,"title",I),S(y,o(b).icon)},[()=>o(b).active()?"is-active":"",()=>A({key:`labels.${o(b).label}`})]),T(x,m)}),c(v);var h=f(v,4);Oe(h,5,()=>i,Be,(x,b)=>{var m=vo();m.__click=()=>!o(b).disabled?.()&&gt.handleIntent(o(b).intent);var _=d(m),y=d(_,!0);c(_),c(m),N((E,I,G)=>{re(m,1,`tool-button ${E??""} ${I??""}`,"svelte-9w26m7"),M(m,"title",G),S(y,o(b).icon)},[()=>o(b).active()?"is-active":"",()=>o(b).disabled?.()?"cursor-not-allowed opacity-20 grayscale":"",()=>A({key:`labels.${o(b).label}`})]),T(x,m)}),c(h);var g=f(h,4);Oe(g,5,()=>n,Be,(x,b)=>{var m=po();m.__click=()=>gt.handleIntent(o(b).intent);var _=d(m),y=d(_,!0);c(_);var E=f(_,2);{var I=G=>{var j=ho();ue(3,j,()=>Ft),T(G,j)};H(E,G=>{o(b).active()&&G(I)})}c(m),N((G,j)=>{re(m,1,`tool-button ${G??""} font-bold`,"svelte-9w26m7"),M(m,"title",j),S(y,o(b).icon)},[()=>o(b).active()?"is-active":"",()=>A({key:`labels.${o(b).label}`})]),T(x,m)}),c(g),c(l),T(p,l),oe()}Ie(["click"]);var xo=O('<aside class="side-panel-right flex h-full w-full border-l border-charcoal/10 bg-foam-white/50"><div class="flex h-full flex-col border-r border-charcoal/5 bg-charcoal/[0.02] px-2"><!></div> <div class="flex flex-1 flex-col gap-4 p-3"><div class="flex flex-col gap-3"><!> <!></div> <div class="flex-1"></div> <!></div></aside>');function mo(p){var e=xo(),t=d(e),a=d(t);go(a,{}),c(t);var s=f(t,2),i=d(s),n=d(i);ao(n,{});var l=f(n,2);no(l,{}),c(i);var u=f(i,4);so(u,{}),c(s),c(e),T(p,e)}var bo=O('<span class="text-xs" aria-hidden="true"> </span>'),yo=O('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),_o=O("<div><!> <span> </span> <!></div>"),Ao=O('<div class="text-[8px] font-bold tracking-[0.2em] text-studio-text/20 uppercase"> </div>'),wo=O('<div class="flex items-center gap-4 transition-opacity duration-1000" role="status" aria-live="polite"><div class="flex w-[180px] items-center"><!></div> <!></div>');function ko(p,e){ie(e,!1),$e();var t=wo(),a=d(t),s=d(a);hs(s,()=>Fe.current.type,l=>{var u=_o(),v=d(u);{var h=_=>{var y=bo(),E=d(y,!0);c(y),N(()=>S(E,Fe.current.icon)),T(_,y)};H(v,_=>{Fe.current.icon&&_(h)})}var g=f(v,2),x=d(g,!0);c(g);var b=f(g,2);{var m=_=>{var y=yo(),E=d(y);c(y),N(()=>S(E,`v${r.version??""}`)),T(_,y)};H(b,_=>{Fe.current.type==="READY"&&_(m)})}c(u),N(()=>{re(u,1,`status-tag flex items-center gap-2 ${Fe.current.isPulse?"animate-pulse":""}`),ge(u,`
					border-color: color-mix(in srgb, ${Fe.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${Fe.current.color??""} 10%, transparent);
					color: ${Fe.current.color??""};
				`),re(g,1,As(Fe.current.type==="READY"?"font-serif italic opacity-60":"font-bold")),S(x,Fe.current.label)}),T(l,u)}),c(a);var i=f(a,2);{var n=l=>{const u=ea(()=>r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var v=Ao(),h=d(v,!0);c(v),N((g,x)=>{M(v,"aria-label",g),S(h,x)},[()=>A({key:"project.saved",replace:{time:o(u)}}),()=>A({key:"project.saved",replace:{time:o(u)}})]),T(l,v)};H(i,l=>{r.project.lastSaved&&l(n)})}c(t),T(p,t),oe()}var Eo=O('<span class="rounded border border-charcoal/20 bg-charcoal/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-charcoal uppercase"> </span>'),So=O('<span class="font-mono text-[9px] text-charcoal/40 italic"> </span>'),To=O('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"> </span> <div class="flex min-w-[80px] gap-1.5"><!></div></div>');function Lo(p,e){ie(e,!1),$e();var t=To(),a=d(t),s=d(a);c(a);var i=f(a,2),n=d(i);{var l=v=>{var h=Ye(),g=be(h);Oe(g,1,()=>rt.activeKeys,Be,(x,b)=>{var m=Eo(),_=d(m,!0);c(m),N(()=>S(_,o(b)===" "?"Space":o(b))),T(x,m)}),T(v,h)},u=v=>{var h=So(),g=d(h,!0);c(h),N(x=>S(g,x),[()=>A({key:"timeline.waiting"})]),T(v,h)};H(n,v=>{rt.activeKeys.length>0?v(l):v(u,!1)})}c(i),c(t),N(v=>S(s,`${v??""}:`),[()=>A({key:"timeline.rhythm"})]),T(p,t),oe()}var Co=O('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"> </span> <span class="font-mono text-[9px] font-bold text-charcoal uppercase"> </span></div>');function Io(p,e){ie(e,!1),$e();var t=Co(),a=d(t),s=d(a);c(a);var i=f(a,2),n=d(i,!0);c(i),c(t),N(l=>{S(s,`${l??""}:`),S(n,Fe.current.type)},[()=>A({key:"timeline.mode"})]),T(p,t),oe()}var Po=O('<div class="flex items-center gap-1.5"><span aria-hidden="true">🎹</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"><!></span></div>');function Mo(p,e){ie(e,!1),$e();var t=Po(),a=d(t),s=f(a,2),i=d(s);{var n=u=>{var v=dt();N(h=>S(v,h),[()=>A({key:"timeline.audio_status.silent"})]),T(u,v)},l=u=>{var v=Ye(),h=be(v);{var g=b=>{var m=dt();N(_=>S(m,_),[()=>A({key:"timeline.audio_status.brewing"})]),T(b,m)},x=b=>{var m=dt();N(_=>S(m,_),[()=>A({key:"timeline.audio_status.resonant"})]),T(b,m)};H(h,b=>{r.usageMinutes<60?b(g):b(x,!1)},!0)}T(u,v)};H(i,u=>{r.usageMinutes<30?u(n):u(l,!1)})}c(s),c(t),N(u=>{M(t,"title",u),re(a,1,`text-[9px] ${r.usageMinutes>=30?"animate-pulse":"opacity-40 grayscale"}`)},[()=>A({key:"timeline.audio_status.title"})]),T(p,t),oe()}var Oo=O('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">⏱️</span> <span class="font-mono text-[9px] font-bold text-charcoal/80 tabular-nums"> </span></div>');function Ro(p,e){ie(e,!1),$e();var t=Oo(),a=f(d(t),2),s=d(a,!0);c(a),c(t),N(i=>{M(t,"title",i),S(s,r.studio.sessionTimeLabel)},[()=>A({key:"timeline.duration"})]),T(p,t),oe()}var $t=ta(()=>r),Do=O('<button class="flex items-center gap-1 rounded bg-brand/10 px-2 py-0.5 font-serif text-[8px] font-bold tracking-widest text-brand uppercase transition-all hover:bg-brand hover:text-white" title="Selection Propagation (Syrup Flow)"><span aria-hidden="true">🍯</span> </button>'),jo=O('<div class="flex items-center gap-3"><div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">✨</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/60 uppercase italic"> </span></div> <!></div>');function Fo(p,e){ie(e,!1),$e();var t=jo(),a=d(t),s=f(d(a),2),i=d(s,!0);c(s),c(a);var n=f(a,2);{var l=u=>{var v=Do();v.__click=()=>$t($t().studio.showPourBasin=!0);var h=f(d(v));c(v),N(g=>S(h,` ${g??""}`),[()=>A({key:"export.propagation.title"})]),T(u,v)};H(n,u=>{$t().selection.isActive&&$t().project.frames.length>1&&u(l)})}c(t),N(u=>S(i,u),[()=>A({key:$t().selection.indices.length>1?"timeline.pixel_count_plural":"timeline.pixel_count",replace:{count:$t().selection.indices.length}})]),T(p,t),oe()}Ie(["click"]);var Go=O('<div class="flex items-center gap-1.5"><span class="text-[10px]" aria-hidden="true">💾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand/80 uppercase"> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div>',1),Bo=O('<div class="flex items-center gap-3 text-charcoal/40" role="status"><!> <div class="flex gap-3 font-mono text-[9px] font-bold tracking-tight text-charcoal/60 uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div> <span class="font-mono text-[10px] font-black tracking-widest text-brand/60 uppercase"> </span></div>');function $o(p,e){ie(e,!1),$e();var t=Bo(),a=d(t);{var s=m=>{var _=Go(),y=be(_),E=f(d(y),2),I=d(E,!0);c(E),c(y),Pt(2),N(G=>S(I,G),[()=>A({key:"project.saved",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}})]),ue(3,y,()=>ye),T(m,_)};H(a,m=>{r.project.lastSaved&&m(s)})}var i=f(a,2),n=d(i),l=d(n);c(n);var u=f(n,2),v=d(u);c(u);var h=f(u,2),g=d(h);c(h),c(i);var x=f(i,4),b=d(x,!0);c(x),c(t),N((m,_)=>{S(l,`POS: ${r.cursor.pos.x??""},${r.cursor.pos.y??""}`),S(v,`SIZE: ${r.canvas.width??""}x${r.canvas.height??""}`),S(g,`ZOOM: ${m??""}%`),S(b,_)},[()=>Math.round(r.studio.zoomLevel*100),()=>A({key:"stats.technical_details"})]),T(p,t),oe()}var No=O('<div class="flex items-center gap-1 rounded-sm bg-brand/5 px-1.5 py-0.5 text-brand"><span class="text-[8px] font-bold">SYM:</span> <span class="font-black"><!></span></div>'),Uo=O("<span>🔒A</span>"),Vo=O("<span>🔒C</span>"),Ho=O('<div class="flex items-center gap-1 text-brand"><!> <!></div>'),zo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">∞</div>'),Yo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">☁️ MIST</div>'),Ko=O('<div class="bg-green-leaves/10 text-green-leaves flex items-center gap-1 rounded-sm px-1.5 py-0.5 font-bold">✨ PURE</div>'),qo=O('<div class="flex animate-pulse items-center gap-1 rounded-sm bg-brand/20 px-1.5 py-0.5 font-bold text-brand">🚚 MOVING</div>'),Qo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🎨 STENCIL</div>'),Xo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🌈 GRADIENT</div>'),Wo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">📦 BOX</div>'),Zo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">⭕ ROUND</div>'),Jo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand"> </div>'),en=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">☀️ LIGHT</div>'),tn=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🌙 DARK</div>'),an=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🏁 DITHER</div>'),rn=O('<div class="flex items-center gap-3 font-serif text-[10px] tracking-wide text-charcoal/60"><div class="flex items-center gap-1"><span class="text-[8px] uppercase opacity-40"> </span> <span class="font-bold text-brand"> </span> <span class="opacity-40"> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!></div>');function sn(p,e){ie(e,!1);const t=r.studio;$e();var a=rn(),s=d(a),i=d(s),n=d(i,!0);c(i);var l=f(i,2),u=d(l);c(l);var v=f(l,2),h=d(v,!0);c(v),c(s);var g=f(s,2);{var x=L=>{var k=No(),D=f(d(k),2),W=d(D);{var q=X=>{var de=dt("—");T(X,de)},he=X=>{var de=Ye(),we=be(de);{var Ve=Pe=>{var xe=dt("|");T(Pe,xe)},Je=Pe=>{var xe=dt("+");T(Pe,xe)};H(we,Pe=>{t.symmetryMode==="VERTICAL"?Pe(Ve):Pe(Je,!1)},!0)}T(X,de)};H(W,X=>{t.symmetryMode==="HORIZONTAL"?X(q):X(he,!1)})}c(D),c(k),N(X=>M(k,"title",X),[()=>A({key:"labels.CYCLE_SYMMETRY"})]),ue(3,k,()=>ye),T(L,k)};H(g,L=>{t.symmetryMode!=="OFF"&&L(x)})}var b=f(g,2);{var m=L=>{var k=Ho(),D=d(k);{var W=X=>{var de=Uo();N(we=>M(de,"title",we),[()=>A({key:"labels.TOGGLE_ALPHA_LOCK"})]),T(X,de)};H(D,X=>{t.isAlphaLocked&&X(W)})}var q=f(D,2);{var he=X=>{var de=Vo();N(we=>M(de,"title",we),[()=>A({key:"labels.TOGGLE_COLOR_LOCK"})]),T(X,de)};H(q,X=>{t.isColorLocked&&X(he)})}c(k),ue(3,k,()=>ye),T(L,k)};H(b,L=>{(t.isAlphaLocked||t.isColorLocked)&&L(m)})}var _=f(b,2);{var y=L=>{var k=zo();N(D=>M(k,"title",D),[()=>A({key:"labels.TOGGLE_TILING"})]),ue(3,k,()=>ye),T(L,k)};H(_,L=>{t.isTilingEnabled&&L(y)})}var E=f(_,2);{var I=L=>{var k=Yo();N(D=>M(k,"title",D),[()=>A({key:"labels.TOGGLE_AIRBRUSH"})]),ue(3,k,()=>ye),T(L,k)};H(E,L=>{t.isAirbrushActive&&L(I)})}var G=f(E,2);{var j=L=>{var k=Ko();N(D=>M(k,"title",D),[()=>A({key:"labels.TOGGLE_PIXEL_PERFECT"})]),ue(3,k,()=>ye),T(L,k)};H(G,L=>{t.isPixelPerfect&&L(j)})}var B=f(G,2);{var U=L=>{var k=qo();N(D=>M(k,"title",D),[()=>A({key:"labels.TOOL_TRANSFORM"})]),ue(3,k,()=>ye),T(L,k)};H(B,L=>{t.isTransforming&&L(U)})}var P=f(B,2);{var R=L=>{var k=Qo();N(D=>M(k,"title",D),[()=>A({key:"labels.TOGGLE_PATTERN_BRUSH"})]),ue(3,k,()=>ye),T(L,k)};H(P,L=>{t.isPatternBrushActive&&L(R)})}var F=f(P,2);{var $=L=>{var k=Xo();N(D=>M(k,"title",D),[()=>A({key:"labels.TOOL_GRADIENT"})]),ue(3,k,()=>ye),T(L,k)};H(F,L=>{t.activeTool==="GRADIENT"&&L($)})}var z=f(F,2);{var Y=L=>{var k=Wo();N(D=>M(k,"title",D),[()=>A({key:"labels.TOOL_RECTANGLE"})]),ue(3,k,()=>ye),T(L,k)};H(z,L=>{t.activeTool==="RECTANGLE"&&L(Y)})}var te=f(z,2);{var ae=L=>{var k=Zo();N(D=>M(k,"title",D),[()=>A({key:"labels.TOOL_ELLIPSE"})]),ue(3,k,()=>ye),T(L,k)};H(te,L=>{t.activeTool==="ELLIPSE"&&L(ae)})}var Q=f(te,2);{var se=L=>{var k=Jo(),D=d(k);c(k),N(W=>{M(k,"title",W),S(D,`⭐ POLY (${t.polygonSides??""})`)},[()=>A({key:"labels.TOOL_POLYGON"})]),ue(3,k,()=>ye),T(L,k)};H(Q,L=>{t.activeTool==="POLYGON"&&L(se)})}var me=f(Q,2);{var Se=L=>{var k=en();N(D=>M(k,"title",D),[()=>A({key:"labels.TOGGLE_SHADE_LIGHTEN"})]),ue(3,k,()=>ye),T(L,k)};H(me,L=>{t.isShadingLighten&&L(Se)})}var _e=f(me,2);{var Re=L=>{var k=tn();N(D=>M(k,"title",D),[()=>A({key:"labels.TOGGLE_SHADE_DARKEN"})]),ue(3,k,()=>ye),T(L,k)};H(_e,L=>{t.isShadingDarken&&L(Re)})}var Ne=f(_e,2);{var J=L=>{var k=an();N(D=>M(k,"title",D),[()=>A({key:"labels.TOGGLE_SHADE_DITHER"})]),ue(3,k,()=>ye),T(L,k)};H(Ne,L=>{t.isShadingDither&&L(J)})}c(a),N((L,k)=>{M(s,"title",L),S(n,k),S(u,`${t.brushSize??""}px`),S(h,t.brushShape==="SQUARE"?"■":"●")},[()=>A({key:"labels.BRUSH_SIZE_INC"}),()=>A({key:"shortcut_groups.etching"})]),T(p,a),oe()}var on=O('<div class="flex flex-1 items-center justify-between px-3 opacity-80 transition-opacity hover:opacity-100"><div class="flex items-center gap-4"><!> <div class="h-3 w-px bg-charcoal/20"></div> <!> <div class="h-3 w-px bg-charcoal/20"></div> <div class="flex items-center gap-3"><!> <div class="h-3 w-px bg-charcoal/20"></div> <!> <!> <div class="h-3 w-px bg-charcoal/20"></div> <!></div></div> <!></div>');function nn(p){var e=on(),t=d(e),a=d(t);Lo(a,{});var s=f(a,4);Io(s,{});var i=f(s,4),n=d(i);sn(n,{});var l=f(n,4);Ro(l,{});var u=f(l,2);Mo(u,{});var v=f(u,4);Fo(v,{}),c(i),c(t);var h=f(t,2);$o(h,{}),c(e),T(p,e)}var ot=ta(()=>r),ln=O('<div class="flex items-center gap-4 border-r border-black/5 pr-4" role="toolbar" aria-label="Timeline Controls"><button><span class="text-xs" aria-hidden="true"> </span> <span class="font-tiny5 tracking-widest uppercase"> </span></button> <div class="flex items-center gap-2 rounded-xl bg-black/5 px-3 py-1 ring-1 ring-black/5"><label for="pace-input" class="font-serif text-[11px] font-black tracking-tight text-studio-text/50 uppercase"> </label> <input id="pace-input" type="number" min="1" max="60" class="w-10 bg-transparent text-center font-mono text-sm font-bold text-studio-text focus:outline-none"/> <span class="font-serif text-[10px] font-black text-studio-text/30" aria-hidden="true">FPS</span></div> <button><span class="text-xs" aria-hidden="true">👻</span> <span class="font-serif text-[11px] font-black tracking-wider text-studio-text/70 uppercase">Ghosts</span></button> <div class="flex items-center gap-2 border-l border-black/5 pl-4"><span class="text-xs opacity-40" aria-hidden="true">🔍</span> <input type="range" min="0.5" max="4" step="0.1" class="editor-range w-20 svelte-cffdjb" title="Timeline Zoom"/> <span class="w-8 font-mono text-[10px] font-bold text-studio-text/40"> </span></div></div>');function cn(p,e){ie(e,!1),$e();var t=ln(),a=d(t);a.__click=()=>Ba.togglePlayback();var s=d(a),i=d(s,!0);c(s);var n=f(s,2),l=d(n,!0);c(n),c(a);var u=f(a,2),v=d(u),h=d(v,!0);c(v);var g=f(v,2);Ee(g),Pt(2),c(u);var x=f(u,2);x.__click=()=>ot(ot().studio.showGhostLayers=!ot().studio.showGhostLayers);var b=f(x,2),m=f(d(b),2);Ee(m);var _=f(m,2),y=d(_);c(_),c(b),c(t),N((E,I,G,j,B,U)=>{re(a,1,`editor-primary-btn flex items-center gap-2 !px-4 !py-1.5 text-xs ${ot().project.isPlaying?"bg-brand":"bg-slate-700"}`),M(a,"title",E),M(a,"aria-label",I),S(i,ot().project.isPlaying?"⏹":"▶"),S(l,ot().project.isPlaying?"Stop":"Play"),S(h,G),re(x,1,`flex items-center gap-2 rounded-xl px-3 py-1.5 transition-all ${ot().studio.showGhostLayers?"bg-brand/10 text-brand ring-1 ring-brand/20":"bg-black/5 opacity-40 shadow-sm hover:bg-white/60 hover:opacity-100"}`),M(x,"title",j),M(x,"aria-label",B),S(y,`${U??""}%`)},[()=>A({key:"labels.PLAY_PAUSE"})+" (P)",()=>A({key:"labels.PLAY_PAUSE"}),()=>A({key:"export.fps_label"}),()=>A({key:"labels.TOGGLE_GHOST_LAYERS"})+" (Alt+G)",()=>A({key:"labels.TOGGLE_GHOST_LAYERS"}),()=>Math.round(ot().studio.timelineZoom*100)]),Ce(g,()=>ot().studio.fps,E=>ot(ot().studio.fps=E)),Ce(m,()=>ot().studio.timelineZoom,E=>ot(ot().studio.timelineZoom=E)),T(p,t),oe()}Ie(["click"]);var dn=O('<div style="width: var(--frame-width);"><div></div></div>');function un(p,e){ie(e,!0);let t=K(()=>e.layer?.hasContent||!1);var a=dn();a.__click=function(...i){e.onclick?.apply(this,i)};var s=d(a);c(a),N(()=>{re(a,1,`flex h-6 items-center justify-center border-r border-black/5 transition-colors ${e.isActive?"bg-brand/10":"hover:bg-black/5"}`),re(s,1,`h-2 w-2 rounded-full transition-all ${o(t)?"scale-110 bg-brand shadow-sm":"border border-charcoal/20 bg-transparent opacity-30"} ${e.isActive?"ring-4 ring-brand/20":""}`)}),T(p,a),oe()}Ie(["click"]);var vn=O('<div class="group absolute top-0 flex h-4 items-center justify-center rounded-t border-x border-t border-black/10 px-2 transition-all hover:h-5"><span class="truncate font-serif text-[8px] font-black text-studio-text/60 uppercase"> </span> <button class="ml-1 hidden h-3 w-3 items-center justify-center rounded-full bg-black/10 text-[6px] group-hover:flex hover:bg-brand hover:text-white">✕</button></div>');function hn(p,e){ie(e,!0);const t=32;let a=K(()=>e.tag.from*t),s=K(()=>(e.tag.to-e.tag.from+1)*t);function i(){V.project.removeTag(e.tag.id)}var n=vn(),l=d(n),u=d(l,!0);c(l);var v=f(l,2);v.__click=i,c(n),N(()=>{ge(n,`left: ${o(a)??""}px; width: ${o(s)??""}px; background-color: ${e.tag.color??""}44; border-top-color: ${e.tag.color??""};`),M(n,"title",e.tag.name),S(u,e.tag.name)}),T(p,n),oe()}Ie(["click"]);var pn=O('<div class="h-4 shrink-0 overflow-hidden bg-black/5"><div class="relative h-full"></div></div>'),fn=O('<div class="absolute flex flex-col items-center"><div class="h-1 w-px bg-charcoal/20"></div> <span class="font-mono text-[8px] font-black text-charcoal/30"> </span></div>'),gn=O('<button><span class="truncate font-serif text-[9px] font-bold uppercase"> </span></button>'),xn=O('<div class="flex h-6 border-b border-black/5"></div>'),mn=O('<div class="relative flex flex-1 flex-col overflow-hidden rounded border border-charcoal/10 bg-stone-light/30 shadow-inner"><!> <div class="flex h-6 shrink-0 border-b border-charcoal/5 bg-foam-white/95"><div class="z-40 flex w-32 shrink-0 items-center border-r border-charcoal/10 px-2 font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Infusions</div> <div class="relative flex-1 overflow-hidden" role="presentation"><div class="absolute inset-0 flex items-center"></div></div></div> <div class="custom-scrollbar flex-1 overflow-y-auto svelte-8wcczq"><div class="relative flex min-h-full"><div class="sticky left-0 z-30 flex w-32 shrink-0 flex-col border-r border-charcoal/10 bg-foam-white/95 shadow-sm"></div> <div class="custom-scrollbar relative flex-1 overflow-x-auto svelte-8wcczq" role="grid" aria-label="The Drop Matrix"><div class="relative flex flex-col"><!> <div class="pointer-events-none absolute top-0 bottom-0 z-20 w-px bg-brand transition-all duration-100 ease-out"><div class="absolute -top-0.5 -left-1 h-2 w-2 rotate-45 rounded-sm bg-brand shadow-sm"></div></div></div></div></div></div></div>');function bn(p,e){ie(e,!0);let t=C(void 0),a=C(0);const s=32;function i(F){const $=F.target;w(a,$.scrollLeft,!0)}function n(F,$){r.project.activeFrameIndex=F,r.project.activeFrame.activeLayerIndex=$}let l=K(()=>r.project.activeFrameIndex*s+s/2);st(()=>{if(o(t)&&r.project.isPlaying){const F=o(t).clientWidth/2;o(l)>F&&(o(t).scrollLeft=o(l)-F)}});let u=K(()=>{const F=[];for(let $=0;$<r.project.frames.length;$+=5)F.push($);return(r.project.frames.length-1)%5!==0&&F.push(r.project.frames.length-1),F}),v=K(()=>r.project.frames.length*s+200);function h(F){const $=F.currentTarget.getBoundingClientRect(),z=F.clientX-$.left+o(a),Y=Math.floor(z/s);Y>=0&&Y<r.project.frames.length&&(r.project.activeFrameIndex=Y)}function g(F){if(F.ctrlKey){F.preventDefault();const $=F.deltaY>0?-.1:.1;r.studio.timelineZoom=Math.max(.5,Math.min(4,r.studio.timelineZoom+$))}}var x=mn(),b=d(x);{var m=F=>{var $=pn(),z=d($);Oe(z,21,()=>r.project.tags,Y=>Y.id,(Y,te)=>{hn(Y,{get tag(){return o(te)}})}),c(z),c($),N(()=>ge(z,`width: ${o(v)??""}px; margin-left: 128px; transform: translateX(-${o(a)??""}px);`)),T(F,$)};H(b,F=>{r.project.tags.length>0&&F(m)})}var _=f(b,2),y=f(d(_),2);y.__click=h;var E=d(y);Oe(E,21,()=>o(u),Be,(F,$)=>{var z=fn(),Y=f(d(z),2),te=d(Y,!0);c(Y),c(z),N(()=>{ge(z,`left: ${o($)*s}px; width: 32px;`),S(te,o($)+1)}),T(F,z)}),c(E),c(y),c(_);var I=f(_,2),G=d(I),j=d(G);Oe(j,21,()=>r.project.activeFrame.layers,Be,(F,$,z)=>{var Y=gn();Y.__click=()=>r.project.activeFrame.activeLayerIndex=z;var te=d(Y),ae=d(te,!0);c(te),c(Y),N(()=>{re(Y,1,`flex h-6 w-full items-center px-2 text-left transition-colors ${z===r.project.activeFrame.activeLayerIndex?"bg-brand/5 text-brand":"text-charcoal/60 hover:bg-black/5"}`),S(ae,o($).name)}),T(F,Y)}),c(j);var B=f(j,2),U=d(B),P=d(U);Oe(P,17,()=>r.project.activeFrame.layers,Be,(F,$,z)=>{var Y=xn();Oe(Y,21,()=>r.project.frames,Be,(te,ae,Q)=>{{let se=K(()=>Q===r.project.activeFrameIndex&&z===r.project.activeFrame.activeLayerIndex);un(te,{get layer(){return o(ae).layers[z]},frameIndex:Q,get isActive(){return o(se)},onclick:()=>n(Q,z)})}}),c(Y),T(F,Y)});var R=f(P,2);c(U),c(B),jt(B,F=>w(t,F),()=>o(t)),c(G),c(I),c(x),N(()=>{ge(E,`width: ${o(v)??""}px; transform: translateX(-${o(a)??""}px);`),ge(U,`width: ${o(v)??""}px;`),ge(R,`left: ${o(l)??""}px;`)}),We("wheel",x,g),We("scroll",B,i),T(p,x),oe()}Ie(["click"]);var yn=O('<div class="mr-4 flex flex-col items-end"><span class="font-serif text-[7px] font-black tracking-widest text-charcoal/20 uppercase"> </span> <span class="font-mono text-[9px] font-bold text-brand/40"> </span></div>'),_n=O('<span class="mr-4 font-mono text-[8px] font-bold text-brand/40"> </span>'),An=O('<div role="region" aria-label="Timeline"><div class="flex items-center justify-between border-b border-charcoal/5 pb-1"><div class="flex items-center gap-6"><div class="flex items-center gap-2"><span class="text-[10px] opacity-30" aria-hidden="true">⏳</span> <span class="font-tiny5 text-[9px] tracking-[0.2em] text-charcoal/40 uppercase"> </span></div> <!></div> <div class="flex items-center gap-4"><!> <div class="flex items-center gap-1 border-l border-charcoal/10 pl-4"><button class="flex h-5 w-5 items-center justify-center rounded transition-colors hover:bg-black/5"><span class="text-[10px] opacity-40"> </span></button> <button class="flex h-5 w-5 items-center justify-center rounded transition-colors hover:bg-black/5"><span class="text-[10px] opacity-40"> </span></button></div></div></div> <!></div>');function wn(p,e){ie(e,!0);let t=K(()=>r.studio.isTimelineMinimized?"h-8":r.studio.isTimelineMaximized?"h-[75vh]":"h-40");function a(){r.studio.isTimelineMinimized=!r.studio.isTimelineMinimized,r.studio.isTimelineMinimized&&(r.studio.isTimelineMaximized=!1)}function s(){r.studio.isTimelineMaximized=!r.studio.isTimelineMaximized,r.studio.isTimelineMaximized&&(r.studio.isTimelineMinimized=!1)}var i=An(),n=d(i),l=d(n),u=d(l),v=f(d(u),2),h=d(v,!0);c(v),c(u);var g=f(u,2);{var x=$=>{cn($,{})};H(g,$=>{r.studio.isTimelineMinimized||$(x)})}c(l);var b=f(l,2),m=d(b);{var _=$=>{var z=yn(),Y=d(z),te=d(Y,!0);c(Y);var ae=f(Y,2),Q=d(ae,!0);c(ae),c(z),N((se,me)=>{S(te,se),S(Q,me)},[()=>A({key:"timeline.track"}),()=>A({key:"timeline.frame_count",replace:{count:r.project.frames.length}})]),T($,z)},y=$=>{var z=_n(),Y=d(z,!0);c(z),N(te=>S(Y,te),[()=>A({key:"timeline.frame_count",replace:{count:r.project.frames.length}})]),T($,z)};H(m,$=>{r.studio.isTimelineMinimized?$(y,!1):$(_)})}var E=f(m,2),I=d(E);I.__click=a;var G=d(I),j=d(G,!0);c(G),c(I);var B=f(I,2);B.__click=s;var U=d(B),P=d(U,!0);c(U),c(B),c(E),c(b),c(n);var R=f(n,2);{var F=$=>{bn($,{})};H(R,$=>{r.studio.isTimelineMinimized||$(F)})}c(i),N($=>{re(i,1,`flex ${o(t)??""} w-full flex-col gap-1 overflow-hidden bg-transparent px-4 py-2 transition-all duration-300 ease-in-out`),S(h,$),M(I,"title",r.studio.isTimelineMinimized?"Restore":"Minimize"),S(j,r.studio.isTimelineMinimized?"🔼":"🔽"),M(B,"title",r.studio.isTimelineMaximized?"Restore":"Maximize"),S(P,r.studio.isTimelineMaximized?"🗗":"⏫")},[()=>A({key:"timeline.title"})]),T(p,i),oe()}Ie(["click"]);var kn=O('<footer class="hud-panel flex w-full flex-col border-t border-charcoal/10 bg-foam-white p-1 svelte-1tnr1yh"><!> <div class="flex h-7 w-full items-center justify-between px-4"><div class="flex items-center gap-4"><!></div> <!></div></footer>');function En(p){var e=kn(),t=d(e);wn(t,{});var a=f(t,2),s=d(a),i=d(s);ko(i,{}),c(s);var n=f(s,2);nn(n),c(a),c(e),T(p,e)}var Sn=O('<div class="absolute top-0 bottom-0 left-1/2 z-30 w-px -translate-x-1/2 border-l border-dashed border-brand shadow-sm"></div>'),Tn=O('<div class="absolute top-1/2 right-0 left-0 z-30 h-px -translate-y-1/2 border-t border-dashed border-brand shadow-sm"></div>'),Ln=O('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-charcoal/20"></div>'),Cn=O('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-charcoal/20"></div>'),In=O('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-charcoal/40"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-charcoal/40"></div> <!> <!> <!> <!></div>');function Pn(p,e){ie(e,!1);const t=r.studio;$e();var a=In(),s=f(d(a),4);{var i=h=>{var g=Sn();ue(3,g,()=>ye),T(h,g)};H(s,h=>{(t.symmetryMode==="HORIZONTAL"||t.symmetryMode==="QUADRANT")&&h(i)})}var n=f(s,2);{var l=h=>{var g=Tn();ue(3,g,()=>ye),T(h,g)};H(n,h=>{(t.symmetryMode==="VERTICAL"||t.symmetryMode==="QUADRANT")&&h(l)})}var u=f(n,2);Oe(u,0,()=>[-24,-16,-8,8,16,24],Be,(h,g)=>{const x=ea(()=>Ze.getGuidePosition(g,r.canvas.width));var b=Ye(),m=be(b);{var _=y=>{var E=Ln();N(()=>ge(E,`left: ${o(x)??""}%`)),T(y,E)};H(m,y=>{o(x)>0&&o(x)<100&&y(_)})}T(h,b)});var v=f(u,2);Oe(v,0,()=>[-24,-16,-8,8,16,24],Be,(h,g)=>{const x=ea(()=>Ze.getGuidePosition(g,r.canvas.height));var b=Ye(),m=be(b);{var _=y=>{var E=Cn();N(()=>ge(E,`top: ${o(x)??""}%`)),T(y,E)};H(m,y=>{o(x)>0&&o(x)<100&&y(_)})}T(h,b)}),c(a),T(p,a),oe()}var Mn=mt('<line stroke-dasharray="0.2, 0.2" class="marching-ants-svg svelte-1onh8x1"></line>'),On=mt('<line stroke="var(--color-brand)" stroke-width="0.05" stroke-dasharray="0.1, 0.1"></line>'),Rn=mt('<circle r="0.2" fill="var(--color-brand)"></circle><!>',1),Dn=mt('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><defs><pattern id="ants" width="1" height="1" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="1" y2="0" stroke="var(--ants-color)" stroke-width="0.1" stroke-dasharray="0.2, 0.2"></line></pattern></defs><!><!></svg><svg class="pointer-events-none absolute inset-0 z-[39] h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><path fill="var(--color-brand)" fill-opacity="0.1"></path></svg>',1);function jn(p,e){ie(e,!0);let t=K(()=>r.selection.getBoundaryEdges(r.canvas.width)),a=K(()=>r.selection.vertices),s=K(()=>Fe.current.type==="SELECT");var i=Ye(),n=be(i);{var l=u=>{var v=Dn(),h=be(v),g=f(d(h));Oe(g,17,()=>o(t),Be,(y,E)=>{var I=Mn();M(I,"stroke-width",.08),N(()=>{M(I,"x1",o(E).x1),M(I,"y1",o(E).y1),M(I,"x2",o(E).x2),M(I,"y2",o(E).y2),M(I,"stroke",o(s)?"var(--color-brand)":"rgba(211, 54, 130, 0.8)")}),T(y,I)});var x=f(g);{var b=y=>{var E=Ye(),I=be(E);Oe(I,17,()=>o(a),Be,(G,j,B)=>{const U=K(()=>o(a)[B+1]||o(a)[0]);var P=Rn(),R=be(P),F=f(R);{var $=z=>{var Y=On();N(()=>{M(Y,"x1",o(j).x+.5),M(Y,"y1",o(j).y+.5),M(Y,"x2",o(U).x+.5),M(Y,"y2",o(U).y+.5)}),T(z,Y)};H(F,z=>{o(a).length>1&&B<o(a).length-(o(a).length>=3?0:1)&&z($)})}N(()=>{M(R,"cx",o(j).x+.5),M(R,"cy",o(j).y+.5)}),T(G,P)}),T(y,E)};H(x,y=>{o(a).length>0&&y(b)})}c(h);var m=f(h),_=d(m);c(m),N(y=>{M(h,"viewBox",`0 0 ${r.canvas.width??""} ${r.canvas.height??""}`),M(m,"viewBox",`0 0 ${r.canvas.width??""} ${r.canvas.height??""}`),M(_,"d",y)},[()=>r.selection.getPoints(r.canvas.width).map(y=>`M${y.x},${y.y}h1v1h-1z`).join(" ")]),T(u,v)};H(n,u=>{r.selection.isActive&&u(l)})}T(p,i),oe()}var Fn=O('<canvas class="pointer-events-none absolute inset-0 z-0 h-full w-full"></canvas>');function Gn(p,e){ie(e,!0);let t=Le(e,"opacity",3,.2),a=Le(e,"tint",3,null),s=C(null);st(()=>{const n=o(s)?.getContext("2d");if(!(!n||!o(s))){n.imageSmoothingEnabled=!1,n.clearRect(0,0,e.width,e.height);for(let l=0;l<e.pixels.length;l++){const u=e.pixels[l];if(u!==0){const v=a()||ne.uint32ToHex(u);n.fillStyle=v;const h=l%e.width,g=Math.floor(l/e.width);n.fillRect(h,g,1,1)}}}});var i=Fn();jt(i,n=>w(s,n),()=>o(s)),N(()=>{M(i,"width",e.width),M(i,"height",e.height),ge(i,`opacity: ${t()??""}; image-rendering: pixelated;`)}),T(p,i),oe()}var Bn=O('<div class="absolute flex items-center justify-center"><span class="font-mono text-[8px] font-bold text-charcoal/40"> </span></div>'),$n=O('<div class="pointer-events-none relative h-full w-full overflow-hidden bg-latte-foam/80 backdrop-blur-sm" role="presentation"><div><div></div> <div></div> <!> <div class="absolute z-20 bg-brand transition-all duration-75 ease-out"><div class="absolute top-1/2 left-1/2 rounded-sm bg-brand px-1 py-0.5 shadow-sm"><span class="font-mono text-[9px] leading-none font-bold text-white"> </span></div></div></div></div>');function er(p,e){ie(e,!0);let t=Le(e,"orientation",3,"horizontal"),a=K(()=>r.canvas.width),s=K(()=>r.canvas.height),i=K(()=>t()==="horizontal"?o(a):o(s)),n=K(()=>t()==="horizontal"?r.cursor.pos.x:r.cursor.pos.y),l=K(()=>{const B=r.studio.zoomLevel;return B<=.5?16:B<=1.5?8:B<=4?4:2}),u=K(()=>r.canvas.getFitDimension(t())),v=K(()=>r.studio.zoomLevel),h=K(()=>{const B=[];for(let U=0;U<o(i);U++){const P=Ze.toCartesianLabel(U,o(i),t()==="vertical");(P%o(l)===0||U===0||U===o(i)-1)&&B.push({pos:U,label:P})}return B}),g=K(()=>{if(o(v)<=1)return t()==="horizontal"?"translate(-50%, 0)":"translate(0, -50%)";const B=(o(n)+.5)/o(i)*100;return t()==="horizontal"?`translate(-${B}%, 0)`:`translate(0, -${B}%)`});var x=$n(),b=d(x),m=d(b),_=f(m,2),y=f(_,2);Oe(y,17,()=>o(h),B=>B.pos,(B,U)=>{var P=Bn(),R=d(P),F=d(R,!0);c(R),c(P),N(()=>{ge(P,`
					${t()==="horizontal"?"left":"top"}: ${o(U).pos/o(i)*100}%;
					${t()==="horizontal"?"width":"height"}: ${100/o(i)}%;
					${t()==="horizontal"?"height":"width"}: 100%;
					${t()==="horizontal"?"padding-bottom: 4px;":"padding-right: 4px;"}
				`),ge(R,`transform: ${t()==="vertical"?"rotate(-90deg)":"none"};`),S(F,o(U).label)}),T(B,P)});var E=f(y,2),I=d(E),G=d(I),j=d(G,!0);c(G),c(I),c(E),c(b),c(x),N(B=>{re(b,1,`absolute flex ${t()==="vertical"?"flex-col":""}`),ge(b,`
			left: ${t()==="horizontal"?"50%":"0"};
			top: ${t()==="vertical"?"50%":"0"};
			transform: ${o(g)??""}; 
			${t()==="horizontal"?"width":"height"}: calc(${o(u)??""} * ${o(v)??""});
			${t()==="vertical"?"width":"height"}: 100%;
		`),re(m,1,`absolute opacity-10 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-1/2":"top-0 right-0 bottom-0 w-1/2"}`),ge(m,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1px, transparent 1px);
				background-size: ${t()==="horizontal"?`calc(100% / ${o(i)}) 100%`:`100% calc(100% / ${o(i)})`};
			`),re(_,1,`absolute opacity-20 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-3/4":"top-0 right-0 bottom-0 w-3/4"}`),ge(_,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1.5px, transparent 1.5px);
				background-size: ${t()==="horizontal"?`calc(100% / ${o(i)} * ${o(l)}) 100%`:`100% calc(100% / ${o(i)} * ${o(l)})`};
			`),ge(E,`
				${t()==="horizontal"?"left":"top"}: ${(o(n)+.5)/o(i)*100}%;
				${t()==="horizontal"?"width: 1px; top: 0; bottom: 0;":"height: 1px; left: 0; right: 0;"}
			`),ge(I,`transform: translate(-50%, -50%) ${t()==="vertical"?"rotate(-90deg)":""};`),S(j,B)},[()=>Ze.toCartesianLabel(o(n),o(i),t()==="vertical")]),T(p,x),oe()}var Nn=O('<div class="absolute -top-3 -right-3 flex items-center justify-center rounded-full border-2 border-white bg-brand p-1 text-[8px] font-bold text-white shadow-lg ring-1 ring-black/5"><!></div>'),Un=O('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),Vn=O('<div class="cursor-container absolute inset-0 svelte-13i93z"><div class="cursor-bloom transition-transform duration-200 svelte-13i93z"><div class="petal p-top svelte-13i93z"></div> <div class="petal p-bottom svelte-13i93z"></div> <div class="petal p-left svelte-13i93z"></div> <div class="petal p-right svelte-13i93z"></div> <div class="center-dot svelte-13i93z"></div></div> <!> <!></div>');function Hn(p,e){ie(e,!1);const t=r.studio;$e();var a=Ye(),s=be(a);{var i=n=>{var l=Vn(),u=d(l),v=f(u,2);{var h=b=>{var m=Nn(),_=d(m);{var y=I=>{var G=dt("🔒");T(I,G)},E=I=>{var G=Ye(),j=be(G);{var B=P=>{var R=dt("☀️");T(P,R)},U=P=>{var R=Ye(),F=be(R);{var $=Y=>{var te=dt("🌙");T(Y,te)},z=Y=>{var te=Ye(),ae=be(te);{var Q=se=>{var me=dt("🏁");T(se,me)};H(ae,se=>{t.isShadingDither&&se(Q)},!0)}T(Y,te)};H(F,Y=>{t.isShadingDarken?Y($):Y(z,!1)},!0)}T(P,R)};H(j,P=>{t.isShadingLighten?P(B):P(U,!1)},!0)}T(I,G)};H(_,I=>{t.isAlphaLocked||t.isColorLocked?I(y):I(E,!1)})}c(m),ue(3,m,()=>Ft),T(b,m)};H(v,b=>{(t.isAlphaLocked||t.isColorLocked||t.isShadingLighten||t.isShadingDarken||t.isShadingDither)&&b(h)})}var g=f(v,2);{var x=b=>{var m=Un(),_=be(m),y=f(_,2),E=d(y),I=d(E);c(E),Pt(2),c(y),N(()=>{ge(_,`background-color: ${r.activeColor??""};`),ge(I,`background-color: ${r.activeColor??""};`)}),ue(3,_,()=>ye,()=>({duration:400})),ue(1,y,()=>Na,()=>({y:-10,duration:400})),ue(2,y,()=>ye,()=>({duration:400})),T(b,m)};H(g,b=>{r.isPicking&&b(x)})}c(l),N(()=>ge(u,`transform: scale(${t.brushSize??""})`)),ue(3,l,()=>ye,()=>({duration:800})),T(n,l)};H(s,n=>{r.isCursorVisible&&n(i)})}T(p,a),oe()}var zn=O('<div class="pointer-events-none absolute inset-0 z-0 opacity-20 blur-[1px] grayscale"></div>'),Yn=O('<div class="pointer-events-none absolute inset-0 z-[5] overflow-hidden"><img alt="Underlay" class="absolute origin-top-left"/></div>'),Kn=mt('<rect fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></rect>'),qn=mt('<ellipse fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></ellipse>'),Qn=mt('<line stroke="var(--color-brand)" stroke-width="0.1" class="shadow-sm"></line><circle r="0.3" fill="var(--color-brand)"></circle><circle r="0.3" fill="none" stroke="var(--color-brand)" stroke-width="0.05"></circle>',1),Xn=mt('<polyline fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></polyline><line stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></line>',1),Wn=mt('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg>'),Zn=mt('<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline>'),Jn=O('<div class="canvas-viewport relative grid h-full w-full grid-cols-[20px_1fr] grid-rows-[20px_1fr] overflow-hidden svelte-e4xfdd"><div class="z-[110] border-r border-b border-charcoal/10 bg-foam-white/90 backdrop-blur-md" aria-hidden="true"></div> <div class="relative z-[100] border-b border-charcoal/10"><!></div> <div class="relative z-[100] border-r border-charcoal/10"><!></div> <div class="relative flex flex-1 items-center justify-center overflow-hidden bg-charcoal/[0.02]"><!> <div class="canvas-container absolute top-1/2 left-1/2 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] svelte-e4xfdd"><div class="relative h-full w-full shadow-[0_20px_60px_rgba(0,0,0,0.12)] ring-1 ring-charcoal/5 outline-none focus:ring-2 focus:ring-brand" role="grid" tabindex="0"><!> <!> <!> <canvas class="pointer-events-none absolute inset-0 h-full w-full" style="image-rendering: pixelated;"></canvas> <!> <div class="pixel-grid-surface pointer-events-none absolute inset-0 z-10 h-full w-full"></div> <div class="pointer-events-none absolute inset-0 z-30 overflow-hidden"><div class="absolute transition-all duration-75 ease-out"><!></div></div> <svg class="pointer-events-none absolute inset-0 z-[20] h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg> <!></div></div></div></div>');function el(p,e){ie(e,!0);let t=C(null),a=C(null),s=K(()=>r.canvas.width),i=K(()=>r.canvas.height),n=K(()=>{if(!r.showGhostLayers)return[];const J=r.project.activeFrameIndex,L=r.project.frames,k=[];for(let D=1;D<=3;D++){const W=J-D;W>=0&&k.push({id:`past-${W}`,pixels:L[W].compositePixels,opacity:.4/D,tint:"#268bd2"})}for(let D=1;D<=3;D++){const W=J+D;W<L.length&&k.push({id:`future-${W}`,pixels:L[W].compositePixels,opacity:.4/D,tint:"#859900"})}return k}),l=K(()=>xt.isSnappedState),u=K(()=>r.canvas.strokePoints.map(J=>`${J.x},${J.y}`).join(" ")),v=K(()=>r.studio.isTilingEnabled),h=C("");function g(J){if(J.ctrlKey){J.preventDefault();const L=J.deltaY>0?-.1:.1;r.studio.setZoom(L)}}st(()=>{if(r.canvas.renderPulse===-1)return;const J=o(a)?.getContext("2d",{alpha:!0}),L=r.canvas.compositePixels;if(!J||!o(a))return;J.imageSmoothingEnabled=!1;const k=J.createImageData(o(s),o(i));new Uint32Array(k.data.buffer).set(L),J.putImageData(k,0,0),o(v)&&w(h,o(a).toDataURL(),!0)});var x=Jn();We("pointermove",Ia,J=>o(t)&&xt.handleMove(J,o(t))),We("pointerup",Ia,()=>xt.handleEnd());var b=f(d(x),2),m=d(b);er(m,{orientation:"horizontal"}),c(b);var _=f(b,2),y=d(_);er(y,{orientation:"vertical"}),c(_);var E=f(_,2),I=d(E);{var G=J=>{var L=zn();N((k,D)=>ge(L,`
					background-image: url(${o(h)??""});
					background-repeat: repeat;
					background-size: ${k??""} ${D??""};
					background-position: center;
					transform: ${r.cameraTransform??""};
				`),[()=>r.canvas.getFitDimension("horizontal"),()=>r.canvas.getFitDimension("vertical")]),ue(3,L,()=>ye),T(J,L)};H(I,J=>{o(v)&&J(G)})}var j=f(I,2),B=d(j);B.__contextmenu=J=>J.preventDefault(),B.__pointerdown=J=>o(t)&&xt.handleStart(J,o(t));var U=d(B);Pn(U,{});var P=f(U,2);{var R=J=>{var L=Yn(),k=d(L);c(L),N(()=>{ge(L,`opacity: ${r.studio.underlayOpacity??""}`),M(k,"src",r.studio.underlayImage),ge(k,`
								transform: translate(${r.studio.underlayOffset.x??""}px, ${r.studio.underlayOffset.y??""}px) scale(${r.studio.underlayScale??""});
								image-rendering: auto;
							`)}),ue(3,L,()=>ye),T(J,L)};H(P,J=>{r.studio.underlayImage&&r.studio.isUnderlayVisible&&J(R)})}var F=f(P,2);{var $=J=>{var L=Ye(),k=be(L);Oe(k,17,()=>o(n),D=>D.id,(D,W)=>{Gn(D,{get pixels(){return o(W).pixels},get width(){return o(s)},get height(){return o(i)},get opacity(){return o(W).opacity},get tint(){return o(W).tint}})}),T(J,L)};H(F,J=>{r.showGhostLayers&&J($)})}var z=f(F,2);jt(z,J=>w(a,J),()=>o(a));var Y=f(z,2);{var te=J=>{const L=K(()=>r.studio.shapeAnchor),k=K(()=>r.cursor.pos),D=K(()=>Math.min(o(L).x,o(k).x)),W=K(()=>Math.min(o(L).y,o(k).y)),q=K(()=>Math.max(o(L).x,o(k).x)),he=K(()=>Math.max(o(L).y,o(k).y)),X=K(()=>o(q)-o(D)+1),de=K(()=>o(he)-o(W)+1);var we=Wn(),Ve=d(we);{var Je=xe=>{var Me=Kn();N(()=>{M(Me,"x",o(D)),M(Me,"y",o(W)),M(Me,"width",o(X)),M(Me,"height",o(de))}),T(xe,Me)},Pe=xe=>{var Me=Ye(),et=be(Me);{var Ue=Ke=>{var De=qn();N(()=>{M(De,"cx",o(D)+o(X)/2),M(De,"cy",o(W)+o(de)/2),M(De,"rx",o(X)/2),M(De,"ry",o(de)/2)}),T(Ke,De)},Te=Ke=>{var De=Ye(),qe=be(De);{var le=Ae=>{var He=Qn(),ze=be(He),je=f(ze),tt=f(je);N(()=>{M(ze,"x1",o(L).x+.5),M(ze,"y1",o(L).y+.5),M(ze,"x2",o(k).x+.5),M(ze,"y2",o(k).y+.5),M(je,"cx",o(L).x+.5),M(je,"cy",o(L).y+.5),M(tt,"cx",o(k).x+.5),M(tt,"cy",o(k).y+.5)}),T(Ae,He)},ke=Ae=>{var He=Ye(),ze=be(He);{var je=tt=>{const ft=K(()=>(o(L).x+o(k).x)/2),pt=K(()=>(o(L).y+o(k).y)/2),Qe=K(()=>Math.max(Math.abs(o(k).x-o(L).x),Math.abs(o(k).y-o(L).y))/2),ee=K(()=>r.studio.polygonSides),pe=K(()=>r.studio.polygonIndentation),at=K(()=>Array.from({length:o(pe)>0?o(ee)*2:o(ee)}).map((Gt,bt)=>{const Tt=-Math.PI/2+bt*2*Math.PI/(o(pe)>0?o(ee)*2:o(ee)),vt=o(pe)>0?bt%2===0?o(Qe):o(Qe)*(1-o(pe)/100):o(Qe);return`${o(ft)+.5+Math.cos(Tt)*vt},${o(pt)+.5+Math.sin(Tt)*vt}`}));var it=Xn(),St=be(it),ut=f(St);N((Gt,bt,Tt,vt,Ht)=>{M(St,"points",Gt),M(ut,"x1",bt),M(ut,"y1",Tt),M(ut,"x2",vt),M(ut,"y2",Ht)},[()=>o(at).join(" "),()=>o(ft)+.5+Math.cos(-Math.PI/2+((o(pe)>0?o(ee)*2:o(ee))-1)*2*Math.PI/(o(pe)>0?o(ee)*2:o(ee)))*(o(pe)>0?((o(pe)>0?o(ee)*2:o(ee))-1)%2===0?o(Qe):o(Qe)*(1-o(pe)/100):o(Qe)),()=>o(pt)+.5+Math.sin(-Math.PI/2+((o(pe)>0?o(ee)*2:o(ee))-1)*2*Math.PI/(o(pe)>0?o(ee)*2:o(ee)))*(o(pe)>0?((o(pe)>0?o(ee)*2:o(ee))-1)%2===0?o(Qe):o(Qe)*(1-o(pe)/100):o(Qe)),()=>o(ft)+.5+Math.cos(-Math.PI/2)*o(Qe),()=>o(pt)+.5+Math.sin(-Math.PI/2)*o(Qe)]),T(tt,it)};H(ze,tt=>{r.studio.activeTool==="POLYGON"&&tt(je)},!0)}T(Ae,He)};H(qe,Ae=>{r.studio.activeTool==="GRADIENT"?Ae(le):Ae(ke,!1)},!0)}T(Ke,De)};H(et,Ke=>{r.studio.activeTool==="ELLIPSE"?Ke(Ue):Ke(Te,!1)},!0)}T(xe,Me)};H(Ve,xe=>{r.studio.activeTool==="RECTANGLE"?xe(Je):xe(Pe,!1)})}c(we),N(()=>M(we,"viewBox",`0 0 ${o(s)??""} ${o(i)??""}`)),T(J,we)};H(Y,J=>{r.studio.activeTool!=="BRUSH"&&r.studio.shapeAnchor&&J(te)})}var ae=f(Y,2),Q=f(ae,2),se=d(Q),me=d(se);Hn(me,{}),c(se),c(Q);var Se=f(Q,2),_e=d(Se);{var Re=J=>{var L=Zn();N(()=>{M(L,"points",o(u)),M(L,"stroke",r.paletteState.activeColor),M(L,"stroke-width",o(l)?"0.08":"0.03"),M(L,"stroke-dasharray",o(l)?"none":"0.1 0.1"),re(L,0,`${o(l)?"drop-shadow-md":"marching-ants"} transition-all duration-300`,"svelte-e4xfdd"),ge(L,`opacity: ${o(l)?"1":"0.4"}`)}),T(J,L)};H(_e,J=>{r.canvas.strokePoints.length>1&&J(Re)})}c(Se);var Ne=f(Se,2);jn(Ne,{}),c(B),jt(B,J=>w(t,J),()=>o(t)),c(j),c(E),c(x),N(J=>{ge(j,`
				transform: ${r.cameraTransform??""};
				aspect-ratio: ${o(s)??""} / ${o(i)??""};
				width: ${J??""};
			`),ge(B,`
										background-color: ${r.backgroundColor??""};
										touch-action: none;
										cursor: ${Fe.current.type==="PAN"?xt.isPointerDownActive?"grabbing":"grab":"crosshair"};
									`),M(z,"width",o(s)),M(z,"height",o(i)),ge(ae,`--grid-cols: ${o(s)??""}; --grid-rows: ${o(i)??""};`),ge(se,`
							left: ${r.cursor.pos.x/o(s)*100}%; 
							top: ${r.cursor.pos.y/o(i)*100}%; 
							width: ${100/o(s)}%; 
							height: ${100/o(i)}%;
						`),M(Se,"viewBox",`0 0 ${o(s)??""} ${o(i)??""}`)},[()=>r.canvas.getFitDimension("horizontal")]),We("wheel",x,g),T(p,x),oe()}Ie(["contextmenu","pointerdown"]);function Ra(p){return--p*p*p*p*p+1}const tl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var al=O(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-canvas-bg" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');" role="dialog" aria-modal="true"><div class="absolute h-[500px] w-[500px] animate-pulse rounded-full bg-charcoal/5 blur-[120px]" aria-hidden="true"></div> <div class="relative flex flex-col items-center gap-2"><div class="mb-8 flex animate-bounce items-center justify-center"><img alt="Rupa Café Logo" class="h-32 w-auto drop-shadow-2xl transition-transform duration-[3s] ease-in-out"/></div> <div><!></div></div> <div class="absolute bottom-24 flex flex-col items-center gap-8"><div class="flex flex-col items-center gap-4"><div class="h-1 w-48 overflow-hidden rounded-full bg-charcoal/5 ring-1 ring-charcoal/10" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div></div></div> <div class="flex flex-col items-center gap-1 text-center"><span class="h-4 font-serif text-[11px] tracking-wide text-charcoal/60 italic"> </span> <span class="font-mono text-[8px] font-bold tracking-[0.3em] text-charcoal/20 uppercase"> </span></div></div></div></div>`);function rl(p,e){ie(e,!0);let t=C(!0),a=C(0),s=C(0),i=C(!1);const n=5;function l(){fe.emit("READY"),w(t,!1),setTimeout(()=>{r.isAppReady=!0,r.showGuideBook=!0},800)}Vt(()=>{fe.emit("STARTUP");const g=setInterval(()=>{if(o(a)<100){const x=Math.random()*15;w(a,Math.min(100,o(a)+x),!0),w(s,Math.min(n-1,Math.floor(o(a)/100*n)),!0)}else clearInterval(g),setTimeout(()=>{w(i,!0),l()},600)},400);return()=>{clearInterval(g)}});var u=Ye(),v=be(u);{var h=g=>{var x=al(),b=f(d(x),2),m=d(b),_=d(m);ge(_,`transform: scale(${1+Math.sin(Date.now()/1500)*.05});`),c(m);var y=f(m,2),E=d(y);dr(E,{size:"lg"}),c(y),c(b);var I=f(b,2),G=d(I),j=d(G),B=d(j);c(j);var U=f(j,2),P=d(U),R=d(P,!0);c(P);var F=f(P,2),$=d(F,!0);c(F),c(U),c(G),c(I),c(x),N((z,Y,te)=>{M(x,"aria-busy",!o(i)),M(x,"aria-label",z),M(_,"src",tl),M(j,"aria-valuenow",o(a)),re(B,1,`h-full bg-charcoal/20 transition-all duration-500 ease-out ${o(i)?"bg-brand/40":""}`),ge(B,`width: ${o(a)??""}%`),S(R,Y),S($,te)},[()=>A({key:"manual.title"}),()=>o(i)?A({key:"splash.welcome"}):A({key:`splash.phases.${o(s)}`}),()=>A({key:"splash.version",replace:{version:r.version}})]),ue(1,m,()=>Ft,()=>({duration:1500,start:.9,easing:Ra})),ue(1,y,()=>Na,()=>({y:15,duration:1e3,delay:400,easing:Ra})),ue(2,x,()=>ye,()=>({duration:1e3})),T(g,x)};H(v,g=>{o(t)&&g(h)})}T(p,u),oe()}var sl=O('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><div class="flex items-center gap-1.5"><span> </span> <span> </span></div> <span> </span></div> <input type="range"/></div>');function la(p,e){ie(e,!0);let t=Le(e,"value",15),a=Le(e,"min",3,0),s=Le(e,"step",3,1),i=Le(e,"unit",3,""),n=Le(e,"isHue",3,!1);var l=sl(),u=d(l),v=d(u),h=d(v),g=d(h,!0);c(h);var x=f(h,2),b=d(x,!0);c(x),c(v);var m=f(v,2),_=d(m);c(m),c(u);var y=f(u,2);Ee(y);let E;c(l),N(I=>{S(g,e.icon),S(b,e.label),S(_,`${I??""}${i()??""}`),M(y,"min",a()),M(y,"max",e.max),M(y,"step",s()),E=re(y,1,"custom-slider svelte-6nviod",null,E,{"hue-slider":n()})},[()=>s()<1?t().toFixed(2):Math.round(t())]),Ce(y,t),T(p,l),oe()}var il=O('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="presentation"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-canvas-bg p-10 shadow-2xl" role="dialog" aria-labelledby="flavor-basin-title" aria-modal="true"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl" aria-hidden="true">⛲</span> <div class="flex flex-col"><h2 id="flavor-basin-title" class="font-tiny5 text-3xl leading-none text-brand"> </h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/40 uppercase"> </span></div></div> <div class="editor-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner" aria-label="Color Preview"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><label for="hex-input" class="font-mono text-xs font-bold text-studio-text/40"> </label> <input id="hex-input" type="text" class="w-full bg-transparent font-mono text-lg font-bold text-studio-text uppercase focus:outline-none"/></div> <div class="flex gap-3"><button class="editor-secondary-btn flex h-14 w-14 items-center justify-center p-0 text-xl"><span aria-hidden="true">🖌️</span></button> <button class="editor-primary-btn flex-1 py-4"> </button></div></div></div></div>');function Ua(p,e){ie(e,!0);let t=Le(e,"value",15),a=C(0),s=C(0),i=C(0),n=C(1);st(()=>{const Q=ne.toHSLA(t());kt(()=>{w(a,Q.h,!0),w(s,Q.s,!0),w(i,Q.l,!0),w(n,Q.a,!0)})}),st(()=>{const Q=ne.toHex({h:o(a),s:o(s),l:o(i),a:o(n)});kt(()=>{t(Q)})}),st(()=>(r.pushEscapeAction(e.onClose),()=>r.popEscapeAction(e.onClose)));var l=il();l.__mousedown=Q=>Q.target===Q.currentTarget&&e.onClose();var u=d(l),v=d(u),h=d(v),g=f(d(h),2),x=d(g),b=d(x,!0);c(x);var m=f(x,2),_=d(m,!0);c(m),c(g),c(h);var y=f(h,2);c(v);var E=f(v,2),I=d(E);{let Q=K(()=>A({key:"color_picker.sliders.hue"}));la(I,{get label(){return o(Q)},icon:"🌈",max:360,unit:"°",isHue:!0,get value(){return o(a)},set value(se){w(a,se,!0)}})}var G=f(I,2);{let Q=K(()=>A({key:"color_picker.sliders.saturation"}));la(G,{get label(){return o(Q)},icon:"🏺",max:100,unit:"%",get value(){return o(s)},set value(se){w(s,se,!0)}})}var j=f(G,2);{let Q=K(()=>A({key:"color_picker.sliders.lightness"}));la(j,{get label(){return o(Q)},icon:"☀️",max:100,unit:"%",get value(){return o(i)},set value(se){w(i,se,!0)}})}var B=f(j,2);{let Q=K(()=>A({key:"color_picker.sliders.alpha"}));la(B,{get label(){return o(Q)},icon:"💧",min:0,max:1,step:.01,unit:"",get value(){return o(n)},set value(se){w(n,se,!0)}})}c(E);var U=f(E,2),P=d(U),R=d(P),F=d(R,!0);c(R);var $=f(R,2);Ee($),c(P);var z=f(P,2),Y=d(z);Y.__click=()=>{V.pickColor(),e.onClose()};var te=f(Y,2);te.__click=function(...Q){e.onClose?.apply(this,Q)};var ae=d(te,!0);c(te),c(z),c(U),c(u),c(l),N((Q,se,me,Se,_e,Re)=>{S(b,Q),S(_,se),ge(y,`background-color: ${t()??""};`),S(F,me),M(Y,"title",Se),M(Y,"aria-label",_e),S(ae,Re)},[()=>A({key:"color_picker.title"}),()=>A({key:"color_picker.subtitle"}),()=>A({key:"color_picker.hex_label"}),()=>A({key:"color_picker.eye_drop"}),()=>A({key:"color_picker.eye_drop"}),()=>A({key:"color_picker.seal"})]),Ce($,t),ue(1,u,()=>Ft,()=>({duration:200,start:.95})),ue(2,u,()=>Ft,()=>({duration:150,start:1,opacity:0})),ue(3,l,()=>ye,()=>({duration:150})),T(p,l),oe()}Ie(["mousedown","click"]);var ol=O("<span> </span>"),nl=O('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function ll(p,e){ie(e,!0);var t=nl();t.__click=()=>{e.action.action(),e.onSelect()};var a=d(t),s=d(a,!0);c(a);var i=f(a,2);{var n=l=>{var u=ol(),v=d(u,!0);c(u),N(()=>{re(u,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),S(v,e.action.shortcut)}),T(l,u)};H(i,l=>{e.action.shortcut&&l(n)})}c(t),N(()=>{re(t,1,`editor-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),S(s,e.action.label)}),We("mouseenter",t,function(...l){e.onSelect?.apply(this,l)}),T(p,t),oe()}Ie(["click"]);var cl=O('<div class="p-8 text-center font-serif text-sm text-studio-text/40 italic"> </div>'),dl=O('<div class="flex flex-col gap-1"></div>'),ul=O('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="presentation"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/95 shadow-2xl" role="dialog" aria-labelledby="palette-title" aria-modal="true"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40" aria-hidden="true">📖</span> <h2 id="palette-title" class="sr-only"> </h2> <input id="palette-search" type="text" class="w-full bg-transparent font-serif text-xl text-studio-text focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-h74ewr" role="list"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div></div>');function vl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showCommandPalette=!1),a=C(""),s=C(0);const n=rt.getActions().map(R=>({...R,id:R.intent.toLowerCase().replace(/_/g,"-"),action:()=>{gt.handleIntent(R.intent)}}));let l=K(()=>n.filter(R=>R.label.toLowerCase().includes(o(a).toLowerCase())));st(()=>{o(a),w(s,0)}),st(()=>{o(s),o(l);const R=document.querySelector(".editor-action-btn.active");R&&R.scrollIntoView({block:"nearest"})});function u(R){R.key==="ArrowDown"?(R.preventDefault(),w(s,(o(s)+1)%o(l).length)):R.key==="ArrowUp"?(R.preventDefault(),w(s,(o(s)-1+o(l).length)%o(l).length)):R.key==="Enter"?(R.preventDefault(),o(l)[o(s)]&&(o(l)[o(s)].action(),t()())):R.key==="Escape"&&t()()}Vt(()=>document.getElementById("palette-search")?.focus());var v=ul();v.__mousedown=R=>R.target===R.currentTarget&&t()(),v.__keydown=u;var h=d(v),g=d(h),x=f(d(g),2),b=d(x,!0);c(x);var m=f(x,2);Ee(m),c(g);var _=f(g,2),y=d(_);{var E=R=>{var F=cl(),$=d(F,!0);c(F),N(z=>S($,z),[()=>A({key:"hud.menu.catalog_no_results",replace:{query:o(a)}})]),T(R,F)},I=R=>{var F=dl();Oe(F,21,()=>o(l),Be,($,z,Y)=>{{let te=K(()=>o(s)===Y);ll($,{get action(){return o(z)},get isSelected(){return o(te)},onSelect:()=>w(s,Y,!0)})}}),c(F),T(R,F)};H(y,R=>{o(l).length===0?R(E):R(I,!1)})}c(_);var G=f(_,2),j=d(G),B=d(j,!0);c(j);var U=f(j,2),P=d(U,!0);c(U),c(G),c(h),c(v),N((R,F,$,z)=>{S(b,R),M(m,"placeholder",F),S(B,$),S(P,z)},[()=>A({key:"hud.menu.catalog_title"}),()=>A({key:"hud.menu.catalog_search"}),()=>A({key:"hud.menu.catalog_footer"}),()=>A({key:"hud.menu.catalog_count",replace:{count:o(l).length}})]),Ce(m,()=>o(a),R=>w(a,R)),ue(3,h,()=>Ft,()=>({duration:150,start:.98})),T(p,v),oe()}Ie(["mousedown","keydown"]);var hl=O('<span class="text-2xl opacity-40"> </span>'),pl=O('<span class="mt-1 font-serif text-[9px] font-black tracking-[0.2em] text-charcoal/30 uppercase"> </span>'),fl=O('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-charcoal/20 backdrop-blur-md"><div class="flex flex-col gap-6 overflow-hidden rounded-xl border border-charcoal/10 bg-foam-white p-8 shadow-2xl" role="dialog" aria-modal="true" tabindex="-1"><div class="flex items-center justify-between border-b border-charcoal/5 pb-4"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-2xl leading-none text-charcoal"> </h2> <!></div></div> <button class="rounded-lg border border-charcoal/10 bg-stone-light/50 px-4 py-1.5 text-[9px] font-bold tracking-widest text-charcoal/40 uppercase transition-all hover:border-brand hover:bg-brand hover:text-white">Close</button></div> <div><!></div></div></div>');function Et(p,e){ie(e,!0);let t=Le(e,"title",3,""),a=Le(e,"subtitle",3,""),s=Le(e,"icon",3,""),i=Le(e,"width",3,"500px"),n=Le(e,"maxHeight",3,"85vh"),l=Le(e,"scrollable",3,!0);st(()=>(r.pushEscapeAction(e.onClose),()=>r.popEscapeAction(e.onClose)));function u(P,{duration:R=300}){return{duration:R,css:F=>{const $=Ra(F);return`
					opacity: ${F};
					transform: scale(${.95+$*.05});
				`}}}var v=fl();v.__mousedown=P=>{P.stopPropagation(),P.target===P.currentTarget&&e.onClose()};var h=d(v);h.__mousedown=P=>P.stopPropagation();var g=d(h),x=d(g),b=d(x);{var m=P=>{var R=hl(),F=d(R,!0);c(R),N(()=>S(F,s())),T(P,R)};H(b,P=>{s()&&P(m)})}var _=f(b,2),y=d(_),E=d(y,!0);c(y);var I=f(y,2);{var G=P=>{var R=pl(),F=d(R,!0);c(R),N(()=>S(F,a())),T(P,R)};H(I,P=>{a()&&P(G)})}c(_),c(x);var j=f(x,2);j.__click=function(...P){e.onClose?.apply(this,P)},c(g);var B=f(g,2),U=d(B);cs(U,()=>e.children),c(B),c(h),c(v),N(()=>{ge(h,`width: ${i()??""}; max-height: ${n()??""};`),S(E,t()),re(B,1,`custom-scrollbar flex-1 ${l()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),ue(1,h,()=>u,()=>({duration:300})),ue(2,h,()=>ye,()=>({duration:150})),ue(3,v,()=>ye,()=>({duration:150})),T(p,v),oe()}Ie(["mousedown","click"]);var gl=O('<div class="flex flex-col items-center gap-3"><div class="editor-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function xl(p,e){ie(e,!0);let t=C(null);st(()=>{if(!o(t))return;const g=o(t).getContext("2d");if(!g)return;const x=r.canvas.width,b=r.canvas.height,m=r.canvas.compositePixels,_=r.studio.includePixelBorders,y=400,E=Math.min(y/x,y/b);o(t).width=x*E,o(t).height=b*E,g.imageSmoothingEnabled=!1,e.bgColor==="transparent"?g.clearRect(0,0,o(t).width,o(t).height):(g.fillStyle=e.bgColor,g.fillRect(0,0,o(t).width,o(t).height)),m.forEach((I,G)=>{if(I===0)return;const j=ne.uint32ToHex(I),B=G%x,U=Math.floor(G/x),P=Math.floor(B*E),R=Math.floor(U*E),F=Math.ceil(E),$=Math.ceil(E);g.fillStyle=j,g.fillRect(P,R,F,$),_&&(g.strokeStyle="rgba(0, 0, 0, 0.15)",g.lineWidth=1,g.strokeRect(P+.5,R+.5,F-1,$-1))})});var a=gl(),s=d(a),i=d(s);jt(i,g=>w(t,g),()=>o(t)),c(s);var n=f(s,2),l=d(n),u=d(l,!0);c(l);var v=f(l,2),h=d(v,!0);c(v),c(n),c(a),N((g,x)=>{S(u,g),S(h,x)},[()=>A({key:"export.file_label",replace:{format:e.format}}),()=>A({key:"export.dimensions_label",replace:{width:Math.round(r.canvas.width*e.scale),height:Math.round(r.canvas.height*e.scale)}})]),T(p,a),oe()}var ml=O('<span class="font-serif text-[9px] font-bold text-brand italic opacity-60"> </span>'),bl=O('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="fps-input" type="number" min="1" max="60" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div>',1),yl=O('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span aria-hidden="true">🎨</span> </button>'),_l=O('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5" role="img"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-8 overflow-y-auto pr-4" role="group"><div class="flex flex-col gap-3"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"> </span> <div class="grid grid-cols-2 gap-3" role="radiogroup"><button role="radio"><span class="text-2xl" aria-hidden="true">🖼️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">🕸️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📷</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📐</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button></div></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"> </span> <!></div> <div role="radiogroup"><button role="radio"><span class="text-2xl" aria-hidden="true">🎬</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">🎀</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📽️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📐</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button></div></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="scale-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="scale-input" type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <!> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-charcoal/60 uppercase"> </span> <span class="font-serif text-[10px] text-charcoal/40"> </span></div> <button><div></div></button></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </span> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <div class="flex flex-wrap items-center gap-3" role="radiogroup"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" role="radio"></button> <button role="radio"></button> <button role="radio"></button> <div class="flex items-center gap-2"><button role="radio"></button></div></div> <!></div></div> <button class="editor-primary-btn w-full py-5 text-xl"> </button></div></div>'),Al=O("<!> <!>",1);function wl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showExportMenu=!1),a=C("png"),s=C(!1),i=C(!1),n=C(Ge(r.backgroundColor));Vt(()=>{r.backgroundColor!=="#eee8d5"&&(r.studio.exportBgColor=r.backgroundColor,w(n,r.backgroundColor,!0),w(i,!0))}),st(()=>{o(i)&&(r.studio.exportBgColor=o(n))}),st(()=>{const g=["webm","gif","mp4"].includes(o(a))||o(a)==="svg"&&r.project.frames.length>1;r.project.frames.length<=1&&g&&w(a,"png")});var l=Al(),u=be(l);{var v=g=>{Ua(g,{onClose:()=>w(s,!1),get value(){return o(n)},set value(x){w(n,x,!0)}})};H(u,g=>{o(s)&&g(v)})}var h=f(u,2);{let g=K(()=>A({key:"export.title"})),x=K(()=>A({key:"export.subtitle"}));Et(h,{get title(){return o(g)},get subtitle(){return o(x)},icon:"🧺",get onClose(){return t()},width:"1000px",scrollable:!1,children:(b,m)=>{var _=_l(),y=d(_),E=d(y);xl(E,{get format(){return o(a)},get scale(){return r.studio.exportScale},get bgColor(){return r.studio.exportBgColor}}),c(y);var I=f(y,2),G=d(I),j=d(G),B=d(j,!0);c(j);var U=f(j,2),P=d(U);P.__click=()=>w(a,"png");var R=f(d(P),2),F=d(R),$=d(F,!0);c(F),c(R),c(P);var z=f(P,2);z.__click=()=>w(a,"webp");var Y=f(d(z),2),te=d(Y),ae=d(te,!0);c(te),c(Y),c(z);var Q=f(z,2);Q.__click=()=>w(a,"jpg");var se=f(d(Q),2),me=d(se),Se=d(me,!0);c(me),c(se),c(Q);var _e=f(Q,2);_e.__click=()=>w(a,"svg");var Re=f(d(_e),2),Ne=d(Re),J=d(Ne,!0);c(Ne),c(Re),c(_e),c(U),c(G);var L=f(G,2),k=d(L),D=d(k),W=d(D,!0);c(D);var q=f(D,2);{var he=Xe=>{var ct=ml(),Lt=d(ct,!0);c(ct),N(yt=>S(Lt,yt),[()=>A({key:"export.requires_frames"})]),T(Xe,ct)};H(q,Xe=>{r.project.frames.length<=1&&Xe(he)})}c(k);var X=f(k,2),de=d(X);de.__click=()=>w(a,"webm");var we=f(d(de),2),Ve=d(we),Je=d(Ve,!0);c(Ve),c(we),c(de);var Pe=f(de,2);Pe.__click=()=>w(a,"gif");var xe=f(d(Pe),2),Me=d(xe),et=d(Me,!0);c(Me),c(xe),c(Pe);var Ue=f(Pe,2);Ue.__click=()=>w(a,"mp4");var Te=f(d(Ue),2),Ke=d(Te),De=d(Ke,!0);c(Ke),c(Te),c(Ue);var qe=f(Ue,2);qe.__click=()=>w(a,"svg");var le=f(d(qe),2),ke=d(le),Ae=d(ke,!0);c(ke),c(le),c(qe),c(X),c(L);var He=f(L,2),ze=d(He),je=d(ze),tt=d(je),ft=d(tt,!0);c(tt);var pt=f(tt,2),Qe=d(pt,!0);c(pt),c(je);var ee=f(je,2);Ee(ee),c(ze);var pe=f(ze,2);{var at=Xe=>{var ct=bl(),Lt=f(be(ct),2),yt=d(Lt),qt=d(yt),xa=d(qt,!0);c(qt);var ia=f(qt,2),ma=d(ia,!0);c(ia),c(yt);var oa=f(yt,2);Ee(oa),c(Lt),N((Qt,ba)=>{S(xa,Qt),S(ma,ba)},[()=>A({key:"export.fps_label"}),()=>A({key:"export.fps_desc"})]),Ce(oa,()=>r.studio.fps,Qt=>r.studio.fps=Qt),T(Xe,ct)};H(pe,Xe=>{(o(a)==="webm"||o(a)==="gif"||o(a)==="mp4"||o(a)==="svg"&&r.project.frames.length>1)&&Xe(at)})}var it=f(pe,4),St=d(it),ut=d(St),Gt=d(ut,!0);c(ut);var bt=f(ut,2),Tt=d(bt,!0);c(bt),c(St);var vt=f(St,2);vt.__click=()=>r.studio.includePixelBorders=!r.studio.includePixelBorders;var Ht=d(vt);c(vt),c(it);var aa=f(it,4),zt=d(aa),Yt=d(zt),va=d(Yt,!0);c(Yt);var ra=f(Yt,2),ha=d(ra,!0);c(ra),c(zt);var Bt=f(zt,2),Mt=d(Bt);Mt.__click=()=>{r.studio.exportBgColor="transparent",w(i,!1)};var Ot=f(Mt,2);Ot.__click=()=>{r.studio.exportBgColor="#eee8d5",w(i,!1)};var Rt=f(Ot,2);Rt.__click=()=>{r.studio.exportBgColor="#000000",w(i,!1)};var sa=f(Rt,2),Dt=d(sa);Dt.__click=()=>{w(i,!0),r.studio.exportBgColor=o(n),w(s,!0)},c(sa),c(Bt);var pa=f(Bt,2);{var fa=Xe=>{var ct=yl();ct.__click=()=>{w(n,r.backgroundColor,!0),r.studio.exportBgColor=o(n)};var Lt=f(d(ct));c(ct),N(yt=>S(Lt,` ${yt??""}`),[()=>A({key:"export.match_canvas_background"})]),T(Xe,ct)};H(pa,Xe=>{r.backgroundColor!=="#eee8d5"&&Xe(fa)})}c(aa),c(He);var Kt=f(He,2);Kt.__click=()=>e.onExport(o(a),r.studio.exportScale,r.studio.exportBgColor);var ga=d(Kt,!0);c(Kt),c(I),c(_),N((Xe,ct,Lt,yt,qt,xa,ia,ma,oa,Qt,ba,ur,vr,hr,pr,fr,gr,xr,mr,br,yr,_r,Ar,wr,kr,Er,Sr)=>{M(y,"aria-label",Xe),M(I,"aria-label",ct),S(B,Lt),M(U,"aria-label",yt),re(P,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(P,"aria-checked",o(a)==="png"),S($,qt),re(z,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="webp"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(z,"aria-checked",o(a)==="webp"),S(ae,xa),re(Q,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="jpg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(Q,"aria-checked",o(a)==="jpg"),S(Se,ia),re(_e,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="svg"&&r.project.frames.length<=1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(_e,"aria-checked",o(a)==="svg"&&r.project.frames.length<=1),S(J,ma),S(W,oa),re(X,1,`grid grid-cols-2 gap-3 ${r.project.frames.length<=1?"opacity-40":""}`),M(X,"aria-label",Qt),re(de,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="webm"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),de.disabled=r.project.frames.length<=1,M(de,"aria-checked",o(a)==="webm"),S(Je,ba),re(Pe,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="gif"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Pe.disabled=r.project.frames.length<=1,M(Pe,"aria-checked",o(a)==="gif"),S(et,ur),re(Ue,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="mp4"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Ue.disabled=r.project.frames.length<=1,M(Ue,"aria-checked",o(a)==="mp4"),S(De,vr),re(qe,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="svg"&&r.project.frames.length>1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),qe.disabled=r.project.frames.length<=1,M(qe,"aria-checked",o(a)==="svg"&&r.project.frames.length>1),S(Ae,hr),S(ft,pr),S(Qe,fr),S(Gt,gr),S(Tt,xr),re(vt,1,`flex h-6 w-12 items-center rounded-full transition-colors ${r.studio.includePixelBorders?"bg-brand":"bg-charcoal/10"}`),M(vt,"aria-label",mr),re(Ht,1,`h-4 w-4 rounded-full bg-white shadow-sm transition-transform ${r.studio.includePixelBorders?"translate-x-7":"translate-x-1"}`),S(va,br),S(ha,yr),M(Bt,"aria-label",_r),re(Mt,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),M(Mt,"title",Ar),M(Mt,"aria-checked",r.studio.exportBgColor==="transparent"),re(Ot,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),M(Ot,"title",wr),M(Ot,"aria-checked",r.studio.exportBgColor==="#eee8d5"),re(Rt,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),M(Rt,"title",kr),M(Rt,"aria-checked",r.studio.exportBgColor==="#000000"),re(Dt,1,`h-10 w-16 rounded-xl border-2 ${o(i)?"border-brand":"border-black/5"} editor-checker-small transition-transform hover:scale-105`),ge(Dt,`background-color: ${o(n)??""};`),M(Dt,"title",Er),M(Dt,"aria-checked",o(i)),S(ga,Sr)},[()=>A({key:"export.preview_label"}),()=>A({key:"export.settings_label"}),()=>A({key:"export.static_title"}),()=>A({key:"export.static_formats_label"}),()=>A({key:"export.formats.png"}),()=>A({key:"export.formats.webp"}),()=>A({key:"export.formats.jpg"}),()=>A({key:"export.formats.svg_static"}),()=>A({key:"export.animated_title"}),()=>A({key:"export.kinetic_formats_label"}),()=>A({key:"export.formats.webm"}),()=>A({key:"export.formats.gif"}),()=>A({key:"export.formats.mp4"}),()=>A({key:"export.formats.svg_kinetic"}),()=>A({key:"export.scale_label"}),()=>A({key:"export.scale_desc"}),()=>A({key:"export.grid_borders_label"}),()=>A({key:"export.grid_borders_desc"}),()=>A({key:"export.grid_borders_toggle"}),()=>A({key:"export.background_label"}),()=>A({key:"export.background_desc"}),()=>A({key:"export.background_type_label"}),()=>A({key:"export.background_transparent"}),()=>A({key:"export.background_cream"}),()=>A({key:"export.background_black"}),()=>A({key:"export.background_custom"}),()=>A({key:"export.action"})]),Ce(ee,()=>r.studio.exportScale,Xe=>r.studio.exportScale=Xe),T(b,_)},$$slots:{default:!0}})}T(p,l),oe()}Ie(["click"]);var kl=O('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function El(p,e){ie(e,!0);var t=kl(),a=d(t),s=d(a,!0);c(a);var i=f(a,2),n=d(i,!0);c(i),c(t),N(l=>{S(s,e.label),S(n,l)},[()=>e.customKey||rt.getLabel(e.intent)]),T(p,t),oe()}var Sl=O('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function Tl(p,e){ie(e,!0);var t=Sl(),a=d(t),s=d(a,!0);c(a);var i=f(a,2);Oe(i,21,()=>e.group.items,Be,(n,l)=>{El(n,{get intent(){return o(l).intent},get label(){return o(l).label},get customKey(){return o(l).customKey}})}),c(i),c(t),N(()=>S(s,e.group.group)),T(p,t),oe()}var Ll=O('<div class="flex flex-col"><span class="font-tiny5 text-[10px] text-brand uppercase"> </span> <span class="font-serif text-[10px] text-charcoal/40 italic"> </span></div>'),Cl=O('<div class="flex flex-col gap-12" role="document"><header class="flex flex-col gap-2 rounded-xl bg-charcoal/5 p-6 ring-1 ring-charcoal/10" aria-labelledby="guide-header-title"><h3 id="guide-header-title" class="font-tiny5 text-xl text-charcoal uppercase"> </h3> <p class="font-serif text-xs leading-relaxed text-charcoal/60"> </p> <div class="mt-4 grid grid-cols-3 gap-4 border-t border-charcoal/5 pt-4"></div></header> <div class="grid grid-cols-2 gap-x-16 gap-y-12"></div> <footer class="mt-4 border-t border-charcoal/5 pt-8 text-center"><p class="font-serif text-[11px] text-charcoal/40 italic"> </p></footer></div>');function Il(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showGuideMenu=!1);const a=K(()=>rt.getGroupedActions());{let s=K(()=>A({key:"shortcuts.title"})),i=K(()=>A({key:"shortcuts.subtitle"}));Et(p,{get title(){return o(s)},get subtitle(){return o(i)},icon:"☕",get onClose(){return t()},width:"1000px",children:(n,l)=>{var u=Cl(),v=d(u),h=d(v),g=d(h,!0);c(h);var x=f(h,2),b=d(x,!0);c(x);var m=f(x,2);Oe(m,20,()=>[["Cup","Frame"],["Infusion","Layer"],["Flavor","Color"],["Vessel","Brush/Tool"],["Pour","Paint"],["Spill","Delete"]],Be,(G,j)=>{var B=K(()=>ns(j,2));let U=()=>o(B)[0],P=()=>o(B)[1];var R=Ll(),F=d(R),$=d(F,!0);c(F);var z=f(F,2),Y=d(z);c(z),c(R),N(()=>{S($,U()),S(Y,`meaning ${P()??""}`)}),T(G,R)}),c(m),c(v);var _=f(v,2);Oe(_,21,()=>o(a),Be,(G,j)=>{Tl(G,{get group(){return o(j)}})}),c(_);var y=f(_,2),E=d(y),I=d(E);c(E),c(y),c(u),N((G,j,B)=>{S(g,G),S(b,j),S(I,`"${B??""}"`)},[()=>A({key:"shortcuts.header_title"}),()=>A({key:"shortcuts.header_desc"}),()=>A({key:"shortcuts.footer_quote"})]),T(n,u)},$$slots:{default:!0}})}oe()}var Pl=O(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Recipe Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your art as a dedicated recipe file on your machine or in your browser's local store.</p></div> <div class="flex flex-col gap-3"><button class="editor-primary-btn w-full">Store Recipe to File</button> <button class="editor-secondary-btn w-full">Load Recipe from File</button></div></div>`);function Ml(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showPersistenceMenu=!1);Et(p,{title:"Recipe Store",subtitle:"Managing Digital Creations",icon:"💾",get onClose(){return t()},width:"400px",children:(a,s)=>{var i=Pl(),n=f(d(i),2),l=d(n);l.__click=()=>{V.persistence.save(),t()()};var u=f(l,2);u.__click=()=>{V.persistence.load(),t()()},c(n),c(i),T(a,i)},$$slots:{default:!0}}),oe()}Ie(["click"]);var Ol=O('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="stab-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <span class="font-mono text-sm font-bold text-brand"> </span></div> <input id="stab-input" type="range" min="0" max="100" class="h-1.5 w-full cursor-pointer appearance-none rounded-lg bg-black/5 accent-brand"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="fps-input" type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </span> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <button class="group relative flex items-center gap-3" aria-label="Change Backdrop Color"><div class="editor-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">🎨</div></button></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="editor-primary-btn w-full py-4 text-lg"> </button></div>'),Rl=O("<!> <!>",1);function Dl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showCanvasSettings=!1),a=C(Ge(r.canvas.width)),s=C(Ge(r.canvas.height)),i=C(!1);function n(){V.manipulation.resize(o(a),o(s)),t()()}var l=Rl(),u=be(l);{var v=g=>{Ua(g,{onClose:()=>w(i,!1),get value(){return r.backgroundColor},set value(x){r.backgroundColor=x}})};H(u,g=>{o(i)&&g(v)})}var h=f(u,2);{let g=K(()=>A({key:"settings.title"})),x=K(()=>A({key:"settings.subtitle"}));Et(h,{get title(){return o(g)},get subtitle(){return o(x)},icon:"📐",get onClose(){return t()},width:"450px",children:(b,m)=>{var _=Ol(),y=d(_),E=d(y),I=d(E),G=d(I),j=d(G,!0);c(G);var B=f(G,2);Ee(B),c(I);var U=f(I,2),P=d(U),R=d(P,!0);c(P);var F=f(P,2);Ee(F),c(U),c(E);var $=f(E,4),z=d($),Y=d(z),te=d(Y),ae=d(te,!0);c(te);var Q=f(te,2),se=d(Q,!0);c(Q),c(Y);var me=f(Y,2),Se=d(me);c(me),c(z);var _e=f(z,2);Ee(_e),c($);var Re=f($,4),Ne=d(Re),J=d(Ne),L=d(J,!0);c(J);var k=f(J,2),D=d(k,!0);c(k),c(Ne);var W=f(Ne,2);Ee(W),c(Re);var q=f(Re,4),he=d(q),X=d(he),de=d(X,!0);c(X);var we=f(X,2),Ve=d(we,!0);c(we),c(he);var Je=f(he,2);Je.__click=()=>w(i,!0);var Pe=d(Je);Pt(2),c(Je),c(q);var xe=f(q,2),Me=d(xe,!0);c(xe),c(y);var et=f(y,2);et.__click=n;var Ue=d(et,!0);c(et),c(_),N((Te,Ke,De,qe,le,ke,Ae,He,ze,je)=>{S(j,Te),S(R,Ke),S(ae,De),S(se,qe),S(Se,`${r.studio.stabilization??""}%`),S(L,le),S(D,ke),S(de,Ae),S(Ve,He),ge(Pe,`background-color: ${r.backgroundColor??""};`),S(Me,ze),S(Ue,je)},[()=>A({key:"settings.width"}),()=>A({key:"settings.height"}),()=>A({key:"settings.stabilization"}),()=>A({key:"settings.stabilization_desc"}),()=>A({key:"settings.fps_label"}),()=>A({key:"settings.fps_desc"}),()=>A({key:"settings.background_label"}),()=>A({key:"settings.background_desc"}),()=>A({key:"settings.note"}),()=>A({key:"settings.apply"})]),Ce(B,()=>o(a),Te=>w(a,Te)),Ce(F,()=>o(s),Te=>w(s,Te)),Ce(_e,()=>r.studio.stabilization,Te=>r.studio.stabilization=Te),Ce(W,()=>r.studio.fps,Te=>r.studio.fps=Te),T(b,_)},$$slots:{default:!0}})}T(p,l),oe()}Ie(["click"]);var jl=O('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="editor-primary-btn w-full py-4 text-lg"> </button></div>');function Fl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.studio.showGoTo=!1),a=C(Ge(r.displayCoords.x)),s=C(Ge(r.displayCoords.y));function i(){V.jumpTo(o(a),o(s)),t()()}function n(l){l.key==="Enter"&&i()}Vt(()=>{document.getElementById("goto-x")?.focus()});{let l=K(()=>A({key:"goto.title"})),u=K(()=>A({key:"goto.subtitle"}));Et(p,{get title(){return o(l)},get subtitle(){return o(u)},icon:"📍",get onClose(){return t()},width:"400px",children:(v,h)=>{var g=jl(),x=d(g),b=d(x),m=d(b),_=d(m),y=d(_,!0);c(_);var E=f(_,2);Ee(E),E.__keydown=n,c(m);var I=f(m,2),G=d(I),j=d(G,!0);c(G);var B=f(G,2);Ee(B),B.__keydown=n,c(I),c(b);var U=f(b,2),P=d(U,!0);c(U),c(x);var R=f(x,2);R.__click=i;var F=d(R,!0);c(R),c(g),N(($,z,Y,te)=>{S(y,$),S(j,z),S(P,Y),S(F,te)},[()=>A({key:"goto.label_x"}),()=>A({key:"goto.label_y"}),()=>A({key:"goto.current",replace:{x:r.displayCoords.x,y:r.displayCoords.y}}),()=>A({key:"goto.action"})]),Ce(E,()=>o(a),$=>w(a,$)),Ce(B,()=>o(s),$=>w(s,$)),T(v,g)},$$slots:{default:!0}})}oe()}Ie(["keydown","click"]);var Gl=O('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all café resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Sound Effects (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Ambiance Flow</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="editor-primary-btn w-full py-4">Apply Settings</button></div>');function Bl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showAudioSettings=!1);Et(p,{title:"Audio Settings",subtitle:"Harmony & Ambiance Tuning",icon:"🔊",get onClose(){return t()},width:"450px",children:(a,s)=>{var i=Gl(),n=d(i),l=f(d(n),2);l.__click=()=>r.toggleMute();var u=d(l,!0);c(l),c(n);var v=f(n,2),h=d(v),g=d(h),x=f(d(g),2),b=d(x);c(x),c(g);var m=f(g,2);Ee(m),c(h);var _=f(h,2),y=d(_),E=f(d(y),2),I=d(E);c(E),c(y);var G=f(y,2);Ee(G),c(_),c(v);var j=f(v,2),B=f(d(j),2),U=d(B),P=f(d(U),2),R=d(P);c(P),c(U);var F=f(U,2),$=d(F);{var z=ae=>{var Q=dt(`The piano awaits in silence. It will begin to play its melody after 30 minutes of
						creativity.`);T(ae,Q)},Y=ae=>{var Q=dt("The piano has begun its flow. Volume will reach full depth at 60 minutes.");T(ae,Q)};H($,ae=>{r.usageMinutes<30?ae(z):ae(Y,!1)})}c(F),c(B),c(j);var te=f(j,2);te.__click=function(...ae){t()?.apply(this,ae)},c(i),N((ae,Q)=>{re(l,1,`editor-secondary-btn !px-6 !py-2 ${r.isMuted?"bg-brand text-white":""}`),S(u,r.isMuted?"🔇 Muted":"🔊 Active"),S(b,`${ae??""}%`),S(I,`${Q??""}%`),S(R,`${r.usageMinutes??""} minutes`)},[()=>Math.round(r.sfxVolume*100),()=>Math.round(r.bgmVolume*100)]),Ce(m,()=>r.sfxVolume,ae=>r.sfxVolume=ae),Ce(G,()=>r.bgmVolume,ae=>r.bgmVolume=ae),T(a,i)},$$slots:{default:!0}}),oe()}Ie(["click"]);var $l=O('<div class="flex flex-col gap-12" role="document"><section class="flex flex-col gap-6" aria-labelledby="philosophy-title"><div class="flex items-center gap-4 border-b border-black/5 pb-4"><span class="text-3xl" aria-hidden="true">🕯️</span> <h3 id="philosophy-title" class="font-tiny5 text-3xl tracking-tighter text-brand uppercase"> </h3></div> <div class="space-y-4 font-serif text-base leading-relaxed text-studio-text/80"><p> </p> <p> </p> <p class="text-brand/60 italic"> </p></div></section> <div class="grid grid-cols-3 gap-6" role="list"><div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">☕</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">🧪</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">🥞</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div></div> <section class="flex flex-col gap-8 rounded-3xl bg-brand/5 p-10 ring-1 ring-brand/10" aria-labelledby="techniques-title"><h3 id="techniques-title" class="font-tiny5 text-2xl tracking-tighter text-brand uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-8"><div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🥛</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🪄</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">⏳</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🎹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div></div></section> <footer class="flex flex-col items-center gap-6 border-t border-black/5 pt-10 text-center"><div class="flex flex-col items-center gap-2"><p class="font-serif text-sm text-studio-text/50 italic"> </p> <span class="font-tiny5 text-[10px] tracking-[0.3em] text-studio-text/30 uppercase"> </span></div> <div class="flex items-center gap-4"><button class="editor-secondary-btn px-10 py-4"> </button> <button class="editor-primary-btn px-16 py-4 text-xl"> </button></div></footer></div>');function Nl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showGuideBook=!1);{let a=K(()=>A({key:"manual.title"})),s=K(()=>A({key:"manual.subtitle"}));Et(p,{get title(){return o(a)},get subtitle(){return o(s)},icon:"📜",get onClose(){return t()},width:"850px",children:(i,n)=>{var l=$l(),u=d(l),v=d(u),h=f(d(v),2),g=d(h,!0);c(h),c(v);var x=f(v,2),b=d(x),m=d(b,!0);c(b);var _=f(b,2),y=d(_,!0);c(_);var E=f(_,2),I=d(E,!0);c(E),c(x),c(u);var G=f(u,2),j=d(G),B=f(d(j),2),U=d(B,!0);c(B);var P=f(B,2),R=d(P,!0);c(P),c(j);var F=f(j,2),$=f(d(F),2),z=d($,!0);c($);var Y=f($,2),te=d(Y,!0);c(Y),c(F);var ae=f(F,2),Q=f(d(ae),2),se=d(Q,!0);c(Q);var me=f(Q,2),Se=d(me,!0);c(me),c(ae),c(G);var _e=f(G,2),Re=d(_e),Ne=d(Re,!0);c(Re);var J=f(Re,2),L=d(J),k=f(d(L),2),D=d(k),W=d(D,!0);c(D);var q=f(D,2),he=d(q,!0);c(q),c(k),c(L);var X=f(L,2),de=f(d(X),2),we=d(de),Ve=d(we,!0);c(we);var Je=f(we,2),Pe=d(Je,!0);c(Je),c(de),c(X);var xe=f(X,2),Me=f(d(xe),2),et=d(Me),Ue=d(et,!0);c(et);var Te=f(et,2),Ke=d(Te,!0);c(Te),c(Me),c(xe);var De=f(xe,2),qe=f(d(De),2),le=d(qe),ke=d(le,!0);c(le);var Ae=f(le,2),He=d(Ae,!0);c(Ae),c(qe),c(De),c(J),c(_e);var ze=f(_e,2),je=d(ze),tt=d(je),ft=d(tt);c(tt);var pt=f(tt,2),Qe=d(pt,!0);c(pt),c(je);var ee=f(je,2),pe=d(ee);pe.__click=()=>{t()(),r.showGuideMenu=!0};var at=d(pe,!0);c(pe);var it=f(pe,2);it.__click=function(...ut){t()?.apply(this,ut)};var St=d(it,!0);c(it),c(ee),c(ze),c(l),N((ut,Gt,bt,Tt,vt,Ht,aa,zt,Yt,va,ra,ha,Bt,Mt,Ot,Rt,sa,Dt,pa,fa,Kt,ga,Xe)=>{S(g,ut),S(m,Gt),S(y,bt),S(I,Tt),S(U,vt),S(R,Ht),S(z,aa),S(te,zt),S(se,Yt),S(Se,va),S(Ne,ra),S(W,ha),S(he,Bt),S(Ve,Mt),S(Pe,Ot),S(Ue,Rt),S(Ke,sa),S(ke,Dt),S(He,pa),S(ft,`"${fa??""}"`),S(Qe,Kt),S(at,ga),S(St,Xe)},[()=>A({key:"manual.philosophy.title"}),()=>A({key:"manual.philosophy.p1"}),()=>A({key:"manual.philosophy.p2"}),()=>A({key:"manual.philosophy.p3"}),()=>A({key:"manual.pillars.cursor.title"}),()=>A({key:"manual.pillars.cursor.desc"}),()=>A({key:"manual.pillars.colors.title"}),()=>A({key:"manual.pillars.colors.desc"}),()=>A({key:"manual.pillars.layers.title"}),()=>A({key:"manual.pillars.layers.desc"}),()=>A({key:"manual.techniques.title"}),()=>A({key:"manual.techniques.continuous.title"}),()=>A({key:"manual.techniques.continuous.desc"}),()=>A({key:"manual.techniques.magic_select.title"}),()=>A({key:"manual.techniques.magic_select.desc"}),()=>A({key:"manual.techniques.timeline.title"}),()=>A({key:"manual.techniques.timeline.desc"}),()=>A({key:"manual.techniques.audio.title"}),()=>A({key:"manual.techniques.audio.desc"}),()=>A({key:"manual.footer.quote"}),()=>A({key:"manual.footer.guild"}),()=>A({key:"manual.footer.all_shortcuts"}),()=>A({key:"manual.footer.enter"})]),T(i,l)},$$slots:{default:!0}})}oe()}Ie(["click"]);var Ul=O('<div class="grid grid-cols-2 gap-4"><div class="flex flex-col gap-2"><span class="text-xs font-bold text-charcoal/60 uppercase">Visibility</span> <button class="editor-tool-btn justify-center"> </button></div> <div class="flex flex-col gap-2"><label class="text-xs font-bold text-charcoal/60 uppercase" for="underlay-opacity"> </label> <input id="underlay-opacity" type="range" min="0" max="1" step="0.05" class="accent-brand"/></div></div> <div class="flex flex-col gap-2"><span class="text-xs font-bold text-charcoal/60 uppercase">Manual Positioning</span> <div class="flex items-center gap-4"><button class="editor-tool-btn text-xs">Reset View</button> <span class="text-[10px] text-charcoal/40 italic">Use Ctrl + Alt + Arrows to nudge on canvas.</span></div></div> <div class="border-t border-charcoal/5 pt-4"><button class="w-full text-xs text-red-500 hover:underline">Clear Reference Image</button></div>',1),Vl=O('<div class="flex flex-col gap-6 p-2"><div class="flex flex-col gap-2"><label class="text-xs font-bold text-charcoal/60 uppercase" for="underlay-file">Upload Reference Image</label> <input id="underlay-file" type="file" accept="image/*" class="text-xs text-charcoal/80"/></div> <!></div>');function Hl(p,e){ie(e,!1);const t=ja(r.studio);function a(i){const n=i.target;if(n.files&&n.files[0]){const l=new FileReader;l.onload=u=>{_t(t,o(t).underlayImage=u.target?.result)},l.readAsDataURL(n.files[0])}}function s(){_t(t,o(t).underlayOffset={x:0,y:0}),_t(t,o(t).underlayScale=1)}$e();{let i=ea(()=>A({key:"OPEN_UNDERLAY_MENU"}));Et(p,{get title(){return o(i)},onClose:()=>_t(t,o(t).showUnderlayMenu=!1),children:(n,l)=>{var u=Vl(),v=d(u),h=f(d(v),2);h.__change=a,c(v);var g=f(v,2);{var x=b=>{var m=Ul(),_=be(m),y=d(_),E=f(d(y),2);E.__click=()=>_t(t,o(t).isUnderlayVisible=!o(t).isUnderlayVisible);var I=d(E,!0);c(E),c(y);var G=f(y,2),j=d(G),B=d(j);c(j);var U=f(j,2);Ee(U),c(G),c(_);var P=f(_,2),R=f(d(P),2),F=d(R);F.__click=s,Pt(2),c(R),c(P);var $=f(P,2),z=d($);z.__click=()=>_t(t,o(t).underlayImage=null),c($),N(Y=>{S(I,o(t).isUnderlayVisible?"Hide Underlay":"Show Underlay"),S(B,`Vapor Opacity (${Y??""}%)`)},[()=>Math.round(o(t).underlayOpacity*100)]),Ce(U,()=>o(t).underlayOpacity,Y=>_t(t,o(t).underlayOpacity=Y)),T(b,m)};H(g,b=>{o(t).underlayImage&&b(x)})}c(u),T(n,u)},$$slots:{default:!0}})}oe()}Ie(["change","click"]);var zl=O('<div class="flex flex-col gap-8 p-2"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="cups-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="cups-input" type="number" min="1" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </span> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <div class="grid grid-cols-2 gap-4"><div class="flex items-center gap-3 rounded-xl border border-black/5 bg-white/40 p-3"><span class="font-mono text-[10px] font-bold text-studio-text/30">X</span> <input type="number" class="w-full bg-transparent font-mono text-sm font-bold text-studio-text focus:outline-none"/></div> <div class="flex items-center gap-3 rounded-xl border border-black/5 bg-white/40 p-3"><span class="font-mono text-[10px] font-bold text-studio-text/30">Y</span> <input type="number" class="w-full bg-transparent font-mono text-sm font-bold text-studio-text focus:outline-none"/></div></div></div> <button class="editor-primary-btn mt-4 w-full py-4 text-lg"> </button></div>');function Yl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.studio.showPourBasin=!1),a=C(5),s=C(1),i=C(0);function n(){V.selection.propagate(o(a),o(s),o(i)),t()()}{let l=K(()=>A({key:"export.propagation.title"})),u=K(()=>A({key:"export.propagation.subtitle"}));Et(p,{get title(){return o(l)},get subtitle(){return o(u)},icon:"🍯",get onClose(){return t()},width:"400px",children:(v,h)=>{var g=zl(),x=d(g),b=d(x),m=d(b),_=d(m,!0);c(m);var y=f(m,2),E=d(y,!0);c(y),c(b);var I=f(b,2);Ee(I),c(x);var G=f(x,2),j=d(G),B=d(j),U=d(B,!0);c(B);var P=f(B,2),R=d(P,!0);c(P),c(j);var F=f(j,2),$=d(F),z=f(d($),2);Ee(z),c($);var Y=f($,2),te=f(d(Y),2);Ee(te),c(Y),c(F),c(G);var ae=f(G,2);ae.__click=n;var Q=d(ae,!0);c(ae),c(g),N((se,me,Se,_e,Re)=>{S(_,se),S(E,me),M(I,"max",r.project.frames.length-r.project.activeFrameIndex-1),S(U,Se),S(R,_e),ae.disabled=o(a)<=0,S(Q,Re)},[()=>A({key:"export.propagation.frames_label"}),()=>A({key:"export.propagation.frames_desc"}),()=>A({key:"export.propagation.offset_label"}),()=>A({key:"export.propagation.offset_desc"}),()=>A({key:"export.propagation.action"})]),Ce(I,()=>o(a),se=>w(a,se)),Ce(z,()=>o(s),se=>w(s,se)),Ce(te,()=>o(i),se=>w(i,se)),T(v,g)},$$slots:{default:!0}})}oe()}Ie(["click"]);var Kl=O('<span class="text-xs opacity-60"> </span>'),ql=O('<button><div class="flex items-center gap-3"><!> <span class="font-serif text-xs font-medium"> </span></div></button>'),Ql=O('<div class="fixed z-[2000] min-w-[160px] overflow-hidden rounded-lg border border-charcoal/10 bg-foam-white/95 p-1 shadow-xl backdrop-blur-md" role="menu" tabindex="-1"><div class="flex flex-col gap-0.5"></div></div>');function Xl(p,e){ie(e,!0);let t=C(null),a=C(160),s=C(100),i=K(()=>e.x+o(a)>(typeof window<"u"?window.innerWidth:1e3)?e.x-o(a):e.x),n=K(()=>e.y+o(s)>(typeof window<"u"?window.innerHeight:1e3)?e.y-o(s):e.y);Vt(()=>{o(t)&&(w(a,o(t).offsetWidth,!0),w(s,o(t).offsetHeight,!0))});var l=Ql();We("mousedown",Ia,v=>!o(t)?.contains(v.target)&&e.onClose()),l.__contextmenu=v=>v.preventDefault();var u=d(l);Oe(u,21,()=>e.items,Be,(v,h)=>{var g=ql();g.__click=()=>{o(h).disabled||(o(h).action(),e.onClose())};var x=d(g),b=d(x);{var m=E=>{var I=Kl(),G=d(I,!0);c(I),N(()=>S(G,o(h).icon)),T(E,I)};H(b,E=>{o(h).icon&&E(m)})}var _=f(b,2),y=d(_,!0);c(_),c(x),c(g),N(()=>{g.disabled=o(h).disabled,re(g,1,`flex w-full items-center justify-between rounded px-3 py-2 text-left transition-colors ${o(h).danger?"text-red-600 hover:bg-red-50":"text-charcoal hover:bg-brand/5"} ${o(h).disabled?"cursor-not-allowed opacity-30 grayscale":""}`),S(y,o(h).label)}),T(v,g)}),c(u),c(l),jt(l,v=>w(t,v),()=>o(t)),N(()=>ge(l,`left: ${o(i)??""}px; top: ${o(n)??""}px;`)),ue(3,l,()=>Ft,()=>({duration:100,start:.95,opacity:0})),T(p,l),oe()}Ie(["contextmenu","click"]);var Wl=O('<div class="pointer-events-none fixed bottom-24 left-1/2 z-[2000] -translate-x-1/2 rounded-full border border-brand/20 bg-white/90 px-6 py-2 shadow-2xl backdrop-blur-md"><div class="flex items-center gap-3"><span class="font-tiny5 text-lg tracking-widest text-brand uppercase"> </span></div></div>');function Zl(p,e){ie(e,!1);const t=r.studio;$e();var a=Ye(),s=be(a);{var i=n=>{var l=Wl(),u=d(l),v=d(u),h=d(v,!0);c(v),c(u),c(l),N(()=>S(h,t.toastMessage)),ue(3,l,()=>Na,()=>({y:20,duration:300})),T(n,l)};H(s,n=>{t.showToast&&n(i)})}T(p,a),oe()}var ve=ta(()=>r),Jl=O('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg selection:bg-brand/20"><!> <div class="flex flex-1 overflow-hidden"><aside class="flex w-64 flex-col overflow-hidden"><!></aside> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20 p-6"><div><!></div></main> <aside class="flex w-72 flex-col overflow-hidden"><!></aside></div> <!></div>',1);function lc(p,e){ie(e,!1),Vt(()=>gt.mount()),$e();var t=Jl(),a=be(t);rl(a,{});var s=f(a,2);{var i=k=>{Nl(k,{onClose:()=>ve(ve().showGuideBook=!1)})};H(s,k=>{ve().showGuideBook&&k(i)})}var n=f(s,2);{var l=k=>{vl(k,{onClose:()=>ve(ve().showCommandPalette=!1)})};H(n,k=>{ve().showCommandPalette&&k(l)})}var u=f(n,2);{var v=k=>{Ua(k,{onClose:()=>ve(ve().showColorPicker=!1),get value(){return ve().paletteState.activeColor},set value(D){ve(ve().paletteState.activeColor=D)},$$legacy:!0})};H(u,k=>{ve().showColorPicker&&k(v)})}var h=f(u,2);{var g=k=>{wl(k,{onExport:(D,W,q)=>V.createArtifact(D,W,q),onClose:()=>ve(ve().showExportMenu=!1)})};H(h,k=>{ve().showExportMenu&&k(g)})}var x=f(h,2);{var b=k=>{Ml(k,{onClose:()=>ve(ve().showPersistenceMenu=!1)})};H(x,k=>{ve().showPersistenceMenu&&k(b)})}var m=f(x,2);{var _=k=>{Dl(k,{onClose:()=>ve(ve().showCanvasSettings=!1)})};H(m,k=>{ve().showCanvasSettings&&k(_)})}var y=f(m,2);{var E=k=>{Fl(k,{onClose:()=>ve(ve().showGoTo=!1)})};H(y,k=>{ve().showGoTo&&k(E)})}var I=f(y,2);{var G=k=>{Yl(k,{onClose:()=>ve(ve().studio.showPourBasin=!1)})};H(I,k=>{ve().studio.showPourBasin&&k(G)})}var j=f(I,2);{var B=k=>{Bl(k,{onClose:()=>ve(ve().showAudioSettings=!1)})};H(j,k=>{ve().showAudioSettings&&k(B)})}var U=f(j,2);{var P=k=>{Il(k,{onClose:()=>ve(ve().showGuideMenu=!1)})};H(U,k=>{ve().showGuideMenu&&k(P)})}var R=f(U,2);{var F=k=>{Hl(k,{})};H(R,k=>{ve().studio.showUnderlayMenu&&k(F)})}var $=f(R,2);{var z=k=>{Xl(k,{get x(){return ve().studio.contextMenu.x},get y(){return ve().studio.contextMenu.y},get items(){return ve().studio.contextMenu.items},onClose:()=>ve(ve().studio.contextMenu=null)})};H($,k=>{ve().studio.contextMenu&&k(z)})}var Y=f($,2);Zl(Y,{});var te=f(Y,2),ae=d(te);Oi(ae);var Q=f(ae,2),se=d(Q),me=d(se);Zi(me,{}),c(se);var Se=f(se,2),_e=d(Se),Re=d(_e);el(Re,{}),c(_e),c(Se);var Ne=f(Se,2),J=d(Ne);mo(J),c(Ne),c(Q);var L=f(Q,2);En(L),c(te),N(()=>re(_e,1,`editor-frame flex h-full w-full items-center justify-center overflow-hidden shadow-2xl transition-all duration-700 ease-out ${ve().project.isPlaying&&ve().project.frames.length>1?"ring-palette-0 animate-pulse ring-8 ring-inset":""}`)),T(p,t),oe()}export{ne as C,Xa as P,lc as _};
