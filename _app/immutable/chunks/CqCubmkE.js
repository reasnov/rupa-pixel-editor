const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Cl6mNt4y.js","./u7-2yxVl.js","./DnXmPbpO.js","./DpdFPL9-.js"])))=>i.map(i=>d[i]);
import{a as E,f as j,c as Fe,t as Ze,d as et}from"./BKE_8Qky.js";import{i as he}from"./z6XNcR_a.js";import{o as tt}from"./DdJ8-sRX.js";import{aL as ja,b as ua,h as ye,J as va,a as Ct,aM as pa,L as St,D as Fa,n as l,N as Ra,O as Ba,P as Jt,Q as Et,f as dt,aa as $a,aE as Oa,am as ea,c as Ue,aN as Me,e as jt,aO as Da,s as Va,a5 as vt,aP as za,aC as Dt,aQ as Ga,aR as Na,aH as Ua,a9 as Ft,aS as Ha,r as ha,p as fa,aT as Lt,U as Vt,aU as Ka,aV as qa,aB as Ya,d as Qa,ay as Xa,G as Wa,E as Za,aW as Ja,I as er,R as tr,j as Oe,aX as ar,aY as rr,aZ as Ye,au as xa,a_ as sr,a$ as ir,b0 as or,b1 as nr,b2 as lr,b3 as cr,b4 as dr,b5 as ur,aI as vr,S as pr,b6 as hr,_ as y,aJ as I,Z as ue,aK as q,i as Se,y as V,A as p,C as h,B as u,w as W,z as Z,x as pe,an as at,b7 as ta}from"./DnXmPbpO.js";import{_ as ga,i as Q,p as ie,b as He}from"./u7-2yxVl.js";import{a as fr,s as N,d as ve,e as de}from"./Dt61PMF7.js";import{B as xr}from"./DpdFPL9-.js";import{s as gr}from"./ri7ydiIA.js";const br=Symbol("NaN");function mr(d,e,t){ye&&va();var a=new xr(d),r=!ja();ua(()=>{var s=e();s!==s&&(s=br),r&&s!==null&&typeof s=="object"&&(s={}),a.ensure(s,t)})}function Ae(d,e){return e}function yr(d,e,t){for(var a=[],r=e.length,s,o=e.length,n=0;n<r;n++){let x=e[n];fa(x,()=>{if(s){if(s.pending.delete(x),s.done.add(x),s.pending.size===0){var g=d.outrogroups;Rt(Dt(s.done)),g.delete(s),g.size===0&&(d.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=a.length===0&&t!==null;if(c){var v=t,f=v.parentNode;Ya(f),f.append(v),d.items.clear()}Rt(e,!c)}else s={pending:new Set(e),done:new Set},(d.outrogroups??=new Set).add(s)}function Rt(d,e=!0){for(var t=0;t<d.length;t++)Qa(d[t],e)}var aa;function xe(d,e,t,a,r,s=null){var o=d,n=new Map,c=(e&pa)!==0;if(c){var v=d;o=ye?St(Fa(v)):v.appendChild(Ct())}ye&&va();var f=null,x=vt(()=>{var A=t();return za(A)?A:A==null?[]:Dt(A)}),g,b=!0;function _(){m.fallback=f,_r(m,g,o,e,a),f!==null&&(g.length===0?(f.f&Me)===0?ha(f):(f.f^=Me,We(f,null,o)):fa(f,()=>{f=null}))}var k=ua(()=>{g=l(x);var A=g.length;let L=!1;if(ye){var $=Ra(o)===Ba;$!==(A===0)&&(o=Jt(),St(o),Et(!1),L=!0)}for(var R=new Set,T=Ue,S=Va(),w=0;w<A;w+=1){ye&&dt.nodeType===$a&&dt.data===Oa&&(o=dt,L=!0,Et(!1));var M=g[w],D=a(M,w),z=b?null:n.get(D);z?(z.v&&ea(z.v,M),z.i&&ea(z.i,w),S&&T.unskip_effect(z.e)):(z=Ar(n,b?o:aa??=Ct(),M,D,w,r,e,t),b||(z.e.f|=Me),n.set(D,z)),R.add(D)}if(A===0&&s&&!f&&(b?f=jt(()=>s(o)):(f=jt(()=>s(aa??=Ct())),f.f|=Me)),A>R.size&&Da(),ye&&A>0&&St(Jt()),!b)if(S){for(const[C,O]of n)R.has(C)||T.skip_effect(O.e);T.oncommit(_),T.ondiscard(()=>{})}else _();L&&Et(!0),l(x)}),m={effect:k,items:n,outrogroups:null,fallback:f};b=!1,ye&&(o=dt)}function Qe(d){for(;d!==null&&(d.f&Ka)===0;)d=d.next;return d}function _r(d,e,t,a,r){var s=(a&qa)!==0,o=e.length,n=d.items,c=Qe(d.effect.first),v,f=null,x,g=[],b=[],_,k,m,A;if(s)for(A=0;A<o;A+=1)_=e[A],k=r(_,A),m=n.get(k).e,(m.f&Me)===0&&(m.nodes?.a?.measure(),(x??=new Set).add(m));for(A=0;A<o;A+=1){if(_=e[A],k=r(_,A),m=n.get(k).e,d.outrogroups!==null)for(const z of d.outrogroups)z.pending.delete(m),z.done.delete(m);if((m.f&Me)!==0)if(m.f^=Me,m===c)We(m,null,t);else{var L=f?f.next:c;m===d.effect.last&&(d.effect.last=m.prev),m.prev&&(m.prev.next=m.next),m.next&&(m.next.prev=m.prev),Re(d,f,m),Re(d,m,L),We(m,L,t),f=m,g=[],b=[],c=Qe(f.next);continue}if((m.f&Lt)!==0&&(ha(m),s&&(m.nodes?.a?.unfix(),(x??=new Set).delete(m))),m!==c){if(v!==void 0&&v.has(m)){if(g.length<b.length){var $=b[0],R;f=$.prev;var T=g[0],S=g[g.length-1];for(R=0;R<g.length;R+=1)We(g[R],$,t);for(R=0;R<b.length;R+=1)v.delete(b[R]);Re(d,T.prev,S.next),Re(d,f,T),Re(d,S,$),c=$,f=S,A-=1,g=[],b=[]}else v.delete(m),We(m,c,t),Re(d,m.prev,m.next),Re(d,m,f===null?d.effect.first:f.next),Re(d,f,m),f=m;continue}for(g=[],b=[];c!==null&&c!==m;)(v??=new Set).add(c),b.push(c),c=Qe(c.next);if(c===null)continue}(m.f&Me)===0&&g.push(m),f=m,c=Qe(m.next)}if(d.outrogroups!==null){for(const z of d.outrogroups)z.pending.size===0&&(Rt(Dt(z.done)),d.outrogroups?.delete(z));d.outrogroups.size===0&&(d.outrogroups=null)}if(c!==null||v!==void 0){var w=[];if(v!==void 0)for(m of v)(m.f&Lt)===0&&w.push(m);for(;c!==null;)(c.f&Lt)===0&&c!==d.fallback&&w.push(c),c=Qe(c.next);var M=w.length;if(M>0){var D=(a&pa)!==0&&o===0?t:null;if(s){for(A=0;A<M;A+=1)w[A].nodes?.a?.measure();for(A=0;A<M;A+=1)w[A].nodes?.a?.fix()}yr(d,w,D)}}s&&Vt(()=>{if(x!==void 0)for(m of x)m.nodes?.a?.apply()})}function Ar(d,e,t,a,r,s,o,n){var c=(o&Ga)!==0?(o&Na)===0?Ua(t,!1,!1):Ft(t):null,v=(o&Ha)!==0?Ft(r):null;return{v:c,i:v,e:jt(()=>(s(e,c??t,v??r,n),()=>{d.delete(a)}))}}function We(d,e,t){if(d.nodes)for(var a=d.nodes.start,r=d.nodes.end,s=e&&(e.f&Me)===0?e.nodes.start:t;a!==null;){var o=Xa(a);if(s.before(a),a===r)return;a=o}}function Re(d,e,t){e===null?d.effect.first=t:e.next=t,t===null?d.effect.last=e:t.prev=e}const wr=()=>performance.now(),Pe={tick:d=>requestAnimationFrame(d),now:()=>wr(),tasks:new Set};function ba(){const d=Pe.now();Pe.tasks.forEach(e=>{e.c(d)||(Pe.tasks.delete(e),e.f())}),Pe.tasks.size!==0&&Pe.tick(ba)}function kr(d){let e;return Pe.tasks.size===0&&Pe.tick(ba),{promise:new Promise(t=>{Pe.tasks.add(e={c:d,f:t})}),abort(){Pe.tasks.delete(e)}}}function pt(d,e){xa(()=>{d.dispatchEvent(new CustomEvent(e))})}function Cr(d){if(d==="float")return"cssFloat";if(d==="offset")return"cssOffset";if(d.startsWith("--"))return d;const e=d.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function ra(d){const e={},t=d.split(";");for(const a of t){const[r,s]=a.split(":");if(!r||s===void 0)break;const o=Cr(r.trim());e[o]=s.trim()}return e}const Sr=d=>d;function le(d,e,t,a){var r=(d&sr)!==0,s=(d&ir)!==0,o=r&&s,n=(d&ar)!==0,c=o?"both":r?"in":"out",v,f=e.inert,x=e.style.overflow,g,b;function _(){return xa(()=>v??=t()(e,a?.()??{},{direction:c}))}var k={is_global:n,in(){if(e.inert=f,!r){b?.abort(),b?.reset?.();return}s||g?.abort(),g=Bt(e,_(),b,1,()=>{pt(e,"introend"),g?.abort(),g=v=void 0,e.style.overflow=x})},out($){if(!s){$?.(),v=void 0;return}e.inert=!0,b=Bt(e,_(),g,0,()=>{pt(e,"outroend"),$?.()})},stop:()=>{g?.abort(),b?.abort()}},m=Wa;if((m.nodes.t??=[]).push(k),r&&fr){var A=n;if(!A){for(var L=m.parent;L&&(L.f&Za)!==0;)for(;(L=L.parent)&&(L.f&Ja)===0;);A=!L||(L.f&er)!==0}A&&tr(()=>{Oe(()=>k.in())})}}function Bt(d,e,t,a,r){var s=a===1;if(rr(e)){var o,n=!1;return Vt(()=>{if(!n){var m=e({direction:s?"in":"out"});o=Bt(d,m,t,a,r)}}),{abort:()=>{n=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return pt(d,s?"introstart":"outrostart"),r(),{abort:Ye,deactivate:Ye,reset:Ye,t:()=>a};const{delay:c=0,css:v,tick:f,easing:x=Sr}=e;var g=[];if(s&&t===void 0&&(f&&f(0,1),v)){var b=ra(v(0,1));g.push(b,b)}var _=()=>1-a,k=d.animate(g,{duration:c,fill:"forwards"});return k.onfinish=()=>{k.cancel(),pt(d,s?"introstart":"outrostart");var m=t?.t()??1-a;t?.abort();var A=a-m,L=e.duration*Math.abs(A),$=[];if(L>0){var R=!1;if(v)for(var T=Math.ceil(L/16.666666666666668),S=0;S<=T;S+=1){var w=m+A*x(S/T),M=ra(v(w,1-w));$.push(M),R||=M.overflow==="hidden"}R&&(d.style.overflow="hidden"),_=()=>{var D=k.currentTime;return m+A*x(D/L)},f&&kr(()=>{if(k.playState!=="running")return!1;var D=_();return f(D,1-D),!0})}k=d.animate($,{duration:L,fill:"forwards"}),k.onfinish=()=>{_=()=>a,f?.(a,1-a),r()}},{abort:()=>{k&&(k.cancel(),k.effect=null,k.onfinish=Ye)},deactivate:()=>{r=Ye},reset:()=>{a===0&&f?.(1,0)},t:()=>_()}}function ma(d){var e,t,a="";if(typeof d=="string"||typeof d=="number")a+=d;else if(typeof d=="object")if(Array.isArray(d)){var r=d.length;for(e=0;e<r;e++)d[e]&&(t=ma(d[e]))&&(a&&(a+=" "),a+=t)}else for(t in d)d[t]&&(a&&(a+=" "),a+=t);return a}function Er(){for(var d,e,t=0,a="",r=arguments.length;t<r;t++)(d=arguments[t])&&(e=ma(d))&&(a&&(a+=" "),a+=e);return a}function Lr(d){return typeof d=="object"?Er(d):d??""}const sa=[...` 	
\r\fÂ \v\uFEFF`];function Ir(d,e,t){var a=d==null?"":""+d;if(e&&(a=a?a+" "+e:e),t){for(var r in t)if(t[r])a=a?a+" "+r:r;else if(a.length)for(var s=r.length,o=0;(o=a.indexOf(r,o))>=0;){var n=o+s;(o===0||sa.includes(a[o-1]))&&(n===a.length||sa.includes(a[n]))?a=(o===0?"":a.substring(0,o))+a.substring(n+1):o=n}}return a===""?null:a}function Tr(d,e){return d==null?null:String(d)}function K(d,e,t,a,r,s){var o=d.__className;if(ye||o!==t||o===void 0){var n=Ir(t,a,s);(!ye||n!==d.getAttribute("class"))&&(n==null?d.removeAttribute("class"):e?d.className=n:d.setAttribute("class",n)),d.__className=t}else if(s&&r!==s)for(var c in s){var v=!!s[c];(r==null||v!==!!r[c])&&d.classList.toggle(c,v)}return s}function ae(d,e,t,a){var r=d.__style;if(ye||r!==e){var s=Tr(e);(!ye||s!==d.getAttribute("style"))&&(s==null?d.removeAttribute("style"):d.style.cssText=s),d.__style=e}return a}const Pr=Symbol("is custom element"),Mr=Symbol("is html");function ge(d){if(ye){var e=!1,t=()=>{if(!e){if(e=!0,d.hasAttribute("value")){var a=d.value;F(d,"value",null),d.value=a}if(d.hasAttribute("checked")){var r=d.checked;F(d,"checked",null),d.checked=r}}};d.__on_r=t,Vt(t),dr()}}function F(d,e,t,a){var r=jr(d);ye&&(r[e]=d.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&d.nodeName==="LINK")||r[e]!==(r[e]=t)&&(e==="loading"&&(d[or]=t),t==null?d.removeAttribute(e):typeof t!="string"&&Fr(d).includes(e)?d[e]=t:d.setAttribute(e,t))}function jr(d){return d.__attributes??={[Pr]:d.nodeName.includes("-"),[Mr]:d.namespaceURI===nr}}var ia=new Map;function Fr(d){var e=d.getAttribute("is")||d.nodeName,t=ia.get(e);if(t)return t;ia.set(e,t=[]);for(var a,r=d,s=Element.prototype;s!==r;){a=cr(r);for(var o in a)a[o].set&&t.push(o);r=lr(r)}return t}function be(d,e,t=e){var a=new WeakSet;ur(d,"input",async r=>{var s=r?d.defaultValue:d.value;if(s=It(d)?Tt(s):s,t(s),Ue!==null&&a.add(Ue),await vr(),s!==(s=e())){var o=d.selectionStart,n=d.selectionEnd,c=d.value.length;if(d.value=s??"",n!==null){var v=d.value.length;o===n&&n===c&&v>c?(d.selectionStart=v,d.selectionEnd=v):(d.selectionStart=o,d.selectionEnd=Math.min(n,v))}}}),(ye&&d.defaultValue!==d.value||Oe(e)==null&&d.value)&&(t(It(d)?Tt(d.value):d.value),Ue!==null&&a.add(Ue)),pr(()=>{var r=e();if(d===document.activeElement){var s=hr??Ue;if(a.has(s))return}It(d)&&r===Tt(d.value)||d.type==="date"&&!r&&!d.value||r!==d.value&&(d.value=r??"")})}function It(d){var e=d.type;return e==="number"||e==="range"}function Tt(d){return d===""?null:+d}function gt(d){var e=Ft(0);return function(){return arguments.length===1?(y(e,l(e)+1),arguments[0]):(l(e),d())}}class Rr{project;#e=I(ue([]));get pixelBuffer(){return l(this.#e)}set pixelBuffer(e){y(this.#e,e,!0)}#t=I(ue([]));get strokePoints(){return l(this.#t)}set strokePoints(e){y(this.#t,e,!0)}internalBuffer=new Set;constructor(e){this.project=e}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get pixels(){return this.project.activeFrame.activeLayer.pixels}get compositePixels(){return this.project.activeFrame.compositePixels}set pixels(e){this.project.activeFrame.activeLayer.pixels=e}clearBuffer(){this.internalBuffer.clear(),this.pixelBuffer=[],this.strokePoints=[]}addBatchToBuffer(e){const t=[...this.strokePoints];e.forEach(a=>{const r=Math.floor(a.x),s=Math.floor(a.y);this.isValidCoord(r,s)&&(this.internalBuffer.add(this.getIndex(r,s)),t.push({x:a.x,y:a.y}))}),this.strokePoints=t,this.pixelBuffer=Array.from(this.internalBuffer)}addToBuffer(e,t){this.addBatchToBuffer([{x:e,y:t}])}reset(e,t,a){this.width=e,this.height=t,this.pixels=a}clear(){this.project.activeFrame.activeLayer.clear()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.compositePixels[this.getIndex(e,t)]}setColor(e,t,a){this.pixels[this.getIndex(e,t)]=a}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}#a=q(()=>`calc((100cqi - 20px) * ${this.width} / (${this.width} + 2))`);get fitWidth(){return l(this.#a)}set fitWidth(e){y(this.#a,e)}#r=q(()=>`calc((100cqb - 20px) * ${this.height} / (${this.height} + 2))`);get fitHeight(){return l(this.#r)}set fitHeight(e){y(this.#r,e)}getFitDimension(e){const t=this.width,a=this.height;return e==="horizontal"?`min(${this.fitWidth}, calc(${this.fitHeight} * (${t} / ${a})))`:`min(${this.fitHeight}, calc(${this.fitWidth} * (${a} / ${t})))`}}class Br{#e=I(ue({x:0,y:0}));get pos(){return l(this.#e)}set pos(e){y(this.#e,e,!0)}#t=I(!0);get isVisible(){return l(this.#t)}set isVisible(e){y(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}const $r=["#2d3319","#4b5d16","#859900","#a2ad59","#eee8d5","#fdf6e3","#93a1a1","#586e75","#073642","#002b36"],Or=["#002b36","#073642","#586e75","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#2aa198","#859900"],Pt={default:["#333333","#999999","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"],botanical:$r,sunset:Or};class Dr{#e=I(ue(Pt.default[0]));get activeColor(){return l(this.#e)}set activeColor(e){y(this.#e,e,!0)}#t=I(ue(Pt.default));get swatches(){return l(this.#t)}set swatches(e){y(this.#t,e,!0)}select(e){e>=0&&e<this.swatches.length&&(this.activeColor=this.swatches[e])}setColor(e){this.activeColor=e}loadPalette(e){this.swatches=Pt[e],this.activeColor=this.swatches[0]}}const Vr=["showColorPicker","showAudioSettings","showCommandPalette","showGuideMenu","showGuideBook","showExportMenu","showCanvasSettings","showPersistenceMenu","showGoTo"],zr={managed:Vr};class Gr{#e=I(1);get zoomLevel(){return l(this.#e)}set zoomLevel(e){y(this.#e,e,!0)}#t=I(!1);get isMuted(){return l(this.#t)}set isMuted(e){y(this.#t,e,!0)}#a=I(!0);get isAmbientPlaying(){return l(this.#a)}set isAmbientPlaying(e){y(this.#a,e,!0)}#r=I(!1);get isAppReady(){return l(this.#r)}set isAppReady(e){y(this.#r,e,!0)}#s=I(!1);get isPicking(){return l(this.#s)}set isPicking(e){y(this.#s,e,!0)}#i=I(50);get stabilization(){return l(this.#i)}set stabilization(e){y(this.#i,e,!0)}#o=I(.5);get bgmVolume(){return l(this.#o)}set bgmVolume(e){y(this.#o,e,!0)}#n=I(.5);get sfxVolume(){return l(this.#n)}set sfxVolume(e){y(this.#n,e,!0)}#l=I(10);get fps(){return l(this.#l)}set fps(e){y(this.#l,e,!0)}#c=I(!1);get isKineticMode(){return l(this.#c)}set isKineticMode(e){y(this.#c,e,!0)}#d=I(!1);get showGhostLayers(){return l(this.#d)}set showGhostLayers(e){y(this.#d,e,!0)}#u=I(1);get timelineZoom(){return l(this.#u)}set timelineZoom(e){y(this.#u,e,!0)}sessionStartTime=Date.now();#v=I(0);get usageMinutes(){return l(this.#v)}set usageMinutes(e){y(this.#v,e,!0)}#p=I(0);get usageSeconds(){return l(this.#p)}set usageSeconds(e){y(this.#p,e,!0)}#h=q(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),a=Math.floor(e%3600/60),r=e%60;return`${t>0?t+":":""}${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`});get sessionTimeLabel(){return l(this.#h)}set sessionTimeLabel(e){y(this.#h,e)}#f=I(!1);get showColorPicker(){return l(this.#f)}set showColorPicker(e){y(this.#f,e,!0)}#x=I(!1);get showAudioSettings(){return l(this.#x)}set showAudioSettings(e){y(this.#x,e,!0)}#g=I(!1);get showCommandPalette(){return l(this.#g)}set showCommandPalette(e){y(this.#g,e,!0)}#b=I(!1);get showGuideMenu(){return l(this.#b)}set showGuideMenu(e){y(this.#b,e,!0)}#m=I(!1);get showGuideBook(){return l(this.#m)}set showGuideBook(e){y(this.#m,e,!0)}#y=I(!1);get showExportMenu(){return l(this.#y)}set showExportMenu(e){y(this.#y,e,!0)}#_=I(!1);get showCanvasSettings(){return l(this.#_)}set showCanvasSettings(e){y(this.#_,e,!0)}#A=I(!1);get showPersistenceMenu(){return l(this.#A)}set showPersistenceMenu(e){y(this.#A,e,!0)}#w=I(!1);get showGoTo(){return l(this.#w)}set showGoTo(e){y(this.#w,e,!0)}#k=I("layers");get projectActiveTab(){return l(this.#k)}set projectActiveTab(e){y(this.#k,e,!0)}#C=I("#eee8d5");get backgroundColor(){return l(this.#C)}set backgroundColor(e){y(this.#C,e,!0)}#S=I(10);get exportScale(){return l(this.#S)}set exportScale(e){y(this.#S,e,!0)}#E=I("transparent");get exportBgColor(){return l(this.#E)}set exportBgColor(e){y(this.#E,e,!0)}#L=I(!1);get includePixelBorders(){return l(this.#L)}set includePixelBorders(e){y(this.#L,e,!0)}escapeStack=[];#I=I(ue([]));get _overlayStack(){return l(this.#I)}set _overlayStack(e){y(this.#I,e,!0)}_managedOverlays=zr.managed;constructor(){setInterval(()=>{const e=Date.now()-this.sessionStartTime;this.usageMinutes=Math.floor(e/6e4),this.usageSeconds=Math.floor(e/1e3)},1e3)}mount(){Se(()=>{for(const e of this._managedOverlays)this[e]?Oe(()=>this._overlayStack.includes(e))||(this._overlayStack=[...Oe(()=>this._overlayStack),e]):Oe(()=>this._overlayStack.includes(e))&&(this._overlayStack=Oe(()=>this._overlayStack.filter(a=>a!==e)))})}setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.1,Math.min(10,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();if(e)return e(),!0;const t=this._overlayStack[this._overlayStack.length-1];return t?(this[t]=!1,!0):!1}}class Je{id=crypto.randomUUID();#e=I("New Layer");get name(){return l(this.#e)}set name(e){y(this.#e,e,!0)}#t=I(!0);get isVisible(){return l(this.#t)}set isVisible(e){y(this.#t,e,!0)}#a=I(!1);get isLocked(){return l(this.#a)}set isLocked(e){y(this.#a,e,!0)}#r=I(1);get opacity(){return l(this.#r)}set opacity(e){y(this.#r,e,!0)}#s=I(ue([]));get pixels(){return l(this.#s)}set pixels(e){y(this.#s,e,!0)}constructor(e,t,a){this.name=e,this.pixels=Array(t*a).fill(null)}clone(e,t){const a=new Je(this.name,e,t);return a.pixels=[...this.pixels],a.isVisible=this.isVisible,a.isLocked=this.isLocked,a.opacity=this.opacity,a}clear(){this.pixels.fill(null)}hasPixel(e){return this.pixels[e]!==null}}class ht{id=crypto.randomUUID();#e=I("Untitled Frame");get name(){return l(this.#e)}set name(e){y(this.#e,e,!0)}#t=I(32);get width(){return l(this.#t)}set width(e){y(this.#t,e,!0)}#a=I(32);get height(){return l(this.#a)}set height(e){y(this.#a,e,!0)}#r=I(100);get duration(){return l(this.#r)}set duration(e){y(this.#r,e,!0)}#s=I(ue([]));get layers(){return l(this.#s)}set layers(e){y(this.#s,e,!0)}#i=I(0);get activeLayerIndex(){return l(this.#i)}set activeLayerIndex(e){y(this.#i,e,!0)}constructor(e,t=32,a=32){this.name=e,this.width=t,this.height=a,this.layers=[new Je("Base Layer",t,a)]}get activeLayer(){return this.layers[this.activeLayerIndex]}addLayer(e){const t=e||`Layer ${this.layers.length+1}`,a=new Je(t,this.width,this.height);return this.layers.push(a),this.activeLayerIndex=this.layers.length-1,a}removeLayer(e){this.layers.length<=1||(this.layers.splice(e,1),this.activeLayerIndex>=this.layers.length&&(this.activeLayerIndex=this.layers.length-1))}#o=q(()=>{const e=new Array(this.width*this.height).fill(null);for(const t of this.layers){if(!t.isVisible)continue;const a=t.pixels;for(let r=0;r<e.length;r++){const s=a[r];s!==null&&(e[r]=s)}}return e});get compositePixels(){return l(this.#o)}set compositePixels(e){y(this.#o,e)}}class Nr{#e=I(null);get currentFilePath(){return l(this.#e)}set currentFilePath(e){y(this.#e,e,!0)}#t=I(null);get lastSaved(){return l(this.#t)}set lastSaved(e){y(this.#t,e,!0)}#a=I(ue([]));get frames(){return l(this.#a)}set frames(e){y(this.#a,e,!0)}#r=I(0);get activeFrameIndex(){return l(this.#r)}set activeFrameIndex(e){y(this.#r,e,!0)}#s=I(!1);get isPlaying(){return l(this.#s)}set isPlaying(e){y(this.#s,e,!0)}#i=I(null);get clipboard(){return l(this.#i)}set clipboard(e){y(this.#i,e,!0)}constructor(){this.frames=[new ht("Main Art")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,a=new ht(t);return this.frames.push(a),this.activeFrameIndex=this.frames.length-1,a}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e=null){this.currentFilePath=e,this.lastSaved=new Date}}class Ur{#e=I(null);get start(){return l(this.#e)}set start(e){y(this.#e,e,!0)}#t=I(null);get end(){return l(this.#t)}set end(e){y(this.#t,e,!0)}#a=I(ue([]));get indices(){return l(this.#a)}set indices(e){y(this.#a,e,!0)}#r=I(ue([]));get vertices(){return l(this.#r)}set vertices(e){y(this.#r,e,!0)}#s=q(()=>{const e=new Set,t=i.canvas.width;this.indices.forEach(r=>e.add(r));const a=this.rectangularBounds;if(a)for(let r=a.y1;r<=a.y2;r++)for(let s=a.x1;s<=a.x2;s++)e.add(r*t+s);return e});get activeIndicesSet(){return l(this.#s)}set activeIndicesSet(e){y(this.#s,e)}get isActive(){return this.indices.length>0||this.start!==null||this.vertices.length>0}begin(e,t){this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.indices=[],this.vertices=[]}getPoints(e){const t=new Map;this.indices.forEach(r=>{t.set(r,{x:r%e,y:Math.floor(r/e)})});const a=this.rectangularBounds;if(a)for(let r=a.y1;r<=a.y2;r++)for(let s=a.x1;s<=a.x2;s++){const o=r*e+s;t.set(o,{x:s,y:r})}return Array.from(t.values())}getBoundaryEdges(e){const t=[],a=this.getPoints(e);if(a.length===0)return t;const r=new Set(a.map(s=>`${s.x},${s.y}`));return a.forEach(s=>{r.has(`${s.x},${s.y-1}`)||t.push({x1:s.x,y1:s.y,x2:s.x+1,y2:s.y}),r.has(`${s.x},${s.y+1}`)||t.push({x1:s.x,y1:s.y+1,x2:s.x+1,y2:s.y+1}),r.has(`${s.x-1},${s.y}`)||t.push({x1:s.x,y1:s.y,x2:s.x,y2:s.y+1}),r.has(`${s.x+1},${s.y}`)||t.push({x1:s.x+1,y1:s.y,x2:s.x+1,y2:s.y+1})}),t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){const t=this.getPoints(e);if(t.length===0)return null;let a=1/0,r=-1/0,s=1/0,o=-1/0;return t.forEach(n=>{n.x<a&&(a=n.x),n.x>r&&(r=n.x),n.y<s&&(s=n.y),n.y>o&&(o=n.y)}),{x1:a,x2:r,y1:s,y2:o,width:r-a+1,height:o-s+1}}}class Hr{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){!("isStructural"in e)&&!Array.isArray(e)&&e.oldColor===e.newColor||(this.currentBatch&&!("isStructural"in e)&&!Array.isArray(e)?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const X=new Hr;class Kr{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const zt=new Kr,qr={"c-major":[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25]},Yr={move:{freq:450,duration:.08,volume:.15},draw:{freq:1200,duration:.15,volume:.03},startup:{freq:220,duration:.8,volume:.1},ready:[523.25,659.25,783.99,1046.5]},Qr={scale:[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25],chords:[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]],fade:{startMins:30,fullMins:60}},$e={scales:qr,tones:Yr,ambient:Qr};class Xr{get ctx(){return zt.ctx}playTone(e,t,a="sine",r=.1,s=1e-4){if(i.isMuted)return;const o=this.ctx.createOscillator(),n=this.ctx.createGain();o.type=a,o.frequency.setValueAtTime(e,this.ctx.currentTime);const c=r*i.sfxVolume;n.gain.setValueAtTime(c,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(s,this.ctx.currentTime+t),o.connect(n),n.connect(this.ctx.destination),o.start(),o.stop(this.ctx.currentTime+t)}playMove(){const{freq:e,duration:t,volume:a}=$e.tones.move;this.playTone(e,t,"sine",a)}playDraw(){const{freq:e,duration:t,volume:a}=$e.tones.draw;this.playTone(e,t,"sine",a),setTimeout(()=>this.playTone(e*1.25,t*.6,"sine",a*.6),50)}playScale(e){const t=$e.scales["c-major"],a=t[e%t.length];this.playTone(a,.15,"sine",.12)}playErase(){if(i.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,a=this.ctx.createBuffer(1,t,this.ctx.sampleRate),r=a.getChannelData(0);for(let v=0;v<t;v++)r[v]=Math.random()*2-1;const s=this.ctx.createBufferSource();s.buffer=a;const o=this.ctx.createBiquadFilter();o.type="lowpass",o.frequency.setValueAtTime(1500,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const n=this.ctx.createGain(),c=.1*i.sfxVolume;n.gain.setValueAtTime(c,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),s.connect(o),o.connect(n),n.connect(this.ctx.destination),s.start()}playStartup(){const{freq:e,duration:t,volume:a}=$e.tones.startup;this.playTone(e,t,"sine",a),this.playTone(e/2,t*1.5,"sine",a/2)}playReady(){$e.tones.ready.forEach((t,a)=>{setTimeout(()=>this.playTone(t,.4,"sine",.05),a*100)})}}const U=new Xr;class Wr{move(e,t){const a=Math.max(0,Math.min(i.canvas.width-1,i.cursor.pos.x+e)),r=Math.max(0,Math.min(i.canvas.height-1,i.cursor.pos.y+t));return a!==i.cursor.pos.x||r!==i.cursor.pos.y?(i.cursor.setPos(a,r),U.playMove(),!0):!1}internalToCartesian(e,t,a,r){const s=(o,n)=>{const c=Math.floor(n/2);return n%2===0?o<c?o-c:o-c+1:o-c};return{x:s(e,a),y:-s(t,r)}}cartesianToInternal(e,t,a,r){const s=Math.floor(a/2),o=Math.floor(r/2);let n,c;a%2===0?n=e<0?e+s:e+s-1:n=e+s;const v=-t;return r%2===0?c=v<0?v+o:v+o-1:c=v+o,{x:Math.max(0,Math.min(a-1,n)),y:Math.max(0,Math.min(r-1,c))}}jumpTo(e,t){const{x:a,y:r}=this.cartesianToInternal(e,t,i.canvas.width,i.canvas.height);i.cursor.setPos(a,r)}jumpHome(){this.jumpTo(1,1),U.playMove()}}class De{static getLinePoints(e,t,a,r,s=0){e=Math.floor(e),t=Math.floor(t),a=Math.floor(a),r=Math.floor(r);const o=[],n=Math.abs(a-e),c=Math.abs(r-t),v=e<a?1:-1,f=t<r?1:-1;let x=n-c;for(;;){o.push({x:e,y:t});const g=n===c,b=n===0||c===0;if(s>.9&&!g&&!b&&(n>c?o.push({x:e,y:t+f}):o.push({x:e+v,y:t})),e===a&&t===r)break;const _=2*x;_>-c&&(x-=c,e+=v),_<n&&(x+=n,t+=f)}return o}static getCirclePoints(e,t,a){e=Math.floor(e),t=Math.floor(t),a=Math.round(a);const r=[];let s=a,o=0,n=0;for(;s>=o;)[{x:e+s,y:t+o},{x:e+o,y:t+s},{x:e-o,y:t+s},{x:e-s,y:t+o},{x:e-s,y:t-o},{x:e-o,y:t-s},{x:e+o,y:t-s},{x:e+s,y:t-o}].forEach(v=>r.push(v)),n<=0&&(o+=1,n+=2*o+1),n>0&&(s-=1,n-=2*s+1);return r}static fitArc(e,t){if(e.length<10)return null;let a=0,r=0;e.forEach(w=>{a+=w.x,r+=w.y});const s=a/e.length,o=r/e.length;let n=0;const c=e.map(w=>{const M=Math.sqrt((w.x-s)**2+(w.y-o)**2);return n+=M,M}),v=n/e.length;let f=0;if(c.forEach(w=>{f+=(w-v)**2}),Math.sqrt(f/e.length)/(v||1)>t)return null;const b=e[0],_=e[e.length-1],m=Math.sqrt((b.x-_.x)**2+(b.y-_.y)**2)<v*1.5||e.length>v*Math.PI*1.5,A=[],L=Math.atan2(e[0].y-o,e[0].x-s),$=Math.atan2(e[e.length-1].y-o,e[e.length-1].x-s),R=Math.max(32,Math.floor(v*10));let T=$-L;for(;T>Math.PI;)T-=Math.PI*2;for(;T<-Math.PI;)T+=Math.PI*2;const S=m?Math.PI*2:T;for(let w=0;w<=R;w++){const M=L+S*(w/R);A.push({x:s+Math.cos(M)*v,y:o+Math.sin(M)*v})}return{cx:s,cy:o,r:v,isFull:m,points:A}}static perpendicularDistance(e,t,a){const r=a.x-t.x,s=a.y-t.y;return r===0&&s===0?Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2):Math.abs(s*e.x-r*e.y+a.x*t.y-a.y*t.x)/Math.sqrt(r*r+s*s)}static toCartesianLabel(e,t,a=!1){const r=Math.floor(t/2),s=t%2===0?e<r?e-r:e-r+1:e-r;return a?-s:s}static getGuidePosition(e,t){return 50+e/t*100}}class oa{static simplify(e,t){if(e.length<=2||t<=0)return e;let a=0,r=0;const s=e[0],o=e[e.length-1];for(let n=1;n<e.length-1;n++){const c=De.perpendicularDistance(e[n],s,o);c>a&&(r=n,a=c)}if(a>t){const n=this.simplify(e.slice(0,r+1),t),c=this.simplify(e.slice(r),t);return[...n.slice(0,-1),...c]}else return[s,o]}static smooth(e,t){if(e.length<=2||t<=0)return e;const a=[...e],r=Math.floor(t/10)+1;for(let s=1;s<e.length-1;s++){let o=0,n=0,c=0;for(let v=s-r;v<=s+r;v++)v>=0&&v<e.length&&(o+=e[v].x,n+=e[v].y,c++);a[s]={x:o/c,y:n/c}}return a}static traceCluster(e,t){const a=new Set;for(const s of e){const o=s%t,n=Math.floor(s/t);[{x:o,y:n-1,id:"top"},{x:o+1,y:n,id:"right"},{x:o,y:n+1,id:"bottom"},{x:o-1,y:n,id:"left"}].forEach(v=>{const f=v.y*t+v.x;if(v.x<0||v.x>=t||v.y<0||!e.has(f)){let g;v.id==="top"?g=`${o},${n}-${o+1},${n}`:v.id==="right"?g=`${o+1},${n}-${o+1},${n+1}`:v.id==="bottom"?g=`${o+1},${n+1}-${o},${n+1}`:g=`${o},${n+1}-${o},${n}`,a.add(g)}})}const r=[];for(;a.size>0;){const s=a.values().next().value;if(!s)break;a.delete(s);const[o,n]=s.split("-");let c=n,v=`M ${o.replace(","," ")} L ${n.replace(","," ")}`,f=!0;for(;f;){f=!1;for(const x of a)if(x.startsWith(c+"-")){const[g,b]=x.split("-");v+=` L ${b.replace(","," ")}`,c=b,a.delete(x),f=!0;break}}v+=" Z",r.push(v)}return r.join(" ")}}class Be{static getLinePoints(e,t,a,r,s=0){return De.getLinePoints(e,t,a,r,s)}static simplifyPath(e,t){return oa.simplify(e,t)}static smoothPath(e,t){return oa.smooth(e,t)}static fitArc(e,t){if(t<10)return null;const a=.05+t/100*.35;return De.fitArc(e,a)}static getCirclePoints(e,t,a){return De.getCirclePoints(e,t,a)}static floodFill(e,t,a,r,s,o){const n=e[s*t+r];if(n===o)return e;const c=[...e],v=[[r,s]],f=new Set;for(;v.length>0;){const[x,g]=v.pop(),b=g*t+x;if(!f.has(b)){f.add(b),c[b]=o;const _=[[x+1,g],[x-1,g],[x,g+1],[x,g-1]];for(const[k,m]of _)k>=0&&k<t&&m>=0&&m<a&&c[m*t+k]===n&&v.push([k,m])}}return c}static recolor(e,t,a){return e.map(r=>r===t?a:r)}static getPaletteUsage(e){const t=new Set;return e.forEach(a=>{a&&t.add(a)}),t}}class Zr{draw(e,t){const a=e!==void 0?Math.floor(e):i.cursor.pos.x,r=t!==void 0?Math.floor(t):i.cursor.pos.y,s=i.canvas.getIndex(a,r);if(i.selection.isActive&&!i.selection.activeIndicesSet.has(s))return;const o=i.canvas.pixels[s],n=i.paletteState.activeColor;if(o!==n){const c=[...i.canvas.pixels];c[s]=n,i.canvas.pixels=c,X.push({index:s,oldColor:o,newColor:n}),U.playDraw()}}erase(e,t){const a=e!==void 0?Math.floor(e):i.cursor.pos.x,r=t!==void 0?Math.floor(t):i.cursor.pos.y,s=i.canvas.getIndex(a,r);if(i.selection.isActive&&!i.selection.activeIndicesSet.has(s))return;const o=i.canvas.pixels[s];if(o!==null){const n=[...i.canvas.pixels];n[s]=null,i.canvas.pixels=n,X.push({index:s,oldColor:o,newColor:null}),U.playErase()}}beginStroke(e,t){i.canvas.clearBuffer(),i.canvas.addToBuffer(e,t)}continueStroke(e,t,a,r){const s=Be.getLinePoints(a,r,e,t,0);i.canvas.addBatchToBuffer(s)}endStroke(){this.commitBuffer()}cancelStroke(){i.canvas.clearBuffer(),U.playErase()}snapCurrentStroke(){const e=i.canvas.strokePoints;if(e.length<5)return;const t=i.studio.stabilization,a=Be.smoothPath(e,t/10),r=Be.fitArc(a,t);i.canvas.clearBuffer();let s=[],o=[];if(r&&r.isFull)o=r.points,s=Be.getCirclePoints(r.cx,r.cy,r.r);else{const n=Be.simplifyPath(a,t/100*2);if(n.length===2){let c={...n[0]},v={...n[n.length-1]};const f=Math.abs(v.x-c.x),x=Math.abs(v.y-c.y),g=3;if(f<g)v.x=c.x;else if(x<g)v.y=c.y;else if(Math.abs(f-x)<g){const b=Math.max(f,x);v.x=c.x+b*Math.sign(v.x-c.x),v.y=c.y+b*Math.sign(v.y-c.y)}o=[c,v],s=Be.getLinePoints(c.x,c.y,v.x,v.y,0)}else if(r){o=r.points;for(let c=0;c<o.length-1;c++)s.push(...Be.getLinePoints(o[c].x,o[c].y,o[c+1].x,o[c+1].y,t/100))}else{o=n;for(let c=0;c<o.length-1;c++)s.push(...Be.getLinePoints(o[c].x,o[c].y,o[c+1].x,o[c+1].y,t/100))}}i.canvas.addBatchToBuffer(s),i.canvas.strokePoints=o,U.playDraw()}commitBuffer(){const e=i.canvas.pixelBuffer;if(e.length===0){i.canvas.clearBuffer();return}const t=i.paletteState.activeColor,a=[],r=[...i.canvas.pixels];e.forEach(s=>{if(i.selection.isActive&&!i.selection.activeIndicesSet.has(s))return;const o=r[s];o!==t&&(a.push({index:s,oldColor:o,newColor:t}),r[s]=t)}),a.length>0&&(i.canvas.pixels=r,X.push(a),U.playDraw()),i.canvas.clearBuffer()}}class Jr{resize(e,t){const a=Array(e*t).fill("#eee8d5");for(let r=0;r<Math.min(i.canvas.height,t);r++)for(let s=0;s<Math.min(i.canvas.width,e);s++){const o=r*i.canvas.width+s,n=r*e+s;a[n]=i.canvas.pixels[o]}i.canvas.reset(e,t,a),X.clear(),U.playDraw()}flip(e){const{width:t,height:a,pixels:r}=i.canvas,s=[...r];if(e==="horizontal")for(let o=0;o<a;o++){const n=r.slice(o*t,(o+1)*t);n.reverse();for(let c=0;c<t;c++)s[o*t+c]=n[c]}else for(let o=0;o<a;o++)for(let n=0;n<t;n++){const c=o*t+n,v=(a-1-o)*t+n;s[v]=r[c]}i.canvas.pixels=s,X.clear(),U.playDraw()}rotate(){const{width:e,height:t,pixels:a}=i.canvas;if(e!==t)return;const r=Array(e*t).fill("#eee8d5");for(let s=0;s<t;s++)for(let o=0;o<e;o++){const n=s*e+o,c=o*e+(t-1-s);r[c]=a[n]}i.canvas.pixels=r,X.clear(),U.playDraw()}clearAll(){confirm("Are you sure you want to clear the entire canvas?")&&(i.canvas.clear(),X.clear(),U.playErase())}bleach(){const{x:e,y:t}=i.cursor.pos,a=i.canvas.getColor(e,t),r=i.activeColor;if(a===r)return;const{pixels:s}=i.canvas,o=[],n=i.selection.isActive,c=i.selection.indices;s.forEach((v,f)=>{const x=v===a,g=!n||c.includes(f);x&&g&&(o.push({index:f,oldColor:a,newColor:r}),i.canvas.pixels[f]=r)}),o.length>0&&(X.beginBatch(),o.forEach(v=>X.push(v)),X.endBatch(),U.playDraw())}}class es{copy(){const e=i.canvas.width,t=i.selection.getPoints(e),a=i.selection.getEffectiveBounds(e);if(!a||t.length===0)return;const r=new Array(a.width*a.height).fill(null),s=i.canvas.compositePixels;t.forEach(o=>{const n=o.y*e+o.x,c=o.x-a.x1,f=(o.y-a.y1)*a.width+c;r[f]=s[n]}),i.project.clipboard={width:a.width,height:a.height,data:r},U.playDraw()}cut(){this.copy();const e=i.canvas.width,t=i.selection.getPoints(e);t.length!==0&&(X.beginBatch(),t.forEach(a=>{const r=a.y*e+a.x,s=i.canvas.pixels[r];X.push({index:r,oldColor:s,newColor:null}),i.canvas.pixels[r]=null}),X.endBatch(),U.playErase(),i.selection.clear())}paste(){const e=i.project.clipboard;if(!e)return;const{x:t,y:a}=i.cursor.pos,{width:r,height:s}=i.canvas;X.beginBatch();for(let o=0;o<e.height;o++)for(let n=0;n<e.width;n++){const c=t+n,v=a+o;if(c>=0&&c<r&&v>=0&&v<s){const f=o*e.width+n,x=e.data[f];if(x!==null){const g=v*r+c,b=i.canvas.pixels[g];X.push({index:g,oldColor:b,newColor:x}),i.canvas.pixels[g]=x}}}X.endBatch(),U.playDraw()}}class ts{serialize(){return JSON.stringify({version:i.version,metadata:{name:"Untitled Project",lastModified:new Date().toISOString()},palette:i.paletteState.swatches,project:{frames:i.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,layers:e.layers.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,pixels:t.pixels}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,i.project.currentFilePath||void 0);t&&(i.project.setMetadata(t),U.playDraw())}webDownload(e){const t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="rupa-project.rupa",r.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),i.project.setMetadata(e.filePath),U.playDraw())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const a=t.target.files?.[0];if(a){const r=new FileReader;r.onload=s=>this.deserialize(s.target?.result),r.readAsText(a)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),i.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}deserialize(e){try{const t=JSON.parse(e);t.palette&&(i.paletteState.swatches=t.palette);const a=t.project||t.folio;if(a)i.project.frames=a.frames.map(r=>{const s=new ht(r.name,r.width,r.height),o=r.layers||r.veils||[];return s.layers=o.map(n=>{const c=new Je(n.name,r.width,r.height);return c.isVisible=n.isVisible,c.isLocked=n.isLocked,c.pixels=n.pixels||n.stitches||[],c}),s});else if(t.pixelData){const r=new ht("Restored Project",t.dimensions.width,t.dimensions.height);r.layers[0].pixels=t.pixelData,i.project.frames=[r]}i.project.activeFrameIndex=0,X.clear()}catch(t){console.error("Failed to restore project:",t)}}}class as{addFrame(e){const t=i.project,a=t.activeFrameIndex,r=t.addFrame(e),s=t.activeFrameIndex;return X.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(s,1),t.activeFrameIndex=a},redo:()=>{t.frames.splice(s,0,r),t.activeFrameIndex=s}}),U.playDraw(),r}removeFrame(e){const t=i.project;if(t.frames.length<=1)return;const a=t.frames[e],r=t.activeFrameIndex;t.removeFrame(e);const s=t.activeFrameIndex;X.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,a),t.activeFrameIndex=r},redo:()=>{t.removeFrame(e),t.activeFrameIndex=s}}),U.playErase()}duplicateFrame(e){const t=i.project,a=t.frames[e],r=t.activeFrameIndex,s=t.addFrame(`${a.name} (Copy)`),o=t.activeFrameIndex;s.width=a.width,s.height=a.height,s.duration=a.duration,s.layers=a.layers.map(n=>n.clone(a.width,a.height)),X.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(o,1),t.activeFrameIndex=r},redo:()=>{t.frames.splice(o,0,s),t.activeFrameIndex=o}}),U.playDraw()}nextFrame(){const e=i.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,X.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),U.playMove()}prevFrame(){const e=i.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,X.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),U.playMove()}addLayer(e){const t=i.project.activeFrame,a=t.activeLayerIndex,r=t.addLayer(e),s=t.activeLayerIndex;return X.push({isStructural:!0,label:"Add Layer",undo:()=>{t.layers.splice(s,1),t.activeLayerIndex=a},redo:()=>{t.layers.splice(s,0,r),t.activeLayerIndex=s}}),U.playDraw(),r}removeLayer(e){const t=i.project.activeFrame;if(t.layers.length<=1)return;const a=t.layers[e],r=t.activeLayerIndex;t.removeLayer(e);const s=t.activeLayerIndex;X.push({isStructural:!0,label:"Remove Layer",undo:()=>{t.layers.splice(e,0,a),t.activeLayerIndex=r},redo:()=>{t.removeLayer(e),t.activeLayerIndex=s}}),U.playErase()}duplicateLayer(e){const t=i.project.activeFrame,a=t.layers[e],r=t.activeLayerIndex,s=a.clone(t.width,t.height);s.name=`${a.name} (Copy)`;const o=e+1;t.layers.splice(o,0,s),t.activeLayerIndex=o,X.push({isStructural:!0,label:"Duplicate Layer",undo:()=>{t.layers.splice(o,1),t.activeLayerIndex=r},redo:()=>{t.layers.splice(o,0,s),t.activeLayerIndex=o}}),U.playDraw()}nextLayer(){const e=i.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex+1)%e.layers.length,X.push({isStructural:!0,label:"Next Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t+1)%e.layers.length}),U.playMove()}prevLayer(){const e=i.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex-1+e.layers.length)%e.layers.length,X.push({isStructural:!0,label:"Prev Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t-1+e.layers.length)%e.layers.length}),U.playMove()}toggleLock(e){const t=e!==void 0?i.project.activeFrame.layers[e]:i.project.activeFrame.activeLayer;if(t){const a=t.isLocked;t.isLocked=!t.isLocked,X.push({isStructural:!0,label:"Toggle Layer Lock",undo:()=>t.isLocked=a,redo:()=>t.isLocked=!a}),U.playDraw()}}toggleVisibility(e){const t=e!==void 0?i.project.activeFrame.layers[e]:i.project.activeFrame.activeLayer;if(t){const a=t.isVisible;t.isVisible=!t.isVisible,X.push({isStructural:!0,label:"Toggle Layer Visibility",undo:()=>t.isVisible=a,redo:()=>t.isVisible=!a}),U.playDraw()}}reorderLayer(e,t){const a=i.project.activeFrame;if(e===t||t<0||t>=a.layers.length)return;const r=a.activeLayerIndex;((n,c)=>{const[v]=a.layers.splice(n,1);a.layers.splice(c,0,v),a.activeLayerIndex===n?a.activeLayerIndex=c:n<a.activeLayerIndex&&c>=a.activeLayerIndex?a.activeLayerIndex--:n>a.activeLayerIndex&&c<=a.activeLayerIndex&&a.activeLayerIndex++})(e,t);const o=a.activeLayerIndex;X.push({isStructural:!0,label:"Reorder Layer",undo:()=>{const[n]=a.layers.splice(t,1);a.layers.splice(e,0,n),a.activeLayerIndex=r},redo:()=>{const[n]=a.layers.splice(e,1);a.layers.splice(t,0,n),a.activeLayerIndex=o}}),U.playMove()}reorderFrame(e,t){const a=i.project;if(e===t||t<0||t>=a.frames.length)return;const r=a.activeFrameIndex;((n,c)=>{const[v]=a.frames.splice(n,1);a.frames.splice(c,0,v),a.activeFrameIndex===n?a.activeFrameIndex=c:n<a.activeFrameIndex&&c>=a.activeFrameIndex?a.activeFrameIndex--:n>a.activeFrameIndex&&c<=a.activeFrameIndex&&a.activeFrameIndex++})(e,t);const o=a.activeFrameIndex;X.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[n]=a.frames.splice(t,1);a.frames.splice(e,0,n),a.activeFrameIndex=r},redo:()=>{const[n]=a.frames.splice(e,1);a.frames.splice(t,0,n),a.activeFrameIndex=o}}),U.playMove()}moveLayerUp(){const e=i.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,t+1)}moveLayerDown(){const t=i.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,t-1)}mergeLayerDown(){const e=i.project.activeFrame,t=e.activeLayerIndex;if(t<=0)return;const a=t-1,r=e.layers[t],s=e.layers[a],o=[...s.pixels],n=r.pixels,c=[...s.pixels];for(let v=0;v<n.length;v++){const f=n[v];f!==null&&(c[v]=f)}s.pixels=c,e.layers.splice(t,1),e.activeLayerIndex=a,X.push({isStructural:!0,label:"Merge Layer",undo:()=>{s.pixels=o,e.layers.splice(t,0,r),e.activeLayerIndex=t},redo:()=>{s.pixels=c,e.layers.splice(t,1),e.activeLayerIndex=a}}),U.playDraw()}}class rs{begin(e,t){i.selection.begin(e,t)}update(e,t){i.selection.isActive&&i.selection.update(e,t)}clear(){i.selection.clear()}commit(){const e=i.selection.getPoints(i.canvas.width);if(e.length===0)return;const t=i.paletteState.activeColor,a=i.canvas.width;X.beginBatch();let r=!1;e.forEach(s=>{const o=s.y*a+s.x,n=i.canvas.pixels[o];n!==t&&(X.push({index:o,oldColor:n,newColor:t}),i.canvas.pixels[o]=t,r=!0)}),X.endBatch(),r&&U.playDraw()}spiritPick(){const{x:e,y:t}=i.cursor.pos,a=i.canvas.getColor(e,t),r=i.canvas.width,s=i.canvas.height,o=[[e,t]],n=new Set;for(i.selection.clear();o.length>0;){const[c,v]=o.shift(),f=v*r+c,x=`${c},${v}`;if(!n.has(x)&&(n.add(x),i.canvas.getColor(c,v)===a)){i.selection.indices.push(f);const g=[[c+1,v],[c-1,v],[c,v+1],[c,v-1]];for(const[b,_]of g)b>=0&&b<r&&_>=0&&_<s&&o.push([b,_])}}i.selection.indices.length>0&&U.playScale(4)}addVertex(e,t){i.selection.vertices.push({x:e,y:t}),U.playDraw()}sealBinding(){const e=i.selection.vertices;if(e.length<3)return;const t=i.canvas.width,a=i.canvas.height,r=[];for(let s=0;s<a;s++)for(let o=0;o<t;o++)this.isPointInPoly(o,s,e)&&r.push(s*t+o);r.length>0&&(i.selection.indices=r,i.selection.vertices=[],U.playScale(6))}isPointInPoly(e,t,a){let r=!1;for(let s=0,o=a.length-1;s<a.length;o=s++){const n=a[s].x,c=a[s].y,v=a[o].x,f=a[o].y;c>t!=f>t&&e<(v-n)*(t-c)/(f-c)+n&&(r=!r)}return r}}class ft{static toHex(e){const{h:t,s:a,l:r,a:s}=e,o=t/360,n=a/100,c=r/100;let v,f,x;if(n===0)v=f=x=c;else{const k=c<.5?c*(1+n):c+n-c*n,m=2*c-k,A=L=>(L<0&&(L+=1),L>1&&(L-=1),L<1/6?m+(k-m)*6*L:L<1/2?k:L<2/3?m+(k-m)*(2/3-L)*6:m);v=A(o+1/3),f=A(o),x=A(o-1/3)}const g=k=>Math.round(k*255).toString(16).padStart(2,"0"),b=Math.round(s*255).toString(16).padStart(2,"0"),_=`#${g(v)}${g(f)}${g(x)}`;return b==="ff"?_:_+b}static toHSLA(e){let t=0,a=0,r=0,s=1;const o=e.replace("#","");o.length===3||o.length===4?(t=parseInt(o[0]+o[0],16),a=parseInt(o[1]+o[1],16),r=parseInt(o[2]+o[2],16),o.length===4&&(s=parseInt(o[3]+o[3],16)/255)):(o.length===6||o.length===8)&&(t=parseInt(o.substring(0,2),16),a=parseInt(o.substring(2,4),16),r=parseInt(o.substring(4,6),16),o.length===8&&(s=parseInt(o.substring(6,8),16)/255)),t/=255,a/=255,r/=255;const n=Math.max(t,a,r),c=Math.min(t,a,r);let v=0,f=0,x=(n+c)/2;if(n!==c){const g=n-c;switch(f=x>.5?g/(2-n-c):g/(n+c),n){case t:v=(a-r)/g+(a<r?6:0);break;case a:v=(r-t)/g+2;break;case r:v=(t-a)/g+4;break}v/=6}return{h:Math.round(v*360),s:Math.round(f*100),l:Math.round(x*100),a:parseFloat(s.toFixed(2))}}static adjustBrightness(e,t){const a=this.toHSLA(e);return a.l=Math.max(0,Math.min(100,a.l+t*100)),this.toHex(a)}static adjustSaturation(e,t){const a=this.toHSLA(e);return a.s=Math.max(0,Math.min(100,a.s+t*100)),this.toHex(a)}static adjustOpacity(e,t){const a=this.toHSLA(e);return a.a=Math.max(0,Math.min(1,t)),this.toHex(a)}static mix(e,t,a=.5){const r=this.hexToRgb(e),s=this.hexToRgb(t),o={r:Math.round(r.r*(1-a)+s.r*a),g:Math.round(r.g*(1-a)+s.g*a),b:Math.round(r.b*(1-a)+s.b*a),a:r.a*(1-a)+s.a*a};return this.rgbToHex(o.r,o.g,o.b,o.a)}static hexToRgb(e){const t=e.replace("#","");let a=0,r=0,s=0,o=1;return(t.length===6||t.length===8)&&(a=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),s=parseInt(t.substring(4,6),16),t.length===8&&(o=parseInt(t.substring(6,8),16)/255)),{r:a,g:r,b:s,a:o}}static rgbToHex(e,t,a,r){const s=c=>Math.round(c).toString(16).padStart(2,"0"),o=Math.round(r*255).toString(16).padStart(2,"0"),n=`#${s(e)}${s(t)}${s(a)}`;return o==="ff"?n:n+o}}class ss{select(e){i.paletteState.select(e),U.playScale(e)}setColor(e){i.paletteState.setColor(e),U.playDraw()}pickFromCanvas(){const{x:e,y:t}=i.cursor.pos,a=i.canvas.getColor(e,t);a!==null&&(this.setColor(a),i.studio.isPicking=!0,setTimeout(()=>{i.studio.isPicking=!1},1500))}weatherPalette(e){i.paletteState.swatches=i.paletteState.swatches.map(t=>ft.adjustBrightness(t,e)),U.playDraw()}mixActiveColor(e,t=.5){const a=ft.mix(i.activeColor,e,t);this.setColor(a)}floodFill(){const{x:e,y:t}=i.cursor.pos,a=i.canvas.getColor(e,t),r=i.activeColor;if(a===r)return;const s=i.canvas.width,o=i.canvas.height,n=[[e,t]],c=new Set,v=[],f=i.selection.isActive,x=i.selection.indices;for(;n.length>0;){const[g,b]=n.shift(),_=b*s+g,k=`${g},${b}`;if(c.has(k))continue;c.add(k);const m=i.canvas.getColor(g,b)===a,A=!f||x.includes(_);if(m&&A){v.push({index:_,oldColor:a,newColor:r}),i.canvas.pixels[_]=r;const L=[[g+1,b],[g-1,b],[g,b+1],[g,b-1]];for(const[$,R]of L)$>=0&&$<s&&R>=0&&R<o&&n.push([$,R])}}v.length>0&&(X.beginBatch(),v.forEach(g=>X.push(g)),X.endBatch(),U.playDraw())}}class is{movement=new Wr;draw=new Zr;manipulation=new Jr;clipboard=new es;persistence=new ts;project=new as;selection=new rs;color=new ss;moveCursor(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}jumpHome(){this.movement.jumpHome()}paint(){this.draw.draw()}erase(){this.draw.erase()}pickColor(){this.color.pickFromCanvas()}startSelection(){this.selection.begin(i.cursor.pos.x,i.cursor.pos.y)}updateSelection(){this.selection.update(i.cursor.pos.x,i.cursor.pos.y)}commitSelection(){this.selection.commit()}clearCanvas(){this.manipulation.clearAll()}resizeCanvas(e,t){this.manipulation.resize(e,t)}flipCanvas(e){this.manipulation.flip(e)}rotateCanvas(){this.manipulation.rotate()}mergeLayerDown(){this.project.mergeLayerDown()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),i.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async createArtifact(e,t=10,a="transparent"){const{ExportEngine:r}=await ga(async()=>{const{ExportEngine:x}=await import("./Cl6mNt4y.js");return{ExportEngine:x}},__vite__mapDeps([0,1,2,3]),import.meta.url),{width:s,height:o,compositePixels:n}=i.canvas,c=i.studio.includePixelBorders,v=["webm","gif","mp4"].includes(e),f=i.project.frames.length<=1&&v?"png":e;if(f==="svg")if(i.project.frames.length>1){const x=i.project.frames.map(k=>k.compositePixels),g=i.project.frames.map(k=>k.duration),b=r.toAnimatedSVG(s,o,x,g,a,c),_=new Blob([b],{type:"image/svg+xml"});this.download(URL.createObjectURL(_),"rupa-image.svg")}else{const x=r.toSVG(s,o,n,a,c),g=new Blob([x],{type:"image/svg+xml"});this.download(URL.createObjectURL(g),"rupa-image.svg")}else if(f==="webm"||f==="mp4"){const x=i.project.frames.map(k=>k.compositePixels),g=i.project.frames.map(k=>k.duration),b=await r.toVideo(s,o,x,g,t,f,a,c),_=b.type.includes("mp4")?"mp4":"webm";this.download(URL.createObjectURL(b),`rupa-video.${_}`)}else if(f==="gif"){const x=i.project.frames.map(_=>_.compositePixels),g=i.project.frames.map(_=>_.duration),b=await r.toGIF(s,o,x,g,t,a,c);this.download(URL.createObjectURL(b),"rupa-animation.gif")}else{const x=await r.toRaster(s,o,n,t,f,a,c);this.download(x,`rupa-image.${f}`)}i.studio.showExportMenu=!1}download(e,t){const a=document.createElement("a");a.href=e,a.download=t.toLowerCase().replace(/\s+/g,"-"),a.click()}}const B=new is;class os{version="0.7.0";project=new Nr;canvas=new Rr(this.project);cursor=new Br;paletteState=new Dr;studio=new Gr;selection=new Ur;get pixels(){return this.canvas.pixels}set pixels(e){this.canvas.pixels=e}get canvasWidth(){return this.canvas.width}set canvasWidth(e){this.canvas.width=e}get canvasHeight(){return this.canvas.height}set canvasHeight(e){this.canvas.height=e}get activeColor(){return this.paletteState.activeColor}set activeColor(e){this.paletteState.activeColor=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get usageMinutes(){return this.studio.usageMinutes}get backgroundColor(){return this.studio.backgroundColor}set backgroundColor(e){this.studio.backgroundColor=e}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isCursorVisible(){return this.cursor.isVisible}set isCursorVisible(e){this.cursor.isVisible=e}get showColorPicker(){return this.studio.showColorPicker}set showColorPicker(e){this.studio.showColorPicker=e}get showAudioSettings(){return this.studio.showAudioSettings}set showAudioSettings(e){this.studio.showAudioSettings=e}get showCommandPalette(){return this.studio.showCommandPalette}set showCommandPalette(e){this.studio.showCommandPalette=e}get showGuideBook(){return this.studio.showGuideBook}set showGuideBook(e){this.studio.showGuideBook=e}get showGuideMenu(){return this.studio.showGuideMenu}set showGuideMenu(e){this.studio.showGuideMenu=e}get showExportMenu(){return this.studio.showExportMenu}set showExportMenu(e){this.studio.showExportMenu=e}get showCanvasSettings(){return this.studio.showCanvasSettings}set showCanvasSettings(e){this.studio.showCanvasSettings=e}get showPersistenceMenu(){return this.studio.showPersistenceMenu}set showPersistenceMenu(e){this.studio.showPersistenceMenu=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get showGhostLayers(){return this.studio.showGhostLayers}set showGhostLayers(e){this.studio.showGhostLayers=e}#e=q(()=>{const e=(t,a)=>{const r=Math.floor(a/2);return a%2===0?t<r?t-r:t-r+1:t-r};return{x:e(this.cursor.pos.x,this.canvas.width),y:-e(this.cursor.pos.y,this.canvas.height)}});get displayCoords(){return l(this.#e)}set displayCoords(e){y(this.#e,e)}#t=q(()=>{const e=this.studio.zoomLevel;if(this.studio.zoomLevel<=1)return`translate(-50%, -50%) scale(${e})`;const t=(this.cursor.pos.x+.5)/this.canvas.width*100,a=(this.cursor.pos.y+.5)/this.canvas.height*100;return`translate(-${t}%, -${a}%) scale(${e})`});get cameraTransform(){return l(this.#t)}set cameraTransform(e){y(this.#t,e)}#a=q(()=>{const e=new Set;return this.canvas.compositePixels.forEach(t=>{t!==null&&e.add(t)}),Array.from(e)});get usedColors(){return l(this.#a)}set usedColors(e){y(this.#a,e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}toggleMute(){this.studio.toggleMute()}handleEscape(){return this.studio.handleEscape()}undo(){const e=X.undo();if(e)if("isStructural"in e)e.undo(),U.playErase();else if(Array.isArray(e)){for(let t=e.length-1;t>=0;t--){const a=e[t];this.canvas.pixels[a.index]=a.oldColor}U.playErase()}else this.canvas.pixels[e.index]=e.oldColor,U.playErase();this.cursor.resetInactivityTimer()}redo(){const e=X.redo();if(e)if("isStructural"in e)e.redo(),U.playDraw();else if(Array.isArray(e)){for(const t of e)this.canvas.pixels[t.index]=t.newColor;U.playDraw()}else this.canvas.pixels[e.index]=e.newColor,U.playDraw();this.cursor.resetInactivityTimer()}clearCanvas(){B.clearCanvas()}pickColor(){B.pickColor()}loadProject(){B.load()}copySelection(){B.copy()}cutSelection(){B.cut()}pasteSelection(){B.paste()}flipCanvas(e){B.flipCanvas(e)}rotateCanvas(){B.rotateCanvas()}}const i=new os,ns={MOVE_UP:{label:"Move Up",keys:["ArrowUp"],group:"Navigation"},MOVE_DOWN:{label:"Move Down",keys:["ArrowDown"],group:"Navigation"},MOVE_LEFT:{label:"Move Left",keys:["ArrowLeft"],group:"Navigation"},MOVE_RIGHT:{label:"Move Right",keys:["ArrowRight"],group:"Navigation"},GOTO:{label:"Jump to Coordinate",keys:["g"],group:"Navigation"},JUMP_HOME:{label:"Return to Center",keys:["Ctrl+h"],group:"Navigation"}},ls={PAINT:{label:"Paint (Apply Color)",keys:["Space","Enter"],group:"Tools"},ERASE:{label:"Erase Pixel",keys:["Backspace","Delete"],group:"Tools"},PICK_COLOR:{label:"Sample Color",keys:["i","Alt+Space"],group:"Tools"},FLOOD_FILL:{label:"Color Fill",keys:["f"],group:"Magic"},RECOLOR:{label:"Recolor All",keys:["Alt+r"],group:"Magic"},SELECT_SAME:{label:"Magic Wand",keys:["w"],group:"Magic"}},cs={FLOW_PAINT:{label:"Continuous Painting",keys:["Ctrl"],group:"Flow"},FLOW_ERASE:{label:"Continuous Erasing",keys:["Ctrl+Shift"],group:"Flow"},FLOW_SELECT:{label:"Define Selection",keys:["Shift"],group:"Flow"}},ds={COPY:{label:"Copy",keys:["Ctrl+c"],group:"Edit"},CUT:{label:"Cut",keys:["Ctrl+x"],group:"Edit"},PASTE:{label:"Paste",keys:["Ctrl+v"],group:"Edit"},CLEAR_CANVAS:{label:"Clear All",keys:["Ctrl+l"],group:"Edit"}},us={FLIP_H:{label:"Flip Horizontally",keys:["h"],group:"Transform"},FLIP_V:{label:"Flip Vertically",keys:["v"],group:"Transform"},ROTATE:{label:"Rotate 90Â° Clockwise",keys:["r"],group:"Transform"},ZOOM_IN:{label:"Zoom In",keys:["+","="],group:"View"},ZOOM_OUT:{label:"Zoom Out",keys:["-"],group:"View"},RESET_ZOOM:{label:"Reset Zoom",keys:["Ctrl+0"],group:"View"}},vs={NEW_FRAME:{label:"New Frame",keys:["Alt+n"],group:"Timeline"},DUPLICATE_FRAME:{label:"Duplicate Frame",keys:["Ctrl+d"],group:"Timeline"},DELETE_FRAME:{label:"Remove Frame",keys:["Alt+d"],group:"Timeline"},NEXT_FRAME:{label:"Next Frame",keys:["Alt+PageDown","Tab"],group:"Timeline"},PREV_FRAME:{label:"Previous Frame",keys:["Alt+PageUp","Shift+Tab"],group:"Timeline"},PLAY_PAUSE:{label:"Play/Pause",keys:["p"],group:"Timeline"},TOGGLE_GHOST_LAYERS:{label:"Onion Skinning",keys:["Alt+g"],group:"Timeline"}},ps={NEW_LAYER:{label:"Add New Layer",keys:["Alt+Shift+n"],group:"Layers"},DUPLICATE_LAYER:{label:"Duplicate Layer",keys:["Ctrl+d"],group:"Layers"},DELETE_LAYER:{label:"Remove Layer",keys:["Alt+d"],group:"Layers"},MOVE_LAYER_UP:{label:"Move Layer Up",keys:["["],group:"Layers"},MOVE_LAYER_DOWN:{label:"Move Layer Down",keys:["]"],group:"Layers"},MERGE_LAYERS:{label:"Merge Layer Down",keys:["Ctrl+Alt+m"],group:"Layers"},TOGGLE_LAYER_VISIBILITY:{label:"Show/Hide Layer",keys:["Alt+h"],group:"Layers"},TOGGLE_LAYER_LOCK:{label:"Lock/Unlock Layer",keys:["Alt+l"],group:"Layers"}},hs={OPEN_MENU:{label:"Command Palette",keys:["Ctrl+k"],group:"System"},OPEN_EXPORT:{label:"Export",keys:["Ctrl+e"],group:"System"},SAVE:{label:"Save",keys:["Ctrl+s"],group:"System"},OPEN_SETTINGS:{label:"Settings",keys:["Ctrl+,"],group:"System"},OPEN_MANUAL:{label:"Barista Manual",keys:["F1"],group:"System"},OPEN_PALETTE:{label:"Color Picker",keys:["b"],group:"System"},OPEN_HELP:{label:"Quick Guide",keys:["F2"],group:"System"},OPEN_AUDIO:{label:"Audio Settings",keys:["Ctrl+Shift+a"],group:"System"},TOGGLE_MUTE:{label:"Mute Audio",keys:["Ctrl+m"],group:"System"},UNDO:{label:"Undo",keys:["Ctrl+z"],group:"System"},REDO:{label:"Redo",keys:["Ctrl+Shift+z","Ctrl+y"],group:"System"},ESCAPE:{label:"Close/Cancel",keys:["Escape"],group:"System"}},fs={SELECT_COLOR_1:{label:"Select Color 1",keys:["1"],group:"Colors"},SELECT_COLOR_2:{label:"Select Color 2",keys:["2"],group:"Colors"},SELECT_COLOR_3:{label:"Select Color 3",keys:["3"],group:"Colors"},SELECT_COLOR_4:{label:"Select Color 4",keys:["4"],group:"Colors"},SELECT_COLOR_5:{label:"Select Color 5",keys:["5"],group:"Colors"},SELECT_COLOR_6:{label:"Select Color 6",keys:["6"],group:"Colors"},SELECT_COLOR_7:{label:"Select Color 7",keys:["7"],group:"Colors"},SELECT_COLOR_8:{label:"Select Color 8",keys:["8"],group:"Colors"},SELECT_COLOR_9:{label:"Select Color 9",keys:["9"],group:"Colors"},SELECT_COLOR_0:{label:"Select Color 0",keys:["0"],group:"Colors"}},xs={TAB_TIMELINE:{label:"Focus Timeline",keys:["Alt+1"],group:"System"},TAB_LAYERS:{label:"Focus Layers",keys:["Alt+2"],group:"System"}},gs={navigation:ns,painting:ls,flows:cs,manipulation:ds,transform:us,animation:vs,layering:ps,system:hs,colors:fs,tabs:xs};class bs{buffer=[];timeout=null;#e=I(ue([]));get currentSequence(){return l(this.#e)}set currentSequence(e){y(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const a=this.buffer.join(","),r={"g,c":"GOTO","f,n":"NEW_FRAME","l,n":"NEW_LAYER","l,l":"TOGGLE_LAYER_LOCK","l,h":"TOGGLE_LAYER_VISIBILITY","l,m":"MERGE_LAYERS"};if(r[a]){const s=r[a];return this.reset(),s}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const $t=new bs;class ms{patterns=[];#e=I(ue([]));get activeKeys(){return l(this.#e)}set activeKeys(e){y(this.#e,e,!0)}#t=I(!1);get isCtrlActive(){return l(this.#t)}set isCtrlActive(e){y(this.#t,e,!0)}#a=I(!1);get isShiftActive(){return l(this.#a)}set isShiftActive(e){y(this.#a,e,!0)}#r=I(!1);get isAltActive(){return l(this.#r)}set isAltActive(e){y(this.#r,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){this.patterns=[],Object.values(gs).forEach(e=>{Object.entries(e).forEach(([t,a])=>{const{keys:r,group:s}=a,o=__({key:`shortcut_labels.${t}`}),n=s.toLowerCase().replace(/ & /g,"_").replace(/ /g,"_"),c=__({key:`shortcut_groups.${n}`});r.forEach(v=>{const f=v.toLowerCase().split("+");let x=f[f.length-1].trim();x==="space"&&(x=" "),(x==="ctrl"||x==="control")&&(x="control"),this.patterns.push({intent:t,key:x,ctrl:f.includes("ctrl")||f.includes("control"),shift:f.includes("shift"),alt:f.includes("alt"),label:o,group:c})})})}),this.patterns.sort((e,t)=>{const a=r=>(r.ctrl?1:0)+(r.shift?1:0)+(r.alt?1:0);return a(t)-a(e)})}getActions(){const e=new Set,t=[];return this.patterns.forEach(a=>{e.has(a.intent)||(e.add(a.intent),t.push({intent:a.intent,label:a.label,group:a.group,shortcut:this.getLabel(a.intent)}))}),t}getGroupedActions(){const e=this.getActions(),t={},a={MOVE_UP:"navigation",MOVE_DOWN:"navigation",MOVE_LEFT:"navigation",MOVE_RIGHT:"navigation",SELECT_COLOR_1:"colors",SELECT_COLOR_2:"colors",SELECT_COLOR_3:"colors",SELECT_COLOR_4:"colors",SELECT_COLOR_5:"colors",SELECT_COLOR_6:"colors",SELECT_COLOR_7:"colors",SELECT_COLOR_8:"colors",SELECT_COLOR_9:"colors",SELECT_COLOR_0:"colors"},r=[],s=new Set;return e.forEach(n=>{const c=a[n.intent];if(c){if(!s.has(c)){s.add(c);const v=__({key:`shortcut_groups.${c}`});r.push({...n,label:v,customKey:c.toUpperCase()})}}else r.push(n)}),r.forEach(n=>{t[n.group]||(t[n.group]=[]),t[n.group].push(n)}),[__({key:"shortcut_groups.rhythms"}),__({key:"shortcut_groups.navigation"}),__({key:"shortcut_groups.cursor"}),__({key:"shortcut_groups.barista"}),__({key:"shortcut_groups.flow"}),__({key:"shortcut_groups.magic"}),__({key:"shortcut_groups.selection"}),__({key:"shortcut_groups.geometry"}),__({key:"shortcut_groups.timeline"}),__({key:"shortcut_groups.layers"}),__({key:"shortcut_groups.menu"}),__({key:"shortcut_groups.vibes"}),__({key:"shortcut_groups.colors"})].filter(n=>t[n]).map(n=>({group:n,items:t[n]}))}updatePhysicalState(e,t){const a=e.key.toLowerCase();t==="down"?this.activeKeys.includes(a)||this.activeKeys.push(a):(this.activeKeys=this.activeKeys.filter(r=>r!==a),a==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(r=>r!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(r=>r!=="control"&&r!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(r=>r!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(r=>r!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const a=$t.process(t);if(a)return a}else $t.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const a of this.patterns)if(t===a.key&&this.isCtrlActive===a.ctrl&&this.isShiftActive===a.shift&&this.isAltActive===a.alt)return a.intent;return null}getLabel(e){const t=this.patterns.find(c=>c.intent===e);if(!t)return"Unassigned";const a=[];t.ctrl&&a.push("Ctrl"),t.shift&&a.push("Shift"),t.alt&&a.push("Alt");let r=t.key;const s={" ":"Space",control:"Ctrl",meta:"Cmd",alt:"Alt",shift:"Shift",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right",backspace:"Backspace",delete:"Delete",enter:"Enter",escape:"Esc",tab:"Tab"},o=r.toLowerCase();s[o]?r=s[o]:r=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase();const n=a.filter(c=>c.toLowerCase()!==r.toLowerCase());return n.length===0?r:n.join("+")+"+"+r}}const Ce=new ms;class ys{#e=q(()=>$t.isActive?{type:"FLOW",label:__({key:"timeline.mode_labels.brewing"}),icon:"ð",color:"var(--color-brand)",isPulse:!0}:i.isPicking?{type:"PICK",label:__({key:"timeline.mode_labels.tasting"}),icon:"ð",color:"var(--color-brand)",isPulse:!0}:Ce.isCtrlActive&&Ce.isShiftActive?{type:"ERASE",label:__({key:"timeline.mode_labels.clearing"}),icon:"ð§¹",color:"var(--color-brand)",isPulse:!0}:Ce.isShiftActive?{type:"SELECT",label:__({key:"timeline.mode_labels.selecting"}),icon:"â¨",color:"var(--color-brand)",isPulse:!0}:Ce.isCtrlActive?{type:"PAINT",label:__({key:"timeline.mode_labels.pouring"}),icon:"â",color:"var(--color-green-leaves)",isPulse:!0}:{type:"READY",label:__({key:"timeline.mode_labels.ready"}),icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return l(this.#e)}set current(e){y(this.#e,e)}}const fe=new ys;class _s{isPointerDown=!1;lastPosition={x:-1,y:-1};buttonType=null;holdTimer=null;isSnapped=!1;rafId=null;#e=I(!1);get isSnappedState(){return l(this.#e)}set isSnappedState(e){y(this.#e,e,!0)}mapToGrid(e,t,a){const r=a.getBoundingClientRect(),{width:s,height:o}=i.canvas,n=(e-r.left)/r.width,c=(t-r.top)/r.height;return{x:n*s,y:c*o}}handleStart(e,t){this.isPointerDown=!0,this.isSnapped=!1,this.buttonType=e.button===2?"secondary":"primary";const a=this.mapToGrid(e.clientX,e.clientY,t);this.lastPosition={x:a.x,y:a.y},i.cursor.pos={x:Math.floor(a.x),y:Math.floor(a.y)};const r=fe.current.type;this.buttonType==="primary"&&r!=="SELECT"&&r!=="ERASE"&&(B.draw.beginStroke(a.x,a.y),this.startHoldTimer())}handleMove(e,t){this.isPointerDown&&(this.rafId||(this.rafId=requestAnimationFrame(()=>{const a=this.mapToGrid(e.clientX,e.clientY,t),r=fe.current.type;this.buttonType==="primary"&&r!=="SELECT"&&r!=="ERASE"&&(this.isSnapped||(B.draw.continueStroke(a.x,a.y,this.lastPosition.x,this.lastPosition.y),this.resetHoldTimer())),this.lastPosition={x:a.x,y:a.y},this.rafId=null})))}handleEnd(){if(!this.isPointerDown)return;this.isPointerDown=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);const e=fe.current.type;this.buttonType==="primary"&&e!=="SELECT"&&e!=="ERASE"?B.draw.endStroke():i.canvas.clearBuffer(),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1}cancel(){this.isPointerDown=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1,B.draw.cancelStroke()}startHoldTimer(){this.clearHoldTimer(),this.holdTimer=setTimeout(()=>{this.isPointerDown&&this.triggerSnap()},600)}resetHoldTimer(){this.isSnapped||this.startHoldTimer()}clearHoldTimer(){this.holdTimer&&clearTimeout(this.holdTimer),this.holdTimer=null}triggerSnap(){this.isSnapped=!0,this.isSnappedState=!0,B.draw.snapCurrentStroke()}}const je=new _s;class As{#e=I("KEYBOARD");get activeSource(){return l(this.#e)}set activeSource(e){y(this.#e,e,!0)}listeners=[];constructor(){}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}emit(e,t,a){this.activeSource=t;const r={intent:e,source:t,meta:a};this.listeners.forEach(s=>s(r))}mount(e,t){const a=s=>{if(!i.isAppReady)return;const o=s.target;if(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o.isContentEditable)return;Ce.updatePhysicalState(s,"down");const n=Ce.getIntent(s);n&&(s.preventDefault(),this.emit(n,"KEYBOARD"))},r=s=>{Ce.updatePhysicalState(s,"up")};if(t){const s=c=>{const v=c.pointerType==="pen"?"PEN":c.pointerType==="touch"?"TOUCH":"MOUSE";je.handleStart(c,t),this.activeSource=v},o=c=>{je.handleMove(c,t)},n=c=>{je.handleEnd()};t.addEventListener("pointerdown",s),e.addEventListener("pointermove",o),e.addEventListener("pointerup",n)}return e.addEventListener("keydown",a),e.addEventListener("keyup",r),()=>{e.removeEventListener("keydown",a),e.removeEventListener("keyup",r)}}}const na=new As;class ws{isPlaying=!1;nextNoteTime=0;timer=null;get ctx(){return zt.ctx}scale=$e.ambient.scale;chords=$e.ambient.chords;currentChordIndex=0;toggle(){this.isPlaying?this.stop():this.start()}start(){this.isPlaying||(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||i.studio.isMuted||!i.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){const t=this.chords[this.currentChordIndex],r=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(r,e),this.pianoPluck(r*2,e,.02),Math.random()>.7&&this.pianoPluck(r*.5,e+.05,.03)}pianoPluck(e,t,a=.06){const{startMins:r,fullMins:s}=$e.ambient.fade,o=i.usageMinutes;let n=0;o>=r&&o<s?n=(o-r)/(s-r):o>=s&&(n=1);const c=a*n*i.bgmVolume;if(c<.001)return;const v=this.ctx.createOscillator(),f=this.ctx.createGain(),x=this.ctx.createBiquadFilter();v.type=Math.random()>.5?"sine":"triangle",v.frequency.setValueAtTime(e,t),x.type="lowpass",x.frequency.setValueAtTime(1200,t),x.frequency.exponentialRampToValueAtTime(400,t+1.5),f.gain.setValueAtTime(0,t),f.gain.linearRampToValueAtTime(c,t+.02),f.gain.exponentialRampToValueAtTime(1e-4,t+2.5),v.connect(x),x.connect(f),f.connect(this.ctx.destination),v.start(t),v.stop(t+2.6)}}const ks=new ws;class Cs{interval=null;#e=I(0);get elapsedTime(){return l(this.#e)}set elapsedTime(e){y(this.#e,e,!0)}#t=q(()=>i.project.frames.reduce((e,t)=>e+t.duration,0));get totalDuration(){return l(this.#t)}set totalDuration(e){y(this.#t,e)}startPlayback(){if(!i.project.isPlaying){if(i.project.frames.length<=1){U.playErase();return}i.project.isPlaying=!0,this.elapsedTime=0;for(let e=0;e<i.project.activeFrameIndex;e++)this.elapsedTime+=i.project.frames[e].duration;U.playDraw(),this.tick()}}stopPlayback(){i.project.isPlaying=!1,this.interval&&(clearTimeout(this.interval),this.interval=null)}togglePlayback(){i.project.isPlaying?this.stopPlayback():this.startPlayback()}tick(){if(!i.project.isPlaying)return;const e=i.project.activeFrame,t=(i.project.activeFrameIndex+1)%i.project.frames.length;this.interval=setTimeout(()=>{i.project.activeFrameIndex=t,t===0?this.elapsedTime=0:this.elapsedTime+=e.duration,this.tick()},e.duration)}}const ya=new Cs;class _a{backupInterval=null;unsubscribeInput=null;mount(e=null){this.backupInterval=setInterval(()=>B.persistence.backup(),600*1e3),i.studio.mount(),ks.start(),this.unsubscribeInput=na.subscribe(a=>{this.handleIntent(a.intent)});const t=na.mount(window,e);return()=>{this.unsubscribeInput&&this.unsubscribeInput(),t(),clearInterval(this.backupInterval)}}handleIntent(e){switch(zt.resume(),i.cursor.resetInactivityTimer(),e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"JUMP_HOME":return B.jumpHome();case"GOTO":return i.showGoTo=!0;case"PAINT":return i.selection.isActive?B.commitSelection():B.draw.draw();case"ERASE":return B.draw.erase();case"FLOOD_FILL":return B.color.floodFill();case"BIND_VERTEX":return B.selection.addVertex(i.cursor.pos.x,i.cursor.pos.y);case"SEAL_BINDING":return i.selection.vertices.length>=3?B.selection.sealBinding():i.selection.isActive?B.commitSelection():B.draw.draw();case"PICK_COLOR":return B.color.pickFromCanvas();case"COPY":return B.clipboard.copy();case"CUT":return B.clipboard.cut();case"PASTE":return B.clipboard.paste();case"RECOLOR":return B.manipulation.bleach();case"UNDO":return i.undo();case"REDO":return i.redo();case"SAVE":return i.showPersistenceMenu=!0;case"OPEN":return B.persistence.load();case"OPEN_MENU":return i.showCommandPalette=!i.showCommandPalette;case"OPEN_SETTINGS":return i.showCanvasSettings=!i.showCanvasSettings;case"ESCAPE":if(je.isPointerDown){je.cancel();return}if(i.selection.isActive){i.selection.clear();return}return i.handleEscape();case"OPEN_PALETTE":return i.showColorPicker=!i.showColorPicker;case"OPEN_AUDIO":return i.showAudioSettings=!i.showAudioSettings;case"OPEN_EXPORT":return i.showExportMenu=!0;case"OPEN_HELP":return i.showGuideMenu=!0;case"OPEN_MANUAL":return i.showGuideBook=!0;case"PLAY_PAUSE":return ya.togglePlayback();case"TOGGLE_GHOST_LAYERS":return i.showGhostLayers=!i.showGhostLayers;case"ZOOM_IN":return i.studio.setZoom(.1);case"ZOOM_OUT":return i.studio.setZoom(-.1);case"RESET_ZOOM":return i.studio.resetZoom();case"CLEAR_CANVAS":return B.manipulation.clearAll();case"TOGGLE_MUTE":return i.studio.toggleMute();case"SELECT_SAME":return B.selection.spiritPick();case"FLIP_H":return B.manipulation.flip("horizontal");case"FLIP_V":return B.manipulation.flip("vertical");case"ROTATE":return B.manipulation.rotate();case"NEW_FRAME":return B.project.addFrame();case"DUPLICATE_FRAME":return B.project.duplicateFrame(i.project.activeFrameIndex);case"NEXT_FRAME":return B.project.nextFrame();case"PREV_FRAME":return B.project.prevFrame();case"DELETE_FRAME":return B.project.removeFrame(i.project.activeFrameIndex);case"TAB_TIMELINE":return i.studio.projectActiveTab="frames";case"TAB_LAYERS":return i.studio.projectActiveTab="layers";case"NEW_LAYER":return B.project.addLayer();case"DUPLICATE_LAYER":return B.project.duplicateLayer(i.project.activeFrame.activeLayerIndex);case"NEXT_LAYER":return B.project.nextLayer();case"PREV_LAYER":return B.project.prevLayer();case"DELETE_LAYER":return B.project.removeLayer(i.project.activeFrame.activeLayerIndex);case"TOGGLE_LAYER_LOCK":return B.project.toggleLock();case"TOGGLE_LAYER_VISIBILITY":return B.project.toggleVisibility();case"MOVE_LAYER_UP":return B.project.moveLayerUp();case"MOVE_LAYER_DOWN":return B.project.moveLayerDown();case"MERGE_LAYERS":return B.project.mergeLayerDown();default:if(e.startsWith("SELECT_COLOR_")){const t=parseInt(e.split("_")[2]);return B.color.select(t===0?9:t-1)}}}executeMove(e,t){if(B.movement.move(e,t)){const a=fe.current.type;a==="SELECT"&&(i.selection.isActive||B.startSelection(),B.updateSelection()),a==="PAINT"&&B.draw.draw(),a==="ERASE"&&B.draw.erase()}}}const Aa=new _a,Ss=Object.freeze(Object.defineProperty({__proto__:null,EditorEngine:_a,editor:Aa},Symbol.toStringTag,{value:"Module"}));var Es=j('<div class="h-3 w-px bg-brand/20" aria-hidden="true"></div>'),Ls=j("<div><h1>Rupa</h1> <!> <p>The Barista's CafÃ©</p></div>");function wa(d,e){let t=ie(e,"size",3,"md");const a={sm:{h1:"text-2xl",p:"text-[9px]",gap:"gap-3"},md:{h1:"text-4xl",p:"text-[11px]",gap:"gap-2"},lg:{h1:"text-7xl",p:"text-[14px]",gap:"gap-4"}};let r=q(()=>a[t()]),s=q(()=>t()==="sm"?"flex-row items-center":"flex-col items-center");var o=Ls(),n=p(o),c=h(n,2);{var v=x=>{var g=Es();E(x,g)};Q(c,x=>{t()==="sm"&&x(v)})}var f=h(c,2);u(o),V(()=>{K(o,1,`flex ${l(s)??""} ${l(r).gap??""} justify-center text-center select-none`),K(n,1,`font-tiny5 leading-none text-brand ${l(r).h1??""} tracking-tighter`),K(f,1,`font-serif font-bold tracking-[0.4em] text-charcoal/40 uppercase ${l(r).p??""}`)}),E(d,o)}var ke=gt(()=>i),Is=j('<nav class="flex items-center gap-2" aria-label="Editor Tools"><div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">ð</span> <span class="hidden xl:inline"></span></button> <button class="editor-tool-btn"><span aria-hidden="true">ð¶</span> <span class="hidden xl:inline"></span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">ð§¼</span> <span class="hidden xl:inline"></span></button> <button class="editor-tool-btn"><span aria-hidden="true"> </span> <span class="hidden xl:inline"></span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">ð</span> <span class="hidden xl:inline"></span></button> <button class="editor-tool-btn"><span aria-hidden="true">â¨ï¸</span> <span class="hidden xl:inline"></span></button></div></nav>');function Ts(d,e){W(e,!1),he();var t=Is(),a=p(t),r=p(a);r.__click=()=>ke(ke().showCommandPalette=!0),F(r,"title",`${__({key:"hud.menu.catalog_title"})??""} (Ctrl+K)`);var s=h(p(r),2);s.textContent=__({key:"hud.menu.catalog_title"}),u(r);var o=h(r,2);o.__click=()=>ke(ke().showExportMenu=!0),F(o,"title",`${__({key:"export.title"})??""} (Ctrl+E)`);var n=h(p(o),2);n.textContent=__({key:"export.title"}),u(o),u(a);var c=h(a,4),v=p(c);v.__click=()=>ke().clearCanvas(),F(v,"title",`${__({key:"hud.actions.clear_canvas"})??""} (Ctrl+L)`);var f=h(p(v),2);f.textContent=__({key:"hud.actions.clear_canvas"}),u(v);var x=h(v,2);x.__click=()=>ke(ke().showAudioSettings=!0),F(x,"title",`${__({key:"hud.audio.title"})??""} (Ctrl+Shift+A)`);var g=p(x),b=p(g,!0);u(g);var _=h(g,2);_.textContent=__({key:"hud.audio.title"}),u(x),u(c);var k=h(c,4),m=p(k);m.__click=()=>ke(ke().showGuideBook=!0),F(m,"title",`${__({key:"manual.title"})??""} (F1)`);var A=h(p(m),2);A.textContent=__({key:"manual.title"}),u(m);var L=h(m,2);L.__click=()=>ke(ke().showGuideMenu=!0),F(L,"title",`${__({key:"shortcuts.title"})??""} (F2)`);var $=h(p(L),2);$.textContent=__({key:"shortcuts.title"}),u(L),u(k),u(t),V(()=>N(b,ke().isMuted?"ð":"ð")),E(d,t),Z()}ve(["click"]);const Ps=d=>d;function Gt(d){const e=d-1;return e*e*e+1}function la(d){const e=typeof d=="string"&&d.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[d,"px"]}function Ee(d,{delay:e=0,duration:t=400,easing:a=Ps}={}){const r=+getComputedStyle(d).opacity;return{delay:e,duration:t,easing:a,css:s=>`opacity: ${s*r}`}}function ka(d,{delay:e=0,duration:t=400,easing:a=Gt,x:r=0,y:s=0,opacity:o=0}={}){const n=getComputedStyle(d),c=+n.opacity,v=n.transform==="none"?"":n.transform,f=c*(1-o),[x,g]=la(r),[b,_]=la(s);return{delay:e,duration:t,easing:a,css:(k,m)=>`
			transform: ${v} translate(${(1-k)*x}${g}, ${(1-k)*b}${_});
			opacity: ${c-f*m}`}}function Ms(d,{delay:e=0,duration:t=400,easing:a=Gt,axis:r="y"}={}){const s=getComputedStyle(d),o=+s.opacity,n=r==="y"?"height":"width",c=parseFloat(s[n]),v=r==="y"?["top","bottom"]:["left","right"],f=v.map(A=>`${A[0].toUpperCase()}${A.slice(1)}`),x=parseFloat(s[`padding${f[0]}`]),g=parseFloat(s[`padding${f[1]}`]),b=parseFloat(s[`margin${f[0]}`]),_=parseFloat(s[`margin${f[1]}`]),k=parseFloat(s[`border${f[0]}Width`]),m=parseFloat(s[`border${f[1]}Width`]);return{delay:e,duration:t,easing:a,css:A=>`overflow: hidden;opacity: ${Math.min(A*20,1)*o};${n}: ${A*c}px;padding-${v[0]}: ${A*x}px;padding-${v[1]}: ${A*g}px;margin-${v[0]}: ${A*b}px;margin-${v[1]}: ${A*_}px;border-${v[0]}-width: ${A*k}px;border-${v[1]}-width: ${A*m}px;min-${n}: 0`}}function xt(d,{delay:e=0,duration:t=400,easing:a=Gt,start:r=0,opacity:s=0}={}){const o=getComputedStyle(d),n=+o.opacity,c=o.transform==="none"?"":o.transform,v=1-r,f=n*(1-s);return{delay:e,duration:t,easing:a,css:(x,g)=>`
			transform: ${c} scale(${1-v*g});
			opacity: ${n-f*g}
		`}}var js=j('<div class="flex items-center gap-2 rounded-full border border-charcoal/10 bg-foam-white/50 px-3 py-1"><div class="h-1.5 w-1.5 rounded-full bg-brand/40" aria-hidden="true"></div> <span class="font-mono text-[9px] font-bold tracking-widest text-charcoal/40 uppercase"> </span></div>'),Fs=j('<div class="flex items-center gap-4 px-4"><!></div>');function Rs(d,e){W(e,!1),he();var t=Fs(),a=p(t);{var r=s=>{var o=js(),n=h(p(o),2),c=p(n,!0);u(n),u(o),V(v=>N(c,v),[()=>__({key:"project.saved",replace:{time:i.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}})]),le(3,o,()=>Ee),E(s,o)};Q(a,s=>{i.project.lastSaved&&s(r)})}u(t),E(d,t),Z()}var Bs=j('<header class="hud-panel flex h-14 w-full items-center justify-between px-8 py-2 select-none svelte-zd3ruq"><div class="flex items-center gap-12"><!> <div class="h-6 w-px bg-charcoal/10" aria-hidden="true"></div> <!></div> <!></header>');function $s(d){var e=Bs(),t=p(e),a=p(t);wa(a,{size:"sm"});var r=h(a,4);Ts(r,{}),u(t);var s=h(t,2);Rs(s,{}),u(e),E(d,e)}var Os=j('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">ðï¸</button>'),Ds=j('<div role="listitem" draggable="true"><button class="flex flex-1 items-center gap-3 overflow-hidden py-2 pl-1 text-left"><span class="font-mono text-[10px] opacity-30" aria-hidden="true"></span> <span class="truncate font-serif text-sm font-medium text-charcoal"> </span></button> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">ð</button> <!></div></div>'),Vs=j('<div class="flex flex-col gap-1" role="list"></div>'),zs=j('<div role="listitem" draggable="true"><div class="flex flex-1 items-center gap-2 overflow-hidden"><button> </button> <button> </button></div> <div class="flex items-center gap-2"><button> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">ðï¸</button></div></div>'),Gs=j('<div class="flex flex-col gap-1" role="list"></div>'),Ns=j('<div class="flex h-full w-full flex-col overflow-hidden bg-transparent" role="region" aria-label="Project Explorer"><div class="flex border-b border-charcoal/10 bg-charcoal/5 p-1" role="tablist"><button role="tab"><span aria-hidden="true">ð¼ï¸</span> </button> <button role="tab"><span aria-hidden="true">ð§µ</span> </button></div> <div class="custom-scrollbar flex-1 overflow-y-auto p-2"><!></div> <div class="flex items-center justify-between border-t border-charcoal/5 bg-charcoal/5 px-4 py-2"><button class="flex items-center gap-1 font-serif text-[9px] font-bold tracking-[0.1em] text-charcoal/40 uppercase hover:text-charcoal/80"><span aria-hidden="true">ï¼</span> </button> <span class="font-mono text-[8px] font-bold text-charcoal/20 uppercase"> </span></div></div>');function Us(d,e){W(e,!0);let t=I(null),a=I(null);function r(w){y(t,w,!0)}function s(w,M){w.preventDefault(),y(a,M,!0)}function o(w,M){w.preventDefault(),l(t)!==null&&(i.studio.projectActiveTab==="layers"?B.project.reorderLayer(l(t),M):B.project.reorderFrame(l(t),M)),y(t,null),y(a,null)}function n(){y(t,null),y(a,null)}var c=Ns(),v=p(c),f=p(v);f.__click=()=>i.studio.projectActiveTab="frames",F(f,"title",__({key:"shortcut_labels.TAB_TIMELINE"})+" (Alt+1)");var x=h(p(f));x.nodeValue=` ${__({key:"hud.project_panel.frames"})??""}`,u(f);var g=h(f,2);g.__click=()=>i.studio.projectActiveTab="layers",F(g,"title",__({key:"shortcut_labels.TAB_LAYERS"})+" (Alt+2)");var b=h(p(g));b.nodeValue=` ${__({key:"hud.project_panel.layers"})??""}`,u(g),u(v);var _=h(v,2),k=p(_);{var m=w=>{var M=Vs();xe(M,21,()=>i.project.frames,Ae,(D,z,C)=>{var O=Ds(),Y=p(O);Y.__click=()=>i.project.activeFrameIndex=C;var P=p(Y);P.textContent=C+1;var H=h(P,2),J=p(H,!0);u(H),u(Y);var G=h(Y,2),ee=p(G);ee.__click=se=>{se.stopPropagation(),B.project.duplicateFrame(C)},F(ee,"title",__({key:"hud.actions.duplicate"}));var re=h(ee,2);{var ce=se=>{var oe=Os();oe.__click=Le=>{Le.stopPropagation(),B.project.removeFrame(C)},F(oe,"title",__({key:"hud.actions.delete"})),E(se,oe)};Q(re,se=>{i.project.frames.length>1&&se(ce)})}u(G),u(O),V(()=>{K(O,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${C===i.project.activeFrameIndex?"bg-brand/5 text-brand ring-1 ring-brand/10":"hover:bg-charcoal/5"} ${l(a)===C&&l(t)!==C?"border-t-2 border-brand":""} ${l(t)===C?"opacity-40":""}`),F(O,"aria-current",C===i.project.activeFrameIndex?"true":void 0),N(J,l(z).name)}),de("dragstart",O,()=>r(C)),de("dragover",O,se=>s(se,C)),de("drop",O,se=>o(se,C)),de("dragend",O,n),E(D,O)}),u(M),le(3,M,()=>Ee,()=>({duration:150})),E(w,M)},A=w=>{var M=Gs();xe(M,21,()=>i.project.activeFrame.layers,Ae,(D,z,C)=>{var O=zs(),Y=p(O),P=p(Y);P.__click=oe=>{oe.stopPropagation(),B.project.toggleVisibility(C)},F(P,"title",__({key:"hud.project_panel.visibility"}));var H=p(P,!0);u(P);var J=h(P,2);J.__click=()=>i.project.activeFrame.activeLayerIndex=C;var G=p(J,!0);u(J),u(Y);var ee=h(Y,2),re=p(ee);re.__click=oe=>{oe.stopPropagation(),B.project.toggleLock(C)},F(re,"title",__({key:"hud.project_panel.lock"}));var ce=p(re,!0);u(re);var se=h(re,2);se.__click=oe=>{oe.stopPropagation(),B.project.removeLayer(C)},F(se,"title",__({key:"hud.actions.delete"})),u(ee),u(O),V(()=>{K(O,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${C===i.project.activeFrame.activeLayerIndex?"bg-brand/5 text-brand ring-1 ring-brand/10":"hover:bg-charcoal/5"} ${l(a)===C&&l(t)!==C?"border-t-2 border-brand":""} ${l(t)===C?"opacity-40":""}`),F(O,"aria-current",C===i.project.activeFrame.activeLayerIndex?"true":void 0),K(P,1,`text-xs transition-opacity ${l(z).isVisible?"opacity-100":"opacity-20"}`),N(H,l(z).isVisible?"ðï¸":"ð¶ï¸"),K(J,1,`flex-1 truncate py-2 text-left font-serif text-sm font-medium text-charcoal ${l(z).isVisible?"":"opacity-40"}`),N(G,l(z).name),K(re,1,`text-[10px] transition-opacity ${l(z).isLocked?"opacity-100":"opacity-20"}`),N(ce,l(z).isLocked?"ð":"ð")}),de("dragstart",O,()=>r(C)),de("dragover",O,oe=>s(oe,C)),de("drop",O,oe=>o(oe,C)),de("dragend",O,n),E(D,O)}),u(M),le(3,M,()=>Ee,()=>({duration:150})),E(w,M)};Q(k,w=>{i.studio.projectActiveTab==="frames"?w(m):w(A,!1)})}u(_);var L=h(_,2),$=p(L);$.__click=()=>{i.studio.projectActiveTab==="frames"?B.project.addFrame():B.project.addLayer()};var R=h(p($));u($);var T=h($,2),S=p(T,!0);u(T),u(L),u(c),V(w=>{F(f,"aria-selected",i.studio.projectActiveTab==="frames"),K(f,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${i.studio.projectActiveTab==="frames"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),F(g,"aria-selected",i.studio.projectActiveTab==="layers"),K(g,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${i.studio.projectActiveTab==="layers"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),N(R,` ${w??""}`),N(S,i.studio.projectActiveTab==="frames"?i.project.frames.length:i.project.activeFrame.layers.length)},[()=>i.studio.projectActiveTab==="frames"?__({key:"hud.actions.add_frame"}):__({key:"hud.actions.add_layer"})]),E(d,c),Z()}ve(["click"]);var Hs=j('<aside class="side-panel-left flex h-full w-full flex-col overflow-hidden border-r border-charcoal/10 bg-stone-light/50"><div class="flex-1 overflow-y-auto"><!></div></aside>');function Ks(d){var e=Hs(),t=p(e),a=p(t);Us(a,{}),u(t),u(e),E(d,e)}var qs=j('<button class="group editor-checker-small relative h-5 w-5 shrink-0 rounded border border-charcoal/10 shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[8px]">ð</span></div></button>'),Ys=j('<div class="flex h-5 w-5 items-center justify-center rounded border border-dashed border-charcoal/10"><span class="text-[8px] opacity-20">ð¨</span></div>'),Qs=j('<div class="editor-panel flex w-full flex-col gap-4 border-none bg-foam-white p-3 shadow-sm"><div class="flex flex-col items-center gap-2 py-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Active Flavor</span> <div class="editor-checker-small h-10 w-10 rounded border border-charcoal/10 shadow-inner transition-colors"></div> <span class="font-mono text-[9px] font-bold tracking-tight text-charcoal/40 uppercase"> </span></div> <div class="h-px w-full bg-charcoal/5"></div> <div class="flex flex-col gap-2"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Recent Brews</span> <div class="custom-scrollbar flex max-h-[120px] flex-row flex-wrap gap-1.5 overflow-y-auto px-1"></div></div></div>');function Xs(d,e){W(e,!1),he();var t=Qs(),a=p(t),r=h(p(a),2),s=h(r,2),o=p(s,!0);u(s),u(a);var n=h(a,4),c=h(p(n),2);xe(c,5,()=>i.usedColors,v=>v,(v,f)=>{var x=qs();x.__click=()=>B.color.setColor(l(f)),V(()=>{ae(x,`background-color: ${l(f)??""};`),F(x,"title",l(f))}),le(3,x,()=>Ms,()=>({duration:200})),E(v,x)},v=>{var f=Ys();E(v,f)}),u(c),u(n),u(t),V(()=>{ae(r,`background-color: ${i.paletteState.activeColor??""};`),N(o,i.paletteState.activeColor)}),E(d,t),Z()}ve(["click"]);var Ws=j('<div class="editor-panel w-full border-none bg-stone-light/50 p-3 shadow-sm" role="status"><div class="flex flex-col gap-3"><div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"></span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div> <div class="h-px w-full bg-charcoal/5" aria-hidden="true"></div> <div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"></span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div></div></div>');function Zs(d,e){W(e,!1),he();var t=Ws(),a=p(t),r=p(a),s=p(r);s.textContent=__({key:"stats.cursor_focus"});var o=h(s,2),n=p(o);u(o),u(r);var c=h(r,4),v=p(c);v.textContent=__({key:"stats.canvas_size"});var f=h(v,2),x=p(f);u(f),u(c),u(a),u(t),V(()=>{N(n,`${i.displayCoords.x??""}, ${i.displayCoords.y??""}`),N(x,`${i.canvas.width??""}Ã${i.canvas.height??""}`)}),E(d,t),Z()}var Xe=gt(()=>i),Js=j('<button role="radio"></button>'),ei=j('<div class="editor-panel flex w-full flex-col gap-3 border-none bg-stone-light/30 p-3 shadow-sm" role="region" aria-label="Color Palette"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"></span> <div class="grid grid-cols-4 gap-2" role="radiogroup"><!> <button class="flex h-8 w-8 items-center justify-center rounded border border-dashed border-charcoal/20 bg-charcoal/5 transition-all hover:scale-110 hover:border-brand/40 hover:bg-white"><span class="text-xs opacity-40" aria-hidden="true">ï¼</span></button></div></div>');function ti(d,e){W(e,!1),he();var t=ei(),a=p(t);a.textContent=__({key:"shortcut_groups.colors"});var r=h(a,2),s=p(r);xe(s,1,()=>Xe().palette,Ae,(n,c,v)=>{var f=Js();f.__click=()=>B.color.select(v),V((x,g)=>{K(f,1,`editor-checker-small h-8 w-8 rounded transition-all ${Xe().activeColor===l(c)?"z-10 scale-110 border-2 border-brand shadow-md":"border border-charcoal/5 opacity-80 hover:scale-105 hover:opacity-100"}`),ae(f,`background-color: ${l(c)??""};`),F(f,"aria-label",x),F(f,"title",g),F(f,"aria-checked",Xe().activeColor===l(c))},[()=>__({key:`shortcut_labels.SELECT_COLOR_${(v+1)%10}`}),()=>__({key:`shortcut_labels.SELECT_COLOR_${(v+1)%10}`})+` (${(v+1)%10})`]),E(n,f)});var o=h(s,2);o.__click=()=>Xe(Xe().showColorPicker=!0),F(o,"title",`${__({key:"color_picker.title"})??""} (B)`),F(o,"aria-label",__({key:"color_picker.title"})),u(r),u(t),E(d,t),Z()}ve(["click"]);var ai=j('<aside class="side-panel-right flex h-full w-full flex-col gap-4 border-l border-charcoal/10 bg-foam-white/50 p-3"><div class="flex flex-col gap-3"><!> <!></div> <div class="flex-1"></div> <!></aside>');function ri(d){var e=ai(),t=p(e),a=p(t);Xs(a,{});var r=h(a,2);ti(r,{}),u(t);var s=h(t,4);Zs(s,{}),u(e),E(d,e)}var si=j('<span class="text-xs" aria-hidden="true"> </span>'),ii=j('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),oi=j("<div><!> <span> </span> <!></div>"),ni=j('<div class="text-[8px] font-bold tracking-[0.2em] text-studio-text/20 uppercase"> </div>'),li=j('<div role="status" aria-live="polite"><div class="flex w-[180px] items-center"><!></div> <!></div>');function ci(d,e){W(e,!1),he();var t=li(),a=p(t),r=p(a);mr(r,()=>fe.current.type,n=>{var c=oi(),v=p(c);{var f=k=>{var m=si(),A=p(m,!0);u(m),V(()=>N(A,fe.current.icon)),E(k,m)};Q(v,k=>{fe.current.icon&&k(f)})}var x=h(v,2),g=p(x,!0);u(x);var b=h(x,2);{var _=k=>{var m=ii(),A=p(m);u(m),V(()=>N(A,`v${i.version??""}`)),E(k,m)};Q(b,k=>{fe.current.type==="READY"&&k(_)})}u(c),V(()=>{K(c,1,`status-tag flex items-center gap-2 ${fe.current.isPulse?"animate-pulse":""}`),ae(c,`
					border-color: color-mix(in srgb, ${fe.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${fe.current.color??""} 10%, transparent);
					color: ${fe.current.color??""};
				`),K(x,1,Lr(fe.current.type==="READY"?"font-serif italic opacity-60":"font-bold")),N(g,fe.current.label)}),E(n,c)}),u(a);var s=h(a,2);{var o=n=>{const c=vt(()=>i.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var v=ni(),f=p(v,!0);u(v),V((x,g)=>{F(v,"aria-label",x),N(f,g)},[()=>__({key:"project.saved",replace:{time:l(c)}}),()=>__({key:"project.saved",replace:{time:l(c)}})]),E(n,v)};Q(s,n=>{i.project.lastSaved&&n(o)})}u(t),V(()=>K(t,1,`flex items-center gap-4 transition-opacity duration-1000 ${i.cursor.isVisible?"opacity-100":"opacity-0"}`)),E(d,t),Z()}var di=j('<span class="rounded border border-charcoal/20 bg-charcoal/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-charcoal uppercase"> </span>'),ui=j('<span class="font-mono text-[9px] text-charcoal/40 italic"></span>'),vi=j('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"></span> <div class="flex min-w-[80px] gap-1.5"><!></div></div>');function pi(d,e){W(e,!1),he();var t=vi(),a=p(t);a.textContent=`${__({key:"timeline.rhythm"})??""}:`;var r=h(a,2),s=p(r);{var o=c=>{var v=Fe(),f=pe(v);xe(f,1,()=>Ce.activeKeys,Ae,(x,g)=>{var b=di(),_=p(b,!0);u(b),V(()=>N(_,l(g)===" "?"Space":l(g))),E(x,b)}),E(c,v)},n=c=>{var v=ui();v.textContent=__({key:"timeline.waiting"}),E(c,v)};Q(s,c=>{Ce.activeKeys.length>0?c(o):c(n,!1)})}u(r),u(t),E(d,t),Z()}var hi=j('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"></span> <span class="font-mono text-[9px] font-bold text-charcoal uppercase"> </span></div>');function fi(d,e){W(e,!1),he();var t=hi(),a=p(t);a.textContent=`${__({key:"timeline.mode"})??""}:`;var r=h(a,2),s=p(r,!0);u(r),u(t),V(()=>N(s,fe.current.type)),E(d,t),Z()}var xi=j('<div class="flex items-center gap-1.5"><span aria-hidden="true">ð¹</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"><!></span></div>');function gi(d,e){W(e,!1),he();var t=xi();F(t,"title",__({key:"timeline.audio_status.title"}));var a=p(t),r=h(a,2),s=p(r);{var o=c=>{var v=Ze();v.nodeValue=__({key:"timeline.audio_status.silent"}),E(c,v)},n=c=>{var v=Fe(),f=pe(v);{var x=b=>{var _=Ze();_.nodeValue=__({key:"timeline.audio_status.brewing"}),E(b,_)},g=b=>{var _=Ze();_.nodeValue=__({key:"timeline.audio_status.resonant"}),E(b,_)};Q(f,b=>{i.usageMinutes<60?b(x):b(g,!1)},!0)}E(c,v)};Q(s,c=>{i.usageMinutes<30?c(o):c(n,!1)})}u(r),u(t),V(()=>K(a,1,`text-[9px] ${i.usageMinutes>=30?"animate-pulse":"opacity-40 grayscale"}`)),E(d,t),Z()}var bi=j('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">â±ï¸</span> <span class="font-mono text-[9px] font-bold text-charcoal/80 tabular-nums"> </span></div>');function mi(d,e){W(e,!1),he();var t=bi();F(t,"title",__({key:"timeline.duration"}));var a=h(p(t),2),r=p(a,!0);u(a),u(t),V(()=>N(r,i.studio.sessionTimeLabel)),E(d,t),Z()}var yi=j('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">â¨</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/60 uppercase italic"> </span></div>');function _i(d,e){W(e,!1),he();var t=yi(),a=h(p(t),2),r=p(a,!0);u(a),u(t),V(s=>N(r,s),[()=>__({key:i.selection.indices.length>1?"timeline.pixel_count_plural":"timeline.pixel_count",replace:{count:i.selection.indices.length}})]),E(d,t),Z()}var Ai=j('<div class="flex items-center gap-1.5"><span class="text-[10px]" aria-hidden="true">ð¾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand/80 uppercase"> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div>',1),wi=j('<div class="flex items-center gap-3 text-charcoal/40" role="status"><!> <div class="flex gap-3 font-mono text-[9px] font-bold tracking-tight text-charcoal/60 uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div> <span class="font-mono text-[10px] font-black tracking-widest text-brand/60 uppercase"></span></div>');function ki(d,e){W(e,!1),he();var t=wi(),a=p(t);{var r=b=>{var _=Ai(),k=pe(_),m=h(p(k),2),A=p(m,!0);u(m),u(k),at(2),V(L=>N(A,L),[()=>__({key:"project.saved",replace:{time:i.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}})]),le(3,k,()=>Ee),E(b,_)};Q(a,b=>{i.project.lastSaved&&b(r)})}var s=h(a,2),o=p(s),n=p(o);u(o);var c=h(o,2),v=p(c);u(c);var f=h(c,2),x=p(f);u(f),u(s);var g=h(s,4);g.textContent=__({key:"stats.technical_details"}),u(t),V(b=>{N(n,`POS: ${i.cursor.pos.x??""},${i.cursor.pos.y??""}`),N(v,`SIZE: ${i.canvas.width??""}x${i.canvas.height??""}`),N(x,`ZOOM: ${b??""}%`)},[()=>Math.round(i.studio.zoomLevel*100)]),E(d,t),Z()}var Ci=j('<div class="flex flex-1 items-center justify-between px-3 opacity-80 transition-opacity hover:opacity-100"><div class="flex items-center gap-4"><!> <div class="h-3 w-px bg-charcoal/20"></div> <!> <div class="h-3 w-px bg-charcoal/20"></div> <div class="flex items-center gap-3"><!> <!> <div class="h-3 w-px bg-charcoal/20"></div> <!></div></div> <!></div>');function Si(d){var e=Ci(),t=p(e),a=p(t);pi(a,{});var r=h(a,4);fi(r,{});var s=h(r,4),o=p(s);mi(o,{});var n=h(o,2);gi(n,{});var c=h(n,4);_i(c,{}),u(s),u(t);var v=h(t,2);ki(v,{}),u(e),E(d,e)}var me=gt(()=>i),Ei=j('<div class="flex items-center gap-4 border-r border-black/5 pr-4" role="toolbar" aria-label="Timeline Controls"><button><span class="text-xs" aria-hidden="true"> </span> <span class="font-tiny5 tracking-widest uppercase"> </span></button> <div class="flex items-center gap-2 rounded-xl bg-black/5 px-3 py-1 ring-1 ring-black/5"><label for="pace-input" class="font-serif text-[11px] font-black tracking-tight text-studio-text/50 uppercase"></label> <input id="pace-input" type="number" min="1" max="60" class="w-10 bg-transparent text-center font-mono text-sm font-bold text-studio-text focus:outline-none"/> <span class="font-serif text-[10px] font-black text-studio-text/30" aria-hidden="true">FPS</span></div> <button><span class="text-xs" aria-hidden="true">ð»</span> <span class="font-serif text-[11px] font-black tracking-wider text-studio-text/70 uppercase">Ghosts</span></button> <div class="flex items-center gap-2 border-l border-black/5 pl-4"><span class="text-xs opacity-40" aria-hidden="true">ð</span> <input type="range" min="0.5" max="4" step="0.1" class="editor-range w-20 svelte-cffdjb" title="Timeline Zoom"/> <span class="w-8 font-mono text-[10px] font-bold text-studio-text/40"> </span></div></div>');function Li(d,e){W(e,!1),he();var t=Ei(),a=p(t);a.__click=()=>ya.togglePlayback(),F(a,"title",__({key:"shortcut_labels.PLAY_PAUSE"})+" (P)"),F(a,"aria-label",__({key:"shortcut_labels.PLAY_PAUSE"}));var r=p(a),s=p(r,!0);u(r);var o=h(r,2),n=p(o,!0);u(o),u(a);var c=h(a,2),v=p(c);v.textContent=__({key:"export.fps_label"});var f=h(v,2);ge(f),at(2),u(c);var x=h(c,2);x.__click=()=>me(me().studio.showGhostLayers=!me().studio.showGhostLayers),F(x,"title",__({key:"shortcut_labels.TOGGLE_GHOST_LAYERS"})+" (Alt+G)"),F(x,"aria-label",__({key:"shortcut_labels.TOGGLE_GHOST_LAYERS"}));var g=h(x,2),b=h(p(g),2);ge(b);var _=h(b,2),k=p(_);u(_),u(g),u(t),V(m=>{K(a,1,`editor-primary-btn flex items-center gap-2 !px-4 !py-1.5 text-xs ${me().project.isPlaying?"bg-brand":"bg-slate-700"}`),N(s,me().project.isPlaying?"â¹":"â¶"),N(n,me().project.isPlaying?"Stop":"Play"),K(x,1,`flex items-center gap-2 rounded-xl px-3 py-1.5 transition-all ${me().studio.showGhostLayers?"bg-brand/10 text-brand ring-1 ring-brand/20":"bg-black/5 opacity-40 shadow-sm hover:bg-white/60 hover:opacity-100"}`),N(k,`${m??""}%`)},[()=>Math.round(me().studio.timelineZoom*100)]),be(f,()=>me().studio.fps,m=>me(me().studio.fps=m)),be(b,()=>me().studio.timelineZoom,m=>me(me().studio.timelineZoom=m)),E(d,t),Z()}ve(["click"]);class Mt{static getRulerMarks(e,t,a=1e4){const r=[];let s=500;t>2&&(s=100),t<.6&&(s=1e3);const o=Math.max(e+a,3e4/t);for(let n=0;n<=o;n+=s)r.push(n);return r}static formatTimeLabel(e){return e>=1e3?(e/1e3).toFixed(e%1e3===0?0:1)+"s":e+"ms"}static getFrameOffset(e,t,a,r){let s=0;for(let o=0;o<t;o++)s+=Math.max(r,e[o].duration*a);return s}static getTrackWidth(e,t,a){return e.reduce((r,s)=>r+Math.max(a,s.duration*t),0)}}var Ii=j('<div><div role="button" tabindex="0"><div></div> <div class="absolute top-1 left-1 flex h-4 min-w-4 items-center justify-center rounded-sm bg-black/40 px-1 backdrop-blur-sm"><span class="font-mono text-[9px] font-black text-white"> </span></div> <div class="absolute right-1 bottom-1 rounded bg-white/80 px-1.5 py-0.5 font-mono text-[9px] font-bold text-black/50 shadow-sm"> </div></div>  <div class="absolute top-0 right-0 bottom-0 z-30 w-2 cursor-col-resize rounded-r-md transition-colors hover:bg-brand/40 active:bg-brand"><div class="absolute top-1/2 left-1/2 h-6 w-0.5 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/10 group-hover:bg-white/60"></div></div></div>');function Ti(d,e){W(e,!0);let t=ie(e,"frame",7),a=q(()=>.25*i.studio.timelineZoom);const r=50;let s=q(()=>Math.max(r,t().duration*l(a))),o=I(!1),n=0,c=0;function v(T){T.stopPropagation(),T.preventDefault(),y(o,!0),n=T.clientX,c=t().duration,window.addEventListener("mousemove",f),window.addEventListener("mouseup",x),document.body.style.cursor="col-resize"}function f(T){if(!l(o))return;const S=T.clientX-n,w=Math.round(S/l(a)),M=Math.max(10,c+w);t().duration=Math.round(M/10)*10}function x(){y(o,!1),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",x),document.body.style.cursor=""}var g=Ii(),b=p(g);b.__click=()=>i.project.activeFrameIndex=e.index,b.__keydown=T=>T.key==="Enter"&&(i.project.activeFrameIndex=e.index);var _=p(b),k=h(_,2),m=p(k),A=p(m,!0);u(m),u(k);var L=h(k,2),$=p(L);u(L),u(b);var R=h(b,2);R.__mousedown=v,u(g),V(()=>{K(g,1,`relative h-full flex-shrink-0 transition-transform duration-200 select-none ${e.isDragged?"scale-95 opacity-40":""} ${e.isDropTarget?"translate-x-4":""}`),ae(g,`width: ${l(s)??""}px;`),K(b,1,`group relative h-full w-full cursor-pointer overflow-hidden rounded-md border border-black/10 transition-all ${e.isActive?"border-brand bg-white shadow-lg ring-2 ring-brand/20":"bg-white/60 hover:bg-white/90 hover:shadow-md"}`),K(_,1,`absolute inset-1 rounded-sm shadow-inner transition-colors ${e.isActive?"bg-brand/10":"bg-black/5"}`),N(A,e.index+1),N($,`${t().duration??""}ms`)}),E(d,g),Z()}ve(["click","keydown","mousedown"]);var Pi=j('<div class="absolute flex flex-col items-start"><div class="h-1.5 w-px bg-charcoal/20"></div> <span class="-mt-0.5 ml-1 font-mono text-[8px] font-bold whitespace-nowrap text-charcoal/30"> </span></div>'),Mi=j("<div></div>"),ji=j('<div role="listitem" draggable="true" class="relative h-[50px]"><!> <!></div>'),Fi=j('<div class="relative flex flex-1 flex-col overflow-hidden rounded border border-charcoal/10 bg-stone-light/30 shadow-inner"><div class="relative h-5 w-full cursor-pointer overflow-hidden border-b border-charcoal/5 bg-foam-white/80" role="presentation"><div class="absolute top-0 bottom-0"></div></div> <div class="custom-scrollbar relative flex flex-1 items-start overflow-x-auto overflow-y-hidden svelte-8wcczq" role="list" aria-label="Timeline"><div class="flex h-full items-center bg-transparent py-2 pl-1"><!> <button class="group ml-2 flex h-[50px] w-8 shrink-0 items-center justify-center rounded border border-dashed border-charcoal/20 bg-foam-white/40 text-charcoal/20 transition-all hover:border-brand/40 hover:bg-white hover:text-brand" title="Add Frame"><span class="text-lg">ï¼</span></button> <div class="w-40 shrink-0"></div></div> <div class="pointer-events-none absolute top-0 bottom-0 z-20 w-px bg-brand transition-all duration-100 ease-out"><div class="absolute -top-0.5 -left-1 h-2 w-2 rotate-45 rounded-sm bg-brand shadow-sm"></div></div></div></div>');function Ri(d,e){W(e,!0);let t=I(null),a=I(null),r=I(void 0),s=I(void 0),o=I(0),n=q(()=>.25*i.studio.timelineZoom);const c=50;function v(C){const O=C.target;y(o,O.scrollLeft,!0)}function f(C){y(t,C,!0)}function x(C,O){C.preventDefault(),y(a,O,!0)}function g(C,O){C.preventDefault(),l(t)!==null&&l(t)!==O&&B.project.reorderFrame(l(t),O),y(t,null),y(a,null)}let b=q(()=>Mt.getFrameOffset(i.project.frames,i.project.activeFrameIndex,l(n),c));Se(()=>{if(l(r)&&i.project.isPlaying){const C=l(r).clientWidth/2;l(b)>C&&(l(r).scrollLeft=l(b)-C)}});let _=q(()=>i.project.frames.reduce((C,O)=>C+O.duration,0)),k=q(()=>Mt.getRulerMarks(l(_),i.studio.timelineZoom)),m=q(()=>l(k)[l(k).length-1]*l(n)+100);function A(C){if(!l(s))return;const O=l(s).getBoundingClientRect(),Y=l(r)?.scrollLeft||0,P=C.clientX-O.left+Y;let H=0;for(let J=0;J<i.project.frames.length;J++){const G=Math.max(c,i.project.frames[J].duration*l(n));if(P>=H&&P<H+G){i.project.activeFrameIndex=J;break}H+=G}}function L(C){if(C.ctrlKey){C.preventDefault();const O=C.deltaY>0?-.1:.1;i.studio.timelineZoom=Math.max(.5,Math.min(4,i.studio.timelineZoom+O))}}var $=Fi(),R=p($);R.__click=A;var T=p(R);xe(T,21,()=>l(k),Ae,(C,O)=>{var Y=Pi(),P=h(p(Y),2),H=p(P,!0);u(P),u(Y),V(J=>{ae(Y,`left: ${l(O)*l(n)}px;`),N(H,J)},[()=>Mt.formatTimeLabel(l(O))]),E(C,Y)}),u(T),u(R),He(R,C=>y(s,C),()=>l(s));var S=h(R,2),w=p(S),M=p(w);xe(M,19,()=>i.project.frames,C=>C.id,(C,O,Y)=>{var P=ji(),H=p(P);{let ee=q(()=>l(Y)===i.project.activeFrameIndex),re=q(()=>l(t)===l(Y)),ce=q(()=>l(a)===l(Y)&&l(t)!==l(Y));Ti(H,{get frame(){return l(O)},get index(){return l(Y)},get isActive(){return l(ee)},get isDragged(){return l(re)},get isDropTarget(){return l(ce)}})}var J=h(H,2);{var G=ee=>{var re=Mi();V(()=>K(re,1,`absolute top-0 bottom-0 z-50 w-0.5 bg-brand ${l(Y)<(l(t)||0)?"-left-0.5":"-right-0.5"}`)),E(ee,re)};Q(J,ee=>{l(a)===l(Y)&&l(t)!==l(Y)&&ee(G)})}u(P),de("dragstart",P,()=>f(l(Y))),de("dragover",P,ee=>x(ee,l(Y))),de("drop",P,ee=>g(ee,l(Y))),de("dragend",P,()=>{y(t,null),y(a,null)}),E(C,P)});var D=h(M,2);D.__click=()=>B.project.addFrame(),at(2),u(w);var z=h(w,2);u(S),He(S,C=>y(r,C),()=>l(r)),u($),V(()=>{ae(T,`width: ${l(m)??""}px; transform: translateX(-${l(o)??""}px);`),ae(w,`width: ${l(m)??""}px;`),ae(z,`left: ${l(b)??""}px;`)}),de("wheel",$,L),de("scroll",S,v),E(d,$),Z()}ve(["click"]);var Bi=j('<div class="flex h-32 w-full flex-col gap-1 overflow-hidden bg-transparent px-4 py-2" role="region" aria-label="Timeline"><div class="flex items-center justify-between border-b border-charcoal/5 pb-1"><div class="flex items-center gap-6"><div class="flex items-center gap-2"><span class="text-[10px] opacity-30" aria-hidden="true">â³</span> <span class="font-tiny5 text-[9px] tracking-[0.2em] text-charcoal/40 uppercase"></span></div> <!></div> <div class="flex items-center gap-4"><div class="flex flex-col items-end"><span class="font-serif text-[7px] font-black tracking-widest text-charcoal/20 uppercase"></span> <span class="font-mono text-[9px] font-bold text-brand/40"> </span></div></div></div> <!></div>');function $i(d,e){W(e,!1),he();var t=Bi(),a=p(t),r=p(a),s=p(r),o=h(p(s),2);o.textContent=__({key:"timeline.title"}),u(s);var n=h(s,2);Li(n,{}),u(r);var c=h(r,2),v=p(c),f=p(v);f.textContent=__({key:"timeline.track"});var x=h(f,2),g=p(x,!0);u(x),u(v),u(c),u(a);var b=h(a,2);Ri(b,{}),u(t),V(_=>N(g,_),[()=>__({key:"timeline.pixel_count",replace:{count:i.project.frames.length}})]),E(d,t),Z()}var Oi=j('<footer class="hud-panel flex w-full flex-col border-t border-charcoal/10 bg-foam-white p-1 svelte-1tnr1yh"><!> <div class="flex h-7 w-full items-center justify-between px-4"><div class="flex items-center gap-4"><!></div> <!></div></footer>');function Di(d){var e=Oi(),t=p(e);$i(t,{});var a=h(t,2),r=p(a),s=p(r);ci(s,{}),u(r);var o=h(r,2);Si(o),u(a),u(e),E(d,e)}var Vi=j('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-charcoal/20"></div>'),zi=j('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-charcoal/20"></div>'),Gi=j('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-charcoal/40"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-charcoal/40"></div> <!> <!></div>');function Ni(d,e){W(e,!1),he();var t=Gi(),a=h(p(t),4);xe(a,0,()=>[-24,-16,-8,8,16,24],Ae,(s,o)=>{const n=vt(()=>De.getGuidePosition(o,i.canvas.width));var c=Fe(),v=pe(c);{var f=x=>{var g=Vi();V(()=>ae(g,`left: ${l(n)??""}%`)),E(x,g)};Q(v,x=>{l(n)>0&&l(n)<100&&x(f)})}E(s,c)});var r=h(a,2);xe(r,0,()=>[-24,-16,-8,8,16,24],Ae,(s,o)=>{const n=vt(()=>De.getGuidePosition(o,i.canvas.height));var c=Fe(),v=pe(c);{var f=x=>{var g=zi();V(()=>ae(g,`top: ${l(n)??""}%`)),E(x,g)};Q(v,x=>{l(n)>0&&l(n)<100&&x(f)})}E(s,c)}),u(t),E(d,t),Z()}var Ui=et('<line stroke-dasharray="0.2, 0.2" class="marching-ants-svg svelte-1onh8x1"></line>'),Hi=et('<line stroke="var(--color-brand)" stroke-width="0.05" stroke-dasharray="0.1, 0.1"></line>'),Ki=et('<circle r="0.2" fill="var(--color-brand)"></circle><!>',1),qi=et('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><defs><pattern id="ants" width="1" height="1" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="1" y2="0" stroke="var(--ants-color)" stroke-width="0.1" stroke-dasharray="0.2, 0.2"></line></pattern></defs><!><!></svg><svg class="pointer-events-none absolute inset-0 z-[39] h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><path fill="var(--color-brand)" fill-opacity="0.1"></path></svg>',1);function Yi(d,e){W(e,!0);let t=q(()=>i.selection.getBoundaryEdges(i.canvas.width)),a=q(()=>i.selection.vertices),r=q(()=>fe.current.type==="SELECT");var s=Fe(),o=pe(s);{var n=c=>{var v=qi(),f=pe(v),x=h(p(f));xe(x,17,()=>l(t),Ae,(m,A)=>{var L=Ui();F(L,"stroke-width",.08),V(()=>{F(L,"x1",l(A).x1),F(L,"y1",l(A).y1),F(L,"x2",l(A).x2),F(L,"y2",l(A).y2),F(L,"stroke",l(r)?"var(--color-brand)":"rgba(211, 54, 130, 0.8)")}),E(m,L)});var g=h(x);{var b=m=>{var A=Fe(),L=pe(A);xe(L,17,()=>l(a),Ae,($,R,T)=>{const S=q(()=>l(a)[T+1]||l(a)[0]);var w=Ki(),M=pe(w),D=h(M);{var z=C=>{var O=Hi();V(()=>{F(O,"x1",l(R).x+.5),F(O,"y1",l(R).y+.5),F(O,"x2",l(S).x+.5),F(O,"y2",l(S).y+.5)}),E(C,O)};Q(D,C=>{l(a).length>1&&T<l(a).length-(l(a).length>=3?0:1)&&C(z)})}V(()=>{F(M,"cx",l(R).x+.5),F(M,"cy",l(R).y+.5)}),E($,w)}),E(m,A)};Q(g,m=>{l(a).length>0&&m(b)})}u(f);var _=h(f),k=p(_);u(_),V(m=>{F(f,"viewBox",`0 0 ${i.canvas.width??""} ${i.canvas.height??""}`),F(_,"viewBox",`0 0 ${i.canvas.width??""} ${i.canvas.height??""}`),F(k,"d",m)},[()=>i.selection.getPoints(i.canvas.width).map(m=>`M${m.x},${m.y}h1v1h-1z`).join(" ")]),E(c,v)};Q(o,c=>{i.selection.isActive&&c(n)})}E(d,s),Z()}var Qi=j('<canvas class="pointer-events-none absolute inset-0 z-0 h-full w-full"></canvas>');function Xi(d,e){W(e,!0);let t=ie(e,"opacity",3,.2),a=I(null);Se(()=>{const s=l(a)?.getContext("2d");if(!(!s||!l(a))){s.imageSmoothingEnabled=!1,s.clearRect(0,0,e.width,e.height);for(let o=0;o<e.pixels.length;o++){const n=e.pixels[o];if(n){s.fillStyle=n;const c=o%e.width,v=Math.floor(o/e.width);s.fillRect(c,v,1,1)}}}});var r=Qi();He(r,s=>y(a,s),()=>l(a)),V(()=>{F(r,"width",e.width),F(r,"height",e.height),ae(r,`opacity: ${t()??""}; image-rendering: pixelated;`)}),E(d,r),Z()}var Wi=j('<div class="absolute flex items-center justify-center"><span class="font-mono text-[8px] font-bold text-charcoal/40"> </span></div>'),Zi=j('<div class="pointer-events-none relative h-full w-full overflow-hidden bg-latte-foam/80 backdrop-blur-sm" role="presentation"><div><div></div> <div></div> <!> <div class="absolute z-20 bg-brand transition-all duration-75 ease-out"><div class="absolute top-1/2 left-1/2 rounded-sm bg-brand px-1 py-0.5 shadow-sm"><span class="font-mono text-[9px] leading-none font-bold text-white"> </span></div></div></div></div>');function ca(d,e){W(e,!0);let t=ie(e,"orientation",3,"horizontal"),a=q(()=>i.canvas.width),r=q(()=>i.canvas.height),s=q(()=>t()==="horizontal"?l(a):l(r)),o=q(()=>t()==="horizontal"?i.cursor.pos.x:i.cursor.pos.y),n=q(()=>{const T=i.studio.zoomLevel;return T<=.5?16:T<=1.5?8:T<=4?4:2}),c=q(()=>i.canvas.getFitDimension(t())),v=q(()=>i.studio.zoomLevel),f=q(()=>{const T=[];for(let S=0;S<l(s);S++){const w=De.toCartesianLabel(S,l(s),t()==="vertical");(w%l(n)===0||S===0||S===l(s)-1)&&T.push({pos:S,label:w})}return T}),x=q(()=>{if(l(v)<=1)return t()==="horizontal"?"translate(-50%, 0)":"translate(0, -50%)";const T=(l(o)+.5)/l(s)*100;return t()==="horizontal"?`translate(-${T}%, 0)`:`translate(0, -${T}%)`});var g=Zi(),b=p(g),_=p(b),k=h(_,2),m=h(k,2);xe(m,17,()=>l(f),T=>T.pos,(T,S)=>{var w=Wi(),M=p(w),D=p(M,!0);u(M),u(w),V(()=>{ae(w,`
					${t()==="horizontal"?"left":"top"}: ${l(S).pos/l(s)*100}%;
					${t()==="horizontal"?"width":"height"}: ${100/l(s)}%;
					${t()==="horizontal"?"height":"width"}: 100%;
					${t()==="horizontal"?"padding-bottom: 4px;":"padding-right: 4px;"}
				`),ae(M,`transform: ${t()==="vertical"?"rotate(-90deg)":"none"};`),N(D,l(S).label)}),E(T,w)});var A=h(m,2),L=p(A),$=p(L),R=p($,!0);u($),u(L),u(A),u(b),u(g),V(T=>{K(b,1,`absolute flex ${t()==="vertical"?"flex-col":""}`),ae(b,`
			left: ${t()==="horizontal"?"50%":"0"};
			top: ${t()==="vertical"?"50%":"0"};
			transform: ${l(x)??""}; 
			${t()==="horizontal"?"width":"height"}: calc(${l(c)??""} * ${l(v)??""});
			${t()==="vertical"?"width":"height"}: 100%;
		`),K(_,1,`absolute opacity-10 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-1/2":"top-0 right-0 bottom-0 w-1/2"}`),ae(_,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1px, transparent 1px);
				background-size: ${t()==="horizontal"?`calc(100% / ${l(s)}) 100%`:`100% calc(100% / ${l(s)})`};
			`),K(k,1,`absolute opacity-20 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-3/4":"top-0 right-0 bottom-0 w-3/4"}`),ae(k,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1.5px, transparent 1.5px);
				background-size: ${t()==="horizontal"?`calc(100% / ${l(s)} * ${l(n)}) 100%`:`100% calc(100% / ${l(s)} * ${l(n)})`};
			`),ae(A,`
				${t()==="horizontal"?"left":"top"}: ${(l(o)+.5)/l(s)*100}%;
				${t()==="horizontal"?"width: 1px; top: 0; bottom: 0;":"height: 1px; left: 0; right: 0;"}
			`),ae(L,`transform: translate(-50%, -50%) ${t()==="vertical"?"rotate(-90deg)":""};`),N(R,T)},[()=>De.toCartesianLabel(l(o),l(s),t()==="vertical")]),E(d,g),Z()}var Ji=j('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),eo=j('<div class="cursor-container absolute inset-0 svelte-13i93z"><div class="cursor-bloom svelte-13i93z"><div class="petal p-top svelte-13i93z"></div> <div class="petal p-bottom svelte-13i93z"></div> <div class="petal p-left svelte-13i93z"></div> <div class="petal p-right svelte-13i93z"></div> <div class="center-dot svelte-13i93z"></div></div> <!></div>');function to(d,e){W(e,!1),he();var t=Fe(),a=pe(t);{var r=s=>{var o=eo(),n=h(p(o),2);{var c=v=>{var f=Ji(),x=pe(f),g=h(x,2),b=p(g),_=p(b);u(b),at(2),u(g),V(()=>{ae(x,`background-color: ${i.activeColor??""};`),ae(_,`background-color: ${i.activeColor??""};`)}),le(3,x,()=>Ee,()=>({duration:400})),le(1,g,()=>ka,()=>({y:-10,duration:400})),le(2,g,()=>Ee,()=>({duration:400})),E(v,f)};Q(n,v=>{i.isPicking&&v(c)})}u(o),le(3,o,()=>Ee,()=>({duration:800})),E(s,o)};Q(a,s=>{i.isCursorVisible&&s(r)})}E(d,t),Z()}var ao=et('<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline>'),ro=j('<div class="canvas-viewport relative grid h-full w-full grid-cols-[20px_1fr] grid-rows-[20px_1fr] overflow-hidden svelte-e4xfdd"><div class="z-[110] border-r border-b border-charcoal/10 bg-foam-white/90 backdrop-blur-md" aria-hidden="true"></div> <div class="relative z-[100] border-b border-charcoal/10"><!></div> <div class="relative z-[100] border-r border-charcoal/10"><!></div> <div class="relative flex flex-1 items-center justify-center overflow-hidden bg-charcoal/[0.02]"><div class="canvas-container absolute top-1/2 left-1/2 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] svelte-e4xfdd"><div class="relative h-full w-full shadow-[0_20px_60px_rgba(0,0,0,0.12)] ring-1 ring-charcoal/5" role="grid" tabindex="0"><!> <!> <canvas class="pointer-events-none absolute inset-0 h-full w-full" style="image-rendering: pixelated;"></canvas> <div class="pixel-grid-surface pointer-events-none absolute inset-0 z-10 h-full w-full"></div> <div class="pointer-events-none absolute inset-0 z-30 overflow-hidden"><div class="absolute transition-all duration-75 ease-out"><!></div></div> <svg class="pointer-events-none absolute inset-0 z-[20] h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg> <!></div></div></div></div>');function so(d,e){W(e,!0);let t=I(null),a=I(null),r=q(()=>i.canvas.width),s=q(()=>i.canvas.height),o=q(()=>{if(!i.showGhostLayers)return[];const P=i.project.activeFrameIndex,H=[];return P>0&&H.push({pixels:i.project.frames[P-1].compositePixels,opacity:.3}),P>1&&H.push({pixels:i.project.frames[P-2].compositePixels,opacity:.1}),H}),n=q(()=>je.isSnappedState),c=q(()=>i.canvas.strokePoints.map(P=>`${P.x},${P.y}`).join(" "));function v(P){if(P.ctrlKey){P.preventDefault();const H=P.deltaY>0?-.1:.1;i.studio.setZoom(H)}}Se(()=>{const P=l(a)?.getContext("2d",{alpha:!0}),H=i.canvas.compositePixels;if(!(!P||!l(a))){P.imageSmoothingEnabled=!1,P.clearRect(0,0,l(r),l(s));for(let J=0;J<H.length;J++){const G=H[J];if(G){const ee=J%l(r),re=Math.floor(J/l(r));P.fillStyle=G,P.fillRect(ee,re,1,1)}}}});var f=ro();de("pointermove",ta,P=>l(t)&&je.handleMove(P,l(t))),de("pointerup",ta,()=>je.handleEnd());var x=h(p(f),2),g=p(x);ca(g,{orientation:"horizontal"}),u(x);var b=h(x,2),_=p(b);ca(_,{orientation:"vertical"}),u(b);var k=h(b,2),m=p(k),A=p(m);A.__contextmenu=P=>P.preventDefault(),A.__pointerdown=P=>l(t)&&je.handleStart(P,l(t));var L=p(A);Ni(L,{});var $=h(L,2);{var R=P=>{var H=Fe(),J=pe(H);xe(J,17,()=>l(o),Ae,(G,ee)=>{Xi(G,{get pixels(){return l(ee).pixels},get width(){return l(r)},get height(){return l(s)},get opacity(){return l(ee).opacity}})}),E(P,H)};Q($,P=>{i.showGhostLayers&&P(R)})}var T=h($,2);He(T,P=>y(a,P),()=>l(a));var S=h(T,2),w=h(S,2),M=p(w),D=p(M);to(D,{}),u(M),u(w);var z=h(w,2),C=p(z);{var O=P=>{var H=ao();V(()=>{F(H,"points",l(c)),F(H,"stroke",i.paletteState.activeColor),F(H,"stroke-width",l(n)?"0.08":"0.03"),F(H,"stroke-dasharray",l(n)?"none":"0.1 0.1"),K(H,0,`${l(n)?"drop-shadow-md":"marching-ants"} transition-all duration-300`,"svelte-e4xfdd"),ae(H,`opacity: ${l(n)?"1":"0.4"}`)}),E(P,H)};Q(C,P=>{i.canvas.strokePoints.length>1&&P(O)})}u(z);var Y=h(z,2);Yi(Y,{}),u(A),He(A,P=>y(t,P),()=>l(t)),u(m),u(k),u(f),V(P=>{ae(m,`
				transform: ${i.cameraTransform??""};
				aspect-ratio: ${l(r)??""} / ${l(s)??""};
				width: ${P??""};
			`),ae(A,`
					background-color: ${i.backgroundColor??""};
					touch-action: none;
				`),F(T,"width",l(r)),F(T,"height",l(s)),ae(S,`--grid-cols: ${l(r)??""}; --grid-rows: ${l(s)??""};`),ae(M,`
							left: ${i.cursor.pos.x/l(r)*100}%; 
							top: ${i.cursor.pos.y/l(s)*100}%; 
							width: ${100/l(r)}%; 
							height: ${100/l(s)}%;
						`),F(z,"viewBox",`0 0 ${l(r)??""} ${l(s)??""}`)},[()=>i.canvas.getFitDimension("horizontal")]),de("wheel",f,v),E(d,f),Z()}ve(["contextmenu","pointerdown"]);class io{#e=I(!0);get isEnabled(){return l(this.#e)}set isEnabled(e){y(this.#e,e,!0)}#t=I(!1);get screenShake(){return l(this.#t)}set screenShake(e){y(this.#t,e,!0)}#a=I(null);get flashColor(){return l(this.#a)}set flashColor(e){y(this.#a,e,!0)}emit(e){this.isEnabled&&(this.playAudio(e),this.triggerVisual(e),typeof navigator.vibrate=="function"&&this.triggerHaptic(e))}playAudio(e){switch(e){case"DRAW":U.playDraw();break;case"ERASE":U.playErase();break;case"MOVE":U.playMove();break;case"STARTUP":U.playStartup();break;case"READY":U.playReady();break}}triggerVisual(e){e==="CLEAR_CANVAS"&&(this.screenShake=!0,setTimeout(()=>this.screenShake=!1,200)),e==="READY"&&(this.flashColor="rgba(211, 54, 130, 0.1)",setTimeout(()=>this.flashColor=null,500))}triggerHaptic(e){e==="DRAW"&&navigator.vibrate(5),e==="ERASE"&&navigator.vibrate(10)}}const da=new io;function Ot(d){return--d*d*d*d*d+1}const oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var no=j(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-canvas-bg" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');" role="dialog" aria-modal="true"><div class="absolute h-[500px] w-[500px] animate-pulse rounded-full bg-charcoal/5 blur-[120px]" aria-hidden="true"></div> <div class="relative flex flex-col items-center gap-2"><div class="mb-8 flex animate-bounce items-center justify-center"><img alt="Rupa CafÃ© Logo" class="h-32 w-auto drop-shadow-2xl transition-transform duration-[3s] ease-in-out"/></div> <div><!></div></div> <div class="absolute bottom-24 flex flex-col items-center gap-8"><div class="flex flex-col items-center gap-4"><div class="h-1 w-48 overflow-hidden rounded-full bg-charcoal/5 ring-1 ring-charcoal/10" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div></div></div> <div class="flex flex-col items-center gap-1 text-center"><span class="h-4 font-serif text-[11px] tracking-wide text-charcoal/60 italic"> </span> <span class="font-mono text-[8px] font-bold tracking-[0.3em] text-charcoal/20 uppercase"> </span></div></div></div></div>`);function lo(d,e){W(e,!0);let t=I(!0),a=I(0),r=I(0),s=I(!1);const o=5;function n(){da.emit("READY"),y(t,!1),setTimeout(()=>{i.isAppReady=!0,i.showGuideBook=!0},800)}tt(()=>{da.emit("STARTUP");const x=setInterval(()=>{if(l(a)<100){const g=Math.random()*15;y(a,Math.min(100,l(a)+g),!0),y(r,Math.min(o-1,Math.floor(l(a)/100*o)),!0)}else clearInterval(x),setTimeout(()=>{y(s,!0),n()},600)},400);return()=>{clearInterval(x)}});var c=Fe(),v=pe(c);{var f=x=>{var g=no();F(g,"aria-label",__({key:"manual.title"}));var b=h(p(g),2),_=p(b),k=p(_);ae(k,`transform: scale(${1+Math.sin(Date.now()/1500)*.05});`),u(_);var m=h(_,2),A=p(m);wa(A,{size:"lg"}),u(m),u(b);var L=h(b,2),$=p(L),R=p($),T=p(R);u(R);var S=h(R,2),w=p(S),M=p(w,!0);u(w);var D=h(w,2),z=p(D,!0);u(D),u(S),u($),u(L),u(g),V((C,O)=>{F(g,"aria-busy",!l(s)),F(k,"src",oo),F(R,"aria-valuenow",l(a)),K(T,1,`h-full bg-charcoal/20 transition-all duration-500 ease-out ${l(s)?"bg-brand/40":""}`),ae(T,`width: ${l(a)??""}%`),N(M,C),N(z,O)},[()=>l(s)?__({key:"splash.welcome"}):__({key:`splash.phases.${l(r)}`}),()=>__({key:"splash.version",replace:{version:i.version}})]),le(1,_,()=>xt,()=>({duration:1500,start:.9,easing:Ot})),le(1,m,()=>ka,()=>({y:15,duration:1e3,delay:400,easing:Ot})),le(2,g,()=>Ee,()=>({duration:1e3})),E(x,g)};Q(v,x=>{l(t)&&x(f)})}E(d,c),Z()}var co=j('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><span> </span> <span> </span></div> <input type="range"/></div>');function ut(d,e){W(e,!0);let t=ie(e,"value",15),a=ie(e,"min",3,0),r=ie(e,"step",3,1),s=ie(e,"unit",3,""),o=ie(e,"isHue",3,!1);var n=co(),c=p(n),v=p(c),f=p(v,!0);u(v);var x=h(v,2),g=p(x);u(x),u(c);var b=h(c,2);ge(b);let _;u(n),V(k=>{N(f,e.label),N(g,`${k??""}${s()??""}`),F(b,"min",a()),F(b,"max",e.max),F(b,"step",r()),_=K(b,1,"custom-slider svelte-6nviod",null,_,{"hue-slider":o()})},[()=>r()<1?t().toFixed(2):Math.round(t())]),be(b,t),E(d,n),Z()}var uo=j('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="presentation"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-canvas-bg p-10 shadow-2xl" role="dialog" aria-labelledby="flavor-basin-title" aria-modal="true"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl" aria-hidden="true">Fountain</span> <div class="flex flex-col"><h2 id="flavor-basin-title" class="font-tiny5 text-3xl leading-none text-brand"></h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/40 uppercase"></span></div></div> <div class="editor-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner" aria-label="Color Preview"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><label for="hex-input" class="font-mono text-xs font-bold text-studio-text/40"></label> <input id="hex-input" type="text" class="w-full bg-transparent font-mono text-lg font-bold text-studio-text uppercase focus:outline-none"/></div> <div class="flex gap-3"><button class="editor-secondary-btn flex h-14 w-14 items-center justify-center p-0 text-xl"><span aria-hidden="true">ðï¸</span></button> <button class="editor-primary-btn flex-1 py-4"></button></div></div></div></div>');function Nt(d,e){W(e,!0);let t=ie(e,"value",15),a=I(0),r=I(0),s=I(0),o=I(1);Se(()=>{const C=ft.toHSLA(t());Oe(()=>{y(a,C.h,!0),y(r,C.s,!0),y(s,C.l,!0),y(o,C.a,!0)})}),Se(()=>{const C=ft.toHex({h:l(a),s:l(r),l:l(s),a:l(o)});Oe(()=>{t(C)})});var n=uo();n.__mousedown=C=>C.target===C.currentTarget&&e.onClose();var c=p(n),v=p(c),f=p(v),x=h(p(f),2),g=p(x);g.textContent=__({key:"color_picker.title"});var b=h(g,2);b.textContent=__({key:"color_picker.subtitle"}),u(x),u(f);var _=h(f,2);u(v);var k=h(v,2),m=p(k);ut(m,{label:__({key:"color_picker.sliders.hue"}),max:360,unit:"Â°",isHue:!0,get value(){return l(a)},set value(C){y(a,C,!0)}});var A=h(m,2);ut(A,{label:__({key:"color_picker.sliders.saturation"}),max:100,unit:"%",get value(){return l(r)},set value(C){y(r,C,!0)}});var L=h(A,2);ut(L,{label:__({key:"color_picker.sliders.lightness"}),max:100,unit:"%",get value(){return l(s)},set value(C){y(s,C,!0)}});var $=h(L,2);ut($,{label:__({key:"color_picker.sliders.alpha"}),min:0,max:1,step:.01,unit:"",get value(){return l(o)},set value(C){y(o,C,!0)}}),u(k);var R=h(k,2),T=p(R),S=p(T);S.textContent=__({key:"color_picker.hex_label"});var w=h(S,2);ge(w),u(T);var M=h(T,2),D=p(M);D.__click=()=>{B.pickColor(),e.onClose()},F(D,"title",__({key:"color_picker.eye_drop"})),F(D,"aria-label",__({key:"color_picker.eye_drop"}));var z=h(D,2);z.__click=function(...C){e.onClose?.apply(this,C)},z.textContent=__({key:"color_picker.seal"}),u(M),u(R),u(c),u(n),V(()=>ae(_,`background-color: ${t()??""};`)),be(w,t),le(1,c,()=>xt,()=>({duration:200,start:.95})),le(2,c,()=>xt,()=>({duration:150,start:1,opacity:0})),le(3,n,()=>Ee,()=>({duration:150})),E(d,n),Z()}ve(["mousedown","click"]);var vo=j("<span> </span>"),po=j('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function ho(d,e){W(e,!0);var t=po();t.__click=()=>{e.action.action(),e.onSelect()};var a=p(t),r=p(a,!0);u(a);var s=h(a,2);{var o=n=>{var c=vo(),v=p(c,!0);u(c),V(()=>{K(c,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),N(v,e.action.shortcut)}),E(n,c)};Q(s,n=>{e.action.shortcut&&n(o)})}u(t),V(()=>{K(t,1,`editor-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),N(r,e.action.label)}),de("mouseenter",t,function(...n){e.onSelect?.apply(this,n)}),E(d,t),Z()}ve(["click"]);var fo=j('<div class="p-8 text-center font-serif text-sm text-studio-text/40 italic"> </div>'),xo=j('<div class="flex flex-col gap-1"></div>'),go=j('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="presentation"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/95 shadow-2xl" role="dialog" aria-labelledby="palette-title" aria-modal="true"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40" aria-hidden="true">ð</span> <h2 id="palette-title" class="sr-only"></h2> <input id="palette-search" type="text" class="w-full bg-transparent font-serif text-xl text-studio-text focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-h74ewr" role="list"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"></span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div></div>');function bo(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.showCommandPalette=!1),a=I(""),r=I(0);const o=Ce.getActions().map(S=>({...S,id:S.intent.toLowerCase().replace(/_/g,"-"),action:()=>{ga(async()=>{const{editor:w}=await Promise.resolve().then(()=>Ss);return{editor:w}},void 0,import.meta.url).then(({editor:w})=>{w.handleIntent(S.intent)})}}));let n=q(()=>o.filter(S=>S.label.toLowerCase().includes(l(a).toLowerCase())));Se(()=>{l(a),y(r,0)}),Se(()=>{l(r),l(n);const S=document.querySelector(".editor-action-btn.active");S&&S.scrollIntoView({block:"nearest"})});function c(S){S.key==="ArrowDown"?(S.preventDefault(),y(r,(l(r)+1)%l(n).length)):S.key==="ArrowUp"?(S.preventDefault(),y(r,(l(r)-1+l(n).length)%l(n).length)):S.key==="Enter"?(S.preventDefault(),l(n)[l(r)]&&(l(n)[l(r)].action(),t()())):S.key==="Escape"&&t()()}tt(()=>document.getElementById("palette-search")?.focus());var v=go();v.__mousedown=S=>S.target===S.currentTarget&&t()(),v.__keydown=c;var f=p(v),x=p(f),g=h(p(x),2);g.textContent=__({key:"hud.menu.catalog_title"});var b=h(g,2);ge(b),F(b,"placeholder",__({key:"hud.menu.catalog_search"})),u(x);var _=h(x,2),k=p(_);{var m=S=>{var w=fo(),M=p(w,!0);u(w),V(D=>N(M,D),[()=>__({key:"hud.menu.catalog_no_results",replace:{query:l(a)}})]),E(S,w)},A=S=>{var w=xo();xe(w,21,()=>l(n),Ae,(M,D,z)=>{{let C=q(()=>l(r)===z);ho(M,{get action(){return l(D)},get isSelected(){return l(C)},onSelect:()=>y(r,z,!0)})}}),u(w),E(S,w)};Q(k,S=>{l(n).length===0?S(m):S(A,!1)})}u(_);var L=h(_,2),$=p(L);$.textContent=__({key:"hud.menu.catalog_footer"});var R=h($,2),T=p(R,!0);u(R),u(L),u(f),u(v),V(S=>N(T,S),[()=>__({key:"hud.menu.catalog_count",replace:{count:l(n).length}})]),be(b,()=>l(a),S=>y(a,S)),le(3,f,()=>xt,()=>({duration:150,start:.98})),E(d,v),Z()}ve(["mousedown","keydown"]);var mo=j('<span class="text-2xl opacity-40"> </span>'),yo=j('<span class="mt-1 font-serif text-[9px] font-black tracking-[0.2em] text-charcoal/30 uppercase"> </span>'),_o=j('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-charcoal/20 backdrop-blur-md"><div class="flex flex-col gap-6 overflow-hidden rounded-xl border border-charcoal/10 bg-foam-white p-8 shadow-2xl" role="dialog" aria-modal="true" tabindex="-1"><div class="flex items-center justify-between border-b border-charcoal/5 pb-4"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-2xl leading-none text-charcoal"> </h2> <!></div></div> <button class="rounded-lg border border-charcoal/10 bg-stone-light/50 px-4 py-1.5 text-[9px] font-bold tracking-widest text-charcoal/40 uppercase transition-all hover:border-brand hover:bg-brand hover:text-white">Close</button></div> <div><!></div></div></div>');function ze(d,e){W(e,!0);let t=ie(e,"title",3,""),a=ie(e,"subtitle",3,""),r=ie(e,"icon",3,""),s=ie(e,"width",3,"500px"),o=ie(e,"maxHeight",3,"85vh"),n=ie(e,"scrollable",3,!0);Se(()=>(i.pushEscapeAction(e.onClose),()=>i.popEscapeAction(e.onClose)));function c(w,{duration:M=300}){return{duration:M,css:D=>{const z=Ot(D);return`
					opacity: ${D};
					transform: scale(${.95+z*.05});
				`}}}var v=_o();v.__mousedown=w=>{w.stopPropagation(),w.target===w.currentTarget&&e.onClose()};var f=p(v);f.__mousedown=w=>w.stopPropagation();var x=p(f),g=p(x),b=p(g);{var _=w=>{var M=mo(),D=p(M,!0);u(M),V(()=>N(D,r())),E(w,M)};Q(b,w=>{r()&&w(_)})}var k=h(b,2),m=p(k),A=p(m,!0);u(m);var L=h(m,2);{var $=w=>{var M=yo(),D=p(M,!0);u(M),V(()=>N(D,a())),E(w,M)};Q(L,w=>{a()&&w($)})}u(k),u(g);var R=h(g,2);R.__click=function(...w){e.onClose?.apply(this,w)},u(x);var T=h(x,2),S=p(T);gr(S,()=>e.children),u(T),u(f),u(v),V(()=>{ae(f,`width: ${s()??""}; max-height: ${o()??""};`),N(A,t()),K(T,1,`custom-scrollbar flex-1 ${n()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),le(1,f,()=>c,()=>({duration:300})),le(2,f,()=>Ee,()=>({duration:150})),le(3,v,()=>Ee,()=>({duration:150})),E(d,v),Z()}ve(["mousedown","click"]);var Ao=j('<div class="flex flex-col items-center gap-3"><div class="editor-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function wo(d,e){W(e,!0);let t=I(null);Se(()=>{if(!l(t))return;const x=l(t).getContext("2d");if(!x)return;const g=i.canvas.width,b=i.canvas.height,_=i.canvas.compositePixels,k=i.studio.includePixelBorders,m=400,A=Math.min(m/g,m/b);l(t).width=g*A,l(t).height=b*A,x.imageSmoothingEnabled=!1,e.bgColor==="transparent"?x.clearRect(0,0,l(t).width,l(t).height):(x.fillStyle=e.bgColor,x.fillRect(0,0,l(t).width,l(t).height)),_.forEach((L,$)=>{if(L===null)return;const R=$%g,T=Math.floor($/g),S=Math.floor(R*A),w=Math.floor(T*A),M=Math.ceil(A),D=Math.ceil(A);x.fillStyle=L,x.fillRect(S,w,M,D),k&&(x.strokeStyle="rgba(0, 0, 0, 0.15)",x.lineWidth=1,x.strokeRect(S+.5,w+.5,M-1,D-1))})});var a=Ao(),r=p(a),s=p(r);He(s,x=>y(t,x),()=>l(t)),u(r);var o=h(r,2),n=p(o),c=p(n);u(n);var v=h(n,2),f=p(v);u(v),u(o),u(a),V((x,g)=>{N(c,`${e.format??""} Artifact`),N(f,`${x??""} Ã ${g??""} pixels`)},[()=>Math.round(i.canvas.width*e.scale),()=>Math.round(i.canvas.height*e.scale)]),E(d,a),Z()}var ko=j('<span class="font-serif text-[9px] font-bold text-brand italic opacity-60"></span>'),Co=j('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="fps-input" type="number" min="1" max="60" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div>',1),So=j('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span aria-hidden="true">ð¨</span> </button>'),Eo=j('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5" role="img" aria-label="Art Preview"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-8 overflow-y-auto pr-4" role="group" aria-label="Export Settings"><div class="flex flex-col gap-3"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"></span> <div class="grid grid-cols-2 gap-3" role="radiogroup" aria-label="Static Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">ð¼ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð¸ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð·</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button></div></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"></span> <!></div> <div role="radiogroup" aria-label="Animated Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">ð¬</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð½ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button></div></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="scale-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="scale-input" type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <!> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-charcoal/60 uppercase">Pixel Borders</span> <span class="font-serif text-[10px] text-charcoal/40">Include grid lines on colored drops</span></div> <button aria-label="Toggle Pixel Borders"><div></div></button></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></span> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <div class="flex flex-wrap items-center gap-3" role="radiogroup" aria-label="Background Type"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" title="Transparent" role="radio"></button> <button title="Cream" role="radio"></button> <button title="Black" role="radio"></button> <div class="flex items-center gap-2"><button title="Custom Backdrop" role="radio"></button></div></div> <!></div></div> <button class="editor-primary-btn w-full py-5 text-xl"></button></div></div>'),Lo=j("<!> <!>",1);function Io(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.showExportMenu=!1),a=I("png"),r=I(!1),s=I(ue(i.backgroundColor));tt(()=>{i.backgroundColor!=="#eee8d5"&&(i.studio.exportBgColor=i.backgroundColor,y(s,i.backgroundColor,!0))}),Se(()=>{i.studio.exportBgColor!=="transparent"&&i.studio.exportBgColor!=="#eee8d5"&&i.studio.exportBgColor!=="#000000"&&(i.studio.exportBgColor=l(s))}),Se(()=>{const f=["webm","gif","mp4"].includes(l(a))||l(a)==="svg"&&i.project.frames.length>1;i.project.frames.length<=1&&f&&y(a,"png")});var o=Lo(),n=pe(o);{var c=f=>{Nt(f,{onClose:()=>y(r,!1),get value(){return l(s)},set value(x){y(s,x,!0)}})};Q(n,f=>{l(r)&&f(c)})}var v=h(n,2);ze(v,{title:__({key:"export.title"}),subtitle:__({key:"export.subtitle"}),icon:"ð§º",get onClose(){return t()},width:"1000px",scrollable:!1,children:(f,x)=>{var g=Eo(),b=p(g),_=p(b);wo(_,{get format(){return l(a)},get scale(){return i.studio.exportScale},get bgColor(){return i.studio.exportBgColor}}),u(b);var k=h(b,2),m=p(k),A=p(m);A.textContent=__({key:"export.static_title"});var L=h(A,2),$=p(L);$.__click=()=>y(a,"png");var R=h(p($),2),T=p(R);T.textContent=__({key:"export.formats.png"}),u(R),u($);var S=h($,2);S.__click=()=>y(a,"webp");var w=h(p(S),2),M=p(w);M.textContent=__({key:"export.formats.webp"}),u(w),u(S);var D=h(S,2);D.__click=()=>y(a,"jpg");var z=h(p(D),2),C=p(z);C.textContent=__({key:"export.formats.jpg"}),u(z),u(D);var O=h(D,2);O.__click=()=>y(a,"svg");var Y=h(p(O),2),P=p(Y);P.textContent=__({key:"export.formats.svg_static"}),u(Y),u(O),u(L),u(m);var H=h(m,2),J=p(H),G=p(J);G.textContent=__({key:"export.kinetic_title"});var ee=h(G,2);{var re=_e=>{var Ie=ko();Ie.textContent=__({key:"export.requires_frames"}),E(_e,Ie)};Q(ee,_e=>{i.project.frames.length<=1&&_e(re)})}u(J);var ce=h(J,2),se=p(ce);se.__click=()=>y(a,"webm");var oe=h(p(se),2),Le=p(oe);Le.textContent=__({key:"export.formats.webm"}),u(oe),u(se);var we=h(se,2);we.__click=()=>y(a,"gif");var Ge=h(p(we),2),Ve=p(Ge);Ve.textContent=__({key:"export.formats.gif"}),u(Ge),u(we);var ne=h(we,2);ne.__click=()=>y(a,"mp4");var Ke=h(p(ne),2),bt=p(Ke);bt.textContent=__({key:"export.formats.mp4"}),u(Ke),u(ne);var Te=h(ne,2);Te.__click=()=>y(a,"svg");var Ne=h(p(Te),2),rt=p(Ne);rt.textContent=__({key:"export.formats.svg_kinetic"}),u(Ne),u(Te),u(ce),u(H);var qe=h(H,2),mt=p(qe),yt=p(mt),Ut=p(yt);Ut.textContent=__({key:"export.scale_label"});var Ca=h(Ut,2);Ca.textContent=__({key:"export.scale_desc"}),u(yt);var Ht=h(yt,2);ge(Ht),u(mt);var Kt=h(mt,2);{var Sa=_e=>{var Ie=Co(),ct=h(pe(Ie),2),kt=p(ct),Wt=p(kt);Wt.textContent=__({key:"export.fps_label"});var Pa=h(Wt,2);Pa.textContent=__({key:"export.fps_desc"}),u(kt);var Zt=h(kt,2);ge(Zt),u(ct),be(Zt,()=>i.studio.fps,Ma=>i.studio.fps=Ma),E(_e,Ie)};Q(Kt,_e=>{(l(a)==="webm"||l(a)==="gif"||l(a)==="mp4"||l(a)==="svg"&&i.project.frames.length>1)&&_e(Sa)})}var _t=h(Kt,4),st=h(p(_t),2);st.__click=()=>i.studio.includePixelBorders=!i.studio.includePixelBorders;var Ea=p(st);u(st),u(_t);var qt=h(_t,4),At=p(qt),Yt=p(At);Yt.textContent=__({key:"export.bg_label"});var La=h(Yt,2);La.textContent=__({key:"export.bg_desc"}),u(At);var wt=h(At,2),it=p(wt);it.__click=()=>i.studio.exportBgColor="transparent";var ot=h(it,2);ot.__click=()=>i.studio.exportBgColor="#eee8d5";var nt=h(ot,2);nt.__click=()=>i.studio.exportBgColor="#000000";var Qt=h(nt,2),lt=p(Qt);lt.__click=()=>{i.studio.exportBgColor=l(s),y(r,!0)},u(Qt),u(wt);var Ia=h(wt,2);{var Ta=_e=>{var Ie=So();Ie.__click=()=>{y(s,i.backgroundColor,!0),i.studio.exportBgColor=l(s)};var ct=h(p(Ie));ct.nodeValue=` ${__({key:"export.match_background"})??""}`,u(Ie),E(_e,Ie)};Q(Ia,_e=>{i.backgroundColor!=="#eee8d5"&&_e(Ta)})}u(qt),u(qe);var Xt=h(qe,2);Xt.__click=()=>e.onExport(l(a),i.studio.exportScale,i.studio.exportBgColor),Xt.textContent=__({key:"export.action"}),u(k),u(g),V(()=>{K($,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F($,"aria-checked",l(a)==="png"),K(S,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="webp"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F(S,"aria-checked",l(a)==="webp"),K(D,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="jpg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F(D,"aria-checked",l(a)==="jpg"),K(O,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="svg"&&i.project.frames.length<=1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),F(O,"aria-checked",l(a)==="svg"&&i.project.frames.length<=1),K(ce,1,`grid grid-cols-2 gap-3 ${i.project.frames.length<=1?"opacity-40":""}`),K(se,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="webm"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${i.project.frames.length<=1?"pointer-events-none opacity-20":""}`),se.disabled=i.project.frames.length<=1,F(se,"aria-checked",l(a)==="webm"),K(we,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="gif"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${i.project.frames.length<=1?"pointer-events-none opacity-20":""}`),we.disabled=i.project.frames.length<=1,F(we,"aria-checked",l(a)==="gif"),K(ne,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="mp4"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${i.project.frames.length<=1?"pointer-events-none opacity-20":""}`),ne.disabled=i.project.frames.length<=1,F(ne,"aria-checked",l(a)==="mp4"),K(Te,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${l(a)==="svg"&&i.project.frames.length>1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${i.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Te.disabled=i.project.frames.length<=1,F(Te,"aria-checked",l(a)==="svg"&&i.project.frames.length>1),K(st,1,`flex h-6 w-12 items-center rounded-full transition-colors ${i.studio.includePixelBorders?"bg-brand":"bg-charcoal/10"}`),K(Ea,1,`h-4 w-4 rounded-full bg-white shadow-sm transition-transform ${i.studio.includePixelBorders?"translate-x-7":"translate-x-1"}`),K(it,1,`h-10 w-10 rounded-xl border-2 ${i.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),F(it,"aria-checked",i.studio.exportBgColor==="transparent"),K(ot,1,`h-10 w-10 rounded-xl border-2 ${i.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),F(ot,"aria-checked",i.studio.exportBgColor==="#eee8d5"),K(nt,1,`h-10 w-10 rounded-xl border-2 ${i.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),F(nt,"aria-checked",i.studio.exportBgColor==="#000000"),K(lt,1,`h-10 w-16 rounded-xl border-2 ${i.studio.exportBgColor===l(s)?"border-brand":"border-black/5"} editor-checker-small transition-transform hover:scale-105`),ae(lt,`background-color: ${l(s)??""};`),F(lt,"aria-checked",i.studio.exportBgColor===l(s))}),be(Ht,()=>i.studio.exportScale,_e=>i.studio.exportScale=_e),E(f,g)},$$slots:{default:!0}}),E(d,o),Z()}ve(["click"]);var To=j('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function Po(d,e){W(e,!0);var t=To(),a=p(t),r=p(a,!0);u(a);var s=h(a,2),o=p(s,!0);u(s),u(t),V(n=>{N(r,e.label),N(o,n)},[()=>e.customKey||Ce.getLabel(e.intent)]),E(d,t),Z()}var Mo=j('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function jo(d,e){W(e,!0);var t=Mo(),a=p(t),r=p(a,!0);u(a);var s=h(a,2);xe(s,21,()=>e.group.items,Ae,(o,n)=>{Po(o,{get intent(){return l(n).intent},get label(){return l(n).label},get customKey(){return l(n).customKey}})}),u(s),u(t),V(()=>N(r,e.group.group)),E(d,t),Z()}var Fo=j('<div class="flex flex-col gap-12" role="document"><header class="flex flex-col gap-2 rounded-xl bg-charcoal/5 p-6 ring-1 ring-charcoal/10" aria-labelledby="guide-header-title"><h3 id="guide-header-title" class="font-tiny5 text-xl text-charcoal uppercase"></h3> <p class="font-serif text-xs leading-relaxed text-charcoal/60"></p></header> <div class="grid grid-cols-2 gap-x-16 gap-y-12"></div> <footer class="mt-4 border-t border-charcoal/5 pt-8 text-center"><p class="font-serif text-[11px] text-charcoal/40 italic"></p></footer></div>');function Ro(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.showGuideMenu=!1);const a=q(()=>Ce.getGroupedActions());ze(d,{title:__({key:"shortcuts.title"}),subtitle:__({key:"shortcuts.subtitle"}),icon:"â",get onClose(){return t()},width:"1000px",children:(r,s)=>{var o=Fo(),n=p(o),c=p(n);c.textContent=__({key:"shortcuts.header_title"});var v=h(c,2);v.textContent=__({key:"shortcuts.header_desc"}),u(n);var f=h(n,2);xe(f,21,()=>l(a),Ae,(b,_)=>{jo(b,{get group(){return l(_)}})}),u(f);var x=h(f,2),g=p(x);g.textContent=`"${__({key:"shortcuts.footer_quote"})??""}"`,u(x),u(o),E(r,o)},$$slots:{default:!0}}),Z()}var Bo=j(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Recipe Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your art as a dedicated recipe file on your machine or in your browser's local store.</p></div> <div class="flex flex-col gap-3"><button class="editor-primary-btn w-full">Store Recipe to File</button> <button class="editor-secondary-btn w-full">Load Recipe from File</button></div></div>`);function $o(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.showPersistenceMenu=!1);ze(d,{title:"Recipe Store",subtitle:"Managing Digital Creations",icon:"ð¾",get onClose(){return t()},width:"400px",children:(a,r)=>{var s=Bo(),o=h(p(s),2),n=p(o);n.__click=()=>{B.persistence.save(),t()()};var c=h(n,2);c.__click=()=>{B.persistence.load(),t()()},u(o),u(s),E(a,s)},$$slots:{default:!0}}),Z()}ve(["click"]);var Oo=j('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="stab-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <span class="font-mono text-sm font-bold text-brand"> </span></div> <input id="stab-input" type="range" min="0" max="100" class="h-1.5 w-full cursor-pointer appearance-none rounded-lg bg-black/5 accent-brand"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="fps-input" type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></span> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <button class="group relative flex items-center gap-3" aria-label="Change Backdrop Color"><div class="editor-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">ð¨</div></button></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"></p></div> <button class="editor-primary-btn w-full py-4 text-lg"></button></div>'),Do=j("<!> <!>",1);function Vo(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.showCanvasSettings=!1),a=I(ue(i.canvas.width)),r=I(ue(i.canvas.height)),s=I(!1);function o(){B.manipulation.resize(l(a),l(r)),t()()}var n=Do(),c=pe(n);{var v=x=>{Nt(x,{onClose:()=>y(s,!1),get value(){return i.backgroundColor},set value(g){i.backgroundColor=g}})};Q(c,x=>{l(s)&&x(v)})}var f=h(c,2);ze(f,{title:__({key:"settings.title"}),subtitle:__({key:"settings.subtitle"}),icon:"ð",get onClose(){return t()},width:"450px",children:(x,g)=>{var b=Oo(),_=p(b),k=p(_),m=p(k),A=p(m);A.textContent=__({key:"settings.width"});var L=h(A,2);ge(L),u(m);var $=h(m,2),R=p($);R.textContent=__({key:"settings.height"});var T=h(R,2);ge(T),u($),u(k);var S=h(k,4),w=p(S),M=p(w),D=p(M);D.textContent=__({key:"settings.stabilization"});var z=h(D,2);z.textContent=__({key:"settings.stabilization_desc"}),u(M);var C=h(M,2),O=p(C);u(C),u(w);var Y=h(w,2);ge(Y),u(S);var P=h(S,4),H=p(P),J=p(H);J.textContent=__({key:"settings.weave_pace"});var G=h(J,2);G.textContent=__({key:"settings.fps_desc"}),u(H);var ee=h(H,2);ge(ee),u(P);var re=h(P,4),ce=p(re),se=p(ce);se.textContent=__({key:"settings.backdrop"});var oe=h(se,2);oe.textContent=__({key:"settings.backdrop_desc"}),u(ce);var Le=h(ce,2);Le.__click=()=>y(s,!0);var we=p(Le);at(2),u(Le),u(re);var Ge=h(re,2);Ge.textContent=__({key:"settings.note"}),u(_);var Ve=h(_,2);Ve.__click=o,Ve.textContent=__({key:"settings.apply"}),u(b),V(()=>{N(O,`${i.studio.stabilization??""}%`),ae(we,`background-color: ${i.backgroundColor??""};`)}),be(L,()=>l(a),ne=>y(a,ne)),be(T,()=>l(r),ne=>y(r,ne)),be(Y,()=>i.studio.stabilization,ne=>i.studio.stabilization=ne),be(ee,()=>i.studio.fps,ne=>i.studio.fps=ne),E(x,b)},$$slots:{default:!0}}),E(d,n),Z()}ve(["click"]);var zo=j('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="editor-primary-btn w-full py-4 text-lg"></button></div>');function Go(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.studio.showGoTo=!1),a=I(ue(i.displayCoords.x)),r=I(ue(i.displayCoords.y));function s(){B.jumpTo(l(a),l(r)),t()()}function o(n){n.key==="Enter"&&s()}tt(()=>{document.getElementById("goto-x")?.focus()}),ze(d,{title:__({key:"goto.title"}),subtitle:__({key:"goto.subtitle"}),icon:"ð",get onClose(){return t()},width:"400px",children:(n,c)=>{var v=zo(),f=p(v),x=p(f),g=p(x),b=p(g);b.textContent=__({key:"goto.label_x"});var _=h(b,2);ge(_),_.__keydown=o,u(g);var k=h(g,2),m=p(k);m.textContent=__({key:"goto.label_y"});var A=h(m,2);ge(A),A.__keydown=o,u(k),u(x);var L=h(x,2),$=p(L,!0);u(L),u(f);var R=h(f,2);R.__click=s,R.textContent=__({key:"goto.action"}),u(v),V(T=>N($,T),[()=>__({key:"goto.current",replace:{x:i.displayCoords.x,y:i.displayCoords.y}})]),be(_,()=>l(a),T=>y(a,T)),be(A,()=>l(r),T=>y(r,T)),E(n,v)},$$slots:{default:!0}}),Z()}ve(["keydown","click"]);var No=j('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all cafÃ© resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Sound Effects (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Ambiance Flow</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="editor-primary-btn w-full py-4">Apply Settings</button></div>');function Uo(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.showAudioSettings=!1);ze(d,{title:"Audio Settings",subtitle:"Harmony & Ambiance Tuning",icon:"ð",get onClose(){return t()},width:"450px",children:(a,r)=>{var s=No(),o=p(s),n=h(p(o),2);n.__click=()=>i.toggleMute();var c=p(n,!0);u(n),u(o);var v=h(o,2),f=p(v),x=p(f),g=h(p(x),2),b=p(g);u(g),u(x);var _=h(x,2);ge(_),u(f);var k=h(f,2),m=p(k),A=h(p(m),2),L=p(A);u(A),u(m);var $=h(m,2);ge($),u(k),u(v);var R=h(v,2),T=h(p(R),2),S=p(T),w=h(p(S),2),M=p(w);u(w),u(S);var D=h(S,2),z=p(D);{var C=P=>{var H=Ze(`The piano awaits in silence. It will begin to play its melody after 30 minutes of
						creativity.`);E(P,H)},O=P=>{var H=Ze("The piano has begun its flow. Volume will reach full depth at 60 minutes.");E(P,H)};Q(z,P=>{i.usageMinutes<30?P(C):P(O,!1)})}u(D),u(T),u(R);var Y=h(R,2);Y.__click=function(...P){t()?.apply(this,P)},u(s),V((P,H)=>{K(n,1,`editor-secondary-btn !px-6 !py-2 ${i.isMuted?"bg-brand text-white":""}`),N(c,i.isMuted?"ð Muted":"ð Active"),N(b,`${P??""}%`),N(L,`${H??""}%`),N(M,`${i.usageMinutes??""} minutes`)},[()=>Math.round(i.sfxVolume*100),()=>Math.round(i.bgmVolume*100)]),be(_,()=>i.sfxVolume,P=>i.sfxVolume=P),be($,()=>i.bgmVolume,P=>i.bgmVolume=P),E(a,s)},$$slots:{default:!0}}),Z()}ve(["click"]);var Ho=j('<div class="flex flex-col gap-12" role="document"><section class="flex flex-col gap-6" aria-labelledby="philosophy-title"><div class="flex items-center gap-4 border-b border-black/5 pb-4"><span class="text-3xl" aria-hidden="true">ð¯ï¸</span> <h3 id="philosophy-title" class="font-tiny5 text-3xl tracking-tighter text-brand uppercase"></h3></div> <div class="space-y-4 font-serif text-base leading-relaxed text-studio-text/80"><p></p> <p></p> <p class="text-brand/60 italic"></p></div></section> <div class="grid grid-cols-3 gap-6" role="list"><div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">â</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ð§ª</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ð¥</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div></div> <section class="flex flex-col gap-8 rounded-3xl bg-brand/5 p-10 ring-1 ring-brand/10" aria-labelledby="techniques-title"><h3 id="techniques-title" class="font-tiny5 text-2xl tracking-tighter text-brand uppercase"></h3> <div class="grid grid-cols-2 gap-x-12 gap-y-8"><div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ð¥</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ðª</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">â³</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ð¹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div></div></section> <footer class="flex flex-col items-center gap-6 border-t border-black/5 pt-10 text-center"><div class="flex flex-col items-center gap-2"><p class="font-serif text-sm text-studio-text/50 italic"></p> <span class="font-tiny5 text-[10px] tracking-[0.3em] text-studio-text/30 uppercase"></span></div> <div class="flex items-center gap-4"><button class="editor-secondary-btn px-10 py-4"></button> <button class="editor-primary-btn px-16 py-4 text-xl"></button></div></footer></div>');function Ko(d,e){W(e,!0);let t=ie(e,"onClose",3,()=>i.showGuideBook=!1);ze(d,{title:__({key:"manual.title"}),subtitle:__({key:"manual.subtitle"}),icon:"ð",get onClose(){return t()},width:"850px",children:(a,r)=>{var s=Ho(),o=p(s),n=p(o),c=h(p(n),2);c.textContent=__({key:"manual.philosophy.title"}),u(n);var v=h(n,2),f=p(v);f.textContent=__({key:"manual.philosophy.p1"});var x=h(f,2);x.textContent=__({key:"manual.philosophy.p2"});var g=h(x,2);g.textContent=__({key:"manual.philosophy.p3"}),u(v),u(o);var b=h(o,2),_=p(b),k=h(p(_),2);k.textContent=__({key:"manual.pillars.cursor.title"});var m=h(k,2);m.textContent=__({key:"manual.pillars.cursor.desc"}),u(_);var A=h(_,2),L=h(p(A),2);L.textContent=__({key:"manual.pillars.colors.title"});var $=h(L,2);$.textContent=__({key:"manual.pillars.colors.desc"}),u(A);var R=h(A,2),T=h(p(R),2);T.textContent=__({key:"manual.pillars.layers.title"});var S=h(T,2);S.textContent=__({key:"manual.pillars.layers.desc"}),u(R),u(b);var w=h(b,2),M=p(w);M.textContent=__({key:"manual.techniques.title"});var D=h(M,2),z=p(D),C=h(p(z),2),O=p(C);O.textContent=__({key:"manual.techniques.continuous.title"});var Y=h(O,2);Y.textContent=__({key:"manual.techniques.continuous.desc"}),u(C),u(z);var P=h(z,2),H=h(p(P),2),J=p(H);J.textContent=__({key:"manual.techniques.magic_select.title"});var G=h(J,2);G.textContent=__({key:"manual.techniques.magic_select.desc"}),u(H),u(P);var ee=h(P,2),re=h(p(ee),2),ce=p(re);ce.textContent=__({key:"manual.techniques.timeline.title"});var se=h(ce,2);se.textContent=__({key:"manual.techniques.timeline.desc"}),u(re),u(ee);var oe=h(ee,2),Le=h(p(oe),2),we=p(Le);we.textContent=__({key:"manual.techniques.audio.title"});var Ge=h(we,2);Ge.textContent=__({key:"manual.techniques.audio.desc"}),u(Le),u(oe),u(D),u(w);var Ve=h(w,2),ne=p(Ve),Ke=p(ne);Ke.textContent=`"${__({key:"manual.footer.quote"})??""}"`;var bt=h(Ke,2);bt.textContent=__({key:"manual.footer.guild"}),u(ne);var Te=h(ne,2),Ne=p(Te);Ne.__click=()=>{t()(),i.showGuideMenu=!0},Ne.textContent=__({key:"manual.footer.all_shortcuts"});var rt=h(Ne,2);rt.__click=function(...qe){t()?.apply(this,qe)},rt.textContent=__({key:"manual.footer.enter"}),u(Te),u(Ve),u(s),E(a,s)},$$slots:{default:!0}}),Z()}ve(["click"]);var te=gt(()=>i),qo=j('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg selection:bg-brand/20"><!> <div class="flex flex-1 overflow-hidden"><aside class="flex w-64 flex-col overflow-hidden"><!></aside> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20 p-6"><div><!></div></main> <aside class="flex w-72 flex-col overflow-hidden"><!></aside></div> <!></div>',1);function an(d,e){W(e,!1),tt(()=>Aa.mount()),he();var t=qo(),a=pe(t);lo(a,{});var r=h(a,2);{var s=G=>{Ko(G,{onClose:()=>te(te().showGuideBook=!1)})};Q(r,G=>{te().showGuideBook&&G(s)})}var o=h(r,2);{var n=G=>{bo(G,{onClose:()=>te(te().showCommandPalette=!1)})};Q(o,G=>{te().showCommandPalette&&G(n)})}var c=h(o,2);{var v=G=>{Nt(G,{onClose:()=>te(te().showColorPicker=!1),get value(){return te().paletteState.activeColor},set value(ee){te(te().paletteState.activeColor=ee)},$$legacy:!0})};Q(c,G=>{te().showColorPicker&&G(v)})}var f=h(c,2);{var x=G=>{Io(G,{onExport:(ee,re,ce)=>B.createArtifact(ee,re,ce),onClose:()=>te(te().showExportMenu=!1)})};Q(f,G=>{te().showExportMenu&&G(x)})}var g=h(f,2);{var b=G=>{$o(G,{onClose:()=>te(te().showPersistenceMenu=!1)})};Q(g,G=>{te().showPersistenceMenu&&G(b)})}var _=h(g,2);{var k=G=>{Vo(G,{onClose:()=>te(te().showCanvasSettings=!1)})};Q(_,G=>{te().showCanvasSettings&&G(k)})}var m=h(_,2);{var A=G=>{Go(G,{onClose:()=>te(te().showGoTo=!1)})};Q(m,G=>{te().showGoTo&&G(A)})}var L=h(m,2);{var $=G=>{Uo(G,{onClose:()=>te(te().showAudioSettings=!1)})};Q(L,G=>{te().showAudioSettings&&G($)})}var R=h(L,2);{var T=G=>{Ro(G,{onClose:()=>te(te().showGuideMenu=!1)})};Q(R,G=>{te().showGuideMenu&&G(T)})}var S=h(R,2),w=p(S);$s(w);var M=h(w,2),D=p(M),z=p(D);Ks(z),u(D);var C=h(D,2),O=p(C),Y=p(O);so(Y,{}),u(O),u(C);var P=h(C,2),H=p(P);ri(H),u(P),u(M);var J=h(M,2);Di(J),u(S),V(()=>K(O,1,`editor-frame flex h-full w-full items-center justify-center overflow-hidden shadow-2xl transition-all duration-700 ease-out ${te().project.isPlaying&&te().project.frames.length>1?"ring-palette-0 animate-pulse ring-8 ring-inset":""}`)),E(d,t),Z()}export{oa as P,an as _};
