const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dc0hpwos.js","./BuzRps0s.js","./6DFUXpfJ.js"])))=>i.map(i=>d[i]);
import{O as Re,_ as ht,a1 as ps,M as ut,V as gs,U as es,g as R,X as ms,Y as ys,Z as Tt,$ as dt,Q as Xe,ab as vs,aF as _s,an as Pt,H as ws,N as _t,aL as bs,T as xs,aM as ts,F as Ss,aN as ks,aD as Ct,aO as Es,a9 as It,aP as Cs,aQ as As,aI as Ls,aR as Ie,I as ss,K as rs,aS as ft,q as Ts,aT as Ps,aU as Is,aC as Os,J as Rs,az as Ms,W as Fs,aK as j,y as F,x as we,a as wt,a0 as Te,b as Je}from"./6DFUXpfJ.js";import{B as Ds,_ as rt}from"./BuzRps0s.js";function Bs(w,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in w)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(w,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}))}function Wo(w,e){return e}function js(w,e,t){for(var s=[],r=e.length,i,a=e.length,n=0;n<r;n++){let d=e[n];rs(d,()=>{if(i){if(i.pending.delete(d),i.done.add(d),i.pending.size===0){var _=w.outrogroups;bt(Ct(i.done)),_.delete(i),_.size===0&&(w.outrogroups=null)}}else a-=1},!1)}if(a===0){var o=s.length===0&&t!==null;if(o){var l=t,c=l.parentNode;Os(c),c.append(l),w.items.clear()}bt(e,!o)}else i={pending:new Set(e),done:new Set},(w.outrogroups??=new Set).add(i)}function bt(w,e=!0){for(var t=0;t<w.length;t++)Rs(w[t],e)}var Ot;function Ko(w,e,t,s,r,i=null){var a=w,n=new Map,o=(e&ts)!==0;if(o){var l=w;a=Re?ht(ps(l)):l.appendChild(ut())}Re&&gs();var c=null,d=Ss(()=>{var v=t();return ks(v)?v:v==null?[]:Ct(v)}),_,h=!0;function g(){m.fallback=c,zs(m,_,a,e,s),c!==null&&(_.length===0?(c.f&Ie)===0?ss(c):(c.f^=Ie,Ge(c,null,a)):rs(c,()=>{c=null}))}var p=es(()=>{_=R(d);var v=_.length;let b=!1;if(Re){var k=ms(a)===ys;k!==(v===0)&&(a=Tt(),ht(a),dt(!1),b=!0)}for(var C=new Set,A=ws,z=xs(),T=0;T<v;T+=1){Re&&Xe.nodeType===vs&&Xe.data===_s&&(a=Xe,b=!0,dt(!1));var $=_[T],M=s($,T),U=h?null:n.get(M);U?(U.v&&Pt(U.v,$),U.i&&Pt(U.i,T),z&&A.unskip_effect(U.e)):(U=Ns(n,h?a:Ot??=ut(),$,M,T,r,e,t),h||(U.e.f|=Ie),n.set(M,U)),C.add(M)}if(v===0&&i&&!c&&(h?c=_t(()=>i(a)):(c=_t(()=>i(Ot??=ut())),c.f|=Ie)),v>C.size&&bs(),Re&&v>0&&ht(Tt()),!h)if(z){for(const[re,E]of n)C.has(re)||A.skip_effect(E.e);A.oncommit(g),A.ondiscard(()=>{})}else g();b&&dt(!0),R(d)}),m={effect:p,items:n,outrogroups:null,fallback:c};h=!1,Re&&(a=Xe)}function Ne(w){for(;w!==null&&(w.f&Ps)===0;)w=w.next;return w}function zs(w,e,t,s,r){var i=(s&Is)!==0,a=e.length,n=w.items,o=Ne(w.effect.first),l,c=null,d,_=[],h=[],g,p,m,v;if(i)for(v=0;v<a;v+=1)g=e[v],p=r(g,v),m=n.get(p).e,(m.f&Ie)===0&&(m.nodes?.a?.measure(),(d??=new Set).add(m));for(v=0;v<a;v+=1){if(g=e[v],p=r(g,v),m=n.get(p).e,w.outrogroups!==null)for(const U of w.outrogroups)U.pending.delete(m),U.done.delete(m);if((m.f&Ie)!==0)if(m.f^=Ie,m===o)Ge(m,null,t);else{var b=c?c.next:o;m===w.effect.last&&(w.effect.last=m.prev),m.prev&&(m.prev.next=m.next),m.next&&(m.next.prev=m.prev),Oe(w,c,m),Oe(w,m,b),Ge(m,b,t),c=m,_=[],h=[],o=Ne(c.next);continue}if((m.f&ft)!==0&&(ss(m),i&&(m.nodes?.a?.unfix(),(d??=new Set).delete(m))),m!==o){if(l!==void 0&&l.has(m)){if(_.length<h.length){var k=h[0],C;c=k.prev;var A=_[0],z=_[_.length-1];for(C=0;C<_.length;C+=1)Ge(_[C],k,t);for(C=0;C<h.length;C+=1)l.delete(h[C]);Oe(w,A.prev,z.next),Oe(w,c,A),Oe(w,z,k),o=k,c=z,v-=1,_=[],h=[]}else l.delete(m),Ge(m,o,t),Oe(w,m.prev,m.next),Oe(w,m,c===null?w.effect.first:c.next),Oe(w,c,m),c=m;continue}for(_=[],h=[];o!==null&&o!==m;)(l??=new Set).add(o),h.push(o),o=Ne(o.next);if(o===null)continue}(m.f&Ie)===0&&_.push(m),c=m,o=Ne(m.next)}if(w.outrogroups!==null){for(const U of w.outrogroups)U.pending.size===0&&(bt(Ct(U.done)),w.outrogroups?.delete(U));w.outrogroups.size===0&&(w.outrogroups=null)}if(o!==null||l!==void 0){var T=[];if(l!==void 0)for(m of l)(m.f&ft)===0&&T.push(m);for(;o!==null;)(o.f&ft)===0&&o!==w.fallback&&T.push(o),o=Ne(o.next);var $=T.length;if($>0){var M=(s&ts)!==0&&a===0?t:null;if(i){for(v=0;v<$;v+=1)T[v].nodes?.a?.measure();for(v=0;v<$;v+=1)T[v].nodes?.a?.fix()}js(w,T,M)}}i&&Ts(()=>{if(d!==void 0)for(m of d)m.nodes?.a?.apply()})}function Ns(w,e,t,s,r,i,a,n){var o=(a&Cs)!==0?(a&As)===0?Ls(t,!1,!1):It(t):null,l=(a&Es)!==0?It(r):null;return{v:o,i:l,e:_t(()=>(i(e,o??t,l??r,n),()=>{w.delete(s)}))}}function Ge(w,e,t){if(w.nodes)for(var s=w.nodes.start,r=w.nodes.end,i=e&&(e.f&Ie)===0?e.nodes.start:t;s!==null;){var a=Ms(s);if(i.before(s),s===r)return;s=a}}function Oe(w,e,t){e===null?w.effect.first=t:e.next=t,t===null?w.effect.last=e:t.prev=e}function Zo(w,e,...t){var s=new Ds(w);es(()=>{const r=e()??null;s.ensure(r,r&&(i=>r(i,...t)))},Fs)}function is(w){var e,t,s="";if(typeof w=="string"||typeof w=="number")s+=w;else if(typeof w=="object")if(Array.isArray(w)){var r=w.length;for(e=0;e<r;e++)w[e]&&(t=is(w[e]))&&(s&&(s+=" "),s+=t)}else for(t in w)w[t]&&(s&&(s+=" "),s+=t);return s}function Us(){for(var w,e,t=0,s="",r=arguments.length;t<r;t++)(w=arguments[t])&&(e=is(w))&&(s&&(s+=" "),s+=e);return s}function Yo(w){return typeof w=="object"?Us(w):w??""}const Rt=[...` 	
\r\f \v\uFEFF`];function qo(w,e,t){var s=w==null?"":""+w;if(e&&(s=s?s+" "+e:e),t){for(var r in t)if(t[r])s=s?s+" "+r:r;else if(s.length)for(var i=r.length,a=0;(a=s.indexOf(r,a))>=0;){var n=a+i;(a===0||Rt.includes(s[a-1]))&&(n===s.length||Rt.includes(s[n]))?s=(a===0?"":s.substring(0,a))+s.substring(n+1):a=n}}return s===""?null:s}function Vs(w,e){return w==null?null:String(w)}function Xo(w,e,t,s){var r=w.__style;if(Re||r!==e){var i=Vs(e);(!Re||i!==w.getAttribute("style"))&&(i==null?w.removeAttribute("style"):w.style.cssText=i),w.__style=e}return s}const $s="Move Cursor Up",Hs="Move Cursor Down",Gs="Move Cursor Left",Ws="Move Cursor Right",Ks={artisan:"Jump to Spot",technical:"Go to Coordinate"},Zs="Pan Viewport (Hold Space/Q)",Ys="Reset View",qs="Reset Viewport",Xs={artisan:"Return to Center",technical:"Reset Position"},Js={artisan:"Paint Pixel",technical:"Brush Tool"},Qs={artisan:"Erase Pixel",technical:"Eraser Tool"},er={artisan:"Sample Color",technical:"Eyedropper"},tr={artisan:"Fill Area",flood_fill:"Flood Fill"},sr={artisan:"Add Vertex",technical:"Add Polygon Point"},rr={artisan:"Close Shape",technical:"Close Polygon"},ir={artisan:"Dither Blend",technical:"Dither Blend"},nr={artisan:"Change Color",technical:"Replace Color"},ar={artisan:"Select Same Color",technical:"Magic Wand"},or="Select All",lr="Freehand Painting",cr="Freehand Erasing",hr="Define Selection",ur="Copy Selection",dr="Cut Selection",fr="Paste from Clipboard",pr={artisan:"Clear the Canvas",technical:"Clear Canvas"},gr="Flip Horizontally",mr="Flip Vertically",yr="Rotate Frame",vr="Zoom In",_r="Zoom Out",wr="Reset Zoom",br="Frame",xr="Clone Frame",Sr="Delete Frame",kr="Next Frame",Er="Previous Frame",Cr="Start/Stop Animation",Ar="Onion Skinning",Lr="Add Detail",Tr="Layer",Pr="Group",Ir={artisan:"Clone Detail",technical:"Duplicate Item"},Or={artisan:"Clone Layer",technical:"Duplicate Layer"},Rr={artisan:"Remove Detail",technical:"Delete Item"},Mr={artisan:"Delete Layer",technical:"Delete Layer"},Fr="Move Up",Dr="Move Down",Br="Move to Top",jr="Move to Bottom",zr="Move Layer Up",Nr="Move Layer Down",Ur={artisan:"Merge Layer Down",technical:"Merge Layer"},Vr={artisan:"Combine Layers",technical:"Merge Selected Layers"},$r={artisan:"Combine Frames",technical:"Merge Selected Frames"},Hr="Toggle Visibility (Ctrl+Alt+V)",Gr="Toggle Layer Lock",Wr="Brush Larger",Kr="Brush Smaller",Zr={artisan:"Pattern Brush",technical:"Pattern Brush"},Yr="Swap Shape",qr="Hand Tool",Xr="Symmetry Mode",Jr={artisan:"Tiling Mode",technical:"Tiling Mode"},Qr={artisan:"Airbrush Mode",technical:"Airbrush Mode"},ei="Lock Alpha",ti="Lock Color",si="Lighten (L)",ri="Darken (D)",ii="Dither (X)",ni="Toggle Lighten",ai="Toggle Darken",oi="Toggle Dither",li="Pixel Perfect (Shift+P)",ci="Brush Tool",hi="Eraser Tool",ui={artisan:"Rectangle Selection",technical:"Rectangle Selection"},di={artisan:"Lasso Selection",technical:"Lasso Selection"},fi={artisan:"Polygon Selection",technical:"Polygon Selection"},pi="Select Tool",gi={artisan:"Rectangle Tool",technical:"Rectangle Tool"},mi={artisan:"Ellipse Tool",technical:"Ellipse Tool"},yi={artisan:"Polygon Tool",technical:"Polygon Tool"},vi="Add Sides",_i="Remove Sides",wi="Increase Indentation (Alt+Shift+])",bi="Decrease Indentation (Alt+Shift+[)",xi="Triangle",Si="Square",ki="Pentagon",Ei="Hexagon",Ci="Heptagon",Ai="Octagon",Li="Nonagon",Ti="Decagon",Pi="Toggle Underlay",Ii="Underlay Menu",Oi={artisan:"Transform Selection",technical:"Transform Selection"},Ri="Open Command Palette",Mi="Export Project",Fi="Save Project",Di="Open Project",Bi="Project Settings",ji="Manual",zi="Color Palette",Ni="Help",Ui="Audio Settings",Vi="Mute Audio (Ctrl+Shift+M)",$i="Toggle Minimap",Hi="Undo",Gi="Redo",Wi="Timeline Tab",Ki="Layers Tab",Zi="Switch Focus",Yi="Set Position",qi="Select Color 1",Xi="Select Color 2",Ji="Select Color 3",Qi="Select Color 4",en="Select Color 5",tn="Select Color 6",sn="Select Color 7",rn="Select Color 8",nn="Select Color 9",an="Select Color 0",on={move_up:$s,move_down:Hs,move_left:Gs,move_right:Ws,goto:Ks,pan_viewport:Zs,reset_pan:Ys,reset_viewport:qs,jump_home:Xs,paint:Js,erase:Qs,pick_color:er,flood_fill:tr,bind_vertex:sr,seal_binding:rr,toggle_dither_blend:ir,recolor:nr,select_same:ar,select_all:or,flow_paint:lr,flow_erase:cr,flow_select:hr,copy:ur,cut:dr,paste:fr,clear_canvas:pr,flip_h:gr,flip_v:mr,rotate:yr,zoom_in:vr,zoom_out:_r,reset_zoom:wr,new_frame:br,duplicate_frame:xr,delete_frame:Sr,next_frame:kr,prev_frame:Er,play_pause:Cr,toggle_ghost_layers:Ar,new_item:Lr,new_layer:Tr,new_layer_group:Pr,duplicate_item:Ir,duplicate_layer:Or,delete_item:Rr,delete_layer:Mr,move_item_up:Fr,move_item_down:Dr,move_item_top:Br,move_item_bottom:jr,move_layer_up:zr,move_layer_down:Nr,merge_layers:Ur,merge_selected_layers:Vr,merge_frames:$r,toggle_layer_visibility:Hr,toggle_layer_lock:Gr,brush_size_inc:Wr,brush_size_dec:Kr,toggle_pattern_brush:Zr,toggle_brush_shape:Yr,toggle_hand_tool:qr,cycle_symmetry:Xr,toggle_tiling:Jr,toggle_airbrush:Qr,toggle_alpha_lock:ei,toggle_color_lock:ti,shade_lighten:si,shade_darken:ri,shade_dither:ii,toggle_shade_lighten:ni,toggle_shade_darken:ai,toggle_shade_dither:oi,toggle_pixel_perfect:li,tool_brush:ci,tool_eraser:hi,tool_rect_select:ui,tool_lasso_select:di,tool_poly_select:fi,tool_select:pi,tool_rectangle:gi,tool_ellipse:mi,tool_polygon:yi,poly_sides_inc:vi,poly_sides_dec:_i,poly_indent_inc:wi,poly_indent_dec:bi,set_sides_3:xi,set_sides_4:Si,set_sides_5:ki,set_sides_6:Ei,set_sides_7:Ci,set_sides_8:Ai,set_sides_9:Li,set_sides_10:Ti,toggle_underlay:Pi,open_underlay_menu:Ii,tool_transform:Oi,open_menu:Ri,open_export:Mi,save:Fi,open:Di,open_settings:Bi,open_manual:ji,open_palette:zi,open_help:Ni,open_audio:Ui,toggle_mute:Vi,toggle_minimap:$i,undo:Hi,redo:Gi,escape:"Escape",tab_timeline:Wi,tab_layers:Ki,switch_focus:Zi,set_position:Yi,select_color_1:qi,select_color_2:Xi,select_color_3:Ji,select_color_4:Qi,select_color_5:en,select_color_6:tn,select_color_7:sn,select_color_8:rn,select_color_9:nn,select_color_0:an},ln={name:"Rupa",tagline:"The Rural Sanctuary"},cn={loading:"Preparing the Sanctuary...",error:"The flow has been interrupted.",no_data:"Nothing to show here."},hn={app:ln,generic:cn},un="Export Project",dn="Prepare files for export",fn={image:"Static Art",video:"Animated Flows"},pn={scale:"Export Scale",fps:"Project FPS",selection:"Frame Selection",borders:"Pixel Borders",background:"Background Base"},gn={scale:"Multiplier for final output size",fps:"Frames per second",selection:"Choose which frames to export",borders:"Include grid lines on pixels",background:"Fill empty canvas with base color"},mn={active:"Active Frame",visible:"Visible Frames",selected:"Selected Frames",all:"All Frames",selected_layers:"Selected Layers"},yn={transparent:"Transparent",cream:"Canvas Cream",black:"Canvas Dark",custom:"Custom Color",match_canvas:"Match Canvas Color"},vn={png:"PNG Image",webp:"WebP Image",jpg:"JPG Image",svg_static:"Static SVG",svg_kinetic:"Animated SVG",webm:"WebM Video",gif:"GIF Animation",mp4:"MP4 Video"},_n={submit:"Export Files",export_recipe:"Export Palette (.gpl)"},wn={preparing:"Preparing Export...",progress:"Export Progress",brewing:"Exporting Files...",requires_frames:"Requires multiple frames"},bn="Export Preview",xn="Export Settings",Sn="Wiggle Amount",kn="Sway Amount",En="{{format}} File",Cn="{{width}} x {{height}} pixels",An={title:"Selection Propagation",subtitle:"Copy selection to subsequent frames",frames_label:"Affected Frames",frames_desc:"Number of future frames to receive selection",offset_label:"Offset Amount",offset_desc:"Positional nudge between frames",action:"Propagate Selection"},Ln={title:un,subtitle:dn,tabs:fn,label:pn,description:gn,selection:mn,background:yn,format:vn,button:_n,status:wn,preview_label:bn,settings_label:xn,wiggle_modifier:Sn,sway_modifier:kn,file_label:En,dimensions_label:Cn,propagation:An},Tn="The Artisan's Sanctuary Manual",Pn="Chapter I: Mastering Pixel Art",In={title:"The Design Philosophy",p1:"In the quiet of the morning, there is only the Canvas—a pristine, untouched void. Then came the Brush, guided by your breath, bringing the first drop of color to the surface.",p2:"Rupa is your creative sanctuary. Here, pixels are the building blocks of your story. Every mark you make is a deliberate act of creation that requires patience, focus, and a peaceful heart.",p3:'"We do not just paint pixels; we weave stories into the flow of time."'},On={cursor:{title:"The Editor Cursor",desc:"Your voice in the sanctuary. Move it with the Arrow Keys to guide your patterns with the precision of a master artisan."},colors:{title:"The Color Palette",desc:"Rich colors extracted from forest flora. Apply them with Space and switch colors using the numbers on your keyboard."},layers:{title:"The Layer System",desc:"Layers of depth. Like stacking fine paper, each layer adds a new dimension to your project."}},Rn={title:"Editor Techniques",continuous:{title:"Continuous Painting",desc:"Hold Ctrl while moving to stream color across the canvas."},magic_select:{title:"Color Selection",desc:"Press W to select all connected pixels of the same tone. A powerful way to rearrange your project."},timeline:{title:"The Animation Flow",desc:"Create sequences of frames to breathe life into your work. Press P to feel the pulse of your animation."},audio:{title:"Reactive Audio",desc:"Listen. The application responds to your focus with piano melodies and nature soundscapes."}},Mn={quote:"May your brush be steady and your sanctuary ever-peaceful.",guild:"The Rupa Development Team",all_shortcuts:"Keyboard Shortcuts",enter:"Start Creating"},Fn={title:Tn,subtitle:Pn,philosophy:In,pillars:On,techniques:Rn,footer:Mn},Dn="Command Palette",Bn="Keyboard Rhythms & Flows",jn="Mastering the Craft",zn="In the editor, we use rhythms. These key combinations create a flow state, allowing your cursor to move with professional precision.",Nn="A master artisan knows every shortcut by heart.",Un="means {{tech}}",Vn=[["Frame","Frame"],["Layer","Layer"],["Color","Color"],["Tool","Tool"],["Paint","Paint"],["Delete","Delete"]],$n={rhythms:"Core Rhythms (Basics)",navigation:"Navigation",cursor:"Cursor Control",barista:"Artisan Skills",tools:"Drawing Tools",magic:"Selection Magic",flow:"Continuous Flow",selection:"Selection",etching:"Advanced Tools",transform:"Transformation",geometry:"Forms & Geometry",timeline:"Animation Timeline",layers:"Layers",edit:"Edit Operations",view:"Viewport & View",menu:"Color Palette",vibes:"Atmosphere (Audio)",colors:"Select Colors",system:"System"},Hn={title:Dn,subtitle:Bn,header_title:jn,header_desc:zn,footer_quote:Nn,glossary_meaning:Un,glossary:Vn,groups:$n},Gn="Opening the Sanctuary",Wn="The sanctuary is breathing. Welcome home.",Kn="Chronicle {{version}}",Zn=["The morning mist clears over the village...","Preparing the aged wooden desk...","Listening to the distant wind chimes...","Waking the artisan's spirit...","The sanctuary is silent. Begin your story."],Yn={title:"Enter the Sanctuary",subtitle:"Awaken the wind chimes and ambient soundscapes",action:"Open the Door"},qn={title:Gn,welcome:Wn,version:Kn,phases:Zn,entrance:Yn},Xn={title:"Atmosphere Flow",silent:"Quiet",brewing:"Humming",resonant:"Resonant"},Jn="Mode",Qn={brewing:"Crafting...",tasting:"Sampling...",clearing:"Sweeping",selecting:"Gathering",pouring:"Painting",ready:"Sanctuary Ready"},ea="Rhythm",ta="Waiting",sa="Sanctuary Time",ra="Ghosts",ia="The Flow",na="Animated Stream",aa="{{count}} Servings",oa="{{count}} Servings",la="{{count}} leaf",ca="{{count}} leaves",ha={audio_status:Xn,mode:Jn,mode_labels:Qn,rhythm:ea,waiting:ta,duration:sa,ghosts_label:ra,title:ia,track:na,frame_count:aa,frame_count_plural:oa,pixel_count:la,pixel_count_plural:ca},ua={title:"Pigment Station",subtitle:"Mix your unique extracts",label:{hex:"HEX CODE",hue:"Nature (Hue)",saturation:"Depth (Saturation)",lightness:"Brightness (Lightness)",alpha:"Opacity (Alpha)",temperature:"Thermal (Temperature)"},button:{eye_dropper:"Taste from Washi",confirm:"Seal the Pigment"}},da={title:"Pigment Library",subtitle:"Store and manage your unique extracts",save_label:"Seal Current Swatch",save_desc:"Save your active pigments as a new chronicle",name_placeholder:"Give this set a name...",list_title:"Stored Pigments",new_set:"New Pigment Set",new_set_desc:"Start from a blank washi",import:"Import Ingredients",import_desc:"Load .GPL or HEX list",applied_toast:"Flavor Swatch Applied",new_toast:"Empty Cup Ready for New Flavors",import_success_toast:"Imported {{name}}",import_error_toast:"Invalid Ingredients (File Format Error)",button:{save:"Store Record",apply:"Sample",delete:"Spill"}},fa={title:"Brush Settings",shape_square:"Square Vessel",shape_circle:"Circle Vessel",size_label:"Stroke Size",dither_label:"Moss Blend",dither_desc:"Textured dithering",hardness_label:"Diffusion"},pa={mist:"MIST",pure:"PURE",moving:"MOVING",stencil:"STENCIL",box:"BOX",round:"ROUND",poly:"POLY",light:"LIGHT",dark:"DARK",dither:"DITHER"},ga={color_picker:ua,palette_library:da,brush_settings:fa,status:pa},ma={close:"Close Panel",confirm:"Confirm Action",cancel:"Discard Changes",select_option:"Select an Option",search:"Search...",progress:"Processing...",default:"Default",on:"ON",off:"OFF",selected:"Selected",recovery_title:"Unsaved Session Found",recovery_subtitle:"Session Recovery",recovery_description:"We found a record of an unsaved session in memory. Would you like to restore your work or start fresh?",switch_theme:"Switch Theme",project_tabs:"Project Tabs",timeline_zoom:"Timeline Zoom",minimize:"Minimize",maximize:"Maximize"},ya={mist_active:"Mist Active",mist_off:"Mist Off",light_roast_active:"Lighten Active",light_roast_off:"Lighten Off",dark_roast_active:"Darken Active",dark_roast_off:"Darken Off",texture_active:"Dither Active",texture_off:"Dither Off",blend_on:"Dither Blend ON",blend_off:"Dither Blend OFF",facets:"{{count}} Sides",steeping:"{{count}}% Indentation",canvas_cleared:"Canvas Cleared",preparing_export:"Preparing Export...",flipped_h:"Flipped Horizontally",flipped_v:"Flipped Vertically",rotated:"Rotated 90°",wait_brewing:"Please wait, export in progress...",session_restored:"Session Restored"},va={pixels:"px",fps:"fps",ms:"ms",degrees:"°",percentage:"%"},_a={button:"Action Button",input:"Text Input",slider:"Adjustment Slider",checkbox:"Toggle Selection",toggle:"Switch Status",select:"Choice Selector",radio:"Option Selection",tabs:"Navigation Tabs",color_preview:"Color Preview",drawer:"Side Drawer"},wa={labels:ma,studio:ya,units:va,accessibility:_a},ba={active_color:"Active Color",recent_colors:"Recent Colors",sync_label:"Synchronized",sync_desc:"Sync across all frames",master_pace_label:"Master Pace",master_pace_desc:"This frame follows the project's global rhythm (FPS).",menu:{color_title:"Color Palette",catalog_title:"Command Palette",catalog_search:"Search commands or tools...",catalog_no_results:'No results found for "{{query}}"',catalog_footer:"Use Arrows to Navigate • Enter to Execute",catalog_count:"{{count}} Commands Available"},audio:{title:"Audio Settings",master_mute:"Master Mute",mute_desc:"Silence all application audio",flow_title:"Atmosphere Flow",duration_label:"Session Duration:",sfx_label:"Nature & UI SFX",bgm_label:"Ambient Melodies (BGM)",status_awaiting:"The application awaits in silence. Ambient melodies will begin to play after 30 minutes of focus.",status_playing:"The ambient music has begun. Melodies will reach full resonance at 60 minutes."},project_panel:{frames:"Frames",layers:"Layers",opacity:"Opacity",properties:"Properties",visibility:"Show/Hide Layer",lock:"Lock/Unlock Layer",active:"Active"},stats:{pixel_count:"{{count}} pixels placed",pixel_count_plural:"{{count}} pixels placed"},context_menu:{duplicate_frames:"Duplicate {{count}} Frames",duplicate_layers:"Duplicate {{count}} Layers",delete_frames:"Delete {{count}} Frames",delete_layers:"Delete {{count}} Layers",add_flavor_tag:"Add Tag",show_infusion:"Show Layer",hide_infusion:"Hide Layer",lock_infusion:"Lock Layer",unlock_infusion:"Unlock Layer",group_selected:"Group Selected",group:"Group",delete_color:"Delete Color"},actions:{clear_canvas:"Clear Canvas",add_layer:"Add Layer",add_frame:"Add Frame",delete:"Delete",duplicate:"Duplicate",save_project:"Save Project",mute_audio:"Mute Audio",unmute_audio:"Unmute Audio",add_color:"Add Color"}},xa={upload_label:"Upload Reference Image",visibility:"Visibility",positioning:"Manual Positioning"},Sa={position:"Cursor at {{x}}, {{y}}"},ka={pos_label:"POS",size_label:"SIZE",zoom_label:"ZOOM",cursor_focus:"Cursor Focus",canvas_size:"Canvas Dimensions",zoom_level:"Zoom Level",active_pattern:"Pixels: {{count}}",technical_details:"Technical Ledger"},Ea={saved:"Project Saved {{time}}"},Ca={title:"Go To",subtitle:"Direct Cursor Placement",label_x:"Column (X)",label_y:"Row (Y)",current:"Currently at: {{x}}, {{y}}",action:"Move Cursor"},Aa={title:"Canvas Settings",subtitle:"Configure the Workspace",width:"Canvas Width",height:"Canvas Height",fps_label:"Project FPS",fps_desc:"Frames per second",background_label:"Background Color",background_desc:"Visual background for the canvas",stabilization:"Brush Stability",stabilization_desc:"Corrects shaky movements",apply:"Apply Settings",note:"Note: Resizing will center your current art. Large canvases may affect performance."},La={hud:ba,underlay:xa,cursor:Sa,stats:ka,project:Ea,navigation:Ca,settings:Aa},ae=w=>typeof w=="string",Ue=()=>{let w,e;const t=new Promise((s,r)=>{w=s,e=r});return t.resolve=w,t.reject=e,t},Mt=w=>w==null?"":""+w,Ta=(w,e,t)=>{w.forEach(s=>{e[s]&&(t[s]=e[s])})},Pa=/###/g,Ft=w=>w&&w.indexOf("###")>-1?w.replace(Pa,"."):w,Dt=w=>!w||ae(w),We=(w,e,t)=>{const s=ae(e)?e.split("."):e;let r=0;for(;r<s.length-1;){if(Dt(w))return{};const i=Ft(s[r]);!w[i]&&t&&(w[i]=new t),Object.prototype.hasOwnProperty.call(w,i)?w=w[i]:w={},++r}return Dt(w)?{}:{obj:w,k:Ft(s[r])}},Bt=(w,e,t)=>{const{obj:s,k:r}=We(w,e,Object);if(s!==void 0||e.length===1){s[r]=t;return}let i=e[e.length-1],a=e.slice(0,e.length-1),n=We(w,a,Object);for(;n.obj===void 0&&a.length;)i=`${a[a.length-1]}.${i}`,a=a.slice(0,a.length-1),n=We(w,a,Object),n?.obj&&typeof n.obj[`${n.k}.${i}`]<"u"&&(n.obj=void 0);n.obj[`${n.k}.${i}`]=t},Ia=(w,e,t,s)=>{const{obj:r,k:i}=We(w,e,Object);r[i]=r[i]||[],r[i].push(t)},it=(w,e)=>{const{obj:t,k:s}=We(w,e);if(t&&Object.prototype.hasOwnProperty.call(t,s))return t[s]},Oa=(w,e,t)=>{const s=it(w,t);return s!==void 0?s:it(e,t)},ns=(w,e,t)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in w?ae(w[s])||w[s]instanceof String||ae(e[s])||e[s]instanceof String?t&&(w[s]=e[s]):ns(w[s],e[s],t):w[s]=e[s]);return w},De=w=>w.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Ra={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Ma=w=>ae(w)?w.replace(/[&<>"'\/]/g,e=>Ra[e]):w;class Fa{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const Da=[" ",",","?","!",";"],Ba=new Fa(20),ja=(w,e,t)=>{e=e||"",t=t||"";const s=Da.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(s.length===0)return!0;const r=Ba.getRegExp(`(${s.map(a=>a==="?"?"\\?":a).join("|")})`);let i=!r.test(w);if(!i){const a=w.indexOf(t);a>0&&!r.test(w.substring(0,a))&&(i=!0)}return i},xt=(w,e,t=".")=>{if(!w)return;if(w[e])return Object.prototype.hasOwnProperty.call(w,e)?w[e]:void 0;const s=e.split(t);let r=w;for(let i=0;i<s.length;){if(!r||typeof r!="object")return;let a,n="";for(let o=i;o<s.length;++o)if(o!==i&&(n+=t),n+=s[o],a=r[n],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&o<s.length-1)continue;i+=o-i+1;break}r=a}return r},Ze=w=>w?.replace("_","-"),za={type:"logger",log(w){this.output("log",w)},warn(w){this.output("warn",w)},error(w){this.output("error",w)},output(w,e){console?.[w]?.apply?.(console,e)}};class nt{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||za,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,s,r){return r&&!this.debug?null:(ae(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new nt(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new nt(this.logger,e)}}var Le=new nt;class lt{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const r=this.observers[s].get(t)||0;this.observers[s].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([r,i])=>{for(let a=0;a<i;a++)r(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([r,i])=>{for(let a=0;a<i;a++)r.apply(r,[e,...t])})}}class jt extends lt{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,s,r={}){const i=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let n;e.indexOf(".")>-1?n=e.split("."):(n=[e,t],s&&(Array.isArray(s)?n.push(...s):ae(s)&&i?n.push(...s.split(i)):n.push(s)));const o=it(this.data,n);return!o&&!t&&!s&&e.indexOf(".")>-1&&(e=n[0],t=n[1],s=n.slice(2).join(".")),o||!a||!ae(s)?o:xt(this.data?.[e]?.[t],s,i)}addResource(e,t,s,r,i={silent:!1}){const a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let n=[e,t];s&&(n=n.concat(a?s.split(a):s)),e.indexOf(".")>-1&&(n=e.split("."),r=t,t=n[1]),this.addNamespaces(t),Bt(this.data,n,r),i.silent||this.emit("added",e,t,s,r)}addResources(e,t,s,r={silent:!1}){for(const i in s)(ae(s[i])||Array.isArray(s[i]))&&this.addResource(e,t,i,s[i],{silent:!0});r.silent||this.emit("added",e,t,s)}addResourceBundle(e,t,s,r,i,a={silent:!1,skipCopy:!1}){let n=[e,t];e.indexOf(".")>-1&&(n=e.split("."),r=s,s=t,t=n[1]),this.addNamespaces(t);let o=it(this.data,n)||{};a.skipCopy||(s=JSON.parse(JSON.stringify(s))),r?ns(o,s,i):o={...o,...s},Bt(this.data,n,o),a.silent||this.emit("added",e,t,s)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var as={processors:{},addPostProcessor(w){this.processors[w.name]=w},handle(w,e,t,s,r){return w.forEach(i=>{e=this.processors[i]?.process(e,t,s,r)??e}),e}};const os=Symbol("i18next/PATH_KEY");function Na(){const w=[],e=Object.create(null);let t;return e.get=(s,r)=>(t?.revoke?.(),r===os?w:(w.push(r),t=Proxy.revocable(s,e),t.proxy)),Proxy.revocable(Object.create(null),e).proxy}function St(w,e){const{[os]:t}=w(Na());return t.join(e?.keySeparator??".")}const zt={},pt=w=>!ae(w)&&typeof w!="boolean"&&typeof w!="number";class at extends lt{constructor(e,t={}){super(),Ta(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Le.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const s={...t};if(e==null)return!1;const r=this.resolve(e,s);if(r?.res===void 0)return!1;const i=pt(r.res);return!(s.returnObjects===!1&&i)}extractFromKey(e,t){let s=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const a=s&&e.indexOf(s)>-1,n=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!ja(e,s,r);if(a&&!n){const o=e.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:e,namespaces:ae(i)?[i]:i};const l=e.split(s);(s!==r||s===r&&this.options.ns.indexOf(l[0])>-1)&&(i=l.shift()),e=l.join(r)}return{key:e,namespaces:ae(i)?[i]:i}}translate(e,t,s){let r=typeof t=="object"?{...t}:t;if(typeof r!="object"&&this.options.overloadTranslationOptionHandler&&(r=this.options.overloadTranslationOptionHandler(arguments)),typeof r=="object"&&(r={...r}),r||(r={}),e==null)return"";typeof e=="function"&&(e=St(e,{...this.options,...r})),Array.isArray(e)||(e=[String(e)]);const i=r.returnDetails!==void 0?r.returnDetails:this.options.returnDetails,a=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,{key:n,namespaces:o}=this.extractFromKey(e[e.length-1],r),l=o[o.length-1];let c=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;c===void 0&&(c=":");const d=r.lng||this.language,_=r.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d?.toLowerCase()==="cimode")return _?i?{res:`${l}${c}${n}`,usedKey:n,exactUsedKey:n,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(r)}:`${l}${c}${n}`:i?{res:n,usedKey:n,exactUsedKey:n,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(r)}:n;const h=this.resolve(e,r);let g=h?.res;const p=h?.usedKey||n,m=h?.exactUsedKey||n,v=["[object Number]","[object Function]","[object RegExp]"],b=r.joinArrays!==void 0?r.joinArrays:this.options.joinArrays,k=!this.i18nFormat||this.i18nFormat.handleAsObject,C=r.count!==void 0&&!ae(r.count),A=at.hasDefaultValue(r),z=C?this.pluralResolver.getSuffix(d,r.count,r):"",T=r.ordinal&&C?this.pluralResolver.getSuffix(d,r.count,{ordinal:!1}):"",$=C&&!r.ordinal&&r.count===0,M=$&&r[`defaultValue${this.options.pluralSeparator}zero`]||r[`defaultValue${z}`]||r[`defaultValue${T}`]||r.defaultValue;let U=g;k&&!g&&A&&(U=M);const re=pt(U),E=Object.prototype.toString.apply(U);if(k&&U&&re&&v.indexOf(E)<0&&!(ae(b)&&Array.isArray(U))){if(!r.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const B=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,U,{...r,ns:o}):`key '${n} (${this.language})' returned an object instead of string.`;return i?(h.res=B,h.usedParams=this.getUsedParamsDetails(r),h):B}if(a){const B=Array.isArray(U),y=B?[]:{},V=B?m:p;for(const se in U)if(Object.prototype.hasOwnProperty.call(U,se)){const G=`${V}${a}${se}`;A&&!g?y[se]=this.translate(G,{...r,defaultValue:pt(M)?M[se]:void 0,joinArrays:!1,ns:o}):y[se]=this.translate(G,{...r,joinArrays:!1,ns:o}),y[se]===G&&(y[se]=U[se])}g=y}}else if(k&&ae(b)&&Array.isArray(g))g=g.join(b),g&&(g=this.extendTranslation(g,e,r,s));else{let B=!1,y=!1;!this.isValidLookup(g)&&A&&(B=!0,g=M),this.isValidLookup(g)||(y=!0,g=n);const se=(r.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&y?void 0:g,G=A&&M!==g&&this.options.updateMissing;if(y||B||G){if(this.logger.log(G?"updateKey":"missingKey",d,l,n,G?M:g),a){const O=this.resolve(n,{...r,keySeparator:!1});O&&O.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let oe=[];const K=this.languageUtils.getFallbackCodes(this.options.fallbackLng,r.lng||this.language);if(this.options.saveMissingTo==="fallback"&&K&&K[0])for(let O=0;O<K.length;O++)oe.push(K[O]);else this.options.saveMissingTo==="all"?oe=this.languageUtils.toResolveHierarchy(r.lng||this.language):oe.push(r.lng||this.language);const ne=(O,P,te)=>{const X=A&&te!==g?te:se;this.options.missingKeyHandler?this.options.missingKeyHandler(O,l,P,X,G,r):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(O,l,P,X,G,r),this.emit("missingKey",O,l,P,g)};this.options.saveMissing&&(this.options.saveMissingPlurals&&C?oe.forEach(O=>{const P=this.pluralResolver.getSuffixes(O,r);$&&r[`defaultValue${this.options.pluralSeparator}zero`]&&P.indexOf(`${this.options.pluralSeparator}zero`)<0&&P.push(`${this.options.pluralSeparator}zero`),P.forEach(te=>{ne([O],n+te,r[`defaultValue${te}`]||M)})}):ne(oe,n,M))}g=this.extendTranslation(g,e,r,h,s),y&&g===n&&this.options.appendNamespaceToMissingKey&&(g=`${l}${c}${n}`),(y||B)&&this.options.parseMissingKeyHandler&&(g=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${c}${n}`:n,B?g:void 0,r))}return i?(h.res=g,h.usedParams=this.getUsedParamsDetails(r),h):g}extendTranslation(e,t,s,r,i){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const o=ae(e)&&(s?.interpolation?.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(o){const d=e.match(this.interpolator.nestingRegexp);l=d&&d.length}let c=s.replace&&!ae(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,s.lng||this.language||r.usedLng,s),o){const d=e.match(this.interpolator.nestingRegexp),_=d&&d.length;l<_&&(s.nest=!1)}!s.lng&&r&&r.res&&(s.lng=this.language||r.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,(...d)=>i?.[0]===d[0]&&!s.context?(this.logger.warn(`It seems you are nesting recursively key: ${d[0]} in key: ${t[0]}`),null):this.translate(...d,t),s)),s.interpolation&&this.interpolator.reset()}const a=s.postProcess||this.options.postProcess,n=ae(a)?[a]:a;return e!=null&&n?.length&&s.applyPostProcessor!==!1&&(e=as.handle(n,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e,t={}){let s,r,i,a,n;return ae(e)&&(e=[e]),e.forEach(o=>{if(this.isValidLookup(s))return;const l=this.extractFromKey(o,t),c=l.key;r=c;let d=l.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const _=t.count!==void 0&&!ae(t.count),h=_&&!t.ordinal&&t.count===0,g=t.context!==void 0&&(ae(t.context)||typeof t.context=="number")&&t.context!=="",p=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);d.forEach(m=>{this.isValidLookup(s)||(n=m,!zt[`${p[0]}-${m}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(n)&&(zt[`${p[0]}-${m}`]=!0,this.logger.warn(`key "${r}" for languages "${p.join(", ")}" won't get resolved as namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(v=>{if(this.isValidLookup(s))return;a=v;const b=[c];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(b,c,v,m,t);else{let C;_&&(C=this.pluralResolver.getSuffix(v,t.count,t));const A=`${this.options.pluralSeparator}zero`,z=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(_&&(t.ordinal&&C.indexOf(z)===0&&b.push(c+C.replace(z,this.options.pluralSeparator)),b.push(c+C),h&&b.push(c+A)),g){const T=`${c}${this.options.contextSeparator||"_"}${t.context}`;b.push(T),_&&(t.ordinal&&C.indexOf(z)===0&&b.push(T+C.replace(z,this.options.pluralSeparator)),b.push(T+C),h&&b.push(T+A))}}let k;for(;k=b.pop();)this.isValidLookup(s)||(i=k,s=this.getResource(v,m,k,t))}))})}),{res:s,usedKey:r,exactUsedKey:i,usedLng:a,usedNS:n}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,s,r={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,s,r):this.resourceStore.getResource(e,t,s,r)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!ae(e.replace);let r=s?e.replace:e;if(s&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!s){r={...r};for(const i of t)delete r[i]}return r}static hasDefaultValue(e){const t="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t===s.substring(0,t.length)&&e[s]!==void 0)return!0;return!1}}class Nt{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Le.create("languageUtils")}getScriptPartFromCode(e){if(e=Ze(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=Ze(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(ae(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(s=>{if(t)return;const r=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(s=>{if(t)return;const r=this.getScriptPartFromCode(s);if(this.isSupportedCode(r))return t=r;const i=this.getLanguagePartFromCode(s);if(this.isSupportedCode(i))return t=i;t=this.options.supportedLngs.find(a=>{if(a===i)return a;if(!(a.indexOf("-")<0&&i.indexOf("-")<0)&&(a.indexOf("-")>0&&i.indexOf("-")<0&&a.substring(0,a.indexOf("-"))===i||a.indexOf(i)===0&&i.length>1))return a})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),ae(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let s=e[t];return s||(s=e[this.getScriptPartFromCode(t)]),s||(s=e[this.formatLanguageCode(t)]),s||(s=e[this.getLanguagePartFromCode(t)]),s||(s=e.default),s||[]}toResolveHierarchy(e,t){const s=this.getFallbackCodes((t===!1?[]:t)||this.options.fallbackLng||[],e),r=[],i=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return ae(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):ae(e)&&i(this.formatLanguageCode(e)),s.forEach(a=>{r.indexOf(a)<0&&i(this.formatLanguageCode(a))}),r}}const Ut={zero:0,one:1,two:2,few:3,many:4,other:5},Vt={select:w=>w===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Ua{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=Le.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const s=Ze(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let a;try{a=new Intl.PluralRules(s,{type:r})}catch{if(typeof Intl>"u")return this.logger.error("No Intl support, please use an Intl polyfill!"),Vt;if(!e.match(/-|_/))return Vt;const o=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(o,t)}return this.pluralRulesCache[i]=a,a}needsPlural(e,t={}){let s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),s?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,s={}){return this.getSuffixes(e,s).map(r=>`${t}${r}`)}getSuffixes(e,t={}){let s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),s?s.resolvedOptions().pluralCategories.sort((r,i)=>Ut[r]-Ut[i]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,t,s={}){const r=this.getRule(e,s);return r?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,s))}}const $t=(w,e,t,s=".",r=!0)=>{let i=Oa(w,e,t);return!i&&r&&ae(t)&&(i=xt(w,t,s),i===void 0&&(i=xt(e,t,s))),i},gt=w=>w.replace(/\$/g,"$$$$");class Ht{constructor(e={}){this.logger=Le.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:s,useRawValueToEscape:r,prefix:i,prefixEscaped:a,suffix:n,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:_,nestingPrefixEscaped:h,nestingSuffix:g,nestingSuffixEscaped:p,nestingOptionsSeparator:m,maxReplaces:v,alwaysFormat:b}=e.interpolation;this.escape=t!==void 0?t:Ma,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=i?De(i):a||"{{",this.suffix=n?De(n):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=_?De(_):h||De("$t("),this.nestingSuffix=g?De(g):p||De(")"),this.nestingOptionsSeparator=m||",",this.maxReplaces=v||1e3,this.alwaysFormat=b!==void 0?b:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,s)=>t?.source===s?(t.lastIndex=0,t):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,s,r){let i,a,n;const o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=h=>{if(h.indexOf(this.formatSeparator)<0){const v=$t(t,o,h,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(v,void 0,s,{...r,...t,interpolationkey:h}):v}const g=h.split(this.formatSeparator),p=g.shift().trim(),m=g.join(this.formatSeparator).trim();return this.format($t(t,o,p,this.options.keySeparator,this.options.ignoreJSONStructure),m,s,{...r,...t,interpolationkey:p})};this.resetRegExp();const c=r?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:h=>gt(h)},{regex:this.regexp,safeValue:h=>this.escapeValue?gt(this.escape(h)):gt(h)}].forEach(h=>{for(n=0;i=h.regex.exec(e);){const g=i[1].trim();if(a=l(g),a===void 0)if(typeof c=="function"){const m=c(e,i,r);a=ae(m)?m:""}else if(r&&Object.prototype.hasOwnProperty.call(r,g))a="";else if(d){a=i[0];continue}else this.logger.warn(`missed to pass in variable ${g} for interpolating ${e}`),a="";else!ae(a)&&!this.useRawValueToEscape&&(a=Mt(a));const p=h.safeValue(a);if(e=e.replace(i[0],p),d?(h.regex.lastIndex+=a.length,h.regex.lastIndex-=i[0].length):h.regex.lastIndex=0,n++,n>=this.maxReplaces)break}}),e}nest(e,t,s={}){let r,i,a;const n=(o,l)=>{const c=this.nestingOptionsSeparator;if(o.indexOf(c)<0)return o;const d=o.split(new RegExp(`${c}[ ]*{`));let _=`{${d[1]}`;o=d[0],_=this.interpolate(_,a);const h=_.match(/'/g),g=_.match(/"/g);((h?.length??0)%2===0&&!g||g.length%2!==0)&&(_=_.replace(/'/g,'"'));try{a=JSON.parse(_),l&&(a={...l,...a})}catch(p){return this.logger.warn(`failed parsing options string in nesting for key ${o}`,p),`${o}${c}${_}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,o};for(;r=this.nestingRegexp.exec(e);){let o=[];a={...s},a=a.replace&&!ae(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;const l=/{.*}/.test(r[1])?r[1].lastIndexOf("}")+1:r[1].indexOf(this.formatSeparator);if(l!==-1&&(o=r[1].slice(l).split(this.formatSeparator).map(c=>c.trim()).filter(Boolean),r[1]=r[1].slice(0,l)),i=t(n.call(this,r[1].trim(),a),a),i&&r[0]===e&&!ae(i))return i;ae(i)||(i=Mt(i)),i||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),i=""),o.length&&(i=o.reduce((c,d)=>this.format(c,d,s.lng,{...s,interpolationkey:r[1].trim()}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}const Va=w=>{let e=w.toLowerCase().trim();const t={};if(w.indexOf("(")>-1){const s=w.split("(");e=s[0].toLowerCase().trim();const r=s[1].substring(0,s[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(a=>{if(a){const[n,...o]=a.split(":"),l=o.join(":").trim().replace(/^'+|'+$/g,""),c=n.trim();t[c]||(t[c]=l),l==="false"&&(t[c]=!1),l==="true"&&(t[c]=!0),isNaN(l)||(t[c]=parseInt(l,10))}})}return{formatName:e,formatOptions:t}},Gt=w=>{const e={};return(t,s,r)=>{let i=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(i={...i,[r.interpolationkey]:void 0});const a=s+JSON.stringify(i);let n=e[a];return n||(n=w(Ze(s),r),e[a]=n),n(t)}},$a=w=>(e,t,s)=>w(Ze(t),s)(e);class Ha{constructor(e={}){this.logger=Le.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const s=t.cacheInBuiltFormats?Gt:$a;this.formats={number:s((r,i)=>{const a=new Intl.NumberFormat(r,{...i});return n=>a.format(n)}),currency:s((r,i)=>{const a=new Intl.NumberFormat(r,{...i,style:"currency"});return n=>a.format(n)}),datetime:s((r,i)=>{const a=new Intl.DateTimeFormat(r,{...i});return n=>a.format(n)}),relativetime:s((r,i)=>{const a=new Intl.RelativeTimeFormat(r,{...i});return n=>a.format(n,i.range||"day")}),list:s((r,i)=>{const a=new Intl.ListFormat(r,{...i});return n=>a.format(n)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Gt(t)}format(e,t,s,r={}){const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(n=>n.indexOf(")")>-1)){const n=i.findIndex(o=>o.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,n)].join(this.formatSeparator)}return i.reduce((n,o)=>{const{formatName:l,formatOptions:c}=Va(o);if(this.formats[l]){let d=n;try{const _=r?.formatParams?.[r.interpolationkey]||{},h=_.locale||_.lng||r.locale||r.lng||s;d=this.formats[l](n,h,{...c,...r,..._})}catch(_){this.logger.warn(_)}return d}else this.logger.warn(`there was no format function for ${l}`);return n},e)}}const Ga=(w,e)=>{w.pending[e]!==void 0&&(delete w.pending[e],w.pendingCount--)};class Wa extends lt{constructor(e,t,s,r={}){super(),this.backend=e,this.store=t,this.services=s,this.languageUtils=s.languageUtils,this.options=r,this.logger=Le.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(s,r.backend,r)}queueLoad(e,t,s,r){const i={},a={},n={},o={};return e.forEach(l=>{let c=!0;t.forEach(d=>{const _=`${l}|${d}`;!s.reload&&this.store.hasResourceBundle(l,d)?this.state[_]=2:this.state[_]<0||(this.state[_]===1?a[_]===void 0&&(a[_]=!0):(this.state[_]=1,c=!1,a[_]===void 0&&(a[_]=!0),i[_]===void 0&&(i[_]=!0),o[d]===void 0&&(o[d]=!0)))}),c||(n[l]=!0)}),(Object.keys(i).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(a),toLoadLanguages:Object.keys(n),toLoadNamespaces:Object.keys(o)}}loaded(e,t,s){const r=e.split("|"),i=r[0],a=r[1];t&&this.emit("failedLoading",i,a,t),!t&&s&&this.store.addResourceBundle(i,a,s,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&s&&(this.state[e]=0);const n={};this.queue.forEach(o=>{Ia(o.loaded,[i],a),Ga(o,e),t&&o.errors.push(t),o.pendingCount===0&&!o.done&&(Object.keys(o.loaded).forEach(l=>{n[l]||(n[l]={});const c=o.loaded[l];c.length&&c.forEach(d=>{n[l][d]===void 0&&(n[l][d]=!0)})}),o.done=!0,o.errors.length?o.callback(o.errors):o.callback())}),this.emit("loaded",n),this.queue=this.queue.filter(o=>!o.done)}read(e,t,s,r=0,i=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:s,tried:r,wait:i,callback:a});return}this.readingCalls++;const n=(l,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(l&&c&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,s,r+1,i*2,a)},i);return}a(l,c)},o=this.backend[s].bind(this.backend);if(o.length===2){try{const l=o(e,t);l&&typeof l.then=="function"?l.then(c=>n(null,c)).catch(n):n(null,l)}catch(l){n(l)}return}return o(e,t,n)}prepareLoading(e,t,s={},r){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();ae(e)&&(e=this.languageUtils.toResolveHierarchy(e)),ae(t)&&(t=[t]);const i=this.queueLoad(e,t,s,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,s){this.prepareLoading(e,t,{},s)}reload(e,t,s){this.prepareLoading(e,t,{reload:!0},s)}loadOne(e,t=""){const s=e.split("|"),r=s[0],i=s[1];this.read(r,i,"read",void 0,void 0,(a,n)=>{a&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,a),!a&&n&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,n),this.loaded(e,a,n)})}saveMissing(e,t,s,r,i,a={},n=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${s}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend?.create){const o={...a,isUpdate:i},l=this.backend.create.bind(this.backend);if(l.length<6)try{let c;l.length===5?c=l(e,t,s,r,o):c=l(e,t,s,r),c&&typeof c.then=="function"?c.then(d=>n(null,d)).catch(n):n(null,c)}catch(c){n(c)}else l(e,t,s,r,n,o)}!e||!e[0]||this.store.addResource(e[0],t,s,r)}}}const mt=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:w=>{let e={};if(typeof w[1]=="object"&&(e=w[1]),ae(w[1])&&(e.defaultValue=w[1]),ae(w[2])&&(e.tDescription=w[2]),typeof w[2]=="object"||typeof w[3]=="object"){const t=w[3]||w[2];Object.keys(t).forEach(s=>{e[s]=t[s]})}return e},interpolation:{escapeValue:!0,format:w=>w,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Wt=w=>(ae(w.ns)&&(w.ns=[w.ns]),ae(w.fallbackLng)&&(w.fallbackLng=[w.fallbackLng]),ae(w.fallbackNS)&&(w.fallbackNS=[w.fallbackNS]),w.supportedLngs?.indexOf?.("cimode")<0&&(w.supportedLngs=w.supportedLngs.concat(["cimode"])),typeof w.initImmediate=="boolean"&&(w.initAsync=w.initImmediate),w),Qe=()=>{},Ka=w=>{Object.getOwnPropertyNames(Object.getPrototypeOf(w)).forEach(t=>{typeof w[t]=="function"&&(w[t]=w[t].bind(w))})};let Kt=!1;const Za=w=>!!(w?.modules?.backend?.name?.indexOf("Locize")>0||w?.modules?.backend?.constructor?.name?.indexOf("Locize")>0||w?.options?.backend?.backends&&w.options.backend.backends.some(e=>e?.name?.indexOf("Locize")>0||e?.constructor?.name?.indexOf("Locize")>0));class Ke extends lt{constructor(e={},t){if(super(),this.options=Wt(e),this.services={},this.logger=Le,this.modules={external:[]},Ka(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,typeof e=="function"&&(t=e,e={}),e.defaultNS==null&&e.ns&&(ae(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const s=mt();this.options={...s,...this.options,...Wt(e)},this.options.interpolation={...s.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=s.overloadTranslationOptionHandler),this.options.showSupportNotice!==!1&&!Za(this)&&!Kt&&(typeof console<"u"&&typeof console.info<"u"&&console.info("🌐 i18next is maintained with support from Locize — consider powering your project with managed localization (AI, CDN, integrations): https://locize.com 💙"),Kt=!0);const r=l=>l?typeof l=="function"?new l:l:null;if(!this.options.isClone){this.modules.logger?Le.init(r(this.modules.logger),this.options):Le.init(null,this.options);let l;this.modules.formatter?l=this.modules.formatter:l=Ha;const c=new Nt(this.options);this.store=new jt(this.options.resources,this.options);const d=this.services;d.logger=Le,d.resourceStore=this.store,d.languageUtils=c,d.pluralResolver=new Ua(c,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),l&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(d.formatter=r(l),d.formatter.init&&d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new Ht(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new Wa(r(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",(h,...g)=>{this.emit(h,...g)}),this.modules.languageDetector&&(d.languageDetector=r(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=r(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new at(this.services,this.options),this.translator.on("*",(h,...g)=>{this.emit(h,...g)}),this.modules.external.forEach(h=>{h.init&&h.init(this)})}if(this.format=this.options.interpolation.format,t||(t=Qe),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&l[0]!=="dev"&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(l=>{this[l]=(...c)=>this.store[l](...c)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(l=>{this[l]=(...c)=>(this.store[l](...c),this)});const n=Ue(),o=()=>{const l=(c,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),n.resolve(d),t(c,d)};if(this.languages&&!this.isInitialized)return l(null,this.t.bind(this));this.changeLanguage(this.options.lng,l)};return this.options.resources||!this.options.initAsync?o():setTimeout(o,0),n}loadResources(e,t=Qe){let s=t;const r=ae(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(r?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const i=[],a=n=>{if(!n||n==="cimode")return;this.services.languageUtils.toResolveHierarchy(n).forEach(l=>{l!=="cimode"&&i.indexOf(l)<0&&i.push(l)})};r?a(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(o=>a(o)),this.options.preload?.forEach?.(n=>a(n)),this.services.backendConnector.load(i,this.options.ns,n=>{!n&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(n)})}else s(null)}reloadResources(e,t,s){const r=Ue();return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),s||(s=Qe),this.services.backendConnector.reload(e,t,i=>{r.resolve(),s(i)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&as.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let t=0;t<this.languages.length;t++){const s=this.languages[t];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const s=Ue();this.emit("languageChanging",e);const r=n=>{this.language=n,this.languages=this.services.languageUtils.toResolveHierarchy(n),this.resolvedLanguage=void 0,this.setResolvedLanguage(n)},i=(n,o)=>{o?this.isLanguageChangingTo===e&&(r(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,s.resolve((...l)=>this.t(...l)),t&&t(n,(...l)=>this.t(...l))},a=n=>{!e&&!n&&this.services.languageDetector&&(n=[]);const o=ae(n)?n:n&&n[0],l=this.store.hasLanguageSomeTranslations(o)?o:this.services.languageUtils.getBestMatchFromCodes(ae(n)?[n]:n);l&&(this.language||r(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector?.cacheUserLanguage?.(l)),this.loadResources(l,c=>{i(c,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),s}getFixedT(e,t,s){const r=(i,a,...n)=>{let o;typeof a!="object"?o=this.options.overloadTranslationOptionHandler([i,a].concat(n)):o={...a},o.lng=o.lng||r.lng,o.lngs=o.lngs||r.lngs,o.ns=o.ns||r.ns,o.keyPrefix!==""&&(o.keyPrefix=o.keyPrefix||s||r.keyPrefix);const l=this.options.keySeparator||".";let c;return o.keyPrefix&&Array.isArray(i)?c=i.map(d=>(typeof d=="function"&&(d=St(d,{...this.options,...a})),`${o.keyPrefix}${l}${d}`)):(typeof i=="function"&&(i=St(i,{...this.options,...a})),c=o.keyPrefix?`${o.keyPrefix}${l}${i}`:i),this.t(c,o)};return ae(e)?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=s,r}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const a=(n,o)=>{const l=this.services.backendConnector.state[`${n}|${o}`];return l===-1||l===0||l===2};if(t.precheck){const n=t.precheck(this,a);if(n!==void 0)return n}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(s,e)&&(!r||a(i,e)))}loadNamespaces(e,t){const s=Ue();return this.options.ns?(ae(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{s.resolve(),t&&t(r)}),s):(t&&t(),Promise.resolve())}loadLanguages(e,t){const s=Ue();ae(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return i.length?(this.options.preload=r.concat(i),this.loadResources(a=>{s.resolve(),t&&t(a)}),s):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const r=new Intl.Locale(e);if(r&&r.getTextInfo){const i=r.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services?.languageUtils||new Nt(mt());return e.toLowerCase().indexOf("-latn")>1?"ltr":t.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const s=new Ke(e,t);return s.createInstance=Ke.createInstance,s}cloneInstance(e={},t=Qe){const s=e.forkResourceStore;s&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Ke(r);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(n=>{i[n]=this[n]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const n=Object.keys(this.store.data).reduce((o,l)=>(o[l]={...this.store.data[l]},o[l]=Object.keys(o[l]).reduce((c,d)=>(c[d]={...o[l][d]},c),o[l]),o),{});i.store=new jt(n,r),i.services.resourceStore=i.store}if(e.interpolation){const o={...mt().interpolation,...this.options.interpolation,...e.interpolation},l={...r,interpolation:o};i.services.interpolator=new Ht(l)}return i.translator=new at(i.services,r),i.translator.on("*",(n,...o)=>{i.emit(n,...o)}),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const _e=Ke.createInstance();_e.createInstance;_e.dir;_e.init;_e.loadResources;_e.reloadResources;_e.use;_e.changeLanguage;_e.getFixedT;_e.t;_e.exists;_e.setDefaultNamespace;_e.hasLoadedNamespace;_e.loadNamespaces;_e.loadLanguages;const Zt=Object.assign({"../lang/en/actions.json":on,"../lang/en/common.json":hn,"../lang/en/export.json":Ln,"../lang/en/manual.json":Fn,"../lang/en/shortcuts.json":Hn,"../lang/en/splash.json":qn,"../lang/en/timeline.json":ha,"../lang/en/tools.json":ga,"../lang/en/ui.json":wa,"../lang/en/workspace.json":La});class Ya{#e=j("en");get locale(){return R(this.#e)}set locale(e){F(this.#e,e,!0)}#t=j(!1);get isReady(){return R(this.#t)}set isReady(e){F(this.#t,e,!0)}constructor(){this.init()}async init(){const e={en:{}},t=[];for(const s in Zt){const r=s.split("/").pop()?.replace(".json","");r&&(e.en[r]=Zt[s],t.push(r))}await _e.init({lng:this.locale,fallbackLng:"en",resources:e,ns:t,defaultNS:"common",interpolation:{escapeValue:!1}}),this.isReady=!0}async setLocale(e){this.locale=e,await _e.changeLanguage(e)}}const Yt=new Ya;function Se(w,e={}){if(!w)return"";if(!Yt.isReady)return typeof w=="string"?w:w.key;let t,s=e.replace||{},r=e.locale||Yt.locale;typeof w=="string"?t=w.toLowerCase():(t=w.key.toLowerCase(),s=w.replace||s,r=w.locale||r);const i=_e.t(t,{...s,lng:r,returnObjects:!0});if(!_e.exists(t,{lng:r})){const a=`[i18n] Missing translation key: "${t}" for locale: "${r}"`;typeof window<"u"&&window.electronAPI?.logWarn&&window.electronAPI.logWarn(`\x1B[33m${a}\x1B[0m`)}if(typeof i=="object"&&i!==null){const{artisan:a,technical:n}=i;if(a&&n)return`${a} (${n})`}return i}class qa{project;#e=j(0);get version(){return R(this.#e)}set version(e){F(this.#e,e,!0)}incrementVersion(){this.version++}#t=j(we([]));get pixelBuffer(){return R(this.#t)}set pixelBuffer(e){F(this.#t,e,!0)}#s=j(we([]));get strokePoints(){return R(this.#s)}set strokePoints(e){F(this.#s,e,!0)}internalBuffer=new Set;constructor(e){this.project=e}mount(){wt(()=>{this.compositePixels,this.project.activeFrameIndex,this.project.activeFrame.activeLayerIndex,this.incrementVersion()})}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get pixels(){return this.project.activeFrame.activeLayer.pixels}get compositePixels(){return this.project.activeFrame.compositePixels}set pixels(e){const t=this.project.activeFrame,s=t.activeLayerIndex,r=t.activeLayer;r.pixels=e,r.isLinked&&this.project.frames.forEach((i,a)=>{if(a!==this.project.activeFrameIndex){const n=i.layers[s];n&&(n.pixels=e)}}),this.incrementVersion()}clearBuffer(){this.internalBuffer.clear(),this.pixelBuffer=[],this.strokePoints=[]}addBatchToBuffer(e){const t=[...this.strokePoints];e.forEach(s=>{const r=Math.floor(s.x),i=Math.floor(s.y);this.isValidCoord(r,i)&&(this.internalBuffer.add(this.getIndex(r,i)),t.push({x:s.x,y:s.y}))}),this.strokePoints=t,this.pixelBuffer=Array.from(this.internalBuffer)}addToBuffer(e,t){this.addBatchToBuffer([{x:e,y:t}])}reset(e,t,s){this.width=e,this.height=t,this.pixels=s,this.incrementVersion()}clear(){this.project.activeFrame.activeLayer.clear(),this.incrementVersion()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.compositePixels[this.getIndex(e,t)]}setColor(e,t,s){this.pixels[this.getIndex(e,t)]=s}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}#r=Te(()=>`calc((100cqi - 20px) * ${this.width} / (${this.width} + 2))`);get fitWidth(){return R(this.#r)}set fitWidth(e){F(this.#r,e)}#i=Te(()=>`calc((100cqb - 20px) * ${this.height} / (${this.height} + 2))`);get fitHeight(){return R(this.#i)}set fitHeight(e){F(this.#i,e)}getFitDimension(e){const t=this.width,s=this.height;return e==="horizontal"?`min(${this.fitWidth}, calc(${this.fitHeight} * (${t} / ${s})))`:`min(${this.fitHeight}, calc(${this.fitWidth} * (${s} / ${t})))`}}class Xa{#e=j(we({x:0,y:0}));get pos(){return R(this.#e)}set pos(e){F(this.#e,e,!0)}#t=j(!0);get isVisible(){return R(this.#t)}set isVisible(e){F(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}const Ja=["#fdf6e3","#f4f1bb","#d1e0d0","#a3b18a","#588157","#3a5a40","#344e41","#dad7cd","#8d99ae","#2b2d42"],Qa=["#b58900","#cb4b16","#e5989b","#6d597a","#b08968","#7f5539","#d4a373","#ccd5ae","#6b705c","#333d29"],et={sanctuary_nature:Ja,sanctuary_craft:Qa};class me{static toHex(e){const{h:t,s,l:r,a:i}=e,a=(t%360+360)%360/360,n=Math.max(0,Math.min(100,s))/100,o=Math.max(0,Math.min(100,r))/100;let l,c,d;if(n===0)l=c=d=o;else{const g=o<.5?o*(1+n):o+n-o*n,p=2*o-g,m=v=>(v<0&&(v+=1),v>1&&(v-=1),v<1/6?p+(g-p)*6*v:v<1/2?g:v<2/3?p+(g-p)*(2/3-v)*6:p);l=m(a+1/3),c=m(a),d=m(a-1/3)}const _=g=>Math.max(0,Math.min(255,Math.round(g*255))).toString(16).padStart(2,"0"),h=Math.max(0,Math.min(255,Math.round(i*255))).toString(16).padStart(2,"0");return`#${_(l)}${_(c)}${_(d)}${h}`.toUpperCase()}static toHSLA(e){let t=0,s=0,r=0,i=1;const a=e.replace("#","");a.length===3||a.length===4?(t=parseInt(a[0]+a[0],16),s=parseInt(a[1]+a[1],16),r=parseInt(a[2]+a[2],16),a.length===4&&(i=parseInt(a[3]+a[3],16)/255)):(a.length===6||a.length===8)&&(t=parseInt(a.substring(0,2),16),s=parseInt(a.substring(2,4),16),r=parseInt(a.substring(4,6),16),a.length===8&&(i=parseInt(a.substring(6,8),16)/255)),t/=255,s/=255,r/=255;const n=Math.max(t,s,r),o=Math.min(t,s,r);let l=0,c=0,d=(n+o)/2;if(n!==o){const _=n-o;switch(c=d>.5?_/(2-n-o):_/(n+o),n){case t:l=(s-r)/_+(s<r?6:0);break;case s:l=(r-t)/_+2;break;case r:l=(t-s)/_+4;break}l/=6}return{h:l*360,s:c*100,l:d*100,a:parseFloat(i.toFixed(4))}}static adjustBrightness(e,t){const s=this.toHSLA(e);return s.l=Math.max(0,Math.min(100,s.l+t*100)),this.toHex(s)}static adjustSaturation(e,t){const s=this.toHSLA(e);return s.s=Math.max(0,Math.min(100,s.s+t*100)),this.toHex(s)}static adjustOpacity(e,t){const s=this.toHSLA(e);return s.a=Math.max(0,Math.min(1,t)),this.toHex(s)}static mix(e,t,s=.5){const r=this.hexToRgb(e),i=this.hexToRgb(t),a={r:Math.round(r.r*(1-s)+i.r*s),g:Math.round(r.g*(1-s)+i.g*s),b:Math.round(r.b*(1-s)+i.b*s),a:r.a*(1-s)+i.a*s};return this.rgbToHex(a.r,a.g,a.b,a.a)}static rgbaCache=new Map;static toRGBA(e){if(this.rgbaCache.has(e))return this.rgbaCache.get(e);const{r:t,g:s,b:r,a:i}=this.hexToRgb(e),a=new Uint8ClampedArray([t,s,r,Math.round(i*255)]);return this.rgbaCache.set(e,a),a}static hexToUint32(e){if(!e)return 0;const{r:t,g:s,b:r,a:i}=this.hexToRgb(e);return(Math.round(i*255)<<24|r<<16|s<<8|t)>>>0}static uint32ToHex(e){if(e===0)return null;const t=e&255,s=e>>8&255,r=e>>16&255,i=e>>24&255;return this.rgbToHex(t,s,r,i/255)}static applyTemperature(e,t){const{r:s,g:r,b:i,a}=this.hexToRgb(e),n=t*50;return this.rgbToHex(Math.max(0,Math.min(255,s+n)),Math.max(0,Math.min(255,r+n*.5)),Math.max(0,Math.min(255,i-n)),a)}static hexToRgb(e){const t=e.replace("#","");let s=0,r=0,i=0,a=1;return(t.length===6||t.length===8)&&(s=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16),t.length===8&&(a=parseInt(t.substring(6,8),16)/255)),{r:s,g:r,b:i,a}}static rgbToHex(e,t,s,r){const i=n=>Math.round(n).toString(16).padStart(2,"0"),a=Math.round(r*255).toString(16).padStart(2,"0");return`#${i(e)}${i(t)}${i(s)}${a}`.toUpperCase()}static toGPL(e,t){let s=`GIMP Palette
Name: ${e}
Columns: 4
#
`;return t.forEach(r=>{const{r:i,g:a,b:n}=this.hexToRgb(r);s+=`${i.toString().padStart(3)} ${a.toString().padStart(3)} ${n.toString().padStart(3)} Untitled
`}),s}static parsePaletteText(e){const t=[],s=/#([A-Fa-f0-9]{8}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/g;let r;for(;(r=s.exec(e))!==null;)t.push(r[0]);return t.length>0||e.split(`
`).forEach(a=>{const n=a.trim();if(!n||n.startsWith("GIMP")||n.startsWith("Name:")||n.startsWith("#"))return;const o=n.split(/\s+/).filter(l=>l.length>0);if(o.length>=3){const l=parseInt(o[0],10),c=parseInt(o[1],10),d=parseInt(o[2],10);!isNaN(l)&&!isNaN(c)&&!isNaN(d)&&t.push(this.rgbToHex(l,c,d,1))}}),t}}class eo{#e=j(we(et.sanctuary_nature[0]));get activeColor(){return R(this.#e)}set activeColor(e){F(this.#e,e,!0)}#t=j(we(et.sanctuary_nature));get swatches(){return R(this.#t)}set swatches(e){F(this.#t,e,!0)}#s=j(we([]));get presets(){return R(this.#s)}set presets(e){F(this.#s,e,!0)}constructor(){this.restoreDefaultPresets();const e=this.sortPaletteForAccessibility([...this.swatches]);this.swatches=e,this.activeColor=e[0]}restoreDefaultPresets(){const e=Object.entries(et).map(([t,s])=>({id:`default-${t}`,name:t.charAt(0).toUpperCase()+t.slice(1),colors:this.sortPaletteForAccessibility(s),isDefault:!0}));this.presets=e}sortPaletteForAccessibility(e){if(e.length<=1)return e;const t=[...e],s=this.findDarkestIndex(t);if(s!==0){const[r]=t.splice(s,1);t.unshift(r)}return t}findDarkestIndex(e){let t=101,s=0;return e.forEach((r,i)=>{const a=me.toHSLA(r);a.l<t&&(t=a.l,s=i)}),s}select(e){e>=0&&e<this.swatches.length&&(this.activeColor=this.swatches[e])}setColor(e){this.activeColor=e}addSwatch(e){this.swatches.includes(e)||this.swatches.push(e),this.activeColor=e}removeSwatch(e){this.swatches.length<=1||(this.swatches.splice(e,1),this.swatches.includes(this.activeColor)||(this.activeColor=this.swatches[0]))}newPalette(){this.swatches=[this.activeColor]}importPalette(e){const t=me.parsePaletteText(e);return t.length>0?(this.swatches=this.sortPaletteForAccessibility(t),this.activeColor=this.swatches[0],!0):!1}savePreset(e){const t={id:crypto.randomUUID(),name:e,colors:[...this.swatches],isDefault:!1};return this.presets.push(t),rt(async()=>{const{services:s}=await Promise.resolve().then(()=>Jt);return{services:s}},void 0,import.meta.url).then(({services:s})=>{s.persistence.saveGlobalPalettes()}),t}applyPreset(e){const t=this.presets.find(s=>s.id===e);t&&(this.swatches=this.sortPaletteForAccessibility([...t.colors]),this.activeColor=this.swatches[0])}deletePreset(e){const t=this.presets.find(s=>s.id===e);t&&!t.isDefault&&(this.presets=this.presets.filter(s=>s.id!==e),rt(async()=>{const{services:s}=await Promise.resolve().then(()=>Jt);return{services:s}},void 0,import.meta.url).then(({services:s})=>{s.persistence.saveGlobalPalettes()}))}loadPalette(e){this.swatches=this.sortPaletteForAccessibility(et[e]),this.activeColor=this.swatches[0]}}const to=["showColorPicker","showAudioSettings","showCommandPalette","showShortcuts","showManual","showExportMenu","showPaletteLibrary","showCanvasSettings","showPersistenceMenu","showUnderlayMenu","showGoTo","showPourBasin"],so={managed:to};class ro{#e=j(1);get zoomLevel(){return R(this.#e)}set zoomLevel(e){F(this.#e,e,!0)}#t=j(we({x:0,y:0}));get panOffset(){return R(this.#t)}set panOffset(e){F(this.#t,e,!0)}#s=j(!1);get isHandToolActive(){return R(this.#s)}set isHandToolActive(e){F(this.#s,e,!0)}#r=j(!1);get isMuted(){return R(this.#r)}set isMuted(e){F(this.#r,e,!0)}#i=j(!0);get isAmbientPlaying(){return R(this.#i)}set isAmbientPlaying(e){F(this.#i,e,!0)}#n=j(!1);get isAppReady(){return R(this.#n)}set isAppReady(e){F(this.#n,e,!0)}#a=j(!1);get isAudioReady(){return R(this.#a)}set isAudioReady(e){F(this.#a,e,!0)}#o=j(!1);get isPicking(){return R(this.#o)}set isPicking(e){F(this.#o,e,!0)}#l=j(!1);get isTransforming(){return R(this.#l)}set isTransforming(e){F(this.#l,e,!0)}#c=j("light");get theme(){return R(this.#c)}set theme(e){F(this.#c,e,!0)}#h=j(1);get brushSize(){return R(this.#h)}set brushSize(e){F(this.#h,e,!0)}#u=j(100);get brushHardness(){return R(this.#u)}set brushHardness(e){F(this.#u,e,!0)}#d=j(!1);get isDitherBlendActive(){return R(this.#d)}set isDitherBlendActive(e){F(this.#d,e,!0)}#f=j("SQUARE");get brushShape(){return R(this.#f)}set brushShape(e){F(this.#f,e,!0)}#p=j("OFF");get symmetryMode(){return R(this.#p)}set symmetryMode(e){F(this.#p,e,!0)}#g=j(!1);get isTilingEnabled(){return R(this.#g)}set isTilingEnabled(e){F(this.#g,e,!0)}#m=j(!1);get isAlphaLocked(){return R(this.#m)}set isAlphaLocked(e){F(this.#m,e,!0)}#y=j(!1);get isColorLocked(){return R(this.#y)}set isColorLocked(e){F(this.#y,e,!0)}#v=j(!1);get isPixelPerfect(){return R(this.#v)}set isPixelPerfect(e){F(this.#v,e,!0)}#_=j(null);get colorLockSource(){return R(this.#_)}set colorLockSource(e){F(this.#_,e,!0)}#w=j(!1);get isAirbrushActive(){return R(this.#w)}set isAirbrushActive(e){F(this.#w,e,!0)}#b=j(.2);get airbrushDensity(){return R(this.#b)}set airbrushDensity(e){F(this.#b,e,!0)}#x=j(!1);get isShadingLighten(){return R(this.#x)}set isShadingLighten(e){F(this.#x,e,!0)}#S=j(!1);get isShadingDarken(){return R(this.#S)}set isShadingDarken(e){F(this.#S,e,!0)}#k=j(!1);get isShadingDither(){return R(this.#k)}set isShadingDither(e){F(this.#k,e,!0)}#E=j("BRUSH");get activeTool(){return R(this.#E)}set activeTool(e){F(this.#E,e,!0)}#C=j(null);get shapeAnchor(){return R(this.#C)}set shapeAnchor(e){F(this.#C,e,!0)}#A=j(3);get polygonSides(){return R(this.#A)}set polygonSides(e){F(this.#A,e,!0)}#L=j(0);get polygonIndentation(){return R(this.#L)}set polygonIndentation(e){F(this.#L,e,!0)}#T=j(50);get stabilization(){return R(this.#T)}set stabilization(e){F(this.#T,e,!0)}#P=j(.5);get bgmVolume(){return R(this.#P)}set bgmVolume(e){F(this.#P,e,!0)}#I=j(.5);get sfxVolume(){return R(this.#I)}set sfxVolume(e){F(this.#I,e,!0)}#O=j(!1);get isKineticMode(){return R(this.#O)}set isKineticMode(e){F(this.#O,e,!0)}#R=j(!1);get showGhostLayers(){return R(this.#R)}set showGhostLayers(e){F(this.#R,e,!0)}#M=j(1);get timelineZoom(){return R(this.#M)}set timelineZoom(e){F(this.#M,e,!0)}#F=j(!1);get isTimelineMinimized(){return R(this.#F)}set isTimelineMinimized(e){F(this.#F,e,!0)}#D=j(!1);get isTimelineMaximized(){return R(this.#D)}set isTimelineMaximized(e){F(this.#D,e,!0)}sessionStartTime=Date.now();#B=j(0);get usageMinutes(){return R(this.#B)}set usageMinutes(e){F(this.#B,e,!0)}#j=j(0);get usageSeconds(){return R(this.#j)}set usageSeconds(e){F(this.#j,e,!0)}#z=j(null);get underlayImage(){return R(this.#z)}set underlayImage(e){F(this.#z,e,!0)}#N=j(!0);get isUnderlayVisible(){return R(this.#N)}set isUnderlayVisible(e){F(this.#N,e,!0)}#U=j(.2);get underlayOpacity(){return R(this.#U)}set underlayOpacity(e){F(this.#U,e,!0)}#V=j(we({x:0,y:0}));get underlayOffset(){return R(this.#V)}set underlayOffset(e){F(this.#V,e,!0)}#$=j(1);get underlayScale(){return R(this.#$)}set underlayScale(e){F(this.#$,e,!0)}#H=j(!1);get isPatternBrushActive(){return R(this.#H)}set isPatternBrushActive(e){F(this.#H,e,!0)}#G=j(null);get patternBrushData(){return R(this.#G)}set patternBrushData(e){F(this.#G,e,!0)}#W=j("layers");get projectActiveTab(){return R(this.#W)}set projectActiveTab(e){F(this.#W,e,!0)}#K=j(!1);get showColorPicker(){return R(this.#K)}set showColorPicker(e){F(this.#K,e,!0)}#Z=j(!1);get showAudioSettings(){return R(this.#Z)}set showAudioSettings(e){F(this.#Z,e,!0)}#Y=j(!1);get showCommandPalette(){return R(this.#Y)}set showCommandPalette(e){F(this.#Y,e,!0)}#q=j(!1);get showShortcuts(){return R(this.#q)}set showShortcuts(e){F(this.#q,e,!0)}#X=j(!1);get showManual(){return R(this.#X)}set showManual(e){F(this.#X,e,!0)}#J=j(!1);get showExportMenu(){return R(this.#J)}set showExportMenu(e){F(this.#J,e,!0)}#Q=j(!1);get showPaletteLibrary(){return R(this.#Q)}set showPaletteLibrary(e){F(this.#Q,e,!0)}#ee=j(!1);get showCanvasSettings(){return R(this.#ee)}set showCanvasSettings(e){F(this.#ee,e,!0)}#te=j(!1);get showPersistenceMenu(){return R(this.#te)}set showPersistenceMenu(e){F(this.#te,e,!0)}#se=j(!1);get showUnderlayMenu(){return R(this.#se)}set showUnderlayMenu(e){F(this.#se,e,!0)}#re=j(!1);get showGoTo(){return R(this.#re)}set showGoTo(e){F(this.#re,e,!0)}#ie=j(!1);get showPourBasin(){return R(this.#ie)}set showPourBasin(e){F(this.#ie,e,!0)}#ne=j(!0);get showMinimap(){return R(this.#ne)}set showMinimap(e){F(this.#ne,e,!0)}#ae=j(!1);get showErrorDialog(){return R(this.#ae)}set showErrorDialog(e){F(this.#ae,e,!0)}#oe=j(!1);get showRecoveryPrompt(){return R(this.#oe)}set showRecoveryPrompt(e){F(this.#oe,e,!0)}#le=j("");get toastMessage(){return R(this.#le)}set toastMessage(e){F(this.#le,e,!0)}#ce=j(!1);get showToast(){return R(this.#ce)}set showToast(e){F(this.#ce,e,!0)}toastTimer=null;#he=j(null);get lastError(){return R(this.#he)}set lastError(e){F(this.#he,e,!0)}#ue=j(null);get contextMenu(){return R(this.#ue)}set contextMenu(e){F(this.#ue,e,!0)}#de=j("#fdf6e3");get backgroundColor(){return R(this.#de)}set backgroundColor(e){F(this.#de,e,!0)}#fe=j(10);get exportScale(){return R(this.#fe)}set exportScale(e){F(this.#fe,e,!0)}#pe=j("transparent");get exportBgColor(){return R(this.#pe)}set exportBgColor(e){F(this.#pe,e,!0)}#ge=j("ACTIVE");get exportFrameSelection(){return R(this.#ge)}set exportFrameSelection(e){F(this.#ge,e,!0)}#me=j(0);get exportProgress(){return R(this.#me)}set exportProgress(e){F(this.#me,e,!0)}#ye=j(!1);get includePixelBorders(){return R(this.#ye)}set includePixelBorders(e){F(this.#ye,e,!0)}escapeStack=[];#ve=j(we([]));get _overlayStack(){return R(this.#ve)}set _overlayStack(e){F(this.#ve,e,!0)}_managedOverlays=so.managed;constructor(){if(typeof window<"u"){const e=localStorage.getItem("rupa_theme");e==="dark"||e==="light"?this.theme=e:window.matchMedia("(prefers-color-scheme: dark)").matches&&(this.theme="dark")}setInterval(()=>{const e=Date.now()-this.sessionStartTime;this.usageMinutes=Math.floor(e/6e4),this.usageSeconds=Math.floor(e/1e3)},1e3)}mount(){wt(()=>{typeof document<"u"&&document.documentElement.setAttribute("data-theme",this.theme)}),wt(()=>{for(const e of this._managedOverlays)this[e]?Je(()=>this._overlayStack.includes(e))||(this._overlayStack=[...Je(()=>this._overlayStack),e]):Je(()=>this._overlayStack.includes(e))&&(this._overlayStack=Je(()=>this._overlayStack.filter(s=>s!==e)))})}show(e){this.toastMessage=e,this.showToast=!0,this.toastTimer&&clearTimeout(this.toastTimer),this.toastTimer=setTimeout(()=>{this.showToast=!1},2e3)}reportError(e,t,s){this.lastError={title:e,message:t,technical:s,timestamp:new Date},this.showErrorDialog=!0}toggleTheme(){this.theme=this.theme==="light"?"dark":"light",typeof localStorage<"u"&&localStorage.setItem("rupa_theme",this.theme)}setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.1,Math.min(10,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}resetPan(){this.panOffset={x:0,y:0}}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();if(e)return e(),!0;const t=this._overlayStack[this._overlayStack.length-1];return t?(this[t]=!1,!0):!1}#_e=Te(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),s=Math.floor(e%3600/60),r=e%60;return`${t>0?t+":":""}${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`});get sessionTimeLabel(){return R(this.#_e)}set sessionTimeLabel(e){F(this.#_e,e)}}class Fe{id=crypto.randomUUID();#e=j("New Layer");get name(){return R(this.#e)}set name(e){F(this.#e,e,!0)}#t=j(!0);get isVisible(){return R(this.#t)}set isVisible(e){F(this.#t,e,!0)}#s=j(!1);get isLocked(){return R(this.#s)}set isLocked(e){F(this.#s,e,!0)}#r=j(1);get opacity(){return R(this.#r)}set opacity(e){F(this.#r,e,!0)}#i=j(!1);get isLinked(){return R(this.#i)}set isLinked(e){F(this.#i,e,!0)}#n=j(0);get wiggleAmount(){return R(this.#n)}set wiggleAmount(e){F(this.#n,e,!0)}#a=j(0);get swayAmount(){return R(this.#a)}set swayAmount(e){F(this.#a,e,!0)}#o=j(1);get swaySpeed(){return R(this.#o)}set swaySpeed(e){F(this.#o,e,!0)}#l=j(0);get pulseAmount(){return R(this.#l)}set pulseAmount(e){F(this.#l,e,!0)}#c=j(1);get pulseSpeed(){return R(this.#c)}set pulseSpeed(e){F(this.#c,e,!0)}#h=j("LAYER");get type(){return R(this.#h)}set type(e){F(this.#h,e,!0)}#u=j(null);get parentId(){return R(this.#u)}set parentId(e){F(this.#u,e,!0)}#d=j(!1);get isCollapsed(){return R(this.#d)}set isCollapsed(e){F(this.#d,e,!0)}#f=j(new Uint32Array(0));get pixels(){return R(this.#f)}set pixels(e){F(this.#f,e)}#p=Te(()=>{if(this.type==="FOLDER")return!1;for(let e=0;e<this.pixels.length;e++)if(this.pixels[e]!==0)return!0;return!1});get hasContent(){return R(this.#p)}set hasContent(e){F(this.#p,e)}constructor(e,t,s,r="LAYER"){this.name=e,this.type=r,r==="LAYER"&&(this.pixels=new Uint32Array(t*s))}clone(e,t){const s=new Fe(this.name,e,t,this.type);return s.pixels=this.type==="LAYER"?new Uint32Array(this.pixels):new Uint32Array(0),s.isVisible=this.isVisible,s.isLocked=this.isLocked,s.opacity=this.opacity,s.parentId=this.parentId,s.isCollapsed=this.isCollapsed,s}clear(){const e=new Uint32Array(this.pixels.length);e.fill(0),this.pixels=e}hasPixel(e){return this.pixels[e]!==0}}class io{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const no=new io,ao={"c-major":[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25]},oo={move:{freq:450,duration:.08,volume:.15},draw:{freq:1200,volume:.03},startup:{freq:220,duration:.8,volume:.1},ready:[523.25,659.25,783.99,1046.5]},lo={scale:[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25],chords:[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]],fade:{startMins:20,fullMins:50}},Ve={scales:ao,tones:oo,ambient:lo};class co{get ctx(){return no.ctx}playTone(e,t,s="sine",r=.1,i=1e-4){if(f.isMuted)return;const a=this.ctx.createOscillator(),n=this.ctx.createGain();a.type=s,a.frequency.setValueAtTime(e,this.ctx.currentTime);const o=r*f.sfxVolume;n.gain.setValueAtTime(o,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(i,this.ctx.currentTime+t),a.connect(n),n.connect(this.ctx.destination),a.start(),a.stop(this.ctx.currentTime+t)}playMove(){const{freq:e,duration:t,volume:s}=Ve.tones.move;this.ctx.createOscillator();const r=this.ctx.createBiquadFilter();r.type="lowpass",r.frequency.setValueAtTime(400,this.ctx.currentTime),this.playTone(e,t,"square",s*.5,.001)}playDraw(){const{freq:e,volume:t}=Ve.tones.draw;this.playTone(e,.05,"square",t,1e-4),setTimeout(()=>this.playTone(e*1.5,.1,"triangle",t*.3,1e-4),10)}playScale(e){const t=Ve.scales["c-major"],s=t[e%t.length];this.playTone(s,.2,"square",.05,.001),this.playTone(s,.2,"triangle",.08,.001)}playErase(){if(f.isMuted)return;const e=.4,t=this.ctx.sampleRate*e,s=this.ctx.createBuffer(1,t,this.ctx.sampleRate),r=s.getChannelData(0);for(let l=0;l<t;l++)r[l]=Math.round((Math.random()*2-1)*4)/4;const i=this.ctx.createBufferSource();i.buffer=s;const a=this.ctx.createBiquadFilter();a.type="bandpass",a.frequency.setValueAtTime(1e3,this.ctx.currentTime),a.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+e),a.Q.value=2;const n=this.ctx.createGain(),o=.12*f.sfxVolume;n.gain.setValueAtTime(o,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),i.connect(a),a.connect(n),n.connect(this.ctx.destination),i.start()}playStartup(){const{freq:e,duration:t,volume:s}=Ve.tones.startup;this.playTone(e,t,"square",s*.6,1e-4),this.playTone(e*.5,t*2,"triangle",s*.4,1e-4)}playReady(){Ve.tones.ready.forEach((t,s)=>{setTimeout(()=>{this.playTone(t,.8,"triangle",.03,1e-4),this.playTone(t*2,.2,"square",.01,1e-4)},s*120)})}playPaperFlip(){if(f.isMuted)return;const e=.15,t=this.ctx.sampleRate*e,s=this.ctx.createBuffer(1,t,this.ctx.sampleRate),r=s.getChannelData(0);for(let o=0;o<t;o++)r[o]=Math.random()*2-1;const i=this.ctx.createBufferSource();i.buffer=s;const a=this.ctx.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(2e3,this.ctx.currentTime),a.frequency.exponentialRampToValueAtTime(800,this.ctx.currentTime+e);const n=this.ctx.createGain();n.gain.setValueAtTime(.05*f.sfxVolume,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),i.connect(a),a.connect(n),n.connect(this.ctx.destination),i.start()}playCeramicSlide(){f.isMuted||(this.playTone(150,.2,"triangle",.08,.001),this.playTone(100,.3,"sine",.05,.001))}}const ee=new co;class ho{interval=null;#e=j(0);get elapsedTime(){return R(this.#e)}set elapsedTime(e){F(this.#e,e,!0)}#t=Te(()=>{const e=1e3/f.project.fps;return f.project.frames.length*e});get totalDuration(){return R(this.#t)}set totalDuration(e){F(this.#t,e)}startPlayback(){if(f.project.isPlaying)return;if(f.project.frames.length<=1){ee.playErase();return}f.project.isPlaying=!0,this.elapsedTime=0;const e=1e3/f.project.fps;for(let t=0;t<f.project.activeFrameIndex;t++)this.elapsedTime+=e;ee.playDraw(),this.tick()}stopPlayback(){f.project.isPlaying=!1,this.interval&&(clearTimeout(this.interval),this.interval=null)}togglePlayback(){f.project.isPlaying?this.stopPlayback():this.startPlayback()}tick(){if(!f.project.isPlaying)return;f.project.activeFrame;const e=Math.max(16,1e3/f.project.fps);let t=(f.project.activeFrameIndex+1)%f.project.frames.length,s=0;for(;!f.project.frames[t].isVisible&&s<f.project.frames.length;)t=(t+1)%f.project.frames.length,s++;if(!f.project.frames[t].isVisible){this.stopPlayback();return}this.interval=setTimeout(()=>{f.project.activeFrameIndex=t,t===0?this.elapsedTime=0:this.elapsedTime+=e,this.tick()},e)}}const uo=new ho;class ot{id=crypto.randomUUID();#e=j("Untitled Frame");get name(){return R(this.#e)}set name(e){F(this.#e,e,!0)}#t=j(32);get width(){return R(this.#t)}set width(e){F(this.#t,e,!0)}#s=j(32);get height(){return R(this.#s)}set height(e){F(this.#s,e,!0)}#r=j(1);get opacity(){return R(this.#r)}set opacity(e){F(this.#r,e,!0)}#i=j(!0);get isVisible(){return R(this.#i)}set isVisible(e){F(this.#i,e,!0)}#n=j(we([]));get layers(){return R(this.#n)}set layers(e){F(this.#n,e,!0)}#a=j(0);get activeLayerIndex(){return R(this.#a)}set activeLayerIndex(e){F(this.#a,e,!0)}#o=j(we(new Set([0])));get selectedLayerIndices(){return R(this.#o)}set selectedLayerIndices(e){F(this.#o,e,!0)}_cachedComposite=new Uint32Array(0);_lastRenderVersion=-1;_lastTimeKey=-1;constructor(e,t=32,s=32){this.name=e,this.width=t,this.height=s,this.layers=[new Fe("Base Layer",t,s)]}get activeLayer(){return this.layers[this.activeLayerIndex]}get compositePixels(){const e=this.layers.map(a=>`${a.id}-${a.isVisible}-${a.parentId}-${a.pixels}`).join("|"),t=uo.elapsedTime/1e3,s=Math.floor(t*60);if(this._cachedComposite.length===this.width*this.height&&this._lastTimeKey===s&&this._lastStructuralKey===e)return this._cachedComposite;this._lastStructuralKey=e;const r=new Uint32Array(this.width*this.height),i=new Map;this.layers.forEach(a=>{a.type==="FOLDER"&&i.set(a.id,a.isVisible)});for(const a of this.layers){if(a.type==="FOLDER"||!a.isVisible||a.parentId&&i.get(a.parentId)===!1)continue;let n=0,o=0;a.swayAmount>0&&(n+=Math.sin(t*a.swaySpeed*Math.PI)*a.swayAmount),a.wiggleAmount>0&&(n+=(Math.sin(t*20)+Math.cos(t*13))*(a.wiggleAmount/2),o+=(Math.cos(t*17)+Math.sin(t*11))*(a.wiggleAmount/2));const l=a.pixels;for(let c=0;c<r.length;c++){const d=l[c];if(d!==0)if(n!==0||o!==0){const _=c%this.width,h=Math.floor(c/this.width),g=Math.round(_+n),p=Math.round(h+o);g>=0&&g<this.width&&p>=0&&p<this.height&&(r[p*this.width+g]=d)}else r[c]=d}}return this._cachedComposite=r,this._lastTimeKey=s,r}addLayer(e){const t=e||`Layer ${this.layers.length+1}`,s=new Fe(t,this.width,this.height),r=this.activeLayer;return r.type==="FOLDER"?s.parentId=r.id:r.parentId&&(s.parentId=r.parentId),this.layers.push(s),this.activeLayerIndex=this.layers.length-1,s}addGroup(e){const t=e||`Group ${this.layers.length+1}`,s=new Fe(t,this.width,this.height,"FOLDER");return this.layers.push(s),this.activeLayerIndex=this.layers.length-1,s}removeLayer(e){if(this.layers.length<=1)return;const t=this.layers[e];t.type==="FOLDER"&&this.layers.forEach(s=>{s.parentId===t.id&&(s.parentId=null)}),this.layers.splice(e,1),this.activeLayerIndex>=this.layers.length&&(this.activeLayerIndex=this.layers.length-1)}getSelectedLayerComposite(){const e=new Uint32Array(this.width*this.height),t=Array.from(this.selectedLayerIndices),s=new Set;this.layers.forEach((r,i)=>{t.includes(i)&&r.type==="FOLDER"&&s.add(r.id)});for(const r of this.layers){if(r.type==="FOLDER")continue;const i=t.includes(this.layers.indexOf(r)),a=r.parentId&&s.has(r.parentId);if(i||a){const n=r.pixels;for(let o=0;o<e.length;o++){const l=n[o];l!==0&&(e[o]=l)}}}return e}}class fo{#e=j(null);get currentFilePath(){return R(this.#e)}set currentFilePath(e){F(this.#e,e,!0)}#t=j(null);get lastSaved(){return R(this.#t)}set lastSaved(e){F(this.#t,e,!0)}#s=j(we([]));get frames(){return R(this.#s)}set frames(e){F(this.#s,e,!0)}#r=j(we([]));get tags(){return R(this.#r)}set tags(e){F(this.#r,e,!0)}#i=j(0);get activeFrameIndex(){return R(this.#i)}set activeFrameIndex(e){F(this.#i,e,!0)}#n=j(we(new Set([0])));get selectedFrameIndices(){return R(this.#n)}set selectedFrameIndices(e){F(this.#n,e,!0)}#a=j(!1);get isPlaying(){return R(this.#a)}set isPlaying(e){F(this.#a,e,!0)}#o=j(10);get fps(){return R(this.#o)}set fps(e){F(this.#o,e,!0)}#l=j(null);get clipboard(){return R(this.#l)}set clipboard(e){F(this.#l,e,!0)}constructor(){this.frames=[new ot("Main Art")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,s=new ot(t);return this.frames.push(s),this.activeFrameIndex=this.frames.length-1,s}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e=null){this.currentFilePath=e,this.lastSaved=new Date}}class po{#e=j(null);get start(){return R(this.#e)}set start(e){F(this.#e,e,!0)}#t=j(null);get end(){return R(this.#t)}set end(e){F(this.#t,e,!0)}#s=j(new Uint8Array(0));get _mask(){return R(this.#s)}set _mask(e){F(this.#s,e)}#r=j(0);get maskCount(){return R(this.#r)}set maskCount(e){F(this.#r,e,!0)}get mask(){return this._mask}set mask(e){this._mask=e;let t=0;for(let s=0;s<e.length;s++)e[s]===1&&t++;this.maskCount=t}#i=j("NEW");get selectionMode(){return R(this.#i)}set selectionMode(e){F(this.#i,e,!0)}#n=j(we([]));get vertices(){return R(this.#n)}set vertices(e){F(this.#n,e,!0)}initMask(e,t){this._mask.length!==e*t&&(this._mask=new Uint8Array(e*t),this.maskCount=0)}isSelected(e){return this._mask[e]===1}get isActive(){return this.start!==null||this.vertices.length>0||this.maskCount>0}#a=Te(()=>{const e=new Set;for(let t=0;t<this._mask.length;t++)this._mask[t]===1&&e.add(t);return e});get activeIndicesSet(){return R(this.#a)}set activeIndicesSet(e){F(this.#a,e)}begin(e,t){this.selectionMode==="NEW"&&this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.vertices=[];const e=new Uint8Array(this._mask.length);e.fill(0),this._mask=e,this.maskCount=0}getPoints(e){const t=[];for(let r=0;r<this._mask.length;r++)this._mask[r]===1&&t.push({x:r%e,y:Math.floor(r/e)});const s=this.rectangularBounds;if(s){const r=new Set(t.map(i=>i.y*e+i.x));for(let i=s.y1;i<=s.y2;i++)for(let a=s.x1;a<=s.x2;a++){const n=i*e+a;r.has(n)||t.push({x:a,y:i})}}return t}getBoundaryEdges(e){const t=[],s=Math.floor(this._mask.length/e);for(let i=0;i<this._mask.length;i++)if(this._mask[i]===1){const a=i%e,n=Math.floor(i/e);(n===0||this._mask[(n-1)*e+a]===0)&&t.push({x1:a,y1:n,x2:a+1,y2:n}),(n===s-1||this._mask[(n+1)*e+a]===0)&&t.push({x1:a,y1:n+1,x2:a+1,y2:n+1}),(a===0||this._mask[n*e+(a-1)]===0)&&t.push({x1:a,y1:n,x2:a,y2:n+1}),(a===e-1||this._mask[n*e+(a+1)]===0)&&t.push({x1:a+1,y1:n,x2:a+1,y2:n+1})}const r=this.rectangularBounds;if(r){const i=[{x1:r.x1,y1:r.y1,x2:r.x2+1,y2:r.y1},{x1:r.x1,y1:r.y2+1,x2:r.x2+1,y2:r.y2+1},{x1:r.x1,y1:r.y1,x2:r.x1,y2:r.y2+1},{x1:r.x2+1,y1:r.y1,x2:r.x2+1,y2:r.y2+1}];t.push(...i)}return t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){let t=1/0,s=-1/0,r=1/0,i=-1/0,a=!1;for(let n=0;n<this._mask.length;n++)if(this._mask[n]===1){const o=n%e,l=Math.floor(n/e);o<t&&(t=o),o>s&&(s=o),l<r&&(r=l),l>i&&(i=l),a=!0}return a?{x1:t,x2:s,y1:r,y2:i,width:s-t+1,height:i-r+1}:null}}class xe{static getLinePoints(e,t,s,r,i=0){e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),r=Math.floor(r);const a=[],n=Math.abs(s-e),o=Math.abs(r-t),l=e<s?1:-1,c=t<r?1:-1;let d=n-o;for(;;){a.push({x:e,y:t});const _=n===o,h=n===0||o===0;if(i>.9&&!_&&!h&&(n>o?a.push({x:e,y:t+c}):a.push({x:e+l,y:t})),e===s&&t===r)break;const g=2*d;g>-o&&(d-=o,e+=l),g<n&&(d+=n,t+=c)}return a}static getCirclePoints(e,t,s){e=Math.floor(e),t=Math.floor(t),s=Math.round(s);const r=[];let i=s,a=0,n=0;for(;i>=a;)[{x:e+i,y:t+a},{x:e+a,y:t+i},{x:e-a,y:t+i},{x:e-i,y:t+a},{x:e-i,y:t-a},{x:e-a,y:t-i},{x:e+a,y:t-i},{x:e+i,y:t-a}].forEach(l=>r.push(l)),n<=0&&(a+=1,n+=2*a+1),n>0&&(i-=1,n-=2*i+1);return r}static fitArc(e,t){if(e.length<10)return null;let s=0,r=0;e.forEach(T=>{s+=T.x,r+=T.y});const i=s/e.length,a=r/e.length;let n=0;const o=e.map(T=>{const $=Math.sqrt((T.x-i)**2+(T.y-a)**2);return n+=$,$}),l=n/e.length;let c=0;if(o.forEach(T=>{c+=(T-l)**2}),Math.sqrt(c/e.length)/(l||1)>t)return null;const h=e[0],g=e[e.length-1],m=Math.sqrt((h.x-g.x)**2+(h.y-g.y)**2)<l*1.5||e.length>l*Math.PI*1.5,v=[],b=Math.atan2(e[0].y-a,e[0].x-i),k=Math.atan2(e[e.length-1].y-a,e[e.length-1].x-i),C=Math.max(32,Math.floor(l*10));let A=k-b;for(;A>Math.PI;)A-=Math.PI*2;for(;A<-Math.PI;)A+=Math.PI*2;const z=m?Math.PI*2:A;for(let T=0;T<=C;T++){const $=b+z*(T/C);v.push({x:i+Math.cos($)*l,y:a+Math.sin($)*l})}return{cx:i,cy:a,r:l,isFull:m,points:v}}static perpendicularDistance(e,t,s){const r=s.x-t.x,i=s.y-t.y;return r===0&&i===0?Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2):Math.abs(i*e.x-r*e.y+s.x*t.y-s.y*t.x)/Math.sqrt(r*r+i*i)}static toCartesianLabel(e,t,s=!1){const r=Math.floor(t/2),i=t%2===0?e<r?e-r:e-r+1:e-r;return s?-i:i}static internalToCartesian(e,t,s,r){return{x:this.toCartesianLabel(e,s),y:this.toCartesianLabel(t,r,!0)}}static cartesianToInternal(e,t,s,r){const i=Math.floor(s/2),a=Math.floor(r/2);let n,o;s%2===0?n=e<0?e+i:e+i-1:n=e+i;const l=-t;return r%2===0?o=l<0?l+a:l+a-1:o=l+a,{x:Math.max(0,Math.min(s-1,n)),y:Math.max(0,Math.min(r-1,o))}}static getGuidePosition(e,t){return 50+e/t*100}static mapScreenToGrid(e,t,s,r,i){const a=(e-s.left)/s.width,n=(t-s.top)/s.height;return{x:a*r,y:n*i}}static calculateCameraTransform(e,t,s,r,i){const{x:a,y:n}=t;if(e<=1)return`translate(calc(-50% + ${a}px), calc(-50% + ${n}px)) scale(${e})`;const o=(s.x+.5)/r*100,l=(s.y+.5)/i*100;return`translate(calc(-${o}% + ${a}px), calc(-${l}% + ${n}px)) scale(${e})`}static calculatePanDelta(e,t,s,r){return{dx:e-s,dy:t-r}}}class ve{static getSymmetryPoints(e,t,s,r,i){const a=[],n=s-1-e,o=r-1-t;return i==="HORIZONTAL"?a.push({x:n,y:t}):i==="VERTICAL"?a.push({x:e,y:o}):i==="QUADRANT"&&(a.push({x:n,y:t}),a.push({x:e,y:o}),a.push({x:n,y:o})),a}static wrap(e,t,s,r){return{x:(e%s+s)%s,y:(t%r+r)%r}}static floodFill(e,t,s,r,i,a){const n=e[i*t+r];if(n===a)return e;const o=[...e],l=[[r,i]];for(;l.length>0;){let[c,d]=l.pop(),_=c;for(;_>0&&o[d*t+(_-1)]===n;)o[d*t+(_-1)]=a,_--;for(;c<t&&o[d*t+c]===n;)o[d*t+c]=a,c++;this.scan(_,c-1,d-1,t,s,o,n,l),this.scan(_,c-1,d+1,t,s,o,n,l)}return o}static scan(e,t,s,r,i,a,n,o){if(s<0||s>=i)return;let l=!1;for(let c=e;c<=t;c++)a[s*r+c]===n?l||(o.push([c,s]),l=!0):l=!1}static recolor(e,t,s){return e.map(r=>r===t?s:r)}static getColorUsage(e){const t=new Set;return e.forEach(s=>{s&&t.add(s)}),t}static pixelPerfectFilter(e){if(e.length<3)return e;const t=[e[0]];for(let s=1;s<e.length;s++){const r=e[s],i=t[t.length-1];if(!(r.x===i.x&&r.y===i.y)){if(t.length>=2){const a=t[t.length-2],n=Math.abs(r.x-a.x),o=Math.abs(r.y-a.y);n<=1&&o<=1&&t.pop()}t.push(r)}}return t}static BAYER_4X4=[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]];static orderedDither(e,t,s){if(s>=1)return!0;if(s<=0)return!1;const r=(e%4+4)%4,i=(t%4+4)%4,a=this.BAYER_4X4[i][r]/16;return s>a}static getRectanglePoints(e,t,s,r){const i=[],a=Math.min(e,s),n=Math.max(e,s),o=Math.min(t,r),l=Math.max(t,r);for(let c=a;c<=n;c++)i.push({x:c,y:o}),i.push({x:c,y:l});for(let c=o+1;c<l;c++)i.push({x:a,y:c}),i.push({x:n,y:c});return i}static getEllipsePoints(e,t,s,r){const i=(e+s)/2,a=(t+r)/2,n=Math.abs(s-e)/2,o=Math.abs(r-t)/2;if(n===0||o===0)return[];const l=[];let c=0,d=o,_=o*o-n*n*o+.25*n*n,h=2*o*o*c,g=2*n*n*d;for(;h<g;)this.addEllipsePoints(l,i,a,c,d),_<0?(c++,h=h+2*o*o,_=_+h+o*o):(c++,d--,h=h+2*o*o,g=g-2*n*n,_=_+h-g+o*o);let p=o*o*((c+.5)*(c+.5))+n*n*((d-1)*(d-1))-n*n*o*o;for(;d>=0;)this.addEllipsePoints(l,i,a,c,d),p>0?(d--,g=g-2*n*n,p=p+n*n-g):(d--,c++,h=h+2*o*o,g=g-2*n*n,p=p+h-g+n*n);return l}static addEllipsePoints(e,t,s,r,i){e.push({x:Math.round(t+r),y:Math.round(s+i)}),e.push({x:Math.round(t-r),y:Math.round(s+i)}),e.push({x:Math.round(t+r),y:Math.round(s-i)}),e.push({x:Math.round(t-r),y:Math.round(s-i)})}static getPolygonPoints(e,t,s,r,i,a=0){const n=(e+s)/2,o=(t+r)/2,l=Math.abs(s-e)/2,c=Math.abs(r-t)/2,d=Math.max(l,c);if(d===0)return[];const _=[],h=-Math.PI/2;if(a>0){const p=d*(1-a/100);for(let m=0;m<i*2;m++){const v=h+m*Math.PI/i,b=m%2===0?d:p;_.push({x:Math.round(n+Math.cos(v)*b),y:Math.round(o+Math.sin(v)*b)})}}else for(let p=0;p<i;p++){const m=h+p*2*Math.PI/i;_.push({x:Math.round(n+Math.cos(m)*d),y:Math.round(o+Math.sin(m)*d)})}const g=[];for(let p=0;p<_.length;p++){const m=_[p],v=_[(p+1)%_.length];g.push(...xe.getLinePoints(m.x,m.y,v.x,v.y))}return g}static extractSubGrid(e,t,s,r){const i=new Uint32Array(r.width*r.height);return s.forEach(a=>{const n=a.y*t+a.x,o=a.x-r.x1,c=(a.y-r.y1)*r.width+o;c>=0&&c<i.length&&(i[c]=e[n])}),i}static mergeSubGrid(e,t,s,r,i,a,n,o){const l=new Uint32Array(e),c=[];for(let d=0;d<a;d++)for(let _=0;_<i;_++){const h=n+_,g=o+d;if(h>=0&&h<t&&g>=0&&g<s){const p=d*i+_,m=r[p];if(m!==0){const v=g*t+h;l[v]!==m&&(l[v]=m,c.push({index:v,color:m}))}}}return{data:l,changes:c}}static mergeLayers(e,t,s){const r=new Uint32Array(t*s);for(const i of e)for(let a=0;a<r.length;a++){const n=i[a];n!==0&&(r[a]=n)}return r}static getLinearGradientMap(e,t,s,r,i,a){const n=[],o=s-e,l=r-t,c=o*o+l*l;return c===0?i.map(d=>({index:d,ratio:0})):(i.forEach(d=>{const _=d%a,h=Math.floor(d/a),g=((_-e)*o+(h-t)*l)/c,p=Math.max(0,Math.min(1,g));n.push({index:d,ratio:p})}),n)}}class go{move(e,t){let s=f.cursor.pos.x+e,r=f.cursor.pos.y+t;if(f.studio.isTilingEnabled){const i=ve.wrap(s,r,f.canvas.width,f.canvas.height);s=i.x,r=i.y}else s=Math.max(0,Math.min(f.canvas.width-1,s)),r=Math.max(0,Math.min(f.canvas.height-1,r));return s!==f.cursor.pos.x||r!==f.cursor.pos.y?(f.cursor.setPos(s,r),ee.playMove(),!0):!1}internalToCartesian(e,t,s,r){return xe.internalToCartesian(e,t,s,r)}cartesianToInternal(e,t,s,r){return xe.cartesianToInternal(e,t,s,r)}jumpTo(e,t){const{x:s,y:r}=xe.cartesianToInternal(e,t,f.canvas.width,f.canvas.height);f.cursor.setPos(s,r)}jumpHome(){this.jumpTo(1,1),ee.playMove()}}class mo{undoStack=[];redoStack=[];totalByteSize=0;MAX_MEMORY_BYTES=200*1024*1024;currentBatchIndices=[];currentBatchOldColors=[];currentBatchNewColors=[];inBatch=!1;beginBatch(){this.inBatch=!0,this.currentBatchIndices=[],this.currentBatchOldColors=[],this.currentBatchNewColors=[]}endBatch(){this.inBatch=!1,this.currentBatchIndices.length>0&&this.pushBatch(new Uint32Array(this.currentBatchIndices),new Uint32Array(this.currentBatchOldColors),new Uint32Array(this.currentBatchNewColors)),this.currentBatchIndices=[],this.currentBatchOldColors=[],this.currentBatchNewColors=[]}pushPixel(e,t,s){t!==s&&(this.inBatch?(this.currentBatchIndices.push(e),this.currentBatchOldColors.push(t),this.currentBatchNewColors.push(s)):this.pushBatch(new Uint32Array([e]),new Uint32Array([t]),new Uint32Array([s])))}pushBatch(e,t,s){if(e.length===0)return;const r=e.byteLength+t.byteLength+s.byteLength;this.addEntry({isBatch:!0,indices:e,oldColors:t,newColors:s,byteSize:r})}push(e){this.addEntry({...e,byteSize:1024})}addEntry(e){for(this.undoStack.push(e),this.totalByteSize+=e.byteSize,this.redoStack=[];this.totalByteSize>this.MAX_MEMORY_BYTES&&this.undoStack.length>1;){const t=this.undoStack.shift();t&&(this.totalByteSize-=t.byteSize)}}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),this.totalByteSize-=e.byteSize,e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),this.totalByteSize+=e.byteSize,e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatchIndices=[],this.currentBatchOldColors=[],this.currentBatchNewColors=[],this.totalByteSize=0,this.inBatch=!1}get usageLabel(){return(this.totalByteSize/(1024*1024)).toFixed(1)+" MB"}}const Q=new mo;class yt{static getKernel(e,t){if(e<=1)return[{x:0,y:0,weight:1}];const s=[],r=(e-1)/2,i=-Math.floor(r),a=Math.ceil(r);for(let n=i;n<=a;n++)for(let o=i;o<=a;o++){const l=Math.sqrt(o*o+n*n);if(t==="CIRCLE"&&l>r+.1||t==="SQUARE"&&(Math.abs(o)>r||Math.abs(n)>r))continue;const d=(t==="CIRCLE"?r:Math.max(Math.abs(o),Math.abs(n)))===0?1:Math.max(0,1-l/(r+.5));s.push({x:o,y:n,weight:d})}return s}static getSpans(e,t){if(e<=1)return[{y:0,x1:0,x2:0}];const s=[],r=(e-1)/2,i=-Math.floor(r),a=Math.ceil(r);for(let n=i;n<=a;n++)if(t==="SQUARE")s.push({y:n,x1:i,x2:a});else{const o=Math.sqrt(r*r-n*n),l=Math.floor(o);isNaN(l)||s.push({y:n,x1:-l,x2:l})}return s}}class qt{static simplify(e,t){if(e.length<=2||t<=0)return e;let s=0,r=0;const i=e[0],a=e[e.length-1];for(let n=1;n<e.length-1;n++){const o=xe.perpendicularDistance(e[n],i,a);o>s&&(r=n,s=o)}if(s>t){const n=this.simplify(e.slice(0,r+1),t),o=this.simplify(e.slice(r),t);return[...n.slice(0,-1),...o]}else return[i,a]}static smooth(e,t){if(e.length<=2||t<=0)return e;const s=[...e],r=Math.floor(t/10)+1;for(let i=1;i<e.length-1;i++){let a=0,n=0,o=0;for(let l=i-r;l<=i+r;l++)l>=0&&l<e.length&&(a+=e[l].x,n+=e[l].y,o++);s[i]={x:a/o,y:n/o}}return s}static traceCluster(e,t){const s=new Set;for(const i of e){const a=i%t,n=Math.floor(i/t);[{x:a,y:n-1,id:"top"},{x:a+1,y:n,id:"right"},{x:a,y:n+1,id:"bottom"},{x:a-1,y:n,id:"left"}].forEach(l=>{const c=l.y*t+l.x;if(l.x<0||l.x>=t||l.y<0||!e.has(c)){let _;l.id==="top"?_=`${a},${n}-${a+1},${n}`:l.id==="right"?_=`${a+1},${n}-${a+1},${n+1}`:l.id==="bottom"?_=`${a+1},${n+1}-${a},${n+1}`:_=`${a},${n+1}-${a},${n}`,s.add(_)}})}const r=[];for(;s.size>0;){const i=s.values().next().value;if(!i)break;s.delete(i);const[a,n]=i.split("-");let o=n,l=`M ${a.replace(","," ")} L ${n.replace(","," ")}`,c=!0;for(;c;){c=!1;for(const d of s)if(d.startsWith(o+"-")){const[_,h]=d.split("-");l+=` L ${h.replace(","," ")}`,o=h,s.delete(d),c=!0;break}}l+=" Z",r.push(l)}return r.join(" ")}}const yo={MOVE_UP:{label:"Move Up",keys:["ArrowUp"],group:"Navigation"},MOVE_DOWN:{label:"Move Down",keys:["ArrowDown"],group:"Navigation"},MOVE_LEFT:{label:"Move Left",keys:["ArrowLeft"],group:"Navigation"},MOVE_RIGHT:{label:"Move Right",keys:["ArrowRight"],group:"Navigation"},GOTO:{label:"Jump to Coordinate",keys:["Alt+j"],group:"Navigation"},JUMP_HOME:{label:"Return to Center",keys:["Ctrl+h"],group:"Navigation"},PAN_VIEWPORT:{label:"Pan Viewport (Hold)",keys:["q"],group:"Navigation"},RESET_PAN:{label:"Reset Panning",keys:["Alt+q"],group:"Navigation"},RESET_VIEWPORT:{label:"Reset Pan/Zoom",keys:["Alt+Backspace"],group:"View"}},vo={PAINT:{label:"Paint (Apply Color)",keys:["Space","Enter"],group:"Tools"},ERASE:{label:"Erase Pixel",keys:["Backspace","Delete"],group:"Tools"},PICK_COLOR:{label:"Sample Color",keys:["Alt+i","Alt+Space","i"],group:"Tools"},FLOOD_FILL:{label:"Color Fill",keys:["Alt+f","f"],group:"Magic"},RECOLOR:{label:"Recolor All",keys:["Alt+r"],group:"Magic"},SELECT_SAME:{label:"Magic Wand",keys:["w"],group:"Magic"},TOGGLE_DITHER_BLEND:{label:"Classic Blend",keys:["Alt+g"],group:"Magic"}},_o={FLOW_PAINT:{label:"Continuous Painting",keys:["Ctrl"],group:"Flow"},FLOW_ERASE:{label:"Continuous Erasing",keys:["Ctrl+Shift"],group:"Flow"},FLOW_SELECT:{label:"Define Selection",keys:["Shift"],group:"Flow"}},wo={SELECT_ALL:{label:"Select All",keys:["Ctrl+a"],group:"Edit"},COPY:{label:"Copy",keys:["Ctrl+c"],group:"Edit"},CUT:{label:"Cut",keys:["Ctrl+x"],group:"Edit"},PASTE:{label:"Paste",keys:["Ctrl+v"],group:"Edit"},CLEAR_CANVAS:{label:"Clear All",keys:["Ctrl+l"],group:"Edit"}},bo={FLIP_H:{label:"Flip Horizontally",keys:["Alt+h"],group:"Transform"},FLIP_V:{label:"Flip Vertically",keys:["Alt+v"],group:"Transform"},ROTATE:{label:"Rotate 90° Clockwise",keys:["r"],group:"Transform"},ZOOM_IN:{label:"Zoom In",keys:["+","="],group:"View"},ZOOM_OUT:{label:"Zoom Out",keys:["-"],group:"View"},RESET_ZOOM:{label:"Reset Zoom",keys:["Ctrl+0"],group:"View"}},xo={NEXT_FRAME:{label:"Next Frame",keys:["Alt+PageDown","Tab"],group:"Timeline"},PREV_FRAME:{label:"Previous Frame",keys:["Alt+PageUp","Shift+Tab"],group:"Timeline"},PLAY_PAUSE:{label:"Play/Pause",keys:["p"],group:"Timeline"},TOGGLE_GHOST_LAYERS:{label:"Onion Skinning",keys:["Alt+o"],group:"Timeline"}},So={NEW_ITEM:{label:"Add New (Contextual)",keys:["Alt+Shift+n"],group:"Layers"},NEW_LAYER_GROUP:{label:"Group Layers",keys:["Ctrl+g"],group:"Layers"},DUPLICATE_ITEM:{label:"Duplicate (Contextual)",keys:["Ctrl+d"],group:"Layers"},MOVE_ITEM_UP:{label:"Bring Forward",keys:["Ctrl+]"],group:"Layers"},MOVE_ITEM_DOWN:{label:"Send Backward",keys:["Ctrl+["],group:"Layers"},MOVE_ITEM_TOP:{label:"Bring to Front",keys:["Ctrl+Shift+]"],group:"Layers"},MOVE_ITEM_BOTTOM:{label:"Send to Back",keys:["Ctrl+Shift+["],group:"Layers"},DELETE_ITEM:{label:"Remove (Contextual)",keys:["Alt+d"],group:"Layers"},MERGE_LAYERS:{label:"Merge Layer Down",keys:["Ctrl+Alt+m"],group:"Layers"},MERGE_SELECTED_LAYERS:{label:"Merge Selected Layers",keys:["Ctrl+Shift+m"],group:"Layers"},MERGE_FRAMES:{label:"Merge Selected Frames",keys:["Ctrl+Alt+Shift+m"],group:"Timeline"},TOGGLE_LAYER_VISIBILITY:{label:"Show/Hide Layer",keys:["Ctrl+Alt+v"],group:"Layers"},TOGGLE_LAYER_LOCK:{label:"Lock/Unlock Layer",keys:["Alt+l"],group:"Layers"}},ko={BRUSH_SIZE_INC:{label:"Increase Brush Size",keys:["]"],group:"Etching"},BRUSH_SIZE_DEC:{label:"Decrease Brush Size",keys:["["],group:"Etching"},TOGGLE_PATTERN_BRUSH:{label:"Pattern Brush",keys:["Ctrl+Alt+b"],group:"Etching"},TOGGLE_BRUSH_SHAPE:{label:"Toggle Brush Shape",keys:["Alt+b"],group:"Etching"},CYCLE_SYMMETRY:{label:"Cycle Symmetry Mode",keys:["v"],group:"Etching"},TOGGLE_TILING:{label:"Toggle Seamless Tiling",keys:["t"],group:"Etching"},TOGGLE_AIRBRUSH:{label:"The Mist (Airbrush)",keys:["Alt+a"],group:"Etching"},TOGGLE_ALPHA_LOCK:{label:"Toggle Alpha Lock",keys:["a"],group:"Etching"},TOGGLE_COLOR_LOCK:{label:"Toggle Color Lock",keys:["Shift+a"],group:"Etching"},SHADE_LIGHTEN:{label:"Shade: Lighten",keys:["u"],group:"Etching"},SHADE_DARKEN:{label:"Shade: Darken",keys:["d"],group:"Etching"},SHADE_DITHER:{label:"Shade: Dither",keys:["x"],group:"Etching"},TOGGLE_PIXEL_PERFECT:{label:"Toggle Pixel-Perfect Lines",keys:["Shift+p"],group:"Etching"},TOOL_BRUSH:{label:"Brush Tool",keys:["b","Shift+b"],group:"Etching"},TOOL_ERASER:{label:"Eraser Tool",keys:["e"],group:"Etching"},TOOL_RECT_SELECT:{label:"Rectangle Selection",keys:["s"],group:"Etching"},TOOL_LASSO_SELECT:{label:"Lasso Selection",keys:["l"],group:"Etching"},TOOL_POLY_SELECT:{label:"Polygon Selection",keys:["Alt+l"],group:"Etching"},TOGGLE_HAND_TOOL:{label:"Hand Tool",keys:["h"],group:"Etching"},TOOL_RECTANGLE:{label:"Rectangle Tool",keys:["Shift+r"],group:"Etching"},TOOL_ELLIPSE:{label:"Ellipse Tool",keys:["Alt+c"],group:"Etching"},TOOL_POLYGON:{label:"Polygon Tool",keys:["Alt+p"],group:"Etching"},POLY_SIDES_INC:{label:"Increase Polygon Sides",keys:["Alt+."],group:"Etching"},POLY_SIDES_DEC:{label:"Decrease Polygon Sides",keys:["Alt+,"],group:"Etching"},POLY_INDENT_INC:{label:"Increase Indentation",keys:["Alt+Shift+]"],group:"Etching"},POLY_INDENT_DEC:{label:"Decrease Indentation",keys:["Alt+Shift+["],group:"Etching"},SET_SIDES_3:{label:"Set Sides: 3",keys:["Alt+3"],group:"Etching"},SET_SIDES_4:{label:"Set Sides: 4",keys:["Alt+4"],group:"Etching"},SET_SIDES_5:{label:"Set Sides: 5",keys:["Alt+5"],group:"Etching"},SET_SIDES_6:{label:"Set Sides: 6",keys:["Alt+6"],group:"Etching"},SET_SIDES_7:{label:"Set Sides: 7",keys:["Alt+7"],group:"Etching"},SET_SIDES_8:{label:"Set Sides: 8",keys:["Alt+8"],group:"Etching"},SET_SIDES_9:{label:"Set Sides: 9",keys:["Alt+9"],group:"Etching"},SET_SIDES_10:{label:"Set Sides: 10",keys:["Alt+0"],group:"Etching"},TOGGLE_UNDERLAY:{label:"Toggle Underlay Visibility",keys:["Ctrl+Alt+u"],group:"View"},OPEN_UNDERLAY_MENU:{label:"Underlay Menu",keys:["Alt+u"],group:"View"},TOOL_TRANSFORM:{label:"Transform Selection",keys:["m"],group:"Edit"}},Eo={OPEN_MENU:{label:"Command Palette",keys:["Ctrl+k"],group:"System"},OPEN_EXPORT:{label:"Export",keys:["Ctrl+e"],group:"System"},SAVE:{label:"Save",keys:["Ctrl+s"],group:"System"},OPEN_SETTINGS:{label:"Settings",keys:["Ctrl+,"],group:"System"},OPEN_MANUAL:{label:"Barista Manual",keys:["F1"],group:"System"},OPEN_PALETTE:{label:"Color Picker",keys:["c","F3"],group:"System"},OPEN_HELP:{label:"Quick Guide",keys:["F2"],group:"System"},OPEN_AUDIO:{label:"Audio Settings",keys:["Ctrl+Shift+a"],group:"System"},TOGGLE_MUTE:{label:"Mute Audio",keys:["Ctrl+Shift+m"],group:"System"},TOGGLE_MINIMAP:{label:"Minimap",keys:["Ctrl+m"],group:"System"},UNDO:{label:"Undo",keys:["Ctrl+z"],group:"System"},REDO:{label:"Redo",keys:["Ctrl+Shift+z","Ctrl+y"],group:"System"},ESCAPE:{label:"Close/Cancel",keys:["Escape"],group:"System"}},Co={SELECT_COLOR_1:{label:"Select Color 1",keys:["1"],group:"Colors"},SELECT_COLOR_2:{label:"Select Color 2",keys:["2"],group:"Colors"},SELECT_COLOR_3:{label:"Select Color 3",keys:["3"],group:"Colors"},SELECT_COLOR_4:{label:"Select Color 4",keys:["4"],group:"Colors"},SELECT_COLOR_5:{label:"Select Color 5",keys:["5"],group:"Colors"},SELECT_COLOR_6:{label:"Select Color 6",keys:["6"],group:"Colors"},SELECT_COLOR_7:{label:"Select Color 7",keys:["7"],group:"Colors"},SELECT_COLOR_8:{label:"Select Color 8",keys:["8"],group:"Colors"},SELECT_COLOR_9:{label:"Select Color 9",keys:["9"],group:"Colors"},SELECT_COLOR_0:{label:"Select Color 0",keys:["0"],group:"Colors"}},Ao={TAB_TIMELINE:{label:"Focus Timeline",keys:["Alt+1"],group:"System"},TAB_LAYERS:{label:"Focus Layers",keys:["Alt+2"],group:"System"}},Lo={navigation:yo,painting:vo,flows:_o,manipulation:wo,transform:bo,animation:xo,layering:So,etching:ko,system:Eo,colors:Co,tabs:Ao};class To{buffer=[];timeout=null;#e=j(we([]));get currentSequence(){return R(this.#e)}set currentSequence(e){F(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const s=this.buffer.join(","),r={"g,c":"GOTO","f,n":"NEW_ITEM","i,n":"NEW_ITEM","i,l":"TOGGLE_LAYER_LOCK","i,h":"TOGGLE_LAYER_VISIBILITY","i,m":"MERGE_LAYERS"};if(r[s]){const i=r[s];return this.reset(),i}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const kt=new To;class Po{patterns=[];#e=j(we([]));get activeKeys(){return R(this.#e)}set activeKeys(e){F(this.#e,e,!0)}#t=j(!1);get isCtrlActive(){return R(this.#t)}set isCtrlActive(e){F(this.#t,e,!0)}#s=j(!1);get isShiftActive(){return R(this.#s)}set isShiftActive(e){F(this.#s,e,!0)}#r=j(!1);get isAltActive(){return R(this.#r)}set isAltActive(e){F(this.#r,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){this.patterns=[],Object.values(Lo).forEach(e=>{Object.entries(e).forEach(([t,s])=>{const{keys:r,group:i}=s,a=`actions:${t}`,n=`shortcuts:groups.${i.toLowerCase().replace(/ & /g,"_").replace(/ /g,"_")}`;r.forEach(o=>{const l=o.toLowerCase();let c="",d=!1,_=!1,h=!1;if(l==="+")c="+";else{const g=l.split("+");c=g[g.length-1].trim(),c===""&&l.endsWith("++")&&(c="+"),d=g.includes("ctrl")||g.includes("control"),_=g.includes("shift"),h=g.includes("alt")}c==="space"&&(c=" "),(c==="ctrl"||c==="control")&&(c="control"),this.patterns.push({intent:t,key:c,ctrl:d,shift:_,alt:h,label:a,group:n})})})}),this.patterns.sort((e,t)=>{const s=r=>(r.ctrl?1:0)+(r.shift?1:0)+(r.alt?1:0);return s(t)-s(e)})}getActions(){const e=new Set,t=[];return this.patterns.forEach(s=>{e.has(s.intent)||(e.add(s.intent),t.push({intent:s.intent,label:s.label,group:s.group,shortcut:this.getLabel(s.intent)}))}),t}getGroupedActions(){const e=this.getActions(),t={},s={MOVE_UP:"navigation",MOVE_DOWN:"navigation",MOVE_LEFT:"navigation",MOVE_RIGHT:"navigation",SELECT_COLOR_1:"colors",SELECT_COLOR_2:"colors",SELECT_COLOR_3:"colors",SELECT_COLOR_4:"colors",SELECT_COLOR_5:"colors",SELECT_COLOR_6:"colors",SELECT_COLOR_7:"colors",SELECT_COLOR_8:"colors",SELECT_COLOR_9:"colors",SELECT_COLOR_0:"colors"},r=[],i=new Set;e.forEach(o=>{const l=s[o.intent];if(l){if(!i.has(l)){i.add(l);const c=`shortcuts:groups.${l}`;r.push({...o,label:c,customKey:l.toUpperCase()})}}else r.push(o)}),r.forEach(o=>{t[o.group]||(t[o.group]=[]),t[o.group].push(o)});const a=["shortcuts:groups.rhythms","shortcuts:groups.navigation","shortcuts:groups.tools","shortcuts:groups.magic","shortcuts:groups.etching","shortcuts:groups.flow","shortcuts:groups.selection","shortcuts:groups.transform","shortcuts:groups.geometry","shortcuts:groups.timeline","shortcuts:groups.layers","shortcuts:groups.edit","shortcuts:groups.view","shortcuts:groups.menu","shortcuts:groups.colors","shortcuts:groups.system"],n=Object.keys(t);return n.sort((o,l)=>{const c=a.indexOf(o),d=a.indexOf(l);return(c===-1?999:c)-(d===-1?999:d)}),n.map(o=>({group:o,items:t[o]}))}updatePhysicalState(e,t){const s=e.key.toLowerCase();t==="down"?this.activeKeys.includes(s)||this.activeKeys.push(s):(this.activeKeys=this.activeKeys.filter(r=>r!==s),s==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(r=>r!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(r=>r!=="control"&&r!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(r=>r!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(r=>r!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const s=kt.process(t);if(s)return s}else kt.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const s of this.patterns)if(t===s.key&&this.isCtrlActive===s.ctrl&&this.isShiftActive===s.shift&&this.isAltActive===s.alt)return s.intent;return null}getLabel(e){const t=this.patterns.find(o=>o.intent===e);if(!t)return"Unassigned";const s=[];t.ctrl&&s.push("Ctrl"),t.shift&&s.push("Shift"),t.alt&&s.push("Alt");let r=t.key;const i={" ":"Space",control:"Ctrl",meta:"Cmd",alt:"Alt",shift:"Shift",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right",backspace:"Backspace",delete:"Delete",enter:"Enter",escape:"Esc",tab:"Tab"},a=r.toLowerCase();i[a]?r=i[a]:r=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase();const n=s.filter(o=>o.toLowerCase()!==r.toLowerCase());return n.length===0?r:n.join("+")+"+"+r}}const $e=new Po;class Io{#e=Te(()=>f.studio.isHandToolActive||$e.activeKeys.includes("q")?{type:"PAN",label:Se("actions:pan_viewport"),icon:"🤚",color:"var(--color-lantern-gold)",isPulse:!1}:kt.isActive?{type:"FLOW",label:Se("timeline:mode_labels.brewing"),icon:"🌀",color:"var(--color-lantern-gold)",isPulse:!0}:f.isPicking?{type:"PICK",label:Se("timeline:mode_labels.tasting"),icon:"🏺",color:"var(--color-lantern-gold)",isPulse:!0}:$e.isCtrlActive&&$e.isShiftActive||f.studio.activeTool==="ERASER"?{type:"ERASE",label:Se("timeline:mode_labels.clearing"),icon:"🧹",color:"var(--color-rust-clay)",isPulse:!0}:$e.isShiftActive||f.studio.activeTool==="RECT_SELECT"||f.studio.activeTool==="LASSO_SELECT"||f.studio.activeTool==="POLY_SELECT"||f.studio.activeTool==="MAGIC_WAND"?{type:"SELECT",label:Se("timeline:mode_labels.selecting"),icon:"✨",color:"var(--color-lantern-gold)",isPulse:!0}:$e.isCtrlActive||f.studio.isShadingLighten||f.studio.isShadingDarken||f.studio.isShadingDither?{type:"PAINT",label:Se("timeline:mode_labels.pouring"),icon:"🖌️",color:"var(--color-fern-green)",isPulse:!0}:{type:"READY",label:Se("timeline:mode_labels.ready"),icon:"",color:"var(--color-evergreen)",isPulse:!1});get current(){return R(this.#e)}set current(e){F(this.#e,e)}}const Me=new Io;class Oo{draw(e,t){const s=e!==void 0?Math.floor(e):f.cursor.pos.x,r=t!==void 0?Math.floor(t):f.cursor.pos.y;if(!f.paletteState.activeColor)return;const a=new Uint32Array(f.canvas.pixels);let n=!1;if(Q.beginBatch(),f.studio.isPatternBrushActive&&f.studio.patternBrushData){const o=f.studio.patternBrushData,l=Math.floor(o.width/2),c=Math.floor(o.height/2);for(let d=0;d<o.height;d++)for(let _=0;_<o.width;_++){const h=s+_-l,g=r+d-c;if(f.canvas.isValidCoord(h,g)){const p=d*o.width+_,m=o.data[p];if(m===0)continue;const v=f.canvas.getIndex(h,g);if(f.selection.isActive&&!f.selection.isSelected(v)||f.studio.isAlphaLocked&&!f.project.activeFrame.activeLayer.hasPixel(v))continue;const k=Me.current.type==="ERASE"?0:m,C=a[v];C!==k&&(Q.pushPixel(v,C,k),a[v]=k,n=!0)}}}else{const o=yt.getKernel(f.studio.brushSize,f.studio.brushShape),l=f.studio.brushHardness;o.forEach(c=>{const d=s+c.x,_=r+c.y,h=[{x:d,y:_,weight:c.weight}];f.studio.symmetryMode!=="OFF"&&ve.getSymmetryPoints(d,_,f.canvas.width,f.canvas.height,f.studio.symmetryMode).forEach(p=>h.push({...p,weight:c.weight})),h.forEach(g=>{let p=g;if(f.studio.isTilingEnabled)p={...ve.wrap(g.x,g.y,f.canvas.width,f.canvas.height),weight:g.weight};else if(!f.canvas.isValidCoord(g.x,g.y))return;const m=f.canvas.getIndex(p.x,p.y),v=f.studio.isDitherBlendActive?g.weight+(1-g.weight)*(l/100):1;if(!ve.orderedDither(p.x,p.y,v)||f.studio.isAirbrushActive&&Math.random()>f.studio.airbrushDensity||f.selection.isActive&&!f.selection.isSelected(m)||f.studio.isAlphaLocked&&!f.project.activeFrame.activeLayer.hasPixel(m)||f.studio.isColorLocked&&f.studio.colorLockSource!==null&&a[m]!==me.hexToUint32(f.studio.colorLockSource))return;const b=this.getEffectColorForPoint(p.x,p.y,a[m]),k=a[m];k!==b&&(Q.pushPixel(m,k,b),a[m]=b,n=!0)})})}n?(f.canvas.pixels=a,f.canvas.incrementVersion(),Q.endBatch(),Me.current.type==="ERASE"?ee.playErase():ee.playDraw()):(Q.clear(),Q.endBatch())}erase(e,t){const s=e!==void 0?Math.floor(e):f.cursor.pos.x,r=t!==void 0?Math.floor(t):f.cursor.pos.y,a=yt.getKernel(f.studio.brushSize,f.studio.brushShape).map(c=>({x:s+c.x,y:r+c.y}));if(f.studio.symmetryMode!=="OFF"){const c=f.studio.symmetryMode,{width:d,height:_}=f.canvas,h=[];a.forEach(g=>{const p=ve.getSymmetryPoints(g.x,g.y,d,_,c);h.push(...p)}),a.push(...h)}const n=f.studio.isTilingEnabled?a.map(c=>ve.wrap(c.x,c.y,f.canvas.width,f.canvas.height)):a.filter(c=>f.canvas.isValidCoord(c.x,c.y));let o=!1;const l=new Uint32Array(f.canvas.pixels);Q.beginBatch(),n.forEach(c=>{const d=f.canvas.getIndex(c.x,c.y);if(f.selection.isActive&&!f.selection.isSelected(d)||f.studio.isAlphaLocked&&!f.project.activeFrame.activeLayer.hasPixel(d))return;const _=l[d];_!==0&&(Q.pushPixel(d,_,0),l[d]=0,o=!0)}),Q.endBatch(),o&&(f.canvas.pixels=l,f.canvas.incrementVersion(),ee.playErase())}getEffectColorForPoint(e,t,s){if(Me.current.type==="ERASE")return 0;const r=f.paletteState.activeColor,i=me.hexToUint32(r);if(f.studio.isShadingDither)return(e+t)%2===0?i:0;if(s===0)return i;if(f.studio.isShadingLighten){const a=me.uint32ToHex(s);return me.hexToUint32(me.adjustBrightness(a,.1))}if(f.studio.isShadingDarken){const a=me.uint32ToHex(s);return me.hexToUint32(me.adjustBrightness(a,-.1))}return i}beginStroke(e,t){f.canvas.clearBuffer(),f.canvas.addToBuffer(e,t)}continueStroke(e,t,s,r){const i=xe.getLinePoints(s,r,e,t,0);if(f.studio.isPixelPerfect){const a=[...f.canvas.strokePoints,...i],n=ve.pixelPerfectFilter(a);f.canvas.clearBuffer(),f.canvas.addBatchToBuffer(n)}else f.canvas.addBatchToBuffer(i)}endStroke(){this.commitBuffer()}cancelStroke(){f.canvas.clearBuffer(),ee.playErase()}snapCurrentStroke(){const e=f.canvas.strokePoints;if(e.length<5)return;const t=f.studio.stabilization,s=qt.smooth(e,t/10),r=.05+t/100*.35,i=xe.fitArc(s,r);f.canvas.clearBuffer();let a=[],n=[];if(i&&i.isFull)n=i.points,a=xe.getCirclePoints(i.cx,i.cy,i.r);else{const o=qt.simplify(s,t/100*2);if(o.length===2){let l={...o[0]},c={...o[o.length-1]};const d=Math.abs(c.x-l.x),_=Math.abs(c.y-l.y),h=3;if(d<h)c.x=l.x;else if(_<h)c.y=l.y;else if(Math.abs(d-_)<h){const g=Math.max(d,_);c.x=l.x+g*Math.sign(c.x-l.x),c.y=l.y+g*Math.sign(c.y-l.y)}n=[l,c],a=xe.getLinePoints(l.x,l.y,c.x,c.y,0)}else if(i){n=i.points;for(let l=0;l<n.length-1;l++)a.push(...xe.getLinePoints(n[l].x,n[l].y,n[l+1].x,n[l+1].y,t/100))}else{n=o;for(let l=0;l<n.length-1;l++)a.push(...xe.getLinePoints(n[l].x,n[l].y,n[l+1].x,n[l+1].y,t/100))}}f.canvas.addBatchToBuffer(a),f.canvas.strokePoints=n,ee.playDraw()}commitBuffer(){const e=f.canvas.pixelBuffer;if(e.length===0){f.canvas.clearBuffer();return}const t=new Uint32Array(f.canvas.pixels);let s=!1;if(Q.beginBatch(),f.studio.isPatternBrushActive&&f.studio.patternBrushData){const r=f.studio.patternBrushData,i=Math.floor(r.width/2),a=Math.floor(r.height/2);e.forEach(n=>{const o=n%f.canvas.width,l=Math.floor(n/f.canvas.width);for(let c=0;c<r.height;c++)for(let d=0;d<r.width;d++){const _=o+d-i,h=l+c-a;if(f.canvas.isValidCoord(_,h)){const g=c*r.width+d,p=r.data[g];if(p===0)continue;const m=f.canvas.getIndex(_,h);if(f.selection.isActive&&!f.selection.isSelected(m)||f.studio.isAlphaLocked&&!f.project.activeFrame.activeLayer.hasPixel(m))continue;const b=Me.current.type==="ERASE"?0:p,k=t[m];k!==b&&(Q.pushPixel(m,k,b),t[m]=b,s=!0)}}})}else{const r=yt.getKernel(f.studio.brushSize,f.studio.brushShape),i=f.studio.brushHardness;e.forEach(a=>{const n=a%f.canvas.width,o=Math.floor(a/f.canvas.width);r.forEach(l=>{const c=n+l.x,d=o+l.y,_=[{x:c,y:d,weight:l.weight}];f.studio.symmetryMode!=="OFF"&&ve.getSymmetryPoints(c,d,f.canvas.width,f.canvas.height,f.studio.symmetryMode).forEach(g=>_.push({...g,weight:l.weight})),_.forEach(h=>{let g=h;if(f.studio.isTilingEnabled)g={...ve.wrap(h.x,h.y,f.canvas.width,f.canvas.height),weight:h.weight};else if(!f.canvas.isValidCoord(h.x,h.y))return;const p=f.canvas.getIndex(g.x,g.y),m=f.studio.isDitherBlendActive?h.weight+(1-h.weight)*(i/100):1;if(!ve.orderedDither(g.x,g.y,m)||f.selection.isActive&&!f.selection.isSelected(p)||f.studio.isAlphaLocked&&!f.project.activeFrame.activeLayer.hasPixel(p))return;const v=this.getEffectColorForPoint(g.x,g.y,t[p]),b=t[p];b!==v&&(Q.pushPixel(p,b,v),t[p]=v,s=!0)})})})}Q.endBatch(),s&&(f.canvas.pixels=t,f.canvas.incrementVersion(),Me.current.type==="ERASE"?ee.playErase():ee.playDraw()),f.canvas.clearBuffer()}commitShape(){const e=f.studio.shapeAnchor;if(!e)return;const{x:t,y:s}=f.cursor.pos,r=f.studio.activeTool;let i=[];if(r==="RECTANGLE"?i=ve.getRectanglePoints(e.x,e.y,t,s):r==="ELLIPSE"?i=ve.getEllipsePoints(e.x,e.y,t,s):r==="POLYGON"&&(i=ve.getPolygonPoints(e.x,e.y,t,s,f.studio.polygonSides,f.studio.polygonIndentation)),i.length>0){const a=f.paletteState.activeColor,n=me.hexToUint32(a),o=new Uint32Array(f.canvas.pixels);let l=!1;Q.beginBatch(),i.forEach(c=>{if(f.canvas.isValidCoord(c.x,c.y)){const d=f.canvas.getIndex(c.x,c.y),_=o[d];_!==n&&(Q.pushPixel(d,_,n),o[d]=n,l=!0)}}),Q.endBatch(),l&&(f.canvas.pixels=o,f.canvas.incrementVersion(),ee.playDraw())}f.studio.activeTool="BRUSH",f.studio.shapeAnchor=null}}class Ro{resize(e,t){const s=new Uint32Array(e*t),r=me.hexToUint32(f.backgroundColor);s.fill(r);for(let i=0;i<Math.min(f.canvas.height,t);i++)for(let a=0;a<Math.min(f.canvas.width,e);a++){const n=i*f.canvas.width+a,o=i*e+a;s[o]=f.canvas.pixels[n]}f.canvas.reset(e,t,s),f.selection.initMask(e,t),Q.clear(),ee.playDraw()}flip(e){const{width:t,height:s}=f.canvas,r=f.project.activeFrame;Q.beginBatch(),r.layers.forEach(i=>{if(i.type!=="LAYER")return;const a=i.pixels,n=new Uint32Array(a.length);if(e==="horizontal")for(let o=0;o<s;o++){const l=o*t,c=a.subarray(l,l+t),d=new Uint32Array(c).reverse();n.set(d,l)}else for(let o=0;o<s;o++){const l=o*t,c=(s-1-o)*t;n.set(a.subarray(l,l+t),c)}i.pixels=n}),f.canvas.incrementVersion(),Q.endBatch(),f.studio.show(Se(e==="horizontal"?"ui:studio.flipped_h":"ui:studio.flipped_v")),ee.playDraw()}rotate(){const{width:e,height:t}=f.canvas;if(e!==t){f.studio.show(Se("generic:error"));return}const s=f.project.activeFrame;Q.beginBatch(),s.layers.forEach(r=>{if(r.type!=="LAYER")return;const i=r.pixels,a=new Uint32Array(e*t);for(let n=0;n<t;n++)for(let o=0;o<e;o++){const l=n*e+o,c=o*e+(t-1-n);a[c]=i[l]}r.pixels=a}),f.canvas.incrementVersion(),Q.endBatch(),f.studio.show(Se("ui:studio.rotated")),ee.playDraw()}clearAll(){confirm(Se("actions:clear_canvas"))&&(f.canvas.clear(),Q.clear(),f.studio.show(Se("ui:studio.canvas_cleared")),ee.playErase())}recolorAll(){const{x:e,y:t}=f.cursor.pos,s=f.canvas.getColor(e,t),r=me.hexToUint32(f.activeColor);if(s===r)return;const{pixels:i}=f.canvas,a=new Uint32Array(i);let n=!1;const o=f.selection.isActive,l=f.selection.activeIndicesSet;Q.beginBatch(),i.forEach((c,d)=>{const _=c===s,h=!o||l.has(d);_&&h&&(Q.pushPixel(d,s,r),a[d]=r,n=!0)}),Q.endBatch(),n&&(f.canvas.pixels=a,f.canvas.incrementVersion(),ee.playDraw())}}class Mo{copy(){const e=f.canvas.width,t=f.selection.getPoints(e),s=f.selection.getEffectiveBounds(e);if(!s||t.length===0)return;const r=f.canvas.compositePixels,i=ve.extractSubGrid(r,e,t,s);f.project.clipboard={width:s.width,height:s.height,data:i},ee.playDraw()}cut(){this.copy();const e=f.canvas.width,t=f.selection.getPoints(e);if(t.length===0)return;Q.beginBatch();const s=new Uint32Array(f.canvas.pixels);let r=!1;t.forEach(i=>{const a=i.y*e+i.x,n=s[a];n!==0&&(Q.pushPixel(a,n,0),s[a]=0,r=!0)}),Q.endBatch(),r&&(f.canvas.pixels=s,f.canvas.incrementVersion()),ee.playErase(),f.selection.clear()}paste(){const e=f.project.clipboard;if(!e)return;const{x:t,y:s}=f.cursor.pos,{width:r,height:i}=f.canvas;Q.beginBatch();const{data:a,changes:n}=ve.mergeSubGrid(f.canvas.pixels,r,i,e.data,e.width,e.height,t,s);n.length>0&&(n.forEach(o=>{const l=f.canvas.pixels[o.index];Q.pushPixel(o.index,l,o.color)}),f.canvas.pixels=a,f.canvas.incrementVersion(),ee.playDraw()),Q.endBatch()}}class He{static DB_NAME="rupa_sanctuary_db";static DB_VERSION=1;static STORE_PROJECTS="projects";static STORE_PRESETS="palette_presets";static db=null;static async getDB(){return this.db?this.db:new Promise((e,t)=>{const s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains(this.STORE_PROJECTS)||i.createObjectStore(this.STORE_PROJECTS,{keyPath:"id"}),i.objectStoreNames.contains(this.STORE_PRESETS)||i.createObjectStore(this.STORE_PRESETS,{keyPath:"id"})},s.onsuccess=()=>{this.db=s.result,e(this.db)},s.onerror=()=>t(s.error)})}static async saveProject(e,t){const s=await this.getDB();return new Promise((r,i)=>{const o=s.transaction(this.STORE_PROJECTS,"readwrite").objectStore(this.STORE_PROJECTS).put({id:e,content:t,timestamp:Date.now()});o.onsuccess=()=>r(),o.onerror=()=>i(o.error)})}static async loadProject(e){const t=await this.getDB();return new Promise((s,r)=>{const n=t.transaction(this.STORE_PROJECTS,"readonly").objectStore(this.STORE_PROJECTS).get(e);n.onsuccess=()=>s(n.result?.content||null),n.onerror=()=>r(n.error)})}static async savePresets(e){const t=await this.getDB();return new Promise((s,r)=>{const n=t.transaction(this.STORE_PRESETS,"readwrite").objectStore(this.STORE_PRESETS).put({id:"global_library",data:e,timestamp:Date.now()});n.onsuccess=()=>s(),n.onerror=()=>r(n.error)})}static async loadPresets(){const e=await this.getDB();return new Promise((t,s)=>{const a=e.transaction(this.STORE_PRESETS,"readonly").objectStore(this.STORE_PRESETS).get("global_library");a.onsuccess=()=>t(a.result?.data||null),a.onerror=()=>s(a.error)})}}var tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fo(w){return w&&w.__esModule&&Object.prototype.hasOwnProperty.call(w,"default")?w.default:w}function st(w){throw new Error('Could not dynamically require "'+w+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vt={exports:{}};var Xt;function Do(){return Xt||(Xt=1,(function(w,e){(function(t){w.exports=t()})(function(){return(function t(s,r,i){function a(l,c){if(!r[l]){if(!s[l]){var d=typeof st=="function"&&st;if(!c&&d)return d(l,!0);if(n)return n(l,!0);var _=new Error("Cannot find module '"+l+"'");throw _.code="MODULE_NOT_FOUND",_}var h=r[l]={exports:{}};s[l][0].call(h.exports,function(g){var p=s[l][1][g];return a(p||g)},h,h.exports,t,s,r,i)}return r[l].exports}for(var n=typeof st=="function"&&st,o=0;o<i.length;o++)a(i[o]);return a})({1:[function(t,s,r){var i=t("./utils"),a=t("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(o){for(var l,c,d,_,h,g,p,m=[],v=0,b=o.length,k=b,C=i.getTypeOf(o)!=="string";v<o.length;)k=b-v,d=C?(l=o[v++],c=v<b?o[v++]:0,v<b?o[v++]:0):(l=o.charCodeAt(v++),c=v<b?o.charCodeAt(v++):0,v<b?o.charCodeAt(v++):0),_=l>>2,h=(3&l)<<4|c>>4,g=1<k?(15&c)<<2|d>>6:64,p=2<k?63&d:64,m.push(n.charAt(_)+n.charAt(h)+n.charAt(g)+n.charAt(p));return m.join("")},r.decode=function(o){var l,c,d,_,h,g,p=0,m=0,v="data:";if(o.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var b,k=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===n.charAt(64)&&k--,o.charAt(o.length-2)===n.charAt(64)&&k--,k%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=a.uint8array?new Uint8Array(0|k):new Array(0|k);p<o.length;)l=n.indexOf(o.charAt(p++))<<2|(_=n.indexOf(o.charAt(p++)))>>4,c=(15&_)<<4|(h=n.indexOf(o.charAt(p++)))>>2,d=(3&h)<<6|(g=n.indexOf(o.charAt(p++))),b[m++]=l,h!==64&&(b[m++]=c),g!==64&&(b[m++]=d);return b}},{"./support":30,"./utils":32}],2:[function(t,s,r){var i=t("./external"),a=t("./stream/DataWorker"),n=t("./stream/Crc32Probe"),o=t("./stream/DataLengthProbe");function l(c,d,_,h,g){this.compressedSize=c,this.uncompressedSize=d,this.crc32=_,this.compression=h,this.compressedContent=g}l.prototype={getContentWorker:function(){var c=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(c,d,_){return c.pipe(new n).pipe(new o("uncompressedSize")).pipe(d.compressWorker(_)).pipe(new o("compressedSize")).withStreamInfo("compression",d)},s.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,r){var i=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,r){var i=t("./utils"),a=(function(){for(var n,o=[],l=0;l<256;l++){n=l;for(var c=0;c<8;c++)n=1&n?3988292384^n>>>1:n>>>1;o[l]=n}return o})();s.exports=function(n,o){return n!==void 0&&n.length?i.getTypeOf(n)!=="string"?(function(l,c,d,_){var h=a,g=_+d;l^=-1;for(var p=_;p<g;p++)l=l>>>8^h[255&(l^c[p])];return-1^l})(0|o,n,n.length,0):(function(l,c,d,_){var h=a,g=_+d;l^=-1;for(var p=_;p<g;p++)l=l>>>8^h[255&(l^c.charCodeAt(p))];return-1^l})(0|o,n,n.length,0):0}},{"./utils":32}],5:[function(t,s,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,s,r){var i=null;i=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:i}},{lie:37}],7:[function(t,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=t("pako"),n=t("./utils"),o=t("./stream/GenericWorker"),l=i?"uint8array":"array";function c(d,_){o.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=_,this.meta={}}r.magic="\b\0",n.inherits(c,o),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(l,d.data),!1)},c.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(_){d.push({data:_,meta:d.meta})}},r.compressWorker=function(d){return new c("Deflate",d)},r.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,r){function i(h,g){var p,m="";for(p=0;p<g;p++)m+=String.fromCharCode(255&h),h>>>=8;return m}function a(h,g,p,m,v,b){var k,C,A=h.file,z=h.compression,T=b!==l.utf8encode,$=n.transformTo("string",b(A.name)),M=n.transformTo("string",l.utf8encode(A.name)),U=A.comment,re=n.transformTo("string",b(U)),E=n.transformTo("string",l.utf8encode(U)),B=M.length!==A.name.length,y=E.length!==U.length,V="",se="",G="",oe=A.dir,K=A.date,ne={crc32:0,compressedSize:0,uncompressedSize:0};g&&!p||(ne.crc32=h.crc32,ne.compressedSize=h.compressedSize,ne.uncompressedSize=h.uncompressedSize);var O=0;g&&(O|=8),T||!B&&!y||(O|=2048);var P=0,te=0;oe&&(P|=16),v==="UNIX"?(te=798,P|=(function(q,fe){var be=q;return q||(be=fe?16893:33204),(65535&be)<<16})(A.unixPermissions,oe)):(te=20,P|=(function(q){return 63&(q||0)})(A.dosPermissions)),k=K.getUTCHours(),k<<=6,k|=K.getUTCMinutes(),k<<=5,k|=K.getUTCSeconds()/2,C=K.getUTCFullYear()-1980,C<<=4,C|=K.getUTCMonth()+1,C<<=5,C|=K.getUTCDate(),B&&(se=i(1,1)+i(c($),4)+M,V+="up"+i(se.length,2)+se),y&&(G=i(1,1)+i(c(re),4)+E,V+="uc"+i(G.length,2)+G);var X="";return X+=`
\0`,X+=i(O,2),X+=z.magic,X+=i(k,2),X+=i(C,2),X+=i(ne.crc32,4),X+=i(ne.compressedSize,4),X+=i(ne.uncompressedSize,4),X+=i($.length,2),X+=i(V.length,2),{fileRecord:d.LOCAL_FILE_HEADER+X+$+V,dirRecord:d.CENTRAL_FILE_HEADER+i(te,2)+X+i(re.length,2)+"\0\0\0\0"+i(P,4)+i(m,4)+$+V+re}}var n=t("../utils"),o=t("../stream/GenericWorker"),l=t("../utf8"),c=t("../crc32"),d=t("../signature");function _(h,g,p,m){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=p,this.encodeFileName=m,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(_,o),_.prototype.push=function(h){var g=h.meta.percent||0,p=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,o.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(g+100*(p-m-1))/p:100}}))},_.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var g=this.streamFiles&&!h.file.dir;if(g){var p=a(h,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(h){this.accumulate=!1;var g=this.streamFiles&&!h.file.dir,p=a(h,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),g)this.push({data:(function(m){return d.DATA_DESCRIPTOR+i(m.crc32,4)+i(m.compressedSize,4)+i(m.uncompressedSize,4)})(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var h=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var p=this.bytesWritten-h,m=(function(v,b,k,C,A){var z=n.transformTo("string",A(C));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(v,2)+i(v,2)+i(b,4)+i(k,4)+i(z.length,2)+z})(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(h){this._sources.push(h);var g=this;return h.on("data",function(p){g.processChunk(p)}),h.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),h.on("error",function(p){g.error(p)}),this},_.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(h){var g=this._sources;if(!o.prototype.error.call(this,h))return!1;for(var p=0;p<g.length;p++)try{g[p].error(h)}catch{}return!0},_.prototype.lock=function(){o.prototype.lock.call(this);for(var h=this._sources,g=0;g<h.length;g++)h[g].lock()},s.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,r){var i=t("../compressions"),a=t("./ZipFileWorker");r.generateWorker=function(n,o,l){var c=new a(o.streamFiles,l,o.platform,o.encodeFileName),d=0;try{n.forEach(function(_,h){d++;var g=(function(b,k){var C=b||k,A=i[C];if(!A)throw new Error(C+" is not a valid compression method !");return A})(h.options.compression,o.compression),p=h.options.compressionOptions||o.compressionOptions||{},m=h.dir,v=h.date;h._compressWorker(g,p).withStreamInfo("file",{name:_,dir:m,date:v,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(_){c.error(_)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new i;for(var n in this)typeof this[n]!="function"&&(a[n]=this[n]);return a}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.10.1",i.loadAsync=function(a,n){return new i().loadAsync(a,n)},i.external=t("./external"),s.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,r){var i=t("./utils"),a=t("./external"),n=t("./utf8"),o=t("./zipEntries"),l=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(_){return new a.Promise(function(h,g){var p=_.decompressed.getContentWorker().pipe(new l);p.on("error",function(m){g(m)}).on("end",function(){p.streamInfo.crc32!==_.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}s.exports=function(_,h){var g=this;return h=i.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),c.isNode&&c.isStream(_)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",_,!0,h.optimizedBinaryString,h.base64).then(function(p){var m=new o(h);return m.load(p),m}).then(function(p){var m=[a.Promise.resolve(p)],v=p.files;if(h.checkCRC32)for(var b=0;b<v.length;b++)m.push(d(v[b]));return a.Promise.all(m)}).then(function(p){for(var m=p.shift(),v=m.files,b=0;b<v.length;b++){var k=v[b],C=k.fileNameStr,A=i.resolve(k.fileNameStr);g.file(A,k.decompressed,{binary:!0,optimizedBinaryString:!0,date:k.date,dir:k.dir,comment:k.fileCommentStr.length?k.fileCommentStr:null,unixPermissions:k.unixPermissions,dosPermissions:k.dosPermissions,createFolders:h.createFolders}),k.dir||(g.file(A).unsafeOriginalName=C)}return m.zipComment.length&&(g.comment=m.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,r){var i=t("../utils"),a=t("../stream/GenericWorker");function n(o,l){a.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(l)}i.inherits(n,a),n.prototype._bindStream=function(o){var l=this;(this._stream=o).pause(),o.on("data",function(c){l.push({data:c,meta:{percent:0}})}).on("error",function(c){l.isPaused?this.generatedError=c:l.error(c)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},n.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,r){var i=t("readable-stream").Readable;function a(n,o,l){i.call(this,o),this._helper=n;var c=this;n.on("data",function(d,_){c.push(d)||c._helper.pause(),l&&l(_)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}t("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},s.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,s,r){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,a);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,a)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var a=new Buffer(i);return a.fill(0),a},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(t,s,r){function i(A,z,T){var $,M=n.getTypeOf(z),U=n.extend(T||{},c);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(A=v(A)),U.createFolders&&($=m(A))&&b.call(this,$,!0);var re=M==="string"&&U.binary===!1&&U.base64===!1;T&&T.binary!==void 0||(U.binary=!re),(z instanceof d&&z.uncompressedSize===0||U.dir||!z||z.length===0)&&(U.base64=!1,U.binary=!0,z="",U.compression="STORE",M="string");var E=null;E=z instanceof d||z instanceof o?z:g.isNode&&g.isStream(z)?new p(A,z):n.prepareContent(A,z,U.binary,U.optimizedBinaryString,U.base64);var B=new _(A,E,U);this.files[A]=B}var a=t("./utf8"),n=t("./utils"),o=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),_=t("./zipObject"),h=t("./generate"),g=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),m=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var z=A.lastIndexOf("/");return 0<z?A.substring(0,z):""},v=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},b=function(A,z){return z=z!==void 0?z:c.createFolders,A=v(A),this.files[A]||i.call(this,A,null,{dir:!0,createFolders:z}),this.files[A]};function k(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var z,T,$;for(z in this.files)$=this.files[z],(T=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&A(T,$)},filter:function(A){var z=[];return this.forEach(function(T,$){A(T,$)&&z.push($)}),z},file:function(A,z,T){if(arguments.length!==1)return A=this.root+A,i.call(this,A,z,T),this;if(k(A)){var $=A;return this.filter(function(U,re){return!re.dir&&$.test(U)})}var M=this.files[this.root+A];return M&&!M.dir?M:null},folder:function(A){if(!A)return this;if(k(A))return this.filter(function(M,U){return U.dir&&A.test(M)});var z=this.root+A,T=b.call(this,z),$=this.clone();return $.root=T.name,$},remove:function(A){A=this.root+A;var z=this.files[A];if(z||(A.slice(-1)!=="/"&&(A+="/"),z=this.files[A]),z&&!z.dir)delete this.files[A];else for(var T=this.filter(function(M,U){return U.name.slice(0,A.length)===A}),$=0;$<T.length;$++)delete this.files[T[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var z,T={};try{if((T=n.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");n.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var $=T.comment||this.comment||"";z=h.generateWorker(this,T,$)}catch(M){(z=new o("error")).error(M)}return new l(z,T.type||"string",T.mimeType)},generateAsync:function(A,z){return this.generateInternalStream(A).accumulate(z)},generateNodeStream:function(A,z){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(z)}};s.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,r){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,r){var i=t("./DataReader");function a(n){i.call(this,n);for(var o=0;o<this.data.length;o++)n[o]=255&n[o]}t("../utils").inherits(a,i),a.prototype.byteAt=function(n){return this.data[this.zero+n]},a.prototype.lastIndexOfSignature=function(n){for(var o=n.charCodeAt(0),l=n.charCodeAt(1),c=n.charCodeAt(2),d=n.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===o&&this.data[_+1]===l&&this.data[_+2]===c&&this.data[_+3]===d)return _-this.zero;return-1},a.prototype.readAndCheckSignature=function(n){var o=n.charCodeAt(0),l=n.charCodeAt(1),c=n.charCodeAt(2),d=n.charCodeAt(3),_=this.readData(4);return o===_[0]&&l===_[1]&&c===_[2]&&d===_[3]},a.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,o},s.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,s,r){var i=t("../utils");function a(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var o,l=0;for(this.checkOffset(n),o=this.index+n-1;o>=this.index;o--)l=(l<<8)+this.byteAt(o);return this.index+=n,l},readString:function(n){return i.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},s.exports=a},{"../utils":32}],19:[function(t,s,r){var i=t("./Uint8ArrayReader");function a(n){i.call(this,n)}t("../utils").inherits(a,i),a.prototype.readData=function(n){this.checkOffset(n);var o=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,o},s.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,r){var i=t("./DataReader");function a(n){i.call(this,n)}t("../utils").inherits(a,i),a.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},a.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},a.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},a.prototype.readData=function(n){this.checkOffset(n);var o=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,o},s.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,s,r){var i=t("./ArrayReader");function a(n){i.call(this,n)}t("../utils").inherits(a,i),a.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,o},s.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,r){var i=t("../utils"),a=t("../support"),n=t("./ArrayReader"),o=t("./StringReader"),l=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");s.exports=function(d){var _=i.getTypeOf(d);return i.checkSupport(_),_!=="string"||a.uint8array?_==="nodebuffer"?new l(d):a.uint8array?new c(i.transformTo("uint8array",d)):new n(i.transformTo("array",d)):new o(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,r){var i=t("./GenericWorker"),a=t("../utils");function n(o){i.call(this,"ConvertWorker to "+o),this.destType=o}a.inherits(n,i),n.prototype.processChunk=function(o){this.push({data:a.transformTo(this.destType,o.data),meta:o.meta})},s.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,r){var i=t("./GenericWorker"),a=t("../crc32");function n(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(n,i),n.prototype.processChunk=function(o){this.streamInfo.crc32=a(o.data,this.streamInfo.crc32||0),this.push(o)},s.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,r){var i=t("../utils"),a=t("./GenericWorker");function n(o){a.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}i.inherits(n,a),n.prototype.processChunk=function(o){if(o){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+o.data.length}a.prototype.processChunk.call(this,o)},s.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,r){var i=t("../utils"),a=t("./GenericWorker");function n(o){a.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(c){l.dataIsReady=!0,l.data=c,l.max=c&&c.length||0,l.type=i.getTypeOf(c),l.isPaused||l._tickAndRepeat()},function(c){l.error(c)})}i.inherits(n,a),n.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,l);break;case"uint8array":o=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":o=this.data.slice(this.index,l)}return this.index=l,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,r){function i(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,n){return this._listeners[a].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,n){if(this._listeners[a])for(var o=0;o<this._listeners[a].length;o++)this._listeners[a][o].call(this,n)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var n=this;return a.on("data",function(o){n.processChunk(o)}),a.on("end",function(){n.end()}),a.on("error",function(o){n.error(o)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,n){return this.extraStreamInfo[a]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},s.exports=i},{}],29:[function(t,s,r){var i=t("../utils"),a=t("./ConvertWorker"),n=t("./GenericWorker"),o=t("../base64"),l=t("../support"),c=t("../external"),d=null;if(l.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(g,p){return new c.Promise(function(m,v){var b=[],k=g._internalType,C=g._outputType,A=g._mimeType;g.on("data",function(z,T){b.push(z),p&&p(T)}).on("error",function(z){b=[],v(z)}).on("end",function(){try{var z=(function(T,$,M){switch(T){case"blob":return i.newBlob(i.transformTo("arraybuffer",$),M);case"base64":return o.encode($);default:return i.transformTo(T,$)}})(C,(function(T,$){var M,U=0,re=null,E=0;for(M=0;M<$.length;M++)E+=$[M].length;switch(T){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(re=new Uint8Array(E),M=0;M<$.length;M++)re.set($[M],U),U+=$[M].length;return re;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+T+"'")}})(k,b),A);m(z)}catch(T){v(T)}b=[]}).resume()})}function h(g,p,m){var v=p;switch(p){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=p,this._mimeType=m,i.checkSupport(v),this._worker=g.pipe(new a(v)),g.lock()}catch(b){this._worker=new n("error"),this._worker.error(b)}}h.prototype={accumulate:function(g){return _(this,g)},on:function(g,p){var m=this;return g==="data"?this._worker.on(g,function(v){p.call(m,v.data,v.meta)}):this._worker.on(g,function(){i.delay(p,arguments,m)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},s.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,r){for(var i=t("./utils"),a=t("./support"),n=t("./nodejsUtils"),o=t("./stream/GenericWorker"),l=new Array(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;l[254]=l[254]=1;function d(){o.call(this,"utf-8 decode"),this.leftOver=null}function _(){o.call(this,"utf-8 encode")}r.utf8encode=function(h){return a.nodebuffer?n.newBufferFrom(h,"utf-8"):(function(g){var p,m,v,b,k,C=g.length,A=0;for(b=0;b<C;b++)(64512&(m=g.charCodeAt(b)))==55296&&b+1<C&&(64512&(v=g.charCodeAt(b+1)))==56320&&(m=65536+(m-55296<<10)+(v-56320),b++),A+=m<128?1:m<2048?2:m<65536?3:4;for(p=a.uint8array?new Uint8Array(A):new Array(A),b=k=0;k<A;b++)(64512&(m=g.charCodeAt(b)))==55296&&b+1<C&&(64512&(v=g.charCodeAt(b+1)))==56320&&(m=65536+(m-55296<<10)+(v-56320),b++),m<128?p[k++]=m:(m<2048?p[k++]=192|m>>>6:(m<65536?p[k++]=224|m>>>12:(p[k++]=240|m>>>18,p[k++]=128|m>>>12&63),p[k++]=128|m>>>6&63),p[k++]=128|63&m);return p})(h)},r.utf8decode=function(h){return a.nodebuffer?i.transformTo("nodebuffer",h).toString("utf-8"):(function(g){var p,m,v,b,k=g.length,C=new Array(2*k);for(p=m=0;p<k;)if((v=g[p++])<128)C[m++]=v;else if(4<(b=l[v]))C[m++]=65533,p+=b-1;else{for(v&=b===2?31:b===3?15:7;1<b&&p<k;)v=v<<6|63&g[p++],b--;1<b?C[m++]=65533:v<65536?C[m++]=v:(v-=65536,C[m++]=55296|v>>10&1023,C[m++]=56320|1023&v)}return C.length!==m&&(C.subarray?C=C.subarray(0,m):C.length=m),i.applyFromCharCode(C)})(h=i.transformTo(a.uint8array?"uint8array":"array",h))},i.inherits(d,o),d.prototype.processChunk=function(h){var g=i.transformTo(a.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var p=g;(g=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),g.set(p,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var m=(function(b,k){var C;for((k=k||b.length)>b.length&&(k=b.length),C=k-1;0<=C&&(192&b[C])==128;)C--;return C<0||C===0?k:C+l[b[C]]>k?C:k})(g),v=g;m!==g.length&&(a.uint8array?(v=g.subarray(0,m),this.leftOver=g.subarray(m,g.length)):(v=g.slice(0,m),this.leftOver=g.slice(m,g.length))),this.push({data:r.utf8decode(v),meta:h.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=d,i.inherits(_,o),_.prototype.processChunk=function(h){this.push({data:r.utf8encode(h.data),meta:h.meta})},r.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,r){var i=t("./support"),a=t("./base64"),n=t("./nodejsUtils"),o=t("./external");function l(p){return p}function c(p,m){for(var v=0;v<p.length;++v)m[v]=255&p.charCodeAt(v);return m}t("setimmediate"),r.newBlob=function(p,m){r.checkSupport("blob");try{return new Blob([p],{type:m})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(p),v.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,m,v){var b=[],k=0,C=p.length;if(C<=v)return String.fromCharCode.apply(null,p);for(;k<C;)m==="array"||m==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(k,Math.min(k+v,C)))):b.push(String.fromCharCode.apply(null,p.subarray(k,Math.min(k+v,C)))),k+=v;return b.join("")},stringifyByChar:function(p){for(var m="",v=0;v<p.length;v++)m+=String.fromCharCode(p[v]);return m},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}})()}};function _(p){var m=65536,v=r.getTypeOf(p),b=!0;if(v==="uint8array"?b=d.applyCanBeUsed.uint8array:v==="nodebuffer"&&(b=d.applyCanBeUsed.nodebuffer),b)for(;1<m;)try{return d.stringifyByChunk(p,v,m)}catch{m=Math.floor(m/2)}return d.stringifyByChar(p)}function h(p,m){for(var v=0;v<p.length;v++)m[v]=p[v];return m}r.applyFromCharCode=_;var g={};g.string={string:l,array:function(p){return c(p,new Array(p.length))},arraybuffer:function(p){return g.string.uint8array(p).buffer},uint8array:function(p){return c(p,new Uint8Array(p.length))},nodebuffer:function(p){return c(p,n.allocBuffer(p.length))}},g.array={string:_,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return n.newBufferFrom(p)}},g.arraybuffer={string:function(p){return _(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return n.newBufferFrom(new Uint8Array(p))}},g.uint8array={string:_,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return n.newBufferFrom(p)}},g.nodebuffer={string:_,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return g.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},r.transformTo=function(p,m){if(m=m||"",!p)return m;r.checkSupport(p);var v=r.getTypeOf(m);return g[v][p](m)},r.resolve=function(p){for(var m=p.split("/"),v=[],b=0;b<m.length;b++){var k=m[b];k==="."||k===""&&b!==0&&b!==m.length-1||(k===".."?v.pop():v.push(k))}return v.join("/")},r.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&n.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(p){var m,v,b="";for(v=0;v<(p||"").length;v++)b+="\\x"+((m=p.charCodeAt(v))<16?"0":"")+m.toString(16).toUpperCase();return b},r.delay=function(p,m,v){setImmediate(function(){p.apply(v||null,m||[])})},r.inherits=function(p,m){function v(){}v.prototype=m.prototype,p.prototype=new v},r.extend=function(){var p,m,v={};for(p=0;p<arguments.length;p++)for(m in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],m)&&v[m]===void 0&&(v[m]=arguments[p][m]);return v},r.prepareContent=function(p,m,v,b,k){return o.Promise.resolve(m).then(function(C){return i.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new o.Promise(function(A,z){var T=new FileReader;T.onload=function($){A($.target.result)},T.onerror=function($){z($.target.error)},T.readAsArrayBuffer(C)}):C}).then(function(C){var A=r.getTypeOf(C);return A?(A==="arraybuffer"?C=r.transformTo("uint8array",C):A==="string"&&(k?C=a.decode(C):v&&b!==!0&&(C=(function(z){return c(z,i.uint8array?new Uint8Array(z.length):new Array(z.length))})(C))),C):o.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,r){var i=t("./reader/readerFor"),a=t("./utils"),n=t("./signature"),o=t("./zipEntry"),l=t("./support");function c(d){this.files=[],this.loadOptions=d}c.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(_)+", expected "+a.pretty(d)+")")}},isSignature:function(d,_){var h=this.reader.index;this.reader.setIndex(d);var g=this.reader.readString(4)===_;return this.reader.setIndex(h),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),_=l.uint8array?"uint8array":"array",h=a.transformTo(_,d);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,_,h,g=this.zip64EndOfCentralSize-44;0<g;)d=this.reader.readInt(2),_=this.reader.readInt(4),h=this.reader.readData(_),this.zip64ExtensibleData[d]={id:d,length:_,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,_;for(d=0;d<this.files.length;d++)_=this.files[d],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(d=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var _=d;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var g=_-h;if(0<g)this.isSignature(_,n.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(d){this.reader=i(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,r){var i=t("./reader/readerFor"),a=t("./utils"),n=t("./compressedObject"),o=t("./crc32"),l=t("./utf8"),c=t("./compressions"),d=t("./support");function _(h,g){this.options=h,this.loadOptions=g}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var g,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=(function(m){for(var v in c)if(Object.prototype.hasOwnProperty.call(c,v)&&c[v].magic===m)return c[v];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,g,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var g=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(g),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var g,p,m,v=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<v;)g=h.readInt(2),p=h.readInt(2),m=h.readData(p),this.extraFields[g]={id:g,length:p,value:m};h.setIndex(v)},handleUTF8:function(){var h=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var p=a.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var v=a.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var g=i(h.value);return g.readInt(1)!==1||o(this.fileName)!==g.readInt(4)?null:l.utf8decode(g.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var g=i(h.value);return g.readInt(1)!==1||o(this.fileComment)!==g.readInt(4)?null:l.utf8decode(g.readData(h.length-5))}return null}},s.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,r){function i(g,p,m){this.name=g,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=p,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var a=t("./stream/StreamHelper"),n=t("./stream/DataWorker"),o=t("./utf8"),l=t("./compressedObject"),c=t("./stream/GenericWorker");i.prototype={internalStream:function(g){var p=null,m="string";try{if(!g)throw new Error("No output type specified.");var v=(m=g.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!v&&(p=p.pipe(new o.Utf8EncodeWorker)),!b&&v&&(p=p.pipe(new o.Utf8DecodeWorker))}catch(k){(p=new c("error")).error(k)}return new a(p,m,"")},async:function(g,p){return this.internalStream(g).accumulate(p)},nodeStream:function(g,p){return this.internalStream(g||"nodebuffer").toNodejsStream(p)},_compressWorker:function(g,p){if(this._data instanceof l&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new o.Utf8EncodeWorker)),l.createWorkerFrom(m,g,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof c?this._data:new n(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<d.length;h++)i.prototype[d[h]]=_;s.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,r){(function(i){var a,n,o=i.MutationObserver||i.WebKitMutationObserver;if(o){var l=0,c=new o(g),d=i.document.createTextNode("");c.observe(d,{characterData:!0}),a=function(){d.data=l=++l%2}}else if(i.setImmediate||i.MessageChannel===void 0)a="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){g(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(g,0)};else{var _=new i.MessageChannel;_.port1.onmessage=g,a=function(){_.port2.postMessage(0)}}var h=[];function g(){var p,m;n=!0;for(var v=h.length;v;){for(m=h,h=[],p=-1;++p<v;)m[p]();v=h.length}n=!1}s.exports=function(p){h.push(p)!==1||n||a()}}).call(this,typeof tt<"u"?tt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,r){var i=t("immediate");function a(){}var n={},o=["REJECTED"],l=["FULFILLED"],c=["PENDING"];function d(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,v!==a&&p(this,v)}function _(v,b,k){this.promise=v,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}function h(v,b,k){i(function(){var C;try{C=b(k)}catch(A){return n.reject(v,A)}C===v?n.reject(v,new TypeError("Cannot resolve promise with itself")):n.resolve(v,C)})}function g(v){var b=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof b=="function")return function(){b.apply(v,arguments)}}function p(v,b){var k=!1;function C(T){k||(k=!0,n.reject(v,T))}function A(T){k||(k=!0,n.resolve(v,T))}var z=m(function(){b(A,C)});z.status==="error"&&C(z.value)}function m(v,b){var k={};try{k.value=v(b),k.status="success"}catch(C){k.status="error",k.value=C}return k}(s.exports=d).prototype.finally=function(v){if(typeof v!="function")return this;var b=this.constructor;return this.then(function(k){return b.resolve(v()).then(function(){return k})},function(k){return b.resolve(v()).then(function(){throw k})})},d.prototype.catch=function(v){return this.then(null,v)},d.prototype.then=function(v,b){if(typeof v!="function"&&this.state===l||typeof b!="function"&&this.state===o)return this;var k=new this.constructor(a);return this.state!==c?h(k,this.state===l?v:b,this.outcome):this.queue.push(new _(k,v,b)),k},_.prototype.callFulfilled=function(v){n.resolve(this.promise,v)},_.prototype.otherCallFulfilled=function(v){h(this.promise,this.onFulfilled,v)},_.prototype.callRejected=function(v){n.reject(this.promise,v)},_.prototype.otherCallRejected=function(v){h(this.promise,this.onRejected,v)},n.resolve=function(v,b){var k=m(g,b);if(k.status==="error")return n.reject(v,k.value);var C=k.value;if(C)p(v,C);else{v.state=l,v.outcome=b;for(var A=-1,z=v.queue.length;++A<z;)v.queue[A].callFulfilled(b)}return v},n.reject=function(v,b){v.state=o,v.outcome=b;for(var k=-1,C=v.queue.length;++k<C;)v.queue[k].callRejected(b);return v},d.resolve=function(v){return v instanceof this?v:n.resolve(new this(a),v)},d.reject=function(v){var b=new this(a);return n.reject(b,v)},d.all=function(v){var b=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=v.length,C=!1;if(!k)return this.resolve([]);for(var A=new Array(k),z=0,T=-1,$=new this(a);++T<k;)M(v[T],T);return $;function M(U,re){b.resolve(U).then(function(E){A[re]=E,++z!==k||C||(C=!0,n.resolve($,A))},function(E){C||(C=!0,n.reject($,E))})}},d.race=function(v){var b=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=v.length,C=!1;if(!k)return this.resolve([]);for(var A=-1,z=new this(a);++A<k;)T=v[A],b.resolve(T).then(function($){C||(C=!0,n.resolve(z,$))},function($){C||(C=!0,n.reject(z,$))});var T;return z}},{immediate:36}],38:[function(t,s,r){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,r){var i=t("./zlib/deflate"),a=t("./utils/common"),n=t("./utils/strings"),o=t("./zlib/messages"),l=t("./zlib/zstream"),c=Object.prototype.toString,d=0,_=-1,h=0,g=8;function p(v){if(!(this instanceof p))return new p(v);this.options=a.assign({level:_,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},v||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var k=i.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(k!==d)throw new Error(o[k]);if(b.header&&i.deflateSetHeader(this.strm,b.header),b.dictionary){var C;if(C=typeof b.dictionary=="string"?n.string2buf(b.dictionary):c.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(k=i.deflateSetDictionary(this.strm,C))!==d)throw new Error(o[k]);this._dict_set=!0}}function m(v,b){var k=new p(b);if(k.push(v,!0),k.err)throw k.msg||o[k.err];return k.result}p.prototype.push=function(v,b){var k,C,A=this.strm,z=this.options.chunkSize;if(this.ended)return!1;C=b===~~b?b:b===!0?4:0,typeof v=="string"?A.input=n.string2buf(v):c.call(v)==="[object ArrayBuffer]"?A.input=new Uint8Array(v):A.input=v,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new a.Buf8(z),A.next_out=0,A.avail_out=z),(k=i.deflate(A,C))!==1&&k!==d)return this.onEnd(k),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(a.shrinkBuf(A.output,A.next_out))):this.onData(a.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&k!==1);return C===4?(k=i.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===d):C!==2||(this.onEnd(d),!(A.avail_out=0))},p.prototype.onData=function(v){this.chunks.push(v)},p.prototype.onEnd=function(v){v===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},r.Deflate=p,r.deflate=m,r.deflateRaw=function(v,b){return(b=b||{}).raw=!0,m(v,b)},r.gzip=function(v,b){return(b=b||{}).gzip=!0,m(v,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,r){var i=t("./zlib/inflate"),a=t("./utils/common"),n=t("./utils/strings"),o=t("./zlib/constants"),l=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),_=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},p||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||p&&p.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&(15&m.windowBits)==0&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var v=i.inflateInit2(this.strm,m.windowBits);if(v!==o.Z_OK)throw new Error(l[v]);this.header=new d,i.inflateGetHeader(this.strm,this.header)}function g(p,m){var v=new h(m);if(v.push(p,!0),v.err)throw v.msg||l[v.err];return v.result}h.prototype.push=function(p,m){var v,b,k,C,A,z,T=this.strm,$=this.options.chunkSize,M=this.options.dictionary,U=!1;if(this.ended)return!1;b=m===~~m?m:m===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof p=="string"?T.input=n.binstring2buf(p):_.call(p)==="[object ArrayBuffer]"?T.input=new Uint8Array(p):T.input=p,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new a.Buf8($),T.next_out=0,T.avail_out=$),(v=i.inflate(T,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&M&&(z=typeof M=="string"?n.string2buf(M):_.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,v=i.inflateSetDictionary(this.strm,z)),v===o.Z_BUF_ERROR&&U===!0&&(v=o.Z_OK,U=!1),v!==o.Z_STREAM_END&&v!==o.Z_OK)return this.onEnd(v),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&v!==o.Z_STREAM_END&&(T.avail_in!==0||b!==o.Z_FINISH&&b!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(k=n.utf8border(T.output,T.next_out),C=T.next_out-k,A=n.buf2string(T.output,k),T.next_out=C,T.avail_out=$-C,C&&a.arraySet(T.output,T.output,k,C,0),this.onData(A)):this.onData(a.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(U=!0)}while((0<T.avail_in||T.avail_out===0)&&v!==o.Z_STREAM_END);return v===o.Z_STREAM_END&&(b=o.Z_FINISH),b===o.Z_FINISH?(v=i.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===o.Z_OK):b!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(T.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},r.Inflate=h,r.inflate=g,r.inflateRaw=function(p,m){return(m=m||{}).raw=!0,g(p,m)},r.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(o){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var c=l.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(o[d]=c[d])}}return o},r.shrinkBuf=function(o,l){return o.length===l?o:o.subarray?o.subarray(0,l):(o.length=l,o)};var a={arraySet:function(o,l,c,d,_){if(l.subarray&&o.subarray)o.set(l.subarray(c,c+d),_);else for(var h=0;h<d;h++)o[_+h]=l[c+h]},flattenChunks:function(o){var l,c,d,_,h,g;for(l=d=0,c=o.length;l<c;l++)d+=o[l].length;for(g=new Uint8Array(d),l=_=0,c=o.length;l<c;l++)h=o[l],g.set(h,_),_+=h.length;return g}},n={arraySet:function(o,l,c,d,_){for(var h=0;h<d;h++)o[_+h]=l[c+h]},flattenChunks:function(o){return[].concat.apply([],o)}};r.setTyped=function(o){o?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,n))},r.setTyped(i)},{}],42:[function(t,s,r){var i=t("./common"),a=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var o=new i.Buf8(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(d,_){if(_<65537&&(d.subarray&&n||!d.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(d,_));for(var h="",g=0;g<_;g++)h+=String.fromCharCode(d[g]);return h}o[254]=o[254]=1,r.string2buf=function(d){var _,h,g,p,m,v=d.length,b=0;for(p=0;p<v;p++)(64512&(h=d.charCodeAt(p)))==55296&&p+1<v&&(64512&(g=d.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(g-56320),p++),b+=h<128?1:h<2048?2:h<65536?3:4;for(_=new i.Buf8(b),p=m=0;m<b;p++)(64512&(h=d.charCodeAt(p)))==55296&&p+1<v&&(64512&(g=d.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(g-56320),p++),h<128?_[m++]=h:(h<2048?_[m++]=192|h>>>6:(h<65536?_[m++]=224|h>>>12:(_[m++]=240|h>>>18,_[m++]=128|h>>>12&63),_[m++]=128|h>>>6&63),_[m++]=128|63&h);return _},r.buf2binstring=function(d){return c(d,d.length)},r.binstring2buf=function(d){for(var _=new i.Buf8(d.length),h=0,g=_.length;h<g;h++)_[h]=d.charCodeAt(h);return _},r.buf2string=function(d,_){var h,g,p,m,v=_||d.length,b=new Array(2*v);for(h=g=0;h<v;)if((p=d[h++])<128)b[g++]=p;else if(4<(m=o[p]))b[g++]=65533,h+=m-1;else{for(p&=m===2?31:m===3?15:7;1<m&&h<v;)p=p<<6|63&d[h++],m--;1<m?b[g++]=65533:p<65536?b[g++]=p:(p-=65536,b[g++]=55296|p>>10&1023,b[g++]=56320|1023&p)}return c(b,g)},r.utf8border=function(d,_){var h;for((_=_||d.length)>d.length&&(_=d.length),h=_-1;0<=h&&(192&d[h])==128;)h--;return h<0||h===0?_:h+o[d[h]]>_?h:_}},{"./common":41}],43:[function(t,s,r){s.exports=function(i,a,n,o){for(var l=65535&i|0,c=i>>>16&65535|0,d=0;n!==0;){for(n-=d=2e3<n?2e3:n;c=c+(l=l+a[o++]|0)|0,--d;);l%=65521,c%=65521}return l|c<<16|0}},{}],44:[function(t,s,r){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,r){var i=(function(){for(var a,n=[],o=0;o<256;o++){a=o;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;n[o]=a}return n})();s.exports=function(a,n,o,l){var c=i,d=l+o;a^=-1;for(var _=l;_<d;_++)a=a>>>8^c[255&(a^n[_])];return-1^a}},{}],46:[function(t,s,r){var i,a=t("../utils/common"),n=t("./trees"),o=t("./adler32"),l=t("./crc32"),c=t("./messages"),d=0,_=4,h=0,g=-2,p=-1,m=4,v=2,b=8,k=9,C=286,A=30,z=19,T=2*C+1,$=15,M=3,U=258,re=U+M+1,E=42,B=113,y=1,V=2,se=3,G=4;function oe(u,N){return u.msg=c[N],N}function K(u){return(u<<1)-(4<u?9:0)}function ne(u){for(var N=u.length;0<=--N;)u[N]=0}function O(u){var N=u.state,D=N.pending;D>u.avail_out&&(D=u.avail_out),D!==0&&(a.arraySet(u.output,N.pending_buf,N.pending_out,D,u.next_out),u.next_out+=D,N.pending_out+=D,u.total_out+=D,u.avail_out-=D,N.pending-=D,N.pending===0&&(N.pending_out=0))}function P(u,N){n._tr_flush_block(u,0<=u.block_start?u.block_start:-1,u.strstart-u.block_start,N),u.block_start=u.strstart,O(u.strm)}function te(u,N){u.pending_buf[u.pending++]=N}function X(u,N){u.pending_buf[u.pending++]=N>>>8&255,u.pending_buf[u.pending++]=255&N}function q(u,N){var D,S,x=u.max_chain_length,L=u.strstart,H=u.prev_length,W=u.nice_match,I=u.strstart>u.w_size-re?u.strstart-(u.w_size-re):0,Z=u.window,J=u.w_mask,Y=u.prev,ie=u.strstart+U,de=Z[L+H-1],ce=Z[L+H];u.prev_length>=u.good_match&&(x>>=2),W>u.lookahead&&(W=u.lookahead);do if(Z[(D=N)+H]===ce&&Z[D+H-1]===de&&Z[D]===Z[L]&&Z[++D]===Z[L+1]){L+=2,D++;do;while(Z[++L]===Z[++D]&&Z[++L]===Z[++D]&&Z[++L]===Z[++D]&&Z[++L]===Z[++D]&&Z[++L]===Z[++D]&&Z[++L]===Z[++D]&&Z[++L]===Z[++D]&&Z[++L]===Z[++D]&&L<ie);if(S=U-(ie-L),L=ie-U,H<S){if(u.match_start=N,W<=(H=S))break;de=Z[L+H-1],ce=Z[L+H]}}while((N=Y[N&J])>I&&--x!=0);return H<=u.lookahead?H:u.lookahead}function fe(u){var N,D,S,x,L,H,W,I,Z,J,Y=u.w_size;do{if(x=u.window_size-u.lookahead-u.strstart,u.strstart>=Y+(Y-re)){for(a.arraySet(u.window,u.window,Y,Y,0),u.match_start-=Y,u.strstart-=Y,u.block_start-=Y,N=D=u.hash_size;S=u.head[--N],u.head[N]=Y<=S?S-Y:0,--D;);for(N=D=Y;S=u.prev[--N],u.prev[N]=Y<=S?S-Y:0,--D;);x+=Y}if(u.strm.avail_in===0)break;if(H=u.strm,W=u.window,I=u.strstart+u.lookahead,Z=x,J=void 0,J=H.avail_in,Z<J&&(J=Z),D=J===0?0:(H.avail_in-=J,a.arraySet(W,H.input,H.next_in,J,I),H.state.wrap===1?H.adler=o(H.adler,W,J,I):H.state.wrap===2&&(H.adler=l(H.adler,W,J,I)),H.next_in+=J,H.total_in+=J,J),u.lookahead+=D,u.lookahead+u.insert>=M)for(L=u.strstart-u.insert,u.ins_h=u.window[L],u.ins_h=(u.ins_h<<u.hash_shift^u.window[L+1])&u.hash_mask;u.insert&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[L+M-1])&u.hash_mask,u.prev[L&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=L,L++,u.insert--,!(u.lookahead+u.insert<M)););}while(u.lookahead<re&&u.strm.avail_in!==0)}function be(u,N){for(var D,S;;){if(u.lookahead<re){if(fe(u),u.lookahead<re&&N===d)return y;if(u.lookahead===0)break}if(D=0,u.lookahead>=M&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+M-1])&u.hash_mask,D=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),D!==0&&u.strstart-D<=u.w_size-re&&(u.match_length=q(u,D)),u.match_length>=M)if(S=n._tr_tally(u,u.strstart-u.match_start,u.match_length-M),u.lookahead-=u.match_length,u.match_length<=u.max_lazy_match&&u.lookahead>=M){for(u.match_length--;u.strstart++,u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+M-1])&u.hash_mask,D=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart,--u.match_length!=0;);u.strstart++}else u.strstart+=u.match_length,u.match_length=0,u.ins_h=u.window[u.strstart],u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+1])&u.hash_mask;else S=n._tr_tally(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++;if(S&&(P(u,!1),u.strm.avail_out===0))return y}return u.insert=u.strstart<M-1?u.strstart:M-1,N===_?(P(u,!0),u.strm.avail_out===0?se:G):u.last_lit&&(P(u,!1),u.strm.avail_out===0)?y:V}function le(u,N){for(var D,S,x;;){if(u.lookahead<re){if(fe(u),u.lookahead<re&&N===d)return y;if(u.lookahead===0)break}if(D=0,u.lookahead>=M&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+M-1])&u.hash_mask,D=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),u.prev_length=u.match_length,u.prev_match=u.match_start,u.match_length=M-1,D!==0&&u.prev_length<u.max_lazy_match&&u.strstart-D<=u.w_size-re&&(u.match_length=q(u,D),u.match_length<=5&&(u.strategy===1||u.match_length===M&&4096<u.strstart-u.match_start)&&(u.match_length=M-1)),u.prev_length>=M&&u.match_length<=u.prev_length){for(x=u.strstart+u.lookahead-M,S=n._tr_tally(u,u.strstart-1-u.prev_match,u.prev_length-M),u.lookahead-=u.prev_length-1,u.prev_length-=2;++u.strstart<=x&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+M-1])&u.hash_mask,D=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),--u.prev_length!=0;);if(u.match_available=0,u.match_length=M-1,u.strstart++,S&&(P(u,!1),u.strm.avail_out===0))return y}else if(u.match_available){if((S=n._tr_tally(u,0,u.window[u.strstart-1]))&&P(u,!1),u.strstart++,u.lookahead--,u.strm.avail_out===0)return y}else u.match_available=1,u.strstart++,u.lookahead--}return u.match_available&&(S=n._tr_tally(u,0,u.window[u.strstart-1]),u.match_available=0),u.insert=u.strstart<M-1?u.strstart:M-1,N===_?(P(u,!0),u.strm.avail_out===0?se:G):u.last_lit&&(P(u,!1),u.strm.avail_out===0)?y:V}function he(u,N,D,S,x){this.good_length=u,this.max_lazy=N,this.nice_length=D,this.max_chain=S,this.func=x}function ye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*T),this.dyn_dtree=new a.Buf16(2*(2*A+1)),this.bl_tree=new a.Buf16(2*(2*z+1)),ne(this.dyn_ltree),ne(this.dyn_dtree),ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16($+1),this.heap=new a.Buf16(2*C+1),ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*C+1),ne(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(u){var N;return u&&u.state?(u.total_in=u.total_out=0,u.data_type=v,(N=u.state).pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap?E:B,u.adler=N.wrap===2?0:1,N.last_flush=d,n._tr_init(N),h):oe(u,g)}function Ce(u){var N=pe(u);return N===h&&(function(D){D.window_size=2*D.w_size,ne(D.head),D.max_lazy_match=i[D.level].max_lazy,D.good_match=i[D.level].good_length,D.nice_match=i[D.level].nice_length,D.max_chain_length=i[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=M-1,D.match_available=0,D.ins_h=0})(u.state),N}function Ee(u,N,D,S,x,L){if(!u)return g;var H=1;if(N===p&&(N=6),S<0?(H=0,S=-S):15<S&&(H=2,S-=16),x<1||k<x||D!==b||S<8||15<S||N<0||9<N||L<0||m<L)return oe(u,g);S===8&&(S=9);var W=new ye;return(u.state=W).strm=u,W.wrap=H,W.gzhead=null,W.w_bits=S,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=x+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+M-1)/M),W.window=new a.Buf8(2*W.w_size),W.head=new a.Buf16(W.hash_size),W.prev=new a.Buf16(W.w_size),W.lit_bufsize=1<<x+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new a.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=N,W.strategy=L,W.method=D,Ce(u)}i=[new he(0,0,0,0,function(u,N){var D=65535;for(D>u.pending_buf_size-5&&(D=u.pending_buf_size-5);;){if(u.lookahead<=1){if(fe(u),u.lookahead===0&&N===d)return y;if(u.lookahead===0)break}u.strstart+=u.lookahead,u.lookahead=0;var S=u.block_start+D;if((u.strstart===0||u.strstart>=S)&&(u.lookahead=u.strstart-S,u.strstart=S,P(u,!1),u.strm.avail_out===0)||u.strstart-u.block_start>=u.w_size-re&&(P(u,!1),u.strm.avail_out===0))return y}return u.insert=0,N===_?(P(u,!0),u.strm.avail_out===0?se:G):(u.strstart>u.block_start&&(P(u,!1),u.strm.avail_out),y)}),new he(4,4,8,4,be),new he(4,5,16,8,be),new he(4,6,32,32,be),new he(4,4,16,16,le),new he(8,16,32,32,le),new he(8,16,128,128,le),new he(8,32,128,256,le),new he(32,128,258,1024,le),new he(32,258,258,4096,le)],r.deflateInit=function(u,N){return Ee(u,N,b,15,8,0)},r.deflateInit2=Ee,r.deflateReset=Ce,r.deflateResetKeep=pe,r.deflateSetHeader=function(u,N){return u&&u.state?u.state.wrap!==2?g:(u.state.gzhead=N,h):g},r.deflate=function(u,N){var D,S,x,L;if(!u||!u.state||5<N||N<0)return u?oe(u,g):g;if(S=u.state,!u.output||!u.input&&u.avail_in!==0||S.status===666&&N!==_)return oe(u,u.avail_out===0?-5:g);if(S.strm=u,D=S.last_flush,S.last_flush=N,S.status===E)if(S.wrap===2)u.adler=0,te(S,31),te(S,139),te(S,8),S.gzhead?(te(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),te(S,255&S.gzhead.time),te(S,S.gzhead.time>>8&255),te(S,S.gzhead.time>>16&255),te(S,S.gzhead.time>>24&255),te(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),te(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(te(S,255&S.gzhead.extra.length),te(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(u.adler=l(u.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(te(S,0),te(S,0),te(S,0),te(S,0),te(S,0),te(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),te(S,3),S.status=B);else{var H=b+(S.w_bits-8<<4)<<8;H|=(2<=S.strategy||S.level<2?0:S.level<6?1:S.level===6?2:3)<<6,S.strstart!==0&&(H|=32),H+=31-H%31,S.status=B,X(S,H),S.strstart!==0&&(X(S,u.adler>>>16),X(S,65535&u.adler)),u.adler=1}if(S.status===69)if(S.gzhead.extra){for(x=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>x&&(u.adler=l(u.adler,S.pending_buf,S.pending-x,x)),O(u),x=S.pending,S.pending!==S.pending_buf_size));)te(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>x&&(u.adler=l(u.adler,S.pending_buf,S.pending-x,x)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(S.status===73)if(S.gzhead.name){x=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>x&&(u.adler=l(u.adler,S.pending_buf,S.pending-x,x)),O(u),x=S.pending,S.pending===S.pending_buf_size)){L=1;break}L=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,te(S,L)}while(L!==0);S.gzhead.hcrc&&S.pending>x&&(u.adler=l(u.adler,S.pending_buf,S.pending-x,x)),L===0&&(S.gzindex=0,S.status=91)}else S.status=91;if(S.status===91)if(S.gzhead.comment){x=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>x&&(u.adler=l(u.adler,S.pending_buf,S.pending-x,x)),O(u),x=S.pending,S.pending===S.pending_buf_size)){L=1;break}L=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,te(S,L)}while(L!==0);S.gzhead.hcrc&&S.pending>x&&(u.adler=l(u.adler,S.pending_buf,S.pending-x,x)),L===0&&(S.status=103)}else S.status=103;if(S.status===103&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&O(u),S.pending+2<=S.pending_buf_size&&(te(S,255&u.adler),te(S,u.adler>>8&255),u.adler=0,S.status=B)):S.status=B),S.pending!==0){if(O(u),u.avail_out===0)return S.last_flush=-1,h}else if(u.avail_in===0&&K(N)<=K(D)&&N!==_)return oe(u,-5);if(S.status===666&&u.avail_in!==0)return oe(u,-5);if(u.avail_in!==0||S.lookahead!==0||N!==d&&S.status!==666){var W=S.strategy===2?(function(I,Z){for(var J;;){if(I.lookahead===0&&(fe(I),I.lookahead===0)){if(Z===d)return y;break}if(I.match_length=0,J=n._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,J&&(P(I,!1),I.strm.avail_out===0))return y}return I.insert=0,Z===_?(P(I,!0),I.strm.avail_out===0?se:G):I.last_lit&&(P(I,!1),I.strm.avail_out===0)?y:V})(S,N):S.strategy===3?(function(I,Z){for(var J,Y,ie,de,ce=I.window;;){if(I.lookahead<=U){if(fe(I),I.lookahead<=U&&Z===d)return y;if(I.lookahead===0)break}if(I.match_length=0,I.lookahead>=M&&0<I.strstart&&(Y=ce[ie=I.strstart-1])===ce[++ie]&&Y===ce[++ie]&&Y===ce[++ie]){de=I.strstart+U;do;while(Y===ce[++ie]&&Y===ce[++ie]&&Y===ce[++ie]&&Y===ce[++ie]&&Y===ce[++ie]&&Y===ce[++ie]&&Y===ce[++ie]&&Y===ce[++ie]&&ie<de);I.match_length=U-(de-ie),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=M?(J=n._tr_tally(I,1,I.match_length-M),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(J=n._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),J&&(P(I,!1),I.strm.avail_out===0))return y}return I.insert=0,Z===_?(P(I,!0),I.strm.avail_out===0?se:G):I.last_lit&&(P(I,!1),I.strm.avail_out===0)?y:V})(S,N):i[S.level].func(S,N);if(W!==se&&W!==G||(S.status=666),W===y||W===se)return u.avail_out===0&&(S.last_flush=-1),h;if(W===V&&(N===1?n._tr_align(S):N!==5&&(n._tr_stored_block(S,0,0,!1),N===3&&(ne(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),O(u),u.avail_out===0))return S.last_flush=-1,h}return N!==_?h:S.wrap<=0?1:(S.wrap===2?(te(S,255&u.adler),te(S,u.adler>>8&255),te(S,u.adler>>16&255),te(S,u.adler>>24&255),te(S,255&u.total_in),te(S,u.total_in>>8&255),te(S,u.total_in>>16&255),te(S,u.total_in>>24&255)):(X(S,u.adler>>>16),X(S,65535&u.adler)),O(u),0<S.wrap&&(S.wrap=-S.wrap),S.pending!==0?h:1)},r.deflateEnd=function(u){var N;return u&&u.state?(N=u.state.status)!==E&&N!==69&&N!==73&&N!==91&&N!==103&&N!==B&&N!==666?oe(u,g):(u.state=null,N===B?oe(u,-3):h):g},r.deflateSetDictionary=function(u,N){var D,S,x,L,H,W,I,Z,J=N.length;if(!u||!u.state||(L=(D=u.state).wrap)===2||L===1&&D.status!==E||D.lookahead)return g;for(L===1&&(u.adler=o(u.adler,N,J,0)),D.wrap=0,J>=D.w_size&&(L===0&&(ne(D.head),D.strstart=0,D.block_start=0,D.insert=0),Z=new a.Buf8(D.w_size),a.arraySet(Z,N,J-D.w_size,D.w_size,0),N=Z,J=D.w_size),H=u.avail_in,W=u.next_in,I=u.input,u.avail_in=J,u.next_in=0,u.input=N,fe(D);D.lookahead>=M;){for(S=D.strstart,x=D.lookahead-(M-1);D.ins_h=(D.ins_h<<D.hash_shift^D.window[S+M-1])&D.hash_mask,D.prev[S&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=S,S++,--x;);D.strstart=S,D.lookahead=M-1,fe(D)}return D.strstart+=D.lookahead,D.block_start=D.strstart,D.insert=D.lookahead,D.lookahead=0,D.match_length=D.prev_length=M-1,D.match_available=0,u.next_in=W,u.input=I,u.avail_in=H,D.wrap=L,h},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,r){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,r){s.exports=function(i,a){var n,o,l,c,d,_,h,g,p,m,v,b,k,C,A,z,T,$,M,U,re,E,B,y,V;n=i.state,o=i.next_in,y=i.input,l=o+(i.avail_in-5),c=i.next_out,V=i.output,d=c-(a-i.avail_out),_=c+(i.avail_out-257),h=n.dmax,g=n.wsize,p=n.whave,m=n.wnext,v=n.window,b=n.hold,k=n.bits,C=n.lencode,A=n.distcode,z=(1<<n.lenbits)-1,T=(1<<n.distbits)-1;e:do{k<15&&(b+=y[o++]<<k,k+=8,b+=y[o++]<<k,k+=8),$=C[b&z];t:for(;;){if(b>>>=M=$>>>24,k-=M,(M=$>>>16&255)===0)V[c++]=65535&$;else{if(!(16&M)){if((64&M)==0){$=C[(65535&$)+(b&(1<<M)-1)];continue t}if(32&M){n.mode=12;break e}i.msg="invalid literal/length code",n.mode=30;break e}U=65535&$,(M&=15)&&(k<M&&(b+=y[o++]<<k,k+=8),U+=b&(1<<M)-1,b>>>=M,k-=M),k<15&&(b+=y[o++]<<k,k+=8,b+=y[o++]<<k,k+=8),$=A[b&T];s:for(;;){if(b>>>=M=$>>>24,k-=M,!(16&(M=$>>>16&255))){if((64&M)==0){$=A[(65535&$)+(b&(1<<M)-1)];continue s}i.msg="invalid distance code",n.mode=30;break e}if(re=65535&$,k<(M&=15)&&(b+=y[o++]<<k,(k+=8)<M&&(b+=y[o++]<<k,k+=8)),h<(re+=b&(1<<M)-1)){i.msg="invalid distance too far back",n.mode=30;break e}if(b>>>=M,k-=M,(M=c-d)<re){if(p<(M=re-M)&&n.sane){i.msg="invalid distance too far back",n.mode=30;break e}if(B=v,(E=0)===m){if(E+=g-M,M<U){for(U-=M;V[c++]=v[E++],--M;);E=c-re,B=V}}else if(m<M){if(E+=g+m-M,(M-=m)<U){for(U-=M;V[c++]=v[E++],--M;);if(E=0,m<U){for(U-=M=m;V[c++]=v[E++],--M;);E=c-re,B=V}}}else if(E+=m-M,M<U){for(U-=M;V[c++]=v[E++],--M;);E=c-re,B=V}for(;2<U;)V[c++]=B[E++],V[c++]=B[E++],V[c++]=B[E++],U-=3;U&&(V[c++]=B[E++],1<U&&(V[c++]=B[E++]))}else{for(E=c-re;V[c++]=V[E++],V[c++]=V[E++],V[c++]=V[E++],2<(U-=3););U&&(V[c++]=V[E++],1<U&&(V[c++]=V[E++]))}break}}break}}while(o<l&&c<_);o-=U=k>>3,b&=(1<<(k-=U<<3))-1,i.next_in=o,i.next_out=c,i.avail_in=o<l?l-o+5:5-(o-l),i.avail_out=c<_?_-c+257:257-(c-_),n.hold=b,n.bits=k}},{}],49:[function(t,s,r){var i=t("../utils/common"),a=t("./adler32"),n=t("./crc32"),o=t("./inffast"),l=t("./inftrees"),c=1,d=2,_=0,h=-2,g=1,p=852,m=592;function v(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function k(E){var B;return E&&E.state?(B=E.state,E.total_in=E.total_out=B.total=0,E.msg="",B.wrap&&(E.adler=1&B.wrap),B.mode=g,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new i.Buf32(p),B.distcode=B.distdyn=new i.Buf32(m),B.sane=1,B.back=-1,_):h}function C(E){var B;return E&&E.state?((B=E.state).wsize=0,B.whave=0,B.wnext=0,k(E)):h}function A(E,B){var y,V;return E&&E.state?(V=E.state,B<0?(y=0,B=-B):(y=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?h:(V.window!==null&&V.wbits!==B&&(V.window=null),V.wrap=y,V.wbits=B,C(E))):h}function z(E,B){var y,V;return E?(V=new b,(E.state=V).window=null,(y=A(E,B))!==_&&(E.state=null),y):h}var T,$,M=!0;function U(E){if(M){var B;for(T=new i.Buf32(512),$=new i.Buf32(32),B=0;B<144;)E.lens[B++]=8;for(;B<256;)E.lens[B++]=9;for(;B<280;)E.lens[B++]=7;for(;B<288;)E.lens[B++]=8;for(l(c,E.lens,0,288,T,0,E.work,{bits:9}),B=0;B<32;)E.lens[B++]=5;l(d,E.lens,0,32,$,0,E.work,{bits:5}),M=!1}E.lencode=T,E.lenbits=9,E.distcode=$,E.distbits=5}function re(E,B,y,V){var se,G=E.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new i.Buf8(G.wsize)),V>=G.wsize?(i.arraySet(G.window,B,y-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(V<(se=G.wsize-G.wnext)&&(se=V),i.arraySet(G.window,B,y-V,se,G.wnext),(V-=se)?(i.arraySet(G.window,B,y-V,V,0),G.wnext=V,G.whave=G.wsize):(G.wnext+=se,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=se))),0}r.inflateReset=C,r.inflateReset2=A,r.inflateResetKeep=k,r.inflateInit=function(E){return z(E,15)},r.inflateInit2=z,r.inflate=function(E,B){var y,V,se,G,oe,K,ne,O,P,te,X,q,fe,be,le,he,ye,pe,Ce,Ee,u,N,D,S,x=0,L=new i.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return h;(y=E.state).mode===12&&(y.mode=13),oe=E.next_out,se=E.output,ne=E.avail_out,G=E.next_in,V=E.input,K=E.avail_in,O=y.hold,P=y.bits,te=K,X=ne,N=_;e:for(;;)switch(y.mode){case g:if(y.wrap===0){y.mode=13;break}for(;P<16;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(2&y.wrap&&O===35615){L[y.check=0]=255&O,L[1]=O>>>8&255,y.check=n(y.check,L,2,0),P=O=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&O)<<8)+(O>>8))%31){E.msg="incorrect header check",y.mode=30;break}if((15&O)!=8){E.msg="unknown compression method",y.mode=30;break}if(P-=4,u=8+(15&(O>>>=4)),y.wbits===0)y.wbits=u;else if(u>y.wbits){E.msg="invalid window size",y.mode=30;break}y.dmax=1<<u,E.adler=y.check=1,y.mode=512&O?10:12,P=O=0;break;case 2:for(;P<16;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(y.flags=O,(255&y.flags)!=8){E.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){E.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=O>>8&1),512&y.flags&&(L[0]=255&O,L[1]=O>>>8&255,y.check=n(y.check,L,2,0)),P=O=0,y.mode=3;case 3:for(;P<32;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}y.head&&(y.head.time=O),512&y.flags&&(L[0]=255&O,L[1]=O>>>8&255,L[2]=O>>>16&255,L[3]=O>>>24&255,y.check=n(y.check,L,4,0)),P=O=0,y.mode=4;case 4:for(;P<16;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}y.head&&(y.head.xflags=255&O,y.head.os=O>>8),512&y.flags&&(L[0]=255&O,L[1]=O>>>8&255,y.check=n(y.check,L,2,0)),P=O=0,y.mode=5;case 5:if(1024&y.flags){for(;P<16;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}y.length=O,y.head&&(y.head.extra_len=O),512&y.flags&&(L[0]=255&O,L[1]=O>>>8&255,y.check=n(y.check,L,2,0)),P=O=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(K<(q=y.length)&&(q=K),q&&(y.head&&(u=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),i.arraySet(y.head.extra,V,G,q,u)),512&y.flags&&(y.check=n(y.check,V,q,G)),K-=q,G+=q,y.length-=q),y.length))break e;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(K===0)break e;for(q=0;u=V[G+q++],y.head&&u&&y.length<65536&&(y.head.name+=String.fromCharCode(u)),u&&q<K;);if(512&y.flags&&(y.check=n(y.check,V,q,G)),K-=q,G+=q,u)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(K===0)break e;for(q=0;u=V[G+q++],y.head&&u&&y.length<65536&&(y.head.comment+=String.fromCharCode(u)),u&&q<K;);if(512&y.flags&&(y.check=n(y.check,V,q,G)),K-=q,G+=q,u)break e}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;P<16;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(O!==(65535&y.check)){E.msg="header crc mismatch",y.mode=30;break}P=O=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),E.adler=y.check=0,y.mode=12;break;case 10:for(;P<32;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}E.adler=y.check=v(O),P=O=0,y.mode=11;case 11:if(y.havedict===0)return E.next_out=oe,E.avail_out=ne,E.next_in=G,E.avail_in=K,y.hold=O,y.bits=P,2;E.adler=y.check=1,y.mode=12;case 12:if(B===5||B===6)break e;case 13:if(y.last){O>>>=7&P,P-=7&P,y.mode=27;break}for(;P<3;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}switch(y.last=1&O,P-=1,3&(O>>>=1)){case 0:y.mode=14;break;case 1:if(U(y),y.mode=20,B!==6)break;O>>>=2,P-=2;break e;case 2:y.mode=17;break;case 3:E.msg="invalid block type",y.mode=30}O>>>=2,P-=2;break;case 14:for(O>>>=7&P,P-=7&P;P<32;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if((65535&O)!=(O>>>16^65535)){E.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&O,P=O=0,y.mode=15,B===6)break e;case 15:y.mode=16;case 16:if(q=y.length){if(K<q&&(q=K),ne<q&&(q=ne),q===0)break e;i.arraySet(se,V,G,q,oe),K-=q,G+=q,ne-=q,oe+=q,y.length-=q;break}y.mode=12;break;case 17:for(;P<14;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(y.nlen=257+(31&O),O>>>=5,P-=5,y.ndist=1+(31&O),O>>>=5,P-=5,y.ncode=4+(15&O),O>>>=4,P-=4,286<y.nlen||30<y.ndist){E.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;P<3;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}y.lens[H[y.have++]]=7&O,O>>>=3,P-=3}for(;y.have<19;)y.lens[H[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,D={bits:y.lenbits},N=l(0,y.lens,0,19,y.lencode,0,y.work,D),y.lenbits=D.bits,N){E.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;he=(x=y.lencode[O&(1<<y.lenbits)-1])>>>16&255,ye=65535&x,!((le=x>>>24)<=P);){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(ye<16)O>>>=le,P-=le,y.lens[y.have++]=ye;else{if(ye===16){for(S=le+2;P<S;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(O>>>=le,P-=le,y.have===0){E.msg="invalid bit length repeat",y.mode=30;break}u=y.lens[y.have-1],q=3+(3&O),O>>>=2,P-=2}else if(ye===17){for(S=le+3;P<S;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}P-=le,u=0,q=3+(7&(O>>>=le)),O>>>=3,P-=3}else{for(S=le+7;P<S;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}P-=le,u=0,q=11+(127&(O>>>=le)),O>>>=7,P-=7}if(y.have+q>y.nlen+y.ndist){E.msg="invalid bit length repeat",y.mode=30;break}for(;q--;)y.lens[y.have++]=u}}if(y.mode===30)break;if(y.lens[256]===0){E.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,D={bits:y.lenbits},N=l(c,y.lens,0,y.nlen,y.lencode,0,y.work,D),y.lenbits=D.bits,N){E.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,D={bits:y.distbits},N=l(d,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,D),y.distbits=D.bits,N){E.msg="invalid distances set",y.mode=30;break}if(y.mode=20,B===6)break e;case 20:y.mode=21;case 21:if(6<=K&&258<=ne){E.next_out=oe,E.avail_out=ne,E.next_in=G,E.avail_in=K,y.hold=O,y.bits=P,o(E,X),oe=E.next_out,se=E.output,ne=E.avail_out,G=E.next_in,V=E.input,K=E.avail_in,O=y.hold,P=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;he=(x=y.lencode[O&(1<<y.lenbits)-1])>>>16&255,ye=65535&x,!((le=x>>>24)<=P);){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(he&&(240&he)==0){for(pe=le,Ce=he,Ee=ye;he=(x=y.lencode[Ee+((O&(1<<pe+Ce)-1)>>pe)])>>>16&255,ye=65535&x,!(pe+(le=x>>>24)<=P);){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}O>>>=pe,P-=pe,y.back+=pe}if(O>>>=le,P-=le,y.back+=le,y.length=ye,he===0){y.mode=26;break}if(32&he){y.back=-1,y.mode=12;break}if(64&he){E.msg="invalid literal/length code",y.mode=30;break}y.extra=15&he,y.mode=22;case 22:if(y.extra){for(S=y.extra;P<S;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}y.length+=O&(1<<y.extra)-1,O>>>=y.extra,P-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;he=(x=y.distcode[O&(1<<y.distbits)-1])>>>16&255,ye=65535&x,!((le=x>>>24)<=P);){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if((240&he)==0){for(pe=le,Ce=he,Ee=ye;he=(x=y.distcode[Ee+((O&(1<<pe+Ce)-1)>>pe)])>>>16&255,ye=65535&x,!(pe+(le=x>>>24)<=P);){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}O>>>=pe,P-=pe,y.back+=pe}if(O>>>=le,P-=le,y.back+=le,64&he){E.msg="invalid distance code",y.mode=30;break}y.offset=ye,y.extra=15&he,y.mode=24;case 24:if(y.extra){for(S=y.extra;P<S;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}y.offset+=O&(1<<y.extra)-1,O>>>=y.extra,P-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){E.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(ne===0)break e;if(q=X-ne,y.offset>q){if((q=y.offset-q)>y.whave&&y.sane){E.msg="invalid distance too far back",y.mode=30;break}fe=q>y.wnext?(q-=y.wnext,y.wsize-q):y.wnext-q,q>y.length&&(q=y.length),be=y.window}else be=se,fe=oe-y.offset,q=y.length;for(ne<q&&(q=ne),ne-=q,y.length-=q;se[oe++]=be[fe++],--q;);y.length===0&&(y.mode=21);break;case 26:if(ne===0)break e;se[oe++]=y.length,ne--,y.mode=21;break;case 27:if(y.wrap){for(;P<32;){if(K===0)break e;K--,O|=V[G++]<<P,P+=8}if(X-=ne,E.total_out+=X,y.total+=X,X&&(E.adler=y.check=y.flags?n(y.check,se,X,oe-X):a(y.check,se,X,oe-X)),X=ne,(y.flags?O:v(O))!==y.check){E.msg="incorrect data check",y.mode=30;break}P=O=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;P<32;){if(K===0)break e;K--,O+=V[G++]<<P,P+=8}if(O!==(4294967295&y.total)){E.msg="incorrect length check",y.mode=30;break}P=O=0}y.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;default:return h}return E.next_out=oe,E.avail_out=ne,E.next_in=G,E.avail_in=K,y.hold=O,y.bits=P,(y.wsize||X!==E.avail_out&&y.mode<30&&(y.mode<27||B!==4))&&re(E,E.output,E.next_out,X-E.avail_out)?(y.mode=31,-4):(te-=E.avail_in,X-=E.avail_out,E.total_in+=te,E.total_out+=X,y.total+=X,y.wrap&&X&&(E.adler=y.check=y.flags?n(y.check,se,X,E.next_out-X):a(y.check,se,X,E.next_out-X)),E.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(te==0&&X===0||B===4)&&N===_&&(N=-5),N)},r.inflateEnd=function(E){if(!E||!E.state)return h;var B=E.state;return B.window&&(B.window=null),E.state=null,_},r.inflateGetHeader=function(E,B){var y;return E&&E.state?(2&(y=E.state).wrap)==0?h:((y.head=B).done=!1,_):h},r.inflateSetDictionary=function(E,B){var y,V=B.length;return E&&E.state?(y=E.state).wrap!==0&&y.mode!==11?h:y.mode===11&&a(1,B,V,0)!==y.check?-3:re(E,B,V,V)?(y.mode=31,-4):(y.havedict=1,_):h},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,r){var i=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,d,_,h,g,p,m,v){var b,k,C,A,z,T,$,M,U,re=v.bits,E=0,B=0,y=0,V=0,se=0,G=0,oe=0,K=0,ne=0,O=0,P=null,te=0,X=new i.Buf16(16),q=new i.Buf16(16),fe=null,be=0;for(E=0;E<=15;E++)X[E]=0;for(B=0;B<h;B++)X[d[_+B]]++;for(se=re,V=15;1<=V&&X[V]===0;V--);if(V<se&&(se=V),V===0)return g[p++]=20971520,g[p++]=20971520,v.bits=1,0;for(y=1;y<V&&X[y]===0;y++);for(se<y&&(se=y),E=K=1;E<=15;E++)if(K<<=1,(K-=X[E])<0)return-1;if(0<K&&(c===0||V!==1))return-1;for(q[1]=0,E=1;E<15;E++)q[E+1]=q[E]+X[E];for(B=0;B<h;B++)d[_+B]!==0&&(m[q[d[_+B]]++]=B);if(T=c===0?(P=fe=m,19):c===1?(P=a,te-=257,fe=n,be-=257,256):(P=o,fe=l,-1),E=y,z=p,oe=B=O=0,C=-1,A=(ne=1<<(G=se))-1,c===1&&852<ne||c===2&&592<ne)return 1;for(;;){for($=E-oe,U=m[B]<T?(M=0,m[B]):m[B]>T?(M=fe[be+m[B]],P[te+m[B]]):(M=96,0),b=1<<E-oe,y=k=1<<G;g[z+(O>>oe)+(k-=b)]=$<<24|M<<16|U|0,k!==0;);for(b=1<<E-1;O&b;)b>>=1;if(b!==0?(O&=b-1,O+=b):O=0,B++,--X[E]==0){if(E===V)break;E=d[_+m[B]]}if(se<E&&(O&A)!==C){for(oe===0&&(oe=se),z+=y,K=1<<(G=E-oe);G+oe<V&&!((K-=X[G+oe])<=0);)G++,K<<=1;if(ne+=1<<G,c===1&&852<ne||c===2&&592<ne)return 1;g[C=O&A]=se<<24|G<<16|z-p|0}}return O!==0&&(g[z+O]=E-oe<<24|64<<16|0),v.bits=se,0}},{"../utils/common":41}],51:[function(t,s,r){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,r){var i=t("../utils/common"),a=0,n=1;function o(x){for(var L=x.length;0<=--L;)x[L]=0}var l=0,c=29,d=256,_=d+1+c,h=30,g=19,p=2*_+1,m=15,v=16,b=7,k=256,C=16,A=17,z=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],re=new Array(2*(_+2));o(re);var E=new Array(2*h);o(E);var B=new Array(512);o(B);var y=new Array(256);o(y);var V=new Array(c);o(V);var se,G,oe,K=new Array(h);function ne(x,L,H,W,I){this.static_tree=x,this.extra_bits=L,this.extra_base=H,this.elems=W,this.max_length=I,this.has_stree=x&&x.length}function O(x,L){this.dyn_tree=x,this.max_code=0,this.stat_desc=L}function P(x){return x<256?B[x]:B[256+(x>>>7)]}function te(x,L){x.pending_buf[x.pending++]=255&L,x.pending_buf[x.pending++]=L>>>8&255}function X(x,L,H){x.bi_valid>v-H?(x.bi_buf|=L<<x.bi_valid&65535,te(x,x.bi_buf),x.bi_buf=L>>v-x.bi_valid,x.bi_valid+=H-v):(x.bi_buf|=L<<x.bi_valid&65535,x.bi_valid+=H)}function q(x,L,H){X(x,H[2*L],H[2*L+1])}function fe(x,L){for(var H=0;H|=1&x,x>>>=1,H<<=1,0<--L;);return H>>>1}function be(x,L,H){var W,I,Z=new Array(m+1),J=0;for(W=1;W<=m;W++)Z[W]=J=J+H[W-1]<<1;for(I=0;I<=L;I++){var Y=x[2*I+1];Y!==0&&(x[2*I]=fe(Z[Y]++,Y))}}function le(x){var L;for(L=0;L<_;L++)x.dyn_ltree[2*L]=0;for(L=0;L<h;L++)x.dyn_dtree[2*L]=0;for(L=0;L<g;L++)x.bl_tree[2*L]=0;x.dyn_ltree[2*k]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function he(x){8<x.bi_valid?te(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function ye(x,L,H,W){var I=2*L,Z=2*H;return x[I]<x[Z]||x[I]===x[Z]&&W[L]<=W[H]}function pe(x,L,H){for(var W=x.heap[H],I=H<<1;I<=x.heap_len&&(I<x.heap_len&&ye(L,x.heap[I+1],x.heap[I],x.depth)&&I++,!ye(L,W,x.heap[I],x.depth));)x.heap[H]=x.heap[I],H=I,I<<=1;x.heap[H]=W}function Ce(x,L,H){var W,I,Z,J,Y=0;if(x.last_lit!==0)for(;W=x.pending_buf[x.d_buf+2*Y]<<8|x.pending_buf[x.d_buf+2*Y+1],I=x.pending_buf[x.l_buf+Y],Y++,W===0?q(x,I,L):(q(x,(Z=y[I])+d+1,L),(J=T[Z])!==0&&X(x,I-=V[Z],J),q(x,Z=P(--W),H),(J=$[Z])!==0&&X(x,W-=K[Z],J)),Y<x.last_lit;);q(x,k,L)}function Ee(x,L){var H,W,I,Z=L.dyn_tree,J=L.stat_desc.static_tree,Y=L.stat_desc.has_stree,ie=L.stat_desc.elems,de=-1;for(x.heap_len=0,x.heap_max=p,H=0;H<ie;H++)Z[2*H]!==0?(x.heap[++x.heap_len]=de=H,x.depth[H]=0):Z[2*H+1]=0;for(;x.heap_len<2;)Z[2*(I=x.heap[++x.heap_len]=de<2?++de:0)]=1,x.depth[I]=0,x.opt_len--,Y&&(x.static_len-=J[2*I+1]);for(L.max_code=de,H=x.heap_len>>1;1<=H;H--)pe(x,Z,H);for(I=ie;H=x.heap[1],x.heap[1]=x.heap[x.heap_len--],pe(x,Z,1),W=x.heap[1],x.heap[--x.heap_max]=H,x.heap[--x.heap_max]=W,Z[2*I]=Z[2*H]+Z[2*W],x.depth[I]=(x.depth[H]>=x.depth[W]?x.depth[H]:x.depth[W])+1,Z[2*H+1]=Z[2*W+1]=I,x.heap[1]=I++,pe(x,Z,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],(function(ce,ke){var Be,Ae,je,ge,Ye,ct,Pe=ke.dyn_tree,At=ke.max_code,us=ke.stat_desc.static_tree,ds=ke.stat_desc.has_stree,fs=ke.stat_desc.extra_bits,Lt=ke.stat_desc.extra_base,ze=ke.stat_desc.max_length,qe=0;for(ge=0;ge<=m;ge++)ce.bl_count[ge]=0;for(Pe[2*ce.heap[ce.heap_max]+1]=0,Be=ce.heap_max+1;Be<p;Be++)ze<(ge=Pe[2*Pe[2*(Ae=ce.heap[Be])+1]+1]+1)&&(ge=ze,qe++),Pe[2*Ae+1]=ge,At<Ae||(ce.bl_count[ge]++,Ye=0,Lt<=Ae&&(Ye=fs[Ae-Lt]),ct=Pe[2*Ae],ce.opt_len+=ct*(ge+Ye),ds&&(ce.static_len+=ct*(us[2*Ae+1]+Ye)));if(qe!==0){do{for(ge=ze-1;ce.bl_count[ge]===0;)ge--;ce.bl_count[ge]--,ce.bl_count[ge+1]+=2,ce.bl_count[ze]--,qe-=2}while(0<qe);for(ge=ze;ge!==0;ge--)for(Ae=ce.bl_count[ge];Ae!==0;)At<(je=ce.heap[--Be])||(Pe[2*je+1]!==ge&&(ce.opt_len+=(ge-Pe[2*je+1])*Pe[2*je],Pe[2*je+1]=ge),Ae--)}})(x,L),be(Z,de,x.bl_count)}function u(x,L,H){var W,I,Z=-1,J=L[1],Y=0,ie=7,de=4;for(J===0&&(ie=138,de=3),L[2*(H+1)+1]=65535,W=0;W<=H;W++)I=J,J=L[2*(W+1)+1],++Y<ie&&I===J||(Y<de?x.bl_tree[2*I]+=Y:I!==0?(I!==Z&&x.bl_tree[2*I]++,x.bl_tree[2*C]++):Y<=10?x.bl_tree[2*A]++:x.bl_tree[2*z]++,Z=I,de=(Y=0)===J?(ie=138,3):I===J?(ie=6,3):(ie=7,4))}function N(x,L,H){var W,I,Z=-1,J=L[1],Y=0,ie=7,de=4;for(J===0&&(ie=138,de=3),W=0;W<=H;W++)if(I=J,J=L[2*(W+1)+1],!(++Y<ie&&I===J)){if(Y<de)for(;q(x,I,x.bl_tree),--Y!=0;);else I!==0?(I!==Z&&(q(x,I,x.bl_tree),Y--),q(x,C,x.bl_tree),X(x,Y-3,2)):Y<=10?(q(x,A,x.bl_tree),X(x,Y-3,3)):(q(x,z,x.bl_tree),X(x,Y-11,7));Z=I,de=(Y=0)===J?(ie=138,3):I===J?(ie=6,3):(ie=7,4)}}o(K);var D=!1;function S(x,L,H,W){X(x,(l<<1)+(W?1:0),3),(function(I,Z,J,Y){he(I),te(I,J),te(I,~J),i.arraySet(I.pending_buf,I.window,Z,J,I.pending),I.pending+=J})(x,L,H)}r._tr_init=function(x){D||((function(){var L,H,W,I,Z,J=new Array(m+1);for(I=W=0;I<c-1;I++)for(V[I]=W,L=0;L<1<<T[I];L++)y[W++]=I;for(y[W-1]=I,I=Z=0;I<16;I++)for(K[I]=Z,L=0;L<1<<$[I];L++)B[Z++]=I;for(Z>>=7;I<h;I++)for(K[I]=Z<<7,L=0;L<1<<$[I]-7;L++)B[256+Z++]=I;for(H=0;H<=m;H++)J[H]=0;for(L=0;L<=143;)re[2*L+1]=8,L++,J[8]++;for(;L<=255;)re[2*L+1]=9,L++,J[9]++;for(;L<=279;)re[2*L+1]=7,L++,J[7]++;for(;L<=287;)re[2*L+1]=8,L++,J[8]++;for(be(re,_+1,J),L=0;L<h;L++)E[2*L+1]=5,E[2*L]=fe(L,5);se=new ne(re,T,d+1,_,m),G=new ne(E,$,0,h,m),oe=new ne(new Array(0),M,0,g,b)})(),D=!0),x.l_desc=new O(x.dyn_ltree,se),x.d_desc=new O(x.dyn_dtree,G),x.bl_desc=new O(x.bl_tree,oe),x.bi_buf=0,x.bi_valid=0,le(x)},r._tr_stored_block=S,r._tr_flush_block=function(x,L,H,W){var I,Z,J=0;0<x.level?(x.strm.data_type===2&&(x.strm.data_type=(function(Y){var ie,de=4093624447;for(ie=0;ie<=31;ie++,de>>>=1)if(1&de&&Y.dyn_ltree[2*ie]!==0)return a;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return n;for(ie=32;ie<d;ie++)if(Y.dyn_ltree[2*ie]!==0)return n;return a})(x)),Ee(x,x.l_desc),Ee(x,x.d_desc),J=(function(Y){var ie;for(u(Y,Y.dyn_ltree,Y.l_desc.max_code),u(Y,Y.dyn_dtree,Y.d_desc.max_code),Ee(Y,Y.bl_desc),ie=g-1;3<=ie&&Y.bl_tree[2*U[ie]+1]===0;ie--);return Y.opt_len+=3*(ie+1)+5+5+4,ie})(x),I=x.opt_len+3+7>>>3,(Z=x.static_len+3+7>>>3)<=I&&(I=Z)):I=Z=H+5,H+4<=I&&L!==-1?S(x,L,H,W):x.strategy===4||Z===I?(X(x,2+(W?1:0),3),Ce(x,re,E)):(X(x,4+(W?1:0),3),(function(Y,ie,de,ce){var ke;for(X(Y,ie-257,5),X(Y,de-1,5),X(Y,ce-4,4),ke=0;ke<ce;ke++)X(Y,Y.bl_tree[2*U[ke]+1],3);N(Y,Y.dyn_ltree,ie-1),N(Y,Y.dyn_dtree,de-1)})(x,x.l_desc.max_code+1,x.d_desc.max_code+1,J+1),Ce(x,x.dyn_ltree,x.dyn_dtree)),le(x),W&&he(x)},r._tr_tally=function(x,L,H){return x.pending_buf[x.d_buf+2*x.last_lit]=L>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&L,x.pending_buf[x.l_buf+x.last_lit]=255&H,x.last_lit++,L===0?x.dyn_ltree[2*H]++:(x.matches++,L--,x.dyn_ltree[2*(y[H]+d+1)]++,x.dyn_dtree[2*P(L)]++),x.last_lit===x.lit_bufsize-1},r._tr_align=function(x){X(x,2,3),q(x,k,re),(function(L){L.bi_valid===16?(te(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):8<=L.bi_valid&&(L.pending_buf[L.pending++]=255&L.bi_buf,L.bi_buf>>=8,L.bi_valid-=8)})(x)}},{"../utils/common":41}],53:[function(t,s,r){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,r){(function(i){(function(a,n){if(!a.setImmediate){var o,l,c,d,_=1,h={},g=!1,p=a.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(a);m=m&&m.setTimeout?m:a,o={}.toString.call(a.process)==="[object process]"?function(C){process.nextTick(function(){b(C)})}:(function(){if(a.postMessage&&!a.importScripts){var C=!0,A=a.onmessage;return a.onmessage=function(){C=!1},a.postMessage("","*"),a.onmessage=A,C}})()?(d="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",k,!1):a.attachEvent("onmessage",k),function(C){a.postMessage(d+C,"*")}):a.MessageChannel?((c=new MessageChannel).port1.onmessage=function(C){b(C.data)},function(C){c.port2.postMessage(C)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(C){var A=p.createElement("script");A.onreadystatechange=function(){b(C),A.onreadystatechange=null,l.removeChild(A),A=null},l.appendChild(A)}):function(C){setTimeout(b,0,C)},m.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var A=new Array(arguments.length-1),z=0;z<A.length;z++)A[z]=arguments[z+1];var T={callback:C,args:A};return h[_]=T,o(_),_++},m.clearImmediate=v}function v(C){delete h[C]}function b(C){if(g)setTimeout(b,0,C);else{var A=h[C];if(A){g=!0;try{(function(z){var T=z.callback,$=z.args;switch($.length){case 0:T();break;case 1:T($[0]);break;case 2:T($[0],$[1]);break;case 3:T($[0],$[1],$[2]);break;default:T.apply(n,$)}})(A)}finally{v(C),g=!1}}}}function k(C){C.source===a&&typeof C.data=="string"&&C.data.indexOf(d)===0&&b(+C.data.slice(d.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof tt<"u"?tt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(vt)),vt.exports}var ls=Do();const Et=Fo(ls),Bo=Bs({__proto__:null,default:Et},[ls]);class cs{async serialize(){const e=new Et,t={version:f.version,name:"Untitled Project",lastModified:new Date().toISOString(),palette:f.paletteState.swatches,presets:f.paletteState.presets,dimensions:{width:f.canvas.width,height:f.canvas.height},fps:f.project.fps,structure:f.project.frames.map((s,r)=>({name:s.name,layers:s.layers.map((i,a)=>({name:i.name,isVisible:i.isVisible,isLocked:i.isLocked,isLinked:i.isLinked||!1,type:i.type,parentId:i.parentId,isCollapsed:i.isCollapsed,dataPath:i.type==="LAYER"?`f${r}_l${a}.bin`:null}))}))};return e.file("project.json",JSON.stringify(t)),f.project.frames.forEach((s,r)=>{s.layers.forEach((i,a)=>{i.type==="LAYER"&&e.file(`f${r}_l${a}.bin`,i.pixels.buffer)})}),await e.generateAsync({type:"blob",compression:"DEFLATE"})}async save(){try{const e=await this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=new FileReader;t.onload=async()=>{const r=t.result.split(",")[1];if(window.electronAPI){const i=await window.electronAPI.saveFile(r,f.project.currentFilePath||void 0);i&&(f.project.setMetadata(i),ee.playDraw())}},t.readAsDataURL(e)}catch(e){f.studio.reportError("Save Failed","Could not serialize binary data.",String(e))}}webDownload(e){const t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="rupa-project.rupa",s.click(),URL.revokeObjectURL(t)}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(await this.deserialize(e.content),f.project.setMetadata(e.filePath),ee.playDraw())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=async t=>{const s=t.target.files?.[0];s&&(await this.deserialize(s),ee.playDraw())},e.click()}async backup(){try{const e=await this.serialize();if(window.electronAPI){const t=new FileReader;t.onload=async()=>{const r=t.result.split(",")[1];await window.electronAPI.autoSave(r)},t.readAsDataURL(e)}else{const t=new FileReader;t.onload=async()=>{await He.saveProject("auto_backup",t.result)},t.readAsDataURL(e)}f.project.lastSaved=new Date}catch(e){console.warn("Backup failed:",e)}}async autoSaveSession(){if(this.hasSignificantWork())try{const e=await this.serialize(),t=new FileReader;t.onload=async()=>{await He.saveProject("autosave_session",t.result),f.project.lastSaved=new Date},t.readAsDataURL(e)}catch(e){console.warn("Autosave failed:",e)}}async restoreLastSession(){const e=await He.loadProject("autosave_session");if(e){const s=await(await fetch(e)).blob();return await this.deserialize(s),!0}return!1}hasSignificantWork(){const e=f.project;if(!e.frames||e.frames.length===0)return!1;if(e.frames.length>1||e.frames[0].layers.length>1||f.paletteState.presets.some(i=>!i.isDefault))return!0;const s=e.frames[0].layers[0].pixels;let r=0;for(let i=0;i<s.length;i++)if(s[i]!==0&&(r++,r>10))return!0;return!1}async saveGlobalPalettes(){try{await He.savePresets(f.paletteState.presets)}catch(e){console.warn("Failed to save global palettes:",e)}}async loadGlobalPalettes(){try{const e=await He.loadPresets();if(e){const t=f.paletteState.presets.filter(r=>r.isDefault),s=e.filter(r=>!r.isDefault);f.paletteState.presets=[...t,...s]}}catch(e){console.warn("Failed to load global palettes:",e)}}async deserialize(e){try{const t=new Et;let s;if(typeof e=="string"){if(e.startsWith("{"))return this.deserializeLegacy(e);const a=await fetch(`data:application/zip;base64,${e}`);s=await t.loadAsync(await a.blob())}else s=await t.loadAsync(e);const r=await s.file("project.json")?.async("string");if(!r)throw new Error("Invalid .rupa file");const i=JSON.parse(r);if(f.project.fps=i.fps||10,f.paletteState.swatches=i.palette||f.paletteState.swatches,i.presets&&Array.isArray(i.presets)){const a=f.paletteState.presets.filter(c=>c.isDefault),n=i.presets.filter(c=>!c.isDefault),o=new Set(a.map(c=>c.id)),l=n.filter(c=>!o.has(c.id));f.paletteState.presets=[...a,...l]}f.project.frames=await Promise.all(i.structure.map(async a=>{const n=new ot(a.name,i.dimensions.width,i.dimensions.height);return n.layers=await Promise.all(a.layers.map(async o=>{const l=new Fe(o.name,i.dimensions.width,i.dimensions.height,o.type||"LAYER");if(l.isVisible=o.isVisible,l.isLocked=o.isLocked,l.isLinked=o.isLinked||!1,l.parentId=o.parentId||null,l.isCollapsed=o.isCollapsed||!1,l.type==="LAYER"&&o.dataPath){const c=await s.file(o.dataPath)?.async("arraybuffer");c&&(l.pixels=new Uint32Array(c))}return l})),n})),f.project.activeFrameIndex=0,f.canvas.incrementVersion(),Q.clear()}catch(t){f.studio.reportError("Load Failed","Could not parse project file.",String(t))}}deserializeLegacy(e){try{const t=JSON.parse(e);t.palette&&(f.paletteState.swatches=t.palette);const s=t.project||t.folio;s&&(f.project.frames=s.frames.map(r=>{const i=new ot(r.name,r.width,r.height);return i.layers=(r.layers||[]).map(a=>{const n=new Fe(a.name,r.width,r.height,a.type||"LAYER");return n.pixels=new Uint32Array(a.pixels||[]),n}),i})),f.canvas.incrementVersion(),Q.clear()}catch{}}}const Jo=Object.freeze(Object.defineProperty({__proto__:null,PersistenceService:cs},Symbol.toStringTag,{value:"Module"}));class jo{addFrame(e){const t=f.project,s=t.activeFrameIndex,r=t.addFrame(e),i=t.activeFrameIndex;return Q.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(i,1),t.activeFrameIndex=s},redo:()=>{t.frames.splice(i,0,r),t.activeFrameIndex=i}}),ee.playDraw(),r}removeFrame(e){const t=f.project;if(t.frames.length<=1)return;const s=t.frames[e],r=t.activeFrameIndex;t.removeFrame(e);const i=t.activeFrameIndex;Q.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,s),t.activeFrameIndex=r},redo:()=>{t.removeFrame(e),t.activeFrameIndex=i}}),ee.playErase()}duplicateFrame(e){const t=f.project,s=t.frames[e],r=t.activeFrameIndex,i=t.addFrame(`${s.name} (Copy)`),a=t.activeFrameIndex;i.width=s.width,i.height=s.height,i.layers=s.layers.map(n=>n.clone(s.width,s.height)),Q.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(a,1),t.activeFrameIndex=r},redo:()=>{t.frames.splice(a,0,i),t.activeFrameIndex=a}}),ee.playDraw()}nextFrame(){const e=f.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,Q.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),ee.playMove()}prevFrame(){const e=f.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,Q.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),ee.playMove()}addLayer(e){const t=f.project.activeFrame,s=t.activeLayerIndex,r=t.addLayer(e),i=t.activeLayerIndex;return Q.push({isStructural:!0,label:"Add Layer",undo:()=>{t.layers.splice(i,1),t.activeLayerIndex=s},redo:()=>{t.layers.splice(i,0,r),t.activeLayerIndex=i}}),ee.playDraw(),r}addGroup(e){const t=f.project.activeFrame,s=t.activeLayerIndex,r=t.addGroup(e),i=t.activeLayerIndex;return Q.push({isStructural:!0,label:"Add Group",undo:()=>{t.layers.splice(i,1),t.activeLayerIndex=s},redo:()=>{t.layers.splice(i,0,r),t.activeLayerIndex=i}}),ee.playDraw(),r}removeLayer(e){const t=f.project.activeFrame;if(t.layers.length<=1)return;const s=t.layers[e],r=t.activeLayerIndex;t.removeLayer(e);const i=t.activeLayerIndex;Q.push({isStructural:!0,label:"Remove Layer",undo:()=>{t.layers.splice(e,0,s),t.activeLayerIndex=r},redo:()=>{t.removeLayer(e),t.activeLayerIndex=i}}),ee.playErase()}duplicateLayer(e){const t=f.project.activeFrame,s=t.layers[e],r=t.activeLayerIndex,i=s.clone(t.width,t.height);i.name=`${s.name} (Copy)`;const a=e+1;t.layers.splice(a,0,i),t.activeLayerIndex=a,Q.push({isStructural:!0,label:"Duplicate Layer",undo:()=>{t.layers.splice(a,1),t.activeLayerIndex=r},redo:()=>{t.layers.splice(a,0,i),t.activeLayerIndex=a}}),ee.playDraw()}nextLayer(){const e=f.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex+1)%e.layers.length,Q.push({isStructural:!0,label:"Next Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t+1)%e.layers.length}),ee.playMove()}prevLayer(){const e=f.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex-1+e.layers.length)%e.layers.length,Q.push({isStructural:!0,label:"Prev Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t-1+e.layers.length)%e.layers.length}),ee.playMove()}toggleLock(e){const t=e!==void 0?f.project.activeFrame.layers[e]:f.project.activeFrame.activeLayer;t&&(t.isLocked=!t.isLocked,ee.playDraw())}toggleVisibility(e){const t=e!==void 0?f.project.activeFrame.layers[e]:f.project.activeFrame.activeLayer;t&&(t.isVisible=!t.isVisible,ee.playDraw())}toggleFrameVisibility(e){const t=f.project,s=e!==void 0?e:t.activeFrameIndex,r=t.frames[s];r&&(r.isVisible=!r.isVisible,ee.playDraw(),Q.push({isStructural:!0,label:"Toggle Frame Visibility",undo:()=>r.isVisible=!r.isVisible,redo:()=>r.isVisible=!r.isVisible}))}reorderLayer(e,t){const s=f.project.activeFrame;if(e===t||t<0||t>=s.layers.length)return;const r=s.activeLayerIndex;((n,o)=>{const[l]=s.layers.splice(n,1);s.layers.splice(o,0,l),s.activeLayerIndex===n?s.activeLayerIndex=o:n<s.activeLayerIndex&&o>=s.activeLayerIndex?s.activeLayerIndex--:n>s.activeLayerIndex&&o<=s.activeLayerIndex&&s.activeLayerIndex++})(e,t);const a=s.activeLayerIndex;Q.push({isStructural:!0,label:"Reorder Layer",undo:()=>{const[n]=s.layers.splice(t,1);s.layers.splice(e,0,n),s.activeLayerIndex=r},redo:()=>{const[n]=s.layers.splice(e,1);s.layers.splice(t,0,n),s.activeLayerIndex=a}}),ee.playMove()}reorderFrame(e,t){const s=f.project;if(e===t||t<0||t>=s.frames.length)return;const r=s.activeFrameIndex;((n,o)=>{const[l]=s.frames.splice(n,1);s.frames.splice(o,0,l),s.activeFrameIndex===n?s.activeFrameIndex=o:n<s.activeFrameIndex&&o>=s.activeFrameIndex?s.activeFrameIndex--:n>s.activeFrameIndex&&o<=s.activeFrameIndex&&s.activeFrameIndex++})(e,t);const a=s.activeFrameIndex;Q.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[n]=s.frames.splice(t,1);s.frames.splice(e,0,n),s.activeFrameIndex=r},redo:()=>{const[n]=s.frames.splice(e,1);s.frames.splice(t,0,n),s.activeFrameIndex=a}}),ee.playMove()}moveLayerUp(){const e=f.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,t+1)}moveLayerDown(){const t=f.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,t-1)}moveLayerToTop(){const e=f.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,e.layers.length-1)}moveLayerToBottom(){const t=f.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,0)}mergeLayerDown(){const e=f.project.activeFrame,t=e.activeLayerIndex;if(t<=0)return;const s=t-1,r=e.layers[t],i=e.layers[s],a=new Uint32Array(i.pixels),n=ve.mergeLayers([i.pixels,r.pixels],e.width,e.height);i.pixels=n,e.layers.splice(t,1),e.activeLayerIndex=s,f.canvas.incrementVersion(),Q.push({isStructural:!0,label:"Merge Layer",undo:()=>{i.pixels=a,e.layers.splice(t,0,r),e.activeLayerIndex=t,f.canvas.incrementVersion()},redo:()=>{i.pixels=n,e.layers.splice(t,1),e.activeLayerIndex=s,f.canvas.incrementVersion()}}),ee.playDraw()}mergeSelectedLayers(){const e=f.project.activeFrame,t=Array.from(e.selectedLayerIndices).sort((g,p)=>g-p);if(t.length<=1)return;const s=t[0],r=e.layers[s],i=new Uint32Array(r.pixels),n=t.map(g=>e.layers[g]).map(g=>g.pixels),o=ve.mergeLayers(n,e.width,e.height),l=[...e.layers],c=e.activeLayerIndex,d=new Set(e.selectedLayerIndices),_=e.layers.filter((g,p)=>!e.selectedLayerIndices.has(p)||p===s),h=_.indexOf(r);e.layers=_,r.pixels=o,e.activeLayerIndex=h,e.selectedLayerIndices=new Set([h]),f.canvas.incrementVersion(),Q.push({isStructural:!0,label:"Merge Selected Layers",undo:()=>{e.layers=l,r.pixels=i,e.activeLayerIndex=c,e.selectedLayerIndices=d,f.canvas.incrementVersion()},redo:()=>{e.layers=_,r.pixels=o,e.activeLayerIndex=h,e.selectedLayerIndices=new Set([h]),f.canvas.incrementVersion()}}),ee.playDraw()}mergeFrames(){const e=f.project,t=Array.from(e.selectedFrameIndices).sort((n,o)=>n-o);if(t.length<=1)return;const s=t[0],r=e.frames[s],i=e.addFrame(`${r.name} (Merged)`);i.layers=[],t.forEach((n,o)=>{const l=e.frames[n],c=i.addLayer(`Frame ${n+1}`);c.pixels=new Uint32Array(l.compositePixels)});const a=e.frames.indexOf(i);e.activeFrameIndex=a,Q.push({isStructural:!0,label:"Merge Frames",undo:()=>{e.frames.splice(a,1),e.activeFrameIndex=s},redo:()=>{e.frames.splice(a,0,i),e.activeFrameIndex=a}}),ee.playDraw()}addTag(e,t,s,r="#d33682"){const i={id:crypto.randomUUID(),name:e,color:r,from:t,to:s};return f.project.tags.push(i),ee.playDraw(),i}removeTag(e){f.project.tags=f.project.tags.filter(t=>t.id!==e),ee.playErase()}}class zo{begin(e,t){f.selection.initMask(f.canvas.width,f.canvas.height),f.selection.begin(e,t)}lassoBegin(e,t){const s=f.selection;s.initMask(f.canvas.width,f.canvas.height),s.selectionMode==="NEW"&&s.clear(),s.vertices=[{x:e,y:t}]}lassoUpdate(e,t){const s=f.selection,r=s.vertices[s.vertices.length-1];(!r||r.x!==e||r.y!==t)&&s.vertices.push({x:e,y:t})}lassoEnd(){this.commitPolygon()}update(e,t){f.selection.isActive&&f.selection.update(e,t)}clear(){f.selection.clear()}fillSelection(){const e=f.selection;e.start&&e.end&&this.commit(),e.vertices.length>0&&this.commitPolygon();const t=e.mask,s=f.paletteState.activeColor,r=me.hexToUint32(s);Q.beginBatch();let i=!1;const a=new Uint32Array(f.canvas.pixels);for(let n=0;n<t.length;n++)if(t[n]===1){const o=a[n];o!==r&&(Q.pushPixel(n,o,r),a[n]=r,i=!0)}Q.endBatch(),i&&(f.canvas.pixels=a,f.canvas.incrementVersion(),ee.playDraw())}commit(){const e=f.canvas.width,t=f.canvas.height,s=f.selection,r=s.rectangularBounds;if(r){const i=new Uint8Array(s.mask),a=s.selectionMode==="SUBTRACT"?0:1;for(let n=r.y1;n<=r.y2;n++)for(let o=r.x1;o<=r.x2;o++)o>=0&&o<e&&n>=0&&n<t&&(i[n*e+o]=a);s.mask=i,s.start=null,s.end=null}f.canvas.incrementVersion()}magicWand(){const{x:e,y:t}=f.cursor.pos,{width:s,height:r,pixels:i}=f.canvas,a=f.selection,n=t*s+e;if(a.mask[n]===1){this.fillSolidHull();return}a.initMask(s,r);const o=i[n],l=a.selectionMode==="NEW"?new Uint8Array(s*r):new Uint8Array(a.mask),c=a.selectionMode==="SUBTRACT"?0:1,d=[[e,t]],_=new Uint8Array(s*r);for(;d.length>0;){let[h,g]=d.pop(),p=h;for(;p>0&&i[g*s+(p-1)]===o&&_[g*s+(p-1)]===0;)p--;for(;h<s&&i[g*s+h]===o&&_[g*s+h]===0;){const m=g*s+h;l[m]=c,_[m]=1,g>0&&i[(g-1)*s+h]===o&&_[(g-1)*s+h]===0&&d.push([h,g-1]),g<r-1&&i[(g+1)*s+h]===o&&_[(g+1)*s+h]===0&&d.push([h,g+1]),h++}}a.mask=l,f.canvas.incrementVersion(),ee.playScale(4)}fillSolidHull(){const e=f.canvas.width,t=f.canvas.height,s=f.selection,r=s.mask,i=new Uint8Array(e*t),a=[];for(let o=0;o<e;o++)r[o]===0&&a.push([o,0]),r[(t-1)*e+o]===0&&a.push([o,t-1]);for(let o=0;o<t;o++)r[o*e]===0&&a.push([0,o]),r[o*e+(e-1)]===0&&a.push([e-1,o]);for(;a.length>0;){const[o,l]=a.pop(),c=l*e+o;if(i[c]===1)continue;i[c]=1;const d=[[o+1,l],[o-1,l],[o,l+1],[o,l-1]];for(const[_,h]of d)if(_>=0&&_<e&&h>=0&&h<t){const g=h*e+_;i[g]===0&&r[g]===0&&a.push([_,h])}}const n=new Uint8Array(e*t);for(let o=0;o<n.length;o++)i[o]===0&&(n[o]=1);s.mask=n,f.canvas.incrementVersion(),ee.playScale(8),f.studio.show("Solidified Selection")}addVertex(e,t){f.selection.vertices.push({x:e,y:t}),ee.playDraw()}commitPolygon(){const e=f.selection.vertices;if(e.length<3)return;const t=f.canvas.width,s=f.canvas.height,r=f.selection;r.initMask(t,s);const i=r.selectionMode==="NEW"?new Uint8Array(t*s):new Uint8Array(r.mask),a=r.selectionMode==="SUBTRACT"?0:1;for(let n=0;n<s;n++)for(let o=0;o<t;o++)this.isPointInPoly(o,n,e)&&(i[n*t+o]=a);r.mask=i,r.vertices=[],f.canvas.incrementVersion(),ee.playScale(6)}isPointInPoly(e,t,s){let r=!1;for(let i=0,a=s.length-1;i<s.length;a=i++){const n=s[i].x,o=s[i].y,l=s[a].x,c=s[a].y;o>t!=c>t&&e<(l-n)*(t-o)/(c-o)+n&&(r=!r)}return r}selectAll(){const{width:e,height:t}=f.canvas,s=f.selection,r=f.project.activeFrame.activeLayer.pixels,i=f.project.activeFrame.compositePixels;s.initMask(e,t);const a=s.mask;let n=!0,o=0;for(let c=0;c<r.length;c++)r[c]!==0&&(o++,a[c]===0&&(n=!1));o===0&&(n=!0);const l=new Uint8Array(e*t);if(!n||s.maskCount<o){for(let c=0;c<r.length;c++)r[c]!==0&&(l[c]=1);f.studio.show("Selected Active Layer")}else{for(let c=0;c<i.length;c++)i[c]!==0&&(l[c]=1);f.studio.show("Selected Entire Frame")}s.mask=l,f.canvas.incrementVersion(),ee.playScale(5)}eraseSelection(){const e=f.selection;e.start&&e.end&&this.commit(),e.vertices.length>0&&this.commitPolygon(),f.canvas.width;const t=e.mask;Q.beginBatch();let s=!1;const r=new Uint32Array(f.canvas.pixels);for(let i=0;i<t.length;i++)if(t[i]===1){const a=r[i];a!==0&&(Q.pushPixel(i,a,0),r[i]=0,s=!0)}Q.endBatch(),s&&(f.canvas.pixels=r,f.canvas.incrementVersion(),ee.playErase())}nudge(e,t){const s=f.selection,r=f.canvas.width,i=f.canvas.height,a=new Uint32Array(f.canvas.pixels),n=s.mask,o=new Uint8Array(r*i),l=new Map;for(let c=0;c<n.length;c++)n[c]===1&&(l.set(c,a[c]),a[c]=0);l.size!==0&&(l.forEach((c,d)=>{const _=d%r,h=Math.floor(d/r),g=_+e,p=h+t;if(g>=0&&g<r&&p>=0&&p<i){const m=p*r+g;a[m]=c,o[m]=1}}),f.canvas.pixels=a,f.canvas.incrementVersion(),s.mask=o,ee.playMove())}propagate(e,t,s){if(f.selection.maskCount===0)return;const r=f.project,i=r.activeFrameIndex,a=r.activeFrame.activeLayerIndex,n=f.canvas.width,o=f.canvas.height,l=f.selection.mask,c=r.activeFrame.activeLayer,d=[];for(let p=0;p<l.length;p++)l[p]===1&&d.push({x:p%n,y:Math.floor(p/n),val:c.pixels[p]});const _=new Map,h=new Map;for(let p=1;p<=e;p++){const m=i+p;if(m>=r.frames.length)break;const v=r.frames[m].layers[a];if(!v||v.isLocked)continue;_.set(m,new Uint32Array(v.pixels));const b=new Uint32Array(v.pixels),k=t*p,C=s*p;d.forEach(A=>{const z=A.x+k,T=A.y+C;z>=0&&z<n&&T>=0&&T<o&&(b[T*n+z]=A.val)}),h.set(m,b)}const g=p=>{p.forEach((m,v)=>{const b=r.frames[v].layers[a];b&&(b.pixels=m)}),f.canvas.incrementVersion()};g(h),Q.push({isStructural:!0,label:"Selection Propagation",undo:()=>g(_),redo:()=>g(h)}),ee.playDraw(),f.studio.show(`Propagated across ${h.size} frames`)}}class No{select(e){f.paletteState.select(e),ee.playScale(e)}setColor(e){f.paletteState.setColor(e),ee.playDraw()}pickFromCanvas(){const{x:e,y:t}=f.cursor.pos,s=f.canvas.getColor(e,t),r=me.uint32ToHex(s);r!==null&&(this.setColor(r),f.studio.isPicking=!0,setTimeout(()=>{f.studio.isPicking=!1},1500))}adjustPaletteBrightness(e){f.paletteState.swatches=f.paletteState.swatches.map(t=>me.adjustBrightness(t,e)),ee.playDraw()}mixActiveColor(e,t=.5){const s=me.mix(f.activeColor,e,t);this.setColor(s)}floodFill(){const{x:e,y:t}=f.cursor.pos,s=f.canvas.getColor(e,t),r=f.activeColor,i=me.hexToUint32(r);if(s===i)return;const{width:a,height:n,pixels:o}=f.canvas,l=ve.floodFill(Array.from(o),a,n,e,t,i),c=new Uint32Array(l);let d=!1;Q.beginBatch();const _=f.selection.isActive,h=f.selection.activeIndicesSet;for(let g=0;g<c.length;g++)if(c[g]!==o[g]){if(_&&!h.has(g)){c[g]=o[g];continue}Q.pushPixel(g,o[g],i),d=!0}Q.endBatch(),d&&(f.canvas.pixels=c,f.canvas.incrementVersion(),ee.playDraw())}}class Uo{undo(){const e=Q.undo();if(e){if("isStructural"in e)e.undo(),ee.playErase();else{const t=new Uint32Array(f.canvas.pixels),{indices:s,oldColors:r}=e;for(let i=s.length-1;i>=0;i--)t[s[i]]=r[i];f.canvas.pixels=t,f.canvas.incrementVersion(),ee.playErase()}f.cursor.resetInactivityTimer()}}redo(){const e=Q.redo();if(e){if("isStructural"in e)e.redo(),ee.playDraw();else{const t=new Uint32Array(f.canvas.pixels),{indices:s,newColors:r}=e;for(let i=0;i<s.length;i++)t[s[i]]=r[i];f.canvas.pixels=t,f.canvas.incrementVersion(),ee.playDraw()}f.cursor.resetInactivityTimer()}}}class hs{_movement=null;_draw=null;_manipulation=null;_clipboard=null;_persistence=null;_project=null;_selection=null;_color=null;_history=null;get movement(){return this._movement||(this._movement=new go),this._movement}get draw(){return this._draw||(this._draw=new Oo),this._draw}get manipulation(){return this._manipulation||(this._manipulation=new Ro),this._manipulation}get clipboard(){return this._clipboard||(this._clipboard=new Mo),this._clipboard}get persistence(){return this._persistence||(this._persistence=new cs),this._persistence}get project(){return this._project||(this._project=new jo),this._project}get selection(){return this._selection||(this._selection=new zo),this._selection}get color(){return this._color||(this._color=new No),this._color}get history(){return this._history||(this._history=new Uo),this._history}moveCursor(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}jumpHome(){this.movement.jumpHome()}paint(){this.draw.draw()}erase(){this.draw.erase()}pickColor(){this.color.pickFromCanvas()}startSelection(){this.selection.begin(f.cursor.pos.x,f.cursor.pos.y)}updateSelection(){this.selection.update(f.cursor.pos.x,f.cursor.pos.y)}commitSelection(){this.selection.fillSelection()}clearCanvas(){this.manipulation.clearAll()}resizeCanvas(e,t){this.manipulation.resize(e,t)}flipCanvas(e){this.manipulation.flip(e)}rotateCanvas(){this.manipulation.rotate()}mergeLayerDown(){this.project.mergeLayerDown()}mergeSelectedLayers(){this.project.mergeSelectedLayers()}mergeFrames(){this.project.mergeFrames()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),f.selection.clear()}undo(){this.history.undo()}redo(){this.history.redo()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async asyncCreateArtifact(e,t=10,s="transparent"){f.studio.show("Preparing Cup..."),f.studio.exportProgress=0;const{ExportEngine:r}=await rt(async()=>{const{ExportEngine:h}=await import("./Dc0hpwos.js");return{ExportEngine:h}},__vite__mapDeps([0,1,2]),import.meta.url),{width:i,height:a}=f.canvas,n=f.studio.includePixelBorders,o=["webm","gif","mp4"].includes(e),l=h=>{f.studio.exportProgress=Math.round(h*100)};let c=[];if(o)c=f.project.frames.filter(h=>h.isVisible);else switch(f.studio.exportFrameSelection){case"ACTIVE":c=[f.project.activeFrame];break;case"VISIBLE":c=f.project.frames.filter(h=>h.isVisible);break;case"SELECTED":c=Array.from(f.project.selectedFrameIndices).sort((h,g)=>h-g).map(h=>f.project.frames[h]);break;case"ALL":c=f.project.frames;break;case"SELECTED_LAYERS":c=[{name:"Selected Layers",compositePixels:f.project.activeFrame.getSelectedLayerComposite()}];break;default:c=[f.project.activeFrame]}if(c.length===0){f.studio.show("No frames to export"),f.studio.exportProgress=0;return}const d=c.length<=1&&o?"png":e,_=1e3/f.project.fps;if(d==="svg")if(c.length>1){const h=c.map(v=>v.compositePixels),g=c.map(()=>_),p=await r.toAnimatedSVG(i,a,h,g,s,n,l),m=new Blob([p],{type:"image/svg+xml"});this.download(URL.createObjectURL(m),"rupa-image.svg")}else{const h=c[0],g=await r.toSVG(i,a,h.compositePixels,s,n,l),p=new Blob([g],{type:"image/svg+xml"});this.download(URL.createObjectURL(p),"rupa-image.svg")}else if(d==="webm"||d==="mp4"){const h=c.map(v=>v.compositePixels),g=c.map(()=>_),p=await r.toVideo(i,a,h,g,t,d,s,n,l),m=p.type.includes("mp4")?"mp4":"webm";this.download(URL.createObjectURL(p),`rupa-video.${m}`)}else if(d==="gif"){const h=c.map(m=>m.compositePixels),g=c.map(()=>_),p=await r.toGIF(i,a,h,g,t,s,n,l);this.download(URL.createObjectURL(p),"rupa-animation.gif")}else if(c.length>1){const h=(await rt(async()=>{const{default:m}=await Promise.resolve().then(()=>Bo);return{default:m}},void 0,import.meta.url)).default,g=new h;for(let m=0;m<c.length;m++){const v=c[m],k=(await r.toRaster(i,a,v.compositePixels,t,d,s,n)).split(",")[1];g.file(`${v.name.toLowerCase().replace(/\s+/g,"-")}-${m}.${d}`,k,{base64:!0}),l((m+1)/c.length),await new Promise(C=>setTimeout(C,0))}const p=await g.generateAsync({type:"blob"});this.download(URL.createObjectURL(p),"rupa-export.zip")}else{const h=c[0],g=await r.toRaster(i,a,h.compositePixels,t,d,s,n);this.download(g,`rupa-image.${d}`),l(1)}f.studio.exportProgress=100,await new Promise(h=>setTimeout(h,300)),f.studio.showExportMenu=!1,f.studio.exportProgress=0}createArtifact(e,t=10,s="transparent"){return this.asyncCreateArtifact(e,t,s)}download(e,t){const s=document.createElement("a");s.href=e,s.download=t.toLowerCase().replace(/\s+/g,"-"),s.click()}}const ue=new hs,Jt=Object.freeze(Object.defineProperty({__proto__:null,ServiceCoordinator:hs,services:ue},Symbol.toStringTag,{value:"Module"}));class Vo{onActivity=null;isPointerDown=!1;#e=j(!1);get isPointerDownActive(){return R(this.#e)}set isPointerDownActive(e){F(this.#e,e,!0)}lastPosition={x:-1,y:-1};lastScreenPos=null;buttonType=null;holdTimer=null;isSnapped=!1;rafId=null;#t=j(!1);get isSnappedState(){return R(this.#t)}set isSnappedState(e){F(this.#t,e,!0)}mapToGrid(e,t,s){const r=s.getBoundingClientRect();return xe.mapScreenToGrid(e,t,r,f.canvas.width,f.canvas.height)}handleStart(e,t){this.onActivity&&this.onActivity(),this.isPointerDown=!0,this.isPointerDownActive=!0,this.isSnapped=!1,this.buttonType=e.button===2?"secondary":"primary",this.lastScreenPos={x:e.clientX,y:e.clientY};const s=this.mapToGrid(e.clientX,e.clientY,t);if(this.lastPosition={x:s.x,y:s.y},e.ctrlKey||e.metaKey){f.cursor.pos={x:Math.floor(s.x),y:Math.floor(s.y)},this.isPointerDown=!1,this.isPointerDownActive=!1;return}const r=Me.current.type;if(r==="PAN")return;f.cursor.pos={x:Math.floor(s.x),y:Math.floor(s.y)};const i=f.studio.activeTool;if((i==="RECT_SELECT"||i==="LASSO_SELECT"||i==="POLY_SELECT"||i==="MAGIC_WAND")&&(e.shiftKey?f.selection.selectionMode="ADD":e.altKey?f.selection.selectionMode="SUBTRACT":f.selection.selectionMode="NEW"),this.buttonType==="primary"){if(i==="RECT_SELECT"){ue.selection.begin(f.cursor.pos.x,f.cursor.pos.y);return}if(i==="LASSO_SELECT"){ue.selection.lassoBegin(f.cursor.pos.x,f.cursor.pos.y);return}if(i==="MAGIC_WAND"){ue.selection.magicWand(),this.isPointerDown=!1,this.isPointerDownActive=!1;return}if(i==="POLY_SELECT"){ue.selection.addVertex(f.cursor.pos.x,f.cursor.pos.y),this.isPointerDown=!1,this.isPointerDownActive=!1;return}}if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(i)){f.studio.shapeAnchor={...f.cursor.pos};return}const a=f.studio.isShadingLighten||f.studio.isShadingDarken||f.studio.isShadingDither;this.buttonType==="primary"&&r!=="SELECT"&&(a?ue.draw.draw(s.x,s.y):(ue.draw.beginStroke(s.x,s.y),this.startHoldTimer()))}handleMove(e,t){this.isPointerDown&&(this.onActivity&&this.onActivity(),!this.rafId&&(this.rafId=requestAnimationFrame(()=>{const s=this.mapToGrid(e.clientX,e.clientY,t),r=Me.current.type,i=f.studio.activeTool;if(r==="PAN"){const n=xe.calculatePanDelta(e.clientX,e.clientY,this.lastScreenPos?.x||e.clientX,this.lastScreenPos?.y||e.clientY);f.studio.panOffset.x+=n.dx,f.studio.panOffset.y+=n.dy,this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null;return}if(f.cursor.pos={x:Math.floor(s.x),y:Math.floor(s.y)},this.buttonType==="primary"){if(i==="RECT_SELECT"){ue.selection.update(f.cursor.pos.x,f.cursor.pos.y),this.rafId=null;return}if(i==="LASSO_SELECT"){ue.selection.lassoUpdate(f.cursor.pos.x,f.cursor.pos.y),this.rafId=null;return}}const a=f.studio.isShadingLighten||f.studio.isShadingDarken||f.studio.isShadingDither;if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(i)){this.lastPosition={x:s.x,y:s.y},this.rafId=null;return}this.buttonType==="primary"&&r!=="SELECT"&&(a?ue.draw.draw(s.x,s.y):this.isSnapped||(ue.draw.continueStroke(s.x,s.y,this.lastPosition.x,this.lastPosition.y),this.resetHoldTimer())),this.lastPosition={x:s.x,y:s.y},this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null})))}handleEnd(){if(!this.isPointerDown)return;this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);const e=Me.current.type,t=f.studio.activeTool;this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(t)?ue.draw.commitShape():this.buttonType==="primary"&&t==="RECT_SELECT"?ue.selection.commit():this.buttonType==="primary"&&t==="LASSO_SELECT"?ue.selection.lassoEnd():this.buttonType==="primary"&&e!=="SELECT"?ue.draw.endStroke():f.canvas.clearBuffer(),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1}cancel(){this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1,ue.draw.cancelStroke()}startHoldTimer(){this.clearHoldTimer(),this.holdTimer=setTimeout(()=>{this.isPointerDown&&this.triggerSnap()},600)}resetHoldTimer(){this.isSnapped||this.startHoldTimer()}clearHoldTimer(){this.holdTimer&&clearTimeout(this.holdTimer),this.holdTimer=null}triggerSnap(){this.isSnapped=!0,this.isSnappedState=!0,ue.draw.snapCurrentStroke()}}const Qt=new Vo;class $o{version="0.10.0";project=new fo;canvas=new qa(this.project);cursor=new Xa;paletteState=new eo;studio=new ro;selection=new po;get pixels(){return this.canvas.pixels}set pixels(e){this.canvas.pixels=e}get canvasWidth(){return this.canvas.width}set canvasWidth(e){this.canvas.width=e}get canvasHeight(){return this.canvas.height}set canvasHeight(e){this.canvas.height=e}get activeColor(){return this.paletteState.activeColor}set activeColor(e){this.paletteState.activeColor=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get usageMinutes(){return this.studio.usageMinutes}get backgroundColor(){return this.studio.backgroundColor}set backgroundColor(e){this.studio.backgroundColor=e}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isCursorVisible(){return this.cursor.isVisible}set isCursorVisible(e){this.cursor.isVisible=e}get showColorPicker(){return this.studio.showColorPicker}set showColorPicker(e){this.studio.showColorPicker=e}get showAudioSettings(){return this.studio.showAudioSettings}set showAudioSettings(e){this.studio.showAudioSettings=e}get showCommandPalette(){return this.studio.showCommandPalette}set showCommandPalette(e){this.studio.showCommandPalette=e}get showManual(){return this.studio.showManual}set showManual(e){this.studio.showManual=e}get showShortcuts(){return this.studio.showShortcuts}set showShortcuts(e){this.studio.showShortcuts=e}get showExportMenu(){return this.studio.showExportMenu}set showExportMenu(e){this.studio.showExportMenu=e}get showCanvasSettings(){return this.studio.showCanvasSettings}set showCanvasSettings(e){this.studio.showCanvasSettings=e}get showPersistenceMenu(){return this.studio.showPersistenceMenu}set showPersistenceMenu(e){this.studio.showPersistenceMenu=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get showGhostLayers(){return this.studio.showGhostLayers}set showGhostLayers(e){this.studio.showGhostLayers=e}#e=Te(()=>({x:xe.toCartesianLabel(this.cursor.pos.x,this.canvas.width),y:xe.toCartesianLabel(this.cursor.pos.y,this.canvas.height,!0)}));get displayCoords(){return R(this.#e)}set displayCoords(e){F(this.#e,e)}#t=Te(()=>xe.calculateCameraTransform(this.studio.zoomLevel,this.studio.panOffset,this.cursor.pos,this.canvas.width,this.canvas.height));get cameraTransform(){return R(this.#t)}set cameraTransform(e){F(this.#t,e)}#s=Te(()=>{const e=new Set;return this.canvas.compositePixels.forEach(t=>{const s=me.uint32ToHex(t);s!==null&&e.add(s)}),Array.from(e)});get usedColors(){return R(this.#s)}set usedColors(e){F(this.#s,e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}toggleMute(){this.studio.toggleMute()}handleEscape(){if(this.studio.handleEscape())return!0;let t=!1;this.project.selectedFrameIndices.size>1&&(this.project.selectedFrameIndices=new Set([this.project.activeFrameIndex]),t=!0);const s=this.project.activeFrame;return s.selectedLayerIndices.size>1&&(s.selectedLayerIndices=new Set([s.activeLayerIndex]),t=!0),t?!0:Qt.isPointerDownActive?(Qt.cancel(),!0):this.selection.isActive?this.studio.isTransforming?(this.studio.isTransforming=!1,!0):(this.selection.clear(),!0):this.studio.activeTool!=="BRUSH"?(this.studio.activeTool="BRUSH",this.studio.shapeAnchor=null,!0):this.studio.isShadingLighten||this.studio.isShadingDarken||this.studio.isShadingDither?(this.studio.isShadingLighten=!1,this.studio.isShadingDarken=!1,this.studio.isShadingDither=!1,this.studio.show(Se("ui:studio.texture_off")),!0):!1}undo(){ue.undo()}redo(){ue.redo()}clearCanvas(){ue.clearCanvas()}pickColor(){ue.pickColor()}loadProject(){ue.load()}copySelection(){ue.copy()}cutSelection(){ue.cut()}pasteSelection(){ue.paste()}flipCanvas(e){ue.flipCanvas(e)}rotateCanvas(){ue.rotateCanvas()}}const f=new $o;export{me as C,xe as G,He as S,Se as _,Ko as a,Zo as b,no as c,Ve as d,f as e,ee as f,ue as g,uo as h,Wo as i,Yo as j,$e as k,Jo as l,Me as m,Qt as p,Xo as s,qo as t};
