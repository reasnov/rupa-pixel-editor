function M(e,t,s,a){var r=0,a=a===void 0?{}:a,w=a.loop===void 0?null:a.loop,v=a.palette===void 0?null:a.palette;if(t<=0||s<=0||t>65535||s>65535)throw new Error("Width/Height invalid.");function k(n){var l=n.length;if(l<2||l>256||l&l-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return l}e[r++]=71,e[r++]=73,e[r++]=70,e[r++]=56,e[r++]=57,e[r++]=97;var d=0,i=0;if(v!==null){for(var c=k(v);c>>=1;)++d;if(c=1<<d,--d,a.background!==void 0){if(i=a.background,i>=c)throw new Error("Background index out of range.");if(i===0)throw new Error("Background index explicitly passed as 0.")}}if(e[r++]=t&255,e[r++]=t>>8&255,e[r++]=s&255,e[r++]=s>>8&255,e[r++]=(v!==null?128:0)|d,e[r++]=i,e[r++]=0,v!==null)for(var B=0,m=v.length;B<m;++B){var h=v[B];e[r++]=h>>16&255,e[r++]=h>>8&255,e[r++]=h&255}if(w!==null){if(w<0||w>65535)throw new Error("Loop count invalid.");e[r++]=33,e[r++]=255,e[r++]=11,e[r++]=78,e[r++]=69,e[r++]=84,e[r++]=83,e[r++]=67,e[r++]=65,e[r++]=80,e[r++]=69,e[r++]=50,e[r++]=46,e[r++]=48,e[r++]=3,e[r++]=1,e[r++]=w&255,e[r++]=w>>8&255,e[r++]=0}var _=!1;this.addFrame=function(n,l,g,p,O,o){if(_===!0&&(--r,_=!1),o=o===void 0?{}:o,n<0||l<0||n>65535||l>65535)throw new Error("x/y invalid.");if(g<=0||p<=0||g>65535||p>65535)throw new Error("Width/Height invalid.");if(O.length<g*p)throw new Error("Not enough pixels for the frame size.");var G=!0,E=o.palette;if(E==null&&(G=!1,E=v),E==null)throw new Error("Must supply either a local or global palette.");for(var H=k(E),W=0;H>>=1;)++W;H=1<<W;var L=o.delay===void 0?0:o.delay,y=o.disposal===void 0?0:o.disposal;if(y<0||y>3)throw new Error("Disposal out of range.");var P=!1,u=0;if(o.transparent!==void 0&&o.transparent!==null&&(P=!0,u=o.transparent,u<0||u>=H))throw new Error("Transparent color index.");if((y!==0||P||L!==0)&&(e[r++]=33,e[r++]=249,e[r++]=4,e[r++]=y<<2|(P===!0?1:0),e[r++]=L&255,e[r++]=L>>8&255,e[r++]=u,e[r++]=0),e[r++]=44,e[r++]=n&255,e[r++]=n>>8&255,e[r++]=l&255,e[r++]=l>>8&255,e[r++]=g&255,e[r++]=g>>8&255,e[r++]=p&255,e[r++]=p>>8&255,e[r++]=G===!0?128|W-1:0,G===!0)for(var C=0,F=E.length;C<F;++C){var D=E[C];e[r++]=D>>16&255,e[r++]=D>>8&255,e[r++]=D&255}return r=I(e,r,W<2?2:W,O),r},this.end=function(){return _===!1&&(e[r++]=59,_=!0),r},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(n){e=n},this.getOutputBufferPosition=function(){return r},this.setOutputBufferPosition=function(n){r=n}}function I(e,t,s,x){e[t++]=s;var r=t++,a=1<<s,w=a-1,v=a+1,k=v+1,d=s+1,i=0,c=0;function B(o){for(;i>=o;)e[t++]=c&255,c>>=8,i-=8,t===r+256&&(e[r]=255,r=t++)}function m(o){c|=o<<i,i+=d,B(8)}var h=x[0]&w,_={};m(a);for(var n=1,l=x.length;n<l;++n){var g=x[n]&w,p=h<<8|g,O=_[p];if(O===void 0){for(c|=h<<i,i+=d;i>=8;)e[t++]=c&255,c>>=8,i-=8,t===r+256&&(e[r]=255,r=t++);k===4096?(m(a),k=v+1,d=s+1,_={}):(k>=1<<d&&++d,_[p]=k++),h=g}else h=O}return m(h),m(v),B(1),r+1===t?e[r]=0:(e[r]=t-r-1,e[t++]=0),t}export{M as GifWriter};
