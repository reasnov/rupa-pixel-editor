const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CH09Dg5C.js","./B78w-WDr.js","./wyFoAZCh.js","./12FXUTh6.js"])))=>i.map(i=>d[i]);
import{a as S,f as O,c as Qe,t as dt,d as yt}from"./95UOdi75.js";import{i as je}from"./sLWPApZc.js";import{o as Vt}from"./B-fWDP72.js";import{aL as cr,C as qa,h as nt,L as Qa,a as ha,aM as Xa,N as pa,G as dr,l as o,P as ur,Q as vr,R as ja,S as fa,e as aa,ab as hr,aF as pr,an as Fa,c as Nt,aN as kt,b as Aa,aO as fr,s as gr,a6 as Jt,aP as xr,aD as Ca,aQ as br,aR as mr,aI as Ia,aa as wa,aS as yr,r as Wa,p as Za,aT as ga,W as Pa,aU as _r,aV as Ar,aC as wr,d as kr,az as Er,I as Sr,E as Tr,aW as Lr,K as Cr,U as sa,i as Et,aX as Ir,aY as Pr,aZ as Qt,av as Ja,a_ as Mr,a$ as Or,b0 as Rr,b1 as Dr,b2 as jr,b3 as Fr,b4 as Gr,b5 as Br,aJ as $r,V as Nr,b6 as Ur,F as A,D as L,$ as Be,g as lt,aK as q,z as j,v as u,B as g,w as d,x as ie,A as oe,ao as Pt,y as ye,b7 as At,b8 as ka,b9 as Vr}from"./wyFoAZCh.js";import{_ as Hr,i as V,p as Le,b as It}from"./B78w-WDr.js";import{_ as w,s as zr}from"./CQs2FY2s.js";import{a as Yr,s as T,d as Fe,e as Ge}from"./RFUEos6G.js";import{B as Kr}from"./12FXUTh6.js";const qr=Symbol("NaN");function Qr(p,e,t){nt&&Qa();var a=new Kr(p),s=!cr();qa(()=>{var i=e();i!==i&&(i=qr),s&&i!==null&&typeof i=="object"&&(i={}),a.ensure(i,t)})}function Ue(p,e){return e}function Xr(p,e,t){for(var a=[],s=e.length,i,n=e.length,l=0;l<s;l++){let f=e[l];Za(f,()=>{if(i){if(i.pending.delete(f),i.done.add(f),i.pending.size===0){var x=p.outrogroups;Ea(Ca(i.done)),x.delete(i),x.size===0&&(p.outrogroups=null)}}else n-=1},!1)}if(n===0){var c=a.length===0&&t!==null;if(c){var v=t,h=v.parentNode;wr(h),h.append(v),p.items.clear()}Ea(e,!c)}else i={pending:new Set(e),done:new Set},(p.outrogroups??=new Set).add(i)}function Ea(p,e=!0){for(var t=0;t<p.length;t++)kr(p[t],e)}var Ga;function De(p,e,t,a,s,i=null){var n=p,l=new Map,c=(e&Xa)!==0;if(c){var v=p;n=nt?pa(dr(v)):v.appendChild(ha())}nt&&Qa();var h=null,f=Jt(()=>{var k=t();return xr(k)?k:k==null?[]:Ca(k)}),x,b=!0;function m(){_.fallback=h,Wr(_,x,n,e,a),h!==null&&(x.length===0?(h.f&kt)===0?Wa(h):(h.f^=kt,Zt(h,null,n)):Za(h,()=>{h=null}))}var y=qa(()=>{x=o(f);var k=x.length;let I=!1;if(nt){var F=ur(n)===vr;F!==(k===0)&&(n=ja(),pa(n),fa(!1),I=!0)}for(var B=new Set,D=Nt,U=gr(),P=0;P<k;P+=1){nt&&aa.nodeType===hr&&aa.data===pr&&(n=aa,I=!0,fa(!1));var R=x[P],z=a(R,P),Y=b?null:l.get(z);Y?(Y.v&&Fa(Y.v,R),Y.i&&Fa(Y.i,P),U&&D.unskip_effect(Y.e)):(Y=Zr(l,b?n:Ga??=ha(),R,z,P,s,e,t),b||(Y.e.f|=kt),l.set(z,Y)),B.add(z)}if(k===0&&i&&!h&&(b?h=Aa(()=>i(n)):(h=Aa(()=>i(Ga??=ha())),h.f|=kt)),k>B.size&&fr(),nt&&k>0&&pa(ja()),!b)if(U){for(const[H,K]of l)B.has(H)||D.skip_effect(K.e);D.oncommit(m),D.ondiscard(()=>{})}else m();I&&fa(!0),o(f)}),_={effect:y,items:l,outrogroups:null,fallback:h};b=!1,nt&&(n=aa)}function Xt(p){for(;p!==null&&(p.f&_r)===0;)p=p.next;return p}function Wr(p,e,t,a,s){var i=(a&Ar)!==0,n=e.length,l=p.items,c=Xt(p.effect.first),v,h=null,f,x=[],b=[],m,y,_,k;if(i)for(k=0;k<n;k+=1)m=e[k],y=s(m,k),_=l.get(y).e,(_.f&kt)===0&&(_.nodes?.a?.measure(),(f??=new Set).add(_));for(k=0;k<n;k+=1){if(m=e[k],y=s(m,k),_=l.get(y).e,p.outrogroups!==null)for(const Y of p.outrogroups)Y.pending.delete(_),Y.done.delete(_);if((_.f&kt)!==0)if(_.f^=kt,_===c)Zt(_,null,t);else{var I=h?h.next:c;_===p.effect.last&&(p.effect.last=_.prev),_.prev&&(_.prev.next=_.next),_.next&&(_.next.prev=_.prev),Lt(p,h,_),Lt(p,_,I),Zt(_,I,t),h=_,x=[],b=[],c=Xt(h.next);continue}if((_.f&ga)!==0&&(Wa(_),i&&(_.nodes?.a?.unfix(),(f??=new Set).delete(_))),_!==c){if(v!==void 0&&v.has(_)){if(x.length<b.length){var F=b[0],B;h=F.prev;var D=x[0],U=x[x.length-1];for(B=0;B<x.length;B+=1)Zt(x[B],F,t);for(B=0;B<b.length;B+=1)v.delete(b[B]);Lt(p,D.prev,U.next),Lt(p,h,D),Lt(p,U,F),c=F,h=U,k-=1,x=[],b=[]}else v.delete(_),Zt(_,c,t),Lt(p,_.prev,_.next),Lt(p,_,h===null?p.effect.first:h.next),Lt(p,h,_),h=_;continue}for(x=[],b=[];c!==null&&c!==_;)(v??=new Set).add(c),b.push(c),c=Xt(c.next);if(c===null)continue}(_.f&kt)===0&&x.push(_),h=_,c=Xt(_.next)}if(p.outrogroups!==null){for(const Y of p.outrogroups)Y.pending.size===0&&(Ea(Ca(Y.done)),p.outrogroups?.delete(Y));p.outrogroups.size===0&&(p.outrogroups=null)}if(c!==null||v!==void 0){var P=[];if(v!==void 0)for(_ of v)(_.f&ga)===0&&P.push(_);for(;c!==null;)(c.f&ga)===0&&c!==p.fallback&&P.push(c),c=Xt(c.next);var R=P.length;if(R>0){var z=(a&Xa)!==0&&n===0?t:null;if(i){for(k=0;k<R;k+=1)P[k].nodes?.a?.measure();for(k=0;k<R;k+=1)P[k].nodes?.a?.fix()}Xr(p,P,z)}}i&&Pa(()=>{if(f!==void 0)for(_ of f)_.nodes?.a?.apply()})}function Zr(p,e,t,a,s,i,n,l){var c=(n&br)!==0?(n&mr)===0?Ia(t,!1,!1):wa(t):null,v=(n&yr)!==0?wa(s):null;return{v:c,i:v,e:Aa(()=>(i(e,c??t,v??s,l),()=>{p.delete(a)}))}}function Zt(p,e,t){if(p.nodes)for(var a=p.nodes.start,s=p.nodes.end,i=e&&(e.f&kt)===0?e.nodes.start:t;a!==null;){var n=Er(a);if(i.before(a),a===s)return;a=n}}function Lt(p,e,t){e===null?p.effect.first=t:e.next=t,t===null?p.effect.last=e:t.prev=e}const Jr=()=>performance.now(),wt={tick:p=>requestAnimationFrame(p),now:()=>Jr(),tasks:new Set};function er(){const p=wt.now();wt.tasks.forEach(e=>{e.c(p)||(wt.tasks.delete(e),e.f())}),wt.tasks.size!==0&&wt.tick(er)}function es(p){let e;return wt.tasks.size===0&&wt.tick(er),{promise:new Promise(t=>{wt.tasks.add(e={c:p,f:t})}),abort(){wt.tasks.delete(e)}}}function ia(p,e){Ja(()=>{p.dispatchEvent(new CustomEvent(e))})}function ts(p){if(p==="float")return"cssFloat";if(p==="offset")return"cssOffset";if(p.startsWith("--"))return p;const e=p.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Ba(p){const e={},t=p.split(";");for(const a of t){const[s,i]=a.split(":");if(!s||i===void 0)break;const n=ts(s.trim());e[n]=i.trim()}return e}const as=p=>p;function ce(p,e,t,a){var s=(p&Mr)!==0,i=(p&Or)!==0,n=s&&i,l=(p&Ir)!==0,c=n?"both":s?"in":"out",v,h=e.inert,f=e.style.overflow,x,b;function m(){return Ja(()=>v??=t()(e,a?.()??{},{direction:c}))}var y={is_global:l,in(){if(e.inert=h,!s){b?.abort(),b?.reset?.();return}i||x?.abort(),x=Sa(e,m(),b,1,()=>{ia(e,"introend"),x?.abort(),x=v=void 0,e.style.overflow=f})},out(F){if(!i){F?.(),v=void 0;return}e.inert=!0,b=Sa(e,m(),x,0,()=>{ia(e,"outroend"),F?.()})},stop:()=>{x?.abort(),b?.abort()}},_=Sr;if((_.nodes.t??=[]).push(y),s&&Yr){var k=l;if(!k){for(var I=_.parent;I&&(I.f&Tr)!==0;)for(;(I=I.parent)&&(I.f&Lr)===0;);k=!I||(I.f&Cr)!==0}k&&sa(()=>{Et(()=>y.in())})}}function Sa(p,e,t,a,s){var i=a===1;if(Pr(e)){var n,l=!1;return Pa(()=>{if(!l){var _=e({direction:i?"in":"out"});n=Sa(p,_,t,a,s)}}),{abort:()=>{l=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return ia(p,i?"introstart":"outrostart"),s(),{abort:Qt,deactivate:Qt,reset:Qt,t:()=>a};const{delay:c=0,css:v,tick:h,easing:f=as}=e;var x=[];if(i&&t===void 0&&(h&&h(0,1),v)){var b=Ba(v(0,1));x.push(b,b)}var m=()=>1-a,y=p.animate(x,{duration:c,fill:"forwards"});return y.onfinish=()=>{y.cancel(),ia(p,i?"introstart":"outrostart");var _=t?.t()??1-a;t?.abort();var k=a-_,I=e.duration*Math.abs(k),F=[];if(I>0){var B=!1;if(v)for(var D=Math.ceil(I/16.666666666666668),U=0;U<=D;U+=1){var P=_+k*f(U/D),R=Ba(v(P,1-P));F.push(R),B||=R.overflow==="hidden"}B&&(p.style.overflow="hidden"),m=()=>{var z=y.currentTime;return _+k*f(z/I)},h&&es(()=>{if(y.playState!=="running")return!1;var z=m();return h(z,1-z),!0})}y=p.animate(F,{duration:I,fill:"forwards"}),y.onfinish=()=>{m=()=>a,h?.(a,1-a),s()}},{abort:()=>{y&&(y.cancel(),y.effect=null,y.onfinish=Qt)},deactivate:()=>{s=Qt},reset:()=>{a===0&&h?.(1,0)},t:()=>m()}}function $a(p,e,t){sa(()=>{var a=Et(()=>e(p,t?.())||{});if(a?.destroy)return()=>a.destroy()})}function tr(p){var e,t,a="";if(typeof p=="string"||typeof p=="number")a+=p;else if(typeof p=="object")if(Array.isArray(p)){var s=p.length;for(e=0;e<s;e++)p[e]&&(t=tr(p[e]))&&(a&&(a+=" "),a+=t)}else for(t in p)p[t]&&(a&&(a+=" "),a+=t);return a}function rs(){for(var p,e,t=0,a="",s=arguments.length;t<s;t++)(p=arguments[t])&&(e=tr(p))&&(a&&(a+=" "),a+=e);return a}function ss(p){return typeof p=="object"?rs(p):p??""}const Na=[...` 	
\r\f \v\uFEFF`];function is(p,e,t){var a=p==null?"":""+p;if(e&&(a=a?a+" "+e:e),t){for(var s in t)if(t[s])a=a?a+" "+s:s;else if(a.length)for(var i=s.length,n=0;(n=a.indexOf(s,n))>=0;){var l=n+i;(n===0||Na.includes(a[n-1]))&&(l===a.length||Na.includes(a[l]))?a=(n===0?"":a.substring(0,n))+a.substring(l+1):n=l}}return a===""?null:a}function os(p,e){return p==null?null:String(p)}function re(p,e,t,a,s,i){var n=p.__className;if(nt||n!==t||n===void 0){var l=is(t,a,i);(!nt||l!==p.getAttribute("class"))&&(l==null?p.removeAttribute("class"):e?p.className=l:p.setAttribute("class",l)),p.__className=t}else if(i&&s!==i)for(var c in i){var v=!!i[c];(s==null||v!==!!s[c])&&p.classList.toggle(c,v)}return i}function fe(p,e,t,a){var s=p.__style;if(nt||s!==e){var i=os(e);(!nt||i!==p.getAttribute("style"))&&(i==null?p.removeAttribute("style"):p.style.cssText=i),p.__style=e}return a}const ns=Symbol("is custom element"),ls=Symbol("is html");function Ne(p){if(nt){var e=!1,t=()=>{if(!e){if(e=!0,p.hasAttribute("value")){var a=p.value;M(p,"value",null),p.value=a}if(p.hasAttribute("checked")){var s=p.checked;M(p,"checked",null),p.checked=s}}};p.__on_r=t,Pa(t),Gr()}}function cs(p,e){var t=ar(p);t.value===(t.value=e??void 0)||p.value===e&&(e!==0||p.nodeName!=="PROGRESS")||(p.value=e??"")}function M(p,e,t,a){var s=ar(p);nt&&(s[e]=p.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&p.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(p[Rr]=t),t==null?p.removeAttribute(e):typeof t!="string"&&ds(p).includes(e)?p[e]=t:p.setAttribute(e,t))}function ar(p){return p.__attributes??={[ns]:p.nodeName.includes("-"),[ls]:p.namespaceURI===Dr}}var Ua=new Map;function ds(p){var e=p.getAttribute("is")||p.nodeName,t=Ua.get(e);if(t)return t;Ua.set(e,t=[]);for(var a,s=p,i=Element.prototype;i!==s;){a=Fr(s);for(var n in a)a[n].set&&t.push(n);s=jr(s)}return t}function Ve(p,e,t=e){var a=new WeakSet;Br(p,"input",async s=>{var i=s?p.defaultValue:p.value;if(i=xa(p)?ba(i):i,t(i),Nt!==null&&a.add(Nt),await $r(),i!==(i=e())){var n=p.selectionStart,l=p.selectionEnd,c=p.value.length;if(p.value=i??"",l!==null){var v=p.value.length;n===l&&l===c&&v>c?(p.selectionStart=v,p.selectionEnd=v):(p.selectionStart=n,p.selectionEnd=Math.min(l,v))}}}),(nt&&p.defaultValue!==p.value||Et(e)==null&&p.value)&&(t(xa(p)?ba(p.value):p.value),Nt!==null&&a.add(Nt)),Nr(()=>{var s=e();if(p===document.activeElement){var i=Ur??Nt;if(a.has(i))return}xa(p)&&s===ba(p.value)||p.type==="date"&&!s&&!p.value||s!==p.value&&(p.value=s??"")})}function xa(p){var e=p.type;return e==="number"||e==="range"}function ba(p){return p===""?null:+p}function na(p){var e=wa(0);return function(){return arguments.length===1?(A(e,o(e)+1),arguments[0]):(o(e),p())}}class us{project;#e=L(0);get renderPulse(){return o(this.#e)}set renderPulse(e){A(this.#e,e,!0)}triggerPulse(){this.renderPulse++}#t=L(Be([]));get pixelBuffer(){return o(this.#t)}set pixelBuffer(e){A(this.#t,e,!0)}#a=L(Be([]));get strokePoints(){return o(this.#a)}set strokePoints(e){A(this.#a,e,!0)}internalBuffer=new Set;constructor(e){this.project=e}mount(){lt(()=>{this.compositePixels,this.project.activeFrameIndex,this.project.activeFrame.activeLayerIndex,this.triggerPulse()})}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get pixels(){return this.project.activeFrame.activeLayer.pixels}get compositePixels(){return this.project.activeFrame.compositePixels}set pixels(e){this.project.activeFrame.activeLayer.pixels=e}clearBuffer(){this.internalBuffer.clear(),this.pixelBuffer=[],this.strokePoints=[]}addBatchToBuffer(e){const t=[...this.strokePoints];e.forEach(a=>{const s=Math.floor(a.x),i=Math.floor(a.y);this.isValidCoord(s,i)&&(this.internalBuffer.add(this.getIndex(s,i)),t.push({x:a.x,y:a.y}))}),this.strokePoints=t,this.pixelBuffer=Array.from(this.internalBuffer)}addToBuffer(e,t){this.addBatchToBuffer([{x:e,y:t}])}reset(e,t,a){this.width=e,this.height=t,this.pixels=a,this.triggerPulse()}clear(){this.project.activeFrame.activeLayer.clear(),this.triggerPulse()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.compositePixels[this.getIndex(e,t)]}setColor(e,t,a){this.pixels[this.getIndex(e,t)]=a}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}#r=q(()=>`calc((100cqi - 20px) * ${this.width} / (${this.width} + 2))`);get fitWidth(){return o(this.#r)}set fitWidth(e){A(this.#r,e)}#s=q(()=>`calc((100cqb - 20px) * ${this.height} / (${this.height} + 2))`);get fitHeight(){return o(this.#s)}set fitHeight(e){A(this.#s,e)}getFitDimension(e){const t=this.width,a=this.height;return e==="horizontal"?`min(${this.fitWidth}, calc(${this.fitHeight} * (${t} / ${a})))`:`min(${this.fitHeight}, calc(${this.fitWidth} * (${a} / ${t})))`}}class vs{#e=L(Be({x:0,y:0}));get pos(){return o(this.#e)}set pos(e){A(this.#e,e,!0)}#t=L(!0);get isVisible(){return o(this.#t)}set isVisible(e){A(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}const hs=["#2d3319","#4b5d16","#859900","#a2ad59","#eee8d5","#fdf6e3","#93a1a1","#586e75","#073642","#002b36"],ps=["#002b36","#073642","#586e75","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#2aa198","#859900"],ma={default:["#333333","#999999","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"],botanical:hs,sunset:ps};class fs{#e=L(Be(ma.default[0]));get activeColor(){return o(this.#e)}set activeColor(e){A(this.#e,e,!0)}#t=L(Be(ma.default));get swatches(){return o(this.#t)}set swatches(e){A(this.#t,e,!0)}select(e){e>=0&&e<this.swatches.length&&(this.activeColor=this.swatches[e])}setColor(e){this.activeColor=e}loadPalette(e){this.swatches=ma[e],this.activeColor=this.swatches[0]}}const gs=["showColorPicker","showAudioSettings","showCommandPalette","showGuideMenu","showGuideBook","showExportMenu","showCanvasSettings","showPersistenceMenu","showUnderlayMenu","showGoTo"],xs={managed:gs};class bs{#e=L(1);get zoomLevel(){return o(this.#e)}set zoomLevel(e){A(this.#e,e,!0)}#t=L(!1);get isMuted(){return o(this.#t)}set isMuted(e){A(this.#t,e,!0)}#a=L(!0);get isAmbientPlaying(){return o(this.#a)}set isAmbientPlaying(e){A(this.#a,e,!0)}#r=L(!1);get isAppReady(){return o(this.#r)}set isAppReady(e){A(this.#r,e,!0)}#s=L(!1);get isPicking(){return o(this.#s)}set isPicking(e){A(this.#s,e,!0)}#i=L(1);get brushSize(){return o(this.#i)}set brushSize(e){A(this.#i,e,!0)}#o=L("SQUARE");get brushShape(){return o(this.#o)}set brushShape(e){A(this.#o,e,!0)}#n=L("OFF");get symmetryMode(){return o(this.#n)}set symmetryMode(e){A(this.#n,e,!0)}#l=L(!1);get isTilingEnabled(){return o(this.#l)}set isTilingEnabled(e){A(this.#l,e,!0)}#c=L(!1);get isAlphaLocked(){return o(this.#c)}set isAlphaLocked(e){A(this.#c,e,!0)}#d=L(!1);get isColorLocked(){return o(this.#d)}set isColorLocked(e){A(this.#d,e,!0)}#u=L(!1);get isPixelPerfect(){return o(this.#u)}set isPixelPerfect(e){A(this.#u,e,!0)}#v=L(null);get colorLockSource(){return o(this.#v)}set colorLockSource(e){A(this.#v,e,!0)}#h=L(!1);get isAirbrushActive(){return o(this.#h)}set isAirbrushActive(e){A(this.#h,e,!0)}#p=L(.2);get airbrushDensity(){return o(this.#p)}set airbrushDensity(e){A(this.#p,e,!0)}#f=L("BRUSH");get activeTool(){return o(this.#f)}set activeTool(e){A(this.#f,e,!0)}#g=L(null);get shapeAnchor(){return o(this.#g)}set shapeAnchor(e){A(this.#g,e,!0)}#x=L(3);get polygonSides(){return o(this.#x)}set polygonSides(e){A(this.#x,e,!0)}#b=L(0);get polygonIndentation(){return o(this.#b)}set polygonIndentation(e){A(this.#b,e,!0)}#m=L(null);get gradientStartColor(){return o(this.#m)}set gradientStartColor(e){A(this.#m,e,!0)}#y=L(null);get gradientEndColor(){return o(this.#y)}set gradientEndColor(e){A(this.#y,e,!0)}#_=L(50);get stabilization(){return o(this.#_)}set stabilization(e){A(this.#_,e,!0)}#A=L(.5);get bgmVolume(){return o(this.#A)}set bgmVolume(e){A(this.#A,e,!0)}#w=L(.5);get sfxVolume(){return o(this.#w)}set sfxVolume(e){A(this.#w,e,!0)}#k=L(10);get fps(){return o(this.#k)}set fps(e){A(this.#k,e,!0)}#E=L(!1);get isKineticMode(){return o(this.#E)}set isKineticMode(e){A(this.#E,e,!0)}#S=L(!1);get showGhostLayers(){return o(this.#S)}set showGhostLayers(e){A(this.#S,e,!0)}#T=L(1);get timelineZoom(){return o(this.#T)}set timelineZoom(e){A(this.#T,e,!0)}sessionStartTime=Date.now();#L=L(0);get usageMinutes(){return o(this.#L)}set usageMinutes(e){A(this.#L,e,!0)}#C=L(0);get usageSeconds(){return o(this.#C)}set usageSeconds(e){A(this.#C,e,!0)}#I=q(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),a=Math.floor(e%3600/60),s=e%60;return`${t>0?t+":":""}${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`});get sessionTimeLabel(){return o(this.#I)}set sessionTimeLabel(e){A(this.#I,e)}#P=L(!1);get showColorPicker(){return o(this.#P)}set showColorPicker(e){A(this.#P,e,!0)}#M=L(!1);get showAudioSettings(){return o(this.#M)}set showAudioSettings(e){A(this.#M,e,!0)}#O=L(!1);get showCommandPalette(){return o(this.#O)}set showCommandPalette(e){A(this.#O,e,!0)}#R=L(!1);get showGuideMenu(){return o(this.#R)}set showGuideMenu(e){A(this.#R,e,!0)}#D=L(!1);get showGuideBook(){return o(this.#D)}set showGuideBook(e){A(this.#D,e,!0)}#j=L(!1);get showExportMenu(){return o(this.#j)}set showExportMenu(e){A(this.#j,e,!0)}#F=L(!1);get showCanvasSettings(){return o(this.#F)}set showCanvasSettings(e){A(this.#F,e,!0)}#G=L(!1);get showPersistenceMenu(){return o(this.#G)}set showPersistenceMenu(e){A(this.#G,e,!0)}#B=L(!1);get showUnderlayMenu(){return o(this.#B)}set showUnderlayMenu(e){A(this.#B,e,!0)}#$=L(!1);get showGoTo(){return o(this.#$)}set showGoTo(e){A(this.#$,e,!0)}#N=L(!0);get showMinimap(){return o(this.#N)}set showMinimap(e){A(this.#N,e,!0)}#U=L(null);get underlayImage(){return o(this.#U)}set underlayImage(e){A(this.#U,e,!0)}#V=L(!0);get isUnderlayVisible(){return o(this.#V)}set isUnderlayVisible(e){A(this.#V,e,!0)}#H=L(.2);get underlayOpacity(){return o(this.#H)}set underlayOpacity(e){A(this.#H,e,!0)}#z=L(Be({x:0,y:0}));get underlayOffset(){return o(this.#z)}set underlayOffset(e){A(this.#z,e,!0)}#Y=L(1);get underlayScale(){return o(this.#Y)}set underlayScale(e){A(this.#Y,e,!0)}#K=L(Be({x:0,y:0}));get panOffset(){return o(this.#K)}set panOffset(e){A(this.#K,e,!0)}#q=L(!1);get isHandToolActive(){return o(this.#q)}set isHandToolActive(e){A(this.#q,e,!0)}#Q=L(!1);get isTransforming(){return o(this.#Q)}set isTransforming(e){A(this.#Q,e,!0)}#X=L(!1);get isShadingLighten(){return o(this.#X)}set isShadingLighten(e){A(this.#X,e,!0)}#W=L(!1);get isShadingDarken(){return o(this.#W)}set isShadingDarken(e){A(this.#W,e,!0)}#Z=L(!1);get isShadingDither(){return o(this.#Z)}set isShadingDither(e){A(this.#Z,e,!0)}#J=L(!1);get isPatternBrushActive(){return o(this.#J)}set isPatternBrushActive(e){A(this.#J,e,!0)}#ee=L(null);get patternBrushData(){return o(this.#ee)}set patternBrushData(e){A(this.#ee,e,!0)}#te=L("layers");get projectActiveTab(){return o(this.#te)}set projectActiveTab(e){A(this.#te,e,!0)}#ae=L("");get toastMessage(){return o(this.#ae)}set toastMessage(e){A(this.#ae,e,!0)}#re=L(!1);get showToast(){return o(this.#re)}set showToast(e){A(this.#re,e,!0)}toastTimer=null;#se=L(null);get contextMenu(){return o(this.#se)}set contextMenu(e){A(this.#se,e,!0)}show(e){this.toastMessage=e,this.showToast=!0,this.toastTimer&&clearTimeout(this.toastTimer),this.toastTimer=setTimeout(()=>{this.showToast=!1},2e3)}#ie=L("#eee8d5");get backgroundColor(){return o(this.#ie)}set backgroundColor(e){A(this.#ie,e,!0)}#oe=L(10);get exportScale(){return o(this.#oe)}set exportScale(e){A(this.#oe,e,!0)}#ne=L("transparent");get exportBgColor(){return o(this.#ne)}set exportBgColor(e){A(this.#ne,e,!0)}#le=L(!1);get includePixelBorders(){return o(this.#le)}set includePixelBorders(e){A(this.#le,e,!0)}escapeStack=[];#ce=L(Be([]));get _overlayStack(){return o(this.#ce)}set _overlayStack(e){A(this.#ce,e,!0)}_managedOverlays=xs.managed;constructor(){setInterval(()=>{const e=Date.now()-this.sessionStartTime;this.usageMinutes=Math.floor(e/6e4),this.usageSeconds=Math.floor(e/1e3)},1e3)}mount(){lt(()=>{for(const e of this._managedOverlays)this[e]?Et(()=>this._overlayStack.includes(e))||(this._overlayStack=[...Et(()=>this._overlayStack),e]):Et(()=>this._overlayStack.includes(e))&&(this._overlayStack=Et(()=>this._overlayStack.filter(a=>a!==e)))})}setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.1,Math.min(10,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}resetPan(){this.panOffset={x:0,y:0}}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();if(e)return e(),!0;const t=this._overlayStack[this._overlayStack.length-1];return t?(this[t]=!1,!0):!1}}class Ut{id=crypto.randomUUID();#e=L("New Layer");get name(){return o(this.#e)}set name(e){A(this.#e,e,!0)}#t=L(!0);get isVisible(){return o(this.#t)}set isVisible(e){A(this.#t,e,!0)}#a=L(!1);get isLocked(){return o(this.#a)}set isLocked(e){A(this.#a,e,!0)}#r=L(1);get opacity(){return o(this.#r)}set opacity(e){A(this.#r,e,!0)}#s=L("LAYER");get type(){return o(this.#s)}set type(e){A(this.#s,e,!0)}#i=L(null);get parentId(){return o(this.#i)}set parentId(e){A(this.#i,e,!0)}#o=L(!1);get isCollapsed(){return o(this.#o)}set isCollapsed(e){A(this.#o,e,!0)}#n=L(new Uint32Array(0));get pixels(){return o(this.#n)}set pixels(e){A(this.#n,e)}constructor(e,t,a,s="LAYER"){this.name=e,this.type=s,s==="LAYER"&&(this.pixels=new Uint32Array(t*a))}clone(e,t){const a=new Ut(this.name,e,t,this.type);return a.pixels=this.type==="LAYER"?new Uint32Array(this.pixels):new Uint32Array(0),a.isVisible=this.isVisible,a.isLocked=this.isLocked,a.opacity=this.opacity,a.parentId=this.parentId,a.isCollapsed=this.isCollapsed,a}clear(){const e=new Uint32Array(this.pixels.length);e.fill(0),this.pixels=e}hasPixel(e){return this.pixels[e]!==0}}class oa{id=crypto.randomUUID();#e=L("Untitled Frame");get name(){return o(this.#e)}set name(e){A(this.#e,e,!0)}#t=L(32);get width(){return o(this.#t)}set width(e){A(this.#t,e,!0)}#a=L(32);get height(){return o(this.#a)}set height(e){A(this.#a,e,!0)}#r=L(100);get duration(){return o(this.#r)}set duration(e){A(this.#r,e,!0)}#s=L(1);get opacity(){return o(this.#s)}set opacity(e){A(this.#s,e,!0)}#i=L(Be([]));get layers(){return o(this.#i)}set layers(e){A(this.#i,e,!0)}#o=L(0);get activeLayerIndex(){return o(this.#o)}set activeLayerIndex(e){A(this.#o,e,!0)}#n=L(Be(new Set([0])));get selectedLayerIndices(){return o(this.#n)}set selectedLayerIndices(e){A(this.#n,e,!0)}constructor(e,t=32,a=32){this.name=e,this.width=t,this.height=a,this.layers=[new Ut("Base Layer",t,a)]}get activeLayer(){return this.layers[this.activeLayerIndex]}addLayer(e){const t=e||`Layer ${this.layers.length+1}`,a=new Ut(t,this.width,this.height),s=this.activeLayer;return s.type==="FOLDER"?a.parentId=s.id:s.parentId&&(a.parentId=s.parentId),this.layers.push(a),this.activeLayerIndex=this.layers.length-1,a}addGroup(e){const t=e||`Group ${this.layers.length+1}`,a=new Ut(t,this.width,this.height,"FOLDER");return this.layers.push(a),this.activeLayerIndex=this.layers.length-1,a}removeLayer(e){if(this.layers.length<=1)return;const t=this.layers[e];t.type==="FOLDER"&&this.layers.forEach(a=>{a.parentId===t.id&&(a.parentId=null)}),this.layers.splice(e,1),this.activeLayerIndex>=this.layers.length&&(this.activeLayerIndex=this.layers.length-1)}#l=q(()=>{const e=new Uint32Array(this.width*this.height),t=new Map;this.layers.forEach(a=>{a.type==="FOLDER"&&t.set(a.id,a.isVisible)});for(const a of this.layers){if(a.type==="FOLDER"||!a.isVisible||a.parentId&&t.get(a.parentId)===!1)continue;const s=a.pixels;for(let i=0;i<e.length;i++){const n=s[i];n!==0&&(e[i]=n)}}return e});get compositePixels(){return o(this.#l)}set compositePixels(e){A(this.#l,e)}}class ms{#e=L(null);get currentFilePath(){return o(this.#e)}set currentFilePath(e){A(this.#e,e,!0)}#t=L(null);get lastSaved(){return o(this.#t)}set lastSaved(e){A(this.#t,e,!0)}#a=L(Be([]));get frames(){return o(this.#a)}set frames(e){A(this.#a,e,!0)}#r=L(0);get activeFrameIndex(){return o(this.#r)}set activeFrameIndex(e){A(this.#r,e,!0)}#s=L(Be(new Set([0])));get selectedFrameIndices(){return o(this.#s)}set selectedFrameIndices(e){A(this.#s,e,!0)}#i=L(!1);get isPlaying(){return o(this.#i)}set isPlaying(e){A(this.#i,e,!0)}#o=L(null);get clipboard(){return o(this.#o)}set clipboard(e){A(this.#o,e,!0)}constructor(){this.frames=[new oa("Main Art")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,a=new oa(t);return this.frames.push(a),this.activeFrameIndex=this.frames.length-1,a}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e=null){this.currentFilePath=e,this.lastSaved=new Date}}class ys{#e=L(null);get start(){return o(this.#e)}set start(e){A(this.#e,e,!0)}#t=L(null);get end(){return o(this.#t)}set end(e){A(this.#t,e,!0)}#a=L(Be([]));get indices(){return o(this.#a)}set indices(e){A(this.#a,e,!0)}#r=L(Be([]));get vertices(){return o(this.#r)}set vertices(e){A(this.#r,e,!0)}#s=q(()=>{const e=new Set,t=r.canvas.width;this.indices.forEach(s=>e.add(s));const a=this.rectangularBounds;if(a)for(let s=a.y1;s<=a.y2;s++)for(let i=a.x1;i<=a.x2;i++)e.add(s*t+i);return e});get activeIndicesSet(){return o(this.#s)}set activeIndicesSet(e){A(this.#s,e)}get isActive(){return this.indices.length>0||this.start!==null||this.vertices.length>0}begin(e,t){this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.indices=[],this.vertices=[]}getPoints(e){const t=new Map;this.indices.forEach(s=>{t.set(s,{x:s%e,y:Math.floor(s/e)})});const a=this.rectangularBounds;if(a)for(let s=a.y1;s<=a.y2;s++)for(let i=a.x1;i<=a.x2;i++){const n=s*e+i;t.set(n,{x:i,y:s})}return Array.from(t.values())}getBoundaryEdges(e){const t=[],a=this.getPoints(e);if(a.length===0)return t;const s=new Set(a.map(i=>`${i.x},${i.y}`));return a.forEach(i=>{s.has(`${i.x},${i.y-1}`)||t.push({x1:i.x,y1:i.y,x2:i.x+1,y2:i.y}),s.has(`${i.x},${i.y+1}`)||t.push({x1:i.x,y1:i.y+1,x2:i.x+1,y2:i.y+1}),s.has(`${i.x-1},${i.y}`)||t.push({x1:i.x,y1:i.y,x2:i.x,y2:i.y+1}),s.has(`${i.x+1},${i.y}`)||t.push({x1:i.x+1,y1:i.y,x2:i.x+1,y2:i.y+1})}),t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){const t=this.getPoints(e);if(t.length===0)return null;let a=1/0,s=-1/0,i=1/0,n=-1/0;return t.forEach(l=>{l.x<a&&(a=l.x),l.x>s&&(s=l.x),l.y<i&&(i=l.y),l.y>n&&(n=l.y)}),{x1:a,x2:s,y1:i,y2:n,width:s-a+1,height:n-i+1}}}class _s{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){!("isStructural"in e)&&!Array.isArray(e)&&e.oldColor===e.newColor||(this.currentBatch&&!("isStructural"in e)&&!Array.isArray(e)?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const de=new _s;class As{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const Ma=new As,ws={"c-major":[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25]},ks={move:{freq:450,duration:.08,volume:.15},draw:{freq:1200,duration:.15,volume:.03},startup:{freq:220,duration:.8,volume:.1},ready:[523.25,659.25,783.99,1046.5]},Es={scale:[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25],chords:[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]],fade:{startMins:30,fullMins:60}},Ct={scales:ws,tones:ks,ambient:Es};class Ss{get ctx(){return Ma.ctx}playTone(e,t,a="sine",s=.1,i=1e-4){if(r.isMuted)return;const n=this.ctx.createOscillator(),l=this.ctx.createGain();n.type=a,n.frequency.setValueAtTime(e,this.ctx.currentTime);const c=s*r.sfxVolume;l.gain.setValueAtTime(c,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(i,this.ctx.currentTime+t),n.connect(l),l.connect(this.ctx.destination),n.start(),n.stop(this.ctx.currentTime+t)}playMove(){const{freq:e,duration:t,volume:a}=Ct.tones.move;this.playTone(e,t,"sine",a)}playDraw(){const{freq:e,duration:t,volume:a}=Ct.tones.draw;this.playTone(e,t,"sine",a),setTimeout(()=>this.playTone(e*1.25,t*.6,"sine",a*.6),50)}playScale(e){const t=Ct.scales["c-major"],a=t[e%t.length];this.playTone(a,.15,"sine",.12)}playErase(){if(r.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,a=this.ctx.createBuffer(1,t,this.ctx.sampleRate),s=a.getChannelData(0);for(let v=0;v<t;v++)s[v]=Math.random()*2-1;const i=this.ctx.createBufferSource();i.buffer=a;const n=this.ctx.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(1500,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const l=this.ctx.createGain(),c=.1*r.sfxVolume;l.gain.setValueAtTime(c,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),i.connect(n),n.connect(l),l.connect(this.ctx.destination),i.start()}playStartup(){const{freq:e,duration:t,volume:a}=Ct.tones.startup;this.playTone(e,t,"sine",a),this.playTone(e/2,t*1.5,"sine",a/2)}playReady(){Ct.tones.ready.forEach((t,a)=>{setTimeout(()=>this.playTone(t,.4,"sine",.05),a*100)})}}const ee=new Ss;class Ze{static getLinePoints(e,t,a,s,i=0){e=Math.floor(e),t=Math.floor(t),a=Math.floor(a),s=Math.floor(s);const n=[],l=Math.abs(a-e),c=Math.abs(s-t),v=e<a?1:-1,h=t<s?1:-1;let f=l-c;for(;;){n.push({x:e,y:t});const x=l===c,b=l===0||c===0;if(i>.9&&!x&&!b&&(l>c?n.push({x:e,y:t+h}):n.push({x:e+v,y:t})),e===a&&t===s)break;const m=2*f;m>-c&&(f-=c,e+=v),m<l&&(f+=l,t+=h)}return n}static getCirclePoints(e,t,a){e=Math.floor(e),t=Math.floor(t),a=Math.round(a);const s=[];let i=a,n=0,l=0;for(;i>=n;)[{x:e+i,y:t+n},{x:e+n,y:t+i},{x:e-n,y:t+i},{x:e-i,y:t+n},{x:e-i,y:t-n},{x:e-n,y:t-i},{x:e+n,y:t-i},{x:e+i,y:t-n}].forEach(v=>s.push(v)),l<=0&&(n+=1,l+=2*n+1),l>0&&(i-=1,l-=2*i+1);return s}static fitArc(e,t){if(e.length<10)return null;let a=0,s=0;e.forEach(P=>{a+=P.x,s+=P.y});const i=a/e.length,n=s/e.length;let l=0;const c=e.map(P=>{const R=Math.sqrt((P.x-i)**2+(P.y-n)**2);return l+=R,R}),v=l/e.length;let h=0;if(c.forEach(P=>{h+=(P-v)**2}),Math.sqrt(h/e.length)/(v||1)>t)return null;const b=e[0],m=e[e.length-1],_=Math.sqrt((b.x-m.x)**2+(b.y-m.y)**2)<v*1.5||e.length>v*Math.PI*1.5,k=[],I=Math.atan2(e[0].y-n,e[0].x-i),F=Math.atan2(e[e.length-1].y-n,e[e.length-1].x-i),B=Math.max(32,Math.floor(v*10));let D=F-I;for(;D>Math.PI;)D-=Math.PI*2;for(;D<-Math.PI;)D+=Math.PI*2;const U=_?Math.PI*2:D;for(let P=0;P<=B;P++){const R=I+U*(P/B);k.push({x:i+Math.cos(R)*v,y:n+Math.sin(R)*v})}return{cx:i,cy:n,r:v,isFull:_,points:k}}static perpendicularDistance(e,t,a){const s=a.x-t.x,i=a.y-t.y;return s===0&&i===0?Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2):Math.abs(i*e.x-s*e.y+a.x*t.y-a.y*t.x)/Math.sqrt(s*s+i*i)}static toCartesianLabel(e,t,a=!1){const s=Math.floor(t/2),i=t%2===0?e<s?e-s:e-s+1:e-s;return a?-i:i}static getGuidePosition(e,t){return 50+e/t*100}static mapScreenToGrid(e,t,a,s,i){const n=(e-a.left)/a.width,l=(t-a.top)/a.height;return{x:n*s,y:l*i}}static calculateCameraTransform(e,t,a,s,i){const{x:n,y:l}=t;if(e<=1)return`translate(calc(-50% + ${n}px), calc(-50% + ${l}px)) scale(${e})`;const c=(a.x+.5)/s*100,v=(a.y+.5)/i*100;return`translate(calc(-${c}% + ${n}px), calc(-${v}% + ${l}px)) scale(${e})`}static calculatePanDelta(e,t,a,s){return{dx:e-a,dy:t-s}}}class ot{static getSymmetryPoints(e,t,a,s,i){const n=[],l=a-1-e,c=s-1-t;return i==="HORIZONTAL"?n.push({x:l,y:t}):i==="VERTICAL"?n.push({x:e,y:c}):i==="QUADRANT"&&(n.push({x:l,y:t}),n.push({x:e,y:c}),n.push({x:l,y:c})),n}static wrap(e,t,a,s){return{x:(e%a+a)%a,y:(t%s+s)%s}}static floodFill(e,t,a,s,i,n){const l=e[i*t+s];if(l===n)return e;const c=[...e],v=[[s,i]];for(;v.length>0;){let[h,f]=v.pop(),x=h;for(;x>0&&c[f*t+(x-1)]===l;)c[f*t+(x-1)]=n,x--;for(;h<t&&c[f*t+h]===l;)c[f*t+h]=n,h++;this.scan(x,h-1,f-1,t,a,c,l,v),this.scan(x,h-1,f+1,t,a,c,l,v)}return c}static scan(e,t,a,s,i,n,l,c){if(a<0||a>=i)return;let v=!1;for(let h=e;h<=t;h++)n[a*s+h]===l?v||(c.push([h,a]),v=!0):v=!1}static recolor(e,t,a){return e.map(s=>s===t?a:s)}static getPaletteUsage(e){const t=new Set;return e.forEach(a=>{a&&t.add(a)}),t}static pixelPerfectFilter(e){if(e.length<3)return e;const t=[e[0]];for(let a=1;a<e.length;a++){const s=e[a],i=t[t.length-1];if(!(s.x===i.x&&s.y===i.y)){if(t.length>=2){const n=t[t.length-2],l=Math.abs(s.x-n.x),c=Math.abs(s.y-n.y);l<=1&&c<=1&&t.pop()}t.push(s)}}return t}static getRectanglePoints(e,t,a,s){const i=[],n=Math.min(e,a),l=Math.max(e,a),c=Math.min(t,s),v=Math.max(t,s);for(let h=n;h<=l;h++)i.push({x:h,y:c}),i.push({x:h,y:v});for(let h=c+1;h<v;h++)i.push({x:n,y:h}),i.push({x:l,y:h});return i}static getEllipsePoints(e,t,a,s){const i=(e+a)/2,n=(t+s)/2,l=Math.abs(a-e)/2,c=Math.abs(s-t)/2;if(l===0||c===0)return[];const v=[];let h=0,f=c,x=c*c-l*l*c+.25*l*l,b=2*c*c*h,m=2*l*l*f;for(;b<m;)this.addEllipsePoints(v,i,n,h,f),x<0?(h++,b=b+2*c*c,x=x+b+c*c):(h++,f--,b=b+2*c*c,m=m-2*l*l,x=x+b-m+c*c);let y=c*c*((h+.5)*(h+.5))+l*l*((f-1)*(f-1))-l*l*c*c;for(;f>=0;)this.addEllipsePoints(v,i,n,h,f),y>0?(f--,m=m-2*l*l,y=y+l*l-m):(f--,h++,b=b+2*c*c,m=m-2*l*l,y=y+b-m+l*l);return v}static addEllipsePoints(e,t,a,s,i){e.push({x:Math.round(t+s),y:Math.round(a+i)}),e.push({x:Math.round(t-s),y:Math.round(a+i)}),e.push({x:Math.round(t+s),y:Math.round(a-i)}),e.push({x:Math.round(t-s),y:Math.round(a-i)})}static getPolygonPoints(e,t,a,s,i,n=0){const l=(e+a)/2,c=(t+s)/2,v=Math.abs(a-e)/2,h=Math.abs(s-t)/2,f=Math.max(v,h);if(f===0)return[];const x=[],b=-Math.PI/2;if(n>0){const y=f*(1-n/100);for(let _=0;_<i*2;_++){const k=b+_*Math.PI/i,I=_%2===0?f:y;x.push({x:Math.round(l+Math.cos(k)*I),y:Math.round(c+Math.sin(k)*I)})}}else for(let y=0;y<i;y++){const _=b+y*2*Math.PI/i;x.push({x:Math.round(l+Math.cos(_)*f),y:Math.round(c+Math.sin(_)*f)})}const m=[];for(let y=0;y<x.length;y++){const _=x[y],k=x[(y+1)%x.length];m.push(...Ze.getLinePoints(_.x,_.y,k.x,k.y))}return m}static getLinearGradientMap(e,t,a,s,i,n){const l=[],c=a-e,v=s-t,h=c*c+v*v;return h===0?i.map(f=>({index:f,ratio:0})):(i.forEach(f=>{const x=f%n,b=Math.floor(f/n),m=((x-e)*c+(b-t)*v)/h,y=Math.max(0,Math.min(1,m));l.push({index:f,ratio:y})}),l)}}class Ts{move(e,t){let a=r.cursor.pos.x+e,s=r.cursor.pos.y+t;if(r.studio.isTilingEnabled){const i=ot.wrap(a,s,r.canvas.width,r.canvas.height);a=i.x,s=i.y}else a=Math.max(0,Math.min(r.canvas.width-1,a)),s=Math.max(0,Math.min(r.canvas.height-1,s));return a!==r.cursor.pos.x||s!==r.cursor.pos.y?(r.cursor.setPos(a,s),ee.playMove(),!0):!1}internalToCartesian(e,t,a,s){const i=(n,l)=>{const c=Math.floor(l/2);return l%2===0?n<c?n-c:n-c+1:n-c};return{x:i(e,a),y:-i(t,s)}}cartesianToInternal(e,t,a,s){const i=Math.floor(a/2),n=Math.floor(s/2);let l,c;a%2===0?l=e<0?e+i:e+i-1:l=e+i;const v=-t;return s%2===0?c=v<0?v+n:v+n-1:c=v+n,{x:Math.max(0,Math.min(a-1,l)),y:Math.max(0,Math.min(s-1,c))}}jumpTo(e,t){const{x:a,y:s}=this.cartesianToInternal(e,t,r.canvas.width,r.canvas.height);r.cursor.setPos(a,s)}jumpHome(){this.jumpTo(1,1),ee.playMove()}}class ya{static getKernel(e,t){if(e<=1)return[{x:0,y:0}];const a=[],s=(e-1)/2,i=-Math.floor(s),n=Math.ceil(s);for(let l=i;l<=n;l++)for(let c=i;c<=n;c++)t==="SQUARE"?a.push({x:c,y:l}):Math.sqrt(c*c+l*l)<=s+.1&&a.push({x:c,y:l});return a}static getSpans(e,t){if(e<=1)return[{y:0,x1:0,x2:0}];const a=[],s=(e-1)/2,i=-Math.floor(s),n=Math.ceil(s);for(let l=i;l<=n;l++)if(t==="SQUARE")a.push({y:l,x1:i,x2:n});else{const c=Math.sqrt(s*s-l*l),v=Math.floor(c);isNaN(v)||a.push({y:l,x1:-v,x2:v})}return a}}class Va{static simplify(e,t){if(e.length<=2||t<=0)return e;let a=0,s=0;const i=e[0],n=e[e.length-1];for(let l=1;l<e.length-1;l++){const c=Ze.perpendicularDistance(e[l],i,n);c>a&&(s=l,a=c)}if(a>t){const l=this.simplify(e.slice(0,s+1),t),c=this.simplify(e.slice(s),t);return[...l.slice(0,-1),...c]}else return[i,n]}static smooth(e,t){if(e.length<=2||t<=0)return e;const a=[...e],s=Math.floor(t/10)+1;for(let i=1;i<e.length-1;i++){let n=0,l=0,c=0;for(let v=i-s;v<=i+s;v++)v>=0&&v<e.length&&(n+=e[v].x,l+=e[v].y,c++);a[i]={x:n/c,y:l/c}}return a}static traceCluster(e,t){const a=new Set;for(const i of e){const n=i%t,l=Math.floor(i/t);[{x:n,y:l-1,id:"top"},{x:n+1,y:l,id:"right"},{x:n,y:l+1,id:"bottom"},{x:n-1,y:l,id:"left"}].forEach(v=>{const h=v.y*t+v.x;if(v.x<0||v.x>=t||v.y<0||!e.has(h)){let x;v.id==="top"?x=`${n},${l}-${n+1},${l}`:v.id==="right"?x=`${n+1},${l}-${n+1},${l+1}`:v.id==="bottom"?x=`${n+1},${l+1}-${n},${l+1}`:x=`${n},${l+1}-${n},${l}`,a.add(x)}})}const s=[];for(;a.size>0;){const i=a.values().next().value;if(!i)break;a.delete(i);const[n,l]=i.split("-");let c=l,v=`M ${n.replace(","," ")} L ${l.replace(","," ")}`,h=!0;for(;h;){h=!1;for(const f of a)if(f.startsWith(c+"-")){const[x,b]=f.split("-");v+=` L ${b.replace(","," ")}`,c=b,a.delete(f),h=!0;break}}v+=" Z",s.push(v)}return s.join(" ")}}const Ls={MOVE_UP:{label:"Move Up",keys:["ArrowUp"],group:"Navigation"},MOVE_DOWN:{label:"Move Down",keys:["ArrowDown"],group:"Navigation"},MOVE_LEFT:{label:"Move Left",keys:["ArrowLeft"],group:"Navigation"},MOVE_RIGHT:{label:"Move Right",keys:["ArrowRight"],group:"Navigation"},GOTO:{label:"Jump to Coordinate",keys:["Alt+j"],group:"Navigation"},JUMP_HOME:{label:"Return to Center",keys:["Ctrl+h"],group:"Navigation"},PAN_VIEWPORT:{label:"Pan Viewport (Hold)",keys:["q"],group:"Navigation"},RESET_PAN:{label:"Reset Panning",keys:["Alt+q"],group:"Navigation"},RESET_VIEWPORT:{label:"Reset Pan/Zoom",keys:["Alt+Backspace"],group:"View"}},Cs={PAINT:{label:"Paint (Apply Color)",keys:["Space","Enter"],group:"Tools"},ERASE:{label:"Erase Pixel",keys:["Backspace","Delete"],group:"Tools"},PICK_COLOR:{label:"Sample Color",keys:["Alt+i","Alt+Space"],group:"Tools"},FLOOD_FILL:{label:"Color Fill",keys:["Alt+f"],group:"Magic"},RECOLOR:{label:"Recolor All",keys:["Alt+r"],group:"Magic"},SELECT_SAME:{label:"Magic Wand",keys:["w"],group:"Magic"},TOOL_GRADIENT:{label:"Gradient Fill",keys:["Alt+g"],group:"Magic"}},Is={FLOW_PAINT:{label:"Continuous Painting",keys:["Ctrl"],group:"Flow"},FLOW_ERASE:{label:"Continuous Erasing",keys:["Ctrl+Shift"],group:"Flow"},FLOW_SELECT:{label:"Define Selection",keys:["Shift"],group:"Flow"}},Ps={COPY:{label:"Copy",keys:["Ctrl+c"],group:"Edit"},CUT:{label:"Cut",keys:["Ctrl+x"],group:"Edit"},PASTE:{label:"Paste",keys:["Ctrl+v"],group:"Edit"},CLEAR_CANVAS:{label:"Clear All",keys:["Ctrl+l"],group:"Edit"}},Ms={FLIP_H:{label:"Flip Horizontally",keys:["Alt+h"],group:"Transform"},FLIP_V:{label:"Flip Vertically",keys:["Alt+v"],group:"Transform"},ROTATE:{label:"Rotate 90° Clockwise",keys:["r"],group:"Transform"},ZOOM_IN:{label:"Zoom In",keys:["+","="],group:"View"},ZOOM_OUT:{label:"Zoom Out",keys:["-"],group:"View"},RESET_ZOOM:{label:"Reset Zoom",keys:["Ctrl+0"],group:"View"}},Os={NEXT_FRAME:{label:"Next Frame",keys:["Alt+PageDown","Tab"],group:"Timeline"},PREV_FRAME:{label:"Previous Frame",keys:["Alt+PageUp","Shift+Tab"],group:"Timeline"},PLAY_PAUSE:{label:"Play/Pause",keys:["p"],group:"Timeline"},TOGGLE_GHOST_LAYERS:{label:"Onion Skinning",keys:["Alt+o"],group:"Timeline"}},Rs={NEW_ITEM:{label:"Add New (Contextual)",keys:["Alt+Shift+n"],group:"Layers"},NEW_LAYER_GROUP:{label:"Group Layers",keys:["Ctrl+g"],group:"Layers"},DUPLICATE_ITEM:{label:"Duplicate (Contextual)",keys:["Ctrl+d"],group:"Layers"},MOVE_ITEM_UP:{label:"Bring Forward",keys:["Ctrl+]"],group:"Layers"},MOVE_ITEM_DOWN:{label:"Send Backward",keys:["Ctrl+["],group:"Layers"},MOVE_ITEM_TOP:{label:"Bring to Front",keys:["Ctrl+Shift+]"],group:"Layers"},MOVE_ITEM_BOTTOM:{label:"Send to Back",keys:["Ctrl+Shift+["],group:"Layers"},DELETE_ITEM:{label:"Remove (Contextual)",keys:["Alt+d"],group:"Layers"},MERGE_LAYERS:{label:"Merge Layer Down",keys:["Ctrl+Alt+m"],group:"Layers"},TOGGLE_LAYER_VISIBILITY:{label:"Show/Hide Layer",keys:["Ctrl+Alt+v"],group:"Layers"},TOGGLE_LAYER_LOCK:{label:"Lock/Unlock Layer",keys:["Alt+l"],group:"Layers"}},Ds={BRUSH_SIZE_INC:{label:"Increase Brush Size",keys:["]"],group:"Etching"},BRUSH_SIZE_DEC:{label:"Decrease Brush Size",keys:["["],group:"Etching"},TOGGLE_PATTERN_BRUSH:{label:"Pattern Brush",keys:["Ctrl+Alt+b"],group:"Etching"},TOGGLE_BRUSH_SHAPE:{label:"Toggle Brush Shape",keys:["Alt+b"],group:"Etching"},CYCLE_SYMMETRY:{label:"Cycle Symmetry Mode",keys:["s"],group:"Etching"},TOGGLE_TILING:{label:"Toggle Seamless Tiling",keys:["t"],group:"Etching"},TOGGLE_AIRBRUSH:{label:"The Mist (Airbrush)",keys:["Alt+a"],group:"Etching"},TOGGLE_ALPHA_LOCK:{label:"Toggle Alpha Lock",keys:["a"],group:"Etching"},TOGGLE_COLOR_LOCK:{label:"Toggle Color Lock",keys:["Shift+a"],group:"Etching"},SHADE_LIGHTEN:{label:"Shade: Lighten",keys:["l"],group:"Etching"},SHADE_DARKEN:{label:"Shade: Darken",keys:["d"],group:"Etching"},SHADE_DITHER:{label:"Shade: Dither",keys:["x"],group:"Etching"},TOGGLE_PIXEL_PERFECT:{label:"Toggle Pixel-Perfect Lines",keys:["Shift+p"],group:"Etching"},TOOL_BRUSH:{label:"Brush Tool",keys:["Shift+b"],group:"Etching"},TOOL_ERASER:{label:"Eraser Tool",keys:["e"],group:"Etching"},TOOL_SELECT:{label:"Select Tool",keys:["Shift+s"],group:"Etching"},TOGGLE_HAND_TOOL:{label:"Hand Tool",keys:["h"],group:"Etching"},TOOL_RECTANGLE:{label:"Rectangle Tool",keys:["Shift+r"],group:"Etching"},TOOL_ELLIPSE:{label:"Ellipse Tool",keys:["Alt+c"],group:"Etching"},TOOL_POLYGON:{label:"Polygon Tool",keys:["Alt+p"],group:"Etching"},POLY_SIDES_INC:{label:"Increase Polygon Sides",keys:["Alt+."],group:"Etching"},POLY_SIDES_DEC:{label:"Decrease Polygon Sides",keys:["Alt+,"],group:"Etching"},POLY_INDENT_INC:{label:"Increase Indentation",keys:["Alt+Shift+]"],group:"Etching"},POLY_INDENT_DEC:{label:"Decrease Indentation",keys:["Alt+Shift+["],group:"Etching"},SET_SIDES_3:{label:"Set Sides: 3",keys:["Alt+3"],group:"Etching"},SET_SIDES_4:{label:"Set Sides: 4",keys:["Alt+4"],group:"Etching"},SET_SIDES_5:{label:"Set Sides: 5",keys:["Alt+5"],group:"Etching"},SET_SIDES_6:{label:"Set Sides: 6",keys:["Alt+6"],group:"Etching"},SET_SIDES_7:{label:"Set Sides: 7",keys:["Alt+7"],group:"Etching"},SET_SIDES_8:{label:"Set Sides: 8",keys:["Alt+8"],group:"Etching"},SET_SIDES_9:{label:"Set Sides: 9",keys:["Alt+9"],group:"Etching"},SET_SIDES_10:{label:"Set Sides: 10",keys:["Alt+0"],group:"Etching"},TOGGLE_UNDERLAY:{label:"Toggle Underlay Visibility",keys:["Ctrl+Alt+u"],group:"View"},OPEN_UNDERLAY_MENU:{label:"Underlay Menu",keys:["Alt+u"],group:"View"},TOOL_TRANSFORM:{label:"Transform Selection",keys:["m"],group:"Edit"}},js={OPEN_MENU:{label:"Command Palette",keys:["Ctrl+k"],group:"System"},OPEN_EXPORT:{label:"Export",keys:["Ctrl+e"],group:"System"},SAVE:{label:"Save",keys:["Ctrl+s"],group:"System"},OPEN_SETTINGS:{label:"Settings",keys:["Ctrl+,"],group:"System"},OPEN_MANUAL:{label:"Barista Manual",keys:["F1"],group:"System"},OPEN_PALETTE:{label:"Color Picker",keys:["b"],group:"System"},OPEN_HELP:{label:"Quick Guide",keys:["F2"],group:"System"},OPEN_AUDIO:{label:"Audio Settings",keys:["Ctrl+Shift+a"],group:"System"},TOGGLE_MUTE:{label:"Mute Audio",keys:["Ctrl+Shift+m"],group:"System"},TOGGLE_MINIMAP:{label:"Minimap",keys:["Ctrl+m"],group:"System"},UNDO:{label:"Undo",keys:["Ctrl+z"],group:"System"},REDO:{label:"Redo",keys:["Ctrl+Shift+z","Ctrl+y"],group:"System"},ESCAPE:{label:"Close/Cancel",keys:["Escape"],group:"System"}},Fs={SELECT_COLOR_1:{label:"Select Color 1",keys:["1"],group:"Colors"},SELECT_COLOR_2:{label:"Select Color 2",keys:["2"],group:"Colors"},SELECT_COLOR_3:{label:"Select Color 3",keys:["3"],group:"Colors"},SELECT_COLOR_4:{label:"Select Color 4",keys:["4"],group:"Colors"},SELECT_COLOR_5:{label:"Select Color 5",keys:["5"],group:"Colors"},SELECT_COLOR_6:{label:"Select Color 6",keys:["6"],group:"Colors"},SELECT_COLOR_7:{label:"Select Color 7",keys:["7"],group:"Colors"},SELECT_COLOR_8:{label:"Select Color 8",keys:["8"],group:"Colors"},SELECT_COLOR_9:{label:"Select Color 9",keys:["9"],group:"Colors"},SELECT_COLOR_0:{label:"Select Color 0",keys:["0"],group:"Colors"}},Gs={TAB_TIMELINE:{label:"Focus Timeline",keys:["Alt+1"],group:"System"},TAB_LAYERS:{label:"Focus Layers",keys:["Alt+2"],group:"System"}},Bs={navigation:Ls,painting:Cs,flows:Is,manipulation:Ps,transform:Ms,animation:Os,layering:Rs,etching:Ds,system:js,colors:Fs,tabs:Gs};class $s{buffer=[];timeout=null;#e=L(Be([]));get currentSequence(){return o(this.#e)}set currentSequence(e){A(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const a=this.buffer.join(","),s={"g,c":"GOTO","f,n":"NEW_ITEM","i,n":"NEW_ITEM","i,l":"TOGGLE_LAYER_LOCK","i,h":"TOGGLE_LAYER_VISIBILITY","i,m":"MERGE_LAYERS"};if(s[a]){const i=s[a];return this.reset(),i}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const Ta=new $s;class Ns{patterns=[];#e=L(Be([]));get activeKeys(){return o(this.#e)}set activeKeys(e){A(this.#e,e,!0)}#t=L(!1);get isCtrlActive(){return o(this.#t)}set isCtrlActive(e){A(this.#t,e,!0)}#a=L(!1);get isShiftActive(){return o(this.#a)}set isShiftActive(e){A(this.#a,e,!0)}#r=L(!1);get isAltActive(){return o(this.#r)}set isAltActive(e){A(this.#r,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){this.patterns=[],Object.values(Bs).forEach(e=>{Object.entries(e).forEach(([t,a])=>{const{keys:s,group:i}=a,n=w({key:`labels.${t}`}),l=i.toLowerCase().replace(/ & /g,"_").replace(/ /g,"_"),c=w({key:`shortcut_groups.${l}`});s.forEach(v=>{const h=v.toLowerCase();let f="",x=!1,b=!1,m=!1;if(h==="+")f="+";else{const y=h.split("+");f=y[y.length-1].trim(),f===""&&h.endsWith("++")&&(f="+"),x=y.includes("ctrl")||y.includes("control"),b=y.includes("shift"),m=y.includes("alt")}f==="space"&&(f=" "),(f==="ctrl"||f==="control")&&(f="control"),this.patterns.push({intent:t,key:f,ctrl:x,shift:b,alt:m,label:n,group:c})})})}),this.patterns.sort((e,t)=>{const a=s=>(s.ctrl?1:0)+(s.shift?1:0)+(s.alt?1:0);return a(t)-a(e)})}getActions(){const e=new Set,t=[];return this.patterns.forEach(a=>{e.has(a.intent)||(e.add(a.intent),t.push({intent:a.intent,label:a.label,group:a.group,shortcut:this.getLabel(a.intent)}))}),t}getGroupedActions(){const e=this.getActions(),t={},a={MOVE_UP:"navigation",MOVE_DOWN:"navigation",MOVE_LEFT:"navigation",MOVE_RIGHT:"navigation",SELECT_COLOR_1:"colors",SELECT_COLOR_2:"colors",SELECT_COLOR_3:"colors",SELECT_COLOR_4:"colors",SELECT_COLOR_5:"colors",SELECT_COLOR_6:"colors",SELECT_COLOR_7:"colors",SELECT_COLOR_8:"colors",SELECT_COLOR_9:"colors",SELECT_COLOR_0:"colors"},s=[],i=new Set;e.forEach(c=>{const v=a[c.intent];if(v){if(!i.has(v)){i.add(v);const h=w({key:`shortcut_groups.${v}`});s.push({...c,label:h,customKey:v.toUpperCase()})}}else s.push(c)}),s.forEach(c=>{t[c.group]||(t[c.group]=[]),t[c.group].push(c)});const n=[w({key:"shortcut_groups.rhythms"}),w({key:"shortcut_groups.navigation"}),w({key:"shortcut_groups.tools"}),w({key:"shortcut_groups.magic"}),w({key:"shortcut_groups.etching"}),w({key:"shortcut_groups.flow"}),w({key:"shortcut_groups.selection"}),w({key:"shortcut_groups.transform"}),w({key:"shortcut_groups.geometry"}),w({key:"shortcut_groups.timeline"}),w({key:"shortcut_groups.layers"}),w({key:"shortcut_groups.edit"}),w({key:"shortcut_groups.view"}),w({key:"shortcut_groups.menu"}),w({key:"shortcut_groups.colors"}),w({key:"shortcut_groups.system"})],l=Object.keys(t);return l.sort((c,v)=>{const h=n.indexOf(c),f=n.indexOf(v);return(h===-1?999:h)-(f===-1?999:f)}),l.map(c=>({group:c,items:t[c]}))}updatePhysicalState(e,t){const a=e.key.toLowerCase();t==="down"?this.activeKeys.includes(a)||this.activeKeys.push(a):(this.activeKeys=this.activeKeys.filter(s=>s!==a),a==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="control"&&s!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const a=Ta.process(t);if(a)return a}else Ta.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const a of this.patterns)if(t===a.key&&this.isCtrlActive===a.ctrl&&this.isShiftActive===a.shift&&this.isAltActive===a.alt)return a.intent;return null}getLabel(e){const t=this.patterns.find(c=>c.intent===e);if(!t)return"Unassigned";const a=[];t.ctrl&&a.push("Ctrl"),t.shift&&a.push("Shift"),t.alt&&a.push("Alt");let s=t.key;const i={" ":"Space",control:"Ctrl",meta:"Cmd",alt:"Alt",shift:"Shift",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right",backspace:"Backspace",delete:"Delete",enter:"Enter",escape:"Esc",tab:"Tab"},n=s.toLowerCase();i[n]?s=i[n]:s=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();const l=a.filter(c=>c.toLowerCase()!==s.toLowerCase());return l.length===0?s:l.join("+")+"+"+s}}const at=new Ns;class se{static toHex(e){const{h:t,s:a,l:s,a:i}=e,n=t/360,l=a/100,c=s/100;let v,h,f;if(l===0)v=h=f=c;else{const y=c<.5?c*(1+l):c+l-c*l,_=2*c-y,k=I=>(I<0&&(I+=1),I>1&&(I-=1),I<1/6?_+(y-_)*6*I:I<1/2?y:I<2/3?_+(y-_)*(2/3-I)*6:_);v=k(n+1/3),h=k(n),f=k(n-1/3)}const x=y=>Math.round(y*255).toString(16).padStart(2,"0"),b=Math.round(i*255).toString(16).padStart(2,"0"),m=`#${x(v)}${x(h)}${x(f)}`;return b==="ff"?m:m+b}static toHSLA(e){let t=0,a=0,s=0,i=1;const n=e.replace("#","");n.length===3||n.length===4?(t=parseInt(n[0]+n[0],16),a=parseInt(n[1]+n[1],16),s=parseInt(n[2]+n[2],16),n.length===4&&(i=parseInt(n[3]+n[3],16)/255)):(n.length===6||n.length===8)&&(t=parseInt(n.substring(0,2),16),a=parseInt(n.substring(2,4),16),s=parseInt(n.substring(4,6),16),n.length===8&&(i=parseInt(n.substring(6,8),16)/255)),t/=255,a/=255,s/=255;const l=Math.max(t,a,s),c=Math.min(t,a,s);let v=0,h=0,f=(l+c)/2;if(l!==c){const x=l-c;switch(h=f>.5?x/(2-l-c):x/(l+c),l){case t:v=(a-s)/x+(a<s?6:0);break;case a:v=(s-t)/x+2;break;case s:v=(t-a)/x+4;break}v/=6}return{h:Math.round(v*360),s:Math.round(h*100),l:Math.round(f*100),a:parseFloat(i.toFixed(2))}}static adjustBrightness(e,t){const a=this.toHSLA(e);return a.l=Math.max(0,Math.min(100,a.l+t*100)),this.toHex(a)}static adjustSaturation(e,t){const a=this.toHSLA(e);return a.s=Math.max(0,Math.min(100,a.s+t*100)),this.toHex(a)}static adjustOpacity(e,t){const a=this.toHSLA(e);return a.a=Math.max(0,Math.min(1,t)),this.toHex(a)}static mix(e,t,a=.5){const s=this.hexToRgb(e),i=this.hexToRgb(t),n={r:Math.round(s.r*(1-a)+i.r*a),g:Math.round(s.g*(1-a)+i.g*a),b:Math.round(s.b*(1-a)+i.b*a),a:s.a*(1-a)+i.a*a};return this.rgbToHex(n.r,n.g,n.b,n.a)}static rgbaCache=new Map;static toRGBA(e){if(this.rgbaCache.has(e))return this.rgbaCache.get(e);const{r:t,g:a,b:s,a:i}=this.hexToRgb(e),n=new Uint8ClampedArray([t,a,s,Math.round(i*255)]);return this.rgbaCache.set(e,n),n}static hexToUint32(e){if(!e)return 0;const{r:t,g:a,b:s,a:i}=this.hexToRgb(e);return(Math.round(i*255)<<24|s<<16|a<<8|t)>>>0}static uint32ToHex(e){if(e===0)return null;const t=e&255,a=e>>8&255,s=e>>16&255,i=e>>24&255;return this.rgbToHex(t,a,s,i/255)}static hexToRgb(e){const t=e.replace("#","");let a=0,s=0,i=0,n=1;return(t.length===6||t.length===8)&&(a=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16),t.length===8&&(n=parseInt(t.substring(6,8),16)/255)),{r:a,g:s,b:i,a:n}}static rgbToHex(e,t,a,s){const i=c=>Math.round(c).toString(16).padStart(2,"0"),n=Math.round(s*255).toString(16).padStart(2,"0"),l=`#${i(e)}${i(t)}${i(a)}`;return n==="ff"?l:l+n}}class Us{#e=q(()=>r.studio.isHandToolActive||at.activeKeys.includes("q")?{type:"PAN",label:w({key:"labels.PAN_VIEWPORT"}),icon:"🤚",color:"var(--color-brand)",isPulse:!1}:Ta.isActive?{type:"FLOW",label:w({key:"timeline.mode_labels.brewing"}),icon:"📑",color:"var(--color-brand)",isPulse:!0}:r.isPicking?{type:"PICK",label:w({key:"timeline.mode_labels.tasting"}),icon:"📍",color:"var(--color-brand)",isPulse:!0}:at.isCtrlActive&&at.isShiftActive||r.studio.activeTool==="ERASER"?{type:"ERASE",label:w({key:"timeline.mode_labels.clearing"}),icon:"🧹",color:"var(--color-brand)",isPulse:!0}:at.isShiftActive||r.studio.activeTool==="SELECT"?{type:"SELECT",label:w({key:"timeline.mode_labels.selecting"}),icon:"✨",color:"var(--color-brand)",isPulse:!0}:at.isCtrlActive||r.studio.isShadingLighten||r.studio.isShadingDarken||r.studio.isShadingDither?{type:"PAINT",label:w({key:"timeline.mode_labels.pouring"}),icon:"☕",color:"var(--color-green-leaves)",isPulse:!0}:{type:"READY",label:w({key:"timeline.mode_labels.ready"}),icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return o(this.#e)}set current(e){A(this.#e,e)}}const Re=new Us;class Vs{draw(e,t){const a=e!==void 0?Math.floor(e):r.cursor.pos.x,s=t!==void 0?Math.floor(t):r.cursor.pos.y,i=[],n=new Uint32Array(r.canvas.pixels);if(r.studio.isPatternBrushActive&&r.studio.patternBrushData){const l=r.studio.patternBrushData,c=Math.floor(l.width/2),v=Math.floor(l.height/2);for(let h=0;h<l.height;h++)for(let f=0;f<l.width;f++){const x=a+f-c,b=s+h-v;if(r.canvas.isValidCoord(x,b)){const m=h*l.width+f,y=l.data[m];if(y===0)continue;const _=r.canvas.getIndex(x,b);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(_)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(_))continue;const I=Re.current.type==="ERASE"?0:y,F=n[_];F!==I&&(i.push({index:_,oldColor:se.uint32ToHex(F),newColor:se.uint32ToHex(I)}),n[_]=I)}}}else{const c=ya.getKernel(r.studio.brushSize,r.studio.brushShape).map(h=>({x:a+h.x,y:s+h.y}));if(r.studio.symmetryMode!=="OFF"){const h=r.studio.symmetryMode,{width:f,height:x}=r.canvas,b=[];c.forEach(m=>{const y=ot.getSymmetryPoints(m.x,m.y,f,x,h);b.push(...y)}),c.push(...b)}let v=r.studio.isTilingEnabled?c.map(h=>ot.wrap(h.x,h.y,r.canvas.width,r.canvas.height)):c.filter(h=>r.canvas.isValidCoord(h.x,h.y));if(r.studio.isAirbrushActive){const h=r.studio.airbrushDensity;v=v.filter(()=>Math.random()<h)}v.forEach(h=>{const f=r.canvas.getIndex(h.x,h.y);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(f)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(f)||r.studio.isColorLocked&&r.studio.colorLockSource!==null&&n[f]!==se.hexToUint32(r.studio.colorLockSource))return;const x=this.getEffectColorForPoint(h.x,h.y,n[f]),b=n[f];b!==x&&(i.push({index:f,oldColor:se.uint32ToHex(b),newColor:se.uint32ToHex(x)}),n[f]=x)})}i.length>0&&(r.canvas.pixels=n,r.canvas.triggerPulse(),de.push(i),Re.current.type==="ERASE"?ee.playErase():ee.playDraw())}erase(e,t){const a=e!==void 0?Math.floor(e):r.cursor.pos.x,s=t!==void 0?Math.floor(t):r.cursor.pos.y,n=ya.getKernel(r.studio.brushSize,r.studio.brushShape).map(h=>({x:a+h.x,y:s+h.y}));if(r.studio.symmetryMode!=="OFF"){const h=r.studio.symmetryMode,{width:f,height:x}=r.canvas,b=[];n.forEach(m=>{const y=ot.getSymmetryPoints(m.x,m.y,f,x,h);b.push(...y)}),n.push(...b)}const l=r.studio.isTilingEnabled?n.map(h=>ot.wrap(h.x,h.y,r.canvas.width,r.canvas.height)):n.filter(h=>r.canvas.isValidCoord(h.x,h.y)),c=[],v=new Uint32Array(r.canvas.pixels);l.forEach(h=>{const f=r.canvas.getIndex(h.x,h.y);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(f)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(f))return;const x=v[f];x!==0&&(c.push({index:f,oldColor:se.uint32ToHex(x),newColor:null}),v[f]=0)}),c.length>0&&(r.canvas.pixels=v,r.canvas.triggerPulse(),de.push(c),ee.playErase())}getEffectColorForPoint(e,t,a){if(Re.current.type==="ERASE")return 0;const s=r.paletteState.activeColor,i=se.hexToUint32(s);if(r.studio.isShadingDither)return(e+t)%2===0?i:0;if(a===0)return i;if(r.studio.isShadingLighten){const n=se.uint32ToHex(a);return se.hexToUint32(se.adjustBrightness(n,.1))}if(r.studio.isShadingDarken){const n=se.uint32ToHex(a);return se.hexToUint32(se.adjustBrightness(n,-.1))}return i}beginStroke(e,t){r.canvas.clearBuffer(),r.canvas.addToBuffer(e,t)}continueStroke(e,t,a,s){const i=Ze.getLinePoints(a,s,e,t,0);if(r.studio.isPixelPerfect){const n=[...r.canvas.strokePoints,...i],l=ot.pixelPerfectFilter(n);r.canvas.clearBuffer(),r.canvas.addBatchToBuffer(l)}else r.canvas.addBatchToBuffer(i)}endStroke(){this.commitBuffer()}cancelStroke(){r.canvas.clearBuffer(),ee.playErase()}snapCurrentStroke(){const e=r.canvas.strokePoints;if(e.length<5)return;const t=r.studio.stabilization,a=Va.smooth(e,t/10),s=.05+t/100*.35,i=Ze.fitArc(a,s);r.canvas.clearBuffer();let n=[],l=[];if(i&&i.isFull)l=i.points,n=Ze.getCirclePoints(i.cx,i.cy,i.r);else{const c=Va.simplify(a,t/100*2);if(c.length===2){let v={...c[0]},h={...c[c.length-1]};const f=Math.abs(h.x-v.x),x=Math.abs(h.y-v.y),b=3;if(f<b)h.x=v.x;else if(x<b)h.y=v.y;else if(Math.abs(f-x)<b){const m=Math.max(f,x);h.x=v.x+m*Math.sign(h.x-v.x),h.y=v.y+m*Math.sign(h.y-v.y)}l=[v,h],n=Ze.getLinePoints(v.x,v.y,h.x,h.y,0)}else if(i){l=i.points;for(let v=0;v<l.length-1;v++)n.push(...Ze.getLinePoints(l[v].x,l[v].y,l[v+1].x,l[v+1].y,t/100))}else{l=c;for(let v=0;v<l.length-1;v++)n.push(...Ze.getLinePoints(l[v].x,l[v].y,l[v+1].x,l[v+1].y,t/100))}}r.canvas.addBatchToBuffer(n),r.canvas.strokePoints=l,ee.playDraw()}commitBuffer(){const e=r.canvas.pixelBuffer;if(e.length===0){r.canvas.clearBuffer();return}const t=[],a=new Uint32Array(r.canvas.pixels);if(r.studio.isPatternBrushActive&&r.studio.patternBrushData){const s=r.studio.patternBrushData,i=Math.floor(s.width/2),n=Math.floor(s.height/2);e.forEach(l=>{const c=l%r.canvas.width,v=Math.floor(l/r.canvas.width);for(let h=0;h<s.height;h++)for(let f=0;f<s.width;f++){const x=c+f-i,b=v+h-n;if(r.canvas.isValidCoord(x,b)){const m=h*s.width+f,y=s.data[m];if(y===0)continue;const _=r.canvas.getIndex(x,b);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(_)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(_))continue;const I=Re.current.type==="ERASE"?0:y,F=a[_];F!==I&&(t.push({index:_,oldColor:se.uint32ToHex(F),newColor:se.uint32ToHex(I)}),a[_]=I)}}})}else{const s=ya.getKernel(r.studio.brushSize,r.studio.brushShape);e.forEach(i=>{const n=i%r.canvas.width,l=Math.floor(i/r.canvas.width),c=s.map(h=>({x:n+h.x,y:l+h.y}));if(r.studio.symmetryMode!=="OFF"){const h=r.studio.symmetryMode,{width:f,height:x}=r.canvas,b=[];c.forEach(m=>{const y=ot.getSymmetryPoints(m.x,m.y,f,x,h);b.push(...y)}),c.push(...b)}(r.studio.isTilingEnabled?c.map(h=>ot.wrap(h.x,h.y,r.canvas.width,r.canvas.height)):c.filter(h=>r.canvas.isValidCoord(h.x,h.y))).forEach(h=>{const f=r.canvas.getIndex(h.x,h.y);if(r.selection.isActive&&!r.selection.activeIndicesSet.has(f)||r.studio.isAlphaLocked&&!r.project.activeFrame.activeLayer.hasPixel(f))return;const x=this.getEffectColorForPoint(h.x,h.y,a[f]),b=a[f];b!==x&&(t.push({index:f,oldColor:se.uint32ToHex(b),newColor:se.uint32ToHex(x)}),a[f]=x)})})}t.length>0&&(r.canvas.pixels=a,r.canvas.triggerPulse(),de.push(t),Re.current.type==="ERASE"?ee.playErase():ee.playDraw()),r.canvas.clearBuffer()}commitShape(){const e=r.studio.shapeAnchor;if(!e)return;const{x:t,y:a}=r.cursor.pos,s=r.studio.activeTool;if(s==="GRADIENT"){const n=r.studio.gradientStartColor,l=r.paletteState.activeColor;if(!n)return;const c=r.selection.isActive?r.selection.indices:Array.from({length:r.canvas.width*r.canvas.height},(x,b)=>b),v=ot.getLinearGradientMap(e.x,e.y,t,a,c,r.canvas.width),h=new Uint32Array(r.canvas.pixels),f=[];v.forEach(x=>{const b=se.mix(n,l,x.ratio),m=se.hexToUint32(b),y=h[x.index];y!==m&&(f.push({index:x.index,oldColor:se.uint32ToHex(y),newColor:b}),h[x.index]=m)}),f.length>0&&(r.canvas.pixels=h,r.canvas.triggerPulse(),de.push(f),ee.playDraw()),r.studio.activeTool="BRUSH",r.studio.shapeAnchor=null,r.studio.gradientStartColor=null;return}let i=[];if(s==="RECTANGLE"?i=ot.getRectanglePoints(e.x,e.y,t,a):s==="ELLIPSE"?i=ot.getEllipsePoints(e.x,e.y,t,a):s==="POLYGON"&&(i=ot.getPolygonPoints(e.x,e.y,t,a,r.studio.polygonSides,r.studio.polygonIndentation)),i.length>0){const n=r.paletteState.activeColor,l=se.hexToUint32(n),c=[],v=new Uint32Array(r.canvas.pixels);i.forEach(h=>{if(r.canvas.isValidCoord(h.x,h.y)){const f=r.canvas.getIndex(h.x,h.y),x=v[f];x!==l&&(c.push({index:f,oldColor:se.uint32ToHex(x),newColor:n}),v[f]=l)}}),c.length>0&&(r.canvas.pixels=v,r.canvas.triggerPulse(),de.push(c),ee.playDraw())}r.studio.activeTool="BRUSH",r.studio.shapeAnchor=null}}class Hs{resize(e,t){const a=new Uint32Array(e*t),s=se.hexToUint32(r.backgroundColor);a.fill(s);for(let i=0;i<Math.min(r.canvas.height,t);i++)for(let n=0;n<Math.min(r.canvas.width,e);n++){const l=i*r.canvas.width+n,c=i*e+n;a[c]=r.canvas.pixels[l]}r.canvas.reset(e,t,a),de.clear(),ee.playDraw()}flip(e){const{width:t,height:a}=r.canvas,s=r.project.activeFrame;de.beginBatch(),s.layers.forEach(i=>{if(i.type!=="LAYER")return;const n=i.pixels,l=new Uint32Array(n.length);if(e==="horizontal")for(let c=0;c<a;c++){const v=c*t,h=n.subarray(v,v+t),f=new Uint32Array(h).reverse();l.set(f,v)}else for(let c=0;c<a;c++){const v=c*t,h=(a-1-c)*t;l.set(n.subarray(v,v+t),h)}i.pixels=l}),r.canvas.triggerPulse(),de.endBatch(),r.studio.show(e==="horizontal"?"Flipped Horizontally":"Flipped Vertically"),ee.playDraw()}rotate(){const{width:e,height:t}=r.canvas;if(e!==t){r.studio.show("Only square cups can be rotated");return}const a=r.project.activeFrame;de.beginBatch(),a.layers.forEach(s=>{if(s.type!=="LAYER")return;const i=s.pixels,n=new Uint32Array(e*t);for(let l=0;l<t;l++)for(let c=0;c<e;c++){const v=l*e+c,h=c*e+(t-1-l);n[h]=i[v]}s.pixels=n}),r.canvas.triggerPulse(),de.endBatch(),r.studio.show("Rotated 90°"),ee.playDraw()}clearAll(){confirm("Are you sure you want to clear the entire canvas?")&&(r.canvas.clear(),de.clear(),r.studio.show("Foam Cleared"),ee.playErase())}bleach(){const{x:e,y:t}=r.cursor.pos,a=r.canvas.getColor(e,t),s=se.hexToUint32(r.activeColor);if(a===s)return;const{pixels:i}=r.canvas,n=[],l=r.selection.isActive,c=r.selection.activeIndicesSet,v=new Uint32Array(i);i.forEach((h,f)=>{const x=h===a,b=!l||c.has(f);x&&b&&(n.push({index:f,oldColor:se.uint32ToHex(a),newColor:se.uint32ToHex(s)}),v[f]=s)}),n.length>0&&(r.canvas.pixels=v,r.canvas.triggerPulse(),de.beginBatch(),n.forEach(h=>de.push(h)),de.endBatch(),ee.playDraw())}}class zs{copy(){const e=r.canvas.width,t=r.selection.getPoints(e),a=r.selection.getEffectiveBounds(e);if(!a||t.length===0)return;const s=new Uint32Array(a.width*a.height),i=r.canvas.compositePixels;t.forEach(n=>{const l=n.y*e+n.x,c=n.x-a.x1,h=(n.y-a.y1)*a.width+c;s[h]=i[l]}),r.project.clipboard={width:a.width,height:a.height,data:s},ee.playDraw()}cut(){this.copy();const e=r.canvas.width,t=r.selection.getPoints(e);if(t.length===0)return;de.beginBatch();const a=new Uint32Array(r.canvas.pixels);t.forEach(s=>{const i=s.y*e+s.x,n=a[i];de.push({index:i,oldColor:se.uint32ToHex(n),newColor:null}),a[i]=0}),r.canvas.pixels=a,r.canvas.triggerPulse(),de.endBatch(),ee.playErase(),r.selection.clear()}paste(){const e=r.project.clipboard;if(!e)return;const{x:t,y:a}=r.cursor.pos,{width:s,height:i}=r.canvas;de.beginBatch();const n=new Uint32Array(r.canvas.pixels);let l=!1;for(let c=0;c<e.height;c++)for(let v=0;v<e.width;v++){const h=t+v,f=a+c;if(h>=0&&h<s&&f>=0&&f<i){const x=c*e.width+v,b=e.data[x];if(b!==0){const m=f*s+h,y=n[m];de.push({index:m,oldColor:se.uint32ToHex(y),newColor:se.uint32ToHex(b)}),n[m]=b,l=!0}}}l&&(r.canvas.pixels=n,r.canvas.triggerPulse(),ee.playDraw()),de.endBatch()}}class Ys{serialize(){return JSON.stringify({version:r.version,metadata:{name:"Untitled Project",lastModified:new Date().toISOString()},palette:r.paletteState.swatches,project:{frames:r.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,layers:e.layers.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,type:t.type,parentId:t.parentId,isCollapsed:t.isCollapsed,pixels:Array.from(t.pixels)}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,r.project.currentFilePath||void 0);t&&(r.project.setMetadata(t),ee.playDraw())}webDownload(e){const t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="rupa-project.rupa",s.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),r.project.setMetadata(e.filePath),ee.playDraw())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const a=t.target.files?.[0];if(a){const s=new FileReader;s.onload=i=>this.deserialize(i.target?.result),s.readAsText(a)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),r.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}autoSaveSession(){try{const e=this.serialize();localStorage.setItem("rupa_autosave_session",e),r.project.lastSaved=new Date,console.log("Session autosaved.")}catch(e){console.warn("Autosave failed (likely quota exceeded):",e)}}restoreLastSession(){const e=localStorage.getItem("rupa_autosave_session");return e?(this.deserialize(e),!0):!1}deserialize(e){try{const t=JSON.parse(e);t.palette&&(r.paletteState.swatches=t.palette);const a=t.project||t.folio;if(a)r.project.frames=a.frames.map(s=>{const i=new oa(s.name,s.width,s.height),n=s.layers||s.veils||[];return i.layers=n.map(l=>{const c=new Ut(l.name,s.width,s.height,l.type||"LAYER");c.isVisible=l.isVisible,c.isLocked=l.isLocked,c.parentId=l.parentId||null,c.isCollapsed=l.isCollapsed||!1;const v=l.pixels||l.stitches||[];if(c.type==="LAYER")if(v.length>0&&typeof v[0]=="string"){const h=new Uint32Array(v.length);for(let f=0;f<v.length;f++)h[f]=se.hexToUint32(v[f]);c.pixels=h}else c.pixels=new Uint32Array(v);return c}),i});else if(t.pixelData){const s=new oa("Restored Project",t.dimensions.width,t.dimensions.height),i=new Uint32Array(t.pixelData.length);for(let n=0;n<t.pixelData.length;n++)i[n]=se.hexToUint32(t.pixelData[n]);s.layers[0].pixels=i,r.project.frames=[s]}r.project.activeFrameIndex=0,r.canvas.triggerPulse(),de.clear()}catch(t){console.error("Failed to restore project:",t)}}}class Ks{addFrame(e){const t=r.project,a=t.activeFrameIndex,s=t.addFrame(e),i=t.activeFrameIndex;return de.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(i,1),t.activeFrameIndex=a},redo:()=>{t.frames.splice(i,0,s),t.activeFrameIndex=i}}),ee.playDraw(),s}removeFrame(e){const t=r.project;if(t.frames.length<=1)return;const a=t.frames[e],s=t.activeFrameIndex;t.removeFrame(e);const i=t.activeFrameIndex;de.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,a),t.activeFrameIndex=s},redo:()=>{t.removeFrame(e),t.activeFrameIndex=i}}),ee.playErase()}duplicateFrame(e){const t=r.project,a=t.frames[e],s=t.activeFrameIndex,i=t.addFrame(`${a.name} (Copy)`),n=t.activeFrameIndex;i.width=a.width,i.height=a.height,i.duration=a.duration,i.layers=a.layers.map(l=>l.clone(a.width,a.height)),de.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(n,1),t.activeFrameIndex=s},redo:()=>{t.frames.splice(n,0,i),t.activeFrameIndex=n}}),ee.playDraw()}nextFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,de.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),ee.playMove()}prevFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,de.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),ee.playMove()}addLayer(e){const t=r.project.activeFrame,a=t.activeLayerIndex,s=t.addLayer(e),i=t.activeLayerIndex;return de.push({isStructural:!0,label:"Add Layer",undo:()=>{t.layers.splice(i,1),t.activeLayerIndex=a},redo:()=>{t.layers.splice(i,0,s),t.activeLayerIndex=i}}),ee.playDraw(),s}addGroup(e){const t=r.project.activeFrame,a=t.activeLayerIndex,s=t.addGroup(e),i=t.activeLayerIndex;return de.push({isStructural:!0,label:"Add Group",undo:()=>{t.layers.splice(i,1),t.activeLayerIndex=a},redo:()=>{t.layers.splice(i,0,s),t.activeLayerIndex=i}}),ee.playDraw(),s}removeLayer(e){const t=r.project.activeFrame;if(t.layers.length<=1)return;const a=t.layers[e],s=t.activeLayerIndex;t.removeLayer(e);const i=t.activeLayerIndex;de.push({isStructural:!0,label:"Remove Layer",undo:()=>{t.layers.splice(e,0,a),t.activeLayerIndex=s},redo:()=>{t.removeLayer(e),t.activeLayerIndex=i}}),ee.playErase()}duplicateLayer(e){const t=r.project.activeFrame,a=t.layers[e],s=t.activeLayerIndex,i=a.clone(t.width,t.height);i.name=`${a.name} (Copy)`;const n=e+1;t.layers.splice(n,0,i),t.activeLayerIndex=n,de.push({isStructural:!0,label:"Duplicate Layer",undo:()=>{t.layers.splice(n,1),t.activeLayerIndex=s},redo:()=>{t.layers.splice(n,0,i),t.activeLayerIndex=n}}),ee.playDraw()}nextLayer(){const e=r.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex+1)%e.layers.length,de.push({isStructural:!0,label:"Next Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t+1)%e.layers.length}),ee.playMove()}prevLayer(){const e=r.project.activeFrame,t=e.activeLayerIndex;e.activeLayerIndex=(e.activeLayerIndex-1+e.layers.length)%e.layers.length,de.push({isStructural:!0,label:"Prev Layer",undo:()=>e.activeLayerIndex=t,redo:()=>e.activeLayerIndex=(t-1+e.layers.length)%e.layers.length}),ee.playMove()}toggleLock(e){const t=e!==void 0?r.project.activeFrame.layers[e]:r.project.activeFrame.activeLayer;t&&(t.isLocked=!t.isLocked,ee.playDraw())}toggleVisibility(e){const t=e!==void 0?r.project.activeFrame.layers[e]:r.project.activeFrame.activeLayer;t&&(t.isVisible=!t.isVisible,ee.playDraw())}reorderLayer(e,t){const a=r.project.activeFrame;if(e===t||t<0||t>=a.layers.length)return;const s=a.activeLayerIndex;((l,c)=>{const[v]=a.layers.splice(l,1);a.layers.splice(c,0,v),a.activeLayerIndex===l?a.activeLayerIndex=c:l<a.activeLayerIndex&&c>=a.activeLayerIndex?a.activeLayerIndex--:l>a.activeLayerIndex&&c<=a.activeLayerIndex&&a.activeLayerIndex++})(e,t);const n=a.activeLayerIndex;de.push({isStructural:!0,label:"Reorder Layer",undo:()=>{const[l]=a.layers.splice(t,1);a.layers.splice(e,0,l),a.activeLayerIndex=s},redo:()=>{const[l]=a.layers.splice(e,1);a.layers.splice(t,0,l),a.activeLayerIndex=n}}),ee.playMove()}reorderFrame(e,t){const a=r.project;if(e===t||t<0||t>=a.frames.length)return;const s=a.activeFrameIndex;((l,c)=>{const[v]=a.frames.splice(l,1);a.frames.splice(c,0,v),a.activeFrameIndex===l?a.activeFrameIndex=c:l<a.activeFrameIndex&&c>=a.activeFrameIndex?a.activeFrameIndex--:l>a.activeFrameIndex&&c<=a.activeFrameIndex&&a.activeFrameIndex++})(e,t);const n=a.activeFrameIndex;de.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[l]=a.frames.splice(t,1);a.frames.splice(e,0,l),a.activeFrameIndex=s},redo:()=>{const[l]=a.frames.splice(e,1);a.frames.splice(t,0,l),a.activeFrameIndex=n}}),ee.playMove()}moveLayerUp(){const e=r.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,t+1)}moveLayerDown(){const t=r.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,t-1)}moveLayerToTop(){const e=r.project.activeFrame,t=e.activeLayerIndex;t<e.layers.length-1&&this.reorderLayer(t,e.layers.length-1)}moveLayerToBottom(){const t=r.project.activeFrame.activeLayerIndex;t>0&&this.reorderLayer(t,0)}mergeLayerDown(){const e=r.project.activeFrame,t=e.activeLayerIndex;if(t<=0)return;const a=t-1,s=e.layers[t],i=e.layers[a],n=new Uint32Array(i.pixels),l=s.pixels,c=new Uint32Array(i.pixels);for(let v=0;v<l.length;v++){const h=l[v];h!==0&&(c[v]=h)}i.pixels=c,e.layers.splice(t,1),e.activeLayerIndex=a,r.canvas.triggerPulse(),de.push({isStructural:!0,label:"Merge Layer",undo:()=>{i.pixels=n,e.layers.splice(t,0,s),e.activeLayerIndex=t,r.canvas.triggerPulse()},redo:()=>{i.pixels=c,e.layers.splice(t,1),e.activeLayerIndex=a,r.canvas.triggerPulse()}}),ee.playDraw()}}class qs{begin(e,t){r.selection.begin(e,t)}update(e,t){r.selection.isActive&&r.selection.update(e,t)}clear(){r.selection.clear()}fillSelection(){const e=r.selection.getPoints(r.canvas.width);if(e.length===0)return;const t=r.paletteState.activeColor,a=se.hexToUint32(t),s=r.canvas.width;de.beginBatch();let i=!1;const n=new Uint32Array(r.canvas.pixels);e.forEach(l=>{const c=l.y*s+l.x,v=n[c];v!==a&&(de.push({index:c,oldColor:se.uint32ToHex(v),newColor:t}),n[c]=a,i=!0)}),i&&(r.canvas.pixels=n,r.canvas.triggerPulse(),ee.playDraw()),de.endBatch()}commit(){r.canvas.triggerPulse()}spiritPick(){const{x:e,y:t}=r.cursor.pos;r.canvas.getColor(e,t);const{width:a,height:s,pixels:i}=r.canvas,n=4294967295,l=ot.floodFill(Array.from(i),a,s,e,t,n),c=[];for(let v=0;v<l.length;v++)l[v]===n&&c.push(v);r.selection.clear(),c.length>0&&(r.selection.indices=c,r.canvas.triggerPulse(),ee.playScale(4))}addVertex(e,t){r.selection.vertices.push({x:e,y:t}),ee.playDraw()}sealBinding(){const e=r.selection.vertices;if(e.length<3)return;const t=r.canvas.width,a=r.canvas.height,s=[];for(let i=0;i<a;i++)for(let n=0;n<t;n++)this.isPointInPoly(n,i,e)&&s.push(i*t+n);s.length>0&&(r.selection.indices=s,r.selection.vertices=[],ee.playScale(6))}isPointInPoly(e,t,a){let s=!1;for(let i=0,n=a.length-1;i<a.length;n=i++){const l=a[i].x,c=a[i].y,v=a[n].x,h=a[n].y;c>t!=h>t&&e<(v-l)*(t-c)/(h-c)+l&&(s=!s)}return s}nudge(e,t){if(r.selection.indices.length===0)return;const a=r.canvas.width,s=r.canvas.height,i=new Uint32Array(r.canvas.pixels),n=new Map;r.selection.indices.forEach(c=>{n.set(c,i[c]),i[c]=0});const l=[];n.forEach((c,v)=>{const h=v%a,f=Math.floor(v/a),x=h+e,b=f+t;if(x>=0&&x<a&&b>=0&&b<s){const m=b*a+x;i[m]=c,l.push(m)}}),r.canvas.pixels=i,r.canvas.triggerPulse(),r.selection.indices=l,ee.playMove()}}class Qs{select(e){r.paletteState.select(e),ee.playScale(e)}setColor(e){r.paletteState.setColor(e),ee.playDraw()}pickFromCanvas(){const{x:e,y:t}=r.cursor.pos,a=r.canvas.getColor(e,t),s=se.uint32ToHex(a);s!==null&&(this.setColor(s),r.studio.isPicking=!0,setTimeout(()=>{r.studio.isPicking=!1},1500))}weatherPalette(e){r.paletteState.swatches=r.paletteState.swatches.map(t=>se.adjustBrightness(t,e)),ee.playDraw()}mixActiveColor(e,t=.5){const a=se.mix(r.activeColor,e,t);this.setColor(a)}floodFill(){const{x:e,y:t}=r.cursor.pos,a=r.canvas.getColor(e,t),s=r.activeColor,i=se.hexToUint32(s);if(a===i)return;const{width:n,height:l,pixels:c}=r.canvas,v=ot.floodFill(Array.from(c),n,l,e,t,i),h=new Uint32Array(v),f=[],x=r.selection.isActive,b=r.selection.activeIndicesSet;for(let m=0;m<h.length;m++)if(h[m]!==c[m]){if(x&&!b.has(m)){h[m]=c[m];continue}f.push({index:m,oldColor:se.uint32ToHex(c[m]),newColor:s})}f.length>0&&(r.canvas.pixels=h,r.canvas.triggerPulse(),de.beginBatch(),f.forEach(m=>de.push(m)),de.endBatch(),ee.playDraw())}}class Xs{_movement=null;_draw=null;_manipulation=null;_clipboard=null;_persistence=null;_project=null;_selection=null;_color=null;get movement(){return this._movement||(this._movement=new Ts),this._movement}get draw(){return this._draw||(this._draw=new Vs),this._draw}get manipulation(){return this._manipulation||(this._manipulation=new Hs),this._manipulation}get clipboard(){return this._clipboard||(this._clipboard=new zs),this._clipboard}get persistence(){return this._persistence||(this._persistence=new Ys),this._persistence}get project(){return this._project||(this._project=new Ks),this._project}get selection(){return this._selection||(this._selection=new qs),this._selection}get color(){return this._color||(this._color=new Qs),this._color}moveCursor(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}jumpHome(){this.movement.jumpHome()}paint(){this.draw.draw()}erase(){this.draw.erase()}pickColor(){this.color.pickFromCanvas()}startSelection(){this.selection.begin(r.cursor.pos.x,r.cursor.pos.y)}updateSelection(){this.selection.update(r.cursor.pos.x,r.cursor.pos.y)}commitSelection(){this.selection.fillSelection()}clearCanvas(){this.manipulation.clearAll()}resizeCanvas(e,t){this.manipulation.resize(e,t)}flipCanvas(e){this.manipulation.flip(e)}rotateCanvas(){this.manipulation.rotate()}mergeLayerDown(){this.project.mergeLayerDown()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),r.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async createArtifact(e,t=10,a="transparent"){const{ExportEngine:s}=await Hr(async()=>{const{ExportEngine:f}=await import("./CH09Dg5C.js");return{ExportEngine:f}},__vite__mapDeps([0,1,2,3]),import.meta.url),{width:i,height:n,compositePixels:l}=r.canvas,c=r.studio.includePixelBorders,v=["webm","gif","mp4"].includes(e),h=r.project.frames.length<=1&&v?"png":e;if(h==="svg")if(r.project.frames.length>1){const f=r.project.frames.map(y=>y.compositePixels),x=r.project.frames.map(y=>y.duration),b=s.toAnimatedSVG(i,n,f,x,a,c),m=new Blob([b],{type:"image/svg+xml"});this.download(URL.createObjectURL(m),"rupa-image.svg")}else{const f=s.toSVG(i,n,l,a,c),x=new Blob([f],{type:"image/svg+xml"});this.download(URL.createObjectURL(x),"rupa-image.svg")}else if(h==="webm"||h==="mp4"){const f=r.project.frames.map(y=>y.compositePixels),x=r.project.frames.map(y=>y.duration),b=await s.toVideo(i,n,f,x,t,h,a,c),m=b.type.includes("mp4")?"mp4":"webm";this.download(URL.createObjectURL(b),`rupa-video.${m}`)}else if(h==="gif"){const f=r.project.frames.map(m=>m.compositePixels),x=r.project.frames.map(m=>m.duration),b=await s.toGIF(i,n,f,x,t,a,c);this.download(URL.createObjectURL(b),"rupa-animation.gif")}else{const f=await s.toRaster(i,n,l,t,h,a,c);this.download(f,`rupa-image.${h}`)}r.studio.showExportMenu=!1}download(e,t){const a=document.createElement("a");a.href=e,a.download=t.toLowerCase().replace(/\s+/g,"-"),a.click()}}const N=new Xs;class Ws{#e=L("KEYBOARD");get activeSource(){return o(this.#e)}set activeSource(e){A(this.#e,e,!0)}listeners=[];constructor(){}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}emit(e,t,a){this.activeSource=t;const s={intent:e,source:t,meta:a};this.listeners.forEach(i=>i(s))}mount(e,t){const a=i=>{if(!r.isAppReady)return;const n=i.target;if(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement||n.isContentEditable)return;at.updatePhysicalState(i,"down");const l=at.getIntent(i);l&&(i.preventDefault(),this.emit(l,"KEYBOARD"))},s=i=>{at.updatePhysicalState(i,"up")};if(t){const i=c=>{const v=c.pointerType==="pen"?"PEN":c.pointerType==="touch"?"TOUCH":"MOUSE";mt.handleStart(c,t),this.activeSource=v},n=c=>{mt.handleMove(c,t)},l=c=>{mt.handleEnd()};t.addEventListener("pointerdown",i),e.addEventListener("pointermove",n),e.addEventListener("pointerup",l)}return e.addEventListener("keydown",a),e.addEventListener("keyup",s),()=>{e.removeEventListener("keydown",a),e.removeEventListener("keyup",s)}}}const Ha=new Ws;class Zs{isPlaying=!1;nextNoteTime=0;timer=null;get ctx(){return Ma.ctx}scale=Ct.ambient.scale;chords=Ct.ambient.chords;currentChordIndex=0;toggle(){this.isPlaying?this.stop():this.start()}start(){this.isPlaying||(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||r.studio.isMuted||!r.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){const t=this.chords[this.currentChordIndex],s=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(s,e),this.pianoPluck(s*2,e,.02),Math.random()>.7&&this.pianoPluck(s*.5,e+.05,.03)}pianoPluck(e,t,a=.06){const{startMins:s,fullMins:i}=Ct.ambient.fade,n=r.usageMinutes;let l=0;n>=s&&n<i?l=(n-s)/(i-s):n>=i&&(l=1);const c=a*l*r.bgmVolume;if(c<.001)return;const v=this.ctx.createOscillator(),h=this.ctx.createGain(),f=this.ctx.createBiquadFilter();v.type=Math.random()>.5?"sine":"triangle",v.frequency.setValueAtTime(e,t),f.type="lowpass",f.frequency.setValueAtTime(1200,t),f.frequency.exponentialRampToValueAtTime(400,t+1.5),h.gain.setValueAtTime(0,t),h.gain.linearRampToValueAtTime(c,t+.02),h.gain.exponentialRampToValueAtTime(1e-4,t+2.5),v.connect(f),f.connect(h),h.connect(this.ctx.destination),v.start(t),v.stop(t+2.6)}}const Js=new Zs;class ei{interval=null;#e=L(0);get elapsedTime(){return o(this.#e)}set elapsedTime(e){A(this.#e,e,!0)}#t=q(()=>r.project.frames.reduce((e,t)=>e+t.duration,0));get totalDuration(){return o(this.#t)}set totalDuration(e){A(this.#t,e)}startPlayback(){if(!r.project.isPlaying){if(r.project.frames.length<=1){ee.playErase();return}r.project.isPlaying=!0,this.elapsedTime=0;for(let e=0;e<r.project.activeFrameIndex;e++)this.elapsedTime+=r.project.frames[e].duration;ee.playDraw(),this.tick()}}stopPlayback(){r.project.isPlaying=!1,this.interval&&(clearTimeout(this.interval),this.interval=null)}togglePlayback(){r.project.isPlaying?this.stopPlayback():this.startPlayback()}tick(){if(!r.project.isPlaying)return;const e=r.project.activeFrame,t=(r.project.activeFrameIndex+1)%r.project.frames.length;this.interval=setTimeout(()=>{r.project.activeFrameIndex=t,t===0?this.elapsedTime=0:this.elapsedTime+=e.duration,this.tick()},e.duration)}}const rr=new ei;class ti{#e=L(!0);get isEnabled(){return o(this.#e)}set isEnabled(e){A(this.#e,e,!0)}#t=L(!1);get screenShake(){return o(this.#t)}set screenShake(e){A(this.#t,e,!0)}#a=L(null);get flashColor(){return o(this.#a)}set flashColor(e){A(this.#a,e,!0)}emit(e){this.isEnabled&&(this.playAudio(e),this.triggerVisual(e),typeof navigator.vibrate=="function"&&this.triggerHaptic(e))}playAudio(e){switch(e){case"DRAW":ee.playDraw();break;case"ERASE":ee.playErase();break;case"MOVE":ee.playMove();break;case"STARTUP":ee.playStartup();break;case"READY":ee.playReady();break}}triggerVisual(e){e==="CLEAR_CANVAS"&&(this.screenShake=!0,setTimeout(()=>this.screenShake=!1,200)),e==="READY"&&(this.flashColor="rgba(211, 54, 130, 0.1)",setTimeout(()=>this.flashColor=null,500))}triggerHaptic(e){e==="DRAW"&&navigator.vibrate(5),e==="ERASE"&&navigator.vibrate(10)}}const pe=new ti;class ai{backupInterval=null;autoSaveTimer=null;unsubscribeInput=null;mount(e=null){this.backupInterval=setInterval(()=>N.persistence.backup(),600*1e3),r.studio.mount(),r.canvas.mount(),Js.start(),N.persistence.restoreLastSession(),this.unsubscribeInput=Ha.subscribe(a=>{this.handleIntent(a.intent)});const t=Ha.mount(window,e);return()=>{this.unsubscribeInput&&this.unsubscribeInput(),t(),clearInterval(this.backupInterval),this.autoSaveTimer&&clearTimeout(this.autoSaveTimer)}}handleIntent(e){if(Ma.resume(),r.cursor.resetInactivityTimer(),this.resetAutoSaveTimer(),at.isCtrlActive&&at.isAltActive&&["MOVE_UP","MOVE_DOWN","MOVE_LEFT","MOVE_RIGHT"].includes(e)){const t=e==="MOVE_LEFT"?-1:e==="MOVE_RIGHT"?1:0,a=e==="MOVE_UP"?-1:e==="MOVE_DOWN"?1:0;r.studio.underlayOffset.x+=t,r.studio.underlayOffset.y+=a;return}switch(e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"JUMP_HOME":return N.jumpHome();case"GOTO":return r.showGoTo=!0;case"RESET_PAN":return r.studio.resetPan(),pe.emit("READY");case"PAINT":if(r.selection.isActive)return N.commitSelection();if(r.studio.activeTool!=="BRUSH"){N.draw.commitShape();return}return N.draw.draw();case"ERASE":return N.draw.erase();case"FLOOD_FILL":return N.color.floodFill();case"BIND_VERTEX":return N.selection.addVertex(r.cursor.pos.x,r.cursor.pos.y);case"SEAL_BINDING":if(r.selection.vertices.length>=3)return N.selection.sealBinding();if(r.selection.isActive)return N.commitSelection();if(r.studio.activeTool!=="BRUSH"){N.draw.commitShape();return}return N.draw.draw();case"PICK_COLOR":return N.color.pickFromCanvas();case"COPY":return N.clipboard.copy();case"CUT":return N.clipboard.cut();case"PASTE":return N.clipboard.paste();case"RECOLOR":return N.manipulation.bleach();case"UNDO":return r.undo();case"REDO":return r.redo();case"SAVE":return r.showPersistenceMenu=!0;case"OPEN":return N.persistence.load();case"OPEN_MENU":return r.showCommandPalette=!r.showCommandPalette;case"OPEN_SETTINGS":return r.showCanvasSettings=!r.showCanvasSettings;case"ESCAPE":return r.handleEscape();case"OPEN_PALETTE":return r.showColorPicker=!r.showColorPicker;case"OPEN_AUDIO":return r.showAudioSettings=!r.showAudioSettings;case"OPEN_EXPORT":return r.showExportMenu=!0;case"OPEN_HELP":return r.showGuideMenu=!0;case"OPEN_MANUAL":return r.showGuideBook=!0;case"PLAY_PAUSE":return rr.togglePlayback();case"TOGGLE_GHOST_LAYERS":return r.showGhostLayers=!r.showGhostLayers;case"ZOOM_IN":return r.studio.setZoom(.1);case"ZOOM_OUT":return r.studio.setZoom(-.1);case"RESET_ZOOM":return r.studio.resetZoom();case"RESET_VIEWPORT":return r.studio.resetZoom(),r.studio.resetPan(),pe.emit("READY");case"CLEAR_CANVAS":return N.manipulation.clearAll();case"TOGGLE_MUTE":return r.studio.toggleMute();case"TOGGLE_MINIMAP":return r.studio.showMinimap=!r.studio.showMinimap,pe.emit("READY");case"SELECT_SAME":return N.selection.spiritPick();case"FLIP_H":return N.manipulation.flip("horizontal");case"FLIP_V":return N.manipulation.flip("vertical");case"ROTATE":return N.manipulation.rotate();case"TAB_TIMELINE":return r.studio.projectActiveTab="frames",pe.emit("READY");case"TAB_LAYERS":return r.studio.projectActiveTab="layers",pe.emit("READY");case"NEW_ITEM":return r.studio.projectActiveTab==="frames"?N.project.addFrame():N.project.addLayer();case"NEW_LAYER_GROUP":return N.project.addGroup();case"DUPLICATE_ITEM":return r.studio.projectActiveTab==="frames"?N.project.duplicateFrame(r.project.activeFrameIndex):N.project.duplicateLayer(r.project.activeFrame.activeLayerIndex);case"DELETE_ITEM":return r.studio.projectActiveTab==="frames"?N.project.removeFrame(r.project.activeFrameIndex):N.project.removeLayer(r.project.activeFrame.activeLayerIndex);case"TOGGLE_LAYER_LOCK":return N.project.toggleLock();case"TOGGLE_LAYER_VISIBILITY":return N.project.toggleVisibility();case"MOVE_ITEM_UP":if(r.studio.projectActiveTab==="frames"){const s=r.project.activeFrameIndex;s<r.project.frames.length-1&&N.project.reorderFrame(s,s+1)}else N.project.moveLayerUp();return;case"MOVE_ITEM_DOWN":if(r.studio.projectActiveTab==="frames"){const s=r.project.activeFrameIndex;s>0&&N.project.reorderFrame(s,s-1)}else N.project.moveLayerDown();return;case"MOVE_ITEM_TOP":r.studio.projectActiveTab==="frames"?N.project.reorderFrame(r.project.activeFrameIndex,r.project.frames.length-1):N.project.moveLayerToTop();return;case"MOVE_ITEM_BOTTOM":r.studio.projectActiveTab==="frames"?N.project.reorderFrame(r.project.activeFrameIndex,0):N.project.moveLayerToBottom();return;case"MERGE_LAYERS":return N.project.mergeLayerDown();case"BRUSH_SIZE_INC":return r.studio.brushSize=Math.min(100,r.studio.brushSize+1),pe.emit("READY");case"BRUSH_SIZE_DEC":return r.studio.brushSize=Math.max(1,r.studio.brushSize-1),pe.emit("READY");case"TOGGLE_PATTERN_BRUSH":if(r.studio.isPatternBrushActive)r.studio.isPatternBrushActive=!1;else if(r.project.clipboard){const s=r.project.clipboard,i=new Uint32Array(s.data.length);for(let n=0;n<s.data.length;n++)i[n]=s.data[n];r.studio.patternBrushData={width:s.width,height:s.height,data:i},r.studio.isPatternBrushActive=!0}return pe.emit("READY");case"TOGGLE_BRUSH_SHAPE":return r.studio.brushShape=r.studio.brushShape==="SQUARE"?"CIRCLE":"SQUARE",pe.emit("READY");case"TOGGLE_HAND_TOOL":return r.studio.isHandToolActive=!r.studio.isHandToolActive,pe.emit("READY");case"CYCLE_SYMMETRY":const t=["OFF","HORIZONTAL","VERTICAL","QUADRANT"],a=t.indexOf(r.studio.symmetryMode);return r.studio.symmetryMode=t[(a+1)%t.length],pe.emit("READY");case"TOGGLE_TILING":return r.studio.isTilingEnabled=!r.studio.isTilingEnabled,pe.emit("READY");case"TOGGLE_AIRBRUSH":return r.studio.isAirbrushActive=!r.studio.isAirbrushActive,r.studio.show(r.studio.isAirbrushActive?"Mist Active":"Mist Off"),pe.emit("READY");case"TOGGLE_ALPHA_LOCK":return r.studio.isAlphaLocked=!r.studio.isAlphaLocked,pe.emit("READY");case"TOGGLE_PIXEL_PERFECT":return r.studio.isPixelPerfect=!r.studio.isPixelPerfect,pe.emit("READY");case"TOGGLE_SHADE_LIGHTEN":return r.studio.isShadingLighten=!r.studio.isShadingLighten,r.studio.isShadingLighten&&(r.studio.isShadingDarken=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingLighten?"Light Roast Active":"Light Roast Off"),pe.emit("READY");case"TOGGLE_SHADE_DARKEN":return r.studio.isShadingDarken=!r.studio.isShadingDarken,r.studio.isShadingDarken&&(r.studio.isShadingLighten=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingDarken?"Dark Roast Active":"Dark Roast Off"),pe.emit("READY");case"TOGGLE_SHADE_DITHER":return r.studio.isShadingDither=!r.studio.isShadingDither,r.studio.isShadingDither&&(r.studio.isShadingLighten=!1,r.studio.isShadingDarken=!1),r.studio.show(r.studio.isShadingDither?"Texture Active":"Texture Off"),pe.emit("READY");case"SHADE_LIGHTEN":return r.studio.isShadingLighten=!r.studio.isShadingLighten,r.studio.isShadingLighten&&(r.studio.isShadingDarken=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingLighten?"Light Roast Active":"Light Roast Off"),pe.emit("READY");case"SHADE_DARKEN":return r.studio.isShadingDarken=!r.studio.isShadingDarken,r.studio.isShadingDarken&&(r.studio.isShadingLighten=!1,r.studio.isShadingDither=!1),r.studio.show(r.studio.isShadingDarken?"Dark Roast Active":"Dark Roast Off"),pe.emit("READY");case"SHADE_DITHER":return r.studio.isShadingDither=!r.studio.isShadingDither,r.studio.isShadingDither&&(r.studio.isShadingLighten=!1,r.studio.isShadingDarken=!1),r.studio.show(r.studio.isShadingDither?"Texture Active":"Texture Off"),pe.emit("READY");case"TOGGLE_COLOR_LOCK":if(r.studio.isColorLocked)r.studio.isColorLocked=!1,r.studio.colorLockSource=null;else{r.studio.isColorLocked=!0;const s=r.canvas.getColor(r.cursor.pos.x,r.cursor.pos.y);r.studio.colorLockSource=se.uint32ToHex(s)}return pe.emit("READY");case"TOGGLE_UNDERLAY":return r.studio.isUnderlayVisible=!r.studio.isUnderlayVisible,pe.emit("READY");case"OPEN_UNDERLAY_MENU":return r.studio.showUnderlayMenu=!r.studio.showUnderlayMenu,pe.emit("READY");case"TOOL_RECTANGLE":return r.studio.activeTool="RECTANGLE",r.studio.shapeAnchor={...r.cursor.pos},pe.emit("READY");case"TOOL_ELLIPSE":return r.studio.activeTool="ELLIPSE",r.studio.shapeAnchor={...r.cursor.pos},pe.emit("READY");case"TOOL_BRUSH":return r.studio.activeTool="BRUSH",pe.emit("READY");case"TOOL_ERASER":return r.studio.activeTool="ERASER",pe.emit("READY");case"TOOL_SELECT":return r.studio.activeTool="SELECT",pe.emit("READY");case"TOOL_POLYGON":return r.studio.activeTool="POLYGON",r.studio.shapeAnchor={...r.cursor.pos},pe.emit("READY");case"POLY_SIDES_INC":return r.studio.polygonSides=Math.min(12,r.studio.polygonSides+1),r.studio.show(`${r.studio.polygonSides} Facets`),pe.emit("READY");case"POLY_SIDES_DEC":return r.studio.polygonSides=Math.max(3,r.studio.polygonSides-1),r.studio.show(`${r.studio.polygonSides} Facets`),pe.emit("READY");case"POLY_INDENT_INC":return r.studio.polygonIndentation=Math.min(100,r.studio.polygonIndentation+10),r.studio.show(`${r.studio.polygonIndentation}% Steeping`),pe.emit("READY");case"POLY_INDENT_DEC":return r.studio.polygonIndentation=Math.max(0,r.studio.polygonIndentation-10),r.studio.show(`${r.studio.polygonIndentation}% Steeping`),pe.emit("READY");case"TOOL_GRADIENT":return r.studio.activeTool==="GRADIENT"?(r.studio.activeTool="BRUSH",r.studio.shapeAnchor=null,r.studio.gradientStartColor=null):(r.studio.activeTool="GRADIENT",r.studio.shapeAnchor={...r.cursor.pos},r.studio.gradientStartColor=r.paletteState.activeColor),pe.emit("READY");case"TOOL_TRANSFORM":return r.selection.isActive?(r.studio.isTransforming=!r.studio.isTransforming,pe.emit("READY")):void 0;default:if(e.startsWith("SET_SIDES_")){const s=parseInt(e.split("_")[2]);return r.studio.polygonSides=s,r.studio.show(`${s} Facets`),pe.emit("READY")}if(e.startsWith("SELECT_COLOR_")){const s=parseInt(e.split("_")[2]);return N.color.select(s===0?9:s-1)}}}executeMove(e,t){if(r.studio.isTransforming&&r.selection.isActive){N.selection.nudge(e,t);return}if(N.movement.move(e,t)){const a=Re.current.type;a==="SELECT"&&(r.selection.isActive||N.startSelection(),N.updateSelection()),a==="PAINT"&&N.draw.draw(),a==="ERASE"&&N.draw.erase()}}resetAutoSaveTimer(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{N.persistence.autoSaveSession()},1e4)}}const bt=new ai;class ri{isPointerDown=!1;#e=L(!1);get isPointerDownActive(){return o(this.#e)}set isPointerDownActive(e){A(this.#e,e,!0)}lastPosition={x:-1,y:-1};lastScreenPos=null;buttonType=null;holdTimer=null;isSnapped=!1;rafId=null;#t=L(!1);get isSnappedState(){return o(this.#t)}set isSnappedState(e){A(this.#t,e,!0)}mapToGrid(e,t,a){const s=a.getBoundingClientRect();return Ze.mapScreenToGrid(e,t,s,r.canvas.width,r.canvas.height)}handleStart(e,t){bt.resetAutoSaveTimer(),this.isPointerDown=!0,this.isPointerDownActive=!0,this.isSnapped=!1,this.buttonType=e.button===2?"secondary":"primary",this.lastScreenPos={x:e.clientX,y:e.clientY};const a=this.mapToGrid(e.clientX,e.clientY,t);this.lastPosition={x:a.x,y:a.y};const s=Re.current.type;if(s==="PAN")return;r.cursor.pos={x:Math.floor(a.x),y:Math.floor(a.y)};const i=r.studio.activeTool;if(this.buttonType==="primary"&&i==="SELECT"){N.selection.begin(r.cursor.pos.x,r.cursor.pos.y);return}if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(i)){r.studio.shapeAnchor={...r.cursor.pos},i==="GRADIENT"&&(r.studio.gradientStartColor=r.paletteState.activeColor);return}const n=r.studio.isShadingLighten||r.studio.isShadingDarken||r.studio.isShadingDither;this.buttonType==="primary"&&s!=="SELECT"&&(n?N.draw.draw(a.x,a.y):(N.draw.beginStroke(a.x,a.y),this.startHoldTimer()))}handleMove(e,t){this.isPointerDown&&(bt.resetAutoSaveTimer(),!this.rafId&&(this.rafId=requestAnimationFrame(()=>{const a=this.mapToGrid(e.clientX,e.clientY,t),s=Re.current.type,i=r.studio.activeTool;if(s==="PAN"){const l=Ze.calculatePanDelta(e.clientX,e.clientY,this.lastScreenPos?.x||e.clientX,this.lastScreenPos?.y||e.clientY);r.studio.panOffset.x+=l.dx,r.studio.panOffset.y+=l.dy,this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null;return}if(r.cursor.pos={x:Math.floor(a.x),y:Math.floor(a.y)},this.buttonType==="primary"&&i==="SELECT"){N.selection.update(r.cursor.pos.x,r.cursor.pos.y),this.rafId=null;return}const n=r.studio.isShadingLighten||r.studio.isShadingDarken||r.studio.isShadingDither;if(this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(i)){this.lastPosition={x:a.x,y:a.y},this.rafId=null;return}this.buttonType==="primary"&&s!=="SELECT"&&(n?N.draw.draw(a.x,a.y):this.isSnapped||(N.draw.continueStroke(a.x,a.y,this.lastPosition.x,this.lastPosition.y),this.resetHoldTimer())),this.lastPosition={x:a.x,y:a.y},this.lastScreenPos={x:e.clientX,y:e.clientY},this.rafId=null})))}handleEnd(){if(!this.isPointerDown)return;this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);const e=Re.current.type,t=r.studio.activeTool;this.buttonType==="primary"&&["RECTANGLE","ELLIPSE","POLYGON","GRADIENT"].includes(t)?N.draw.commitShape():this.buttonType==="primary"&&t==="SELECT"?N.selection.commit():this.buttonType==="primary"&&e!=="SELECT"?N.draw.endStroke():r.canvas.clearBuffer(),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1}cancel(){this.isPointerDown=!1,this.isPointerDownActive=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1,N.draw.cancelStroke()}startHoldTimer(){this.clearHoldTimer(),this.holdTimer=setTimeout(()=>{this.isPointerDown&&this.triggerSnap()},600)}resetHoldTimer(){this.isSnapped||this.startHoldTimer()}clearHoldTimer(){this.holdTimer&&clearTimeout(this.holdTimer),this.holdTimer=null}triggerSnap(){this.isSnapped=!0,this.isSnappedState=!0,N.draw.snapCurrentStroke()}}const mt=new ri;class si{version="0.8.0";project=new ms;canvas=new us(this.project);cursor=new vs;paletteState=new fs;studio=new bs;selection=new ys;get pixels(){return this.canvas.pixels}set pixels(e){this.canvas.pixels=e}get canvasWidth(){return this.canvas.width}set canvasWidth(e){this.canvas.width=e}get canvasHeight(){return this.canvas.height}set canvasHeight(e){this.canvas.height=e}get activeColor(){return this.paletteState.activeColor}set activeColor(e){this.paletteState.activeColor=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get usageMinutes(){return this.studio.usageMinutes}get backgroundColor(){return this.studio.backgroundColor}set backgroundColor(e){this.studio.backgroundColor=e}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isCursorVisible(){return this.cursor.isVisible}set isCursorVisible(e){this.cursor.isVisible=e}get showColorPicker(){return this.studio.showColorPicker}set showColorPicker(e){this.studio.showColorPicker=e}get showAudioSettings(){return this.studio.showAudioSettings}set showAudioSettings(e){this.studio.showAudioSettings=e}get showCommandPalette(){return this.studio.showCommandPalette}set showCommandPalette(e){this.studio.showCommandPalette=e}get showGuideBook(){return this.studio.showGuideBook}set showGuideBook(e){this.studio.showGuideBook=e}get showGuideMenu(){return this.studio.showGuideMenu}set showGuideMenu(e){this.studio.showGuideMenu=e}get showExportMenu(){return this.studio.showExportMenu}set showExportMenu(e){this.studio.showExportMenu=e}get showCanvasSettings(){return this.studio.showCanvasSettings}set showCanvasSettings(e){this.studio.showCanvasSettings=e}get showPersistenceMenu(){return this.studio.showPersistenceMenu}set showPersistenceMenu(e){this.studio.showPersistenceMenu=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get showGhostLayers(){return this.studio.showGhostLayers}set showGhostLayers(e){this.studio.showGhostLayers=e}#e=q(()=>({x:Ze.toCartesianLabel(this.cursor.pos.x,this.canvas.width),y:Ze.toCartesianLabel(this.cursor.pos.y,this.canvas.height,!0)}));get displayCoords(){return o(this.#e)}set displayCoords(e){A(this.#e,e)}#t=q(()=>Ze.calculateCameraTransform(this.studio.zoomLevel,this.studio.panOffset,this.cursor.pos,this.canvas.width,this.canvas.height));get cameraTransform(){return o(this.#t)}set cameraTransform(e){A(this.#t,e)}#a=q(()=>{const e=new Set;return this.canvas.compositePixels.forEach(t=>{const a=se.uint32ToHex(t);a!==null&&e.add(a)}),Array.from(e)});get usedColors(){return o(this.#a)}set usedColors(e){A(this.#a,e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}toggleMute(){this.studio.toggleMute()}handleEscape(){if(this.studio.handleEscape())return!0;let t=!1;this.project.selectedFrameIndices.size>1&&(this.project.selectedFrameIndices=new Set([this.project.activeFrameIndex]),t=!0);const a=this.project.activeFrame;return a.selectedLayerIndices.size>1&&(a.selectedLayerIndices=new Set([a.activeLayerIndex]),t=!0),t?!0:mt.isPointerDownActive?(mt.cancel(),!0):this.selection.isActive?this.studio.isTransforming?(this.studio.isTransforming=!1,!0):(this.selection.clear(),!0):this.studio.activeTool!=="BRUSH"?(this.studio.activeTool="BRUSH",this.studio.shapeAnchor=null,!0):this.studio.isShadingLighten||this.studio.isShadingDarken||this.studio.isShadingDither?(this.studio.isShadingLighten=!1,this.studio.isShadingDarken=!1,this.studio.isShadingDither=!1,this.studio.show("Shading Reset"),!0):!1}undo(){const e=de.undo();if(e)if("isStructural"in e)e.undo(),ee.playErase();else if(Array.isArray(e)){const t=new Uint32Array(this.canvas.pixels);for(let a=e.length-1;a>=0;a--){const s=e[a];t[s.index]=se.hexToUint32(s.oldColor)}this.canvas.pixels=t,this.canvas.triggerPulse(),ee.playErase()}else{const t=new Uint32Array(this.canvas.pixels);t[e.index]=se.hexToUint32(e.oldColor),this.canvas.pixels=t,this.canvas.triggerPulse(),ee.playErase()}this.cursor.resetInactivityTimer()}redo(){const e=de.redo();if(e)if("isStructural"in e)e.redo(),ee.playDraw();else if(Array.isArray(e)){const t=new Uint32Array(this.canvas.pixels);for(const a of e)t[a.index]=se.hexToUint32(a.newColor);this.canvas.pixels=t,this.canvas.triggerPulse(),ee.playDraw()}else{const t=new Uint32Array(this.canvas.pixels);t[e.index]=se.hexToUint32(e.newColor),this.canvas.pixels=t,this.canvas.triggerPulse(),ee.playDraw()}this.cursor.resetInactivityTimer()}clearCanvas(){N.clearCanvas()}pickColor(){N.pickColor()}loadProject(){N.load()}copySelection(){N.copy()}cutSelection(){N.cut()}pasteSelection(){N.paste()}flipCanvas(e){N.flipCanvas(e)}rotateCanvas(){N.rotateCanvas()}}const r=new si;var ii=O('<div class="h-3 w-px bg-brand/20" aria-hidden="true"></div>'),oi=O("<div><h1>Rupa</h1> <!> <p>The Barista's Café</p></div>");function sr(p,e){let t=Le(e,"size",3,"md");const a={sm:{h1:"text-2xl",p:"text-[9px]",gap:"gap-3"},md:{h1:"text-4xl",p:"text-[11px]",gap:"gap-2"},lg:{h1:"text-7xl",p:"text-[14px]",gap:"gap-4"}};let s=q(()=>a[t()]),i=q(()=>t()==="sm"?"flex-row items-center":"flex-col items-center");var n=oi(),l=u(n),c=g(l,2);{var v=f=>{var x=ii();S(f,x)};V(c,f=>{t()==="sm"&&f(v)})}var h=g(c,2);d(n),j(()=>{re(n,1,`flex ${o(i)??""} ${o(s).gap??""} justify-center text-center select-none`),re(l,1,`font-tiny5 leading-none text-brand ${o(s).h1??""} tracking-tighter`),re(h,1,`font-serif font-bold tracking-[0.4em] text-charcoal/40 uppercase ${o(s).p??""}`)}),S(p,n)}var ut=na(()=>r),ni=O('<nav class="flex items-center gap-2" aria-label="Editor Tools"><div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">📖</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true">🍶</span> <span class="hidden xl:inline"> </span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">🧼</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true"> </span> <span class="hidden xl:inline"> </span></button></div> <div class="mx-2 h-4 w-px bg-charcoal/10" aria-hidden="true"></div> <div class="flex gap-1.5" role="group"><button class="editor-tool-btn"><span aria-hidden="true">📜</span> <span class="hidden xl:inline"> </span></button> <button class="editor-tool-btn"><span aria-hidden="true">⌨️</span> <span class="hidden xl:inline"> </span></button></div></nav>');function li(p,e){ie(e,!1),je();var t=ni(),a=u(t),s=u(a);s.__click=()=>ut(ut().showCommandPalette=!0);var i=g(u(s),2),n=u(i,!0);d(i),d(s);var l=g(s,2);l.__click=()=>ut(ut().showExportMenu=!0);var c=g(u(l),2),v=u(c,!0);d(c),d(l),d(a);var h=g(a,4),f=u(h);f.__click=()=>ut().clearCanvas();var x=g(u(f),2),b=u(x,!0);d(x),d(f);var m=g(f,2);m.__click=()=>ut(ut().showAudioSettings=!0);var y=u(m),_=u(y,!0);d(y);var k=g(y,2),I=u(k,!0);d(k),d(m),d(h);var F=g(h,4),B=u(F);B.__click=()=>ut(ut().showGuideBook=!0);var D=g(u(B),2),U=u(D,!0);d(D),d(B);var P=g(B,2);P.__click=()=>ut(ut().showGuideMenu=!0);var R=g(u(P),2),z=u(R,!0);d(R),d(P),d(F),d(t),j((Y,H,K,te,J,W,le,me,be,we,Ce,He)=>{M(s,"title",`${Y??""} (Ctrl+K)`),T(n,H),M(l,"title",`${K??""} (Ctrl+E)`),T(v,te),M(f,"title",`${J??""} (Ctrl+L)`),T(b,W),M(m,"title",`${le??""} (Ctrl+Shift+A)`),T(_,ut().isMuted?"🔇":"🔊"),T(I,me),M(B,"title",`${be??""} (F1)`),T(U,we),M(P,"title",`${Ce??""} (F2)`),T(z,He)},[()=>w({key:"hud.menu.catalog_title"}),()=>w({key:"hud.menu.catalog_title"}),()=>w({key:"export.title"}),()=>w({key:"export.title"}),()=>w({key:"hud.actions.clear_canvas"}),()=>w({key:"hud.actions.clear_canvas"}),()=>w({key:"hud.audio.title"}),()=>w({key:"hud.audio.title"}),()=>w({key:"manual.title"}),()=>w({key:"manual.title"}),()=>w({key:"shortcuts.title"}),()=>w({key:"shortcuts.title"})]),S(p,t),oe()}Fe(["click"]);const ci=p=>p;function Oa(p){const e=p-1;return e*e*e+1}function za(p){const e=typeof p=="string"&&p.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[p,"px"]}function Ae(p,{delay:e=0,duration:t=400,easing:a=ci}={}){const s=+getComputedStyle(p).opacity;return{delay:e,duration:t,easing:a,css:i=>`opacity: ${i*s}`}}function Ra(p,{delay:e=0,duration:t=400,easing:a=Oa,x:s=0,y:i=0,opacity:n=0}={}){const l=getComputedStyle(p),c=+l.opacity,v=l.transform==="none"?"":l.transform,h=c*(1-n),[f,x]=za(s),[b,m]=za(i);return{delay:e,duration:t,easing:a,css:(y,_)=>`
			transform: ${v} translate(${(1-y)*f}${x}, ${(1-y)*b}${m});
			opacity: ${c-h*_}`}}function di(p,{delay:e=0,duration:t=400,easing:a=Oa,axis:s="y"}={}){const i=getComputedStyle(p),n=+i.opacity,l=s==="y"?"height":"width",c=parseFloat(i[l]),v=s==="y"?["top","bottom"]:["left","right"],h=v.map(k=>`${k[0].toUpperCase()}${k.slice(1)}`),f=parseFloat(i[`padding${h[0]}`]),x=parseFloat(i[`padding${h[1]}`]),b=parseFloat(i[`margin${h[0]}`]),m=parseFloat(i[`margin${h[1]}`]),y=parseFloat(i[`border${h[0]}Width`]),_=parseFloat(i[`border${h[1]}Width`]);return{delay:e,duration:t,easing:a,css:k=>`overflow: hidden;opacity: ${Math.min(k*20,1)*n};${l}: ${k*c}px;padding-${v[0]}: ${k*f}px;padding-${v[1]}: ${k*x}px;margin-${v[0]}: ${k*b}px;margin-${v[1]}: ${k*m}px;border-${v[0]}-width: ${k*y}px;border-${v[1]}-width: ${k*_}px;min-${l}: 0`}}function Rt(p,{delay:e=0,duration:t=400,easing:a=Oa,start:s=0,opacity:i=0}={}){const n=getComputedStyle(p),l=+n.opacity,c=n.transform==="none"?"":n.transform,v=1-s,h=l*(1-i);return{delay:e,duration:t,easing:a,css:(f,x)=>`
			transform: ${c} scale(${1-v*x});
			opacity: ${l-h*x}
		`}}var ui=O('<div class="flex items-center gap-2 rounded-full border border-charcoal/10 bg-foam-white/50 px-3 py-1"><div class="h-1.5 w-1.5 rounded-full bg-brand/40" aria-hidden="true"></div> <span class="font-mono text-[9px] font-bold tracking-widest text-charcoal/40 uppercase"> </span></div>'),vi=O('<div class="flex items-center gap-4 px-4"><!></div>');function hi(p,e){ie(e,!1),je();var t=vi(),a=u(t);{var s=i=>{var n=ui(),l=g(u(n),2),c=u(l,!0);d(l),d(n),j(v=>T(c,v),[()=>w({key:"project.saved",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}})]),ce(3,n,()=>Ae),S(i,n)};V(a,i=>{r.project.lastSaved&&i(s)})}d(t),S(p,t),oe()}var pi=O('<header class="hud-panel flex h-14 w-full items-center justify-between px-8 py-2 select-none svelte-zd3ruq"><div class="flex items-center gap-12"><!> <div class="h-6 w-px bg-charcoal/10" aria-hidden="true"></div> <!></div> <!></header>');function fi(p){var e=pi(),t=u(e),a=u(t);sr(a,{size:"sm"});var s=g(a,4);li(s,{}),d(t);var i=g(t,2);hi(i,{}),d(e),S(p,e)}var gi=O('<div class="mb-2 mr-2 flex flex-col gap-2 rounded-b-lg border-x border-b border-charcoal/5 bg-charcoal/[0.02] p-3 pt-1"><div class="flex items-center justify-between gap-4"><span class="font-serif text-[10px] font-bold text-charcoal/40 uppercase">Opacity</span> <div class="flex flex-1 items-center gap-2"><input type="range" min="0" max="1" step="0.01" class="editor-slider h-1 flex-1"/> <input type="number" min="0" max="100" class="w-10 rounded border border-charcoal/10 bg-white p-0.5 text-center font-mono text-[10px]"/> <span class="font-mono text-[8px] opacity-30">%</span></div></div></div>');function Ya(p,e){ie(e,!0);let t=Le(e,"target",7),a=Le(e,"margin",3,"0px");var s=gi(),i=u(s),n=g(u(i),2),l=u(n);Ne(l);var c=g(l,2);Ne(c),c.__input=v=>t().opacity=Math.max(0,Math.min(100,Number(v.currentTarget.value)))/100,Pt(2),d(n),d(i),d(s),j(v=>{fe(s,`margin-left: ${a()??""};`),cs(c,v)},[()=>Math.round(t().opacity*100)]),Ve(l,()=>t().opacity,v=>t().opacity=v),ce(3,s,()=>Ae,()=>({duration:100})),S(p,s),oe()}Fe(["input"]);var xi=O('<input type="text" class="w-full bg-brand/5 font-serif text-sm font-medium text-brand ring-1 ring-brand/30 outline-none"/>'),bi=O('<span class="truncate font-serif text-sm font-medium text-charcoal"> </span>'),mi=O('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">🗑️</button>'),yi=O('<div role="button" tabindex="0" draggable="true"><button class="flex flex-1 items-center gap-3 overflow-hidden py-2 pl-1 text-left"><span class="font-mono text-[10px] opacity-30" aria-hidden="true"></span> <!></button> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Cup Properties"> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">📋</button> <!></div></div> <!>',1),_i=O('<div class="flex flex-col gap-1" role="list"></div>'),Ai=O('<button class="text-[10px] opacity-40 hover:opacity-100"> </button>'),wi=O('<input type="text" class="w-full bg-brand/5 font-serif text-sm font-medium text-brand ring-1 ring-brand/30 outline-none"/>'),ki=O('<div role="button" tabindex="0" draggable="true"><div class="flex flex-1 items-center gap-2 overflow-hidden"><!> <button> </button> <button><!></button></div> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Infusion Properties"> </button> <button> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand">🗑️</button></div></div> <!>',1),Ei=O('<div class="flex flex-col gap-1" role="list"></div>'),Si=O('<button class="flex items-center gap-1 font-serif text-[9px] font-bold tracking-[0.1em] text-charcoal/40 uppercase hover:text-charcoal/80"><span aria-hidden="true">📁</span> Group</button>'),Ti=O('<div class="flex h-full w-full flex-col overflow-hidden bg-transparent" role="region" aria-label="Project Explorer"><div class="flex border-b border-charcoal/10 bg-charcoal/5 p-1" role="tablist"><button role="tab"><span aria-hidden="true">🖼️</span> </button> <button role="tab"><span aria-hidden="true">🧵</span> </button></div> <div class="custom-scrollbar flex-1 overflow-y-auto p-2" role="presentation"><!></div> <div class="flex items-center justify-between border-t border-charcoal/5 bg-charcoal/5 px-4 py-2"><div class="flex items-center gap-3"><button class="flex items-center gap-1 font-serif text-[9px] font-bold tracking-[0.1em] text-charcoal/40 uppercase hover:text-charcoal/80"><span aria-hidden="true">＋</span> </button> <!></div> <span class="font-mono text-[8px] font-bold text-charcoal/20 uppercase"> </span></div></div>');function Li(p,e){ie(e,!0);let t=L(null),a=L(null),s=L(null),i=L(""),n=L(null),l=L(null);function c(E,C,$){$.stopPropagation(),o(n)===E&&o(l)===C?(A(n,null),A(l,null)):(A(n,E,!0),A(l,C,!0))}function v(E,C){A(s,E,!0),A(i,C,!0)}function h(E){E.focus(),E.select()}function f(){o(s)!==null&&(r.studio.projectActiveTab==="layers"?r.project.activeFrame.layers[o(s)].name=o(i):r.project.frames[o(s)].name=o(i),A(s,null))}function x(E){A(t,E,!0)}function b(E,C){E.preventDefault(),A(a,C,!0)}function m(E,C){E.preventDefault(),o(t)!==null&&(r.studio.projectActiveTab==="layers"?N.project.reorderLayer(o(t),C):N.project.reorderFrame(o(t),C)),A(t,null),A(a,null)}function y(){A(t,null),A(a,null)}function _(){const E=r.project;E.selectedFrameIndices=new Set([E.activeFrameIndex]);const C=E.activeFrame;C.selectedLayerIndices=new Set([C.activeLayerIndex])}function k(E,C){const $=r.project;if(C.ctrlKey||C.metaKey)$.selectedFrameIndices.has(E)&&$.selectedFrameIndices.size>1?$.selectedFrameIndices.delete(E):$.selectedFrameIndices.add(E);else if(C.shiftKey){const ae=Math.min($.activeFrameIndex,E),Q=Math.max($.activeFrameIndex,E),ve=new Set;for(let X=ae;X<=Q;X++)ve.add(X);$.selectedFrameIndices=ve}else $.selectedFrameIndices=new Set([E]);$.activeFrameIndex=E}function I(E,C){const $=r.project.activeFrame;if(C.ctrlKey||C.metaKey)$.selectedLayerIndices.has(E)&&$.selectedLayerIndices.size>1?$.selectedLayerIndices.delete(E):$.selectedLayerIndices.add(E);else if(C.shiftKey){const ae=Math.min($.activeLayerIndex,E),Q=Math.max($.activeLayerIndex,E),ve=new Set;for(let X=ae;X<=Q;X++)ve.add(X);$.selectedLayerIndices=ve}else $.selectedLayerIndices=new Set([E]);$.activeLayerIndex=E}function F(E,C){E.preventDefault();const $=r.project;$.selectedFrameIndices.has(C)||($.selectedFrameIndices=new Set([C]),$.activeFrameIndex=C);const ae=$.selectedFrameIndices.size>1;r.studio.contextMenu={x:E.clientX,y:E.clientY,items:[{label:ae?`Duplicate ${$.selectedFrameIndices.size} Cups`:w({key:"hud.actions.duplicate"}),icon:"📋",action:()=>{N.project.duplicateFrame(C)}},{label:ae?`Spill ${$.selectedFrameIndices.size} Cups`:w({key:"hud.actions.delete"}),icon:"🗑️",danger:!0,disabled:$.frames.length<=$.selectedFrameIndices.size,action:()=>{Array.from($.selectedFrameIndices).sort((ve,X)=>X-ve).forEach(ve=>N.project.removeFrame(ve)),$.selectedFrameIndices=new Set([$.activeFrameIndex])}}]}}function B(E,C){const $=r.project.activeFrame;E.preventDefault(),$.selectedLayerIndices.has(C)||($.selectedLayerIndices=new Set([C]),$.activeLayerIndex=C);const ae=$.selectedLayerIndices.size>1,Q=$.layers[C];r.studio.contextMenu={x:E.clientX,y:E.clientY,items:[{label:ae?"Group Selected":"Group",icon:"📁",action:()=>{const ve=N.project.addGroup();ae?Array.from($.selectedLayerIndices).forEach(xe=>{const ke=$.layers[xe];ke!==ve&&(ke.parentId=ve.id)}):Q.parentId=ve.id}},{label:ae?`Duplicate ${$.selectedLayerIndices.size} Infusions`:w({key:"hud.actions.duplicate"}),icon:"📋",disabled:ae,action:()=>N.project.duplicateLayer(C)},{label:ae?"Show/Hide Selected":Q.isVisible?"Hide Infusion":"Show Infusion",icon:Q.isVisible?"🕶️":"👁️",action:()=>{const ve=Array.from($.selectedLayerIndices),X=!Q.isVisible;ve.forEach(xe=>$.layers[xe].isVisible=X),r.canvas.triggerPulse()}},{label:ae?"Seal/Unseal Selected":Q.isLocked?"Unlock Infusion":"Lock Infusion",icon:Q.isLocked?"🔓":"🔒",action:()=>{Array.from($.selectedLayerIndices).forEach(X=>N.project.toggleLock(X))}},{label:w({key:"hud.actions.delete"}),icon:"🗑️",danger:!0,disabled:$.layers.length<=$.selectedLayerIndices.size,action:()=>{Array.from($.selectedLayerIndices).sort((X,xe)=>xe-X).forEach(X=>N.project.removeLayer(X)),$.selectedLayerIndices=new Set([$.activeLayerIndex])}}]}}var D=Ti(),U=u(D),P=u(U);P.__click=()=>r.studio.projectActiveTab="frames";var R=g(u(P));d(P);var z=g(P,2);z.__click=()=>r.studio.projectActiveTab="layers";var Y=g(u(z));d(z),d(U);var H=g(U,2);H.__click=_,H.__keydown=E=>{E.key==="Escape"&&_()};var K=u(H);{var te=E=>{var C=_i();De(C,21,()=>r.project.frames,Ue,($,ae,Q)=>{var ve=yi(),X=ye(ve);X.__click=ne=>ne.stopPropagation(),X.__keydown=ne=>{(ne.key==="Enter"||ne.key===" ")&&k(Q,ne)},X.__contextmenu=ne=>F(ne,Q);var xe=u(X);xe.__click=ne=>k(Q,ne),xe.__dblclick=()=>v(Q,o(ae).name);var ke=u(xe);ke.textContent=Q+1;var Xe=g(ke,2);{var Pe=ne=>{var Te=xi();Ne(Te),Te.__keydown=_e=>{_e.key==="Enter"&&f(),_e.key==="Escape"&&A(s,null)},sa(()=>Ve(Te,()=>o(i),_e=>A(i,_e))),$a(Te,_e=>h?.(_e)),Ge("blur",Te,f),S(ne,Te)},$e=ne=>{var Te=bi(),_e=u(Te,!0);d(Te),j(()=>T(_e,o(ae).name)),S(ne,Te)};V(Xe,ne=>{o(s)===Q&&r.studio.projectActiveTab==="frames"?ne(Pe):ne($e,!1)})}d(xe);var ge=g(xe,2),Ie=u(ge);Ie.__click=ne=>c("frame",Q,ne);var Me=u(Ie,!0);d(Ie);var rt=g(Ie,2);rt.__click=ne=>{ne.stopPropagation(),N.project.duplicateFrame(Q)};var Se=g(rt,2);{var Je=ne=>{var Te=mi();Te.__click=_e=>{_e.stopPropagation(),N.project.removeFrame(Q)},j(_e=>M(Te,"title",_e),[()=>w({key:"hud.actions.delete"})]),S(ne,Te)};V(Se,ne=>{r.project.frames.length>1&&ne(Je)})}d(ge),d(X);var Ee=g(X,2);{var ct=ne=>{Ya(ne,{get target(){return o(ae)},margin:"24px"})};V(Ee,ne=>{o(n)==="frame"&&o(l)===Q&&ne(ct)})}j((ne,Te)=>{re(X,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${ne??""} ${Q===r.project.activeFrameIndex?"bg-brand/5 font-bold":""} ${o(a)===Q&&o(t)!==Q?"shadow-[0_-2px_0_var(--color-brand)]":""} ${o(t)===Q?"opacity-40":""}`),M(X,"aria-current",Q===r.project.activeFrameIndex?"true":void 0),T(Me,o(n)==="frame"&&o(l)===Q?"🔼":"⚙️"),M(rt,"title",Te)},[()=>r.project.selectedFrameIndices.has(Q)?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-charcoal/5",()=>w({key:"hud.actions.duplicate"})]),Ge("dragstart",X,()=>x(Q)),Ge("dragover",X,ne=>b(ne,Q)),Ge("drop",X,ne=>m(ne,Q)),Ge("dragend",X,y),S($,ve)}),d(C),ce(3,C,()=>Ae,()=>({duration:150})),S(E,C)},J=E=>{var C=Ei();De(C,21,()=>r.project.activeFrame.layers,Ue,($,ae,Q)=>{const ve=q(()=>o(ae).parentId?r.project.activeFrame.layers.find(Xe=>Xe.id===o(ae).parentId):null);var X=Qe(),xe=ye(X);{var ke=Xe=>{const Pe=q(()=>o(ae).parentId!==null);var $e=ki(),ge=ye($e);ge.__click=Z=>Z.stopPropagation(),ge.__keydown=Z=>{(Z.key==="Enter"||Z.key===" ")&&I(Q,Z)},ge.__contextmenu=Z=>B(Z,Q);var Ie=u(ge),Me=u(Ie);{var rt=Z=>{var ue=Ai();ue.__click=et=>{et.stopPropagation(),o(ae).isCollapsed=!o(ae).isCollapsed};var qe=u(ue,!0);d(ue),j(()=>T(qe,o(ae).isCollapsed?"▶":"▼")),S(Z,ue)};V(Me,Z=>{o(ae).type==="FOLDER"&&Z(rt)})}var Se=g(Me,2);Se.__click=Z=>{Z.stopPropagation(),N.project.toggleVisibility(Q)};var Je=u(Se,!0);d(Se);var Ee=g(Se,2);Ee.__click=Z=>I(Q,Z),Ee.__dblclick=()=>v(Q,o(ae).name);var ct=u(Ee);{var ne=Z=>{var ue=wi();Ne(ue),ue.__keydown=qe=>{qe.key==="Enter"&&f(),qe.key==="Escape"&&A(s,null)},sa(()=>Ve(ue,()=>o(i),qe=>A(i,qe))),$a(ue,qe=>h?.(qe)),Ge("blur",ue,f),S(Z,ue)},Te=Z=>{var ue=dt();j(()=>T(ue,o(ae).name)),S(Z,ue)};V(ct,Z=>{o(s)===Q&&r.studio.projectActiveTab==="layers"?Z(ne):Z(Te,!1)})}d(Ee),d(Ie);var _e=g(Ie,2),ze=u(_e);ze.__click=Z=>c("layer",Q,Z);var Ye=u(ze,!0);d(ze);var Oe=g(ze,2);Oe.__click=Z=>{Z.stopPropagation(),N.project.toggleLock(Q)};var st=u(Oe,!0);d(Oe);var vt=g(Oe,2);vt.__click=Z=>{Z.stopPropagation(),N.project.removeLayer(Q)},d(_e),d(ge);var ft=g(ge,2);{var Ke=Z=>{{let ue=q(()=>o(Pe)?"24px":"12px");Ya(Z,{get target(){return o(ae)},get margin(){return o(ue)}})}};V(ft,Z=>{o(n)==="layer"&&o(l)===Q&&Z(Ke)})}j((Z,ue,qe,et)=>{re(ge,1,`group flex cursor-grab items-center justify-between rounded px-2 transition-all ${Z??""} ${Q===r.project.activeFrame.activeLayerIndex?"bg-brand/5 font-bold":""} ${o(a)===Q&&o(t)!==Q?"shadow-[0_-2px_0_var(--color-brand)]":""} ${o(t)===Q?"opacity-40":""}`),fe(ge,o(Pe)?"margin-left: 12px;":""),M(ge,"aria-current",Q===r.project.activeFrame.activeLayerIndex?"true":void 0),re(Se,1,`text-xs transition-opacity ${o(ae).isVisible?"opacity-100":"opacity-20"}`),M(Se,"title",ue),T(Je,o(ae).isVisible?o(ae).type==="FOLDER"?"📂":"👁️":o(ae).type==="FOLDER"?"📁":"🕶️"),re(Ee,1,`flex-1 truncate py-2 text-left font-serif text-sm font-medium text-charcoal ${o(ae).isVisible?"":"opacity-40"}`),T(Ye,o(n)==="layer"&&o(l)===Q?"🔼":"⚙️"),re(Oe,1,`text-[10px] transition-opacity ${o(ae).isLocked?"opacity-100":"opacity-20"}`),M(Oe,"title",qe),T(st,o(ae).isLocked?"🔒":"🔓"),M(vt,"title",et)},[()=>r.project.activeFrame.selectedLayerIndices.has(Q)?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-charcoal/5",()=>w({key:"hud.project_panel.visibility"}),()=>w({key:"hud.project_panel.lock"}),()=>w({key:"hud.actions.delete"})]),Ge("dragstart",ge,()=>x(Q)),Ge("dragover",ge,Z=>b(Z,Q)),Ge("drop",ge,Z=>m(Z,Q)),Ge("dragend",ge,y),S(Xe,$e)};V(xe,Xe=>{(!o(ve)||!o(ve).isCollapsed)&&Xe(ke)})}S($,X)}),d(C),ce(3,C,()=>Ae,()=>({duration:150})),S(E,C)};V(K,E=>{r.studio.projectActiveTab==="frames"?E(te):E(J,!1)})}d(H);var W=g(H,2),le=u(W),me=u(le);me.__click=()=>{r.studio.projectActiveTab==="frames"?N.project.addFrame():N.project.addLayer()};var be=g(u(me));d(me);var we=g(me,2);{var Ce=E=>{var C=Si();C.__click=()=>N.project.addGroup(),S(E,C)};V(we,E=>{r.studio.projectActiveTab==="layers"&&E(Ce)})}d(le);var He=g(le,2),G=u(He,!0);d(He),d(W),d(D),j((E,C,$,ae,Q)=>{M(P,"aria-selected",r.studio.projectActiveTab==="frames"),M(P,"title",E),re(P,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.projectActiveTab==="frames"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),T(R,` ${C??""}`),M(z,"aria-selected",r.studio.projectActiveTab==="layers"),M(z,"title",$),re(z,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.projectActiveTab==="layers"?"rounded bg-foam-white text-brand shadow-sm":"text-charcoal opacity-40 hover:opacity-60"}`),T(Y,` ${ae??""}`),T(be,` ${Q??""}`),T(G,r.studio.projectActiveTab==="frames"?r.project.frames.length:r.project.activeFrame.layers.length)},[()=>w({key:"labels.TAB_TIMELINE"})+" (Alt+1)",()=>w({key:"hud.project_panel.frames"}),()=>w({key:"labels.TAB_LAYERS"})+" (Alt+2)",()=>w({key:"hud.project_panel.layers"}),()=>r.studio.projectActiveTab==="frames"?w({key:"hud.actions.add_frame"}):w({key:"hud.actions.add_layer"})]),S(p,D),oe()}Fe(["click","keydown","contextmenu","dblclick"]);var Ci=O('<div class="minimap-container border-b border-charcoal/10 bg-charcoal/5 p-3 transition-all duration-300 svelte-17kdxrh"><div class="relative flex items-center justify-center overflow-hidden rounded border border-charcoal/5 bg-stone-light/20 p-2 shadow-inner"><canvas class="h-auto w-full max-w-[180px] shadow-sm" style="image-rendering: pixelated;"></canvas> <div class="pointer-events-none absolute inset-0 ring-1 ring-brand ring-inset" style="opacity: 0.4;"></div></div></div>');function Ii(p,e){ie(e,!0);let t=L(null);lt(()=>{r.canvas.renderPulse;const n=o(t)?.getContext("2d");if(!n||!o(t))return;const{width:l,height:c}=r.canvas,v=r.canvas.compositePixels,h=n.createImageData(l,c);new Uint32Array(h.data.buffer).set(v),n.putImageData(h,0,0)});var a=Ci(),s=u(a),i=u(s);It(i,n=>A(t,n),()=>o(t)),Pt(2),d(s),d(a),j(()=>{M(i,"width",r.canvas.width),M(i,"height",r.canvas.height)}),S(p,a),oe()}var Pi=O('<aside class="side-panel-left flex h-full w-full flex-col overflow-hidden border-r border-charcoal/10 bg-stone-light/50"><!> <div class="flex-1 overflow-y-auto"><!></div></aside>');function Mi(p,e){ie(e,!1),je();var t=Pi(),a=u(t);{var s=l=>{Ii(l,{})};V(a,l=>{r.studio.showMinimap&&l(s)})}var i=g(a,2),n=u(i);Li(n,{}),d(i),d(t),S(p,t),oe()}var Oi=O('<button class="group editor-checker-small relative h-5 w-5 shrink-0 rounded border border-charcoal/10 shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[8px]">📍</span></div></button>'),Ri=O('<div class="flex h-5 w-5 items-center justify-center rounded border border-dashed border-charcoal/10"><span class="text-[8px] opacity-20">🎨</span></div>'),Di=O('<div class="editor-panel flex w-full flex-col gap-4 border-none bg-foam-white p-3 shadow-sm"><div class="flex flex-col items-center gap-2 py-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Active Flavor</span> <div class="editor-checker-small h-10 w-10 rounded border border-charcoal/10 shadow-inner transition-colors"></div> <span class="font-mono text-[9px] font-bold tracking-tight text-charcoal/40 uppercase"> </span></div> <div class="h-px w-full bg-charcoal/5"></div> <div class="flex flex-col gap-2"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase">Recent Brews</span> <div class="custom-scrollbar flex max-h-[120px] flex-row flex-wrap gap-1.5 overflow-y-auto px-1"></div></div></div>');function ji(p,e){ie(e,!1),je();var t=Di(),a=u(t),s=g(u(a),2),i=g(s,2),n=u(i,!0);d(i),d(a);var l=g(a,4),c=g(u(l),2);De(c,5,()=>r.usedColors,v=>v,(v,h)=>{var f=Oi();f.__click=()=>N.color.setColor(o(h)),j(()=>{fe(f,`background-color: ${o(h)??""};`),M(f,"title",o(h))}),ce(3,f,()=>di,()=>({duration:200})),S(v,f)},v=>{var h=Ri();S(v,h)}),d(c),d(l),d(t),j(()=>{fe(s,`background-color: ${r.paletteState.activeColor??""};`),T(n,r.paletteState.activeColor)}),S(p,t),oe()}Fe(["click"]);var Fi=O('<div class="editor-panel w-full border-none bg-stone-light/50 p-3 shadow-sm" role="status"><div class="flex flex-col gap-3"><div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div> <div class="h-px w-full bg-charcoal/5" aria-hidden="true"></div> <div class="flex flex-col"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <span class="font-mono text-[11px] font-bold text-charcoal tabular-nums"> </span></div></div></div>');function Gi(p,e){ie(e,!1),je();var t=Fi(),a=u(t),s=u(a),i=u(s),n=u(i,!0);d(i);var l=g(i,2),c=u(l);d(l),d(s);var v=g(s,4),h=u(v),f=u(h,!0);d(h);var x=g(h,2),b=u(x);d(x),d(v),d(a),d(t),j((m,y)=>{T(n,m),T(c,`${r.displayCoords.x??""}, ${r.displayCoords.y??""}`),T(f,y),T(b,`${r.canvas.width??""}×${r.canvas.height??""}`)},[()=>w({key:"stats.cursor_focus"}),()=>w({key:"stats.canvas_size"})]),S(p,t),oe()}var Wt=na(()=>r),Bi=O('<button role="radio"></button>'),$i=O('<div class="editor-panel flex w-full flex-col gap-3 border-none bg-stone-light/30 p-3 shadow-sm" role="region" aria-label="Color Palette"><span class="text-center font-serif text-[8px] font-black tracking-widest text-charcoal/30 uppercase"> </span> <div class="grid grid-cols-4 gap-2" role="radiogroup"><!> <button class="flex h-8 w-8 items-center justify-center rounded border border-dashed border-charcoal/20 bg-charcoal/5 transition-all hover:scale-110 hover:border-brand/40 hover:bg-white"><span class="text-xs opacity-40" aria-hidden="true">＋</span></button></div></div>');function Ni(p,e){ie(e,!1),je();var t=$i(),a=u(t),s=u(a,!0);d(a);var i=g(a,2),n=u(i);De(n,1,()=>Wt().palette,Ue,(c,v,h)=>{var f=Bi();f.__click=()=>N.color.select(h),j((x,b)=>{re(f,1,`editor-checker-small h-8 w-8 rounded transition-all ${Wt().activeColor===o(v)?"z-10 scale-110 border-2 border-brand shadow-md":"border border-charcoal/5 opacity-80 hover:scale-105 hover:opacity-100"}`),fe(f,`background-color: ${o(v)??""};`),M(f,"aria-label",x),M(f,"title",b),M(f,"aria-checked",Wt().activeColor===o(v))},[()=>w({key:`labels.SELECT_COLOR_${(h+1)%10}`}),()=>w({key:`labels.SELECT_COLOR_${(h+1)%10}`})+` (${(h+1)%10})`]),S(c,f)});var l=g(n,2);l.__click=()=>Wt(Wt().showColorPicker=!0),d(i),d(t),j((c,v,h)=>{T(s,c),M(l,"title",`${v??""} (B)`),M(l,"aria-label",h)},[()=>w({key:"shortcut_groups.colors"}),()=>w({key:"color_picker.title"}),()=>w({key:"color_picker.title"})]),S(p,t),oe()}Fe(["click"]);var Ui=O('<div class="absolute top-0 -left-12 flex flex-col items-center gap-1 rounded-md bg-white p-1 shadow-md ring-1 ring-black/5"><button class="flex h-4 w-4 items-center justify-center text-[10px] hover:text-brand">+</button> <span class="font-tiny5 text-[8px] text-brand"> </span> <button class="flex h-4 w-4 items-center justify-center text-[10px] hover:text-brand">-</button> <div class="my-1 h-px w-2 bg-charcoal/10"></div> <div class="flex flex-col items-center gap-0.5"><button class="text-[8px] hover:text-brand">▴</button> <span class="text-[7px] font-bold text-brand/60"> </span> <button class="text-[8px] hover:text-brand">▾</button></div></div>'),Vi=O('<button><span class="text-sm"> </span></button> <!>',1),Hi=O('<button><span class="text-sm"> </span></button>'),zi=O('<button><span class="text-sm"> </span></button>'),Yi=O('<div class="absolute -top-1 -right-1 text-[8px]">🔒</div>'),Ki=O('<button><span class="text-[10px]"> </span> <!></button>'),qi=O('<div class="vessel-toolbar custom-scrollbar flex h-full flex-col items-center gap-4 overflow-y-auto py-4 svelte-9w26m7"><div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div> <div class="h-px w-4 bg-charcoal/10"></div> <div class="flex flex-col gap-1.5"></div></div>');function Qi(p,e){ie(e,!1);const t=Ia(r.studio),a=[{id:"BRUSH",icon:"🖋️",intent:"TOOL_BRUSH",label:"TOOL_BRUSH"},{id:"ERASER",icon:"🧹",intent:"TOOL_ERASER",label:"TOOL_ERASER"},{id:"SELECT",icon:"✨",intent:"TOOL_SELECT",label:"TOOL_SELECT"},{id:"RECTANGLE",icon:"📦",intent:"TOOL_RECTANGLE",label:"TOOL_RECTANGLE"},{id:"ELLIPSE",icon:"⭕",intent:"TOOL_ELLIPSE",label:"TOOL_ELLIPSE"},{id:"POLYGON",icon:"⭐",intent:"TOOL_POLYGON",label:"TOOL_POLYGON"},{id:"GRADIENT",icon:"🌈",intent:"TOOL_GRADIENT",label:"TOOL_GRADIENT"},{id:"HAND",icon:"🤚",intent:"TOGGLE_HAND_TOOL",label:"TOGGLE_HAND_TOOL"}],s=[{id:"lighten",icon:"☀️",intent:"SHADE_LIGHTEN",active:()=>o(t).isShadingLighten,label:"SHADE_LIGHTEN"},{id:"darken",icon:"🌙",intent:"SHADE_DARKEN",active:()=>o(t).isShadingDarken,label:"SHADE_DARKEN"},{id:"dither",icon:"🏁",intent:"SHADE_DITHER",active:()=>o(t).isShadingDither,label:"SHADE_DITHER"}],i=[{id:"symmetry",icon:"🪞",intent:"CYCLE_SYMMETRY",active:()=>o(t).symmetryMode!=="OFF",label:"CYCLE_SYMMETRY"},{id:"tiling",icon:"∞",intent:"TOGGLE_TILING",active:()=>o(t).isTilingEnabled,label:"TOGGLE_TILING"},{id:"perfect",icon:"✨",intent:"TOGGLE_PIXEL_PERFECT",active:()=>o(t).isPixelPerfect,label:"TOGGLE_PIXEL_PERFECT"},{id:"stencil",icon:"🎨",intent:"TOGGLE_PATTERN_BRUSH",active:()=>o(t).isPatternBrushActive,label:"TOGGLE_PATTERN_BRUSH",disabled:()=>!r.project.clipboard}],n=[{id:"alpha",icon:"A",intent:"TOGGLE_ALPHA_LOCK",active:()=>o(t).isAlphaLocked,label:"TOGGLE_ALPHA_LOCK"},{id:"color",icon:"C",intent:"TOGGLE_COLOR_LOCK",active:()=>o(t).isColorLocked,label:"TOGGLE_COLOR_LOCK"}];je();var l=qi(),c=u(l);De(c,5,()=>a,Ue,(x,b)=>{var m=Vi(),y=ye(m);y.__click=()=>bt.handleIntent(o(b).intent);var _=u(y),k=u(_,!0);d(_),d(y);var I=g(y,2);{var F=B=>{var D=Ui(),U=u(D);U.__click=()=>bt.handleIntent("POLY_SIDES_INC");var P=g(U,2),R=u(P,!0);d(P);var z=g(P,2);z.__click=()=>bt.handleIntent("POLY_SIDES_DEC");var Y=g(z,4),H=u(Y);H.__click=()=>At(t,o(t).polygonIndentation=Math.min(100,o(t).polygonIndentation+10));var K=g(H,2),te=u(K);d(K);var J=g(K,2);J.__click=()=>At(t,o(t).polygonIndentation=Math.max(0,o(t).polygonIndentation-10)),d(Y),d(D),j(()=>{T(R,o(t).polygonSides),T(te,`${o(t).polygonIndentation??""}%`)}),ce(3,D,()=>Ae),S(B,D)};V(I,B=>{o(b).id==="POLYGON"&&o(t).activeTool==="POLYGON"&&B(F)})}j(B=>{re(y,1,`tool-button ${o(t).activeTool===o(b).id?"is-active":""}`,"svelte-9w26m7"),M(y,"title",B),T(k,o(b).icon)},[()=>w({key:`labels.${o(b).label}`})]),S(x,m)}),d(c);var v=g(c,4);De(v,5,()=>s,Ue,(x,b)=>{var m=Hi();m.__click=()=>bt.handleIntent(o(b).intent);var y=u(m),_=u(y,!0);d(y),d(m),j((k,I)=>{re(m,1,`tool-button ${k??""}`,"svelte-9w26m7"),M(m,"title",I),T(_,o(b).icon)},[()=>o(b).active()?"is-active":"",()=>w({key:`labels.${o(b).label}`})]),S(x,m)}),d(v);var h=g(v,4);De(h,5,()=>i,Ue,(x,b)=>{var m=zi();m.__click=()=>!o(b).disabled?.()&&bt.handleIntent(o(b).intent);var y=u(m),_=u(y,!0);d(y),d(m),j((k,I,F)=>{re(m,1,`tool-button ${k??""} ${I??""}`,"svelte-9w26m7"),M(m,"title",F),T(_,o(b).icon)},[()=>o(b).active()?"is-active":"",()=>o(b).disabled?.()?"cursor-not-allowed opacity-20 grayscale":"",()=>w({key:`labels.${o(b).label}`})]),S(x,m)}),d(h);var f=g(h,4);De(f,5,()=>n,Ue,(x,b)=>{var m=Ki();m.__click=()=>bt.handleIntent(o(b).intent);var y=u(m),_=u(y,!0);d(y);var k=g(y,2);{var I=F=>{var B=Yi();ce(3,B,()=>Rt),S(F,B)};V(k,F=>{o(b).active()&&F(I)})}d(m),j((F,B)=>{re(m,1,`tool-button ${F??""} font-bold`,"svelte-9w26m7"),M(m,"title",B),T(_,o(b).icon)},[()=>o(b).active()?"is-active":"",()=>w({key:`labels.${o(b).label}`})]),S(x,m)}),d(f),d(l),S(p,l),oe()}Fe(["click"]);var Xi=O('<aside class="side-panel-right flex h-full w-full border-l border-charcoal/10 bg-foam-white/50"><div class="flex h-full flex-col border-r border-charcoal/5 bg-charcoal/[0.02] px-2"><!></div> <div class="flex flex-1 flex-col gap-4 p-3"><div class="flex flex-col gap-3"><!> <!></div> <div class="flex-1"></div> <!></div></aside>');function Wi(p){var e=Xi(),t=u(e),a=u(t);Qi(a,{}),d(t);var s=g(t,2),i=u(s),n=u(i);ji(n,{});var l=g(n,2);Ni(l,{}),d(i);var c=g(i,4);Gi(c,{}),d(s),d(e),S(p,e)}var Zi=O('<span class="text-xs" aria-hidden="true"> </span>'),Ji=O('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),eo=O("<div><!> <span> </span> <!></div>"),to=O('<div class="text-[8px] font-bold tracking-[0.2em] text-studio-text/20 uppercase"> </div>'),ao=O('<div role="status" aria-live="polite"><div class="flex w-[180px] items-center"><!></div> <!></div>');function ro(p,e){ie(e,!1),je();var t=ao(),a=u(t),s=u(a);Qr(s,()=>Re.current.type,l=>{var c=eo(),v=u(c);{var h=y=>{var _=Zi(),k=u(_,!0);d(_),j(()=>T(k,Re.current.icon)),S(y,_)};V(v,y=>{Re.current.icon&&y(h)})}var f=g(v,2),x=u(f,!0);d(f);var b=g(f,2);{var m=y=>{var _=Ji(),k=u(_);d(_),j(()=>T(k,`v${r.version??""}`)),S(y,_)};V(b,y=>{Re.current.type==="READY"&&y(m)})}d(c),j(()=>{re(c,1,`status-tag flex items-center gap-2 ${Re.current.isPulse?"animate-pulse":""}`),fe(c,`
					border-color: color-mix(in srgb, ${Re.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${Re.current.color??""} 10%, transparent);
					color: ${Re.current.color??""};
				`),re(f,1,ss(Re.current.type==="READY"?"font-serif italic opacity-60":"font-bold")),T(x,Re.current.label)}),S(l,c)}),d(a);var i=g(a,2);{var n=l=>{const c=Jt(()=>r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var v=to(),h=u(v,!0);d(v),j((f,x)=>{M(v,"aria-label",f),T(h,x)},[()=>w({key:"project.saved",replace:{time:o(c)}}),()=>w({key:"project.saved",replace:{time:o(c)}})]),S(l,v)};V(i,l=>{r.project.lastSaved&&l(n)})}d(t),j(()=>re(t,1,`flex items-center gap-4 transition-opacity duration-1000 ${r.cursor.isVisible?"opacity-100":"opacity-0"}`)),S(p,t),oe()}var so=O('<span class="rounded border border-charcoal/20 bg-charcoal/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-charcoal uppercase"> </span>'),io=O('<span class="font-mono text-[9px] text-charcoal/40 italic"> </span>'),oo=O('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"> </span> <div class="flex min-w-[80px] gap-1.5"><!></div></div>');function no(p,e){ie(e,!1),je();var t=oo(),a=u(t),s=u(a);d(a);var i=g(a,2),n=u(i);{var l=v=>{var h=Qe(),f=ye(h);De(f,1,()=>at.activeKeys,Ue,(x,b)=>{var m=so(),y=u(m,!0);d(m),j(()=>T(y,o(b)===" "?"Space":o(b))),S(x,m)}),S(v,h)},c=v=>{var h=io(),f=u(h,!0);d(h),j(x=>T(f,x),[()=>w({key:"timeline.waiting"})]),S(v,h)};V(n,v=>{at.activeKeys.length>0?v(l):v(c,!1)})}d(i),d(t),j(v=>T(s,`${v??""}:`),[()=>w({key:"timeline.rhythm"})]),S(p,t),oe()}var lo=O('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"> </span> <span class="font-mono text-[9px] font-bold text-charcoal uppercase"> </span></div>');function co(p,e){ie(e,!1),je();var t=lo(),a=u(t),s=u(a);d(a);var i=g(a,2),n=u(i,!0);d(i),d(t),j(l=>{T(s,`${l??""}:`),T(n,Re.current.type)},[()=>w({key:"timeline.mode"})]),S(p,t),oe()}var uo=O('<div class="flex items-center gap-1.5"><span aria-hidden="true">🎹</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/50 uppercase italic"><!></span></div>');function vo(p,e){ie(e,!1),je();var t=uo(),a=u(t),s=g(a,2),i=u(s);{var n=c=>{var v=dt();j(h=>T(v,h),[()=>w({key:"timeline.audio_status.silent"})]),S(c,v)},l=c=>{var v=Qe(),h=ye(v);{var f=b=>{var m=dt();j(y=>T(m,y),[()=>w({key:"timeline.audio_status.brewing"})]),S(b,m)},x=b=>{var m=dt();j(y=>T(m,y),[()=>w({key:"timeline.audio_status.resonant"})]),S(b,m)};V(h,b=>{r.usageMinutes<60?b(f):b(x,!1)},!0)}S(c,v)};V(i,c=>{r.usageMinutes<30?c(n):c(l,!1)})}d(s),d(t),j(c=>{M(t,"title",c),re(a,1,`text-[9px] ${r.usageMinutes>=30?"animate-pulse":"opacity-40 grayscale"}`)},[()=>w({key:"timeline.audio_status.title"})]),S(p,t),oe()}var ho=O('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">⏱️</span> <span class="font-mono text-[9px] font-bold text-charcoal/80 tabular-nums"> </span></div>');function po(p,e){ie(e,!1),je();var t=ho(),a=g(u(t),2),s=u(a,!0);d(a),d(t),j(i=>{M(t,"title",i),T(s,r.studio.sessionTimeLabel)},[()=>w({key:"timeline.duration"})]),S(p,t),oe()}var fo=O('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">✨</span> <span class="font-serif text-[8px] font-black tracking-widest text-charcoal/60 uppercase italic"> </span></div>');function go(p,e){ie(e,!1),je();var t=fo(),a=g(u(t),2),s=u(a,!0);d(a),d(t),j(i=>T(s,i),[()=>w({key:r.selection.indices.length>1?"timeline.pixel_count_plural":"timeline.pixel_count",replace:{count:r.selection.indices.length}})]),S(p,t),oe()}var xo=O('<div class="flex items-center gap-1.5"><span class="text-[10px]" aria-hidden="true">💾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand/80 uppercase"> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div>',1),bo=O('<div class="flex items-center gap-3 text-charcoal/40" role="status"><!> <div class="flex gap-3 font-mono text-[9px] font-bold tracking-tight text-charcoal/60 uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-charcoal/20" aria-hidden="true"></div> <span class="font-mono text-[10px] font-black tracking-widest text-brand/60 uppercase"> </span></div>');function mo(p,e){ie(e,!1),je();var t=bo(),a=u(t);{var s=m=>{var y=xo(),_=ye(y),k=g(u(_),2),I=u(k,!0);d(k),d(_),Pt(2),j(F=>T(I,F),[()=>w({key:"project.saved",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}})]),ce(3,_,()=>Ae),S(m,y)};V(a,m=>{r.project.lastSaved&&m(s)})}var i=g(a,2),n=u(i),l=u(n);d(n);var c=g(n,2),v=u(c);d(c);var h=g(c,2),f=u(h);d(h),d(i);var x=g(i,4),b=u(x,!0);d(x),d(t),j((m,y)=>{T(l,`POS: ${r.cursor.pos.x??""},${r.cursor.pos.y??""}`),T(v,`SIZE: ${r.canvas.width??""}x${r.canvas.height??""}`),T(f,`ZOOM: ${m??""}%`),T(b,y)},[()=>Math.round(r.studio.zoomLevel*100),()=>w({key:"stats.technical_details"})]),S(p,t),oe()}var yo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/5 px-1.5 py-0.5 text-brand"><span class="text-[8px] font-bold">SYM:</span> <span class="font-black"><!></span></div>'),_o=O("<span>🔒A</span>"),Ao=O("<span>🔒C</span>"),wo=O('<div class="flex items-center gap-1 text-brand"><!> <!></div>'),ko=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">∞</div>'),Eo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">☁️ MIST</div>'),So=O('<div class="bg-green-leaves/10 text-green-leaves flex items-center gap-1 rounded-sm px-1.5 py-0.5 font-bold">✨ PURE</div>'),To=O('<div class="flex animate-pulse items-center gap-1 rounded-sm bg-brand/20 px-1.5 py-0.5 font-bold text-brand">🚚 MOVING</div>'),Lo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🎨 STENCIL</div>'),Co=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🌈 GRADIENT</div>'),Io=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">📦 BOX</div>'),Po=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">⭕ ROUND</div>'),Mo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand"> </div>'),Oo=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">☀️ LIGHT</div>'),Ro=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🌙 DARK</div>'),Do=O('<div class="flex items-center gap-1 rounded-sm bg-brand/10 px-1.5 py-0.5 font-bold text-brand">🏁 DITHER</div>'),jo=O('<div class="flex items-center gap-3 font-serif text-[10px] tracking-wide text-charcoal/60"><div class="flex items-center gap-1"><span class="text-[8px] uppercase opacity-40"> </span> <span class="font-bold text-brand"> </span> <span class="opacity-40"> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!></div>');function Fo(p,e){ie(e,!1);const t=r.studio;je();var a=jo(),s=u(a),i=u(s),n=u(i,!0);d(i);var l=g(i,2),c=u(l);d(l);var v=g(l,2),h=u(v,!0);d(v),d(s);var f=g(s,2);{var x=E=>{var C=yo(),$=g(u(C),2),ae=u($);{var Q=X=>{var xe=dt("—");S(X,xe)},ve=X=>{var xe=Qe(),ke=ye(xe);{var Xe=$e=>{var ge=dt("|");S($e,ge)},Pe=$e=>{var ge=dt("+");S($e,ge)};V(ke,$e=>{t.symmetryMode==="VERTICAL"?$e(Xe):$e(Pe,!1)},!0)}S(X,xe)};V(ae,X=>{t.symmetryMode==="HORIZONTAL"?X(Q):X(ve,!1)})}d($),d(C),j(X=>M(C,"title",X),[()=>w({key:"labels.CYCLE_SYMMETRY"})]),ce(3,C,()=>Ae),S(E,C)};V(f,E=>{t.symmetryMode!=="OFF"&&E(x)})}var b=g(f,2);{var m=E=>{var C=wo(),$=u(C);{var ae=X=>{var xe=_o();j(ke=>M(xe,"title",ke),[()=>w({key:"labels.TOGGLE_ALPHA_LOCK"})]),S(X,xe)};V($,X=>{t.isAlphaLocked&&X(ae)})}var Q=g($,2);{var ve=X=>{var xe=Ao();j(ke=>M(xe,"title",ke),[()=>w({key:"labels.TOGGLE_COLOR_LOCK"})]),S(X,xe)};V(Q,X=>{t.isColorLocked&&X(ve)})}d(C),ce(3,C,()=>Ae),S(E,C)};V(b,E=>{(t.isAlphaLocked||t.isColorLocked)&&E(m)})}var y=g(b,2);{var _=E=>{var C=ko();j($=>M(C,"title",$),[()=>w({key:"labels.TOGGLE_TILING"})]),ce(3,C,()=>Ae),S(E,C)};V(y,E=>{t.isTilingEnabled&&E(_)})}var k=g(y,2);{var I=E=>{var C=Eo();j($=>M(C,"title",$),[()=>w({key:"labels.TOGGLE_AIRBRUSH"})]),ce(3,C,()=>Ae),S(E,C)};V(k,E=>{t.isAirbrushActive&&E(I)})}var F=g(k,2);{var B=E=>{var C=So();j($=>M(C,"title",$),[()=>w({key:"labels.TOGGLE_PIXEL_PERFECT"})]),ce(3,C,()=>Ae),S(E,C)};V(F,E=>{t.isPixelPerfect&&E(B)})}var D=g(F,2);{var U=E=>{var C=To();j($=>M(C,"title",$),[()=>w({key:"labels.TOOL_TRANSFORM"})]),ce(3,C,()=>Ae),S(E,C)};V(D,E=>{t.isTransforming&&E(U)})}var P=g(D,2);{var R=E=>{var C=Lo();j($=>M(C,"title",$),[()=>w({key:"labels.TOGGLE_PATTERN_BRUSH"})]),ce(3,C,()=>Ae),S(E,C)};V(P,E=>{t.isPatternBrushActive&&E(R)})}var z=g(P,2);{var Y=E=>{var C=Co();j($=>M(C,"title",$),[()=>w({key:"labels.TOOL_GRADIENT"})]),ce(3,C,()=>Ae),S(E,C)};V(z,E=>{t.activeTool==="GRADIENT"&&E(Y)})}var H=g(z,2);{var K=E=>{var C=Io();j($=>M(C,"title",$),[()=>w({key:"labels.TOOL_RECTANGLE"})]),ce(3,C,()=>Ae),S(E,C)};V(H,E=>{t.activeTool==="RECTANGLE"&&E(K)})}var te=g(H,2);{var J=E=>{var C=Po();j($=>M(C,"title",$),[()=>w({key:"labels.TOOL_ELLIPSE"})]),ce(3,C,()=>Ae),S(E,C)};V(te,E=>{t.activeTool==="ELLIPSE"&&E(J)})}var W=g(te,2);{var le=E=>{var C=Mo(),$=u(C);d(C),j(ae=>{M(C,"title",ae),T($,`⭐ POLY (${t.polygonSides??""})`)},[()=>w({key:"labels.TOOL_POLYGON"})]),ce(3,C,()=>Ae),S(E,C)};V(W,E=>{t.activeTool==="POLYGON"&&E(le)})}var me=g(W,2);{var be=E=>{var C=Oo();j($=>M(C,"title",$),[()=>w({key:"labels.TOGGLE_SHADE_LIGHTEN"})]),ce(3,C,()=>Ae),S(E,C)};V(me,E=>{t.isShadingLighten&&E(be)})}var we=g(me,2);{var Ce=E=>{var C=Ro();j($=>M(C,"title",$),[()=>w({key:"labels.TOGGLE_SHADE_DARKEN"})]),ce(3,C,()=>Ae),S(E,C)};V(we,E=>{t.isShadingDarken&&E(Ce)})}var He=g(we,2);{var G=E=>{var C=Do();j($=>M(C,"title",$),[()=>w({key:"labels.TOGGLE_SHADE_DITHER"})]),ce(3,C,()=>Ae),S(E,C)};V(He,E=>{t.isShadingDither&&E(G)})}d(a),j((E,C)=>{M(s,"title",E),T(n,C),T(c,`${t.brushSize??""}px`),T(h,t.brushShape==="SQUARE"?"■":"●")},[()=>w({key:"labels.BRUSH_SIZE_INC"}),()=>w({key:"shortcut_groups.etching"})]),S(p,a),oe()}var Go=O('<div class="flex flex-1 items-center justify-between px-3 opacity-80 transition-opacity hover:opacity-100"><div class="flex items-center gap-4"><!> <div class="h-3 w-px bg-charcoal/20"></div> <!> <div class="h-3 w-px bg-charcoal/20"></div> <div class="flex items-center gap-3"><!> <div class="h-3 w-px bg-charcoal/20"></div> <!> <!> <div class="h-3 w-px bg-charcoal/20"></div> <!></div></div> <!></div>');function Bo(p){var e=Go(),t=u(e),a=u(t);no(a,{});var s=g(a,4);co(s,{});var i=g(s,4),n=u(i);Fo(n,{});var l=g(n,4);po(l,{});var c=g(l,2);vo(c,{});var v=g(c,4);go(v,{}),d(i),d(t);var h=g(t,2);mo(h,{}),d(e),S(p,e)}var it=na(()=>r),$o=O('<div class="flex items-center gap-4 border-r border-black/5 pr-4" role="toolbar" aria-label="Timeline Controls"><button><span class="text-xs" aria-hidden="true"> </span> <span class="font-tiny5 tracking-widest uppercase"> </span></button> <div class="flex items-center gap-2 rounded-xl bg-black/5 px-3 py-1 ring-1 ring-black/5"><label for="pace-input" class="font-serif text-[11px] font-black tracking-tight text-studio-text/50 uppercase"> </label> <input id="pace-input" type="number" min="1" max="60" class="w-10 bg-transparent text-center font-mono text-sm font-bold text-studio-text focus:outline-none"/> <span class="font-serif text-[10px] font-black text-studio-text/30" aria-hidden="true">FPS</span></div> <button><span class="text-xs" aria-hidden="true">👻</span> <span class="font-serif text-[11px] font-black tracking-wider text-studio-text/70 uppercase">Ghosts</span></button> <div class="flex items-center gap-2 border-l border-black/5 pl-4"><span class="text-xs opacity-40" aria-hidden="true">🔍</span> <input type="range" min="0.5" max="4" step="0.1" class="editor-range w-20 svelte-cffdjb" title="Timeline Zoom"/> <span class="w-8 font-mono text-[10px] font-bold text-studio-text/40"> </span></div></div>');function No(p,e){ie(e,!1),je();var t=$o(),a=u(t);a.__click=()=>rr.togglePlayback();var s=u(a),i=u(s,!0);d(s);var n=g(s,2),l=u(n,!0);d(n),d(a);var c=g(a,2),v=u(c),h=u(v,!0);d(v);var f=g(v,2);Ne(f),Pt(2),d(c);var x=g(c,2);x.__click=()=>it(it().studio.showGhostLayers=!it().studio.showGhostLayers);var b=g(x,2),m=g(u(b),2);Ne(m);var y=g(m,2),_=u(y);d(y),d(b),d(t),j((k,I,F,B,D,U)=>{re(a,1,`editor-primary-btn flex items-center gap-2 !px-4 !py-1.5 text-xs ${it().project.isPlaying?"bg-brand":"bg-slate-700"}`),M(a,"title",k),M(a,"aria-label",I),T(i,it().project.isPlaying?"⏹":"▶"),T(l,it().project.isPlaying?"Stop":"Play"),T(h,F),re(x,1,`flex items-center gap-2 rounded-xl px-3 py-1.5 transition-all ${it().studio.showGhostLayers?"bg-brand/10 text-brand ring-1 ring-brand/20":"bg-black/5 opacity-40 shadow-sm hover:bg-white/60 hover:opacity-100"}`),M(x,"title",B),M(x,"aria-label",D),T(_,`${U??""}%`)},[()=>w({key:"labels.PLAY_PAUSE"})+" (P)",()=>w({key:"labels.PLAY_PAUSE"}),()=>w({key:"export.fps_label"}),()=>w({key:"labels.TOGGLE_GHOST_LAYERS"})+" (Alt+G)",()=>w({key:"labels.TOGGLE_GHOST_LAYERS"}),()=>Math.round(it().studio.timelineZoom*100)]),Ve(f,()=>it().studio.fps,k=>it(it().studio.fps=k)),Ve(m,()=>it().studio.timelineZoom,k=>it(it().studio.timelineZoom=k)),S(p,t),oe()}Fe(["click"]);class _a{static getRulerMarks(e,t,a=1e4){const s=[];let i=500;t>2&&(i=100),t<.6&&(i=1e3);const n=Math.max(e+a,3e4/t);for(let l=0;l<=n;l+=i)s.push(l);return s}static formatTimeLabel(e){return e>=1e3?(e/1e3).toFixed(e%1e3===0?0:1)+"s":e+"ms"}static getFrameOffset(e,t,a,s){let i=0;for(let n=0;n<t;n++)i+=Math.max(s,e[n].duration*a);return i}static getTrackWidth(e,t,a){return e.reduce((s,i)=>s+Math.max(a,i.duration*t),0)}}var Uo=O('<div><div role="button" tabindex="0"><div></div> <div class="absolute top-1 left-1 flex h-4 min-w-4 items-center justify-center rounded-sm bg-black/40 px-1 backdrop-blur-sm"><span class="font-mono text-[9px] font-black text-white"> </span></div> <div class="absolute right-1 bottom-1 rounded bg-white/80 px-1.5 py-0.5 font-mono text-[9px] font-bold text-black/50 shadow-sm"> </div></div>  <div class="absolute top-0 right-0 bottom-0 z-30 w-2 cursor-col-resize rounded-r-md transition-colors hover:bg-brand/40 active:bg-brand"><div class="absolute top-1/2 left-1/2 h-6 w-0.5 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/10 group-hover:bg-white/60"></div></div></div>');function Vo(p,e){ie(e,!0);let t=Le(e,"frame",7),a=q(()=>.25*r.studio.timelineZoom);const s=50;let i=q(()=>Math.max(s,t().duration*o(a))),n=L(!1),l=0,c=0;function v(D){D.stopPropagation(),D.preventDefault(),A(n,!0),l=D.clientX,c=t().duration,window.addEventListener("mousemove",h),window.addEventListener("mouseup",f),document.body.style.cursor="col-resize"}function h(D){if(!o(n))return;const U=D.clientX-l,P=Math.round(U/o(a)),R=Math.max(10,c+P);t().duration=Math.round(R/10)*10}function f(){A(n,!1),window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",f),document.body.style.cursor=""}var x=Uo(),b=u(x);b.__click=()=>r.project.activeFrameIndex=e.index,b.__keydown=D=>D.key==="Enter"&&(r.project.activeFrameIndex=e.index);var m=u(b),y=g(m,2),_=u(y),k=u(_,!0);d(_),d(y);var I=g(y,2),F=u(I);d(I),d(b);var B=g(b,2);B.__mousedown=v,d(x),j(()=>{re(x,1,`relative h-full flex-shrink-0 transition-transform duration-200 select-none ${e.isDragged?"scale-95 opacity-40":""} ${e.isDropTarget?"translate-x-4":""}`),fe(x,`width: ${o(i)??""}px;`),re(b,1,`group relative h-full w-full cursor-pointer overflow-hidden rounded-md border border-black/10 transition-all ${e.isActive?"border-brand bg-white shadow-lg ring-2 ring-brand/20":"bg-white/60 hover:bg-white/90 hover:shadow-md"}`),re(m,1,`absolute inset-1 rounded-sm shadow-inner transition-colors ${e.isActive?"bg-brand/10":"bg-black/5"}`),T(k,e.index+1),T(F,`${t().duration??""}ms`)}),S(p,x),oe()}Fe(["click","keydown","mousedown"]);var Ho=O('<div class="absolute flex flex-col items-start"><div class="h-1.5 w-px bg-charcoal/20"></div> <span class="-mt-0.5 ml-1 font-mono text-[8px] font-bold whitespace-nowrap text-charcoal/30"> </span></div>'),zo=O("<div></div>"),Yo=O('<div role="listitem" draggable="true" class="relative h-[50px]"><!> <!></div>'),Ko=O('<div class="relative flex flex-1 flex-col overflow-hidden rounded border border-charcoal/10 bg-stone-light/30 shadow-inner"><div class="relative h-5 w-full cursor-pointer overflow-hidden border-b border-charcoal/5 bg-foam-white/80" role="presentation"><div class="absolute top-0 bottom-0"></div></div> <div class="custom-scrollbar relative flex flex-1 items-start overflow-x-auto overflow-y-hidden svelte-8wcczq" role="list" aria-label="Timeline"><div class="flex h-full items-center bg-transparent py-2 pl-1"><!> <button class="group ml-2 flex h-[50px] w-8 shrink-0 items-center justify-center rounded border border-dashed border-charcoal/20 bg-foam-white/40 text-charcoal/20 transition-all hover:border-brand/40 hover:bg-white hover:text-brand" title="Add Frame"><span class="text-lg">＋</span></button> <div class="w-40 shrink-0"></div></div> <div class="pointer-events-none absolute top-0 bottom-0 z-20 w-px bg-brand transition-all duration-100 ease-out"><div class="absolute -top-0.5 -left-1 h-2 w-2 rotate-45 rounded-sm bg-brand shadow-sm"></div></div></div></div>');function qo(p,e){ie(e,!0);let t=L(null),a=L(null),s=L(void 0),i=L(void 0),n=L(0),l=q(()=>.25*r.studio.timelineZoom);const c=50;function v(H){const K=H.target;A(n,K.scrollLeft,!0)}function h(H){A(t,H,!0)}function f(H,K){H.preventDefault(),A(a,K,!0)}function x(H,K){H.preventDefault(),o(t)!==null&&o(t)!==K&&N.project.reorderFrame(o(t),K),A(t,null),A(a,null)}let b=q(()=>_a.getFrameOffset(r.project.frames,r.project.activeFrameIndex,o(l),c));lt(()=>{if(o(s)&&r.project.isPlaying){const H=o(s).clientWidth/2;o(b)>H&&(o(s).scrollLeft=o(b)-H)}});let m=q(()=>r.project.frames.reduce((H,K)=>H+K.duration,0)),y=q(()=>_a.getRulerMarks(o(m),r.studio.timelineZoom)),_=q(()=>o(y)[o(y).length-1]*o(l)+100);function k(H){if(!o(i))return;const K=o(i).getBoundingClientRect(),te=o(s)?.scrollLeft||0,J=H.clientX-K.left+te;let W=0;for(let le=0;le<r.project.frames.length;le++){const me=Math.max(c,r.project.frames[le].duration*o(l));if(J>=W&&J<W+me){r.project.activeFrameIndex=le;break}W+=me}}function I(H){if(H.ctrlKey){H.preventDefault();const K=H.deltaY>0?-.1:.1;r.studio.timelineZoom=Math.max(.5,Math.min(4,r.studio.timelineZoom+K))}}var F=Ko(),B=u(F);B.__click=k;var D=u(B);De(D,21,()=>o(y),Ue,(H,K)=>{var te=Ho(),J=g(u(te),2),W=u(J,!0);d(J),d(te),j(le=>{fe(te,`left: ${o(K)*o(l)}px;`),T(W,le)},[()=>_a.formatTimeLabel(o(K))]),S(H,te)}),d(D),d(B),It(B,H=>A(i,H),()=>o(i));var U=g(B,2),P=u(U),R=u(P);De(R,19,()=>r.project.frames,H=>H.id,(H,K,te)=>{var J=Yo(),W=u(J);{let be=q(()=>o(te)===r.project.activeFrameIndex),we=q(()=>o(t)===o(te)),Ce=q(()=>o(a)===o(te)&&o(t)!==o(te));Vo(W,{get frame(){return o(K)},get index(){return o(te)},get isActive(){return o(be)},get isDragged(){return o(we)},get isDropTarget(){return o(Ce)}})}var le=g(W,2);{var me=be=>{var we=zo();j(()=>re(we,1,`absolute top-0 bottom-0 z-50 w-0.5 bg-brand ${o(te)<(o(t)||0)?"-left-0.5":"-right-0.5"}`)),S(be,we)};V(le,be=>{o(a)===o(te)&&o(t)!==o(te)&&be(me)})}d(J),Ge("dragstart",J,()=>h(o(te))),Ge("dragover",J,be=>f(be,o(te))),Ge("drop",J,be=>x(be,o(te))),Ge("dragend",J,()=>{A(t,null),A(a,null)}),S(H,J)});var z=g(R,2);z.__click=()=>N.project.addFrame(),Pt(2),d(P);var Y=g(P,2);d(U),It(U,H=>A(s,H),()=>o(s)),d(F),j(()=>{fe(D,`width: ${o(_)??""}px; transform: translateX(-${o(n)??""}px);`),fe(P,`width: ${o(_)??""}px;`),fe(Y,`left: ${o(b)??""}px;`)}),Ge("wheel",F,I),Ge("scroll",U,v),S(p,F),oe()}Fe(["click"]);var Qo=O('<div class="flex h-32 w-full flex-col gap-1 overflow-hidden bg-transparent px-4 py-2" role="region" aria-label="Timeline"><div class="flex items-center justify-between border-b border-charcoal/5 pb-1"><div class="flex items-center gap-6"><div class="flex items-center gap-2"><span class="text-[10px] opacity-30" aria-hidden="true">⏳</span> <span class="font-tiny5 text-[9px] tracking-[0.2em] text-charcoal/40 uppercase"> </span></div> <!></div> <div class="flex items-center gap-4"><div class="flex flex-col items-end"><span class="font-serif text-[7px] font-black tracking-widest text-charcoal/20 uppercase"> </span> <span class="font-mono text-[9px] font-bold text-brand/40"> </span></div></div></div> <!></div>');function Xo(p,e){ie(e,!1),je();var t=Qo(),a=u(t),s=u(a),i=u(s),n=g(u(i),2),l=u(n,!0);d(n),d(i);var c=g(i,2);No(c,{}),d(s);var v=g(s,2),h=u(v),f=u(h),x=u(f,!0);d(f);var b=g(f,2),m=u(b,!0);d(b),d(h),d(v),d(a);var y=g(a,2);qo(y,{}),d(t),j((_,k,I)=>{T(l,_),T(x,k),T(m,I)},[()=>w({key:"timeline.title"}),()=>w({key:"timeline.track"}),()=>w({key:"timeline.pixel_count",replace:{count:r.project.frames.length}})]),S(p,t),oe()}var Wo=O('<footer class="hud-panel flex w-full flex-col border-t border-charcoal/10 bg-foam-white p-1 svelte-1tnr1yh"><!> <div class="flex h-7 w-full items-center justify-between px-4"><div class="flex items-center gap-4"><!></div> <!></div></footer>');function Zo(p){var e=Wo(),t=u(e);Xo(t,{});var a=g(t,2),s=u(a),i=u(s);ro(i,{}),d(s);var n=g(s,2);Bo(n),d(a),d(e),S(p,e)}var Jo=O('<div class="absolute top-0 bottom-0 left-1/2 z-30 w-px -translate-x-1/2 border-l border-dashed border-brand shadow-sm"></div>'),en=O('<div class="absolute top-1/2 right-0 left-0 z-30 h-px -translate-y-1/2 border-t border-dashed border-brand shadow-sm"></div>'),tn=O('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-charcoal/20"></div>'),an=O('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-charcoal/20"></div>'),rn=O('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-charcoal/40"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-charcoal/40"></div> <!> <!> <!> <!></div>');function sn(p,e){ie(e,!1);const t=r.studio;je();var a=rn(),s=g(u(a),4);{var i=h=>{var f=Jo();ce(3,f,()=>Ae),S(h,f)};V(s,h=>{(t.symmetryMode==="HORIZONTAL"||t.symmetryMode==="QUADRANT")&&h(i)})}var n=g(s,2);{var l=h=>{var f=en();ce(3,f,()=>Ae),S(h,f)};V(n,h=>{(t.symmetryMode==="VERTICAL"||t.symmetryMode==="QUADRANT")&&h(l)})}var c=g(n,2);De(c,0,()=>[-24,-16,-8,8,16,24],Ue,(h,f)=>{const x=Jt(()=>Ze.getGuidePosition(f,r.canvas.width));var b=Qe(),m=ye(b);{var y=_=>{var k=tn();j(()=>fe(k,`left: ${o(x)??""}%`)),S(_,k)};V(m,_=>{o(x)>0&&o(x)<100&&_(y)})}S(h,b)});var v=g(c,2);De(v,0,()=>[-24,-16,-8,8,16,24],Ue,(h,f)=>{const x=Jt(()=>Ze.getGuidePosition(f,r.canvas.height));var b=Qe(),m=ye(b);{var y=_=>{var k=an();j(()=>fe(k,`top: ${o(x)??""}%`)),S(_,k)};V(m,_=>{o(x)>0&&o(x)<100&&_(y)})}S(h,b)}),d(a),S(p,a),oe()}var on=yt('<line stroke-dasharray="0.2, 0.2" class="marching-ants-svg svelte-1onh8x1"></line>'),nn=yt('<line stroke="var(--color-brand)" stroke-width="0.05" stroke-dasharray="0.1, 0.1"></line>'),ln=yt('<circle r="0.2" fill="var(--color-brand)"></circle><!>',1),cn=yt('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><defs><pattern id="ants" width="1" height="1" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="1" y2="0" stroke="var(--ants-color)" stroke-width="0.1" stroke-dasharray="0.2, 0.2"></line></pattern></defs><!><!></svg><svg class="pointer-events-none absolute inset-0 z-[39] h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><path fill="var(--color-brand)" fill-opacity="0.1"></path></svg>',1);function dn(p,e){ie(e,!0);let t=q(()=>r.selection.getBoundaryEdges(r.canvas.width)),a=q(()=>r.selection.vertices),s=q(()=>Re.current.type==="SELECT");var i=Qe(),n=ye(i);{var l=c=>{var v=cn(),h=ye(v),f=g(u(h));De(f,17,()=>o(t),Ue,(_,k)=>{var I=on();M(I,"stroke-width",.08),j(()=>{M(I,"x1",o(k).x1),M(I,"y1",o(k).y1),M(I,"x2",o(k).x2),M(I,"y2",o(k).y2),M(I,"stroke",o(s)?"var(--color-brand)":"rgba(211, 54, 130, 0.8)")}),S(_,I)});var x=g(f);{var b=_=>{var k=Qe(),I=ye(k);De(I,17,()=>o(a),Ue,(F,B,D)=>{const U=q(()=>o(a)[D+1]||o(a)[0]);var P=ln(),R=ye(P),z=g(R);{var Y=H=>{var K=nn();j(()=>{M(K,"x1",o(B).x+.5),M(K,"y1",o(B).y+.5),M(K,"x2",o(U).x+.5),M(K,"y2",o(U).y+.5)}),S(H,K)};V(z,H=>{o(a).length>1&&D<o(a).length-(o(a).length>=3?0:1)&&H(Y)})}j(()=>{M(R,"cx",o(B).x+.5),M(R,"cy",o(B).y+.5)}),S(F,P)}),S(_,k)};V(x,_=>{o(a).length>0&&_(b)})}d(h);var m=g(h),y=u(m);d(m),j(_=>{M(h,"viewBox",`0 0 ${r.canvas.width??""} ${r.canvas.height??""}`),M(m,"viewBox",`0 0 ${r.canvas.width??""} ${r.canvas.height??""}`),M(y,"d",_)},[()=>r.selection.getPoints(r.canvas.width).map(_=>`M${_.x},${_.y}h1v1h-1z`).join(" ")]),S(c,v)};V(n,c=>{r.selection.isActive&&c(l)})}S(p,i),oe()}var un=O('<canvas class="pointer-events-none absolute inset-0 z-0 h-full w-full"></canvas>');function vn(p,e){ie(e,!0);let t=Le(e,"opacity",3,.2),a=L(null);lt(()=>{const i=o(a)?.getContext("2d");if(!(!i||!o(a))){i.imageSmoothingEnabled=!1,i.clearRect(0,0,e.width,e.height);for(let n=0;n<e.pixels.length;n++){const l=e.pixels[n];if(l!==0){const c=se.uint32ToHex(l);i.fillStyle=c;const v=n%e.width,h=Math.floor(n/e.width);i.fillRect(v,h,1,1)}}}});var s=un();It(s,i=>A(a,i),()=>o(a)),j(()=>{M(s,"width",e.width),M(s,"height",e.height),fe(s,`opacity: ${t()??""}; image-rendering: pixelated;`)}),S(p,s),oe()}var hn=O('<div class="absolute flex items-center justify-center"><span class="font-mono text-[8px] font-bold text-charcoal/40"> </span></div>'),pn=O('<div class="pointer-events-none relative h-full w-full overflow-hidden bg-latte-foam/80 backdrop-blur-sm" role="presentation"><div><div></div> <div></div> <!> <div class="absolute z-20 bg-brand transition-all duration-75 ease-out"><div class="absolute top-1/2 left-1/2 rounded-sm bg-brand px-1 py-0.5 shadow-sm"><span class="font-mono text-[9px] leading-none font-bold text-white"> </span></div></div></div></div>');function Ka(p,e){ie(e,!0);let t=Le(e,"orientation",3,"horizontal"),a=q(()=>r.canvas.width),s=q(()=>r.canvas.height),i=q(()=>t()==="horizontal"?o(a):o(s)),n=q(()=>t()==="horizontal"?r.cursor.pos.x:r.cursor.pos.y),l=q(()=>{const D=r.studio.zoomLevel;return D<=.5?16:D<=1.5?8:D<=4?4:2}),c=q(()=>r.canvas.getFitDimension(t())),v=q(()=>r.studio.zoomLevel),h=q(()=>{const D=[];for(let U=0;U<o(i);U++){const P=Ze.toCartesianLabel(U,o(i),t()==="vertical");(P%o(l)===0||U===0||U===o(i)-1)&&D.push({pos:U,label:P})}return D}),f=q(()=>{if(o(v)<=1)return t()==="horizontal"?"translate(-50%, 0)":"translate(0, -50%)";const D=(o(n)+.5)/o(i)*100;return t()==="horizontal"?`translate(-${D}%, 0)`:`translate(0, -${D}%)`});var x=pn(),b=u(x),m=u(b),y=g(m,2),_=g(y,2);De(_,17,()=>o(h),D=>D.pos,(D,U)=>{var P=hn(),R=u(P),z=u(R,!0);d(R),d(P),j(()=>{fe(P,`
					${t()==="horizontal"?"left":"top"}: ${o(U).pos/o(i)*100}%;
					${t()==="horizontal"?"width":"height"}: ${100/o(i)}%;
					${t()==="horizontal"?"height":"width"}: 100%;
					${t()==="horizontal"?"padding-bottom: 4px;":"padding-right: 4px;"}
				`),fe(R,`transform: ${t()==="vertical"?"rotate(-90deg)":"none"};`),T(z,o(U).label)}),S(D,P)});var k=g(_,2),I=u(k),F=u(I),B=u(F,!0);d(F),d(I),d(k),d(b),d(x),j(D=>{re(b,1,`absolute flex ${t()==="vertical"?"flex-col":""}`),fe(b,`
			left: ${t()==="horizontal"?"50%":"0"};
			top: ${t()==="vertical"?"50%":"0"};
			transform: ${o(f)??""}; 
			${t()==="horizontal"?"width":"height"}: calc(${o(c)??""} * ${o(v)??""});
			${t()==="vertical"?"width":"height"}: 100%;
		`),re(m,1,`absolute opacity-10 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-1/2":"top-0 right-0 bottom-0 w-1/2"}`),fe(m,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1px, transparent 1px);
				background-size: ${t()==="horizontal"?`calc(100% / ${o(i)}) 100%`:`100% calc(100% / ${o(i)})`};
			`),re(y,1,`absolute opacity-20 ${t()==="horizontal"?"right-0 bottom-0 left-0 h-3/4":"top-0 right-0 bottom-0 w-3/4"}`),fe(y,`
				background-image: linear-gradient(${t()==="horizontal"?"to right":"to bottom"}, 
					var(--color-charcoal) 1.5px, transparent 1.5px);
				background-size: ${t()==="horizontal"?`calc(100% / ${o(i)} * ${o(l)}) 100%`:`100% calc(100% / ${o(i)} * ${o(l)})`};
			`),fe(k,`
				${t()==="horizontal"?"left":"top"}: ${(o(n)+.5)/o(i)*100}%;
				${t()==="horizontal"?"width: 1px; top: 0; bottom: 0;":"height: 1px; left: 0; right: 0;"}
			`),fe(I,`transform: translate(-50%, -50%) ${t()==="vertical"?"rotate(-90deg)":""};`),T(B,D)},[()=>Ze.toCartesianLabel(o(n),o(i),t()==="vertical")]),S(p,x),oe()}var fn=O('<div class="absolute -top-3 -right-3 flex items-center justify-center rounded-full border-2 border-white bg-brand p-1 text-[8px] font-bold text-white shadow-lg ring-1 ring-black/5"><!></div>'),gn=O('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),xn=O('<div class="cursor-container absolute inset-0 svelte-13i93z"><div class="cursor-bloom transition-transform duration-200 svelte-13i93z"><div class="petal p-top svelte-13i93z"></div> <div class="petal p-bottom svelte-13i93z"></div> <div class="petal p-left svelte-13i93z"></div> <div class="petal p-right svelte-13i93z"></div> <div class="center-dot svelte-13i93z"></div></div> <!> <!></div>');function bn(p,e){ie(e,!1);const t=r.studio;je();var a=Qe(),s=ye(a);{var i=n=>{var l=xn(),c=u(l),v=g(c,2);{var h=b=>{var m=fn(),y=u(m);{var _=I=>{var F=dt("🔒");S(I,F)},k=I=>{var F=Qe(),B=ye(F);{var D=P=>{var R=dt("☀️");S(P,R)},U=P=>{var R=Qe(),z=ye(R);{var Y=K=>{var te=dt("🌙");S(K,te)},H=K=>{var te=Qe(),J=ye(te);{var W=le=>{var me=dt("🏁");S(le,me)};V(J,le=>{t.isShadingDither&&le(W)},!0)}S(K,te)};V(z,K=>{t.isShadingDarken?K(Y):K(H,!1)},!0)}S(P,R)};V(B,P=>{t.isShadingLighten?P(D):P(U,!1)},!0)}S(I,F)};V(y,I=>{t.isAlphaLocked||t.isColorLocked?I(_):I(k,!1)})}d(m),ce(3,m,()=>Rt),S(b,m)};V(v,b=>{(t.isAlphaLocked||t.isColorLocked||t.isShadingLighten||t.isShadingDarken||t.isShadingDither)&&b(h)})}var f=g(v,2);{var x=b=>{var m=gn(),y=ye(m),_=g(y,2),k=u(_),I=u(k);d(k),Pt(2),d(_),j(()=>{fe(y,`background-color: ${r.activeColor??""};`),fe(I,`background-color: ${r.activeColor??""};`)}),ce(3,y,()=>Ae,()=>({duration:400})),ce(1,_,()=>Ra,()=>({y:-10,duration:400})),ce(2,_,()=>Ae,()=>({duration:400})),S(b,m)};V(f,b=>{r.isPicking&&b(x)})}d(l),j(()=>fe(c,`transform: scale(${t.brushSize??""})`)),ce(3,l,()=>Ae,()=>({duration:800})),S(n,l)};V(s,n=>{r.isCursorVisible&&n(i)})}S(p,a),oe()}var mn=O('<div class="pointer-events-none absolute inset-0 z-0 opacity-20 blur-[1px] grayscale"></div>'),yn=O('<div class="pointer-events-none absolute inset-0 z-[5] overflow-hidden"><img alt="Underlay" class="absolute origin-top-left"/></div>'),_n=yt('<rect fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></rect>'),An=yt('<ellipse fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></ellipse>'),wn=yt('<line stroke="var(--color-brand)" stroke-width="0.1" class="shadow-sm"></line><circle r="0.3" fill="var(--color-brand)"></circle><circle r="0.3" fill="none" stroke="var(--color-brand)" stroke-width="0.05"></circle>',1),kn=yt('<polyline fill="none" stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></polyline><line stroke="var(--color-brand)" stroke-width="0.1" stroke-dasharray="0.2, 0.2" class="marching-ants svelte-e4xfdd"></line>',1),En=yt('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg>'),Sn=yt('<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline>'),Tn=O('<div class="canvas-viewport relative grid h-full w-full grid-cols-[20px_1fr] grid-rows-[20px_1fr] overflow-hidden svelte-e4xfdd"><div class="z-[110] border-r border-b border-charcoal/10 bg-foam-white/90 backdrop-blur-md" aria-hidden="true"></div> <div class="relative z-[100] border-b border-charcoal/10"><!></div> <div class="relative z-[100] border-r border-charcoal/10"><!></div> <div class="relative flex flex-1 items-center justify-center overflow-hidden bg-charcoal/[0.02]"><!> <div class="canvas-container absolute top-1/2 left-1/2 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] svelte-e4xfdd"><div class="relative h-full w-full shadow-[0_20px_60px_rgba(0,0,0,0.12)] ring-1 ring-charcoal/5 outline-none focus:ring-2 focus:ring-brand" role="grid" tabindex="0"><!> <!> <!> <canvas class="pointer-events-none absolute inset-0 h-full w-full" style="image-rendering: pixelated;"></canvas> <!> <div class="pixel-grid-surface pointer-events-none absolute inset-0 z-10 h-full w-full"></div> <div class="pointer-events-none absolute inset-0 z-30 overflow-hidden"><div class="absolute transition-all duration-75 ease-out"><!></div></div> <svg class="pointer-events-none absolute inset-0 z-[20] h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg> <!></div></div></div></div>');function Ln(p,e){ie(e,!0);let t=L(null),a=L(null),s=q(()=>r.canvas.width),i=q(()=>r.canvas.height),n=q(()=>{if(!r.showGhostLayers)return[];const G=r.project.activeFrameIndex,E=[];return G>0&&E.push({pixels:r.project.frames[G-1].compositePixels,opacity:.3}),G>1&&E.push({pixels:r.project.frames[G-2].compositePixels,opacity:.1}),E}),l=q(()=>mt.isSnappedState),c=q(()=>r.canvas.strokePoints.map(G=>`${G.x},${G.y}`).join(" ")),v=q(()=>r.studio.isTilingEnabled),h=L("");function f(G){if(G.ctrlKey){G.preventDefault();const E=G.deltaY>0?-.1:.1;r.studio.setZoom(E)}}lt(()=>{if(r.canvas.renderPulse===-1)return;const G=o(a)?.getContext("2d",{alpha:!0}),E=r.canvas.compositePixels;if(!G||!o(a))return;G.imageSmoothingEnabled=!1;const C=G.createImageData(o(s),o(i));new Uint32Array(C.data.buffer).set(E),G.putImageData(C,0,0),o(v)&&A(h,o(a).toDataURL(),!0)});var x=Tn();Ge("pointermove",ka,G=>o(t)&&mt.handleMove(G,o(t))),Ge("pointerup",ka,()=>mt.handleEnd());var b=g(u(x),2),m=u(b);Ka(m,{orientation:"horizontal"}),d(b);var y=g(b,2),_=u(y);Ka(_,{orientation:"vertical"}),d(y);var k=g(y,2),I=u(k);{var F=G=>{var E=mn();j((C,$)=>fe(E,`
					background-image: url(${o(h)??""});
					background-repeat: repeat;
					background-size: ${C??""} ${$??""};
					background-position: center;
					transform: ${r.cameraTransform??""};
				`),[()=>r.canvas.getFitDimension("horizontal"),()=>r.canvas.getFitDimension("vertical")]),ce(3,E,()=>Ae),S(G,E)};V(I,G=>{o(v)&&G(F)})}var B=g(I,2),D=u(B);D.__contextmenu=G=>G.preventDefault(),D.__pointerdown=G=>o(t)&&mt.handleStart(G,o(t));var U=u(D);sn(U,{});var P=g(U,2);{var R=G=>{var E=yn(),C=u(E);d(E),j(()=>{fe(E,`opacity: ${r.studio.underlayOpacity??""}`),M(C,"src",r.studio.underlayImage),fe(C,`
								transform: translate(${r.studio.underlayOffset.x??""}px, ${r.studio.underlayOffset.y??""}px) scale(${r.studio.underlayScale??""});
								image-rendering: auto;
							`)}),ce(3,E,()=>Ae),S(G,E)};V(P,G=>{r.studio.underlayImage&&r.studio.isUnderlayVisible&&G(R)})}var z=g(P,2);{var Y=G=>{var E=Qe(),C=ye(E);De(C,17,()=>o(n),Ue,($,ae)=>{vn($,{get pixels(){return o(ae).pixels},get width(){return o(s)},get height(){return o(i)},get opacity(){return o(ae).opacity}})}),S(G,E)};V(z,G=>{r.showGhostLayers&&G(Y)})}var H=g(z,2);It(H,G=>A(a,G),()=>o(a));var K=g(H,2);{var te=G=>{const E=q(()=>r.studio.shapeAnchor),C=q(()=>r.cursor.pos),$=q(()=>Math.min(o(E).x,o(C).x)),ae=q(()=>Math.min(o(E).y,o(C).y)),Q=q(()=>Math.max(o(E).x,o(C).x)),ve=q(()=>Math.max(o(E).y,o(C).y)),X=q(()=>o(Q)-o($)+1),xe=q(()=>o(ve)-o(ae)+1);var ke=En(),Xe=u(ke);{var Pe=ge=>{var Ie=_n();j(()=>{M(Ie,"x",o($)),M(Ie,"y",o(ae)),M(Ie,"width",o(X)),M(Ie,"height",o(xe))}),S(ge,Ie)},$e=ge=>{var Ie=Qe(),Me=ye(Ie);{var rt=Je=>{var Ee=An();j(()=>{M(Ee,"cx",o($)+o(X)/2),M(Ee,"cy",o(ae)+o(xe)/2),M(Ee,"rx",o(X)/2),M(Ee,"ry",o(xe)/2)}),S(Je,Ee)},Se=Je=>{var Ee=Qe(),ct=ye(Ee);{var ne=_e=>{var ze=wn(),Ye=ye(ze),Oe=g(Ye),st=g(Oe);j(()=>{M(Ye,"x1",o(E).x+.5),M(Ye,"y1",o(E).y+.5),M(Ye,"x2",o(C).x+.5),M(Ye,"y2",o(C).y+.5),M(Oe,"cx",o(E).x+.5),M(Oe,"cy",o(E).y+.5),M(st,"cx",o(C).x+.5),M(st,"cy",o(C).y+.5)}),S(_e,ze)},Te=_e=>{var ze=Qe(),Ye=ye(ze);{var Oe=st=>{const vt=q(()=>(o(E).x+o(C).x)/2),ft=q(()=>(o(E).y+o(C).y)/2),Ke=q(()=>Math.max(Math.abs(o(C).x-o(E).x),Math.abs(o(C).y-o(E).y))/2),Z=q(()=>r.studio.polygonSides),ue=q(()=>r.studio.polygonIndentation),qe=q(()=>Array.from({length:o(ue)>0?o(Z)*2:o(Z)}).map((St,gt)=>{const Tt=-Math.PI/2+gt*2*Math.PI/(o(ue)>0?o(Z)*2:o(Z)),_t=o(ue)>0?gt%2===0?o(Ke):o(Ke)*(1-o(ue)/100):o(Ke);return`${o(vt)+.5+Math.cos(Tt)*_t},${o(ft)+.5+Math.sin(Tt)*_t}`}));var et=kn(),Dt=ye(et),ht=g(Dt);j((St,gt,Tt,_t,Ht)=>{M(Dt,"points",St),M(ht,"x1",gt),M(ht,"y1",Tt),M(ht,"x2",_t),M(ht,"y2",Ht)},[()=>o(qe).join(" "),()=>o(vt)+.5+Math.cos(-Math.PI/2+((o(ue)>0?o(Z)*2:o(Z))-1)*2*Math.PI/(o(ue)>0?o(Z)*2:o(Z)))*(o(ue)>0?((o(ue)>0?o(Z)*2:o(Z))-1)%2===0?o(Ke):o(Ke)*(1-o(ue)/100):o(Ke)),()=>o(ft)+.5+Math.sin(-Math.PI/2+((o(ue)>0?o(Z)*2:o(Z))-1)*2*Math.PI/(o(ue)>0?o(Z)*2:o(Z)))*(o(ue)>0?((o(ue)>0?o(Z)*2:o(Z))-1)%2===0?o(Ke):o(Ke)*(1-o(ue)/100):o(Ke)),()=>o(vt)+.5+Math.cos(-Math.PI/2)*o(Ke),()=>o(ft)+.5+Math.sin(-Math.PI/2)*o(Ke)]),S(st,et)};V(Ye,st=>{r.studio.activeTool==="POLYGON"&&st(Oe)},!0)}S(_e,ze)};V(ct,_e=>{r.studio.activeTool==="GRADIENT"?_e(ne):_e(Te,!1)},!0)}S(Je,Ee)};V(Me,Je=>{r.studio.activeTool==="ELLIPSE"?Je(rt):Je(Se,!1)},!0)}S(ge,Ie)};V(Xe,ge=>{r.studio.activeTool==="RECTANGLE"?ge(Pe):ge($e,!1)})}d(ke),j(()=>M(ke,"viewBox",`0 0 ${o(s)??""} ${o(i)??""}`)),S(G,ke)};V(K,G=>{r.studio.activeTool!=="BRUSH"&&r.studio.shapeAnchor&&G(te)})}var J=g(K,2),W=g(J,2),le=u(W),me=u(le);bn(me,{}),d(le),d(W);var be=g(W,2),we=u(be);{var Ce=G=>{var E=Sn();j(()=>{M(E,"points",o(c)),M(E,"stroke",r.paletteState.activeColor),M(E,"stroke-width",o(l)?"0.08":"0.03"),M(E,"stroke-dasharray",o(l)?"none":"0.1 0.1"),re(E,0,`${o(l)?"drop-shadow-md":"marching-ants"} transition-all duration-300`,"svelte-e4xfdd"),fe(E,`opacity: ${o(l)?"1":"0.4"}`)}),S(G,E)};V(we,G=>{r.canvas.strokePoints.length>1&&G(Ce)})}d(be);var He=g(be,2);dn(He,{}),d(D),It(D,G=>A(t,G),()=>o(t)),d(B),d(k),d(x),j(G=>{fe(B,`
				transform: ${r.cameraTransform??""};
				aspect-ratio: ${o(s)??""} / ${o(i)??""};
				width: ${G??""};
			`),fe(D,`
										background-color: ${r.backgroundColor??""};
										touch-action: none;
										cursor: ${Re.current.type==="PAN"?mt.isPointerDownActive?"grabbing":"grab":"crosshair"};
									`),M(H,"width",o(s)),M(H,"height",o(i)),fe(J,`--grid-cols: ${o(s)??""}; --grid-rows: ${o(i)??""};`),fe(le,`
							left: ${r.cursor.pos.x/o(s)*100}%; 
							top: ${r.cursor.pos.y/o(i)*100}%; 
							width: ${100/o(s)}%; 
							height: ${100/o(i)}%;
						`),M(be,"viewBox",`0 0 ${o(s)??""} ${o(i)??""}`)},[()=>r.canvas.getFitDimension("horizontal")]),Ge("wheel",x,f),S(p,x),oe()}Fe(["contextmenu","pointerdown"]);function La(p){return--p*p*p*p*p+1}const Cn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var In=O(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-canvas-bg" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');" role="dialog" aria-modal="true"><div class="absolute h-[500px] w-[500px] animate-pulse rounded-full bg-charcoal/5 blur-[120px]" aria-hidden="true"></div> <div class="relative flex flex-col items-center gap-2"><div class="mb-8 flex animate-bounce items-center justify-center"><img alt="Rupa Café Logo" class="h-32 w-auto drop-shadow-2xl transition-transform duration-[3s] ease-in-out"/></div> <div><!></div></div> <div class="absolute bottom-24 flex flex-col items-center gap-8"><div class="flex flex-col items-center gap-4"><div class="h-1 w-48 overflow-hidden rounded-full bg-charcoal/5 ring-1 ring-charcoal/10" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div></div></div> <div class="flex flex-col items-center gap-1 text-center"><span class="h-4 font-serif text-[11px] tracking-wide text-charcoal/60 italic"> </span> <span class="font-mono text-[8px] font-bold tracking-[0.3em] text-charcoal/20 uppercase"> </span></div></div></div></div>`);function Pn(p,e){ie(e,!0);let t=L(!0),a=L(0),s=L(0),i=L(!1);const n=5;function l(){pe.emit("READY"),A(t,!1),setTimeout(()=>{r.isAppReady=!0,r.showGuideBook=!0},800)}Vt(()=>{pe.emit("STARTUP");const f=setInterval(()=>{if(o(a)<100){const x=Math.random()*15;A(a,Math.min(100,o(a)+x),!0),A(s,Math.min(n-1,Math.floor(o(a)/100*n)),!0)}else clearInterval(f),setTimeout(()=>{A(i,!0),l()},600)},400);return()=>{clearInterval(f)}});var c=Qe(),v=ye(c);{var h=f=>{var x=In(),b=g(u(x),2),m=u(b),y=u(m);fe(y,`transform: scale(${1+Math.sin(Date.now()/1500)*.05});`),d(m);var _=g(m,2),k=u(_);sr(k,{size:"lg"}),d(_),d(b);var I=g(b,2),F=u(I),B=u(F),D=u(B);d(B);var U=g(B,2),P=u(U),R=u(P,!0);d(P);var z=g(P,2),Y=u(z,!0);d(z),d(U),d(F),d(I),d(x),j((H,K,te)=>{M(x,"aria-busy",!o(i)),M(x,"aria-label",H),M(y,"src",Cn),M(B,"aria-valuenow",o(a)),re(D,1,`h-full bg-charcoal/20 transition-all duration-500 ease-out ${o(i)?"bg-brand/40":""}`),fe(D,`width: ${o(a)??""}%`),T(R,K),T(Y,te)},[()=>w({key:"manual.title"}),()=>o(i)?w({key:"splash.welcome"}):w({key:`splash.phases.${o(s)}`}),()=>w({key:"splash.version",replace:{version:r.version}})]),ce(1,m,()=>Rt,()=>({duration:1500,start:.9,easing:La})),ce(1,_,()=>Ra,()=>({y:15,duration:1e3,delay:400,easing:La})),ce(2,x,()=>Ae,()=>({duration:1e3})),S(f,x)};V(v,f=>{o(t)&&f(h)})}S(p,c),oe()}var Mn=O('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><div class="flex items-center gap-1.5"><span> </span> <span> </span></div> <span> </span></div> <input type="range"/></div>');function ra(p,e){ie(e,!0);let t=Le(e,"value",15),a=Le(e,"min",3,0),s=Le(e,"step",3,1),i=Le(e,"unit",3,""),n=Le(e,"isHue",3,!1);var l=Mn(),c=u(l),v=u(c),h=u(v),f=u(h,!0);d(h);var x=g(h,2),b=u(x,!0);d(x),d(v);var m=g(v,2),y=u(m);d(m),d(c);var _=g(c,2);Ne(_);let k;d(l),j(I=>{T(f,e.icon),T(b,e.label),T(y,`${I??""}${i()??""}`),M(_,"min",a()),M(_,"max",e.max),M(_,"step",s()),k=re(_,1,"custom-slider svelte-6nviod",null,k,{"hue-slider":n()})},[()=>s()<1?t().toFixed(2):Math.round(t())]),Ve(_,t),S(p,l),oe()}var On=O('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="presentation"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-canvas-bg p-10 shadow-2xl" role="dialog" aria-labelledby="flavor-basin-title" aria-modal="true"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl" aria-hidden="true">⛲</span> <div class="flex flex-col"><h2 id="flavor-basin-title" class="font-tiny5 text-3xl leading-none text-brand"> </h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/40 uppercase"> </span></div></div> <div class="editor-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner" aria-label="Color Preview"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><label for="hex-input" class="font-mono text-xs font-bold text-studio-text/40"> </label> <input id="hex-input" type="text" class="w-full bg-transparent font-mono text-lg font-bold text-studio-text uppercase focus:outline-none"/></div> <div class="flex gap-3"><button class="editor-secondary-btn flex h-14 w-14 items-center justify-center p-0 text-xl"><span aria-hidden="true">🖌️</span></button> <button class="editor-primary-btn flex-1 py-4"> </button></div></div></div></div>');function Da(p,e){ie(e,!0);let t=Le(e,"value",15),a=L(0),s=L(0),i=L(0),n=L(1);lt(()=>{const W=se.toHSLA(t());Et(()=>{A(a,W.h,!0),A(s,W.s,!0),A(i,W.l,!0),A(n,W.a,!0)})}),lt(()=>{const W=se.toHex({h:o(a),s:o(s),l:o(i),a:o(n)});Et(()=>{t(W)})});var l=On();l.__mousedown=W=>W.target===W.currentTarget&&e.onClose();var c=u(l),v=u(c),h=u(v),f=g(u(h),2),x=u(f),b=u(x,!0);d(x);var m=g(x,2),y=u(m,!0);d(m),d(f),d(h);var _=g(h,2);d(v);var k=g(v,2),I=u(k);{let W=q(()=>w({key:"color_picker.sliders.hue"}));ra(I,{get label(){return o(W)},icon:"🌈",max:360,unit:"°",isHue:!0,get value(){return o(a)},set value(le){A(a,le,!0)}})}var F=g(I,2);{let W=q(()=>w({key:"color_picker.sliders.saturation"}));ra(F,{get label(){return o(W)},icon:"🏺",max:100,unit:"%",get value(){return o(s)},set value(le){A(s,le,!0)}})}var B=g(F,2);{let W=q(()=>w({key:"color_picker.sliders.lightness"}));ra(B,{get label(){return o(W)},icon:"☀️",max:100,unit:"%",get value(){return o(i)},set value(le){A(i,le,!0)}})}var D=g(B,2);{let W=q(()=>w({key:"color_picker.sliders.alpha"}));ra(D,{get label(){return o(W)},icon:"💧",min:0,max:1,step:.01,unit:"",get value(){return o(n)},set value(le){A(n,le,!0)}})}d(k);var U=g(k,2),P=u(U),R=u(P),z=u(R,!0);d(R);var Y=g(R,2);Ne(Y),d(P);var H=g(P,2),K=u(H);K.__click=()=>{N.pickColor(),e.onClose()};var te=g(K,2);te.__click=function(...W){e.onClose?.apply(this,W)};var J=u(te,!0);d(te),d(H),d(U),d(c),d(l),j((W,le,me,be,we,Ce)=>{T(b,W),T(y,le),fe(_,`background-color: ${t()??""};`),T(z,me),M(K,"title",be),M(K,"aria-label",we),T(J,Ce)},[()=>w({key:"color_picker.title"}),()=>w({key:"color_picker.subtitle"}),()=>w({key:"color_picker.hex_label"}),()=>w({key:"color_picker.eye_drop"}),()=>w({key:"color_picker.eye_drop"}),()=>w({key:"color_picker.seal"})]),Ve(Y,t),ce(1,c,()=>Rt,()=>({duration:200,start:.95})),ce(2,c,()=>Rt,()=>({duration:150,start:1,opacity:0})),ce(3,l,()=>Ae,()=>({duration:150})),S(p,l),oe()}Fe(["mousedown","click"]);var Rn=O("<span> </span>"),Dn=O('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function jn(p,e){ie(e,!0);var t=Dn();t.__click=()=>{e.action.action(),e.onSelect()};var a=u(t),s=u(a,!0);d(a);var i=g(a,2);{var n=l=>{var c=Rn(),v=u(c,!0);d(c),j(()=>{re(c,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),T(v,e.action.shortcut)}),S(l,c)};V(i,l=>{e.action.shortcut&&l(n)})}d(t),j(()=>{re(t,1,`editor-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),T(s,e.action.label)}),Ge("mouseenter",t,function(...l){e.onSelect?.apply(this,l)}),S(p,t),oe()}Fe(["click"]);var Fn=O('<div class="p-8 text-center font-serif text-sm text-studio-text/40 italic"> </div>'),Gn=O('<div class="flex flex-col gap-1"></div>'),Bn=O('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="presentation"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/95 shadow-2xl" role="dialog" aria-labelledby="palette-title" aria-modal="true"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40" aria-hidden="true">📖</span> <h2 id="palette-title" class="sr-only"> </h2> <input id="palette-search" type="text" class="w-full bg-transparent font-serif text-xl text-studio-text focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-h74ewr" role="list"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div></div>');function $n(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showCommandPalette=!1),a=L(""),s=L(0);const n=at.getActions().map(R=>({...R,id:R.intent.toLowerCase().replace(/_/g,"-"),action:()=>{bt.handleIntent(R.intent)}}));let l=q(()=>n.filter(R=>R.label.toLowerCase().includes(o(a).toLowerCase())));lt(()=>{o(a),A(s,0)}),lt(()=>{o(s),o(l);const R=document.querySelector(".editor-action-btn.active");R&&R.scrollIntoView({block:"nearest"})});function c(R){R.key==="ArrowDown"?(R.preventDefault(),A(s,(o(s)+1)%o(l).length)):R.key==="ArrowUp"?(R.preventDefault(),A(s,(o(s)-1+o(l).length)%o(l).length)):R.key==="Enter"?(R.preventDefault(),o(l)[o(s)]&&(o(l)[o(s)].action(),t()())):R.key==="Escape"&&t()()}Vt(()=>document.getElementById("palette-search")?.focus());var v=Bn();v.__mousedown=R=>R.target===R.currentTarget&&t()(),v.__keydown=c;var h=u(v),f=u(h),x=g(u(f),2),b=u(x,!0);d(x);var m=g(x,2);Ne(m),d(f);var y=g(f,2),_=u(y);{var k=R=>{var z=Fn(),Y=u(z,!0);d(z),j(H=>T(Y,H),[()=>w({key:"hud.menu.catalog_no_results",replace:{query:o(a)}})]),S(R,z)},I=R=>{var z=Gn();De(z,21,()=>o(l),Ue,(Y,H,K)=>{{let te=q(()=>o(s)===K);jn(Y,{get action(){return o(H)},get isSelected(){return o(te)},onSelect:()=>A(s,K,!0)})}}),d(z),S(R,z)};V(_,R=>{o(l).length===0?R(k):R(I,!1)})}d(y);var F=g(y,2),B=u(F),D=u(B,!0);d(B);var U=g(B,2),P=u(U,!0);d(U),d(F),d(h),d(v),j((R,z,Y,H)=>{T(b,R),M(m,"placeholder",z),T(D,Y),T(P,H)},[()=>w({key:"hud.menu.catalog_title"}),()=>w({key:"hud.menu.catalog_search"}),()=>w({key:"hud.menu.catalog_footer"}),()=>w({key:"hud.menu.catalog_count",replace:{count:o(l).length}})]),Ve(m,()=>o(a),R=>A(a,R)),ce(3,h,()=>Rt,()=>({duration:150,start:.98})),S(p,v),oe()}Fe(["mousedown","keydown"]);var Nn=O('<span class="text-2xl opacity-40"> </span>'),Un=O('<span class="mt-1 font-serif text-[9px] font-black tracking-[0.2em] text-charcoal/30 uppercase"> </span>'),Vn=O('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-charcoal/20 backdrop-blur-md"><div class="flex flex-col gap-6 overflow-hidden rounded-xl border border-charcoal/10 bg-foam-white p-8 shadow-2xl" role="dialog" aria-modal="true" tabindex="-1"><div class="flex items-center justify-between border-b border-charcoal/5 pb-4"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-2xl leading-none text-charcoal"> </h2> <!></div></div> <button class="rounded-lg border border-charcoal/10 bg-stone-light/50 px-4 py-1.5 text-[9px] font-bold tracking-widest text-charcoal/40 uppercase transition-all hover:border-brand hover:bg-brand hover:text-white">Close</button></div> <div><!></div></div></div>');function Mt(p,e){ie(e,!0);let t=Le(e,"title",3,""),a=Le(e,"subtitle",3,""),s=Le(e,"icon",3,""),i=Le(e,"width",3,"500px"),n=Le(e,"maxHeight",3,"85vh"),l=Le(e,"scrollable",3,!0);lt(()=>(r.pushEscapeAction(e.onClose),()=>r.popEscapeAction(e.onClose)));function c(P,{duration:R=300}){return{duration:R,css:z=>{const Y=La(z);return`
					opacity: ${z};
					transform: scale(${.95+Y*.05});
				`}}}var v=Vn();v.__mousedown=P=>{P.stopPropagation(),P.target===P.currentTarget&&e.onClose()};var h=u(v);h.__mousedown=P=>P.stopPropagation();var f=u(h),x=u(f),b=u(x);{var m=P=>{var R=Nn(),z=u(R,!0);d(R),j(()=>T(z,s())),S(P,R)};V(b,P=>{s()&&P(m)})}var y=g(b,2),_=u(y),k=u(_,!0);d(_);var I=g(_,2);{var F=P=>{var R=Un(),z=u(R,!0);d(R),j(()=>T(z,a())),S(P,R)};V(I,P=>{a()&&P(F)})}d(y),d(x);var B=g(x,2);B.__click=function(...P){e.onClose?.apply(this,P)},d(f);var D=g(f,2),U=u(D);zr(U,()=>e.children),d(D),d(h),d(v),j(()=>{fe(h,`width: ${i()??""}; max-height: ${n()??""};`),T(k,t()),re(D,1,`custom-scrollbar flex-1 ${l()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),ce(1,h,()=>c,()=>({duration:300})),ce(2,h,()=>Ae,()=>({duration:150})),ce(3,v,()=>Ae,()=>({duration:150})),S(p,v),oe()}Fe(["mousedown","click"]);var Hn=O('<div class="flex flex-col items-center gap-3"><div class="editor-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function zn(p,e){ie(e,!0);let t=L(null);lt(()=>{if(!o(t))return;const f=o(t).getContext("2d");if(!f)return;const x=r.canvas.width,b=r.canvas.height,m=r.canvas.compositePixels,y=r.studio.includePixelBorders,_=400,k=Math.min(_/x,_/b);o(t).width=x*k,o(t).height=b*k,f.imageSmoothingEnabled=!1,e.bgColor==="transparent"?f.clearRect(0,0,o(t).width,o(t).height):(f.fillStyle=e.bgColor,f.fillRect(0,0,o(t).width,o(t).height)),m.forEach((I,F)=>{if(I===0)return;const B=se.uint32ToHex(I),D=F%x,U=Math.floor(F/x),P=Math.floor(D*k),R=Math.floor(U*k),z=Math.ceil(k),Y=Math.ceil(k);f.fillStyle=B,f.fillRect(P,R,z,Y),y&&(f.strokeStyle="rgba(0, 0, 0, 0.15)",f.lineWidth=1,f.strokeRect(P+.5,R+.5,z-1,Y-1))})});var a=Hn(),s=u(a),i=u(s);It(i,f=>A(t,f),()=>o(t)),d(s);var n=g(s,2),l=u(n),c=u(l);d(l);var v=g(l,2),h=u(v);d(v),d(n),d(a),j((f,x)=>{T(c,`${e.format??""} Artifact`),T(h,`${f??""} × ${x??""} pixels`)},[()=>Math.round(r.canvas.width*e.scale),()=>Math.round(r.canvas.height*e.scale)]),S(p,a),oe()}var Yn=O('<span class="font-serif text-[9px] font-bold text-brand italic opacity-60"> </span>'),Kn=O('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="fps-input" type="number" min="1" max="60" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div>',1),qn=O('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span aria-hidden="true">🎨</span> </button>'),Qn=O('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5" role="img" aria-label="Art Preview"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-8 overflow-y-auto pr-4" role="group" aria-label="Export Settings"><div class="flex flex-col gap-3"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"> </span> <div class="grid grid-cols-2 gap-3" role="radiogroup" aria-label="Static Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">🖼️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">🕸️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📷</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📐</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button></div></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"> </span> <!></div> <div role="radiogroup" aria-label="Animated Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">🎬</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">🎀</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📽️</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">📐</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"> </h3></div></button></div></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="scale-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="scale-input" type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <!> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-charcoal/60 uppercase">Pixel Borders</span> <span class="font-serif text-[10px] text-charcoal/40">Include grid lines on colored drops</span></div> <button aria-label="Toggle Pixel Borders"><div></div></button></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </span> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <div class="flex flex-wrap items-center gap-3" role="radiogroup" aria-label="Background Type"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" title="Transparent" role="radio"></button> <button title="Cream" role="radio"></button> <button title="Black" role="radio"></button> <div class="flex items-center gap-2"><button title="Custom Backdrop" role="radio"></button></div></div> <!></div></div> <button class="editor-primary-btn w-full py-5 text-xl"> </button></div></div>'),Xn=O("<!> <!>",1);function Wn(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showExportMenu=!1),a=L("png"),s=L(!1),i=L(Be(r.backgroundColor));Vt(()=>{r.backgroundColor!=="#eee8d5"&&(r.studio.exportBgColor=r.backgroundColor,A(i,r.backgroundColor,!0))}),lt(()=>{r.studio.exportBgColor!=="transparent"&&r.studio.exportBgColor!=="#eee8d5"&&r.studio.exportBgColor!=="#000000"&&(r.studio.exportBgColor=o(i))}),lt(()=>{const h=["webm","gif","mp4"].includes(o(a))||o(a)==="svg"&&r.project.frames.length>1;r.project.frames.length<=1&&h&&A(a,"png")});var n=Xn(),l=ye(n);{var c=h=>{Da(h,{onClose:()=>A(s,!1),get value(){return o(i)},set value(f){A(i,f,!0)}})};V(l,h=>{o(s)&&h(c)})}var v=g(l,2);{let h=q(()=>w({key:"export.title"})),f=q(()=>w({key:"export.subtitle"}));Mt(v,{get title(){return o(h)},get subtitle(){return o(f)},icon:"🧺",get onClose(){return t()},width:"1000px",scrollable:!1,children:(x,b)=>{var m=Qn(),y=u(m),_=u(y);zn(_,{get format(){return o(a)},get scale(){return r.studio.exportScale},get bgColor(){return r.studio.exportBgColor}}),d(y);var k=g(y,2),I=u(k),F=u(I),B=u(F,!0);d(F);var D=g(F,2),U=u(D);U.__click=()=>A(a,"png");var P=g(u(U),2),R=u(P),z=u(R,!0);d(R),d(P),d(U);var Y=g(U,2);Y.__click=()=>A(a,"webp");var H=g(u(Y),2),K=u(H),te=u(K,!0);d(K),d(H),d(Y);var J=g(Y,2);J.__click=()=>A(a,"jpg");var W=g(u(J),2),le=u(W),me=u(le,!0);d(le),d(W),d(J);var be=g(J,2);be.__click=()=>A(a,"svg");var we=g(u(be),2),Ce=u(we),He=u(Ce,!0);d(Ce),d(we),d(be),d(D),d(I);var G=g(I,2),E=u(G),C=u(E),$=u(C,!0);d(C);var ae=g(C,2);{var Q=We=>{var tt=Yn(),xt=u(tt,!0);d(tt),j(pt=>T(xt,pt),[()=>w({key:"export.requires_frames"})]),S(We,tt)};V(ae,We=>{r.project.frames.length<=1&&We(Q)})}d(E);var ve=g(E,2),X=u(ve);X.__click=()=>A(a,"webm");var xe=g(u(X),2),ke=u(xe),Xe=u(ke,!0);d(ke),d(xe),d(X);var Pe=g(X,2);Pe.__click=()=>A(a,"gif");var $e=g(u(Pe),2),ge=u($e),Ie=u(ge,!0);d(ge),d($e),d(Pe);var Me=g(Pe,2);Me.__click=()=>A(a,"mp4");var rt=g(u(Me),2),Se=u(rt),Je=u(Se,!0);d(Se),d(rt),d(Me);var Ee=g(Me,2);Ee.__click=()=>A(a,"svg");var ct=g(u(Ee),2),ne=u(ct),Te=u(ne,!0);d(ne),d(ct),d(Ee),d(ve),d(G);var _e=g(G,2),ze=u(_e),Ye=u(ze),Oe=u(Ye),st=u(Oe,!0);d(Oe);var vt=g(Oe,2),ft=u(vt,!0);d(vt),d(Ye);var Ke=g(Ye,2);Ne(Ke),d(ze);var Z=g(ze,2);{var ue=We=>{var tt=Kn(),xt=g(ye(tt),2),pt=u(xt),Ot=u(pt),Kt=u(Ot,!0);d(Ot);var $t=g(Ot,2),ua=u($t,!0);d($t),d(pt);var ta=g(pt,2);Ne(ta),d(xt),j((qt,va)=>{T(Kt,qt),T(ua,va)},[()=>w({key:"export.fps_label"}),()=>w({key:"export.fps_desc"})]),Ve(ta,()=>r.studio.fps,qt=>r.studio.fps=qt),S(We,tt)};V(Z,We=>{(o(a)==="webm"||o(a)==="gif"||o(a)==="mp4"||o(a)==="svg"&&r.project.frames.length>1)&&We(ue)})}var qe=g(Z,4),et=g(u(qe),2);et.__click=()=>r.studio.includePixelBorders=!r.studio.includePixelBorders;var Dt=u(et);d(et),d(qe);var ht=g(qe,4),St=u(ht),gt=u(St),Tt=u(gt,!0);d(gt);var _t=g(gt,2),Ht=u(_t,!0);d(_t),d(St);var zt=g(St,2),jt=u(zt);jt.__click=()=>r.studio.exportBgColor="transparent";var Ft=g(jt,2);Ft.__click=()=>r.studio.exportBgColor="#eee8d5";var Gt=g(Ft,2);Gt.__click=()=>r.studio.exportBgColor="#000000";var ea=g(Gt,2),Bt=u(ea);Bt.__click=()=>{r.studio.exportBgColor=o(i),A(s,!0)},d(ea),d(zt);var la=g(zt,2);{var ca=We=>{var tt=qn();tt.__click=()=>{A(i,r.backgroundColor,!0),r.studio.exportBgColor=o(i)};var xt=g(u(tt));d(tt),j(pt=>T(xt,` ${pt??""}`),[()=>w({key:"export.match_background"})]),S(We,tt)};V(la,We=>{r.backgroundColor!=="#eee8d5"&&We(ca)})}d(ht),d(_e);var Yt=g(_e,2);Yt.__click=()=>e.onExport(o(a),r.studio.exportScale,r.studio.exportBgColor);var da=u(Yt,!0);d(Yt),d(k),d(m),j((We,tt,xt,pt,Ot,Kt,$t,ua,ta,qt,va,ir,or,nr,lr)=>{T(B,We),re(U,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(U,"aria-checked",o(a)==="png"),T(z,tt),re(Y,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="webp"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(Y,"aria-checked",o(a)==="webp"),T(te,xt),re(J,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="jpg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(J,"aria-checked",o(a)==="jpg"),T(me,pt),re(be,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="svg"&&r.project.frames.length<=1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),M(be,"aria-checked",o(a)==="svg"&&r.project.frames.length<=1),T(He,Ot),T($,Kt),re(ve,1,`grid grid-cols-2 gap-3 ${r.project.frames.length<=1?"opacity-40":""}`),re(X,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="webm"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),X.disabled=r.project.frames.length<=1,M(X,"aria-checked",o(a)==="webm"),T(Xe,$t),re(Pe,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="gif"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Pe.disabled=r.project.frames.length<=1,M(Pe,"aria-checked",o(a)==="gif"),T(Ie,ua),re(Me,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="mp4"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Me.disabled=r.project.frames.length<=1,M(Me,"aria-checked",o(a)==="mp4"),T(Je,ta),re(Ee,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${o(a)==="svg"&&r.project.frames.length>1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Ee.disabled=r.project.frames.length<=1,M(Ee,"aria-checked",o(a)==="svg"&&r.project.frames.length>1),T(Te,qt),T(st,va),T(ft,ir),re(et,1,`flex h-6 w-12 items-center rounded-full transition-colors ${r.studio.includePixelBorders?"bg-brand":"bg-charcoal/10"}`),re(Dt,1,`h-4 w-4 rounded-full bg-white shadow-sm transition-transform ${r.studio.includePixelBorders?"translate-x-7":"translate-x-1"}`),T(Tt,or),T(Ht,nr),re(jt,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),M(jt,"aria-checked",r.studio.exportBgColor==="transparent"),re(Ft,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),M(Ft,"aria-checked",r.studio.exportBgColor==="#eee8d5"),re(Gt,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),M(Gt,"aria-checked",r.studio.exportBgColor==="#000000"),re(Bt,1,`h-10 w-16 rounded-xl border-2 ${r.studio.exportBgColor===o(i)?"border-brand":"border-black/5"} editor-checker-small transition-transform hover:scale-105`),fe(Bt,`background-color: ${o(i)??""};`),M(Bt,"aria-checked",r.studio.exportBgColor===o(i)),T(da,lr)},[()=>w({key:"export.static_title"}),()=>w({key:"export.formats.png"}),()=>w({key:"export.formats.webp"}),()=>w({key:"export.formats.jpg"}),()=>w({key:"export.formats.svg_static"}),()=>w({key:"export.kinetic_title"}),()=>w({key:"export.formats.webm"}),()=>w({key:"export.formats.gif"}),()=>w({key:"export.formats.mp4"}),()=>w({key:"export.formats.svg_kinetic"}),()=>w({key:"export.scale_label"}),()=>w({key:"export.scale_desc"}),()=>w({key:"export.bg_label"}),()=>w({key:"export.bg_desc"}),()=>w({key:"export.action"})]),Ve(Ke,()=>r.studio.exportScale,We=>r.studio.exportScale=We),S(x,m)},$$slots:{default:!0}})}S(p,n),oe()}Fe(["click"]);var Zn=O('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function Jn(p,e){ie(e,!0);var t=Zn(),a=u(t),s=u(a,!0);d(a);var i=g(a,2),n=u(i,!0);d(i),d(t),j(l=>{T(s,e.label),T(n,l)},[()=>e.customKey||at.getLabel(e.intent)]),S(p,t),oe()}var el=O('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function tl(p,e){ie(e,!0);var t=el(),a=u(t),s=u(a,!0);d(a);var i=g(a,2);De(i,21,()=>e.group.items,Ue,(n,l)=>{Jn(n,{get intent(){return o(l).intent},get label(){return o(l).label},get customKey(){return o(l).customKey}})}),d(i),d(t),j(()=>T(s,e.group.group)),S(p,t),oe()}var al=O('<div class="flex flex-col"><span class="font-tiny5 text-[10px] text-brand uppercase"> </span> <span class="font-serif text-[10px] text-charcoal/40 italic"> </span></div>'),rl=O('<div class="flex flex-col gap-12" role="document"><header class="flex flex-col gap-2 rounded-xl bg-charcoal/5 p-6 ring-1 ring-charcoal/10" aria-labelledby="guide-header-title"><h3 id="guide-header-title" class="font-tiny5 text-xl text-charcoal uppercase"> </h3> <p class="font-serif text-xs leading-relaxed text-charcoal/60"> </p> <div class="mt-4 grid grid-cols-3 gap-4 border-t border-charcoal/5 pt-4"></div></header> <div class="grid grid-cols-2 gap-x-16 gap-y-12"></div> <footer class="mt-4 border-t border-charcoal/5 pt-8 text-center"><p class="font-serif text-[11px] text-charcoal/40 italic"> </p></footer></div>');function sl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showGuideMenu=!1);const a=q(()=>at.getGroupedActions());{let s=q(()=>w({key:"shortcuts.title"})),i=q(()=>w({key:"shortcuts.subtitle"}));Mt(p,{get title(){return o(s)},get subtitle(){return o(i)},icon:"☕",get onClose(){return t()},width:"1000px",children:(n,l)=>{var c=rl(),v=u(c),h=u(v),f=u(h,!0);d(h);var x=g(h,2),b=u(x,!0);d(x);var m=g(x,2);De(m,20,()=>[["Cup","Frame"],["Infusion","Layer"],["Flavor","Color"],["Vessel","Brush/Tool"],["Pour","Paint"],["Spill","Delete"]],Ue,(F,B)=>{var D=q(()=>Vr(B,2));let U=()=>o(D)[0],P=()=>o(D)[1];var R=al(),z=u(R),Y=u(z,!0);d(z);var H=g(z,2),K=u(H);d(H),d(R),j(()=>{T(Y,U()),T(K,`meaning ${P()??""}`)}),S(F,R)}),d(m),d(v);var y=g(v,2);De(y,21,()=>o(a),Ue,(F,B)=>{tl(F,{get group(){return o(B)}})}),d(y);var _=g(y,2),k=u(_),I=u(k);d(k),d(_),d(c),j((F,B,D)=>{T(f,F),T(b,B),T(I,`"${D??""}"`)},[()=>w({key:"shortcuts.header_title"}),()=>w({key:"shortcuts.header_desc"}),()=>w({key:"shortcuts.footer_quote"})]),S(n,c)},$$slots:{default:!0}})}oe()}var il=O(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Recipe Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your art as a dedicated recipe file on your machine or in your browser's local store.</p></div> <div class="flex flex-col gap-3"><button class="editor-primary-btn w-full">Store Recipe to File</button> <button class="editor-secondary-btn w-full">Load Recipe from File</button></div></div>`);function ol(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showPersistenceMenu=!1);Mt(p,{title:"Recipe Store",subtitle:"Managing Digital Creations",icon:"💾",get onClose(){return t()},width:"400px",children:(a,s)=>{var i=il(),n=g(u(i),2),l=u(n);l.__click=()=>{N.persistence.save(),t()()};var c=g(l,2);c.__click=()=>{N.persistence.load(),t()()},d(n),d(i),S(a,i)},$$slots:{default:!0}}),oe()}Fe(["click"]);var nl=O('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="stab-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <span class="font-mono text-sm font-bold text-brand"> </span></div> <input id="stab-input" type="range" min="0" max="100" class="h-1.5 w-full cursor-pointer appearance-none rounded-lg bg-black/5 accent-brand"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </label> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <input id="fps-input" type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"> </span> <span class="font-serif text-[10px] text-studio-text/40"> </span></div> <button class="group relative flex items-center gap-3" aria-label="Change Backdrop Color"><div class="editor-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">🎨</div></button></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="editor-primary-btn w-full py-4 text-lg"> </button></div>'),ll=O("<!> <!>",1);function cl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showCanvasSettings=!1),a=L(Be(r.canvas.width)),s=L(Be(r.canvas.height)),i=L(!1);function n(){N.manipulation.resize(o(a),o(s)),t()()}var l=ll(),c=ye(l);{var v=f=>{Da(f,{onClose:()=>A(i,!1),get value(){return r.backgroundColor},set value(x){r.backgroundColor=x}})};V(c,f=>{o(i)&&f(v)})}var h=g(c,2);{let f=q(()=>w({key:"settings.title"})),x=q(()=>w({key:"settings.subtitle"}));Mt(h,{get title(){return o(f)},get subtitle(){return o(x)},icon:"📐",get onClose(){return t()},width:"450px",children:(b,m)=>{var y=nl(),_=u(y),k=u(_),I=u(k),F=u(I),B=u(F,!0);d(F);var D=g(F,2);Ne(D),d(I);var U=g(I,2),P=u(U),R=u(P,!0);d(P);var z=g(P,2);Ne(z),d(U),d(k);var Y=g(k,4),H=u(Y),K=u(H),te=u(K),J=u(te,!0);d(te);var W=g(te,2),le=u(W,!0);d(W),d(K);var me=g(K,2),be=u(me);d(me),d(H);var we=g(H,2);Ne(we),d(Y);var Ce=g(Y,4),He=u(Ce),G=u(He),E=u(G,!0);d(G);var C=g(G,2),$=u(C,!0);d(C),d(He);var ae=g(He,2);Ne(ae),d(Ce);var Q=g(Ce,4),ve=u(Q),X=u(ve),xe=u(X,!0);d(X);var ke=g(X,2),Xe=u(ke,!0);d(ke),d(ve);var Pe=g(ve,2);Pe.__click=()=>A(i,!0);var $e=u(Pe);Pt(2),d(Pe),d(Q);var ge=g(Q,2),Ie=u(ge,!0);d(ge),d(_);var Me=g(_,2);Me.__click=n;var rt=u(Me,!0);d(Me),d(y),j((Se,Je,Ee,ct,ne,Te,_e,ze,Ye,Oe)=>{T(B,Se),T(R,Je),T(J,Ee),T(le,ct),T(be,`${r.studio.stabilization??""}%`),T(E,ne),T($,Te),T(xe,_e),T(Xe,ze),fe($e,`background-color: ${r.backgroundColor??""};`),T(Ie,Ye),T(rt,Oe)},[()=>w({key:"settings.width"}),()=>w({key:"settings.height"}),()=>w({key:"settings.stabilization"}),()=>w({key:"settings.stabilization_desc"}),()=>w({key:"settings.weave_pace"}),()=>w({key:"settings.fps_desc"}),()=>w({key:"settings.backdrop"}),()=>w({key:"settings.backdrop_desc"}),()=>w({key:"settings.note"}),()=>w({key:"settings.apply"})]),Ve(D,()=>o(a),Se=>A(a,Se)),Ve(z,()=>o(s),Se=>A(s,Se)),Ve(we,()=>r.studio.stabilization,Se=>r.studio.stabilization=Se),Ve(ae,()=>r.studio.fps,Se=>r.studio.fps=Se),S(b,y)},$$slots:{default:!0}})}S(p,l),oe()}Fe(["click"]);var dl=O('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"> </label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="editor-primary-btn w-full py-4 text-lg"> </button></div>');function ul(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.studio.showGoTo=!1),a=L(Be(r.displayCoords.x)),s=L(Be(r.displayCoords.y));function i(){N.jumpTo(o(a),o(s)),t()()}function n(l){l.key==="Enter"&&i()}Vt(()=>{document.getElementById("goto-x")?.focus()});{let l=q(()=>w({key:"goto.title"})),c=q(()=>w({key:"goto.subtitle"}));Mt(p,{get title(){return o(l)},get subtitle(){return o(c)},icon:"📍",get onClose(){return t()},width:"400px",children:(v,h)=>{var f=dl(),x=u(f),b=u(x),m=u(b),y=u(m),_=u(y,!0);d(y);var k=g(y,2);Ne(k),k.__keydown=n,d(m);var I=g(m,2),F=u(I),B=u(F,!0);d(F);var D=g(F,2);Ne(D),D.__keydown=n,d(I),d(b);var U=g(b,2),P=u(U,!0);d(U),d(x);var R=g(x,2);R.__click=i;var z=u(R,!0);d(R),d(f),j((Y,H,K,te)=>{T(_,Y),T(B,H),T(P,K),T(z,te)},[()=>w({key:"goto.label_x"}),()=>w({key:"goto.label_y"}),()=>w({key:"goto.current",replace:{x:r.displayCoords.x,y:r.displayCoords.y}}),()=>w({key:"goto.action"})]),Ve(k,()=>o(a),Y=>A(a,Y)),Ve(D,()=>o(s),Y=>A(s,Y)),S(v,f)},$$slots:{default:!0}})}oe()}Fe(["keydown","click"]);var vl=O('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all café resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Sound Effects (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="editor-range w-full svelte-3e27cw"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Ambiance Flow</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="editor-primary-btn w-full py-4">Apply Settings</button></div>');function hl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showAudioSettings=!1);Mt(p,{title:"Audio Settings",subtitle:"Harmony & Ambiance Tuning",icon:"🔊",get onClose(){return t()},width:"450px",children:(a,s)=>{var i=vl(),n=u(i),l=g(u(n),2);l.__click=()=>r.toggleMute();var c=u(l,!0);d(l),d(n);var v=g(n,2),h=u(v),f=u(h),x=g(u(f),2),b=u(x);d(x),d(f);var m=g(f,2);Ne(m),d(h);var y=g(h,2),_=u(y),k=g(u(_),2),I=u(k);d(k),d(_);var F=g(_,2);Ne(F),d(y),d(v);var B=g(v,2),D=g(u(B),2),U=u(D),P=g(u(U),2),R=u(P);d(P),d(U);var z=g(U,2),Y=u(z);{var H=J=>{var W=dt(`The piano awaits in silence. It will begin to play its melody after 30 minutes of
						creativity.`);S(J,W)},K=J=>{var W=dt("The piano has begun its flow. Volume will reach full depth at 60 minutes.");S(J,W)};V(Y,J=>{r.usageMinutes<30?J(H):J(K,!1)})}d(z),d(D),d(B);var te=g(B,2);te.__click=function(...J){t()?.apply(this,J)},d(i),j((J,W)=>{re(l,1,`editor-secondary-btn !px-6 !py-2 ${r.isMuted?"bg-brand text-white":""}`),T(c,r.isMuted?"🔇 Muted":"🔊 Active"),T(b,`${J??""}%`),T(I,`${W??""}%`),T(R,`${r.usageMinutes??""} minutes`)},[()=>Math.round(r.sfxVolume*100),()=>Math.round(r.bgmVolume*100)]),Ve(m,()=>r.sfxVolume,J=>r.sfxVolume=J),Ve(F,()=>r.bgmVolume,J=>r.bgmVolume=J),S(a,i)},$$slots:{default:!0}}),oe()}Fe(["click"]);var pl=O('<div class="flex flex-col gap-12" role="document"><section class="flex flex-col gap-6" aria-labelledby="philosophy-title"><div class="flex items-center gap-4 border-b border-black/5 pb-4"><span class="text-3xl" aria-hidden="true">🕯️</span> <h3 id="philosophy-title" class="font-tiny5 text-3xl tracking-tighter text-brand uppercase"> </h3></div> <div class="space-y-4 font-serif text-base leading-relaxed text-studio-text/80"><p> </p> <p> </p> <p class="text-brand/60 italic"> </p></div></section> <div class="grid grid-cols-3 gap-6" role="list"><div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">☕</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">🧪</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">🥞</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"> </h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"> </p></div></div> <section class="flex flex-col gap-8 rounded-3xl bg-brand/5 p-10 ring-1 ring-brand/10" aria-labelledby="techniques-title"><h3 id="techniques-title" class="font-tiny5 text-2xl tracking-tighter text-brand uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-8"><div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🥛</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🪄</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">⏳</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">🎹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"> </span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"> </p></div></div></div></section> <footer class="flex flex-col items-center gap-6 border-t border-black/5 pt-10 text-center"><div class="flex flex-col items-center gap-2"><p class="font-serif text-sm text-studio-text/50 italic"> </p> <span class="font-tiny5 text-[10px] tracking-[0.3em] text-studio-text/30 uppercase"> </span></div> <div class="flex items-center gap-4"><button class="editor-secondary-btn px-10 py-4"> </button> <button class="editor-primary-btn px-16 py-4 text-xl"> </button></div></footer></div>');function fl(p,e){ie(e,!0);let t=Le(e,"onClose",3,()=>r.showGuideBook=!1);{let a=q(()=>w({key:"manual.title"})),s=q(()=>w({key:"manual.subtitle"}));Mt(p,{get title(){return o(a)},get subtitle(){return o(s)},icon:"📜",get onClose(){return t()},width:"850px",children:(i,n)=>{var l=pl(),c=u(l),v=u(c),h=g(u(v),2),f=u(h,!0);d(h),d(v);var x=g(v,2),b=u(x),m=u(b,!0);d(b);var y=g(b,2),_=u(y,!0);d(y);var k=g(y,2),I=u(k,!0);d(k),d(x),d(c);var F=g(c,2),B=u(F),D=g(u(B),2),U=u(D,!0);d(D);var P=g(D,2),R=u(P,!0);d(P),d(B);var z=g(B,2),Y=g(u(z),2),H=u(Y,!0);d(Y);var K=g(Y,2),te=u(K,!0);d(K),d(z);var J=g(z,2),W=g(u(J),2),le=u(W,!0);d(W);var me=g(W,2),be=u(me,!0);d(me),d(J),d(F);var we=g(F,2),Ce=u(we),He=u(Ce,!0);d(Ce);var G=g(Ce,2),E=u(G),C=g(u(E),2),$=u(C),ae=u($,!0);d($);var Q=g($,2),ve=u(Q,!0);d(Q),d(C),d(E);var X=g(E,2),xe=g(u(X),2),ke=u(xe),Xe=u(ke,!0);d(ke);var Pe=g(ke,2),$e=u(Pe,!0);d(Pe),d(xe),d(X);var ge=g(X,2),Ie=g(u(ge),2),Me=u(Ie),rt=u(Me,!0);d(Me);var Se=g(Me,2),Je=u(Se,!0);d(Se),d(Ie),d(ge);var Ee=g(ge,2),ct=g(u(Ee),2),ne=u(ct),Te=u(ne,!0);d(ne);var _e=g(ne,2),ze=u(_e,!0);d(_e),d(ct),d(Ee),d(G),d(we);var Ye=g(we,2),Oe=u(Ye),st=u(Oe),vt=u(st);d(st);var ft=g(st,2),Ke=u(ft,!0);d(ft),d(Oe);var Z=g(Oe,2),ue=u(Z);ue.__click=()=>{t()(),r.showGuideMenu=!0};var qe=u(ue,!0);d(ue);var et=g(ue,2);et.__click=function(...ht){t()?.apply(this,ht)};var Dt=u(et,!0);d(et),d(Z),d(Ye),d(l),j((ht,St,gt,Tt,_t,Ht,zt,jt,Ft,Gt,ea,Bt,la,ca,Yt,da,We,tt,xt,pt,Ot,Kt,$t)=>{T(f,ht),T(m,St),T(_,gt),T(I,Tt),T(U,_t),T(R,Ht),T(H,zt),T(te,jt),T(le,Ft),T(be,Gt),T(He,ea),T(ae,Bt),T(ve,la),T(Xe,ca),T($e,Yt),T(rt,da),T(Je,We),T(Te,tt),T(ze,xt),T(vt,`"${pt??""}"`),T(Ke,Ot),T(qe,Kt),T(Dt,$t)},[()=>w({key:"manual.philosophy.title"}),()=>w({key:"manual.philosophy.p1"}),()=>w({key:"manual.philosophy.p2"}),()=>w({key:"manual.philosophy.p3"}),()=>w({key:"manual.pillars.cursor.title"}),()=>w({key:"manual.pillars.cursor.desc"}),()=>w({key:"manual.pillars.colors.title"}),()=>w({key:"manual.pillars.colors.desc"}),()=>w({key:"manual.pillars.layers.title"}),()=>w({key:"manual.pillars.layers.desc"}),()=>w({key:"manual.techniques.title"}),()=>w({key:"manual.techniques.continuous.title"}),()=>w({key:"manual.techniques.continuous.desc"}),()=>w({key:"manual.techniques.magic_select.title"}),()=>w({key:"manual.techniques.magic_select.desc"}),()=>w({key:"manual.techniques.timeline.title"}),()=>w({key:"manual.techniques.timeline.desc"}),()=>w({key:"manual.techniques.audio.title"}),()=>w({key:"manual.techniques.audio.desc"}),()=>w({key:"manual.footer.quote"}),()=>w({key:"manual.footer.guild"}),()=>w({key:"manual.footer.all_shortcuts"}),()=>w({key:"manual.footer.enter"})]),S(i,l)},$$slots:{default:!0}})}oe()}Fe(["click"]);var gl=O('<div class="grid grid-cols-2 gap-4"><div class="flex flex-col gap-2"><span class="text-xs font-bold text-charcoal/60 uppercase">Visibility</span> <button class="editor-tool-btn justify-center"> </button></div> <div class="flex flex-col gap-2"><label class="text-xs font-bold text-charcoal/60 uppercase" for="underlay-opacity"> </label> <input id="underlay-opacity" type="range" min="0" max="1" step="0.05" class="accent-brand"/></div></div> <div class="flex flex-col gap-2"><span class="text-xs font-bold text-charcoal/60 uppercase">Manual Positioning</span> <div class="flex items-center gap-4"><button class="editor-tool-btn text-xs">Reset View</button> <span class="text-[10px] text-charcoal/40 italic">Use Ctrl + Alt + Arrows to nudge on canvas.</span></div></div> <div class="border-t border-charcoal/5 pt-4"><button class="w-full text-xs text-red-500 hover:underline">Clear Reference Image</button></div>',1),xl=O('<div class="flex flex-col gap-6 p-2"><div class="flex flex-col gap-2"><label class="text-xs font-bold text-charcoal/60 uppercase" for="underlay-file">Upload Reference Image</label> <input id="underlay-file" type="file" accept="image/*" class="text-xs text-charcoal/80"/></div> <!></div>');function bl(p,e){ie(e,!1);const t=Ia(r.studio);function a(i){const n=i.target;if(n.files&&n.files[0]){const l=new FileReader;l.onload=c=>{At(t,o(t).underlayImage=c.target?.result)},l.readAsDataURL(n.files[0])}}function s(){At(t,o(t).underlayOffset={x:0,y:0}),At(t,o(t).underlayScale=1)}je();{let i=Jt(()=>w({key:"OPEN_UNDERLAY_MENU"}));Mt(p,{get title(){return o(i)},onClose:()=>At(t,o(t).showUnderlayMenu=!1),children:(n,l)=>{var c=xl(),v=u(c),h=g(u(v),2);h.__change=a,d(v);var f=g(v,2);{var x=b=>{var m=gl(),y=ye(m),_=u(y),k=g(u(_),2);k.__click=()=>At(t,o(t).isUnderlayVisible=!o(t).isUnderlayVisible);var I=u(k,!0);d(k),d(_);var F=g(_,2),B=u(F),D=u(B);d(B);var U=g(B,2);Ne(U),d(F),d(y);var P=g(y,2),R=g(u(P),2),z=u(R);z.__click=s,Pt(2),d(R),d(P);var Y=g(P,2),H=u(Y);H.__click=()=>At(t,o(t).underlayImage=null),d(Y),j(K=>{T(I,o(t).isUnderlayVisible?"Hide Underlay":"Show Underlay"),T(D,`Vapor Opacity (${K??""}%)`)},[()=>Math.round(o(t).underlayOpacity*100)]),Ve(U,()=>o(t).underlayOpacity,K=>At(t,o(t).underlayOpacity=K)),S(b,m)};V(f,b=>{o(t).underlayImage&&b(x)})}d(c),S(n,c)},$$slots:{default:!0}})}oe()}Fe(["change","click"]);var ml=O('<span class="text-xs opacity-60"> </span>'),yl=O('<button><div class="flex items-center gap-3"><!> <span class="font-serif text-xs font-medium"> </span></div></button>'),_l=O('<div class="fixed z-[2000] min-w-[160px] overflow-hidden rounded-lg border border-charcoal/10 bg-foam-white/95 p-1 shadow-xl backdrop-blur-md" role="menu" tabindex="-1"><div class="flex flex-col gap-0.5"></div></div>');function Al(p,e){ie(e,!0);let t=L(null),a=L(160),s=L(100),i=q(()=>e.x+o(a)>(typeof window<"u"?window.innerWidth:1e3)?e.x-o(a):e.x),n=q(()=>e.y+o(s)>(typeof window<"u"?window.innerHeight:1e3)?e.y-o(s):e.y);Vt(()=>{o(t)&&(A(a,o(t).offsetWidth,!0),A(s,o(t).offsetHeight,!0))});var l=_l();Ge("mousedown",ka,v=>!o(t)?.contains(v.target)&&e.onClose()),l.__contextmenu=v=>v.preventDefault();var c=u(l);De(c,21,()=>e.items,Ue,(v,h)=>{var f=yl();f.__click=()=>{o(h).disabled||(o(h).action(),e.onClose())};var x=u(f),b=u(x);{var m=k=>{var I=ml(),F=u(I,!0);d(I),j(()=>T(F,o(h).icon)),S(k,I)};V(b,k=>{o(h).icon&&k(m)})}var y=g(b,2),_=u(y,!0);d(y),d(x),d(f),j(()=>{f.disabled=o(h).disabled,re(f,1,`flex w-full items-center justify-between rounded px-3 py-2 text-left transition-colors ${o(h).danger?"text-red-600 hover:bg-red-50":"text-charcoal hover:bg-brand/5"} ${o(h).disabled?"cursor-not-allowed opacity-30 grayscale":""}`),T(_,o(h).label)}),S(v,f)}),d(c),d(l),It(l,v=>A(t,v),()=>o(t)),j(()=>fe(l,`left: ${o(i)??""}px; top: ${o(n)??""}px;`)),ce(3,l,()=>Rt,()=>({duration:100,start:.95,opacity:0})),S(p,l),oe()}Fe(["contextmenu","click"]);var wl=O('<div class="pointer-events-none fixed bottom-24 left-1/2 z-[2000] -translate-x-1/2 rounded-full border border-brand/20 bg-white/90 px-6 py-2 shadow-2xl backdrop-blur-md"><div class="flex items-center gap-3"><span class="font-tiny5 text-lg tracking-widest text-brand uppercase"> </span></div></div>');function kl(p,e){ie(e,!1);const t=r.studio;je();var a=Qe(),s=ye(a);{var i=n=>{var l=wl(),c=u(l),v=u(c),h=u(v,!0);d(v),d(c),d(l),j(()=>T(h,t.toastMessage)),ce(3,l,()=>Ra,()=>({y:20,duration:300})),S(n,l)};V(s,n=>{t.showToast&&n(i)})}S(p,a),oe()}var he=na(()=>r),El=O('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg selection:bg-brand/20"><!> <div class="flex flex-1 overflow-hidden"><aside class="flex w-64 flex-col overflow-hidden"><!></aside> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20 p-6"><div><!></div></main> <aside class="flex w-72 flex-col overflow-hidden"><!></aside></div> <!></div>',1);function Rl(p,e){ie(e,!1),Vt(()=>bt.mount()),je();var t=El(),a=ye(t);Pn(a,{});var s=g(a,2);{var i=G=>{fl(G,{onClose:()=>he(he().showGuideBook=!1)})};V(s,G=>{he().showGuideBook&&G(i)})}var n=g(s,2);{var l=G=>{$n(G,{onClose:()=>he(he().showCommandPalette=!1)})};V(n,G=>{he().showCommandPalette&&G(l)})}var c=g(n,2);{var v=G=>{Da(G,{onClose:()=>he(he().showColorPicker=!1),get value(){return he().paletteState.activeColor},set value(E){he(he().paletteState.activeColor=E)},$$legacy:!0})};V(c,G=>{he().showColorPicker&&G(v)})}var h=g(c,2);{var f=G=>{Wn(G,{onExport:(E,C,$)=>N.createArtifact(E,C,$),onClose:()=>he(he().showExportMenu=!1)})};V(h,G=>{he().showExportMenu&&G(f)})}var x=g(h,2);{var b=G=>{ol(G,{onClose:()=>he(he().showPersistenceMenu=!1)})};V(x,G=>{he().showPersistenceMenu&&G(b)})}var m=g(x,2);{var y=G=>{cl(G,{onClose:()=>he(he().showCanvasSettings=!1)})};V(m,G=>{he().showCanvasSettings&&G(y)})}var _=g(m,2);{var k=G=>{ul(G,{onClose:()=>he(he().showGoTo=!1)})};V(_,G=>{he().showGoTo&&G(k)})}var I=g(_,2);{var F=G=>{hl(G,{onClose:()=>he(he().showAudioSettings=!1)})};V(I,G=>{he().showAudioSettings&&G(F)})}var B=g(I,2);{var D=G=>{sl(G,{onClose:()=>he(he().showGuideMenu=!1)})};V(B,G=>{he().showGuideMenu&&G(D)})}var U=g(B,2);{var P=G=>{bl(G,{})};V(U,G=>{he().studio.showUnderlayMenu&&G(P)})}var R=g(U,2);{var z=G=>{Al(G,{get x(){return he().studio.contextMenu.x},get y(){return he().studio.contextMenu.y},get items(){return he().studio.contextMenu.items},onClose:()=>he(he().studio.contextMenu=null)})};V(R,G=>{he().studio.contextMenu&&G(z)})}var Y=g(R,2);kl(Y,{});var H=g(Y,2),K=u(H);fi(K);var te=g(K,2),J=u(te),W=u(J);Mi(W,{}),d(J);var le=g(J,2),me=u(le),be=u(me);Ln(be,{}),d(me),d(le);var we=g(le,2),Ce=u(we);Wi(Ce),d(we),d(te);var He=g(te,2);Zo(He),d(H),j(()=>re(me,1,`editor-frame flex h-full w-full items-center justify-center overflow-hidden shadow-2xl transition-all duration-700 ease-out ${he().project.isPlaying&&he().project.frames.length>1?"ring-palette-0 animate-pulse ring-8 ring-inset":""}`)),S(p,t),oe()}export{se as C,Va as P,Rl as _};
