import{a as P,f as D,c as Ut,t as ne}from"../chunks/u8Bfc_kR.js";import{o as qt}from"../chunks/DuaNW14K.js";import{a as Xt,C as Se,aJ as ge,h as tt,I as Zt,a0 as Te,D as Ie,l,F as Pe,H as Me,G as le,J as $t,e as Kt,aa as Le,aC as Be,am as ce,c as It,aK as vt,b as ee,aL as Re,s as Ne,Z as Y,aM as Oe,aA as ae,aN as He,aO as De,aF as Ue,a8 as de,aP as ze,r as xe,p as be,aQ as jt,M as oe,aR as Qe,aS as Fe,az as Ke,d as Ve,aw as We,U as qe,aT as Ge,aU as Xe,aV as Lt,aW as me,E as Ze,aX as $e,a4 as je,K as Je,i as ye,aY as Ye,aZ as tr,a_ as er,a$ as rr,b0 as ir,b1 as sr,b2 as ar,b3 as or,aG as nr,L as lr,b4 as cr,aH as I,R as C,Q as Jt,aI as Nt,v as mt,u as dr,g as xt,z as v,A as u,B as g,an as kt,x as K,y as yt,w as bt}from"../chunks/B2AHdtYV.js";import{a as ur,d as Qt,s as q}from"../chunks/C9x9tgyV.js";import{p as ue,i as G,b as ve}from"../chunks/ismGKnIL.js";import{i as _e}from"../chunks/CkG0WplA.js";function nt(e,t){return t}function vr(e,t,r){for(var o=[],a=t.length,n,s=t.length,c=0;c<a;c++){let m=t[c];be(m,()=>{if(n){if(n.pending.delete(m),n.done.add(m),n.pending.size===0){var h=e.outrogroups;re(ae(n.done)),h.delete(n),h.size===0&&(e.outrogroups=null)}}else s-=1},!1)}if(s===0){var f=o.length===0&&r!==null;if(f){var p=r,A=p.parentNode;Ke(A),A.append(p),e.items.clear()}re(t,!f)}else n={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(n)}function re(e,t=!0){for(var r=0;r<e.length;r++)Ve(e[r],t)}var fe;function lt(e,t,r,o,a,n=null){var s=e,c=new Map,f=(t&ge)!==0;if(f){var p=e;s=tt?Zt(Te(p)):p.appendChild(Xt())}tt&&Ie();var A=null,m=Y(()=>{var y=r();return Oe(y)?y:y==null?[]:ae(y)}),h,b=!0;function E(){d.fallback=A,fr(d,h,s,t,o),A!==null&&(h.length===0?(A.f&vt)===0?xe(A):(A.f^=vt,Ot(A,null,s)):be(A,()=>{A=null}))}var _=Se(()=>{h=l(m);var y=h.length;let T=!1;if(tt){var N=Pe(s)===Me;N!==(y===0)&&(s=le(),Zt(s),$t(!1),T=!0)}for(var w=new Set,L=It,U=Ne(),B=0;B<y;B+=1){tt&&Kt.nodeType===Le&&Kt.data===Be&&(s=Kt,T=!0,$t(!1));var z=h[B],Q=o(z,B),R=b?null:c.get(Q);R?(R.v&&ce(R.v,z),R.i&&ce(R.i,B),U&&L.unskip_effect(R.e)):(R=pr(c,b?s:fe??=Xt(),z,Q,B,a,t,r),b||(R.e.f|=vt),c.set(Q,R)),w.add(Q)}if(y===0&&n&&!A&&(b?A=ee(()=>n(s)):(A=ee(()=>n(fe??=Xt())),A.f|=vt)),y>w.size&&Re(),tt&&y>0&&Zt(le()),!b)if(U){for(const[X,et]of c)w.has(X)||L.skip_effect(et.e);L.oncommit(E),L.ondiscard(()=>{})}else E();T&&$t(!0),l(m)}),d={effect:_,items:c,outrogroups:null,fallback:A};b=!1,tt&&(s=Kt)}function Bt(e){for(;e!==null&&(e.f&Qe)===0;)e=e.next;return e}function fr(e,t,r,o,a){var n=(o&Fe)!==0,s=t.length,c=e.items,f=Bt(e.effect.first),p,A=null,m,h=[],b=[],E,_,d,y;if(n)for(y=0;y<s;y+=1)E=t[y],_=a(E,y),d=c.get(_).e,(d.f&vt)===0&&(d.nodes?.a?.measure(),(m??=new Set).add(d));for(y=0;y<s;y+=1){if(E=t[y],_=a(E,y),d=c.get(_).e,e.outrogroups!==null)for(const R of e.outrogroups)R.pending.delete(d),R.done.delete(d);if((d.f&vt)!==0)if(d.f^=vt,d===f)Ot(d,null,r);else{var T=A?A.next:f;d===e.effect.last&&(e.effect.last=d.prev),d.prev&&(d.prev.next=d.next),d.next&&(d.next.prev=d.prev),At(e,A,d),At(e,d,T),Ot(d,T,r),A=d,h=[],b=[],f=Bt(A.next);continue}if((d.f&jt)!==0&&(xe(d),n&&(d.nodes?.a?.unfix(),(m??=new Set).delete(d))),d!==f){if(p!==void 0&&p.has(d)){if(h.length<b.length){var N=b[0],w;A=N.prev;var L=h[0],U=h[h.length-1];for(w=0;w<h.length;w+=1)Ot(h[w],N,r);for(w=0;w<b.length;w+=1)p.delete(b[w]);At(e,L.prev,U.next),At(e,A,L),At(e,U,N),f=N,A=U,y-=1,h=[],b=[]}else p.delete(d),Ot(d,f,r),At(e,d.prev,d.next),At(e,d,A===null?e.effect.first:A.next),At(e,A,d),A=d;continue}for(h=[],b=[];f!==null&&f!==d;)(p??=new Set).add(f),b.push(f),f=Bt(f.next);if(f===null)continue}(d.f&vt)===0&&h.push(d),A=d,f=Bt(d.next)}if(e.outrogroups!==null){for(const R of e.outrogroups)R.pending.size===0&&(re(ae(R.done)),e.outrogroups?.delete(R));e.outrogroups.size===0&&(e.outrogroups=null)}if(f!==null||p!==void 0){var B=[];if(p!==void 0)for(d of p)(d.f&jt)===0&&B.push(d);for(;f!==null;)(f.f&jt)===0&&f!==e.fallback&&B.push(f),f=Bt(f.next);var z=B.length;if(z>0){var Q=(o&ge)!==0&&s===0?r:null;if(n){for(y=0;y<z;y+=1)B[y].nodes?.a?.measure();for(y=0;y<z;y+=1)B[y].nodes?.a?.fix()}vr(e,B,Q)}}n&&oe(()=>{if(m!==void 0)for(d of m)d.nodes?.a?.apply()})}function pr(e,t,r,o,a,n,s,c){var f=(s&He)!==0?(s&De)===0?Ue(r,!1,!1):de(r):null,p=(s&ze)!==0?de(a):null;return{v:f,i:p,e:ee(()=>(n(t,f??r,p??a,c),()=>{e.delete(o)}))}}function Ot(e,t,r){if(e.nodes)for(var o=e.nodes.start,a=e.nodes.end,n=t&&(t.f&vt)===0?t.nodes.start:r;o!==null;){var s=We(o);if(n.before(o),o===a)return;o=s}}function At(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}const Ar=()=>performance.now(),ut={tick:e=>requestAnimationFrame(e),now:()=>Ar(),tasks:new Set};function we(){const e=ut.now();ut.tasks.forEach(t=>{t.c(e)||(ut.tasks.delete(t),t.f())}),ut.tasks.size!==0&&ut.tick(we)}function hr(e){let t;return ut.tasks.size===0&&ut.tick(we),{promise:new Promise(r=>{ut.tasks.add(t={c:e,f:r})}),abort(){ut.tasks.delete(t)}}}function Wt(e,t){me(()=>{e.dispatchEvent(new CustomEvent(t))})}function gr(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function pe(e){const t={},r=e.split(";");for(const o of r){const[a,n]=o.split(":");if(!a||n===void 0)break;const s=gr(a.trim());t[s]=n.trim()}return t}const xr=e=>e;function Ht(e,t,r,o){var a=(e&Ye)!==0,n=(e&tr)!==0,s=a&&n,c=(e&Ge)!==0,f=s?"both":a?"in":"out",p,A=t.inert,m=t.style.overflow,h,b;function E(){return me(()=>p??=r()(t,o?.()??{},{direction:f}))}var _={is_global:c,in(){if(t.inert=A,!a){b?.abort(),b?.reset?.();return}n||h?.abort(),h=ie(t,E(),b,1,()=>{Wt(t,"introend"),h?.abort(),h=p=void 0,t.style.overflow=m})},out(N){if(!n){N?.(),p=void 0;return}t.inert=!0,b=ie(t,E(),h,0,()=>{Wt(t,"outroend"),N?.()})},stop:()=>{h?.abort(),b?.abort()}},d=qe;if((d.nodes.t??=[]).push(_),a&&ur){var y=c;if(!y){for(var T=d.parent;T&&(T.f&Ze)!==0;)for(;(T=T.parent)&&(T.f&$e)===0;);y=!T||(T.f&je)!==0}y&&Je(()=>{ye(()=>_.in())})}}function ie(e,t,r,o,a){var n=o===1;if(Xe(t)){var s,c=!1;return oe(()=>{if(!c){var d=t({direction:n?"in":"out"});s=ie(e,d,r,o,a)}}),{abort:()=>{c=!0,s?.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(r?.deactivate(),!t?.duration&&!t?.delay)return Wt(e,n?"introstart":"outrostart"),a(),{abort:Lt,deactivate:Lt,reset:Lt,t:()=>o};const{delay:f=0,css:p,tick:A,easing:m=xr}=t;var h=[];if(n&&r===void 0&&(A&&A(0,1),p)){var b=pe(p(0,1));h.push(b,b)}var E=()=>1-o,_=e.animate(h,{duration:f,fill:"forwards"});return _.onfinish=()=>{_.cancel(),Wt(e,n?"introstart":"outrostart");var d=r?.t()??1-o;r?.abort();var y=o-d,T=t.duration*Math.abs(y),N=[];if(T>0){var w=!1;if(p)for(var L=Math.ceil(T/16.666666666666668),U=0;U<=L;U+=1){var B=d+y*m(U/L),z=pe(p(B,1-B));N.push(z),w||=z.overflow==="hidden"}w&&(e.style.overflow="hidden"),E=()=>{var Q=_.currentTime;return d+y*m(Q/T)},A&&hr(()=>{if(_.playState!=="running")return!1;var Q=E();return A(Q,1-Q),!0})}_=e.animate(N,{duration:T,fill:"forwards"}),_.onfinish=()=>{E=()=>o,A?.(o,1-o),a()}},{abort:()=>{_&&(_.cancel(),_.effect=null,_.onfinish=Lt)},deactivate:()=>{a=Lt},reset:()=>{o===0&&A?.(1,0)},t:()=>E()}}function br(e,t,r){var o=e==null?"":""+e;return t&&(o=o?o+" "+t:t),o===""?null:o}function mr(e,t){return e==null?null:String(e)}function gt(e,t,r,o,a,n){var s=e.__className;if(tt||s!==r||s===void 0){var c=br(r,o);(!tt||c!==e.getAttribute("class"))&&(c==null?e.removeAttribute("class"):e.className=c),e.__className=r}return n}function j(e,t,r,o){var a=e.__style;if(tt||a!==t){var n=mr(t);(!tt||n!==e.getAttribute("style"))&&(n==null?e.removeAttribute("style"):e.style.cssText=n),e.__style=t}return o}const yr=Symbol("is custom element"),_r=Symbol("is html");function Et(e){if(tt){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var o=e.value;zt(e,"value",null),e.value=o}if(e.hasAttribute("checked")){var a=e.checked;zt(e,"checked",null),e.checked=a}}};e.__on_r=r,oe(r),rr()}}function Ce(e,t){var r=Ee(e);r.value===(r.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function zt(e,t,r,o){var a=Ee(e);tt&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=r)&&(t==="loading"&&(e[ir]=r),r==null?e.removeAttribute(t):typeof r!="string"&&wr(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function Ee(e){return e.__attributes??={[yr]:e.nodeName.includes("-"),[_r]:e.namespaceURI===er}}var Ae=new Map;function wr(e){var t=e.getAttribute("is")||e.nodeName,r=Ae.get(t);if(r)return r;Ae.set(t,r=[]);for(var o,a=e,n=Element.prototype;n!==a;){o=ar(a);for(var s in o)o[s].set&&r.push(s);a=sr(a)}return r}function Dt(e,t,r=t){var o=new WeakSet;or(e,"input",async a=>{var n=a?e.defaultValue:e.value;if(n=Yt(e)?te(n):n,r(n),It!==null&&o.add(It),await nr(),n!==(n=t())){var s=e.selectionStart,c=e.selectionEnd,f=e.value.length;if(e.value=n??"",c!==null){var p=e.value.length;s===c&&c===f&&p>f?(e.selectionStart=p,e.selectionEnd=p):(e.selectionStart=s,e.selectionEnd=Math.min(c,p))}}}),(tt&&e.defaultValue!==e.value||ye(t)==null&&e.value)&&(r(Yt(e)?te(e.value):e.value),It!==null&&o.add(It)),lr(()=>{var a=t();if(e===document.activeElement){var n=cr??It;if(o.has(n))return}Yt(e)&&a===te(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function Yt(e){var t=e.type;return t==="number"||t==="range"}function te(e){return e===""?null:+e}class Cr{ctx=null;init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}playTone(t,r,o="sine",a=.1,n=1e-4){if(this.init(),!this.ctx||i.isMuted)return;const s=this.ctx.createOscillator(),c=this.ctx.createGain();s.type=o,s.frequency.setValueAtTime(t,this.ctx.currentTime),c.gain.setValueAtTime(a,this.ctx.currentTime),c.gain.exponentialRampToValueAtTime(n,this.ctx.currentTime+r),s.connect(c),c.connect(this.ctx.destination),s.start(),s.stop(this.ctx.currentTime+r)}playMove(){this.playTone(450,.08,"sine",.15)}playStitch(){this.playTone(1200,.15,"sine",.03),setTimeout(()=>this.playTone(1500,.1,"sine",.02),50)}playUnstitch(){if(this.init(),!this.ctx||i.isMuted)return;const t=.25,r=this.ctx.sampleRate*t,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),a=o.getChannelData(0);for(let f=0;f<r;f++)a[f]=Math.random()*2-1;const n=this.ctx.createBufferSource();n.buffer=o;const s=this.ctx.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(1500,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+t);const c=this.ctx.createGain();c.gain.setValueAtTime(.1,this.ctx.currentTime),c.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+t),n.connect(s),s.connect(c),c.connect(this.ctx.destination),n.start()}}const ht=new Cr;class Er{undoStack=[];redoStack=[];maxHistory=500;push(t){t.oldColor!==t.newColor&&(this.undoStack.push(t),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift())}undo(){const t=this.undoStack.pop();return t?(this.redoStack.push(t),t):null}redo(){const t=this.redoStack.pop();return t?(this.undoStack.push(t),t):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}}const Rt=new Er;class kr{version="0.2.1";#t=I(32);get gridWidth(){return l(this.#t)}set gridWidth(t){C(this.#t,t,!0)}#e=I(32);get gridHeight(){return l(this.#e)}set gridHeight(t){C(this.#e,t,!0)}#r=I(Jt([]));get pixelData(){return l(this.#r)}set pixelData(t){C(this.#r,t,!0)}#i=I(Jt({x:0,y:0}));get cursorPos(){return l(this.#i)}set cursorPos(t){C(this.#i,t,!0)}#s=I("#859900");get activeColor(){return l(this.#s)}set activeColor(t){C(this.#s,t,!0)}#a=I(Jt(["#073642","#586e75","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"]));get palette(){return l(this.#a)}set palette(t){C(this.#a,t,!0)}#o=I(1);get zoomLevel(){return l(this.#o)}set zoomLevel(t){C(this.#o,t,!0)}#n=I(!1);get showColorPicker(){return l(this.#n)}set showColorPicker(t){C(this.#n,t,!0)}#l=I(!1);get showCommandPalette(){return l(this.#l)}set showCommandPalette(t){C(this.#l,t,!0)}#c=I(!1);get showHelp(){return l(this.#c)}set showHelp(t){C(this.#c,t,!0)}#d=I(10);get exportScale(){return l(this.#d)}set exportScale(t){C(this.#d,t,!0)}#u=I("transparent");get exportBgColor(){return l(this.#u)}set exportBgColor(t){C(this.#u,t,!0)}#v=I(!1);get isMuted(){return l(this.#v)}set isMuted(t){C(this.#v,t,!0)}#f=I(!1);get isPicking(){return l(this.#f)}set isPicking(t){C(this.#f,t,!0)}#p=I(!1);get isAppReady(){return l(this.#p)}set isAppReady(t){C(this.#p,t,!0)}#A=I(!0);get isCursorVisible(){return l(this.#A)}set isCursorVisible(t){C(this.#A,t,!0)}#h=I(!1);get isShiftPressed(){return l(this.#h)}set isShiftPressed(t){C(this.#h,t,!0)}#g=I(!1);get isCtrlPressed(){return l(this.#g)}set isCtrlPressed(t){C(this.#g,t,!0)}#x=I(!1);get isAltPressed(){return l(this.#x)}set isAltPressed(t){C(this.#x,t,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;#b=I(null);get selectionStart(){return l(this.#b)}set selectionStart(t){C(this.#b,t,!0)}#m=I(null);get selectionEnd(){return l(this.#m)}set selectionEnd(t){C(this.#m,t,!0)}#y=Nt(()=>this.isShiftPressed&&this.isAltPressed);get isBlockMode(){return l(this.#y)}set isBlockMode(t){C(this.#y,t)}escapeStack=[];constructor(t=32,r=32){this.gridWidth=t,this.gridHeight=r,this.pixelData=Array(t*r).fill("#eee8d5"),this.resetInactivityTimer()}resetInactivityTimer(){this.isCursorVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isCursorVisible=!1},this.INACTIVITY_TIMEOUT)}toggleMute(){this.isMuted=!this.isMuted}startSelection(){this.selectionStart={...this.cursorPos},this.selectionEnd={...this.cursorPos},this.resetInactivityTimer()}updateSelection(){this.selectionStart&&(this.selectionEnd={...this.cursorPos}),this.resetInactivityTimer()}commitSelection(){if(!this.selectionStart||!this.selectionEnd)return;const t=Math.min(this.selectionStart.x,this.selectionEnd.x),r=Math.max(this.selectionStart.x,this.selectionEnd.x),o=Math.min(this.selectionStart.y,this.selectionEnd.y),a=Math.max(this.selectionStart.y,this.selectionEnd.y);for(let n=o;n<=a;n++)for(let s=t;s<=r;s++){const c=n*this.gridWidth+s,f=this.pixelData[c];f!==this.activeColor&&(Rt.push({index:c,oldColor:f,newColor:this.activeColor}),this.pixelData[c]=this.activeColor)}ht.playStitch(),this.selectionStart=null,this.selectionEnd=null,this.resetInactivityTimer()}pushEscapeAction(t){this.escapeStack.push(t)}popEscapeAction(t){this.escapeStack=this.escapeStack.filter(r=>r!==t)}handleEscape(){const t=this.escapeStack.pop();return t?(t(),!0):!1}#_=Nt(()=>{const t=new Set;return this.pixelData.forEach(r=>{r!=="#eee8d5"&&t.add(r)}),Array.from(t)});get usedColors(){return l(this.#_)}set usedColors(t){C(this.#_,t)}#w=Nt(()=>{const t=(r,o)=>{const a=Math.floor(o/2);return o%2===0?r<a?r-a:r-a+1:r-a};return{x:t(this.cursorPos.x,this.gridWidth),y:t(this.cursorPos.y,this.gridHeight)*-1}});get displayCoords(){return l(this.#w)}set displayCoords(t){C(this.#w,t)}#C=Nt(()=>{if(this.zoomLevel<=1)return`scale(${this.zoomLevel})`;{const t=(this.cursorPos.x+.5)/this.gridWidth*100,r=(this.cursorPos.y+.5)/this.gridHeight*100,o=50-t,a=50-r;return`translate(${o}%, ${a}%) scale(${this.zoomLevel})`}});get cameraTransform(){return l(this.#C)}set cameraTransform(t){C(this.#C,t)}setZoom(t){const r=this.zoomLevel+t;this.zoomLevel=Math.max(.5,Math.min(5,Number(r.toFixed(1)))),this.resetInactivityTimer()}resetZoom(){this.zoomLevel=1,this.resetInactivityTimer()}selectPalette(t){t>=0&&t<this.palette.length&&(this.activeColor=this.palette[t]),this.resetInactivityTimer()}clearCanvas(){confirm("Are you sure you want to unravel the entire project?")&&(this.pixelData=this.pixelData.map(()=>"#eee8d5"),ht.playUnstitch()),this.resetInactivityTimer()}pickColor(){const t=this.cursorPos.y*this.gridWidth+this.cursorPos.x,r=this.pixelData[t];r!=="#eee8d5"&&(this.activeColor=r,ht.playStitch(),this.isPicking=!0,setTimeout(()=>{this.isPicking=!1},1500)),this.resetInactivityTimer()}moveCursor(t,r){const o=Math.max(0,Math.min(this.gridWidth-1,this.cursorPos.x+t)),a=Math.max(0,Math.min(this.gridHeight-1,this.cursorPos.y+r));(o!==this.cursorPos.x||a!==this.cursorPos.y)&&(this.cursorPos={x:o,y:a},ht.playMove(),this.isBlockMode?this.updateSelection():this.isShiftPressed&&this.isCtrlPressed?this.unstitch():this.isShiftPressed&&this.stitch()),this.resetInactivityTimer()}stitch(){const t=this.cursorPos.y*this.gridWidth+this.cursorPos.x,r=this.pixelData[t];r!==this.activeColor&&(Rt.push({index:t,oldColor:r,newColor:this.activeColor}),this.pixelData[t]=this.activeColor,ht.playStitch()),this.resetInactivityTimer()}unstitch(){const t=this.cursorPos.y*this.gridWidth+this.cursorPos.x,r=this.pixelData[t],o="#eee8d5";r!==o&&(Rt.push({index:t,oldColor:r,newColor:o}),this.pixelData[t]=o,ht.playUnstitch()),this.resetInactivityTimer()}undo(){const t=Rt.undo();t&&(this.pixelData[t.index]=t.oldColor,ht.playUnstitch()),this.resetInactivityTimer()}redo(){const t=Rt.redo();t&&(this.pixelData[t.index]=t.newColor,ht.playStitch()),this.resetInactivityTimer()}setColor(t){this.activeColor=t,this.resetInactivityTimer()}}const i=new kr;class se{static toSVG(t,r,o,a="transparent"){let n=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${r}" shape-rendering="crispEdges">`;a!=="transparent"&&(n+=`<rect width="${t}" height="${r}" fill="${a}" />`);for(let s=0;s<r;s++)for(let c=0;c<t;c++){const f=o[s*t+c];if(f==="#eee8d5")continue;let p=1;for(;c+p<t&&o[s*t+(c+p)]===f;)p++;n+=`<rect x="${c}" y="${s}" width="${p}" height="1" fill="${f}" />`,c+=p-1}return n+="</svg>",n}static async toPNG(t,r,o,a,n="transparent"){const s=document.createElement("canvas"),c=Math.max(1,Math.round(t*a)),f=Math.max(1,Math.round(r*a));s.width=c,s.height=f;const p=s.getContext("2d");if(!p)throw new Error("Could not get canvas context");p.imageSmoothingEnabled=!1,n!=="transparent"&&(p.fillStyle=n,p.fillRect(0,0,c,f));const A=a;return o.forEach((m,h)=>{if(m==="#eee8d5")return;const b=h%t,E=Math.floor(h/t);p.fillStyle=m,p.fillRect(Math.floor(b*A),Math.floor(E*A),Math.ceil(A),Math.ceil(A))}),s.toDataURL("image/png")}}const Sr={UP:["ArrowUp"],DOWN:["ArrowDown"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"]},Tr={STITCH:[" "],UNSTITCH:["Backspace","Delete"],UNSTITCH_MOD:["Ctrl+ "],EYEDROPPER:["i","Alt+ "]},Ir={UNDO:["Ctrl+z"],REDO:["Ctrl+Shift+z","Ctrl+y"]},Pr={ZOOM_IN:["+","="],ZOOM_OUT:["-"],RESET_ZOOM:["Ctrl+0"]},Mr={COMMAND_PALETTE:["Ctrl+k"],EXPORT:["Ctrl+e"],COLOR_PICKER:["Ctrl+p"],CLEAR_LINEN:["Ctrl+l"],TOGGLE_MUTE:["Ctrl+m"],ESCAPE:["Escape"]},Lr={SELECT_1:["1"],SELECT_2:["2"],SELECT_3:["3"],SELECT_4:["4"],SELECT_5:["5"],SELECT_6:["6"],SELECT_7:["7"],SELECT_8:["8"],SELECT_9:["9"],SELECT_0:["0"]},Br={navigation:Sr,canvas:Tr,history:Ir,view:Pr,studio:Mr,palette:Lr};class Rr{definitions=[];constructor(){Object.values(Br).forEach(t=>{Object.entries(t).forEach(([r,o])=>{o.forEach(a=>{const n=a.toLowerCase().split("+"),s=n[n.length-1],c=n.includes("ctrl"),f=n.includes("shift"),p=n.includes("alt");this.definitions.push({action:r,key:s,modifiers:{ctrl:c,shift:f,alt:p},modifierCount:(c?1:0)+(f?1:0)+(p?1:0)})})})}),this.definitions.sort((t,r)=>r.modifierCount-t.modifierCount)}getBestMatch(t){const r=t.key.toLowerCase(),o=t.ctrlKey||t.metaKey,a=t.shiftKey,n=t.altKey;for(const s of this.definitions){const c=r===s.key||t.code.toLowerCase()===`key${s.key}`;if(["UP","DOWN","LEFT","RIGHT"].includes(s.action)){if(r===s.key||t.key===s.key)return s.action;continue}if(c&&o===s.modifiers.ctrl&&a===s.modifiers.shift&&n===s.modifiers.alt)return s.action}return null}getLabel(t){const r=this.definitions.find(o=>o.action===t);return r?r.key.toUpperCase():""}}const dt=new Rr;var Nr=D('<div id="picker-overlay" class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/20 backdrop-blur-sm"><div class="flex w-80 flex-col gap-6 rounded-[2.5rem] border-8 border-white bg-[#fdf6e3] p-8 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between"><span class="font-serif text-2xl text-brand italic"> </span> <button class="text-[10px] font-bold tracking-widest uppercase opacity-30 hover:opacity-100">Cancel</button></div> <div class="relative flex h-32 items-center justify-center overflow-hidden rounded-3xl border-4 border-white bg-[#eee8d5] shadow-inner"><div class="tech-checker absolute inset-0 opacity-30"></div> <div class="z-10 h-20 w-20 rounded-full border-4 border-white shadow-lg"></div></div> <div class="flex flex-col gap-5"><div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] font-black tracking-wider uppercase opacity-30"><span>Hue</span> <span> </span></div> <input type="range" min="0" max="360" class="custom-slider hue-slider svelte-13rslnh"/></div> <div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] font-black tracking-wider uppercase opacity-30"><span>Saturation</span> <span> </span></div> <input type="range" min="0" max="100" class="custom-slider svelte-13rslnh"/></div> <div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] font-black tracking-wider uppercase opacity-30"><span>Lightness</span> <span> </span></div> <input type="range" min="0" max="100" class="custom-slider svelte-13rslnh"/></div> <div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] font-black tracking-wider uppercase opacity-30"><span>Opacity (Alpha)</span> <span> </span></div> <input type="range" min="0" max="100" class="custom-slider alpha-slider svelte-13rslnh"/></div></div> <div class="flex flex-col gap-3"><div class="relative"><input type="text" maxlength="9" class="w-full rounded-xl border border-black/5 bg-white/80 py-2 text-center font-mono text-xs opacity-60 focus:ring-2 focus:ring-brand/20 focus:outline-none"/> <span class="absolute top-1/2 right-3 -translate-y-1/2 text-[8px] font-bold uppercase opacity-20">Hex</span></div> <button class="flex w-full items-center justify-center gap-2 rounded-2xl bg-studio-teal py-3 font-serif text-white italic shadow-md transition-all hover:scale-[1.02] active:scale-100"><span>âœ¨</span> Apply Color</button></div></div></div>');function ke(e,t){mt(t,!0);let r=ue(t,"value",15),o=ue(t,"title",3,"Natural Dye Basin"),a=I(0),n=I(100),s=I(50),c=I(100);function f(S){(!S||!/^#([0-9A-F]{6}|[0-9A-F]{8})$/i.test(S))&&(S="#fdf6e3ff");let Z=parseInt(S.slice(1,3),16)/255,$=parseInt(S.slice(3,5),16)/255,at=parseInt(S.slice(5,7),16)/255,Ct=S.length===9?parseInt(S.slice(7,9),16)/255:1,x=Math.max(Z,$,at),k=Math.min(Z,$,at),M,F,ot=(x+k)/2;if(x===k)M=F=0;else{let W=x-k;switch(F=ot>.5?W/(2-x-k):W/(x+k),x){case Z:M=($-at)/W+($<at?6:0);break;case $:M=(at-Z)/W+2;break;case at:M=(Z-$)/W+4;break}M/=6}return{h:M*360,s:F*100,l:ot*100,a:Ct*100}}dr(()=>{const S=f(r());C(a,S.h,!0),C(n,S.s,!0),C(s,S.l,!0),C(c,S.a,!0)});function p(S,Z,$,at){$/=100;const Ct=Math.round(at/100*255).toString(16).padStart(2,"0"),x=Z*Math.min($,1-$)/100,k=M=>{const F=(M+S/30)%12,ot=$-x*Math.max(Math.min(F-3,9-F,1),-1);return Math.round(255*ot).toString(16).padStart(2,"0")};return`#${k(0)}${k(8)}${k(4)}${Ct}`}xt(()=>{r(p(l(a),l(n),l(s),l(c)))});function A(S){const Z=S.target.value;/^#([0-9A-F]{6}|[0-9A-F]{8})$/i.test(Z)&&r(Z)}function m(S){S.key==="Enter"&&t.onClose()}function h(S){S.target.id==="picker-overlay"&&t.onClose()}xt(()=>(i.pushEscapeAction(t.onClose),()=>i.popEscapeAction(t.onClose)));var b=Nr();b.__mousedown=h;var E=v(b),_=v(E),d=v(_),y=v(d,!0);u(d);var T=g(d,2);T.__click=function(...S){t.onClose?.apply(this,S)},u(_);var N=g(_,2),w=g(v(N),2);u(N);var L=g(N,2),U=v(L),B=v(U),z=g(v(B),2),Q=v(z);u(z),u(B);var R=g(B,2);Et(R),u(U);var X=g(U,2),et=v(X),rt=g(v(et),2),_t=v(rt);u(rt),u(et);var it=g(et,2);Et(it),u(X);var J=g(X,2),ct=v(J),ft=g(v(ct),2),St=v(ft);u(ft),u(ct);var O=g(ct,2);Et(O),u(J);var H=g(J,2),V=v(H),st=g(v(V),2),Tt=v(st);u(st),u(V);var Pt=g(V,2);Et(Pt),u(H),u(L);var Mt=g(L,2),wt=v(Mt),pt=v(wt);Et(pt),pt.__input=A,pt.__keydown=m,kt(2),u(wt);var Gt=g(wt,2);Gt.__click=function(...S){t.onClose?.apply(this,S)},u(Mt),u(E),u(b),K((S,Z,$,at,Ct)=>{q(y,o()),j(w,`background-color: ${r()??""};`),q(Q,`${S??""}Â°`),q(_t,`${Z??""}%`),q(St,`${$??""}%`),q(Tt,`${at??""}%`),Ce(pt,Ct)},[()=>Math.round(l(a)),()=>Math.round(l(n)),()=>Math.round(l(s)),()=>Math.round(l(c)),()=>r().toUpperCase()]),Dt(R,()=>l(a),S=>C(a,S)),Dt(it,()=>l(n),S=>C(n,S)),Dt(O,()=>l(s),S=>C(s,S)),Dt(Pt,()=>l(c),S=>C(c,S)),P(e,b),yt()}Qt(["mousedown","click","input","keydown"]);var Or=D('<img alt="Preview" class="max-h-full max-w-full shadow-lg" style="image-rendering: pixelated;"/>'),Hr=D("<button> </button>"),Dr=D("<button><div></div> </button>"),Ur=D('<div class="fixed inset-0 z-[1000] flex items-center justify-center bg-black/20 backdrop-blur-sm" id="export-overlay"><div class="flex max-h-[90vh] w-[500px] flex-col gap-6 overflow-y-auto rounded-[2.5rem] border-8 border-white bg-[#fdf6e3] p-8 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between"><span class="font-serif text-2xl text-brand italic">Export Project</span> <button class="text-[10px] font-bold tracking-widest uppercase opacity-30 transition-opacity hover:opacity-100">Cancel</button></div> <div class="flex flex-col gap-3"><span class="text-[10px] font-black tracking-wider uppercase opacity-30">Linen Preview</span> <div class="artisan-checker relative flex h-48 items-center justify-center overflow-hidden rounded-2xl border-4 border-white bg-[#eee8d5] shadow-inner svelte-1ed95g7"><!></div></div> <div class="grid grid-cols-2 gap-6"><div class="flex flex-col gap-3"><span class="text-[10px] font-black tracking-wider uppercase opacity-30">Scaling</span> <div class="flex flex-wrap gap-2"></div> <div class="relative mt-1"><input type="number" class="w-full rounded-xl border-2 border-black/5 bg-white/50 px-3 py-1.5 font-mono text-xs transition-colors outline-none focus:border-brand/30"/> <span class="pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-[8px] font-bold text-studio-text italic opacity-20">px</span></div></div> <div class="flex flex-col gap-3"><span class="text-[10px] font-black tracking-wider uppercase opacity-30">Background Dye</span> <div class="flex flex-col gap-2"><!> <button><div class="via-sage-300 h-3 w-3 rounded-sm border border-black/10 bg-gradient-to-tr from-rose-300 to-sky-300"></div> Custom Dye...</button></div></div></div> <div class="mt-2 flex gap-3"><button class="flex flex-1 flex-col items-center rounded-2xl bg-studio-teal py-3 font-serif text-white italic shadow-md transition-all hover:scale-[1.02] active:scale-100"><span class="text-lg">Export PNG</span> <span class="mt-1 text-[8px] font-bold tracking-widest uppercase opacity-60">Raster Print</span></button> <button class="flex flex-1 flex-col items-center rounded-2xl bg-brand py-3 font-serif text-white italic shadow-md transition-all hover:scale-[1.02] active:scale-100"><span class="text-lg">Export SVG</span> <span class="mt-1 text-[8px] font-bold tracking-widest uppercase opacity-60">Vector Tapestry</span></button></div></div></div> <!>',1);function zr(e,t){mt(t,!0);let r=I(i.gridWidth*i.exportScale),o=I(!1),a=I(""),n=I(!1);const s=[.5,1,2,4,10,20],c=[{label:"Transparent",value:"transparent"},{label:"Studio Cream",value:"#fdf6e3"},{label:"White",value:"#ffffff"},{label:"Black",value:"#000000"}];async function f(){C(a,await se.toPNG(i.gridWidth,i.gridHeight,i.pixelData,5,i.exportBgColor),!0)}function p(O){i.exportScale=O,C(r,i.gridWidth*O),C(o,!1)}function A(O){const H=parseInt(O.target.value);!isNaN(H)&&H>0&&(C(r,H,!0),i.exportScale=H/i.gridWidth,C(o,!0))}function m(){window.dispatchEvent(new CustomEvent("app:close-export"))}xt(()=>{i.exportBgColor,f()}),xt(()=>(i.pushEscapeAction(m),()=>i.popEscapeAction(m))),qt(()=>{f()});var h=Ur(),b=bt(h);b.__mousedown=O=>O.target.id==="export-overlay"&&m();var E=v(b),_=v(E),d=g(v(_),2);d.__click=m,u(_);var y=g(_,2),T=g(v(y),2),N=v(T);{var w=O=>{var H=Or();K(()=>zt(H,"src",l(a))),P(O,H)};G(N,O=>{l(a)&&O(w)})}u(T),u(y);var L=g(y,2),U=v(L),B=g(v(U),2);lt(B,21,()=>s,nt,(O,H)=>{var V=Hr();V.__click=()=>p(l(H));var st=v(V);u(V),K(()=>{gt(V,1,`rounded-full border-2 px-2.5 py-1 font-mono text-[10px] transition-all ${!l(o)&&i.exportScale===l(H)?"border-brand bg-brand text-white":"border-black/5 bg-white opacity-60 hover:opacity-100"}`),q(st,`${l(H)??""}x`)}),P(O,V)}),u(B);var z=g(B,2),Q=v(z);Et(Q),Q.__input=A,kt(2),u(z),u(U);var R=g(U,2),X=g(v(R),2),et=v(X);lt(et,17,()=>c,nt,(O,H)=>{var V=Dr();V.__click=()=>i.exportBgColor=l(H).value;var st=v(V),Tt=g(st);u(V),K(()=>{gt(V,1,`flex items-center gap-2 rounded-lg border-2 p-1.5 font-serif text-[10px] italic transition-all ${i.exportBgColor===l(H).value?"border-brand bg-white shadow-sm":"border-transparent opacity-60 hover:opacity-100"}`),gt(st,1,`h-3 w-3 rounded-sm border border-black/10 ${l(H).value==="transparent"?"artisan-checker":""}`,"svelte-1ed95g7"),j(st,`background-color: ${(l(H).value==="transparent"?"transparent":l(H).value)??""};`),q(Tt,` ${l(H).label??""}`)}),P(O,V)});var rt=g(et,2);rt.__click=()=>{i.exportBgColor==="transparent"&&(i.exportBgColor="#fdf6e3"),C(n,!0)};var _t=v(rt);kt(),u(rt),u(X),u(R),u(L);var it=g(L,2),J=v(it);J.__click=()=>t.onExport("png",i.exportScale,i.exportBgColor);var ct=g(J,2);ct.__click=()=>t.onExport("svg",1,i.exportBgColor),u(it),u(E),u(b);var ft=g(b,2);{var St=O=>{ke(O,{onClose:()=>C(n,!1),title:"Background Dye",get value(){return i.exportBgColor},set value(H){i.exportBgColor=H}})};G(ft,O=>{l(n)&&O(St)})}K((O,H,V)=>{Ce(Q,O),gt(rt,1,`flex items-center gap-2 rounded-lg border-2 p-1.5 font-serif text-[10px] italic transition-all ${H??""}`),j(_t,`background-color: ${V??""}`)},[()=>Math.round(l(r)),()=>c.some(O=>O.value===i.exportBgColor)?"border-transparent opacity-60 hover:opacity-100":"border-brand bg-white shadow-sm",()=>c.some(O=>O.value===i.exportBgColor)?"":i.exportBgColor]),P(e,h),yt()}Qt(["mousedown","click","input"]);var Qr=D('<div class="p-8 text-center font-serif text-xs italic opacity-30">No such pattern found in the studio...</div>'),Fr=D('<span class="rounded bg-black/10 px-2 py-1 font-mono text-[10px] opacity-50"> </span>'),Kr=D('<button><span class="font-serif italic"> </span> <!></button>'),Vr=D(`<div class="fixed inset-0 z-[1000] flex items-start justify-center bg-black/10 pt-32 backdrop-blur-sm" id="palette-overlay"><div class="flex w-[500px] flex-col overflow-hidden rounded-3xl border-8 border-white bg-[#fdf6e3] shadow-2xl ring-1 ring-black/5"><div class="border-b border-studio-text/5 bg-white/30 p-6"><div class="flex items-center gap-4"><span class="font-serif text-xl italic opacity-20">ðŸ“–</span> <input placeholder="Search the Pattern Book..." class="w-full bg-transparent font-serif text-lg text-studio-text italic outline-none placeholder:opacity-30"/></div></div> <div class="max-h-[400px] overflow-y-auto p-2"><!></div> <div class="border-t border-studio-text/5 bg-studio-text/[0.02] p-4 text-center"><span class="text-[9px] font-black tracking-widest uppercase opacity-20">Artisan's Pattern Book</span></div></div></div>`);function Wr(e,t){mt(t,!0);const r=[{id:"open-help",label:"Help: Open Artisan's Guide",shortcut:"F1",action:()=>i.showHelp=!0},{id:"open-export",label:"Export: Open Export Window",shortcut:dt.getLabel("EXPORT"),action:()=>{}},{id:"open-dye-basin",label:"Color: Open Color Wheel (Dye Basin)",shortcut:dt.getLabel("COLOR_PICKER"),action:()=>i.showColorPicker=!0},{id:"toggle-mute",label:"Studio: Toggle Audio Feedback (Mute/Unmute)",shortcut:dt.getLabel("TOGGLE_MUTE"),action:()=>i.toggleMute()},{id:"pick-dye",label:"Color: Eyedropper (Pick Dye from Canvas)",shortcut:dt.getLabel("EYEDROPPER"),action:()=>i.pickColor()},{id:"reset-zoom",label:"View: Reset Loom Zoom",shortcut:dt.getLabel("RESET_ZOOM"),action:()=>i.resetZoom()},{id:"undo",label:"Edit: Undo Last Stitch",shortcut:dt.getLabel("UNDO"),action:()=>i.undo()},{id:"redo",label:"Edit: Redo Last Stitch",shortcut:dt.getLabel("REDO"),action:()=>i.redo()},{id:"clear-linen",label:"Project: Clear the Linen (Full Reset)",shortcut:dt.getLabel("CLEAR_LINEN"),action:()=>i.clearCanvas()}];let o=I(""),a=I(0),n,s,c=Nt(()=>r.filter(w=>w.label.toLowerCase().includes(l(o).toLowerCase())));xt(()=>{l(o),C(a,0)}),xt(()=>{if(s&&l(a)>=0){const w=s.children[l(a)];w&&w.scrollIntoView({block:"nearest",behavior:"smooth"})}});function f(w){w.action(),w.id==="open-export"&&window.dispatchEvent(new CustomEvent("app:execute-command",{detail:"open-export"})),A()}function p(w){w.key==="ArrowDown"?(w.preventDefault(),C(a,(l(a)+1)%l(c).length)):w.key==="ArrowUp"?(w.preventDefault(),C(a,(l(a)-1+l(c).length)%l(c).length)):w.key==="Enter"&&(w.preventDefault(),l(c)[l(a)]&&f(l(c)[l(a)]))}function A(){i.showCommandPalette=!1}xt(()=>(i.pushEscapeAction(A),()=>i.popEscapeAction(A))),qt(()=>{n.focus()});var m=Vr();m.__mousedown=w=>w.target.id==="palette-overlay"&&A();var h=v(m),b=v(h),E=v(b),_=g(v(E),2);Et(_),_.__keydown=p,ve(_,w=>n=w,()=>n),u(E),u(b);var d=g(b,2),y=v(d);{var T=w=>{var L=Qr();P(w,L)},N=w=>{var L=Ut(),U=bt(L);lt(U,17,()=>l(c),nt,(B,z,Q)=>{var R=Kr();R.__click=()=>f(l(z));var X=v(R),et=v(X,!0);u(X);var rt=g(X,2);{var _t=it=>{var J=Fr(),ct=v(J,!0);u(J),K(()=>q(ct,l(z).shortcut)),P(it,J)};G(rt,it=>{l(z).shortcut&&it(_t)})}u(R),K(()=>{gt(R,1,`flex w-full items-center justify-between rounded-2xl px-6 py-4 text-left transition-all ${Q===l(a)?"scale-[1.02] bg-brand text-white shadow-md":"hover:bg-studio-text/5"}`),q(et,l(z).label)}),P(B,R)}),P(w,L)};G(y,w=>{l(c).length===0?w(T):w(N,!1)})}u(d),ve(d,w=>s=w,()=>s),kt(2),u(h),u(m),Dt(_,()=>l(o),w=>C(o,w)),P(e,m),yt()}Qt(["mousedown","keydown","click"]);var qr=D('<div class="group flex items-center justify-between"><span class="font-serif text-sm italic opacity-70 transition-opacity group-hover:opacity-100"> </span> <div class="flex gap-1"><kbd class="rounded-lg border-2 border-black/[0.03] bg-white px-3 py-1 font-mono text-[10px] text-brand shadow-sm"> </kbd></div></div>'),Gr=D('<div class="flex flex-col gap-4"><h3 class="border-b border-studio-text/10 pb-2 font-serif text-xl text-studio-text italic"> </h3> <div class="grid grid-cols-1 gap-3"></div></div>'),Xr=D(`<div class="fixed inset-0 z-[1200] flex items-center justify-center bg-black/20 backdrop-blur-sm" id="help-overlay"><div class="flex max-h-[85vh] w-[600px] flex-col gap-8 overflow-y-auto rounded-[3rem] border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between"><div class="flex flex-col"><span class="font-serif text-3xl text-brand italic">Artisan's Guide</span> <span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30">Mastering the Digital Loom</span></div> <button class="rounded-full border border-black/5 bg-white/50 px-4 py-2 text-[10px] font-bold tracking-widest uppercase opacity-40 transition-all hover:opacity-100">Got it</button></div> <div class="grid grid-cols-1 gap-8"></div> <div class="mt-4 border-t border-studio-text/5 pt-6 text-center"><p class="font-serif text-xs italic opacity-30">"Every stitch is a story, every pixel a memory."</p></div></div></div>`);function Zr(e,t){mt(t,!0);function r(){i.showHelp=!1}xt(()=>(i.pushEscapeAction(r),()=>i.popEscapeAction(r)));const o=[{category:"Artisan Navigation",items:[{label:"Move the Needle",keys:"Arrow Keys"},{label:"Loom Zoom In/Out",keys:"+ / -"},{label:"Reset View",keys:"Ctrl + 0"}]},{category:"Digital Stitching",items:[{label:"Place Stitch",keys:"Space"},{label:"Unstitch (Erase)",keys:"Backspace / Del"},{label:"Threading (Flow Mode)",keys:"Hold Shift + Arrows"},{label:"Unravelling (Erase Flow)",keys:"Hold Shift + Ctrl + Arrows"},{label:"Block Looming (2D Fill)",keys:"Hold Shift + Alt + Arrows"}]},{category:"Studio Tools",items:[{label:"Pattern Book (Catalog)",keys:"Ctrl + K"},{label:"Natural Dye Basin (Color)",keys:"Ctrl + P"},{label:"Pick Dye (Eyedropper)",keys:"I or Alt + Space"},{label:"Finish & Export",keys:"Ctrl + E"},{label:"Undo / Redo",keys:"Ctrl + Z / Ctrl + Y"},{label:"Toggle Studio Sounds",keys:"Ctrl + M"}]}];var a=Xr();a.__mousedown=p=>p.target.id==="help-overlay"&&r();var n=v(a),s=v(n),c=g(v(s),2);c.__click=r,u(s);var f=g(s,2);lt(f,21,()=>o,nt,(p,A)=>{var m=Gr(),h=v(m),b=v(h,!0);u(h);var E=g(h,2);lt(E,21,()=>l(A).items,nt,(_,d)=>{var y=qr(),T=v(y),N=v(T,!0);u(T);var w=g(T,2),L=v(w),U=v(L,!0);u(L),u(w),u(y),K(()=>{q(N,l(d).label),q(U,l(d).keys)}),P(_,y)}),u(E),u(m),K(()=>q(b,l(A).category)),P(p,m)}),u(f),kt(2),u(n),u(a),P(e,a),yt()}Qt(["mousedown","click"]);const $r=e=>e;function jr(e){const t=e-1;return t*t*t+1}function he(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function Vt(e,{delay:t=0,duration:r=400,easing:o=$r}={}){const a=+getComputedStyle(e).opacity;return{delay:t,duration:r,easing:o,css:n=>`opacity: ${n*a}`}}function Jr(e,{delay:t=0,duration:r=400,easing:o=jr,x:a=0,y:n=0,opacity:s=0}={}){const c=getComputedStyle(e),f=+c.opacity,p=c.transform==="none"?"":c.transform,A=f*(1-s),[m,h]=he(a),[b,E]=he(n);return{delay:t,duration:r,easing:o,css:(_,d)=>`
			transform: ${p} translate(${(1-_)*m}${h}, ${(1-_)*b}${E});
			opacity: ${f-A*d}`}}const Yr="data:image/png;base64,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";var ti=D(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-[#fdf6e3] svelte-1yxrgyh" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');"><div class="flex flex-col items-center gap-2 svelte-1yxrgyh"><div class="mb-6 flex animate-bounce items-center justify-center svelte-1yxrgyh"><img alt="Rupa Icon" class="h-24 w-auto drop-shadow-md svelte-1yxrgyh"/></div> <h1 class="font-tiny5 text-6xl text-brand drop-shadow-sm svelte-1yxrgyh">Rupa</h1> <p class="font-serif text-[10px] font-bold tracking-[0.4em] uppercase opacity-40 svelte-1yxrgyh">The Weaver's Studio</p></div> <div class="absolute bottom-16 flex flex-col items-center gap-4 svelte-1yxrgyh"><div class="h-0.5 w-48 overflow-hidden rounded-full bg-black/5 svelte-1yxrgyh"><div class="h-full animate-[loading_2s_ease-in-out_infinite] bg-brand/60 svelte-1yxrgyh"></div></div> <div class="flex flex-col items-center gap-1 svelte-1yxrgyh"><span class="font-serif text-[10px] italic opacity-40 svelte-1yxrgyh">Preparing the digital linen...</span> <span class="font-mono text-[9px] font-bold tracking-widest opacity-20 uppercase svelte-1yxrgyh"> </span></div></div></div>`);function ei(e,t){mt(t,!0);let r=I(!0);qt(()=>{const s=setTimeout(()=>{C(r,!1),setTimeout(()=>{i.isAppReady=!0},800)},2e3);return()=>clearTimeout(s)});var o=Ut(),a=bt(o);{var n=s=>{var c=ti(),f=v(c),p=v(f),A=v(p);u(p),kt(4),u(f);var m=g(f,2),h=g(v(m),2),b=g(v(h),2),E=v(b);u(b),u(h),u(m),u(c),K(()=>{zt(A,"src",Yr),q(E,`Version ${i.version??""}`)}),Ht(2,c,()=>Vt,()=>({duration:800})),P(s,c)};G(a,s=>{l(r)&&s(n)})}P(e,o),yt()}var ri=D('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-full rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-full bg-white opacity-80 shadow-sm"></div></div>',1),ii=D('<div class="cursor-container absolute inset-0 svelte-1f6cquq"><div class="bloom-wrapper svelte-1f6cquq"><div class="petal p-top svelte-1f6cquq"></div> <div class="petal p-bottom svelte-1f6cquq"></div> <div class="petal p-left svelte-1f6cquq"></div> <div class="petal p-right svelte-1f6cquq"></div> <div class="center-dot svelte-1f6cquq"></div></div> <!></div>');function si(e,t){mt(t,!1),_e();var r=Ut(),o=bt(r);{var a=n=>{var s=ii(),c=g(v(s),2);{var f=p=>{var A=ri(),m=bt(A),h=g(m,2),b=v(h),E=v(b);u(b),kt(2),u(h),K(()=>{j(m,`background-color: ${i.activeColor??""};`),j(E,`background-color: ${i.activeColor??""};`)}),Ht(3,m,()=>Vt,()=>({duration:400})),Ht(1,h,()=>Jr,()=>({y:-10,duration:400})),Ht(2,h,()=>Vt,()=>({duration:400})),P(p,A)};G(c,p=>{i.isPicking&&p(f)})}u(s),Ht(3,s,()=>Vt,()=>({duration:800})),P(n,s)};G(o,n=>{i.isCursorVisible&&n(a)})}P(e,r),yt()}var ai=D('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-studio-text/10"></div>'),oi=D('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-studio-text/10"></div>'),ni=D("<div><!></div>"),li=D('<div class="pointer-events-none absolute z-40 border-2 border-dashed border-brand bg-brand/10"><div class="absolute h-2 w-2 -translate-x-1/2 -translate-y-1/2 border border-white bg-brand shadow-sm"></div></div>'),ci=D('<div class="stitch-grid-pattern artisan-checker-small relative shrink-0 origin-center shadow-sm transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]"><div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-studio-text/30"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-studio-text/30"></div> <!> <!></div> <!> <!></div>');function di(e,t){mt(t,!1),_e();var r=ci(),o=v(r),a=g(v(o),4);lt(a,0,()=>[-24,-16,-8,8,16,24],nt,(p,A)=>{const m=Y(()=>50+A/i.gridWidth*100);var h=Ut(),b=bt(h);{var E=_=>{var d=ai();K(()=>j(d,`left: ${l(m)??""}%`)),P(_,d)};G(b,_=>{l(m)>0&&l(m)<100&&_(E)})}P(p,h)});var n=g(a,2);lt(n,0,()=>[-24,-16,-8,8,16,24],nt,(p,A)=>{const m=Y(()=>50+A/i.gridHeight*100);var h=Ut(),b=bt(h);{var E=_=>{var d=oi();K(()=>j(d,`top: ${l(m)??""}%`)),P(_,d)};G(b,_=>{l(m)>0&&l(m)<100&&_(E)})}P(p,h)}),u(o);var s=g(o,2);lt(s,1,()=>i.pixelData,nt,(p,A,m)=>{const h=Y(()=>m%i.gridWidth),b=Y(()=>Math.floor(m/i.gridWidth)),E=Y(()=>i.cursorPos.x===l(h)&&i.cursorPos.y===l(b)),_=Y(()=>l(A)==="#eee8d5");var d=ni(),y=v(d);{var T=N=>{si(N,{})};G(y,N=>{l(E)&&N(T)})}u(d),K(()=>{gt(d,1,`cell-stitch relative h-full w-full ${l(E)?"z-30":"z-10"}`),j(d,`background-color: ${(l(_)?"rgba(238, 232, 213, 0.01)":l(A))??""};`)}),P(p,d)});var c=g(s,2);{var f=p=>{const A=Y(()=>Math.min(i.selectionStart.x,i.selectionEnd.x)),m=Y(()=>Math.max(i.selectionStart.x,i.selectionEnd.x)),h=Y(()=>Math.min(i.selectionStart.y,i.selectionEnd.y)),b=Y(()=>Math.max(i.selectionStart.y,i.selectionEnd.y)),E=Y(()=>l(m)-l(A)+1),_=Y(()=>l(b)-l(h)+1);var d=li(),y=v(d);u(d),K(()=>{j(d,`
				left: ${l(A)/i.gridWidth*100}%; 
				top: ${l(h)/i.gridHeight*100}%; 
				width: ${l(E)/i.gridWidth*100}%; 
				height: ${l(_)/i.gridHeight*100}%;
			`),j(y,`
					left: ${(i.selectionStart.x-l(A)+.5)/l(E)*100}%;
					top: ${(i.selectionStart.y-l(h)+.5)/l(_)*100}%;
				`)}),P(p,d)};G(c,p=>{i.isBlockMode&&i.selectionStart&&i.selectionEnd&&p(f)})}u(r),K(()=>j(r,`
		display: grid;
		grid-template-columns: repeat(${i.gridWidth??""}, 1fr); 
		grid-template-rows: repeat(${i.gridHeight??""}, 1fr);
		width: min(75vh, 75vw); 
		height: min(75vh, 75vw);
		--grid-cols: ${i.gridWidth??""}; 
		--grid-rows: ${i.gridHeight??""}; 
		transform: ${i.cameraTransform??""};
		background-color: #eee8d5;
	`)),P(e,r),yt()}var ui=D("<button></button>"),vi=D('<button aria-label="Select used dye"></button>'),fi=D('<div class="flex w-full flex-col items-end"><span class="mb-1.5 font-serif text-[8px] font-bold uppercase opacity-40">Canvas Dyes</span> <div class="grid grid-cols-3 gap-1.5 rounded-lg border border-white bg-white/30 p-1.5"></div></div>'),pi=D('<div class="status-tag animate-pulse border-studio-teal/20 bg-studio-teal/10 text-studio-teal shadow-sm"><!></div>'),Ai=D('<div class="status-tag font-serif italic opacity-60">Studio Ready <span class="ml-2 border-l border-studio-text/20 pl-2 not-italic"> </span></div>'),hi=D(`<!> <!> <!> <!> <!> <div class="pointer-events-none fixed top-0 left-0 z-40 flex w-full justify-center p-6"><div class="flex flex-col items-center"><span class="font-tiny5 text-4xl text-brand opacity-90 drop-shadow-sm">Rupa</span> <span class="-mt-1 font-serif text-[9px] font-bold tracking-[0.3em] uppercase opacity-30">The Weaver's Studio</span></div></div> <div class="fixed top-1/2 left-0 z-50 -translate-y-1/2 p-2"><div class="artisan-panel side-panel-left flex flex-col gap-2 p-2"><span class="mb-1 text-center font-serif text-[7px] font-bold uppercase opacity-30">Dyes</span> <!> <div class="mx-auto my-1 h-px w-4 bg-studio-text/10"></div> <button class="via-sage-300 via-sage-300 h-7 w-7 rounded-full border-2 border-dashed border-brand/40 bg-gradient-to-tr from-rose-300 to-sky-300 shadow-sm transition-all hover:scale-110 hover:border-brand" title="Natural Dye Basin (Ctrl + P)"></button></div></div> <div class="fixed top-1/2 right-0 z-50 -translate-y-1/2 p-2"><div class="artisan-panel side-panel-right flex w-32 flex-col items-end gap-5 p-4"><div class="flex w-full flex-col items-end"><span class="mb-1 font-serif text-[8px] font-bold uppercase opacity-40">Needle</span> <div class="flex w-full flex-col items-end rounded-lg border border-white/50 bg-black/5 p-1.5"><span class="font-mono text-[10px] text-studio-text"> </span> <span class="mt-0.5 font-mono text-[9px] opacity-40"> </span></div></div> <!> <div class="flex w-full flex-col items-end"><span class="mb-1 font-serif text-[8px] font-bold uppercase opacity-40">Dye</span> <div class="h-10 w-10 overflow-hidden rounded-xl border-4 border-white bg-white p-0.5 shadow-lg ring-1 ring-brand/10"><div class="h-full w-full rounded-lg"></div></div></div></div></div> <div class="relative flex h-screen flex-1 items-center justify-center overflow-hidden"><div class="artisan-frame flex h-[80vh] w-[82vw] items-center justify-center overflow-hidden"><!></div></div> <div class="fixed bottom-0 left-0 z-50 flex w-full justify-center p-6"><div class="artisan-panel bottom-panel flex items-center gap-8 border-t-4 border-white px-8 py-4 shadow-xl"><div class="flex gap-3"><button class="artisan-tool-btn"><span>ðŸ“–</span> Catalog</button> <button class="artisan-tool-btn"><span>ðŸ§º</span> Export</button> <button class="artisan-tool-btn"><span>ðŸŒ¿</span> Clear</button> <button class="artisan-tool-btn"><span> </span> </button></div> <div class="h-8 w-px bg-studio-text/10"></div> <div class="flex gap-4"><!></div></div></div>`,1);function wi(e,t){mt(t,!0);let r=I(!1);async function o(x,k=10,M="transparent"){if(x==="svg"){const F=se.toSVG(i.gridWidth,i.gridHeight,i.pixelData,M),ot=new Blob([F],{type:"image/svg+xml"}),W=URL.createObjectURL(ot);a(W,"stitch-art.svg")}else{const F=await se.toPNG(i.gridWidth,i.gridHeight,i.pixelData,k,M);a(F,"stitch-art.png")}C(r,!1)}function a(x,k){const M=document.createElement("a");M.href=x,M.download=k,M.click()}function n(x){if(!i.isAppReady)return;if(i.resetInactivityTimer(),x.target instanceof HTMLInputElement||x.target instanceof HTMLTextAreaElement||x.target.isContentEditable){x.key==="Escape"&&(i.handleEscape(),x.preventDefault());return}if(i.isShiftPressed=x.shiftKey,i.isCtrlPressed=x.ctrlKey||x.metaKey,i.isAltPressed=x.altKey,i.isBlockMode&&!i.selectionStart&&i.startSelection(),x.key==="F1"){x.preventDefault(),i.showHelp=!i.showHelp;return}const k=dt.getBestMatch(x);if(k)switch(["UP","DOWN","LEFT","RIGHT"].includes(k)||x.preventDefault(),k){case"UP":return i.moveCursor(0,-1);case"DOWN":return i.moveCursor(0,1);case"LEFT":return i.moveCursor(-1,0);case"RIGHT":return i.moveCursor(1,0);case"ESCAPE":return i.handleEscape();case"COMMAND_PALETTE":return i.showCommandPalette=!i.showCommandPalette;case"COLOR_PICKER":return i.showColorPicker=!i.showColorPicker;case"EXPORT":return C(r,!0);case"STITCH":return i.stitch();case"UNSTITCH":case"UNSTITCH_MOD":return i.unstitch();case"EYEDROPPER":return i.pickColor();case"CLEAR_LINEN":return i.clearCanvas();case"UNDO":return i.undo();case"REDO":return i.redo();case"ZOOM_IN":return i.setZoom(.1);case"ZOOM_OUT":return i.setZoom(-.1);case"RESET_ZOOM":return i.resetZoom();case"TOGGLE_MUTE":return i.toggleMute();default:if(k.startsWith("SELECT_")){const M=parseInt(k.split("_")[1]);return i.selectPalette(M===0?9:M-1)}}}function s(x){const k=i.isBlockMode;x.key==="Shift"&&(i.isShiftPressed=!1),(x.key==="Control"||x.key==="Meta")&&(i.isCtrlPressed=!1),x.key==="Alt"&&(i.isAltPressed=!1),k&&!i.isBlockMode&&i.commitSelection()}qt(()=>{const x=M=>{M.detail==="open-export"&&C(r,!0),M.detail==="export-svg"&&o("svg")},k=()=>{C(r,!1)};return window.addEventListener("keydown",n),window.addEventListener("keyup",s),window.addEventListener("app:execute-command",x),window.addEventListener("app:close-export",k),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",s),window.removeEventListener("app:execute-command",x),window.removeEventListener("app:close-export",k)}});var c=hi(),f=bt(c);ei(f,{});var p=g(f,2);{var A=x=>{Zr(x,{})};G(p,x=>{i.showHelp&&x(A)})}var m=g(p,2);{var h=x=>{Wr(x,{})};G(m,x=>{i.showCommandPalette&&x(h)})}var b=g(m,2);{var E=x=>{ke(x,{onClose:()=>i.showColorPicker=!1,get value(){return i.activeColor},set value(k){i.activeColor=k}})};G(b,x=>{i.showColorPicker&&x(E)})}var _=g(b,2);{var d=x=>{zr(x,{onExport:o})};G(_,x=>{l(r)&&x(d)})}var y=g(_,4),T=v(y),N=g(v(T),2);lt(N,17,()=>i.palette,nt,(x,k,M)=>{var F=ui();F.__click=()=>i.selectPalette(M),zt(F,"aria-label",`Select dye ${M+1}`),K(()=>{gt(F,1,`h-7 w-7 rounded-full border-2 transition-all ${i.activeColor===l(k)?"scale-110 border-brand shadow-md ring-2 ring-white":"border-white opacity-70 hover:scale-105 hover:opacity-100"}`),j(F,`background-color: ${l(k)??""};`)}),P(x,F)});var w=g(N,4);w.__click=()=>i.showColorPicker=!0,u(T),u(y);var L=g(y,2),U=v(L),B=v(U),z=g(v(B),2),Q=v(z),R=v(Q);u(Q);var X=g(Q,2),et=v(X);u(X),u(z),u(B);var rt=g(B,2);{var _t=x=>{var k=fi(),M=g(v(k),2);lt(M,21,()=>i.usedColors,nt,(F,ot)=>{var W=vi();W.__click=()=>i.activeColor=l(ot),K(()=>{gt(W,1,`h-4 w-4 rounded border transition-all hover:scale-110 ${i.activeColor===l(ot)?"border-brand ring-1 ring-brand/30":"border-black/5 opacity-60"}`),j(W,`background-color: ${l(ot)??""};`)}),P(F,W)}),u(M),u(k),P(x,k)};G(rt,x=>{i.usedColors.length>0&&x(_t)})}var it=g(rt,2),J=g(v(it),2),ct=v(J);u(J),u(it),u(U),u(L);var ft=g(L,2),St=v(ft),O=v(St);di(O,{}),u(St),u(ft);var H=g(ft,2),V=v(H),st=v(V),Tt=v(st);Tt.__click=()=>i.showCommandPalette=!0;var Pt=g(Tt,2);Pt.__click=()=>C(r,!0);var Mt=g(Pt,2);Mt.__click=()=>i.clearCanvas();var wt=g(Mt,2);wt.__click=()=>i.toggleMute();var pt=v(wt),Gt=v(pt,!0);u(pt);var S=g(pt);u(wt),u(st);var Z=g(st,4),$=v(Z);{var at=x=>{var k=pi(),M=v(k);{var F=W=>{var Ft=ne("âœ¨ Block Looming");P(W,Ft)},ot=W=>{var Ft=ne();K(()=>q(Ft,i.isCtrlPressed?"âœ¨ Unravelling":"ðŸ§µ Threading")),P(W,Ft)};G(M,W=>{i.isBlockMode?W(F):W(ot,!1)})}u(k),P(x,k)},Ct=x=>{var k=Ai(),M=g(v(k)),F=v(M);u(M),u(k),K(()=>q(F,`v${i.version??""}`)),P(x,k)};G($,x=>{i.isShiftPressed?x(at):x(Ct,!1)})}u(Z),u(V),u(H),K(x=>{q(R,`X:${i.displayCoords.x??""} Y:${i.displayCoords.y??""}`),q(et,`Z: ${x??""}%`),j(ct,`background-color: ${i.activeColor??""};`),q(Gt,i.isMuted?"ðŸ”‡":"ðŸ”Š"),q(S,` ${i.isMuted?"Unmute":"Mute"}`)},[()=>Math.round(i.zoomLevel*100)]),P(e,c),yt()}Qt(["click"]);export{wi as component};
