import{a as _,f as T,c as Ae,t as Ue,d as ut}from"../chunks/CJ2NQvf5.js";import{i as ce}from"../chunks/Zc2Ip1hF.js";import{o as Ke}from"../chunks/ILLtIQhF.js";import{aL as jt,b as Ct,h as ve,J as Tt,a as et,aM as kt,L as tt,D as Rt,n as d,N as Gt,O as Ut,P as At,Q as it,f as ze,aa as $t,aE as Ht,am as yt,c as Ne,aN as Ie,e as nt,aO as Kt,s as zt,a4 as Xe,aP as Wt,aC as vt,aQ as Qt,aR as Xt,aH as Yt,a9 as ot,aS as qt,r as Lt,p as Pt,aT as st,U as pt,aU as Zt,aV as Jt,aB as ei,d as ti,ay as ii,G as si,E as ai,aW as ri,I as ni,R as oi,aX as li,aY as ci,aZ as je,av as Vt,j as Le,a_ as di,a$ as ui,b0 as vi,b1 as pi,b2 as hi,b3 as fi,b4 as gi,b5 as xi,aI as bi,S as mi,b6 as Ai,_ as y,aJ as L,Z as pe,aK as Q,y as H,A as F,B as K,w as p,C as h,x as v,an as Ce,z as ae,i as ye}from"../chunks/DhsvLTXt.js";import{_ as yi,i as R,p as J,b as _i}from"../chunks/B921n9nw.js";import{a as wi,s as B,d as le,e as be}from"../chunks/Jm0VYppp.js";import{B as Ei}from"../chunks/DjgJNkqp.js";import{s as Si}from"../chunks/ATgSjtUm.js";const Ii=Symbol("NaN");function Ci(o,e,t){ve&&Tt();var i=new Ei(o),a=!jt();Ct(()=>{var r=e();r!==r&&(r=Ii),a&&r!==null&&typeof r=="object"&&(r={}),i.ensure(r,t)})}function oe(o,e){return e}function Ti(o,e,t){for(var i=[],a=e.length,r,n=e.length,l=0;l<a;l++){let x=e[l];Pt(x,()=>{if(r){if(r.pending.delete(x),r.done.add(x),r.pending.size===0){var g=o.outrogroups;lt(vt(r.done)),g.delete(r),g.size===0&&(o.outrogroups=null)}}else n-=1},!1)}if(n===0){var c=i.length===0&&t!==null;if(c){var u=t,f=u.parentNode;ei(f),f.append(u),o.items.clear()}lt(e,!c)}else r={pending:new Set(e),done:new Set},(o.outrogroups??=new Set).add(r)}function lt(o,e=!0){for(var t=0;t<o.length;t++)ti(o[t],e)}var _t;function re(o,e,t,i,a,r=null){var n=o,l=new Map,c=(e&kt)!==0;if(c){var u=o;n=ve?tt(Rt(u)):u.appendChild(et())}ve&&Tt();var f=null,x=Xe(()=>{var m=t();return Wt(m)?m:m==null?[]:vt(m)}),g,A=!0;function C(){b.fallback=f,ki(b,g,n,e,i),f!==null&&(g.length===0?(f.f&Ie)===0?Lt(f):(f.f^=Ie,Ge(f,null,n)):Pt(f,()=>{f=null}))}var w=Ct(()=>{g=d(x);var m=g.length;let E=!1;if(ve){var I=Gt(n)===Ut;I!==(m===0)&&(n=At(),tt(n),it(!1),E=!0)}for(var S=new Set,M=Ne,P=zt(),O=0;O<m;O+=1){ve&&ze.nodeType===$t&&ze.data===Ht&&(n=ze,E=!0,it(!1));var j=g[O],V=i(j,O),D=A?null:l.get(V);D?(D.v&&yt(D.v,j),D.i&&yt(D.i,O),P&&M.unskip_effect(D.e)):(D=Li(l,A?n:_t??=et(),j,V,O,a,e,t),A||(D.e.f|=Ie),l.set(V,D)),S.add(V)}if(m===0&&r&&!f&&(A?f=nt(()=>r(n)):(f=nt(()=>r(_t??=et())),f.f|=Ie)),m>S.size&&Kt(),ve&&m>0&&tt(At()),!A)if(P){for(const[X,ee]of l)S.has(X)||M.skip_effect(ee.e);M.oncommit(C),M.ondiscard(()=>{})}else C();E&&it(!0),d(x)}),b={effect:w,items:l,outrogroups:null,fallback:f};A=!1,ve&&(n=ze)}function Re(o){for(;o!==null&&(o.f&Zt)===0;)o=o.next;return o}function ki(o,e,t,i,a){var r=(i&Jt)!==0,n=e.length,l=o.items,c=Re(o.effect.first),u,f=null,x,g=[],A=[],C,w,b,m;if(r)for(m=0;m<n;m+=1)C=e[m],w=a(C,m),b=l.get(w).e,(b.f&Ie)===0&&(b.nodes?.a?.measure(),(x??=new Set).add(b));for(m=0;m<n;m+=1){if(C=e[m],w=a(C,m),b=l.get(w).e,o.outrogroups!==null)for(const D of o.outrogroups)D.pending.delete(b),D.done.delete(b);if((b.f&Ie)!==0)if(b.f^=Ie,b===c)Ge(b,null,t);else{var E=f?f.next:c;b===o.effect.last&&(o.effect.last=b.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),ke(o,f,b),ke(o,b,E),Ge(b,E,t),f=b,g=[],A=[],c=Re(f.next);continue}if((b.f&st)!==0&&(Lt(b),r&&(b.nodes?.a?.unfix(),(x??=new Set).delete(b))),b!==c){if(u!==void 0&&u.has(b)){if(g.length<A.length){var I=A[0],S;f=I.prev;var M=g[0],P=g[g.length-1];for(S=0;S<g.length;S+=1)Ge(g[S],I,t);for(S=0;S<A.length;S+=1)u.delete(A[S]);ke(o,M.prev,P.next),ke(o,f,M),ke(o,P,I),c=I,f=P,m-=1,g=[],A=[]}else u.delete(b),Ge(b,c,t),ke(o,b.prev,b.next),ke(o,b,f===null?o.effect.first:f.next),ke(o,f,b),f=b;continue}for(g=[],A=[];c!==null&&c!==b;)(u??=new Set).add(c),A.push(c),c=Re(c.next);if(c===null)continue}(b.f&Ie)===0&&g.push(b),f=b,c=Re(b.next)}if(o.outrogroups!==null){for(const D of o.outrogroups)D.pending.size===0&&(lt(vt(D.done)),o.outrogroups?.delete(D));o.outrogroups.size===0&&(o.outrogroups=null)}if(c!==null||u!==void 0){var O=[];if(u!==void 0)for(b of u)(b.f&st)===0&&O.push(b);for(;c!==null;)(c.f&st)===0&&c!==o.fallback&&O.push(c),c=Re(c.next);var j=O.length;if(j>0){var V=(i&kt)!==0&&n===0?t:null;if(r){for(m=0;m<j;m+=1)O[m].nodes?.a?.measure();for(m=0;m<j;m+=1)O[m].nodes?.a?.fix()}Ti(o,O,V)}}r&&pt(()=>{if(x!==void 0)for(b of x)b.nodes?.a?.apply()})}function Li(o,e,t,i,a,r,n,l){var c=(n&Qt)!==0?(n&Xt)===0?Yt(t,!1,!1):ot(t):null,u=(n&qt)!==0?ot(a):null;return{v:c,i:u,e:nt(()=>(r(e,c??t,u??a,l),()=>{o.delete(i)}))}}function Ge(o,e,t){if(o.nodes)for(var i=o.nodes.start,a=o.nodes.end,r=e&&(e.f&Ie)===0?e.nodes.start:t;i!==null;){var n=ii(i);if(r.before(i),i===a)return;i=n}}function ke(o,e,t){e===null?o.effect.first=t:e.next=t,t===null?o.effect.last=e:t.prev=e}const Pi=()=>performance.now(),Se={tick:o=>requestAnimationFrame(o),now:()=>Pi(),tasks:new Set};function Ft(){const o=Se.now();Se.tasks.forEach(e=>{e.c(o)||(Se.tasks.delete(e),e.f())}),Se.tasks.size!==0&&Se.tick(Ft)}function Vi(o){let e;return Se.tasks.size===0&&Se.tick(Ft),{promise:new Promise(t=>{Se.tasks.add(e={c:o,f:t})}),abort(){Se.tasks.delete(e)}}}function Ye(o,e){Vt(()=>{o.dispatchEvent(new CustomEvent(e))})}function Fi(o){if(o==="float")return"cssFloat";if(o==="offset")return"cssOffset";if(o.startsWith("--"))return o;const e=o.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function wt(o){const e={},t=o.split(";");for(const i of t){const[a,r]=i.split(":");if(!a||r===void 0)break;const n=Fi(a.trim());e[n]=r.trim()}return e}const Mi=o=>o;function ne(o,e,t,i){var a=(o&di)!==0,r=(o&ui)!==0,n=a&&r,l=(o&li)!==0,c=n?"both":a?"in":"out",u,f=e.inert,x=e.style.overflow,g,A;function C(){return Vt(()=>u??=t()(e,i?.()??{},{direction:c}))}var w={is_global:l,in(){if(e.inert=f,!a){A?.abort(),A?.reset?.();return}r||g?.abort(),g=ct(e,C(),A,1,()=>{Ye(e,"introend"),g?.abort(),g=u=void 0,e.style.overflow=x})},out(I){if(!r){I?.(),u=void 0;return}e.inert=!0,A=ct(e,C(),g,0,()=>{Ye(e,"outroend"),I?.()})},stop:()=>{g?.abort(),A?.abort()}},b=si;if((b.nodes.t??=[]).push(w),a&&wi){var m=l;if(!m){for(var E=b.parent;E&&(E.f&ai)!==0;)for(;(E=E.parent)&&(E.f&ri)===0;);m=!E||(E.f&ni)!==0}m&&oi(()=>{Le(()=>w.in())})}}function ct(o,e,t,i,a){var r=i===1;if(ci(e)){var n,l=!1;return pt(()=>{if(!l){var b=e({direction:r?"in":"out"});n=ct(o,b,t,i,a)}}),{abort:()=>{l=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return Ye(o,r?"introstart":"outrostart"),a(),{abort:je,deactivate:je,reset:je,t:()=>i};const{delay:c=0,css:u,tick:f,easing:x=Mi}=e;var g=[];if(r&&t===void 0&&(f&&f(0,1),u)){var A=wt(u(0,1));g.push(A,A)}var C=()=>1-i,w=o.animate(g,{duration:c,fill:"forwards"});return w.onfinish=()=>{w.cancel(),Ye(o,r?"introstart":"outrostart");var b=t?.t()??1-i;t?.abort();var m=i-b,E=e.duration*Math.abs(m),I=[];if(E>0){var S=!1;if(u)for(var M=Math.ceil(E/16.666666666666668),P=0;P<=M;P+=1){var O=b+m*x(P/M),j=wt(u(O,1-O));I.push(j),S||=j.overflow==="hidden"}S&&(o.style.overflow="hidden"),C=()=>{var V=w.currentTime;return b+m*x(V/E)},f&&Vi(()=>{if(w.playState!=="running")return!1;var V=C();return f(V,1-V),!0})}w=o.animate(I,{duration:E,fill:"forwards"}),w.onfinish=()=>{C=()=>i,f?.(i,1-i),a()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=je)},deactivate:()=>{a=je},reset:()=>{i===0&&f?.(1,0)},t:()=>C()}}function Mt(o){var e,t,i="";if(typeof o=="string"||typeof o=="number")i+=o;else if(typeof o=="object")if(Array.isArray(o)){var a=o.length;for(e=0;e<a;e++)o[e]&&(t=Mt(o[e]))&&(i&&(i+=" "),i+=t)}else for(t in o)o[t]&&(i&&(i+=" "),i+=t);return i}function Oi(){for(var o,e,t=0,i="",a=arguments.length;t<a;t++)(o=arguments[t])&&(e=Mt(o))&&(i&&(i+=" "),i+=e);return i}function Di(o){return typeof o=="object"?Oi(o):o??""}const Et=[...` 	
\r\fÂ \v\uFEFF`];function Ni(o,e,t){var i=o==null?"":""+o;if(e&&(i=i?i+" "+e:e),t){for(var a in t)if(t[a])i=i?i+" "+a:a;else if(i.length)for(var r=a.length,n=0;(n=i.indexOf(a,n))>=0;){var l=n+r;(n===0||Et.includes(i[n-1]))&&(l===i.length||Et.includes(i[l]))?i=(n===0?"":i.substring(0,n))+i.substring(l+1):n=l}}return i===""?null:i}function Bi(o,e){return o==null?null:String(o)}function z(o,e,t,i,a,r){var n=o.__className;if(ve||n!==t||n===void 0){var l=Ni(t,i,r);(!ve||l!==o.getAttribute("class"))&&(l==null?o.removeAttribute("class"):o.className=l),o.__className=t}else if(r&&a!==r)for(var c in r){var u=!!r[c];(a==null||u!==!!a[c])&&o.classList.toggle(c,u)}return r}function Z(o,e,t,i){var a=o.__style;if(ve||a!==e){var r=Bi(e);(!ve||r!==o.getAttribute("style"))&&(r==null?o.removeAttribute("style"):o.style.cssText=r),o.__style=e}return i}const ji=Symbol("is custom element"),Ri=Symbol("is html");function de(o){if(ve){var e=!1,t=()=>{if(!e){if(e=!0,o.hasAttribute("value")){var i=o.value;se(o,"value",null),o.value=i}if(o.hasAttribute("checked")){var a=o.checked;se(o,"checked",null),o.checked=a}}};o.__on_r=t,pt(t),hi()}}function se(o,e,t,i){var a=Gi(o);ve&&(a[e]=o.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&o.nodeName==="LINK")||a[e]!==(a[e]=t)&&(e==="loading"&&(o[fi]=t),t==null?o.removeAttribute(e):typeof t!="string"&&Ui(o).includes(e)?o[e]=t:o.setAttribute(e,t))}function Gi(o){return o.__attributes??={[ji]:o.nodeName.includes("-"),[Ri]:o.namespaceURI===vi}}var St=new Map;function Ui(o){var e=o.getAttribute("is")||o.nodeName,t=St.get(e);if(t)return t;St.set(e,t=[]);for(var i,a=o,r=Element.prototype;r!==a;){i=gi(a);for(var n in i)i[n].set&&t.push(n);a=pi(a)}return t}function ue(o,e,t=e){var i=new WeakSet;xi(o,"input",async a=>{var r=a?o.defaultValue:o.value;if(r=at(o)?rt(r):r,t(r),Ne!==null&&i.add(Ne),await bi(),r!==(r=e())){var n=o.selectionStart,l=o.selectionEnd,c=o.value.length;if(o.value=r??"",l!==null){var u=o.value.length;n===l&&l===c&&u>c?(o.selectionStart=u,o.selectionEnd=u):(o.selectionStart=n,o.selectionEnd=Math.min(l,u))}}}),(ve&&o.defaultValue!==o.value||Le(e)==null&&o.value)&&(t(at(o)?rt(o.value):o.value),Ne!==null&&i.add(Ne)),mi(()=>{var a=e();if(o===document.activeElement){var r=Ai??Ne;if(i.has(r))return}at(o)&&a===rt(o.value)||o.type==="date"&&!a&&!o.value||a!==o.value&&(o.value=a??"")})}function at(o){var e=o.type;return e==="number"||e==="range"}function rt(o){return o===""?null:+o}function Je(o){var e=ot(0);return function(){return arguments.length===1?(y(e,d(e)+1),arguments[0]):(d(e),o())}}class $i{project;constructor(e){this.project=e}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get stitches(){return this.project.activeFrame.activeVeil.stitches}get compositeStitches(){return this.project.activeFrame.compositeStitches}set stitches(e){this.project.activeFrame.activeVeil.stitches=e}reset(e,t,i){this.width=e,this.height=t,this.stitches=i}clear(){this.project.activeFrame.activeVeil.clear()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.stitches[this.getIndex(e,t)]}setColor(e,t,i){this.stitches[this.getIndex(e,t)]=i}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}}class Hi{#e=L(pe({x:0,y:0}));get pos(){return d(this.#e)}set pos(e){y(this.#e,e,!0)}#t=L(!0);get isVisible(){return d(this.#t)}set isVisible(e){y(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}class Ki{#e=L("#073642");get activeDye(){return d(this.#e)}set activeDye(e){y(this.#e,e,!0)}#t=L(pe(["#073642","#586e75","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"]));get swatches(){return d(this.#t)}set swatches(e){y(this.#t,e,!0)}select(e){e>=0&&e<this.swatches.length&&(this.activeDye=this.swatches[e])}setDye(e){this.activeDye=e}}class zi{#e=L(1);get zoomLevel(){return d(this.#e)}set zoomLevel(e){y(this.#e,e,!0)}#t=L(!1);get isMuted(){return d(this.#t)}set isMuted(e){y(this.#t,e,!0)}#i=L(!0);get isAmbientPlaying(){return d(this.#i)}set isAmbientPlaying(e){y(this.#i,e,!0)}#s=L(!1);get isAppReady(){return d(this.#s)}set isAppReady(e){y(this.#s,e,!0)}#a=L(!1);get isPicking(){return d(this.#a)}set isPicking(e){y(this.#a,e,!0)}#r=L(.5);get bgmVolume(){return d(this.#r)}set bgmVolume(e){y(this.#r,e,!0)}#n=L(.5);get sfxVolume(){return d(this.#n)}set sfxVolume(e){y(this.#n,e,!0)}#o=L(10);get fps(){return d(this.#o)}set fps(e){y(this.#o,e,!0)}#l=L(!1);get isKineticMode(){return d(this.#l)}set isKineticMode(e){y(this.#l,e,!0)}#c=L(!1);get showGhostThreads(){return d(this.#c)}set showGhostThreads(e){y(this.#c,e,!0)}sessionStartTime=Date.now();#d=L(0);get usageMinutes(){return d(this.#d)}set usageMinutes(e){y(this.#d,e,!0)}#u=L(0);get usageSeconds(){return d(this.#u)}set usageSeconds(e){y(this.#u,e,!0)}#v=Q(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),i=Math.floor(e%3600/60),a=e%60;return`${t>0?t+":":""}${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`});get sessionTimeLabel(){return d(this.#v)}set sessionTimeLabel(e){y(this.#v,e)}#p=L(!1);get showDyeBasin(){return d(this.#p)}set showDyeBasin(e){y(this.#p,e,!0)}#h=L(!1);get showAudioBasin(){return d(this.#h)}set showAudioBasin(e){y(this.#h,e,!0)}#f=L(!1);get showPatternCatalog(){return d(this.#f)}set showPatternCatalog(e){y(this.#f,e,!0)}#g=L(!1);get showArtisanGuide(){return d(this.#g)}set showArtisanGuide(e){y(this.#g,e,!0)}#x=L(!1);get showArtisanCodex(){return d(this.#x)}set showArtisanCodex(e){y(this.#x,e,!0)}#b=L(!1);get showArtifactCrate(){return d(this.#b)}set showArtifactCrate(e){y(this.#b,e,!0)}#m=L(!1);get showLinenSettings(){return d(this.#m)}set showLinenSettings(e){y(this.#m,e,!0)}#A=L(!1);get showArchivePattern(){return d(this.#A)}set showArchivePattern(e){y(this.#A,e,!0)}#y=L(!1);get showGoTo(){return d(this.#y)}set showGoTo(e){y(this.#y,e,!0)}#_=L("veils");get folioActiveTab(){return d(this.#_)}set folioActiveTab(e){y(this.#_,e,!0)}#w=L("#eee8d5");get canvasBgColor(){return d(this.#w)}set canvasBgColor(e){y(this.#w,e,!0)}#E=L(10);get exportScale(){return d(this.#E)}set exportScale(e){y(this.#E,e,!0)}#S=L("transparent");get exportBgColor(){return d(this.#S)}set exportBgColor(e){y(this.#S,e,!0)}escapeStack=[];setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.5,Math.min(5,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();return e?(e(),!0):!1}}class $e{id=crypto.randomUUID();#e=L("New Veil");get name(){return d(this.#e)}set name(e){y(this.#e,e,!0)}#t=L(!0);get isVisible(){return d(this.#t)}set isVisible(e){y(this.#t,e,!0)}#i=L(!1);get isLocked(){return d(this.#i)}set isLocked(e){y(this.#i,e,!0)}#s=L(1);get opacity(){return d(this.#s)}set opacity(e){y(this.#s,e,!0)}#a=L(pe([]));get stitches(){return d(this.#a)}set stitches(e){y(this.#a,e,!0)}constructor(e,t,i){this.name=e,this.stitches=Array(t*i).fill(null)}clone(e,t){const i=new $e(this.name,e,t);return i.stitches=[...this.stitches],i.isVisible=this.isVisible,i.isLocked=this.isLocked,i.opacity=this.opacity,i}clear(){this.stitches.fill(null)}hasStitch(e){return this.stitches[e]!==null}}class qe{id=crypto.randomUUID();#e=L("Untitled Frame");get name(){return d(this.#e)}set name(e){y(this.#e,e,!0)}#t=L(32);get width(){return d(this.#t)}set width(e){y(this.#t,e,!0)}#i=L(32);get height(){return d(this.#i)}set height(e){y(this.#i,e,!0)}#s=L(100);get duration(){return d(this.#s)}set duration(e){y(this.#s,e,!0)}#a=L(pe([]));get veils(){return d(this.#a)}set veils(e){y(this.#a,e,!0)}#r=L(0);get activeVeilIndex(){return d(this.#r)}set activeVeilIndex(e){y(this.#r,e,!0)}constructor(e,t=32,i=32){this.name=e,this.width=t,this.height=i,this.veils=[new $e("Base Veil",t,i)]}get activeVeil(){return this.veils[this.activeVeilIndex]}addVeil(e){const t=e||`Veil ${this.veils.length+1}`,i=new $e(t,this.width,this.height);return this.veils.push(i),this.activeVeilIndex=this.veils.length-1,i}removeVeil(e){this.veils.length<=1||(this.veils.splice(e,1),this.activeVeilIndex>=this.veils.length&&(this.activeVeilIndex=this.veils.length-1))}get compositeStitches(){const e=new Array(this.width*this.height).fill(null);for(const t of this.veils)if(t.isVisible)for(let i=0;i<e.length;i++){const a=t.stitches[i];a!==null&&(e[i]=a)}return e}}class Wi{#e=L("Untitled Stitch");get name(){return d(this.#e)}set name(e){y(this.#e,e,!0)}#t=L(null);get currentFilePath(){return d(this.#t)}set currentFilePath(e){y(this.#t,e,!0)}#i=L(null);get lastSaved(){return d(this.#i)}set lastSaved(e){y(this.#i,e,!0)}#s=L(pe([]));get frames(){return d(this.#s)}set frames(e){y(this.#s,e,!0)}#a=L(0);get activeFrameIndex(){return d(this.#a)}set activeFrameIndex(e){y(this.#a,e,!0)}#r=L(!1);get isPlaying(){return d(this.#r)}set isPlaying(e){y(this.#r,e,!0)}#n=L(null);get clipboard(){return d(this.#n)}set clipboard(e){y(this.#n,e,!0)}constructor(){this.frames=[new qe("Main Motif")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,i=new qe(t);return this.frames.push(i),this.activeFrameIndex=this.frames.length-1,i}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e,t=null){this.name=e,this.currentFilePath=t,this.lastSaved=new Date}}class Qi{#e=L(null);get start(){return d(this.#e)}set start(e){y(this.#e,e,!0)}#t=L(null);get end(){return d(this.#t)}set end(e){y(this.#t,e,!0)}#i=L(pe([]));get indices(){return d(this.#i)}set indices(e){y(this.#i,e,!0)}#s=L(pe([]));get vertices(){return d(this.#s)}set vertices(e){y(this.#s,e,!0)}get isActive(){return this.indices.length>0||this.start!==null||this.vertices.length>0}begin(e,t){this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.indices=[],this.vertices=[]}getPoints(e){const t=new Map;this.indices.forEach(a=>{t.set(a,{x:a%e,y:Math.floor(a/e)})});const i=this.rectangularBounds;if(i)for(let a=i.y1;a<=i.y2;a++)for(let r=i.x1;r<=i.x2;r++){const n=a*e+r;t.set(n,{x:r,y:a})}return Array.from(t.values())}getBoundaryEdges(e){const t=[],i=this.getPoints(e);if(i.length===0)return t;const a=new Set(i.map(r=>`${r.x},${r.y}`));return i.forEach(r=>{a.has(`${r.x},${r.y-1}`)||t.push({x1:r.x,y1:r.y,x2:r.x+1,y2:r.y}),a.has(`${r.x},${r.y+1}`)||t.push({x1:r.x,y1:r.y+1,x2:r.x+1,y2:r.y+1}),a.has(`${r.x-1},${r.y}`)||t.push({x1:r.x,y1:r.y,x2:r.x,y2:r.y+1}),a.has(`${r.x+1},${r.y}`)||t.push({x1:r.x+1,y1:r.y,x2:r.x+1,y2:r.y+1})}),t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){const t=this.getPoints(e);if(t.length===0)return null;let i=1/0,a=-1/0,r=1/0,n=-1/0;return t.forEach(l=>{l.x<i&&(i=l.x),l.x>a&&(a=l.x),l.y<r&&(r=l.y),l.y>n&&(n=l.y)}),{x1:i,x2:a,y1:r,y2:n,width:a-i+1,height:n-r+1}}}class Xi{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){!("isStructural"in e)&&!Array.isArray(e)&&e.oldColor===e.newColor||(this.currentBatch&&!("isStructural"in e)&&!Array.isArray(e)?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const $=new Xi;class Yi{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const ht=new Yi;class qi{get ctx(){return ht.ctx}playTone(e,t,i="sine",a=.1,r=1e-4){if(s.isMuted)return;const n=this.ctx.createOscillator(),l=this.ctx.createGain();n.type=i,n.frequency.setValueAtTime(e,this.ctx.currentTime);const c=a*s.sfxVolume;l.gain.setValueAtTime(c,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(r,this.ctx.currentTime+t),n.connect(l),l.connect(this.ctx.destination),n.start(),n.stop(this.ctx.currentTime+t)}playMove(){this.playTone(450,.08,"sine",.15)}playStitch(){this.playTone(1200,.15,"sine",.03),setTimeout(()=>this.playTone(1500,.1,"sine",.02),50)}playScale(e){const t=[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25],i=t[e%t.length];this.playTone(i,.15,"sine",.12)}playUnstitch(){if(s.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,i=this.ctx.createBuffer(1,t,this.ctx.sampleRate),a=i.getChannelData(0);for(let u=0;u<t;u++)a[u]=Math.random()*2-1;const r=this.ctx.createBufferSource();r.buffer=i;const n=this.ctx.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(1500,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const l=this.ctx.createGain(),c=.1*s.sfxVolume;l.gain.setValueAtTime(c,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),r.connect(n),n.connect(l),l.connect(this.ctx.destination),r.start()}}const G=new qi;class Zi{move(e,t){const i=Math.max(0,Math.min(s.linen.width-1,s.needle.pos.x+e)),a=Math.max(0,Math.min(s.linen.height-1,s.needle.pos.y+t));return i!==s.needle.pos.x||a!==s.needle.pos.y?(s.needle.setPos(i,a),G.playMove(),!0):!1}internalToCartesian(e,t,i,a){const r=(n,l)=>{const c=Math.floor(l/2);return l%2===0?n<c?n-c:n-c+1:n-c};return{x:r(e,i),y:-r(t,a)}}cartesianToInternal(e,t,i,a){const r=Math.floor(i/2),n=Math.floor(a/2);let l,c;i%2===0?l=e<0?e+r:e+r-1:l=e+r;const u=-t;return a%2===0?c=u<0?u+n:u+n-1:c=u+n,{x:Math.max(0,Math.min(i-1,l)),y:Math.max(0,Math.min(a-1,c))}}jumpTo(e,t){const{x:i,y:a}=this.cartesianToInternal(e,t,s.linen.width,s.linen.height);s.needle.setPos(i,a)}}class Ji{stitch(){const{x:e,y:t}=s.needle.pos,i=s.linen.getIndex(e,t),a=s.linen.stitches[i],r=s.paletteState.activeDye;a!==r&&($.push({index:i,oldColor:a,newColor:r}),s.linen.setColor(e,t,r),G.playStitch())}unstitch(){const{x:e,y:t}=s.needle.pos,i=s.linen.getIndex(e,t),a=s.linen.stitches[i];a!==null&&($.push({index:i,oldColor:a,newColor:null}),s.linen.setColor(e,t,null),G.playUnstitch())}pickDye(){const{x:e,y:t}=s.needle.pos,i=s.linen.getColor(e,t);i!==null&&(s.paletteState.setDye(i),G.playStitch(),s.studio.isPicking=!0,setTimeout(()=>{s.studio.isPicking=!1},1500))}}class es{resize(e,t){const i=Array(e*t).fill("#eee8d5");for(let a=0;a<Math.min(s.linen.height,t);a++)for(let r=0;r<Math.min(s.linen.width,e);r++){const n=a*s.linen.width+r,l=a*e+r;i[l]=s.linen.stitches[n]}s.linen.reset(e,t,i),$.clear(),G.playStitch()}flip(e){const{width:t,height:i,stitches:a}=s.linen,r=[...a];if(e==="horizontal")for(let n=0;n<i;n++){const l=a.slice(n*t,(n+1)*t);l.reverse();for(let c=0;c<t;c++)r[n*t+c]=l[c]}else for(let n=0;n<i;n++)for(let l=0;l<t;l++){const c=n*t+l,u=(i-1-n)*t+l;r[u]=a[c]}s.linen.stitches=r,$.clear(),G.playStitch()}rotate(){const{width:e,height:t,stitches:i}=s.linen;if(e!==t)return;const a=Array(e*t).fill("#eee8d5");for(let r=0;r<t;r++)for(let n=0;n<e;n++){const l=r*e+n,c=n*e+(t-1-r);a[c]=i[l]}s.linen.stitches=a,$.clear(),G.playStitch()}clearAll(){confirm("Are you sure you want to unravel the entire project?")&&(s.linen.clear(),$.clear(),G.playUnstitch())}bleach(){const{x:e,y:t}=s.needle.pos,i=s.linen.getColor(e,t),a=s.activeDye;if(i===a)return;const{stitches:r}=s.linen,n=[],l=s.selection.isActive,c=s.selection.indices;r.forEach((u,f)=>{const x=u===i,g=!l||c.includes(f);x&&g&&(n.push({index:f,oldColor:i,newColor:a}),s.linen.stitches[f]=a)}),n.length>0&&($.beginBatch(),n.forEach(u=>$.push(u)),$.endBatch(),G.playStitch())}}class ts{copy(){const e=s.linen.width,t=s.selection.getPoints(e),i=s.selection.getEffectiveBounds(e);if(!i||t.length===0)return;const a=new Array(i.width*i.height).fill(null);t.forEach(r=>{const n=r.y*e+r.x,l=r.x-i.x1,u=(r.y-i.y1)*i.width+l;a[u]=s.linen.stitches[n]}),s.project.clipboard={width:i.width,height:i.height,data:a},G.playStitch()}cut(){this.copy();const e=s.linen.width,t=s.selection.getPoints(e);t.length!==0&&($.beginBatch(),t.forEach(i=>{const a=i.y*e+i.x,r=s.linen.stitches[a];$.push({index:a,oldColor:r,newColor:null}),s.linen.stitches[a]=null}),$.endBatch(),G.playUnstitch(),s.selection.clear())}paste(){const e=s.project.clipboard;if(!e)return;const{x:t,y:i}=s.needle.pos,{width:a,height:r}=s.linen;$.beginBatch();for(let n=0;n<e.height;n++)for(let l=0;l<e.width;l++){const c=t+l,u=i+n;if(c>=0&&c<a&&u>=0&&u<r){const f=n*e.width+l,x=e.data[f];if(x!==null){const g=u*a+c,A=s.linen.stitches[g];$.push({index:g,oldColor:A,newColor:x}),s.linen.stitches[g]=x}}}$.endBatch(),G.playStitch()}}class is{serialize(){return JSON.stringify({version:s.version,metadata:{name:s.project.name,lastModified:new Date().toISOString()},palette:s.paletteState.swatches,folio:{frames:s.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,veils:e.veils.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,stitches:t.stitches}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,s.project.currentFilePath||void 0);t&&(s.project.setMetadata(s.project.name,t),G.playStitch())}webDownload(e){const t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=`${s.project.name.toLowerCase().replace(/\s+/g,"-")}.rupa`,a.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),s.project.setMetadata(s.project.name,e.filePath),G.playStitch())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const i=t.target.files?.[0];if(i){const a=new FileReader;a.onload=r=>this.deserialize(r.target?.result),a.readAsText(i)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),s.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}deserialize(e){try{const t=JSON.parse(e);if(s.paletteState.swatches=t.palette,s.project.name=t.metadata.name,t.folio)s.project.frames=t.folio.frames.map(i=>{const a=new qe(i.name,i.width,i.height);return a.veils=i.veils.map(r=>{const n=new $e(r.name,i.width,i.height);return n.isVisible=r.isVisible,n.isLocked=r.isLocked,n.stitches=r.stitches,n}),a});else if(t.pixelData){const i=new qe("Restored Motif",t.dimensions.width,t.dimensions.height);i.veils[0].stitches=t.pixelData,s.project.frames=[i]}s.project.activeFrameIndex=0,$.clear()}catch(t){console.error("Failed to restore pattern book:",t)}}}class ss{addFrame(e){const t=s.project,i=t.activeFrameIndex,a=t.addFrame(e),r=t.activeFrameIndex;return $.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(r,1),t.activeFrameIndex=i},redo:()=>{t.frames.splice(r,0,a),t.activeFrameIndex=r}}),G.playStitch(),a}removeFrame(e){const t=s.project;if(t.frames.length<=1)return;const i=t.frames[e],a=t.activeFrameIndex;t.removeFrame(e);const r=t.activeFrameIndex;$.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,i),t.activeFrameIndex=a},redo:()=>{t.removeFrame(e),t.activeFrameIndex=r}}),G.playUnstitch()}duplicateFrame(e){const t=s.project,i=t.frames[e],a=t.activeFrameIndex,r=t.addFrame(`${i.name} (Copy)`),n=t.activeFrameIndex;r.width=i.width,r.height=i.height,r.duration=i.duration,r.veils=i.veils.map(l=>l.clone(i.width,i.height)),$.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(n,1),t.activeFrameIndex=a},redo:()=>{t.frames.splice(n,0,r),t.activeFrameIndex=n}}),G.playStitch()}nextFrame(){const e=s.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,$.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),G.playMove()}prevFrame(){const e=s.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,$.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),G.playMove()}addVeil(e){const t=s.project.activeFrame,i=t.activeVeilIndex,a=t.addVeil(e),r=t.activeVeilIndex;return $.push({isStructural:!0,label:"Add Veil",undo:()=>{t.veils.splice(r,1),t.activeVeilIndex=i},redo:()=>{t.veils.splice(r,0,a),t.activeVeilIndex=r}}),G.playStitch(),a}removeVeil(e){const t=s.project.activeFrame;if(t.veils.length<=1)return;const i=t.veils[e],a=t.activeVeilIndex;t.removeVeil(e);const r=t.activeVeilIndex;$.push({isStructural:!0,label:"Remove Veil",undo:()=>{t.veils.splice(e,0,i),t.activeVeilIndex=a},redo:()=>{t.removeVeil(e),t.activeVeilIndex=r}}),G.playUnstitch()}duplicateVeil(e){const t=s.project.activeFrame,i=t.veils[e],a=t.activeVeilIndex,r=i.clone(t.width,t.height);r.name=`${i.name} (Copy)`;const n=e+1;t.veils.splice(n,0,r),t.activeVeilIndex=n,$.push({isStructural:!0,label:"Duplicate Veil",undo:()=>{t.veils.splice(n,1),t.activeVeilIndex=a},redo:()=>{t.veils.splice(n,0,r),t.activeVeilIndex=n}}),G.playStitch()}nextVeil(){const e=s.project.activeFrame,t=e.activeVeilIndex;e.activeVeilIndex=(e.activeVeilIndex+1)%e.veils.length,$.push({isStructural:!0,label:"Next Veil",undo:()=>e.activeVeilIndex=t,redo:()=>e.activeVeilIndex=(t+1)%e.veils.length}),G.playMove()}prevVeil(){const e=s.project.activeFrame,t=e.activeVeilIndex;e.activeVeilIndex=(e.activeVeilIndex-1+e.veils.length)%e.veils.length,$.push({isStructural:!0,label:"Prev Veil",undo:()=>e.activeVeilIndex=t,redo:()=>e.activeVeilIndex=(t-1+e.veils.length)%e.veils.length}),G.playMove()}toggleLock(e){const t=e!==void 0?s.project.activeFrame.veils[e]:s.project.activeFrame.activeVeil;if(t){const i=t.isLocked;t.isLocked=!t.isLocked,$.push({isStructural:!0,label:"Toggle Veil Lock",undo:()=>t.isLocked=i,redo:()=>t.isLocked=!i}),G.playStitch()}}toggleVisibility(e){const t=e!==void 0?s.project.activeFrame.veils[e]:s.project.activeFrame.activeVeil;if(t){const i=t.isVisible;t.isVisible=!t.isVisible,$.push({isStructural:!0,label:"Toggle Veil Visibility",undo:()=>t.isVisible=i,redo:()=>t.isVisible=!i}),G.playStitch()}}reorderVeil(e,t){const i=s.project.activeFrame;if(e===t||t<0||t>=i.veils.length)return;const a=i.activeVeilIndex;((l,c)=>{const[u]=i.veils.splice(l,1);i.veils.splice(c,0,u),i.activeVeilIndex===l?i.activeVeilIndex=c:l<i.activeVeilIndex&&c>=i.activeVeilIndex?i.activeVeilIndex--:l>i.activeVeilIndex&&c<=i.activeVeilIndex&&i.activeVeilIndex++})(e,t);const n=i.activeVeilIndex;$.push({isStructural:!0,label:"Reorder Veil",undo:()=>{i.veils.findIndex((c,u)=>u===t);const[l]=i.veils.splice(t,1);i.veils.splice(e,0,l),i.activeVeilIndex=a},redo:()=>{const[l]=i.veils.splice(e,1);i.veils.splice(t,0,l),i.activeVeilIndex=n}}),G.playMove()}reorderFrame(e,t){const i=s.project;if(e===t||t<0||t>=i.frames.length)return;const a=i.activeFrameIndex;((l,c)=>{const[u]=i.frames.splice(l,1);i.frames.splice(c,0,u),i.activeFrameIndex===l?i.activeFrameIndex=c:l<i.activeFrameIndex&&c>=i.activeFrameIndex?i.activeFrameIndex--:l>i.activeFrameIndex&&c<=i.activeFrameIndex&&i.activeFrameIndex++})(e,t);const n=i.activeFrameIndex;$.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[l]=i.frames.splice(t,1);i.frames.splice(e,0,l),i.activeFrameIndex=a},redo:()=>{const[l]=i.frames.splice(e,1);i.frames.splice(t,0,l),i.activeFrameIndex=n}}),G.playMove()}moveVeilUp(){const e=s.project.activeFrame,t=e.activeVeilIndex;t<e.veils.length-1&&this.reorderVeil(t,t+1)}moveVeilDown(){const t=s.project.activeFrame.activeVeilIndex;t>0&&this.reorderVeil(t,t-1)}}class as{begin(e,t){s.selection.begin(e,t)}update(e,t){s.selection.isActive&&s.selection.update(e,t)}clear(){s.selection.clear()}commit(){const e=s.selection.getPoints(s.linen.width);if(e.length===0)return;const t=s.paletteState.activeDye,i=s.linen.width;$.beginBatch();let a=!1;e.forEach(r=>{const n=r.y*i+r.x,l=s.linen.stitches[n];l!==t&&($.push({index:n,oldColor:l,newColor:t}),s.linen.stitches[n]=t,a=!0)}),$.endBatch(),a&&G.playStitch()}spiritPick(){const{x:e,y:t}=s.needle.pos,i=s.linen.getColor(e,t),a=s.linen.width,r=s.linen.height,n=[[e,t]],l=new Set;for(s.selection.clear();n.length>0;){const[c,u]=n.shift(),f=u*a+c,x=`${c},${u}`;if(!l.has(x)&&(l.add(x),s.linen.getColor(c,u)===i)){s.selection.indices.push(f);const g=[[c+1,u],[c-1,u],[c,u+1],[c,u-1]];for(const[A,C]of g)A>=0&&A<a&&C>=0&&C<r&&n.push([A,C])}}s.selection.indices.length>0&&G.playScale(4)}addVertex(e,t){s.selection.vertices.push({x:e,y:t}),G.playStitch()}sealBinding(){const e=s.selection.vertices;if(e.length<3)return;const t=s.linen.width,i=s.linen.height,a=[];for(let r=0;r<i;r++)for(let n=0;n<t;n++)this.isPointInPoly(n,r,e)&&a.push(r*t+n);a.length>0&&(s.selection.indices=a,s.selection.vertices=[],G.playScale(6))}isPointInPoly(e,t,i){let a=!1;for(let r=0,n=i.length-1;r<i.length;n=r++){const l=i[r].x,c=i[r].y,u=i[n].x,f=i[n].y;c>t!=f>t&&e<(u-l)*(t-c)/(f-c)+l&&(a=!a)}return a}}class Ze{static spin(e){const{h:t,s:i,l:a,a:r}=e,n=t/360,l=i/100,c=a/100;let u,f,x;if(l===0)u=f=x=c;else{const w=c<.5?c*(1+l):c+l-c*l,b=2*c-w,m=E=>(E<0&&(E+=1),E>1&&(E-=1),E<1/6?b+(w-b)*6*E:E<1/2?w:E<2/3?b+(w-b)*(2/3-E)*6:b);u=m(n+1/3),f=m(n),x=m(n-1/3)}const g=w=>Math.round(w*255).toString(16).padStart(2,"0"),A=Math.round(r*255).toString(16).padStart(2,"0"),C=`#${g(u)}${g(f)}${g(x)}`;return A==="ff"?C:C+A}static unravel(e){let t=0,i=0,a=0,r=1;const n=e.replace("#","");n.length===3||n.length===4?(t=parseInt(n[0]+n[0],16),i=parseInt(n[1]+n[1],16),a=parseInt(n[2]+n[2],16),n.length===4&&(r=parseInt(n[3]+n[3],16)/255)):(n.length===6||n.length===8)&&(t=parseInt(n.substring(0,2),16),i=parseInt(n.substring(2,4),16),a=parseInt(n.substring(4,6),16),n.length===8&&(r=parseInt(n.substring(6,8),16)/255)),t/=255,i/=255,a/=255;const l=Math.max(t,i,a),c=Math.min(t,i,a);let u=0,f=0,x=(l+c)/2;if(l!==c){const g=l-c;switch(f=x>.5?g/(2-l-c):g/(l+c),l){case t:u=(i-a)/g+(i<a?6:0);break;case i:u=(a-t)/g+2;break;case a:u=(t-i)/g+4;break}u/=6}return{h:Math.round(u*360),s:Math.round(f*100),l:Math.round(x*100),a:parseFloat(r.toFixed(2))}}static weather(e,t){const i=this.unravel(e);return i.l=Math.max(0,Math.min(100,i.l+t*100)),this.spin(i)}static pigment(e,t){const i=this.unravel(e);return i.s=Math.max(0,Math.min(100,i.s+t*100)),this.spin(i)}static strength(e,t){const i=this.unravel(e);return i.a=Math.max(0,Math.min(1,t)),this.spin(i)}static entwine(e,t,i=.5){this.unravel(e),this.unravel(t);const a=this.hexToRgb(e),r=this.hexToRgb(t),n={r:Math.round(a.r*(1-i)+r.r*i),g:Math.round(a.g*(1-i)+r.g*i),b:Math.round(a.b*(1-i)+r.b*i),a:a.a*(1-i)+r.a*i};return this.rgbToHex(n.r,n.g,n.b,n.a)}static hexToRgb(e){this.unravel(e);const t=e.replace("#","");let i=0,a=0,r=0,n=1;return(t.length===6||t.length===8)&&(i=parseInt(t.substring(0,2),16),a=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16),t.length===8&&(n=parseInt(t.substring(6,8),16)/255)),{r:i,g:a,b:r,a:n}}static rgbToHex(e,t,i,a){const r=c=>Math.round(c).toString(16).padStart(2,"0"),n=Math.round(a*255).toString(16).padStart(2,"0"),l=`#${r(e)}${r(t)}${r(i)}`;return n==="ff"?l:l+n}}class rs{select(e){s.paletteState.select(e),G.playScale(e)}setDye(e){s.paletteState.setDye(e),G.playStitch()}pickFromLinen(){const{x:e,y:t}=s.needle.pos,i=s.linen.getColor(e,t);i!==null&&(this.setDye(i),s.studio.isPicking=!0,setTimeout(()=>{s.studio.isPicking=!1},1500))}weatherPalette(e){s.paletteState.swatches=s.paletteState.swatches.map(t=>Ze.weather(t,e)),G.playStitch()}mixActiveDye(e,t=.5){const i=Ze.entwine(s.activeDye,e,t);this.setDye(i)}soak(){const{x:e,y:t}=s.needle.pos,i=s.linen.getColor(e,t),a=s.activeDye;if(i===a)return;const r=s.linen.width,n=s.linen.height,l=[[e,t]],c=new Set,u=[],f=s.selection.isActive,x=s.selection.indices;for(;l.length>0;){const[g,A]=l.shift(),C=A*r+g,w=`${g},${A}`;if(c.has(w))continue;c.add(w);const b=s.linen.getColor(g,A)===i,m=!f||x.includes(C);if(b&&m){u.push({index:C,oldColor:i,newColor:a}),s.linen.stitches[C]=a;const E=[[g+1,A],[g-1,A],[g,A+1],[g,A-1]];for(const[I,S]of E)I>=0&&I<r&&S>=0&&S<n&&l.push([I,S])}}u.length>0&&($.beginBatch(),u.forEach(g=>$.push(g)),$.endBatch(),G.playStitch())}}class ns{movement=new Zi;stitching=new Ji;manipulation=new es;clipboard=new ts;persistence=new is;folio=new ss;selection=new as;dye=new rs;moveNeedle(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}stitch(){this.stitching.stitch()}unstitch(){this.stitching.unstitch()}pickDye(){this.dye.pickFromLinen()}startSelection(){this.selection.begin(s.needle.pos.x,s.needle.pos.y)}updateSelection(){this.selection.update(s.needle.pos.x,s.needle.pos.y)}commitSelection(){this.selection.commit()}clearLinen(){this.manipulation.clearAll()}resizeLinen(e,t){this.manipulation.resize(e,t)}flipLinen(e){this.manipulation.flip(e)}rotateLinen(){this.manipulation.rotate()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),s.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async createArtifact(e,t=10,i="transparent"){const{ExportEngine:a}=await yi(async()=>{const{ExportEngine:f}=await import("../chunks/-29G2bDl.js");return{ExportEngine:f}},[],import.meta.url),{width:r,height:n,compositeStitches:l}=s.linen,c=["webm","gif","mp4"].includes(e),u=s.project.frames.length<=1&&c?"png":e;if(u==="svg")if(s.project.frames.length>1){const f=s.project.frames.map(A=>A.compositeStitches),x=a.toAnimatedSVG(r,n,f,s.studio.fps,i),g=new Blob([x],{type:"image/svg+xml"});this.download(URL.createObjectURL(g),`${s.project.name}-kinetic.svg`)}else{const f=a.toSVG(r,n,l,i),x=new Blob([f],{type:"image/svg+xml"});this.download(URL.createObjectURL(x),`${s.project.name}.svg`)}else if(u==="webm"||u==="mp4"){const f=s.project.frames.map(g=>g.compositeStitches),x=await a.toWebM(r,n,f,t,s.studio.fps,i);this.download(URL.createObjectURL(x),`${s.project.name}.${u}`)}else if(u==="gif"){const f=await a.toRaster(r,n,l,t,"png",i);this.download(f,`${s.project.name}.gif`)}else{const f=await a.toRaster(r,n,l,t,u,i);this.download(f,`${s.project.name}.${u}`)}s.studio.showArtifactCrate=!1}download(e,t){const i=document.createElement("a");i.href=e,i.download=t.toLowerCase().replace(/\s+/g,"-"),i.click()}}const k=new ns;class os{version="0.5.0";project=new Wi;linen=new $i(this.project);needle=new Hi;paletteState=new Ki;studio=new zi;selection=new Qi;get stitches(){return this.linen.stitches}set stitches(e){this.linen.stitches=e}get linenWidth(){return this.linen.width}set linenWidth(e){this.linen.width=e}get linenHeight(){return this.linen.height}set linenHeight(e){this.linen.height=e}get needlePos(){return this.needle.pos}set needlePos(e){this.needle.pos=e}get activeDye(){return this.paletteState.activeDye}set activeDye(e){this.paletteState.activeDye=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get zoomLevel(){return this.studio.zoomLevel}set zoomLevel(e){this.studio.zoomLevel=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get isAmbientPlaying(){return this.studio.isAmbientPlaying}set isAmbientPlaying(e){this.studio.isAmbientPlaying=e}get isKineticMode(){return this.studio.isKineticMode}set isKineticMode(e){this.studio.isKineticMode=e}get showGhostThreads(){return this.studio.showGhostThreads}set showGhostThreads(e){this.studio.showGhostThreads=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get usageMinutes(){return this.studio.usageMinutes}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isNeedleVisible(){return this.needle.isVisible}set isNeedleVisible(e){this.needle.isVisible=e}get projectName(){return this.project.name}set projectName(e){this.project.name=e}get currentFilePath(){return this.project.currentFilePath}set currentFilePath(e){this.project.currentFilePath=e}get lastSaved(){return this.project.lastSaved}set lastSaved(e){this.project.lastSaved=e}get clipboard(){return this.project.clipboard}set clipboard(e){this.project.clipboard=e}get showDyeBasin(){return this.studio.showDyeBasin}set showDyeBasin(e){this.studio.showDyeBasin=e}get showAudioBasin(){return this.studio.showAudioBasin}set showAudioBasin(e){this.studio.showAudioBasin=e}get showPatternCatalog(){return this.studio.showPatternCatalog}set showPatternCatalog(e){this.studio.showPatternCatalog=e}get showArtisanGuide(){return this.studio.showArtisanGuide}set showArtisanGuide(e){this.studio.showArtisanGuide=e}get showArtisanCodex(){return this.studio.showArtisanCodex}set showArtisanCodex(e){this.studio.showArtisanCodex=e}get showArtifactCrate(){return this.studio.showArtifactCrate}set showArtifactCrate(e){this.studio.showArtifactCrate=e}get showLinenSettings(){return this.studio.showLinenSettings}set showLinenSettings(e){this.studio.showLinenSettings=e}get showArchivePattern(){return this.studio.showArchivePattern}set showArchivePattern(e){this.studio.showArchivePattern=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get exportScale(){return this.studio.exportScale}set exportScale(e){this.studio.exportScale=e}get exportBgColor(){return this.studio.exportBgColor}set exportBgColor(e){this.studio.exportBgColor=e}get selectionStart(){return this.selection.start}set selectionStart(e){this.selection.start=e}get selectionEnd(){return this.selection.end}set selectionEnd(e){this.selection.end=e}#e=Q(()=>{const e=new Set;return this.linen.compositeStitches.forEach(t=>{t!==null&&e.add(t)}),Array.from(e)});get usedColors(){return d(this.#e)}set usedColors(e){y(this.#e,e)}#t=Q(()=>{const e=(t,i)=>{const a=Math.floor(i/2);return i%2===0?t<a?t-a:t-a+1:t-a};return{x:e(this.needle.pos.x,this.linen.width),y:-e(this.needle.pos.y,this.linen.height)}});get displayCoords(){return d(this.#t)}set displayCoords(e){y(this.#t,e)}#i=Q(()=>{const e=this.studio.zoomLevel*.5;if(this.studio.zoomLevel<=1)return`translate(-50%, -50%) scale(${e})`;const t=(this.needle.pos.x+.5)/this.linen.width*100,i=(this.needle.pos.y+.5)/this.linen.height*100;return`translate(-${t}%, -${i}%) scale(${e})`});get cameraTransform(){return d(this.#i)}set cameraTransform(e){y(this.#i,e)}resetInactivityTimer(){this.needle.resetInactivityTimer()}toggleMute(){this.studio.toggleMute()}setZoom(e){this.studio.setZoom(e)}resetZoom(){this.studio.resetZoom()}selectPalette(e){this.paletteState.select(e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}handleEscape(){return this.studio.handleEscape()}undo(){const e=$.undo();if(e)if("isStructural"in e)e.undo(),G.playUnstitch();else if(Array.isArray(e)){for(let t=e.length-1;t>=0;t--){const i=e[t];this.linen.stitches[i.index]=i.oldColor}G.playUnstitch()}else this.linen.stitches[e.index]=e.oldColor,G.playUnstitch();this.needle.resetInactivityTimer()}redo(){const e=$.redo();if(e)if("isStructural"in e)e.redo(),G.playStitch();else if(Array.isArray(e)){for(const t of e)this.linen.stitches[t.index]=t.newColor;G.playStitch()}else this.linen.stitches[e.index]=e.newColor,G.playStitch();this.needle.resetInactivityTimer()}clearLinen(){k.clearLinen()}pickDye(){k.pickDye()}loadProject(){k.load()}copySelection(){k.copy()}cutSelection(){k.cut()}pasteSelection(){k.paste()}flipLinen(e){k.flipLinen(e)}rotateLinen(){k.rotateLinen()}}const s=new os,ls={UP:["ArrowUp"],DOWN:["ArrowDown"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"],GOTO:["g"]},cs={STITCH:["Space","Enter"],UNSTITCH:["Backspace","Delete"],UNSTITCH_MOD:["Ctrl+Space"],EYEDROPPER:["i","Alt+Space"],SOAK:["f"],BIND_VERTEX:["Shift+Enter"],SEAL_BINDING:["Enter"]},ds={UNDO:["Ctrl+z"],REDO:["Ctrl+Shift+z","Ctrl+y"]},us={COPY:["Ctrl+c"],CUT:["Ctrl+x"],PASTE:["Ctrl+v"],BLEACH:["Alt+r"],FLIP_H:["h"],FLIP_V:["v"],ROTATE:["r"]},vs={ZOOM_IN:["+","="],ZOOM_OUT:["-"],RESET_ZOOM:["Ctrl+0"]},ps={COMMAND_PALETTE:["Ctrl+k"],EXPORT:["Ctrl+e"],SAVE:["Ctrl+s"],OPEN:["Ctrl+o"],SETTINGS:["Ctrl+,"],COLOR_PICKER:["Ctrl+p"],AUDIO_SETTINGS:["Ctrl+Shift+a"],USER_GUIDE:["F1"],QUICK_GUIDE:["F2"],PLAY_PULSE:["p"],TOGGLE_GHOST_THREADS:["Alt+g"],CLEAR_LINEN:["Ctrl+l"],TOGGLE_MUTE:["Ctrl+m"],ESCAPE:["Escape"]},hs={SELECT_1:["1"],SELECT_2:["2"],SELECT_3:["3"],SELECT_4:["4"],SELECT_5:["5"],SELECT_6:["6"],SELECT_7:["7"],SELECT_8:["8"],SELECT_9:["9"],SELECT_0:["0"]},fs={NEW_FRAME:["Alt+n"],DUPLICATE_FRAME:["Ctrl+d"],NEXT_FRAME:["Alt+PageDown","Tab"],PREV_FRAME:["Alt+PageUp","Shift+Tab"],DELETE_FRAME:["Alt+d"],TAB_FRAMES:["Alt+1"],TAB_VEILS:["Alt+2"]},gs={NEW_VEIL:["Alt+Shift+n"],DUPLICATE_VEIL:["Ctrl+d"],NEXT_VEIL:["Alt+ArrowDown"],PREV_VEIL:["Alt+ArrowUp"],TOGGLE_VEIL_LOCK:["Alt+l"],TOGGLE_VEIL_VISIBILITY:["Alt+h"],MERGE_VEILS:["Alt+m"],MOVE_VEIL_UP:["["],MOVE_VEIL_DOWN:["]"],DELETE_VEIL:["Alt+d"]},xs={FLOW_STITCH:["Control"],FLOW_UNSTITCH:["Ctrl+Shift"],FLOW_SELECT:["Shift"],SPIRIT_PICK:["w"]},bs={OS_CLOSE_WINDOW:["Ctrl+w"],OS_QUIT:["Ctrl+q","Alt+f4"],OS_NEW_WINDOW:["Ctrl+n"],OS_RELOAD:["Ctrl+r","F5"],OS_DEV_TOOLS:["Ctrl+Shift+i","F12"],OS_FIND:["Ctrl+f"],OS_PRINT:["Ctrl+p","Ctrl+Shift+p"],OS_FULLSCREEN:["F11"]},ms={navigation:ls,canvas:cs,history:ds,manipulation:us,view:vs,studio:ps,palette:hs,folio:fs,veils:gs,modifiers:xs,reserved_do_not_use:bs};class As{buffer=[];timeout=null;#e=L(pe([]));get currentSequence(){return d(this.#e)}set currentSequence(e){y(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const i=this.buffer.join(","),a={"g,c":"GOTO","f,n":"NEW_FRAME","v,n":"NEW_VEIL","v,l":"TOGGLE_VEIL_LOCK","v,h":"TOGGLE_VEIL_VISIBILITY","v,m":"MERGE_VEILS"};if(a[i]){const r=a[i];return this.reset(),r}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const dt=new As;class ys{patterns=[];#e=L(pe([]));get activeKeys(){return d(this.#e)}set activeKeys(e){y(this.#e,e,!0)}#t=L(!1);get isCtrlActive(){return d(this.#t)}set isCtrlActive(e){y(this.#t,e,!0)}#i=L(!1);get isShiftActive(){return d(this.#i)}set isShiftActive(e){y(this.#i,e,!0)}#s=L(!1);get isAltActive(){return d(this.#s)}set isAltActive(e){y(this.#s,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){const e={UP:"MOVE_UP",DOWN:"MOVE_DOWN",LEFT:"MOVE_LEFT",RIGHT:"MOVE_RIGHT",GOTO:"GOTO",STITCH:"STITCH",UNSTITCH:"UNSTITCH",SOAK:"SOAK",BIND_VERTEX:"BIND_VERTEX",SEAL_BINDING:"SEAL_BINDING",EYEDROPPER:"PICK_DYE",SAVE:"OPEN_ARCHIVE",OPEN:"OPEN",SETTINGS:"OPEN_SETTINGS",FLOW_STITCH:"FLOW_STITCH",FLOW_UNSTITCH:"FLOW_UNSTITCH",FLOW_SELECT:"FLOW_SELECT",SPIRIT_PICK:"SPIRIT_PICK",UNDO:"UNDO",REDO:"REDO",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",COMMAND_PALETTE:"OPEN_PALETTE",COLOR_PICKER:"OPEN_DYES",AUDIO_SETTINGS:"OPEN_AUDIO",USER_GUIDE:"OPEN_CODEX",QUICK_GUIDE:"OPEN_HELP",PLAY_PULSE:"PLAY_PULSE",TOGGLE_GHOST_THREADS:"TOGGLE_GHOST_THREADS",EXPORT:"OPEN_EXPORT",CLEAR_LINEN:"CLEAR_LINEN",TOGGLE_MUTE:"TOGGLE_MUTE",ESCAPE:"ESCAPE",COPY:"COPY",CUT:"CUT",PASTE:"PASTE",BLEACH:"BLEACH",FLIP_H:"FLIP_H",FLIP_V:"FLIP_V",ROTATE:"ROTATE",NEW_FRAME:"NEW_FRAME",DUPLICATE_FRAME:"DUPLICATE_FRAME",NEXT_FRAME:"NEXT_FRAME",PREV_FRAME:"PREV_FRAME",DELETE_FRAME:"DELETE_FRAME",TAB_FRAMES:"TAB_FRAMES",TAB_VEILS:"TAB_VEILS",NEW_VEIL:"NEW_VEIL",DUPLICATE_VEIL:"DUPLICATE_VEIL",NEXT_VEIL:"NEXT_VEIL",PREV_VEIL:"PREV_VEIL",TOGGLE_VEIL_LOCK:"TOGGLE_VEIL_LOCK",TOGGLE_VEIL_VISIBILITY:"TOGGLE_VEIL_VISIBILITY",MOVE_VEIL_UP:"MOVE_VEIL_UP",MOVE_VEIL_DOWN:"MOVE_VEIL_DOWN",MERGE_VEILS:"MERGE_VEILS",DELETE_VEIL:"DELETE_VEIL",SELECT_1:"SELECT_DYE_1",SELECT_2:"SELECT_DYE_2",SELECT_3:"SELECT_DYE_3",SELECT_4:"SELECT_DYE_4",SELECT_5:"SELECT_DYE_5",SELECT_6:"SELECT_DYE_6",SELECT_7:"SELECT_DYE_7",SELECT_8:"SELECT_DYE_8",SELECT_9:"SELECT_DYE_9",SELECT_0:"SELECT_DYE_0"};Object.values(ms).forEach(t=>{Object.entries(t).forEach(([i,a])=>{const r=e[i];r&&a.forEach(n=>{const l=n.toLowerCase().split("+");let c=l[l.length-1].trim();c==="space"&&(c=" "),(c==="ctrl"||c==="control")&&(c="control"),this.patterns.push({intent:r,key:c,ctrl:l.includes("ctrl")||l.includes("control"),shift:l.includes("shift"),alt:l.includes("alt")})})})}),this.patterns.sort((t,i)=>{const a=r=>(r.ctrl?1:0)+(r.shift?1:0)+(r.alt?1:0);return a(i)-a(t)})}updatePhysicalState(e,t){const i=e.key.toLowerCase();t==="down"?this.activeKeys.includes(i)||this.activeKeys.push(i):(this.activeKeys=this.activeKeys.filter(a=>a!==i),i==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(a=>a!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(a=>a!=="control"&&a!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(a=>a!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(a=>a!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const i=dt.process(t);if(i)return i}else dt.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const i of this.patterns)if(t===i.key&&this.isCtrlActive===i.ctrl&&this.isShiftActive===i.shift&&this.isAltActive===i.alt)return i.intent;return null}getLabel(e){const t=this.patterns.find(a=>a.intent===e);if(!t)return"";let i="";return t.ctrl&&(i+="Ctrl+"),t.shift&&(i+="Shift+"),t.alt&&(i+="Alt+"),i+=t.key===" "?"Space":t.key.toUpperCase(),i}}const U=new ys;class _s{#e=Q(()=>dt.isActive?{type:"ORGANIZING",label:"Weaving...",icon:"ð",color:"var(--color-brand)",isPulse:!0}:s.isPicking?{type:"PICKING",label:"Picking Dye",icon:"ð",color:"var(--color-brand)",isPulse:!0}:U.isCtrlActive&&U.isShiftActive?{type:"UNRAVELLING",label:"Unravelling",icon:"ð§¶",color:"var(--color-brand)",isPulse:!0}:U.isShiftActive?{type:"LOOMING",label:"Block Looming",icon:"â¨",color:"var(--color-brand)",isPulse:!0}:U.isCtrlActive?{type:"THREADING",label:"Threading",icon:"ð§µ",color:"var(--color-studio-teal)",isPulse:!0}:{type:"RESTING",label:"Studio Ready",icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return d(this.#e)}set current(e){y(this.#e,e)}}const xe=new _s;class ws{isPlaying=!1;nextNoteTime=0;timer=null;get ctx(){return ht.ctx}scale=[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25];chords=[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]];currentChordIndex=0;toggle(){this.isPlaying?this.stop():this.start()}start(){this.isPlaying||(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||s.studio.isMuted||!s.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){const t=this.chords[this.currentChordIndex],a=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(a,e),this.pianoPluck(a*2,e,.02),Math.random()>.7&&this.pianoPluck(a*.5,e+.05,.03)}pianoPluck(e,t,i=.06){const a=s.usageMinutes;let r=0;a>=30&&a<60?r=(a-30)/30:a>=60&&(r=1);const n=i*r*s.bgmVolume;if(n<.001)return;const l=this.ctx.createOscillator(),c=this.ctx.createGain(),u=this.ctx.createBiquadFilter();l.type=Math.random()>.5?"sine":"triangle",l.frequency.setValueAtTime(e,t),u.type="lowpass",u.frequency.setValueAtTime(1200,t),u.frequency.exponentialRampToValueAtTime(400,t+1.5),c.gain.setValueAtTime(0,t),c.gain.linearRampToValueAtTime(n,t+.02),c.gain.exponentialRampToValueAtTime(1e-4,t+2.5),l.connect(u),u.connect(c),c.connect(this.ctx.destination),l.start(t),l.stop(t+2.6)}}const Es=new ws;class Ss{timer=null;toggle(){s.project.isPlaying?this.stop():this.play()}play(){s.project.isPlaying||(s.project.isPlaying=!0,this.scheduleNextFrame(),G.playStitch())}stop(){s.project.isPlaying=!1,this.timer&&clearTimeout(this.timer)}scheduleNextFrame(){if(!s.project.isPlaying)return;const e=s.project.activeFrame;this.timer=setTimeout(()=>{s.project.activeFrameIndex=(s.project.activeFrameIndex+1)%s.project.frames.length,this.scheduleNextFrame()},e.duration)}}const ft=new Ss;class Is{backupInterval=null;mount(){this.backupInterval=setInterval(()=>k.persistence.backup(),600*1e3),Es.start();const e=i=>this.handleInput(i,"down"),t=i=>this.handleInput(i,"up");return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t),clearInterval(this.backupInterval)}}handleInput(e,t){if(!s.studio.isAppReady)return;ht.resume(),U.updatePhysicalState(e,t);const i=e.target;if(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i.isContentEditable){t==="down"&&e.key==="Escape"&&s.handleEscape();return}if(s.needle.resetInactivityTimer(),t==="down"){const a=U.getIntent(e);console.log("Loom Intent:",a,"Key:",e.key,"Shift:",e.shiftKey),a&&this.executeIntent(a,e)}}executeIntent(e,t){switch(e.startsWith("MOVE_")||t.preventDefault(),e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"GOTO":return s.studio.showGoTo=!0;case"STITCH":return s.selection.isActive?k.commitSelection():k.stitching.stitch();case"UNSTITCH":return k.stitching.unstitch();case"SOAK":return k.dye.soak();case"BIND_VERTEX":return k.selection.addVertex(s.needle.pos.x,s.needle.pos.y);case"SEAL_BINDING":return s.selection.vertices.length>=3?k.selection.sealBinding():s.selection.isActive?k.commitSelection():k.stitching.stitch();case"PICK_DYE":return k.stitching.pickDye();case"COPY":return k.clipboard.copy();case"CUT":return k.clipboard.cut();case"PASTE":return k.clipboard.paste();case"BLEACH":return k.manipulation.bleach();case"UNDO":return s.undo();case"REDO":return s.redo();case"SAVE":return k.persistence.save();case"OPEN":return k.persistence.load();case"OPEN_ARCHIVE":return s.studio.showArchivePattern=!0;case"OPEN_SETTINGS":return s.studio.showLinenSettings=!0;case"ESCAPE":if(s.selection.isActive){s.selection.clear();return}return s.handleEscape();case"OPEN_PALETTE":return s.studio.showPatternCatalog=!s.studio.showPatternCatalog;case"OPEN_DYES":return s.studio.showDyeBasin=!s.studio.showDyeBasin;case"OPEN_AUDIO":return s.studio.showAudioBasin=!s.studio.showAudioBasin;case"OPEN_EXPORT":return s.studio.showArtifactCrate=!0;case"OPEN_HELP":return s.studio.showArtisanGuide=!0;case"OPEN_CODEX":return s.studio.showArtisanCodex=!0;case"PLAY_PULSE":return ft.toggle();case"TOGGLE_GHOST_THREADS":return s.studio.showGhostThreads=!s.studio.showGhostThreads;case"ZOOM_IN":return s.studio.setZoom(.1);case"ZOOM_OUT":return s.studio.setZoom(-.1);case"RESET_ZOOM":return s.studio.resetZoom();case"CLEAR_LINEN":return k.manipulation.clearAll();case"TOGGLE_MUTE":return s.studio.toggleMute();case"SPIRIT_PICK":return k.selection.spiritPick();case"FLIP_H":return k.manipulation.flip("horizontal");case"FLIP_V":return k.manipulation.flip("vertical");case"ROTATE":return k.manipulation.rotate();case"NEW_FRAME":return k.folio.addFrame();case"DUPLICATE_FRAME":return k.folio.duplicateFrame(s.project.activeFrameIndex);case"NEXT_FRAME":return k.folio.nextFrame();case"PREV_FRAME":return k.folio.prevFrame();case"DELETE_FRAME":return k.folio.removeFrame(s.project.activeFrameIndex);case"TAB_FRAMES":return s.studio.folioActiveTab="frames";case"TAB_VEILS":return s.studio.folioActiveTab="veils";case"NEW_VEIL":return k.folio.addVeil();case"DUPLICATE_VEIL":return k.folio.duplicateVeil(s.project.activeFrame.activeVeilIndex);case"NEXT_VEIL":return k.folio.nextVeil();case"PREV_VEIL":return k.folio.prevVeil();case"DELETE_VEIL":return k.folio.removeVeil(s.project.activeFrame.activeVeilIndex);case"TOGGLE_VEIL_LOCK":return k.folio.toggleLock();case"TOGGLE_VEIL_VISIBILITY":return k.folio.toggleVisibility();case"MOVE_VEIL_UP":return k.folio.moveVeilUp();case"MOVE_VEIL_DOWN":return k.folio.moveVeilDown();case"SWITCH_FOCUS":return;default:if(e.startsWith("SELECT_DYE_")){const a=parseInt(e.split("_")[2]);return k.dye.select(a===0?9:a-1)}}}executeMove(e,t){if(k.movement.move(e,t)){const i=xe.current.type;i==="LOOMING"&&(s.selection.isActive||k.startSelection(),k.updateSelection()),i==="THREADING"&&k.stitching.stitch(),i==="UNRAVELLING"&&k.stitching.unstitch()}}}const Cs=new Is;var Ts=T(`<div class="flex flex-col"><span class="font-tiny5 text-2xl leading-none text-brand">Rupa</span> <span class="font-serif text-[7px] font-bold tracking-[0.2em] uppercase opacity-40">The Weaver's Studio</span></div>`);function ks(o){var e=Ts();_(o,e)}var me=Je(()=>s),Ls=T('<div class="flex items-center gap-3"><button class="artisan-tool-btn !py-1.5"><span>ð</span> Catalog</button> <button class="artisan-tool-btn !py-1.5"><span>ð§º</span> Export</button> <button class="artisan-tool-btn !py-1.5"><span>ð¿</span> Clear</button> <button class="artisan-tool-btn !py-1.5"><span> </span> Audio</button> <div class="mx-1 h-6 w-px bg-grid-border"></div> <button class="artisan-tool-btn !py-1.5"><span>ð</span> Codex</button> <button class="artisan-tool-btn !py-1.5"><span>â¨ï¸</span> Keys</button></div>');function Ps(o,e){H(e,!1),ce();var t=Ls(),i=p(t);i.__click=()=>me(me().studio.showPatternCatalog=!0);var a=h(i,2);a.__click=()=>me(me().studio.showArtifactCrate=!0);var r=h(a,2);r.__click=()=>me().clearLinen();var n=h(r,2);n.__click=()=>me(me().showAudioBasin=!0);var l=p(n),c=p(l,!0);v(l),Ce(),v(n);var u=h(n,4);u.__click=()=>me(me().showArtisanCodex=!0);var f=h(u,2);f.__click=()=>me(me().showArtisanGuide=!0),v(t),F(()=>B(c,me().isMuted?"ð":"ð")),_(o,t),K()}le(["click"]);const Vs=o=>o;function gt(o){const e=o-1;return e*e*e+1}function It(o){const e=typeof o=="string"&&o.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[o,"px"]}function _e(o,{delay:e=0,duration:t=400,easing:i=Vs}={}){const a=+getComputedStyle(o).opacity;return{delay:e,duration:t,easing:i,css:r=>`opacity: ${r*a}`}}function Fs(o,{delay:e=0,duration:t=400,easing:i=gt,x:a=0,y:r=0,opacity:n=0}={}){const l=getComputedStyle(o),c=+l.opacity,u=l.transform==="none"?"":l.transform,f=c*(1-n),[x,g]=It(a),[A,C]=It(r);return{delay:e,duration:t,easing:i,css:(w,b)=>`
			transform: ${u} translate(${(1-w)*x}${g}, ${(1-w)*A}${C});
			opacity: ${c-f*b}`}}function Ms(o,{delay:e=0,duration:t=400,easing:i=gt,axis:a="y"}={}){const r=getComputedStyle(o),n=+r.opacity,l=a==="y"?"height":"width",c=parseFloat(r[l]),u=a==="y"?["top","bottom"]:["left","right"],f=u.map(m=>`${m[0].toUpperCase()}${m.slice(1)}`),x=parseFloat(r[`padding${f[0]}`]),g=parseFloat(r[`padding${f[1]}`]),A=parseFloat(r[`margin${f[0]}`]),C=parseFloat(r[`margin${f[1]}`]),w=parseFloat(r[`border${f[0]}Width`]),b=parseFloat(r[`border${f[1]}Width`]);return{delay:e,duration:t,easing:i,css:m=>`overflow: hidden;opacity: ${Math.min(m*20,1)*n};${l}: ${m*c}px;padding-${u[0]}: ${m*x}px;padding-${u[1]}: ${m*g}px;margin-${u[0]}: ${m*A}px;margin-${u[1]}: ${m*C}px;border-${u[0]}-width: ${m*w}px;border-${u[1]}-width: ${m*b}px;min-${l}: 0`}}function He(o,{delay:e=0,duration:t=400,easing:i=gt,start:a=0,opacity:r=0}={}){const n=getComputedStyle(o),l=+n.opacity,c=n.transform==="none"?"":n.transform,u=1-a,f=l*(1-r);return{delay:e,duration:t,easing:i,css:(x,g)=>`
			transform: ${c} scale(${1-u*g});
			opacity: ${l-f*g}
		`}}var Os=T('<span class="font-mono text-[8px] font-bold tracking-widest uppercase opacity-30"> </span>'),Ds=T('<div class="flex flex-col items-end px-4"><h2 class="font-serif text-sm font-bold tracking-[0.1em] uppercase opacity-60"> </h2> <!></div>');function Ns(o,e){H(e,!1),ce();var t=Ds(),i=p(t),a=p(i,!0);v(i);var r=h(i,2);{var n=l=>{var c=Os(),u=p(c);v(c),F(f=>B(u,`Archived ${f??""}`),[()=>s.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),ne(3,c,()=>_e),_(l,c)};R(r,l=>{s.project.lastSaved&&l(n)})}v(t),F(()=>B(a,s.project.name)),_(o,t),K()}var Bs=T('<div class="hud-panel flex h-16 w-full items-center justify-between px-6 py-2"><div class="flex items-center gap-6"><!> <div class="h-8 w-[2px] bg-grid-border"></div> <!></div> <!></div>');function js(o){var e=Bs(),t=p(e),i=p(t);ks(i);var a=h(i,4);Ps(a,{}),v(t);var r=h(t,2);Ns(r,{}),v(e),_(o,e)}var Rs=T('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Delete Frame (Alt+D)">ðï¸</button>'),Gs=T('<div class="h-1.5 w-1.5 rounded-xl bg-brand"></div>'),Us=T('<div role="button" tabindex="0" draggable="true"><div class="flex items-center gap-3 overflow-hidden"><span class="text-xs opacity-40"></span> <span class="truncate font-serif text-sm font-medium"> </span></div> <div class="flex items-center gap-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Duplicate Frame (Ctrl+D)">ð</button> <!> <!></div></div>'),$s=T('<div class="flex flex-col gap-1"></div>'),Hs=T('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Delete Veil (Alt+D)">ðï¸</button>'),Ks=T('<div class="h-1.5 w-1.5 rounded-xl bg-brand"></div>'),zs=T('<div role="button" tabindex="0" draggable="true"><div class="flex items-center gap-3 overflow-hidden"><button> </button> <span> </span></div> <div class="flex items-center gap-2"><button> </button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Duplicate Veil (Ctrl+D)">ð</button> <!> <!></div></div>'),Ws=T('<div class="flex flex-col gap-1"></div>'),Qs=T('<div class="flex w-full flex-col overflow-hidden rounded-xl border border-black/5 bg-[#fdf6e3]/80 shadow-lg backdrop-blur-md"><div class="flex border-b border-black/5 bg-black/5 p-1"><button><span>ð¼ï¸</span> Frames</button> <button><span>ð§µ</span> Veils</button></div> <div class="custom-scrollbar max-h-[30vh] overflow-y-auto p-3"><!></div> <div class="flex items-center justify-between bg-black/5 px-5 py-2"><button class="flex items-center gap-1 font-serif text-[8px] font-bold tracking-[0.2em] uppercase opacity-30 hover:opacity-60"><span>ï¼</span> </button> <span class="font-serif text-[8px] font-bold tracking-[0.2em] uppercase opacity-30"> </span></div></div>');function Xs(o,e){H(e,!0);let t=L(null),i=L(null);function a(M){y(t,M,!0)}function r(M,P){M.preventDefault(),y(i,P,!0)}function n(M,P){M.preventDefault(),d(t)!==null&&(s.studio.folioActiveTab==="veils"?k.folio.reorderVeil(d(t),P):k.folio.reorderFrame(d(t),P)),y(t,null),y(i,null)}function l(){y(t,null),y(i,null)}var c=Qs(),u=p(c),f=p(u);f.__click=()=>s.studio.folioActiveTab="frames";var x=h(f,2);x.__click=()=>s.studio.folioActiveTab="veils",v(u);var g=h(u,2),A=p(g);{var C=M=>{var P=$s();re(P,21,()=>s.project.frames,oe,(O,j,V)=>{var D=Us();D.__click=()=>s.project.activeFrameIndex=V,D.__keydown=ie=>ie.key==="Enter"&&(s.project.activeFrameIndex=V);var X=p(D),ee=p(X);ee.textContent=V+1;var te=h(ee,2),Y=p(te,!0);v(te),v(X);var N=h(X,2),he=p(N);he.__click=ie=>{ie.stopPropagation(),k.folio.duplicateFrame(V)};var fe=h(he,2);{var Te=ie=>{var we=Rs();we.__click=Ve=>{Ve.stopPropagation(),k.folio.removeFrame(V)},_(ie,we)};R(fe,ie=>{s.project.frames.length>1&&ie(Te)})}var De=h(fe,2);{var Pe=ie=>{var we=Gs();_(ie,we)};R(De,ie=>{V===s.project.activeFrameIndex&&ie(Pe)})}v(N),v(D),F(()=>{z(D,1,`group flex cursor-grab items-center justify-between rounded-xl px-4 py-3 transition-all ${V===s.project.activeFrameIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${d(i)===V&&d(t)!==V?"border-t-2 border-brand":""} ${d(t)===V?"opacity-40":""}`),B(Y,d(j).name)}),be("dragstart",D,()=>a(V)),be("dragover",D,ie=>r(ie,V)),be("drop",D,ie=>n(ie,V)),be("dragend",D,l),_(O,D)}),v(P),ne(3,P,()=>_e,()=>({duration:150})),_(M,P)},w=M=>{var P=Ws();re(P,21,()=>s.project.activeFrame.veils,oe,(O,j,V)=>{var D=zs();D.__click=()=>s.project.activeFrame.activeVeilIndex=V,D.__keydown=q=>q.key==="Enter"&&(s.project.activeFrame.activeVeilIndex=V);var X=p(D),ee=p(X);ee.__click=q=>{q.stopPropagation(),k.folio.toggleVisibility(V)};var te=p(ee,!0);v(ee);var Y=h(ee,2),N=p(Y,!0);v(Y),v(X);var he=h(X,2),fe=p(he);fe.__click=q=>{q.stopPropagation(),k.folio.toggleLock(V)};var Te=p(fe,!0);v(fe);var De=h(fe,2);De.__click=q=>{q.stopPropagation(),k.folio.duplicateVeil(V)};var Pe=h(De,2);{var ie=q=>{var Fe=Hs();Fe.__click=Be=>{Be.stopPropagation(),k.folio.removeVeil(V)},_(q,Fe)};R(Pe,q=>{s.project.activeFrame.veils.length>1&&q(ie)})}var we=h(Pe,2);{var Ve=q=>{var Fe=Ks();_(q,Fe)};R(we,q=>{V===s.project.activeFrame.activeVeilIndex&&q(Ve)})}v(he),v(D),F(()=>{z(D,1,`group flex cursor-grab items-center justify-between rounded-xl px-4 py-3 transition-all ${V===s.project.activeFrame.activeVeilIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${d(i)===V&&d(t)!==V?"border-t-2 border-brand":""} ${d(t)===V?"opacity-40":""}`),z(ee,1,`text-xs transition-opacity ${d(j).isVisible?"opacity-100":"opacity-20"}`),B(te,d(j).isVisible?"ðï¸":"ð¶ï¸"),z(Y,1,`truncate font-serif text-sm font-medium ${d(j).isVisible?"":"opacity-40"}`),B(N,d(j).name),z(fe,1,`text-[10px] transition-opacity ${d(j).isLocked?"opacity-100":"opacity-20"}`),B(Te,d(j).isLocked?"ð":"ð")}),be("dragstart",D,()=>a(V)),be("dragover",D,q=>r(q,V)),be("drop",D,q=>n(q,V)),be("dragend",D,l),_(O,D)}),v(P),ne(3,P,()=>_e,()=>({duration:150})),_(M,P)};R(A,M=>{s.studio.folioActiveTab==="frames"?M(C):M(w,!1)})}v(g);var b=h(g,2),m=p(b);m.__click=()=>{s.studio.folioActiveTab==="frames"?k.folio.addFrame():k.folio.addVeil()};var E=h(p(m));v(m);var I=h(m,2),S=p(I,!0);v(I),v(b),v(c),F(()=>{z(f,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${s.studio.folioActiveTab==="frames"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),z(x,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${s.studio.folioActiveTab==="veils"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),B(E,` Add ${s.studio.folioActiveTab==="frames"?"Frame":"Veil"}`),B(S,s.studio.folioActiveTab==="frames"?s.project.frames.length+" Frames":s.project.activeFrame.veils.length+" Veils")}),_(o,c),K()}le(["click","keydown"]);var Ys=T('<aside class="side-panel-left flex h-full w-64 flex-col gap-6 border-r-2 border-grid-border p-4"><div class="flex-1 overflow-y-auto"><!></div></aside>');function qs(o){var e=Ys(),t=p(e),i=p(t);Xs(i,{}),v(t),v(e),_(o,e)}var Zs=T('<button class="group artisan-checker-small relative h-5 w-5 shrink-0 rounded-md border-2 border-white shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[6px] drop-shadow-sm">ð</span></div></button>'),Js=T('<div class="flex h-5 w-5 items-center justify-center rounded-md border-2 border-dashed border-studio-text/10"><span class="text-[6px] opacity-20">ð§µ</span></div>'),ea=T('<div class="artisan-panel flex w-full flex-col gap-4 px-3 py-4 shadow-sm"><div class="flex flex-col items-center gap-2"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Active Dye</span> <div class="artisan-checker-small h-8 w-8 rounded-lg border-2 border-white shadow-md transition-colors"></div> <span class="font-mono text-[8px] font-bold tracking-tighter uppercase opacity-40"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col gap-3"><span class="text-center font-serif text-[7px] font-bold uppercase opacity-30">Used Dyes</span> <div class="no-scrollbar flex max-h-[150px] flex-row flex-wrap gap-1.5 overflow-y-auto svelte-1dy8mnv"></div></div></div>');function ta(o,e){H(e,!1),ce();var t=ea(),i=p(t),a=h(p(i),2),r=h(a,2),n=p(r,!0);v(r),v(i);var l=h(i,4),c=h(p(l),2);re(c,5,()=>s.usedColors,u=>u,(u,f)=>{var x=Zs();x.__click=()=>k.dye.setDye(d(f)),F(()=>{Z(x,`background-color: ${d(f)??""};`),se(x,"title",d(f))}),ne(3,x,()=>Ms,()=>({duration:200})),_(u,x)},u=>{var f=Js();_(u,f)}),v(c),v(l),v(t),F(()=>{Z(a,`background-color: ${s.paletteState.activeDye??""};`),B(n,s.paletteState.activeDye)}),_(o,t),K()}le(["click"]);var ia=T('<div class="artisan-panel stats-panel w-full rounded-xl px-4 py-3 shadow-sm"><div class="flex flex-col gap-2"><div class="flex flex-col"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Needle Focus</span> <span class="font-mono text-[10px] font-bold tabular-nums"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Linen Size</span> <span class="font-mono text-[10px] font-bold tabular-nums"> </span></div></div></div>');function sa(o,e){H(e,!1),ce();var t=ia(),i=p(t),a=p(i),r=h(p(a),2),n=p(r);v(r),v(a);var l=h(a,4),c=h(p(l),2),u=p(c);v(c),v(l),v(i),v(t),F(()=>{B(n,`${s.displayCoords.x??""}, ${s.displayCoords.y??""}`),B(u,`${s.linen.width??""}Ã${s.linen.height??""}`)}),_(o,t),K()}var We=Je(()=>s),aa=T("<button></button>"),ra=T('<div class="artisan-panel flex w-full flex-col gap-3 rounded-xl p-3 shadow-sm"><span class="text-center font-serif text-[7px] font-bold uppercase opacity-30">Dye Palette</span> <div class="grid grid-cols-4 gap-2"><!> <button class="flex h-8 w-8 items-center justify-center rounded-lg border-2 border-dashed border-brand/40 bg-gradient-to-tr from-rose-200 to-sky-200 shadow-sm transition-all hover:scale-110 hover:border-brand" title="Natural Dye Basin"><span class="text-xs">ï¼</span></button></div></div>');function na(o,e){H(e,!1),ce();var t=ra(),i=h(p(t),2),a=p(i);re(a,1,()=>We().palette,oe,(n,l,c)=>{var u=aa();u.__click=()=>k.dye.select(c),se(u,"aria-label",`Select dye ${c+1}`),F(()=>{z(u,1,`artisan-checker-small h-8 w-8 rounded-lg border-2 transition-all ${We().activeDye===d(l)?"scale-110 border-brand shadow-md ring-2 ring-white":"border-white opacity-70 hover:scale-105 hover:opacity-100"}`),Z(u,`background-color: ${d(l)??""};`)}),_(n,u)});var r=h(a,2);r.__click=()=>We(We().studio.showDyeBasin=!0),v(i),v(t),_(o,t),K()}le(["click"]);var oa=T('<aside class="side-panel-right flex h-full w-64 flex-col gap-6 border-l-2 border-grid-border p-4"><div class="flex flex-col gap-4"><!> <!></div> <div class="flex-1"></div> <!></aside>');function la(o){var e=oa(),t=p(e),i=p(t);ta(i,{});var a=h(i,2);na(a,{}),v(t);var r=h(t,4);sa(r,{}),v(e),_(o,e)}var ca=T('<span class="text-xs"> </span>'),da=T('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),ua=T("<div><!> <span> </span> <!></div>"),va=T('<div class="text-[8px] font-bold tracking-[0.2em] uppercase opacity-20"> </div>'),pa=T('<div><div class="flex w-[180px] items-center"><!></div> <!></div>');function ha(o,e){H(e,!1),ce();var t=pa(),i=p(t),a=p(i);Ci(a,()=>xe.current.type,l=>{var c=ua(),u=p(c);{var f=w=>{var b=ca(),m=p(b,!0);v(b),F(()=>B(m,xe.current.icon)),_(w,b)};R(u,w=>{xe.current.icon&&w(f)})}var x=h(u,2),g=p(x,!0);v(x);var A=h(x,2);{var C=w=>{var b=da(),m=p(b);v(b),F(()=>B(m,`v${s.version??""}`)),_(w,b)};R(A,w=>{xe.current.type==="RESTING"&&w(C)})}v(c),F(()=>{z(c,1,`status-tag flex items-center gap-2 ${xe.current.isPulse?"animate-pulse":""}`),Z(c,`
					border-color: color-mix(in srgb, ${xe.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${xe.current.color??""} 10%, transparent);
					color: ${xe.current.color??""};
				`),z(x,1,Di(xe.current.type==="RESTING"?"font-serif italic opacity-60":"font-bold")),B(g,xe.current.label)}),_(l,c)}),v(i);var r=h(i,2);{var n=l=>{const c=Xe(()=>s.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var u=va(),f=p(u);v(u),F(()=>B(f,`Linen Backed Up: ${d(c)??""}`)),_(l,u)};R(r,l=>{s.project.lastSaved&&l(n)})}v(t),F(()=>z(t,1,`flex items-center gap-4 transition-opacity duration-1000 ${s.needle.isVisible?"opacity-100":"opacity-0"}`)),_(o,t),K()}var fa=T('<span class="rounded bg-brand/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-brand uppercase"> </span>'),ga=T('<span class="font-mono text-[9px] italic opacity-20">None</span>'),xa=T('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic">Chord:</span> <div class="flex min-w-[120px] gap-1.5"><!></div></div>');function ba(o,e){H(e,!1),ce();var t=xa(),i=h(p(t),2),a=p(i);{var r=l=>{var c=Ae(),u=ae(c);re(u,1,()=>U.activeKeys,oe,(f,x)=>{var g=fa(),A=p(g,!0);v(g),F(()=>B(A,d(x)===" "?"Space":d(x))),_(f,g)}),_(l,c)},n=l=>{var c=ga();_(l,c)};R(a,l=>{U.activeKeys.length>0?l(r):l(n,!1)})}v(i),v(t),_(o,t),K()}var ma=T('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic">Stance:</span> <span class="font-mono text-[9px] font-bold text-brand uppercase"> </span></div>');function Aa(o,e){H(e,!1),ce();var t=ma(),i=h(p(t),2),a=p(i,!0);v(i),v(t),F(()=>B(a,xe.current.type)),_(o,t),K()}var ya=T('<div class="flex items-center gap-1.5" title="Atmosphere Status"><span>ð¹</span> <span class="font-serif text-[8px] font-bold tracking-wider text-brand/40 uppercase italic"><!></span></div>');function _a(o,e){H(e,!1),ce();var t=ya(),i=p(t),a=h(i,2),r=p(a);{var n=c=>{var u=Ue("Silent");_(c,u)},l=c=>{var u=Ae(),f=ae(u);{var x=A=>{var C=Ue("Weaving");_(A,C)},g=A=>{var C=Ue("Resonance");_(A,C)};R(f,A=>{s.usageMinutes<60?A(x):A(g,!1)},!0)}_(c,u)};R(r,c=>{s.usageMinutes<30?c(n):c(l,!1)})}v(a),v(t),F(()=>z(i,1,`text-[9px] ${s.usageMinutes>=30?"animate-pulse":"opacity-20 grayscale"}`)),_(o,t),K()}var wa=T('<div class="flex items-center gap-1.5" title="Working Time"><span class="text-[9px] opacity-40">â³</span> <span class="font-mono text-[9px] font-bold text-brand/60 tabular-nums"> </span></div>');function Ea(o,e){H(e,!1),ce();var t=wa(),i=h(p(t),2),a=p(i,!0);v(i),v(t),F(()=>B(a,s.studio.sessionTimeLabel)),_(o,t),K()}var Sa=T('<div class="flex items-center gap-1.5" title="Active Selection"><span class="text-[9px] text-brand/60">ð¸ï¸</span> <span class="font-serif text-[8px] font-bold tracking-wider text-brand/60 uppercase italic"> </span></div>');function Ia(o,e){H(e,!0);let t=Q(()=>s.selection.getPoints(s.linen.width).length);var i=Ae(),a=ae(i);{var r=n=>{var l=Sa(),c=h(p(l),2),u=p(c);v(c),v(l),F(()=>B(u,`Motif: ${d(t)??""} Stitches`)),ne(3,l,()=>_e),_(n,l)};R(a,n=>{d(t)>0&&n(r)})}_(o,i),K()}var Ca=T('<div class="flex items-center gap-1.5"><span class="text-[10px]">ð¾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand uppercase"> </span></div> <div class="h-3 w-px bg-brand/20"></div>',1),Ta=T('<div class="flex items-center gap-4 opacity-40"><!> <div class="flex gap-3 font-mono text-[8px] font-bold tracking-tighter uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-brand/20"></div> <span class="font-mono text-[9px] font-black tracking-widest text-brand/60 uppercase">Technical Ledger</span></div>');function ka(o,e){H(e,!1),ce();var t=Ta(),i=p(t);{var a=g=>{var A=Ca(),C=ae(A),w=h(p(C),2),b=p(w);v(w),v(C),Ce(2),F(m=>B(b,`Backed up: ${m??""}`),[()=>s.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})]),ne(3,C,()=>_e),_(g,A)};R(i,g=>{s.lastSaved&&g(a)})}var r=h(i,2),n=p(r),l=p(n);v(n);var c=h(n,2),u=p(c);v(c);var f=h(c,2),x=p(f);v(f),v(r),Ce(4),v(t),F(g=>{B(l,`Pos: ${s.needlePos.x??""},${s.needlePos.y??""}`),B(u,`Size: ${s.linenWidth??""}x${s.linenHeight??""}`),B(x,`Zoom: ${g??""}%`)},[()=>Math.round(s.zoomLevel*100)]),_(o,t),K()}var La=T('<div class="flex flex-1 items-center justify-between px-6 opacity-60 transition-opacity hover:opacity-100"><div class="flex items-center gap-6"><!> <div class="h-3 w-px bg-brand/10"></div> <!> <div class="h-3 w-px bg-brand/10"></div> <div class="flex items-center gap-4"><!> <!> <div class="h-3 w-px bg-brand/10"></div> <!></div></div> <!></div>');function Pa(o){var e=La(),t=p(e),i=p(t);ba(i,{});var a=h(i,4);Aa(a,{});var r=h(a,4),n=p(r);Ea(n,{});var l=h(n,2);_a(l,{});var c=h(l,4);Ia(c,{}),v(r),v(t);var u=h(t,2);ka(u,{}),v(e),_(o,e)}var Ee=Je(()=>s),Va=T('<div class="flex items-center gap-3 border-r border-black/5 pr-3"><button title="Toggle Pulse (P)"><span class="text-[10px]"> </span> <span class="font-tiny5 tracking-widest uppercase"> </span></button> <div class="flex items-center gap-1.5 rounded-lg bg-black/5 px-2 py-0.5"><span class="font-serif text-[8px] font-black tracking-tighter uppercase opacity-30">Pace</span> <input type="number" min="1" max="60" class="w-6 bg-transparent text-center font-mono text-[10px] font-bold focus:outline-none"/> <span class="font-serif text-[8px] opacity-20">FPS</span></div> <button title="Toggle Ghost Threads (Alt+G)"><span class="text-[10px]">ð»</span> <span class="font-serif text-[8px] font-black tracking-wider uppercase">Ghosts</span></button></div>');function Fa(o,e){H(e,!1),ce();var t=Va(),i=p(t);i.__click=()=>ft.toggle();var a=p(i),r=p(a,!0);v(a);var n=h(a,2),l=p(n,!0);v(n),v(i);var c=h(i,2),u=h(p(c),2);de(u),Ce(2),v(c);var f=h(c,2);f.__click=()=>Ee(Ee().studio.showGhostThreads=!Ee().studio.showGhostThreads),v(t),F(()=>{z(i,1,`artisan-primary-btn flex items-center gap-1.5 !px-3 !py-1 text-[10px] ${Ee().project.isPlaying?"bg-brand":"bg-slate-700"}`),B(r,Ee().project.isPlaying?"â¹":"â¶"),B(l,Ee().project.isPlaying?"Stop":"Play"),z(f,1,`flex items-center gap-1.5 rounded-lg px-2.5 py-0.5 transition-all ${Ee().studio.showGhostThreads?"bg-brand/10 text-brand ring-1 ring-brand/20":"bg-black/5 opacity-40 hover:opacity-100"}`)}),ue(u,()=>Ee().studio.fps,x=>Ee(Ee().studio.fps=x)),_(o,t),K()}le(["click"]);var Ma=T("<div></div>"),Oa=T("<div></div>"),Da=T('<div class="h-1 w-1 animate-pulse rounded-full bg-brand"></div>'),Na=T('<div><div role="button" tabindex="0"><div class="absolute inset-0 grid opacity-10 group-hover:opacity-30"></div> <div class="absolute top-1 left-1.5 flex items-center gap-1.5"><span class="font-mono text-[9px] font-black italic opacity-30"> </span> <!></div> <div class="absolute right-1.5 bottom-1 flex items-center gap-0.5 opacity-30 transition-opacity group-hover:opacity-100"><input type="number" step="10" min="10" class="w-7 bg-transparent text-right font-mono text-[8px] font-bold focus:outline-none"/> <span class="font-serif text-[7px] font-black text-brand uppercase">ms</span></div> <div class="absolute inset-0 flex items-center justify-center gap-2 bg-white/95 opacity-0 transition-opacity group-hover:opacity-100"><button class="p-1 transition-transform hover:scale-125">ð</button> <button class="p-1 transition-transform hover:scale-125">ðï¸</button></div></div></div>');function Ba(o,e){H(e,!0);let t=J(e,"frame",7),i=Q(()=>t().compositeStitches),a=Q(()=>Math.max(40,t().duration*.6));var r=Na(),n=p(r);n.__click=()=>s.project.activeFrameIndex=e.index,n.__keydown=E=>E.key==="Enter"&&(s.project.activeFrameIndex=e.index);var l=p(n);re(l,21,()=>d(i),oe,(E,I)=>{var S=Ae(),M=ae(S);{var P=j=>{var V=Ma();F(()=>Z(V,`background-color: ${d(I)??""};`)),_(j,V)},O=j=>{var V=Oa();_(j,V)};R(M,j=>{d(I)?j(P):j(O,!1)})}_(E,S)}),v(l);var c=h(l,2),u=p(c),f=p(u,!0);v(u);var x=h(u,2);{var g=E=>{var I=Da();_(E,I)};R(x,E=>{e.isActive&&E(g)})}v(c);var A=h(c,2),C=p(A);de(C),Ce(2),v(A);var w=h(A,2),b=p(w);b.__click=E=>{E.stopPropagation(),k.folio.duplicateFrame(e.index)};var m=h(b,2);m.__click=E=>{E.stopPropagation(),k.folio.removeFrame(e.index)},v(w),v(n),v(r),F(()=>{z(r,1,`relative h-12 flex-shrink-0 transition-all ${e.isDragged?"opacity-20":""}`),Z(r,`width: ${d(a)??""}px;`),z(n,1,`group relative h-full w-full cursor-pointer overflow-hidden border-r border-black/10 transition-all ${e.isActive?"bg-brand/5 shadow-[inset_0_0_0_1px_rgba(211,54,130,0.3)]":"bg-black/5 hover:bg-white/40"} ${e.isDropTarget?"border-l-2 border-l-brand":""}`),Z(l,`grid-template-columns: repeat(${t().width??""}, 1fr); grid-template-rows: repeat(${t().height??""}, 1fr);`),B(f,e.index+1)}),ue(C,()=>t().duration,E=>t().duration=E),_(o,r),K()}le(["click","keydown"]);var ja=T('<div class="absolute flex flex-col items-center gap-0.5"><div class="h-1.5 w-px bg-brand/20"></div> <span class="font-mono text-[6px] text-brand/40"> </span></div>'),Ra=T('<div draggable="true" role="listitem"><!></div>'),Ga=T('<div class="relative flex flex-1 flex-col overflow-hidden rounded-lg border border-black/10 bg-black/5 shadow-inner"><div class="relative h-4 w-full overflow-hidden border-b border-black/5 bg-[#eee8d5]"><div class="flex items-center px-2"></div></div> <div class="custom-scrollbar relative flex flex-1 items-start overflow-x-auto overflow-y-hidden svelte-n1ejs0" role="list" aria-label="Spindle Timeline"><div class="flex h-full min-w-full items-center bg-[#eee8d5]/40"><!> <button class="flex h-12 w-10 shrink-0 items-center justify-center border-r border-black/5 bg-black/5 text-lg text-black/20 transition-all hover:bg-brand/10 hover:text-brand" title="New Frame (Alt+N)">ï¼</button></div> <div class="pointer-events-none absolute top-0 bottom-0 z-20 w-px bg-brand transition-all duration-100 ease-out"><div class="absolute -top-1 -left-1.5 h-3 w-3 rounded-full border-2 border-brand bg-[#fdf6e3] shadow-md"></div></div></div></div>');function Ua(o,e){H(e,!0);let t=L(null),i=L(null);function a(E){y(t,E,!0)}function r(E,I){E.preventDefault(),y(i,I,!0)}function n(E,I){E.preventDefault(),d(t)!==null&&k.folio.reorderFrame(d(t),I),y(t,null),y(i,null)}let l=Q(()=>{const E=s.project.activeFrameIndex;let I=0;for(let S=0;S<E;S++)I+=Math.max(40,s.project.frames[S].duration*.6);return I}),c=Q(()=>s.project.frames.reduce((E,I)=>E+I.duration,0)),u=Q(()=>{const E=[];for(let S=0;S<=d(c);S+=200)E.push(S);return E});var f=Ga(),x=p(f),g=p(x);re(g,21,()=>d(u),oe,(E,I)=>{var S=ja(),M=h(p(S),2),P=p(M);v(M),v(S),F(()=>{Z(S,`left: ${d(I)*.6}px;`),B(P,`${d(I)??""}ms`)}),_(E,S)}),v(g),v(x);var A=h(x,2),C=p(A),w=p(C);re(w,19,()=>s.project.frames,E=>E.id,(E,I,S)=>{var M=Ra(),P=p(M);{let O=Q(()=>d(S)===s.project.activeFrameIndex),j=Q(()=>d(t)===d(S)),V=Q(()=>d(i)===d(S)&&d(t)!==d(S));Ba(P,{get frame(){return d(I)},get index(){return d(S)},get isActive(){return d(O)},get isDragged(){return d(j)},get isDropTarget(){return d(V)}})}v(M),be("dragstart",M,()=>a(d(S))),be("dragover",M,O=>r(O,d(S))),be("drop",M,O=>n(O,d(S))),be("dragend",M,()=>{y(t,null),y(i,null)}),_(E,M)});var b=h(w,2);b.__click=()=>k.folio.addFrame(),v(C);var m=h(C,2);v(A),v(f),F(()=>Z(m,`left: ${d(l)??""}px;`)),_(o,f),K()}le(["click"]);var $a=T('<div class="artisan-panel flex h-28 w-full flex-col gap-1.5 overflow-hidden px-4 py-2 shadow-2xl transition-all hover:bg-white/40"><div class="flex items-center justify-between border-b border-black/5 pb-1"><div class="flex items-center gap-4"><div class="flex items-center gap-1.5"><span class="text-[10px] opacity-40">â³</span> <span class="font-tiny5 text-[9px] tracking-[0.2em] text-brand uppercase">The Spindle</span></div> <!></div> <div class="flex items-center gap-4"><div class="flex flex-col items-end gap-0"><span class="font-serif text-[7px] font-black tracking-widest uppercase opacity-20">Kinetic Track</span> <span class="font-mono text-[8px] font-bold text-brand opacity-60"> </span></div></div></div> <!></div>');function Ha(o,e){H(e,!1),ce();var t=$a(),i=p(t),a=p(i),r=h(p(a),2);Fa(r,{}),v(a);var n=h(a,2),l=p(n),c=h(p(l),2),u=p(c);v(c),v(l),v(n),v(i);var f=h(i,2);Ua(f,{}),v(t),F(()=>B(u,`${s.project.frames.length??""} Threads`)),_(o,t),K()}var Ka=T('<footer class="hud-panel flex w-full flex-col border-t-2 border-grid-border bg-canvas-bg px-4 py-1"><!> <div class="flex h-10 w-full items-center justify-between"><div class="flex items-center gap-4"><!></div> <!></div></footer>');function za(o){var e=Ka(),t=p(e);Ha(t,{});var i=h(t,2),a=p(i),r=p(a);ha(r,{}),v(a);var n=h(a,2);Pa(n),v(i),v(e),_(o,e)}var Wa=T('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-studio-text/10"></div>'),Qa=T('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-studio-text/10"></div>'),Xa=T('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-studio-text/30"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-studio-text/30"></div> <!> <!></div>');function Ya(o,e){H(e,!1),ce();var t=Xa(),i=h(p(t),4);re(i,0,()=>[-24,-16,-8,8,16,24],oe,(r,n)=>{const l=Xe(()=>50+n/s.linen.width*100);var c=Ae(),u=ae(c);{var f=x=>{var g=Wa();F(()=>Z(g,`left: ${d(l)??""}%`)),_(x,g)};R(u,x=>{d(l)>0&&d(l)<100&&x(f)})}_(r,c)});var a=h(i,2);re(a,0,()=>[-24,-16,-8,8,16,24],oe,(r,n)=>{const l=Xe(()=>50+n/s.linen.height*100);var c=Ae(),u=ae(c);{var f=x=>{var g=Qa();F(()=>Z(g,`top: ${d(l)??""}%`)),_(x,g)};R(u,x=>{d(l)>0&&d(l)<100&&x(f)})}_(r,c)}),v(t),_(o,t),K()}var qa=T('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),Za=T('<div class="cursor-container absolute inset-0 svelte-4tpgo2"><div class="bloom-wrapper svelte-4tpgo2"><div class="petal p-top svelte-4tpgo2"></div> <div class="petal p-bottom svelte-4tpgo2"></div> <div class="petal p-left svelte-4tpgo2"></div> <div class="petal p-right svelte-4tpgo2"></div> <div class="center-dot svelte-4tpgo2"></div></div> <!></div>');function Ja(o,e){H(e,!1),ce();var t=Ae(),i=ae(t);{var a=r=>{var n=Za(),l=h(p(n),2);{var c=u=>{var f=qa(),x=ae(f),g=h(x,2),A=p(g),C=p(A);v(A),Ce(2),v(g),F(()=>{Z(x,`background-color: ${s.activeDye??""};`),Z(C,`background-color: ${s.activeDye??""};`)}),ne(3,x,()=>_e,()=>({duration:400})),ne(1,g,()=>Fs,()=>({y:-10,duration:400})),ne(2,g,()=>_e,()=>({duration:400})),_(u,f)};R(l,u=>{s.isPicking&&u(c)})}v(n),ne(3,n,()=>_e,()=>({duration:800})),_(r,n)};R(i,r=>{s.isNeedleVisible&&r(a)})}_(o,t),K()}var er=T("<div><!></div>");function tr(o,e){let t=Q(()=>e.activeX===e.x&&e.activeY===e.y),i=Q(()=>e.color===null);var a=er(),r=p(a);{var n=l=>{Ja(l,{})};R(r,l=>{d(t)&&l(n)})}v(a),F(()=>{z(a,1,`cell-stitch relative h-full w-full ${d(t)?"z-30":"z-10"}`),Z(a,`background-color: ${(d(i)?"transparent":e.color)??""};`)}),_(o,a)}var ir=ut('<line stroke-dasharray="0.2, 0.2" class="marching-ants-svg svelte-1onh8x1"></line>'),sr=ut('<line stroke="var(--color-brand)" stroke-width="0.05" stroke-dasharray="0.1, 0.1"></line>'),ar=ut('<circle r="0.2" fill="var(--color-brand)"></circle><!>',1),rr=T('<div class="absolute bg-brand/10"></div>'),nr=T('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><defs><pattern id="ants" width="1" height="1" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="1" y2="0" stroke="var(--ants-color)" stroke-width="0.1" stroke-dasharray="0.2, 0.2"></line></pattern></defs><!><!></svg> <div class="pointer-events-none absolute inset-0 z-[39]" style="grid-column: 1 / -1; grid-row: 1 / -1;"></div>',1);function or(o,e){H(e,!0);let t=Q(()=>s.selection.getBoundaryEdges(s.linen.width)),i=Q(()=>s.selection.vertices),a=Q(()=>xe.current.type==="LOOMING");var r=Ae(),n=ae(r);{var l=c=>{var u=nr(),f=ae(u),x=h(p(f));re(x,17,()=>d(t),oe,(w,b)=>{var m=ir();se(m,"stroke-width",.08),F(()=>{se(m,"x1",d(b).x1),se(m,"y1",d(b).y1),se(m,"x2",d(b).x2),se(m,"y2",d(b).y2),se(m,"stroke",d(a)?"var(--color-brand)":"rgba(211, 54, 130, 0.8)")}),_(w,m)});var g=h(x);{var A=w=>{var b=Ae(),m=ae(b);re(m,17,()=>d(i),oe,(E,I,S)=>{const M=Q(()=>d(i)[S+1]||d(i)[0]);var P=ar(),O=ae(P),j=h(O);{var V=D=>{var X=sr();F(()=>{se(X,"x1",d(I).x+.5),se(X,"y1",d(I).y+.5),se(X,"x2",d(M).x+.5),se(X,"y2",d(M).y+.5)}),_(D,X)};R(j,D=>{d(i).length>1&&S<d(i).length-(d(i).length>=3?0:1)&&D(V)})}F(()=>{se(O,"cx",d(I).x+.5),se(O,"cy",d(I).y+.5)}),_(E,P)}),_(w,b)};R(g,w=>{d(i).length>0&&w(A)})}v(f);var C=h(f,2);re(C,21,()=>s.selection.getPoints(s.linen.width),oe,(w,b)=>{var m=rr();F(()=>Z(m,`
                left: ${d(b).x/s.linen.width*100}%; 
                top: ${d(b).y/s.linen.height*100}%; 
                width: ${100/s.linen.width}%; 
                height: ${100/s.linen.height}%;
            `)),_(w,m)}),v(C),F(()=>se(f,"viewBox",`0 0 ${s.linen.width??""} ${s.linen.height??""}`)),_(c,u)};R(n,c=>{s.selection.isActive&&c(l)})}_(o,r),K()}var lr=T("<div></div>"),cr=T('<div class="ghost-frame pointer-events-none absolute inset-0 z-0 svelte-1syggvx"></div>');function dr(o,e){let t=J(e,"opacity",3,.2);var i=cr();re(i,21,()=>e.stitches,oe,(a,r,n)=>{var l=Ae(),c=ae(l);{var u=f=>{var x=lr();F(g=>Z(x,`grid-column: ${n%e.width+1}; grid-row: ${g??""}; background-color: ${d(r)??""};`),[()=>Math.floor(n/e.width)+1]),_(f,x)};R(c,f=>{d(r)&&f(u)})}_(a,l)}),v(i),F(()=>Z(i,`
        display: grid;
        grid-template-columns: repeat(${e.width??""}, 1fr); 
        grid-template-rows: repeat(${e.height??""}, 1fr);
        opacity: ${t()??""};
    `)),_(o,i)}var ur=T('<div class="loom-viewport relative flex h-full w-full items-center justify-center overflow-hidden svelte-jw6f5"><div class="loom-container absolute top-1/2 left-1/2 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] svelte-jw6f5"><div class="stitch-grid-pattern artisan-checker-small relative h-full w-full shadow-[0_10px_40px_rgba(0,0,0,0.06)] ring-1 ring-black/5"><!> <!> <!> <!></div></div></div>');function vr(o,e){H(e,!0);let t=Q(()=>s.linen.width),i=Q(()=>s.linen.height),a=Q(()=>`calc(100% * ${d(t)} / (${d(t)} + 2))`),r=Q(()=>`calc(100% * ${d(i)} / (${d(i)} + 2))`),n=Q(()=>{if(!s.studio.showGhostThreads)return[];const w=s.project.activeFrameIndex,b=[];return w>0&&b.push({stitches:s.project.frames[w-1].compositeStitches,opacity:.3}),w>1&&b.push({stitches:s.project.frames[w-2].compositeStitches,opacity:.1}),b});var l=ur(),c=p(l),u=p(c),f=p(u);Ya(f,{});var x=h(f,2);{var g=w=>{var b=Ae(),m=ae(b);re(m,17,()=>d(n),oe,(E,I)=>{dr(E,{get stitches(){return d(I).stitches},get width(){return d(t)},get height(){return d(i)},get opacity(){return d(I).opacity}})}),_(w,b)};R(x,w=>{s.studio.showGhostThreads&&w(g)})}var A=h(x,2);re(A,17,()=>s.linen.compositeStitches,oe,(w,b,m)=>{const E=Q(()=>m%d(t)),I=Q(()=>Math.floor(m/d(t)));tr(w,{get color(){return d(b)},get x(){return d(E)},get y(){return d(I)},get activeX(){return s.needle.pos.x},get activeY(){return s.needle.pos.y}})});var C=h(A,2);or(C,{}),v(u),v(c),v(l),F(()=>{Z(c,`
			transform: ${s.cameraTransform??""};
			aspect-ratio: ${d(t)??""} / ${d(i)??""};
			width: min(${d(a)??""}, calc(${d(r)??""} * (${d(t)??""} / ${d(i)??""})));
		`),Z(u,`
				display: grid;
				grid-template-columns: repeat(${d(t)??""}, 1fr); 
				grid-template-rows: repeat(${d(i)??""}, 1fr);
				--grid-cols: ${d(t)??""}; 
				--grid-rows: ${d(i)??""}; 
				background-color: ${s.studio.canvasBgColor??""};
			`)}),_(o,l),K()}const pr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var hr=T(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-[#fdf6e3] svelte-1k59vfz" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');"><div class="flex flex-col items-center gap-2 svelte-1k59vfz"><div class="mb-6 flex animate-bounce items-center justify-center svelte-1k59vfz"><img alt="Rupa Icon" class="h-24 w-auto drop-shadow-md svelte-1k59vfz"/></div> <h1 class="font-tiny5 text-6xl text-brand drop-shadow-sm svelte-1k59vfz">Rupa</h1> <p class="font-serif text-[10px] font-bold tracking-[0.4em] uppercase opacity-40 svelte-1k59vfz">The Weaver's Studio</p></div> <div class="absolute bottom-16 flex flex-col items-center gap-4 svelte-1k59vfz"><div class="h-0.5 w-48 overflow-hidden rounded-xl bg-black/5 svelte-1k59vfz"><div class="h-full animate-[loading_2s_ease-in-out_infinite] bg-brand/60 svelte-1k59vfz"></div></div> <div class="flex flex-col items-center gap-1 svelte-1k59vfz"><span class="font-serif text-[10px] italic opacity-40 svelte-1k59vfz">Preparing the digital linen...</span> <span class="font-mono text-[9px] font-bold tracking-widest uppercase opacity-20 svelte-1k59vfz"> </span></div></div></div>`);function fr(o,e){H(e,!0);let t=L(!0);Ke(()=>{const n=setTimeout(()=>{y(t,!1),setTimeout(()=>{s.isAppReady=!0,s.showArtisanCodex=!0},800)},2e3);return()=>clearTimeout(n)});var i=Ae(),a=ae(i);{var r=n=>{var l=hr(),c=p(l),u=p(c),f=p(u);v(u),Ce(4),v(c);var x=h(c,2),g=h(p(x),2),A=h(p(g),2),C=p(A);v(A),v(g),v(x),v(l),F(()=>{se(f,"src",pr),B(C,`Version ${s.version??""}`)}),ne(2,l,()=>_e,()=>({duration:800})),_(n,l)};R(a,n=>{d(t)&&n(r)})}_(o,i),K()}var gr=T('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><span> </span> <span> </span></div> <input type="range"/></div>');function Qe(o,e){H(e,!0);let t=J(e,"value",15),i=J(e,"min",3,0),a=J(e,"step",3,1),r=J(e,"unit",3,""),n=J(e,"isHue",3,!1);var l=gr(),c=p(l),u=p(c),f=p(u,!0);v(u);var x=h(u,2),g=p(x);v(x),v(c);var A=h(c,2);de(A);let C;v(l),F(w=>{B(f,e.label),B(g,`${w??""}${r()??""}`),se(A,"min",i()),se(A,"max",e.max),se(A,"step",a()),C=z(A,1,"custom-slider svelte-7qe4gg",null,C,{"hue-slider":n()})},[()=>a()<1?t().toFixed(2):Math.round(t())]),ue(A,t),_(o,l),K()}var xr=T('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="button" tabindex="-1"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl">â²</span> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand">Dye Basin</h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30">Mix your threads</span></div></div> <div class="artisan-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><span class="font-mono text-sm font-bold opacity-40">HEX</span> <input type="text" class="w-full bg-transparent font-mono text-lg font-bold uppercase focus:outline-none"/></div> <button class="artisan-primary-btn w-full py-4">Seal the Dye</button></div></div></div>');function xt(o,e){H(e,!0);let t=J(e,"value",15),i=L(0),a=L(0),r=L(0),n=L(1);ye(()=>{const S=Ze.unravel(t());Le(()=>{y(i,S.h,!0),y(a,S.s,!0),y(r,S.l,!0),y(n,S.a,!0)})}),ye(()=>{const S=Ze.spin({h:d(i),s:d(a),l:d(r),a:d(n)});Le(()=>{t(S)})}),ye(()=>(Le(()=>s.pushEscapeAction(e.onClose)),()=>s.popEscapeAction(e.onClose)));var l=xr();l.__mousedown=S=>S.target===S.currentTarget&&e.onClose();var c=p(l),u=p(c),f=h(p(u),2);v(u);var x=h(u,2),g=p(x);Qe(g,{label:"Hue",max:360,unit:"Â°",isHue:!0,get value(){return d(i)},set value(S){y(i,S,!0)}});var A=h(g,2);Qe(A,{label:"Saturation",max:100,unit:"%",get value(){return d(a)},set value(S){y(a,S,!0)}});var C=h(A,2);Qe(C,{label:"Lightness",max:100,unit:"%",get value(){return d(r)},set value(S){y(r,S,!0)}});var w=h(C,2);Qe(w,{label:"Alpha",min:0,max:1,step:.01,unit:"",get value(){return d(n)},set value(S){y(n,S,!0)}}),v(x);var b=h(x,2),m=p(b),E=h(p(m),2);de(E),v(m);var I=h(m,2);I.__click=function(...S){e.onClose?.apply(this,S)},v(b),v(c),v(l),F(()=>Z(f,`background-color: ${t()??""};`)),ue(E,t),ne(1,c,()=>He,()=>({duration:200,start:.95})),ne(2,c,()=>He,()=>({duration:150,start:1,opacity:0})),ne(3,l,()=>_e,()=>({duration:150})),_(o,l),K()}le(["mousedown","click"]);var br=T("<span> </span>"),mr=T('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function Ar(o,e){H(e,!0);var t=mr();t.__click=()=>{e.action.action(),e.onSelect()};var i=p(t),a=p(i,!0);v(i);var r=h(i,2);{var n=l=>{var c=br(),u=p(c,!0);v(c),F(()=>{z(c,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),B(u,e.action.shortcut)}),_(l,c)};R(r,l=>{e.action.shortcut&&l(n)})}v(t),F(()=>{z(t,1,`artisan-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),B(a,e.action.label)}),be("mouseenter",t,function(...l){e.onSelect?.apply(this,l)}),_(o,t),K()}le(["click"]);var yr=T('<div class="p-8 text-center font-serif text-sm italic opacity-40"> </div>'),_r=T('<div class="flex flex-col gap-1"></div>'),wr=T('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="button" tabindex="-1"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-[#fdf6e3]/95 shadow-2xl"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40">ð</span> <input id="catalog-search" type="text" placeholder="Search for a pattern or studio action..." class="w-full bg-transparent font-serif text-xl focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-1fnfmu0"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] uppercase opacity-30">Use Arrows to Navigate â¢ Enter to Weave</span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] uppercase opacity-30"> </span></div></div></div>');function Er(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.studio.showPatternCatalog=!1),i=L(""),a=L(0);const r=[{id:"save-project",label:"File: Open Archive Pattern Window",shortcut:U.getLabel("OPEN_ARCHIVE"),action:()=>s.showArchivePattern=!0},{id:"open-project",label:"File: Open Artisan Project (.rupa)",shortcut:U.getLabel("OPEN"),action:()=>s.studio.showArchivePattern=!0},{id:"open-dye-basin",label:"Color: Open Color Wheel (Dye Basin)",shortcut:U.getLabel("OPEN_DYES"),action:()=>s.showDyeBasin=!0},{id:"open-audio-basin",label:"Audio: Open Harmony & Atmosphere Tuning",shortcut:U.getLabel("OPEN_AUDIO"),action:()=>s.showAudioBasin=!0},{id:"toggle-mute",label:"Audio: Master Mute Toggle",shortcut:U.getLabel("TOGGLE_MUTE"),action:()=>s.toggleMute()},{id:"pick-dye",label:"Color: Eyedropper (Pick Dye from Canvas)",shortcut:U.getLabel("PICK_DYE"),action:()=>s.pickDye()},{id:"soak-dye",label:"Color: Dye Soak (Flood Fill connected area)",shortcut:U.getLabel("SOAK"),action:()=>k.dye.soak()},{id:"bleach-fiber",label:"Color: Fiber Bleach (Recolor all instances)",shortcut:U.getLabel("BLEACH"),action:()=>k.manipulation.bleach()},{id:"spirit-pick",label:"Selection: Spirit Pick (Magic Wand selection)",shortcut:U.getLabel("SPIRIT_PICK"),action:()=>k.selection.spiritPick()},{id:"reset-zoom",label:"View: Reset Loom Zoom",shortcut:U.getLabel("RESET_ZOOM"),action:()=>s.resetZoom()},{id:"goto",label:"Navigation: Go to Coordinate (Direct Jump)",shortcut:U.getLabel("GOTO"),action:()=>s.showGoTo=!0},{id:"undo",label:"Edit: Undo Last Stitch",shortcut:U.getLabel("UNDO"),action:()=>s.undo()},{id:"redo",label:"Edit: Redo Last Stitch",shortcut:U.getLabel("REDO"),action:()=>s.redo()},{id:"clear-linen",label:"Project: Clear the Linen (Full Reset)",shortcut:U.getLabel("CLEAR_LINEN"),action:()=>s.clearLinen()},{id:"new-frame",label:"Folio: Add New Frame (Canvas)",shortcut:U.getLabel("NEW_FRAME"),action:()=>k.folio.addFrame()},{id:"duplicate-frame",label:"Folio: Duplicate Current Frame",shortcut:U.getLabel("DUPLICATE_FRAME"),action:()=>k.folio.duplicateFrame(s.project.activeFrameIndex)},{id:"delete-frame",label:"Folio: Delete Current Frame",shortcut:U.getLabel("DELETE_FRAME"),action:()=>k.folio.removeFrame(s.project.activeFrameIndex)},{id:"next-frame",label:"Folio: Turn to Next Page (Frame)",shortcut:U.getLabel("NEXT_FRAME"),action:()=>k.folio.nextFrame()},{id:"toggle-playback",label:"Kinetic: Toggle Animation Playback",shortcut:U.getLabel("PLAY_PULSE"),action:()=>ft.toggle()},{id:"toggle-ghosts",label:"Kinetic: Toggle Ghost Threads (Onion Skinning)",shortcut:U.getLabel("TOGGLE_GHOST_THREADS"),action:()=>s.studio.showGhostThreads=!s.studio.showGhostThreads},{id:"new-veil",label:"Veils: Add New Veil (Layer)",shortcut:U.getLabel("NEW_VEIL"),action:()=>k.folio.addVeil()},{id:"duplicate-veil",label:"Veils: Duplicate Current Veil",shortcut:U.getLabel("DUPLICATE_VEIL"),action:()=>k.folio.duplicateVeil(s.project.activeFrame.activeVeilIndex)},{id:"delete-veil",label:"Veils: Delete Current Veil",shortcut:U.getLabel("DELETE_VEIL"),action:()=>k.folio.removeVeil(s.project.activeFrame.activeVeilIndex)},{id:"copy-pattern",label:"Selection: Copy Pattern to Clipboard",shortcut:U.getLabel("COPY"),action:()=>s.copySelection()},{id:"cut-pattern",label:"Selection: Cut Pattern (Move source to clipboard)",shortcut:U.getLabel("CUT"),action:()=>s.cutSelection()},{id:"paste-pattern",label:"Selection: Paste Pattern from Clipboard",shortcut:U.getLabel("PASTE"),action:()=>s.pasteSelection()},{id:"flip-h",label:"Transform: Flip Linen Horizontally",shortcut:U.getLabel("FLIP_H"),action:()=>s.flipLinen("horizontal")},{id:"flip-v",label:"Transform: Flip Linen Vertically",shortcut:U.getLabel("FLIP_V"),action:()=>s.flipLinen("vertical")},{id:"rotate-linen",label:"Transform: Rotate Linen 90Â° Clockwise",shortcut:U.getLabel("ROTATE"),action:()=>s.rotateLinen()},{id:"open-codex",label:"Help: Open The Artisan's Codex (User Guide)",shortcut:U.getLabel("OPEN_CODEX"),action:()=>s.showArtisanCodex=!0},{id:"open-shortcuts",label:"Help: Show Quick Shortcut Guide",shortcut:U.getLabel("OPEN_HELP"),action:()=>s.showArtisanGuide=!0}];let n=Q(()=>r.filter(I=>I.label.toLowerCase().includes(d(i).toLowerCase())));ye(()=>{d(i),y(a,0)}),ye(()=>{d(a),d(n);const I=document.querySelector(".artisan-action-btn.active");I&&I.scrollIntoView({block:"nearest"})});function l(I){I.key==="ArrowDown"?(I.preventDefault(),y(a,(d(a)+1)%d(n).length)):I.key==="ArrowUp"?(I.preventDefault(),y(a,(d(a)-1+d(n).length)%d(n).length)):I.key==="Enter"?(I.preventDefault(),d(n)[d(a)]&&(d(n)[d(a)].action(),t()())):I.key==="Escape"&&t()()}Ke(()=>document.getElementById("catalog-search")?.focus()),ye(()=>(Le(()=>s.pushEscapeAction(t())),()=>s.popEscapeAction(t())));var c=wr();c.__mousedown=I=>I.target===I.currentTarget&&t()(),c.__keydown=l;var u=p(c),f=p(u),x=h(p(f),2);de(x),v(f);var g=h(f,2),A=p(g);{var C=I=>{var S=yr(),M=p(S);v(S),F(()=>B(M,`No patterns found for "${d(i)??""}"`)),_(I,S)},w=I=>{var S=_r();re(S,21,()=>d(n),oe,(M,P,O)=>{{let j=Q(()=>d(a)===O);Ar(M,{get action(){return d(P)},get isSelected(){return d(j)},onSelect:()=>y(a,O,!0)})}}),v(S),_(I,S)};R(A,I=>{d(n).length===0?I(C):I(w,!1)})}v(g);var b=h(g,2),m=h(p(b),2),E=p(m);v(m),v(b),v(u),v(c),F(()=>B(E,`${d(n).length??""} Actions Available`)),ue(x,()=>d(i),I=>y(i,I)),ne(3,u,()=>He,()=>({duration:150,start:.98})),_(o,c),K()}le(["mousedown","keydown"]);var Sr=T('<span class="text-3xl"> </span>'),Ir=T('<span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30"> </span>'),Cr=T('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/20 backdrop-blur-sm"><div class="flex flex-col gap-8 overflow-hidden rounded-xl border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between border-b border-studio-text/5 pb-6"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand"> </h2> <!></div></div> <button class="rounded-xl border border-black/5 bg-white/50 px-4 py-2 text-[10px] font-bold tracking-widest uppercase opacity-40 transition-all hover:opacity-100">Close</button></div> <div><!></div></div></div>');function Oe(o,e){H(e,!0);let t=J(e,"title",3,""),i=J(e,"subtitle",3,""),a=J(e,"icon",3,""),r=J(e,"width",3,"500px"),n=J(e,"maxHeight",3,"85vh"),l=J(e,"scrollable",3,!0);ye(()=>(Le(()=>{s.pushEscapeAction(e.onClose)}),()=>s.popEscapeAction(e.onClose)));var c=Cr();c.__mousedown=P=>P.target===P.currentTarget&&e.onClose();var u=p(c),f=p(u),x=p(f),g=p(x);{var A=P=>{var O=Sr(),j=p(O,!0);v(O),F(()=>B(j,a())),_(P,O)};R(g,P=>{a()&&P(A)})}var C=h(g,2),w=p(C),b=p(w,!0);v(w);var m=h(w,2);{var E=P=>{var O=Ir(),j=p(O,!0);v(O),F(()=>B(j,i())),_(P,O)};R(m,P=>{i()&&P(E)})}v(C),v(x);var I=h(x,2);I.__click=function(...P){e.onClose?.apply(this,P)},v(f);var S=h(f,2),M=p(S);Si(M,()=>e.children),v(S),v(u),v(c),F(()=>{Z(u,`width: ${r()??""}; max-height: ${n()??""};`),B(b,t()),z(S,1,`custom-scrollbar flex-1 ${l()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),ne(1,u,()=>He,()=>({duration:200,start:.95})),ne(2,u,()=>He,()=>({duration:150,start:1,opacity:0})),ne(3,c,()=>_e,()=>({duration:150})),_(o,c),K()}le(["mousedown","click"]);var Tr=T('<div class="flex flex-col items-center gap-3"><div class="artisan-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function kr(o,e){H(e,!0);let t=L(null);ye(()=>{if(!d(t))return;const x=d(t).getContext("2d");if(!x)return;const g=s.linen.width,A=s.linen.height,C=s.linen.compositeStitches,w=400,b=Math.min(w/g,w/A);d(t).width=g*b,d(t).height=A*b,x.imageSmoothingEnabled=!1,e.bgColor==="transparent"?x.clearRect(0,0,d(t).width,d(t).height):(x.fillStyle=e.bgColor,x.fillRect(0,0,d(t).width,d(t).height)),C.forEach((m,E)=>{if(m===null)return;const I=E%g,S=Math.floor(E/g);x.fillStyle=m,x.fillRect(Math.floor(I*b),Math.floor(S*b),Math.ceil(b),Math.ceil(b))})});var i=Tr(),a=p(i),r=p(a);_i(r,x=>y(t,x),()=>d(t)),v(a);var n=h(a,2),l=p(n),c=p(l);v(l);var u=h(l,2),f=p(u);v(u),v(n),v(i),F((x,g)=>{B(c,`${e.format??""} Artifact`),B(f,`${x??""} Ã ${g??""} pixels`)},[()=>Math.round(s.linen.width*e.scale),()=>Math.round(s.linen.height*e.scale)]),_(o,i),K()}var Lr=T('<span class="font-serif text-[9px] font-bold text-brand italic opacity-60">Requires multiple frames</span>'),Pr=T('<div class="h-px w-full bg-black/5"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Kinetic Pace (FPS)</span> <span class="font-serif text-[10px] opacity-40">Frames per second</span></div> <input type="number" min="1" max="60" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg focus:outline-none"/></div>',1),Vr=T('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span>ð¨</span> Match Linen Backdrop</button>'),Fr=T('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-8 overflow-y-auto pr-4"><div class="flex flex-col gap-3"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30">Static Stitches</span> <div class="grid grid-cols-2 gap-3"><button><span class="text-2xl">ð¼ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">Raster PNG</h3></div></button> <button><span class="text-2xl">ð¸ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">WebP</h3></div></button> <button><span class="text-2xl">ð·</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">JPG</h3></div></button> <button><span class="text-2xl">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">Vector SVG</h3></div></button></div></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30">Kinetic Weaves</span> <!></div> <div><button><span class="text-2xl">ð¬</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">Video WebM</h3></div></button> <button><span class="text-2xl">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">Animated GIF</h3></div></button> <button><span class="text-2xl">ð½ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">Video MP4</h3></div></button> <button><span class="text-2xl">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase">Animated SVG</h3></div></button></div></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Artifact Scale</span> <span class="font-serif text-[10px] opacity-40">Multiplier for raster output size</span></div> <input type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg focus:outline-none"/></div> <!> <div class="h-px w-full bg-black/5"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Background</span> <span class="font-serif text-[10px] opacity-40">Fill empty stitches with color</span></div> <div class="flex flex-wrap items-center gap-3"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" title="Transparent"></button> <button title="Studio Cream"></button> <button title="Deep Black"></button> <div class="flex items-center gap-2"><button title="Custom Backdrop"></button></div></div> <!></div></div> <button class="artisan-primary-btn w-full py-5 text-xl">Weave & Export Artifact</button></div></div>'),Mr=T("<!> <!>",1);function Or(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.showArtifactCrate=!1),i=L("png"),a=L(!1),r=L(pe(s.studio.canvasBgColor));Ke(()=>{s.studio.canvasBgColor!=="#eee8d5"&&(s.studio.exportBgColor=s.studio.canvasBgColor,y(r,s.studio.canvasBgColor,!0))}),ye(()=>{s.studio.exportBgColor!=="transparent"&&s.studio.exportBgColor!=="#eee8d5"&&s.studio.exportBgColor!=="#000000"&&(s.studio.exportBgColor=d(r))}),ye(()=>{const f=["webm","gif","mp4"].includes(d(i))||d(i)==="svg"&&s.project.frames.length>1;s.project.frames.length<=1&&f&&y(i,"png")});var n=Mr(),l=ae(n);{var c=f=>{xt(f,{onClose:()=>y(a,!1),get value(){return d(r)},set value(x){y(r,x,!0)}})};R(l,f=>{d(a)&&f(c)})}var u=h(l,2);Oe(u,{title:"Artifact Crate",subtitle:"Prepare Artifacts for Export",icon:"ð§º",get onClose(){return t()},width:"1000px",scrollable:!1,children:(f,x)=>{var g=Fr(),A=p(g),C=p(A);kr(C,{get format(){return d(i)},get scale(){return s.studio.exportScale},get bgColor(){return s.studio.exportBgColor}}),v(A);var w=h(A,2),b=p(w),m=h(p(b),2),E=p(m);E.__click=()=>y(i,"png");var I=h(E,2);I.__click=()=>y(i,"webp");var S=h(I,2);S.__click=()=>y(i,"jpg");var M=h(S,2);M.__click=()=>y(i,"svg"),v(m),v(b);var P=h(b,2),O=p(P),j=h(p(O),2);{var V=ge=>{var Me=Lr();_(ge,Me)};R(j,ge=>{s.project.frames.length<=1&&ge(V)})}v(O);var D=h(O,2),X=p(D);X.__click=()=>y(i,"webm");var ee=h(X,2);ee.__click=()=>y(i,"gif");var te=h(ee,2);te.__click=()=>y(i,"mp4");var Y=h(te,2);Y.__click=()=>y(i,"svg"),v(D),v(P);var N=h(P,2),he=p(N),fe=h(p(he),2);de(fe),v(he);var Te=h(he,2);{var De=ge=>{var Me=Pr(),bt=h(ae(Me),2),mt=h(p(bt),2);de(mt),v(bt),ue(mt,()=>s.studio.fps,Bt=>s.studio.fps=Bt),_(ge,Me)};R(Te,ge=>{(d(i)==="webm"||d(i)==="gif"||d(i)==="mp4"||d(i)==="svg"&&s.project.frames.length>1)&&ge(De)})}var Pe=h(Te,4),ie=h(p(Pe),2),we=p(ie);we.__click=()=>s.studio.exportBgColor="transparent";var Ve=h(we,2);Ve.__click=()=>s.studio.exportBgColor="#eee8d5";var q=h(Ve,2);q.__click=()=>s.studio.exportBgColor="#000000";var Fe=h(q,2),Be=p(Fe);Be.__click=()=>{y(r,d(r),!0),s.studio.exportBgColor=d(r),y(a,!0)},v(Fe),v(ie);var Ot=h(ie,2);{var Dt=ge=>{var Me=Vr();Me.__click=()=>{y(r,s.studio.canvasBgColor,!0),s.studio.exportBgColor=d(r)},_(ge,Me)};R(Ot,ge=>{s.studio.canvasBgColor!=="#eee8d5"&&ge(Dt)})}v(Pe),v(N);var Nt=h(N,2);Nt.__click=()=>e.onExport(d(i),s.studio.exportScale,s.studio.exportBgColor),v(w),v(g),F(()=>{z(E,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),z(I,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="webp"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),z(S,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="jpg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),z(M,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="svg"&&s.project.frames.length<=1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),z(D,1,`grid grid-cols-2 gap-3 ${s.project.frames.length<=1?"opacity-40":""}`),z(X,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="webm"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${s.project.frames.length<=1?"pointer-events-none opacity-20":""}`),X.disabled=s.project.frames.length<=1,z(ee,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="gif"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${s.project.frames.length<=1?"pointer-events-none opacity-20":""}`),ee.disabled=s.project.frames.length<=1,z(te,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="mp4"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${s.project.frames.length<=1?"pointer-events-none opacity-20":""}`),te.disabled=s.project.frames.length<=1,z(Y,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="svg"&&s.project.frames.length>1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${s.project.frames.length<=1?"pointer-events-none opacity-20":""}`),Y.disabled=s.project.frames.length<=1,z(we,1,`h-10 w-10 rounded-xl border-2 ${s.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),z(Ve,1,`h-10 w-10 rounded-xl border-2 ${s.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),z(q,1,`h-10 w-10 rounded-xl border-2 ${s.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),z(Be,1,`h-10 w-16 rounded-xl border-2 ${s.studio.exportBgColor===d(r)?"border-brand":"border-black/5"} artisan-checker-small transition-transform hover:scale-105`),Z(Be,`background-color: ${d(r)??""};`)}),ue(fe,()=>s.studio.exportScale,ge=>s.studio.exportScale=ge),_(f,g)},$$slots:{default:!0}}),_(o,n),K()}le(["click"]);var Dr=T('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function Nr(o,e){H(e,!0);var t=Dr(),i=p(t),a=p(i,!0);v(i);var r=h(i,2),n=p(r,!0);v(r),v(t),F(l=>{B(a,e.label),B(n,l)},[()=>U.getLabel(e.intent)]),_(o,t),K()}var Br=T('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function jr(o,e){H(e,!0);var t=Br(),i=p(t),a=p(i,!0);v(i);var r=h(i,2);re(r,21,()=>e.group.items,oe,(n,l)=>{Nr(n,{get intent(){return d(l).intent},get label(){return d(l).label}})}),v(r),v(t),F(()=>B(a,e.group.group)),_(o,t),K()}var Rr=T('<div class="grid grid-cols-1 gap-8"></div>');function Gr(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.studio.showArtisanGuide=!1);const i=[{group:"Navigation & Looming",items:[{intent:"MOVE_UP",label:"Move Needle"},{intent:"GOTO",label:"Go to Coordinate"},{intent:"FLOW_SELECT",label:"Block Selection (Hold)"},{intent:"BIND_VERTEX",label:"Binding Thread (Add Point)"},{intent:"SEAL_BINDING",label:"Seal Binding (Select area)"},{intent:"ESCAPE",label:"Clear Selection / Dismiss"}]},{group:"Digital Stitching",items:[{intent:"STITCH",label:"Stitch (Color Cell)"},{intent:"UNSTITCH",label:"Unstitch (Clear Cell)"},{intent:"FLOW_STITCH",label:"Continuous Threading (Hold)"},{intent:"FLOW_UNSTITCH",label:"Continuous Unravelling (Hold)"},{intent:"PICK_DYE",label:"Pick Dye from Linen"}]},{group:"History & Studio",items:[{intent:"UNDO",label:"Undo Last Stitch"},{intent:"REDO",label:"Redo Last Stitch"},{intent:"OPEN_PALETTE",label:"Open Pattern Catalog"},{intent:"OPEN_EXPORT",label:"Export Artifact Crate"},{intent:"OPEN_SETTINGS",label:"Linen Settings"}]},{group:"Folio & Veils",items:[{intent:"NEXT_FRAME",label:"Next Frame (Turn Page)"},{intent:"DUPLICATE_FRAME",label:"Duplicate Frame"},{intent:"NEW_VEIL",label:"Add New Veil"},{intent:"MOVE_VEIL_UP",label:"Move Veil Up"},{intent:"MOVE_VEIL_DOWN",label:"Move Veil Down"},{intent:"PLAY_PULSE",label:"Kinetic: Toggle Playback"},{intent:"TOGGLE_VEIL_VISIBILITY",label:"Show/Hide Veil"}]}];Oe(o,{title:"Artisan's Guide",subtitle:"Mastering the Digital Loom",icon:"ð",get onClose(){return t()},width:"600px",children:(a,r)=>{var n=Rr();re(n,21,()=>i,oe,(l,c)=>{jr(l,{get group(){return d(c)}})}),v(n),_(a,n)},$$slots:{default:!0}}),K()}var Ur=T(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Pattern Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your work as a dedicated file on your machine or in your browser's archive.</p></div> <div class="flex flex-col gap-3"><button class="artisan-primary-btn w-full">Archive to Pattern Book</button> <button class="artisan-secondary-btn w-full">Restore from Pattern Book</button></div></div>`);function $r(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.studio.showArchivePattern=!1);Oe(o,{title:"Archive Pattern",subtitle:"Preserving Digital Stitches",icon:"ð¾",get onClose(){return t()},width:"400px",children:(i,a)=>{var r=Ur(),n=h(p(r),2),l=p(n);l.__click=()=>{k.persistence.save(),t()()};var c=h(l,2);c.__click=()=>{k.persistence.load(),t()()},v(n),v(r),_(i,r)},$$slots:{default:!0}}),K()}le(["click"]);var Hr=T(`<div class="flex flex-col gap-8"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-2"><label for="project-name" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Project Name</label> <input id="project-name" type="text" placeholder="Unnamed Pattern" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-serif text-lg focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5"></div> <div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Width</label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Height</label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Weave Pace (FPS)</span> <span class="font-serif text-[10px] opacity-40">Default frames per second</span></div> <div class="flex items-center gap-3"><input type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Linen Backdrop</span> <span class="font-serif text-[10px] opacity-40">Visual background color</span></div> <button class="group relative flex items-center gap-3"><div class="artisan-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">ð¨</div></button></div> <p class="font-serif text-[10px] leading-relaxed italic opacity-40">Note: Resizing will center your current work on the new frame. Large dimensions may affect
				performance in certain environments.</p></div> <button class="artisan-primary-btn w-full py-4 text-lg">Re-stretch Linen</button></div>`),Kr=T("<!> <!>",1);function zr(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.studio.showLinenSettings=!1),i=L(pe(s.linen.width)),a=L(pe(s.linen.height)),r=L(!1);function n(){k.manipulation.resize(d(i),d(a)),t()()}var l=Kr(),c=ae(l);{var u=x=>{xt(x,{onClose:()=>y(r,!1),get value(){return s.studio.canvasBgColor},set value(g){s.studio.canvasBgColor=g}})};R(c,x=>{d(r)&&x(u)})}var f=h(c,2);Oe(f,{title:"Linen Settings",subtitle:"Configure the Weaver's Frame",icon:"ð",get onClose(){return t()},width:"450px",children:(x,g)=>{var A=Hr(),C=p(A),w=p(C),b=h(p(w),2);de(b),v(w);var m=h(w,4),E=p(m),I=h(p(E),2);de(I),v(E);var S=h(E,2),M=h(p(S),2);de(M),v(S),v(m);var P=h(m,4),O=h(p(P),2),j=p(O);de(j),v(O),v(P);var V=h(P,4),D=h(p(V),2);D.__click=()=>y(r,!0);var X=p(D);Ce(2),v(D),v(V),Ce(2),v(C);var ee=h(C,2);ee.__click=n,v(A),F(()=>Z(X,`background-color: ${s.studio.canvasBgColor??""};`)),ue(b,()=>s.project.name,te=>s.project.name=te),ue(I,()=>d(i),te=>y(i,te)),ue(M,()=>d(a),te=>y(a,te)),ue(j,()=>s.studio.fps,te=>s.studio.fps=te),_(x,A)},$$slots:{default:!0}}),_(o,l),K()}le(["click"]);var Wr=T('<div class="flex flex-col gap-8"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Cartesian X</label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Cartesian Y</label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed italic opacity-40"> </p></div> <button class="artisan-primary-btn w-full py-4 text-lg">Move Needle</button></div>');function Qr(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.studio.showGoTo=!1),i=L(pe(s.displayCoords.x)),a=L(pe(s.displayCoords.y));function r(){k.jumpTo(d(i),d(a)),t()()}function n(l){l.key==="Enter"&&r()}Ke(()=>{document.getElementById("goto-x")?.focus()}),Oe(o,{title:"Go To Coordinate",subtitle:"Direct Needle Placement",icon:"ð",get onClose(){return t()},width:"400px",children:(l,c)=>{var u=Wr(),f=p(u),x=p(f),g=p(x),A=h(p(g),2);de(A),A.__keydown=n,v(g);var C=h(g,2),w=h(p(C),2);de(w),w.__keydown=n,v(C),v(x);var b=h(x,2),m=p(b);v(b),v(f);var E=h(f,2);E.__click=r,v(u),F(()=>B(m,`Current Position: ${s.displayCoords.x??""}, ${s.displayCoords.y??""}`)),ue(A,()=>d(i),I=>y(i,I)),ue(w,()=>d(a),I=>y(a,I)),_(l,u)},$$slots:{default:!0}}),K()}le(["keydown","click"]);var Xr=T('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all studio resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Stitch Resonance (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Atmosphere Protocol</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="artisan-primary-btn w-full py-4">Seal Settings</button></div>');function Yr(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.studio.showAudioBasin=!1);ye(()=>(Le(()=>s.pushEscapeAction(t())),()=>s.popEscapeAction(t()))),Oe(o,{title:"Audio Basin",subtitle:"Harmony & Atmosphere Tuning",icon:"ð",get onClose(){return t()},width:"450px",children:(i,a)=>{var r=Xr(),n=p(r),l=h(p(n),2);l.__click=()=>s.toggleMute();var c=p(l,!0);v(l),v(n);var u=h(n,2),f=p(u),x=p(f),g=h(p(x),2),A=p(g);v(g),v(x);var C=h(x,2);de(C),v(f);var w=h(f,2),b=p(w),m=h(p(b),2),E=p(m);v(m),v(b);var I=h(b,2);de(I),v(w),v(u);var S=h(u,2),M=h(p(S),2),P=p(M),O=h(p(P),2),j=p(O);v(O),v(P);var V=h(P,2),D=p(V);{var X=Y=>{var N=Ue(`The piano awaits in silence. It will begin to weave its melody after 30 minutes of
						artisanry.`);_(Y,N)},ee=Y=>{var N=Ue("The piano has begun its weave. Volume will reach full depth at 60 minutes.");_(Y,N)};R(D,Y=>{s.usageMinutes<30?Y(X):Y(ee,!1)})}v(V),v(M),v(S);var te=h(S,2);te.__click=function(...Y){t()?.apply(this,Y)},v(r),F((Y,N)=>{z(l,1,`artisan-secondary-btn !px-6 !py-2 ${s.isMuted?"bg-brand text-white":""}`),B(c,s.isMuted?"ð Muted":"ð Active"),B(A,`${Y??""}%`),B(E,`${N??""}%`),B(j,`${s.usageMinutes??""} minutes`)},[()=>Math.round(s.sfxVolume*100),()=>Math.round(s.bgmVolume*100)]),ue(C,()=>s.sfxVolume,Y=>s.sfxVolume=Y),ue(I,()=>s.bgmVolume,Y=>s.bgmVolume=Y),_(i,r)},$$slots:{default:!0}}),K()}le(["click"]);var qr=T(`<div class="flex flex-col gap-10"><section class="flex flex-col gap-4"><h3 class="font-tiny5 text-2xl text-brand">The Path of Rupa</h3> <p class="font-serif text-lg leading-relaxed italic opacity-70">"Every stitch is a decision, every motif a story."</p> <p class="font-serif text-sm leading-relaxed opacity-60">Welcome, Artisan. Rupa is a meditative space for pixel craftsmanship. Unlike traditional
				editors, Rupa is designed to be played like an instrument, where your fingers dance across
				the keys to weave digital linen into intricate patterns.</p></section> <div class="grid grid-cols-2 gap-8"><div class="rounded-2xl border border-black/5 bg-black/5 p-6"><h4 class="font-tiny5 mb-3 text-lg text-brand">The Linen & Needle</h4> <p class="font-serif text-xs leading-relaxed opacity-60">The <strong>Linen</strong> is your canvasâa digital fabric awaiting your touch. The <strong>Needle</strong> is your focus, the precise point where dye meets fiber. Move the needle
					with rhythmic grace using your arrow keys.</p></div> <div class="rounded-2xl border border-black/5 bg-black/5 p-6"><h4 class="font-tiny5 mb-3 text-lg text-brand">Dyes & Stitches</h4> <p class="font-serif text-xs leading-relaxed opacity-60">A <strong>Stitch</strong> is a single unit of color. Apply <strong>Dyes</strong> using the Space
					bar. Select your threads using the number keys (1-0), each resonating with its own musical note.</p></div></div> <section class="flex flex-col gap-6"><h3 class="font-tiny5 text-2xl text-brand">Advanced Weaving</h3> <div class="flex flex-col gap-4"><div class="flex gap-6"><div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-brand/10 text-xl">ð§µ</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold uppercase opacity-80">Continuous Threading</span> <p class="font-serif text-xs leading-relaxed opacity-60">Hold <strong>Control</strong> while moving to pull a continuous line of dye. Combine
							with <strong>Shift</strong> to unravel (erase) as you move.</p></div></div> <div class="flex gap-6"><div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-brand/10 text-xl">ð¸ï¸</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold uppercase opacity-80">The Active Loom (Selection)</span> <p class="font-serif text-xs leading-relaxed opacity-60">Hold <strong>Shift</strong> to define an area. Once loomed, you can fill the region
							with Space, or use <strong>Ctrl+C/X/V</strong> to capture and place swatches of your work.</p></div></div> <div class="flex gap-6"><div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-brand/10 text-xl">ð¹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold uppercase opacity-80">Atmosphere Protocol</span> <p class="font-serif text-xs leading-relaxed opacity-60">The studio rewards focus. Silence reigns for the first 30 minutes, after which the
							Piano begins to weave its melody, reaching full resonance after an hour of creation.</p></div></div> <div class="flex gap-6"><div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-brand/10 text-xl">ð¬</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold uppercase opacity-80">Kinetic Mode (Motion)</span> <p class="font-serif text-xs leading-relaxed opacity-60">Breath life into your motifs using <strong>The Spindle</strong> (Timeline). Create
							multiple frames, adjust their pace, and press <strong>P</strong> to witness the pulse of
							your creation. Export your work as WebM or Animated SVG artifacts.</p></div></div></div></section> <footer class="flex flex-col items-center gap-4 border-t border-black/5 pt-8 text-center"><p class="font-serif text-xs italic opacity-40">"May your stitches be true and your colors ever-vivid."</p> <div class="flex items-center gap-4"><button class="artisan-secondary-btn px-8">View Quick Shortcuts</button> <button class="artisan-primary-btn px-12">Begin the Weave</button></div></footer></div>`);function Zr(o,e){H(e,!0);let t=J(e,"onClose",3,()=>s.showArtisanCodex=!1);Oe(o,{title:"The Artisan's Codex",subtitle:"The Sacred Scroll of Digital Weaving",icon:"ð",get onClose(){return t()},width:"800px",children:(i,a)=>{var r=qr(),n=h(p(r),6),l=h(p(n),2),c=p(l);c.__click=()=>{t()(),s.showArtisanGuide=!0};var u=h(c,2);u.__click=function(...f){t()?.apply(this,f)},v(l),v(n),v(r),_(i,r)},$$slots:{default:!0}}),K()}le(["click"]);var W=Je(()=>s),Jr=T('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg"><!> <div class="flex flex-1 overflow-hidden"><!> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20 p-6"><div class="artisan-frame flex h-full w-full items-center justify-center overflow-hidden shadow-2xl"><!></div></main> <!></div> <!></div>',1);function cn(o,e){H(e,!1),Ke(()=>Cs.mount()),ce();var t=Jr(),i=ae(t);fr(i,{});var a=h(i,2);{var r=N=>{Gr(N,{onClose:()=>W(W().studio.showArtisanGuide=!1)})};R(a,N=>{W().studio.showArtisanGuide&&N(r)})}var n=h(a,2);{var l=N=>{Er(N,{onClose:()=>W(W().studio.showPatternCatalog=!1)})};R(n,N=>{W().studio.showPatternCatalog&&N(l)})}var c=h(n,2);{var u=N=>{xt(N,{onClose:()=>W(W().studio.showDyeBasin=!1),get value(){return W().paletteState.activeDye},set value(he){W(W().paletteState.activeDye=he)},$$legacy:!0})};R(c,N=>{W().studio.showDyeBasin&&N(u)})}var f=h(c,2);{var x=N=>{Or(N,{onExport:(he,fe,Te)=>k.createArtifact(he,fe,Te),onClose:()=>W(W().studio.showArtifactCrate=!1)})};R(f,N=>{W().studio.showArtifactCrate&&N(x)})}var g=h(f,2);{var A=N=>{$r(N,{onClose:()=>W(W().studio.showArchivePattern=!1)})};R(g,N=>{W().studio.showArchivePattern&&N(A)})}var C=h(g,2);{var w=N=>{zr(N,{onClose:()=>W(W().studio.showLinenSettings=!1)})};R(C,N=>{W().studio.showLinenSettings&&N(w)})}var b=h(C,2);{var m=N=>{Qr(N,{onClose:()=>W(W().studio.showGoTo=!1)})};R(b,N=>{W().studio.showGoTo&&N(m)})}var E=h(b,2);{var I=N=>{Yr(N,{onClose:()=>W(W().studio.showAudioBasin=!1)})};R(E,N=>{W().studio.showAudioBasin&&N(I)})}var S=h(E,2);{var M=N=>{Zr(N,{onClose:()=>W(W().studio.showArtisanCodex=!1)})};R(S,N=>{W().studio.showArtisanCodex&&N(M)})}var P=h(S,2),O=p(P);js(O);var j=h(O,2),V=p(j);qs(V);var D=h(V,2),X=p(D),ee=p(X);vr(ee,{}),v(X),v(D);var te=h(D,2);la(te),v(j);var Y=h(j,2);za(Y),v(P),_(o,t),K()}export{cn as component};
