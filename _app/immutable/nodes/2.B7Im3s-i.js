import{a as A,f as H,c as Bt,t as ne}from"../chunks/CLseDEmt.js";import{o as Kt}from"../chunks/Cd5709zn.js";import{a as qt,C as Te,aJ as ge,h as tt,I as Zt,a0 as Pe,D as Me,l,F as Ae,H as Le,G as le,J as Yt,e as Wt,aa as Ie,aC as De,am as ce,c as Pt,aK as vt,b as ee,aL as Oe,s as Re,Z as J,aM as Ne,aA as ae,aN as $e,aO as He,aF as Be,a8 as de,aP as Ue,r as me,p as be,aQ as Xt,M as oe,aR as ze,aS as We,az as Fe,d as Ge,aw as Ve,U as Ke,aT as je,aU as qe,aV as It,aW as ye,E as Ze,aX as Ye,a4 as Xe,K as Qe,i as _e,aY as Je,aZ as tr,a_ as er,a$ as rr,b0 as ir,b1 as sr,b2 as ar,b3 as or,aG as nr,L as lr,b4 as cr,aH as M,R as C,Q as Qt,aI as Rt,v as yt,u as dr,g as mt,z as v,A as u,B as m,an as Mt,x as V,y as _t,w as bt}from"../chunks/ClKGAJqY.js";import{a as ur,d as Ut,s as j}from"../chunks/D2bzQBHB.js";import{p as ue,i as K,b as ve}from"../chunks/MBgeh8xQ.js";import{i as we}from"../chunks/BjYH4rt5.js";function nt(e,t){return t}function vr(e,t,r){for(var o=[],a=t.length,n,s=t.length,c=0;c<a;c++){let _=t[c];be(_,()=>{if(n){if(n.pending.delete(_),n.done.add(_),n.pending.size===0){var x=e.outrogroups;re(ae(n.done)),x.delete(n),x.size===0&&(e.outrogroups=null)}}else s-=1},!1)}if(s===0){var p=o.length===0&&r!==null;if(p){var f=r,h=f.parentNode;Fe(h),h.append(f),e.items.clear()}re(t,!p)}else n={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(n)}function re(e,t=!0){for(var r=0;r<e.length;r++)Ge(e[r],t)}var fe;function lt(e,t,r,o,a,n=null){var s=e,c=new Map,p=(t&ge)!==0;if(p){var f=e;s=tt?Zt(Pe(f)):f.appendChild(qt())}tt&&Me();var h=null,_=J(()=>{var y=r();return Ne(y)?y:y==null?[]:ae(y)}),x,b=!0;function E(){d.fallback=h,fr(d,x,s,t,o),h!==null&&(x.length===0?(h.f&vt)===0?me(h):(h.f^=vt,Nt(h,null,s)):be(h,()=>{h=null}))}var w=Te(()=>{x=l(_);var y=x.length;let P=!1;if(tt){var O=Ae(s)===Le;O!==(y===0)&&(s=le(),Zt(s),Yt(!1),P=!0)}for(var k=new Set,L=Pt,B=Re(),I=0;I<y;I+=1){tt&&Wt.nodeType===Ie&&Wt.data===De&&(s=Wt,P=!0,Yt(!1));var U=x[I],z=o(U,I),D=b?null:c.get(z);D?(D.v&&ce(D.v,U),D.i&&ce(D.i,I),B&&L.unskip_effect(D.e)):(D=pr(c,b?s:fe??=qt(),U,z,I,a,t,r),b||(D.e.f|=vt),c.set(z,D)),k.add(z)}if(y===0&&n&&!h&&(b?h=ee(()=>n(s)):(h=ee(()=>n(fe??=qt())),h.f|=vt)),y>k.size&&Oe(),tt&&y>0&&Zt(le()),!b)if(B){for(const[q,et]of c)k.has(q)||L.skip_effect(et.e);L.oncommit(E),L.ondiscard(()=>{})}else E();P&&Yt(!0),l(_)}),d={effect:w,items:c,outrogroups:null,fallback:h};b=!1,tt&&(s=Wt)}function Dt(e){for(;e!==null&&(e.f&ze)===0;)e=e.next;return e}function fr(e,t,r,o,a){var n=(o&We)!==0,s=t.length,c=e.items,p=Dt(e.effect.first),f,h=null,_,x=[],b=[],E,w,d,y;if(n)for(y=0;y<s;y+=1)E=t[y],w=a(E,y),d=c.get(w).e,(d.f&vt)===0&&(d.nodes?.a?.measure(),(_??=new Set).add(d));for(y=0;y<s;y+=1){if(E=t[y],w=a(E,y),d=c.get(w).e,e.outrogroups!==null)for(const D of e.outrogroups)D.pending.delete(d),D.done.delete(d);if((d.f&vt)!==0)if(d.f^=vt,d===p)Nt(d,null,r);else{var P=h?h.next:p;d===e.effect.last&&(e.effect.last=d.prev),d.prev&&(d.prev.next=d.next),d.next&&(d.next.prev=d.prev),ht(e,h,d),ht(e,d,P),Nt(d,P,r),h=d,x=[],b=[],p=Dt(h.next);continue}if((d.f&Xt)!==0&&(me(d),n&&(d.nodes?.a?.unfix(),(_??=new Set).delete(d))),d!==p){if(f!==void 0&&f.has(d)){if(x.length<b.length){var O=b[0],k;h=O.prev;var L=x[0],B=x[x.length-1];for(k=0;k<x.length;k+=1)Nt(x[k],O,r);for(k=0;k<b.length;k+=1)f.delete(b[k]);ht(e,L.prev,B.next),ht(e,h,L),ht(e,B,O),p=O,h=B,y-=1,x=[],b=[]}else f.delete(d),Nt(d,p,r),ht(e,d.prev,d.next),ht(e,d,h===null?e.effect.first:h.next),ht(e,h,d),h=d;continue}for(x=[],b=[];p!==null&&p!==d;)(f??=new Set).add(p),b.push(p),p=Dt(p.next);if(p===null)continue}(d.f&vt)===0&&x.push(d),h=d,p=Dt(d.next)}if(e.outrogroups!==null){for(const D of e.outrogroups)D.pending.size===0&&(re(ae(D.done)),e.outrogroups?.delete(D));e.outrogroups.size===0&&(e.outrogroups=null)}if(p!==null||f!==void 0){var I=[];if(f!==void 0)for(d of f)(d.f&Xt)===0&&I.push(d);for(;p!==null;)(p.f&Xt)===0&&p!==e.fallback&&I.push(p),p=Dt(p.next);var U=I.length;if(U>0){var z=(o&ge)!==0&&s===0?r:null;if(n){for(y=0;y<U;y+=1)I[y].nodes?.a?.measure();for(y=0;y<U;y+=1)I[y].nodes?.a?.fix()}vr(e,I,z)}}n&&oe(()=>{if(_!==void 0)for(d of _)d.nodes?.a?.apply()})}function pr(e,t,r,o,a,n,s,c){var p=(s&$e)!==0?(s&He)===0?Be(r,!1,!1):de(r):null,f=(s&Ue)!==0?de(a):null;return{v:p,i:f,e:ee(()=>(n(t,p??r,f??a,c),()=>{e.delete(o)}))}}function Nt(e,t,r){if(e.nodes)for(var o=e.nodes.start,a=e.nodes.end,n=t&&(t.f&vt)===0?t.nodes.start:r;o!==null;){var s=Ve(o);if(n.before(o),o===a)return;o=s}}function ht(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}const hr=()=>performance.now(),ut={tick:e=>requestAnimationFrame(e),now:()=>hr(),tasks:new Set};function ke(){const e=ut.now();ut.tasks.forEach(t=>{t.c(e)||(ut.tasks.delete(t),t.f())}),ut.tasks.size!==0&&ut.tick(ke)}function xr(e){let t;return ut.tasks.size===0&&ut.tick(ke),{promise:new Promise(r=>{ut.tasks.add(t={c:e,f:r})}),abort(){ut.tasks.delete(t)}}}function Gt(e,t){ye(()=>{e.dispatchEvent(new CustomEvent(t))})}function gr(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function pe(e){const t={},r=e.split(";");for(const o of r){const[a,n]=o.split(":");if(!a||n===void 0)break;const s=gr(a.trim());t[s]=n.trim()}return t}const mr=e=>e;function $t(e,t,r,o){var a=(e&Je)!==0,n=(e&tr)!==0,s=a&&n,c=(e&je)!==0,p=s?"both":a?"in":"out",f,h=t.inert,_=t.style.overflow,x,b;function E(){return ye(()=>f??=r()(t,o?.()??{},{direction:p}))}var w={is_global:c,in(){if(t.inert=h,!a){b?.abort(),b?.reset?.();return}n||x?.abort(),x=ie(t,E(),b,1,()=>{Gt(t,"introend"),x?.abort(),x=f=void 0,t.style.overflow=_})},out(O){if(!n){O?.(),f=void 0;return}t.inert=!0,b=ie(t,E(),x,0,()=>{Gt(t,"outroend"),O?.()})},stop:()=>{x?.abort(),b?.abort()}},d=Ke;if((d.nodes.t??=[]).push(w),a&&ur){var y=c;if(!y){for(var P=d.parent;P&&(P.f&Ze)!==0;)for(;(P=P.parent)&&(P.f&Ye)===0;);y=!P||(P.f&Xe)!==0}y&&Qe(()=>{_e(()=>w.in())})}}function ie(e,t,r,o,a){var n=o===1;if(qe(t)){var s,c=!1;return oe(()=>{if(!c){var d=t({direction:n?"in":"out"});s=ie(e,d,r,o,a)}}),{abort:()=>{c=!0,s?.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(r?.deactivate(),!t?.duration&&!t?.delay)return Gt(e,n?"introstart":"outrostart"),a(),{abort:It,deactivate:It,reset:It,t:()=>o};const{delay:p=0,css:f,tick:h,easing:_=mr}=t;var x=[];if(n&&r===void 0&&(h&&h(0,1),f)){var b=pe(f(0,1));x.push(b,b)}var E=()=>1-o,w=e.animate(x,{duration:p,fill:"forwards"});return w.onfinish=()=>{w.cancel(),Gt(e,n?"introstart":"outrostart");var d=r?.t()??1-o;r?.abort();var y=o-d,P=t.duration*Math.abs(y),O=[];if(P>0){var k=!1;if(f)for(var L=Math.ceil(P/16.666666666666668),B=0;B<=L;B+=1){var I=d+y*_(B/L),U=pe(f(I,1-I));O.push(U),k||=U.overflow==="hidden"}k&&(e.style.overflow="hidden"),E=()=>{var z=w.currentTime;return d+y*_(z/P)},h&&xr(()=>{if(w.playState!=="running")return!1;var z=E();return h(z,1-z),!0})}w=e.animate(O,{duration:P,fill:"forwards"}),w.onfinish=()=>{E=()=>o,h?.(o,1-o),a()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=It)},deactivate:()=>{a=It},reset:()=>{o===0&&h?.(1,0)},t:()=>E()}}function br(e,t,r){var o=e==null?"":""+e;return t&&(o=o?o+" "+t:t),o===""?null:o}function yr(e,t){return e==null?null:String(e)}function gt(e,t,r,o,a,n){var s=e.__className;if(tt||s!==r||s===void 0){var c=br(r,o);(!tt||c!==e.getAttribute("class"))&&(c==null?e.removeAttribute("class"):e.className=c),e.__className=r}return n}function X(e,t,r,o){var a=e.__style;if(tt||a!==t){var n=yr(t);(!tt||n!==e.getAttribute("style"))&&(n==null?e.removeAttribute("style"):e.style.cssText=n),e.__style=t}return o}const _r=Symbol("is custom element"),wr=Symbol("is html");function Et(e){if(tt){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var o=e.value;Vt(e,"value",null),e.value=o}if(e.hasAttribute("checked")){var a=e.checked;Vt(e,"checked",null),e.checked=a}}};e.__on_r=r,oe(r),er()}}function Ce(e,t){var r=Ee(e);r.value===(r.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function Vt(e,t,r,o){var a=Ee(e);tt&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=r)&&(t==="loading"&&(e[rr]=r),r==null?e.removeAttribute(t):typeof r!="string"&&kr(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function Ee(e){return e.__attributes??={[_r]:e.nodeName.includes("-"),[wr]:e.namespaceURI===ir}}var he=new Map;function kr(e){var t=e.getAttribute("is")||e.nodeName,r=he.get(t);if(r)return r;he.set(t,r=[]);for(var o,a=e,n=Element.prototype;n!==a;){o=ar(a);for(var s in o)o[s].set&&r.push(s);a=sr(a)}return r}function Ht(e,t,r=t){var o=new WeakSet;or(e,"input",async a=>{var n=a?e.defaultValue:e.value;if(n=Jt(e)?te(n):n,r(n),Pt!==null&&o.add(Pt),await nr(),n!==(n=t())){var s=e.selectionStart,c=e.selectionEnd,p=e.value.length;if(e.value=n??"",c!==null){var f=e.value.length;s===c&&c===p&&f>p?(e.selectionStart=f,e.selectionEnd=f):(e.selectionStart=s,e.selectionEnd=Math.min(c,f))}}}),(tt&&e.defaultValue!==e.value||_e(t)==null&&e.value)&&(r(Jt(e)?te(e.value):e.value),Pt!==null&&o.add(Pt)),lr(()=>{var a=t();if(e===document.activeElement){var n=cr??Pt;if(o.has(n))return}Jt(e)&&a===te(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function Jt(e){var t=e.type;return t==="number"||t==="range"}function te(e){return e===""?null:+e}class Cr{ctx=null;init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}playTone(t,r,o="sine",a=.1,n=1e-4){if(this.init(),!this.ctx||i.isMuted)return;const s=this.ctx.createOscillator(),c=this.ctx.createGain();s.type=o,s.frequency.setValueAtTime(t,this.ctx.currentTime),c.gain.setValueAtTime(a,this.ctx.currentTime),c.gain.exponentialRampToValueAtTime(n,this.ctx.currentTime+r),s.connect(c),c.connect(this.ctx.destination),s.start(),s.stop(this.ctx.currentTime+r)}playMove(){this.playTone(450,.08,"sine",.15)}playStitch(){this.playTone(1200,.15,"sine",.03),setTimeout(()=>this.playTone(1500,.1,"sine",.02),50)}playUnstitch(){if(this.init(),!this.ctx||i.isMuted)return;const t=.25,r=this.ctx.sampleRate*t,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),a=o.getChannelData(0);for(let p=0;p<r;p++)a[p]=Math.random()*2-1;const n=this.ctx.createBufferSource();n.buffer=o;const s=this.ctx.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(1500,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+t);const c=this.ctx.createGain();c.gain.setValueAtTime(.1,this.ctx.currentTime),c.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+t),n.connect(s),s.connect(c),c.connect(this.ctx.destination),n.start()}}const xt=new Cr;class Er{undoStack=[];redoStack=[];maxHistory=500;push(t){t.oldColor!==t.newColor&&(this.undoStack.push(t),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift())}undo(){const t=this.undoStack.pop();return t?(this.redoStack.push(t),t):null}redo(){const t=this.redoStack.pop();return t?(this.undoStack.push(t),t):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}}const Ot=new Er;class Sr{#t=M(32);get gridWidth(){return l(this.#t)}set gridWidth(t){C(this.#t,t,!0)}#e=M(32);get gridHeight(){return l(this.#e)}set gridHeight(t){C(this.#e,t,!0)}#r=M(Qt([]));get pixelData(){return l(this.#r)}set pixelData(t){C(this.#r,t,!0)}#i=M(Qt({x:0,y:0}));get cursorPos(){return l(this.#i)}set cursorPos(t){C(this.#i,t,!0)}#s=M("#859900");get activeColor(){return l(this.#s)}set activeColor(t){C(this.#s,t,!0)}#a=M(Qt(["#859900","#2aa198","#b58900","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#93a1a1","#586e75"]));get palette(){return l(this.#a)}set palette(t){C(this.#a,t,!0)}#o=M(1);get zoomLevel(){return l(this.#o)}set zoomLevel(t){C(this.#o,t,!0)}#n=M(!1);get showColorPicker(){return l(this.#n)}set showColorPicker(t){C(this.#n,t,!0)}#l=M(!1);get showCommandPalette(){return l(this.#l)}set showCommandPalette(t){C(this.#l,t,!0)}#c=M(!1);get showHelp(){return l(this.#c)}set showHelp(t){C(this.#c,t,!0)}#d=M(10);get exportScale(){return l(this.#d)}set exportScale(t){C(this.#d,t,!0)}#u=M("transparent");get exportBgColor(){return l(this.#u)}set exportBgColor(t){C(this.#u,t,!0)}#v=M(!1);get isMuted(){return l(this.#v)}set isMuted(t){C(this.#v,t,!0)}#f=M(!1);get isPicking(){return l(this.#f)}set isPicking(t){C(this.#f,t,!0)}#p=M(!1);get isAppReady(){return l(this.#p)}set isAppReady(t){C(this.#p,t,!0)}#h=M(!0);get isCursorVisible(){return l(this.#h)}set isCursorVisible(t){C(this.#h,t,!0)}#x=M(!1);get isShiftPressed(){return l(this.#x)}set isShiftPressed(t){C(this.#x,t,!0)}#g=M(!1);get isCtrlPressed(){return l(this.#g)}set isCtrlPressed(t){C(this.#g,t,!0)}#m=M(!1);get isAltPressed(){return l(this.#m)}set isAltPressed(t){C(this.#m,t,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;#b=M(null);get selectionStart(){return l(this.#b)}set selectionStart(t){C(this.#b,t,!0)}#y=M(null);get selectionEnd(){return l(this.#y)}set selectionEnd(t){C(this.#y,t,!0)}#_=Rt(()=>this.isShiftPressed&&this.isAltPressed);get isBlockMode(){return l(this.#_)}set isBlockMode(t){C(this.#_,t)}escapeStack=[];constructor(t=32,r=32){this.gridWidth=t,this.gridHeight=r,this.pixelData=Array(t*r).fill("#eee8d5"),this.resetInactivityTimer()}resetInactivityTimer(){this.isCursorVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isCursorVisible=!1},this.INACTIVITY_TIMEOUT)}toggleMute(){this.isMuted=!this.isMuted}startSelection(){this.selectionStart={...this.cursorPos},this.selectionEnd={...this.cursorPos},this.resetInactivityTimer()}updateSelection(){this.selectionStart&&(this.selectionEnd={...this.cursorPos}),this.resetInactivityTimer()}commitSelection(){if(!this.selectionStart||!this.selectionEnd)return;const t=Math.min(this.selectionStart.x,this.selectionEnd.x),r=Math.max(this.selectionStart.x,this.selectionEnd.x),o=Math.min(this.selectionStart.y,this.selectionEnd.y),a=Math.max(this.selectionStart.y,this.selectionEnd.y);for(let n=o;n<=a;n++)for(let s=t;s<=r;s++){const c=n*this.gridWidth+s,p=this.pixelData[c];p!==this.activeColor&&(Ot.push({index:c,oldColor:p,newColor:this.activeColor}),this.pixelData[c]=this.activeColor)}xt.playStitch(),this.selectionStart=null,this.selectionEnd=null,this.resetInactivityTimer()}pushEscapeAction(t){this.escapeStack.push(t)}popEscapeAction(t){this.escapeStack=this.escapeStack.filter(r=>r!==t)}handleEscape(){const t=this.escapeStack.pop();return t?(t(),!0):!1}#w=Rt(()=>{const t=new Set;return this.pixelData.forEach(r=>{r!=="#eee8d5"&&t.add(r)}),Array.from(t)});get usedColors(){return l(this.#w)}set usedColors(t){C(this.#w,t)}#k=Rt(()=>{const t=(r,o)=>{const a=Math.floor(o/2);return o%2===0?r<a?r-a:r-a+1:r-a};return{x:t(this.cursorPos.x,this.gridWidth),y:t(this.cursorPos.y,this.gridHeight)*-1}});get displayCoords(){return l(this.#k)}set displayCoords(t){C(this.#k,t)}#C=Rt(()=>{if(this.zoomLevel<=1)return`scale(${this.zoomLevel})`;{const t=(this.cursorPos.x+.5)/this.gridWidth*100,r=(this.cursorPos.y+.5)/this.gridHeight*100,o=50-t,a=50-r;return`translate(${o}%, ${a}%) scale(${this.zoomLevel})`}});get cameraTransform(){return l(this.#C)}set cameraTransform(t){C(this.#C,t)}setZoom(t){const r=this.zoomLevel+t;this.zoomLevel=Math.max(.5,Math.min(5,Number(r.toFixed(1)))),this.resetInactivityTimer()}resetZoom(){this.zoomLevel=1,this.resetInactivityTimer()}selectPalette(t){t>=0&&t<this.palette.length&&(this.activeColor=this.palette[t]),this.resetInactivityTimer()}clearCanvas(){confirm("Are you sure you want to unravel the entire project?")&&(this.pixelData=this.pixelData.map(()=>"#eee8d5"),xt.playUnstitch()),this.resetInactivityTimer()}pickColor(){const t=this.cursorPos.y*this.gridWidth+this.cursorPos.x,r=this.pixelData[t];r!=="#eee8d5"&&(this.activeColor=r,xt.playStitch(),this.isPicking=!0,setTimeout(()=>{this.isPicking=!1},1500)),this.resetInactivityTimer()}moveCursor(t,r){const o=Math.max(0,Math.min(this.gridWidth-1,this.cursorPos.x+t)),a=Math.max(0,Math.min(this.gridHeight-1,this.cursorPos.y+r));(o!==this.cursorPos.x||a!==this.cursorPos.y)&&(this.cursorPos={x:o,y:a},xt.playMove(),this.isBlockMode?this.updateSelection():this.isShiftPressed&&this.isCtrlPressed?this.unstitch():this.isShiftPressed&&this.stitch()),this.resetInactivityTimer()}stitch(){const t=this.cursorPos.y*this.gridWidth+this.cursorPos.x,r=this.pixelData[t];r!==this.activeColor&&(Ot.push({index:t,oldColor:r,newColor:this.activeColor}),this.pixelData[t]=this.activeColor,xt.playStitch()),this.resetInactivityTimer()}unstitch(){const t=this.cursorPos.y*this.gridWidth+this.cursorPos.x,r=this.pixelData[t],o="#eee8d5";r!==o&&(Ot.push({index:t,oldColor:r,newColor:o}),this.pixelData[t]=o,xt.playUnstitch()),this.resetInactivityTimer()}undo(){const t=Ot.undo();t&&(this.pixelData[t.index]=t.oldColor,xt.playUnstitch()),this.resetInactivityTimer()}redo(){const t=Ot.redo();t&&(this.pixelData[t.index]=t.newColor,xt.playStitch()),this.resetInactivityTimer()}setColor(t){this.activeColor=t,this.resetInactivityTimer()}}const i=new Sr;class se{static toSVG(t,r,o,a="transparent"){let n=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${r}" shape-rendering="crispEdges">`;a!=="transparent"&&(n+=`<rect width="${t}" height="${r}" fill="${a}" />`);for(let s=0;s<r;s++)for(let c=0;c<t;c++){const p=o[s*t+c];if(p==="#eee8d5")continue;let f=1;for(;c+f<t&&o[s*t+(c+f)]===p;)f++;n+=`<rect x="${c}" y="${s}" width="${f}" height="1" fill="${p}" />`,c+=f-1}return n+="</svg>",n}static async toPNG(t,r,o,a,n="transparent"){const s=document.createElement("canvas"),c=Math.max(1,Math.round(t*a)),p=Math.max(1,Math.round(r*a));s.width=c,s.height=p;const f=s.getContext("2d");if(!f)throw new Error("Could not get canvas context");f.imageSmoothingEnabled=!1,n!=="transparent"&&(f.fillStyle=n,f.fillRect(0,0,c,p));const h=a;return o.forEach((_,x)=>{if(_==="#eee8d5")return;const b=x%t,E=Math.floor(x/t);f.fillStyle=_,f.fillRect(Math.floor(b*h),Math.floor(E*h),Math.ceil(h),Math.ceil(h))}),s.toDataURL("image/png")}}const Tr={UP:["ArrowUp"],DOWN:["ArrowDown"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"]},Pr={STITCH:[" "],UNSTITCH:["Backspace","Delete"],UNSTITCH_MOD:["Ctrl+ "],EYEDROPPER:["i","Alt+ "]},Mr={UNDO:["Ctrl+z"],REDO:["Ctrl+Shift+z","Ctrl+y"]},Ar={ZOOM_IN:["+","="],ZOOM_OUT:["-"],RESET_ZOOM:["Ctrl+0"]},Lr={COMMAND_PALETTE:["Ctrl+k"],EXPORT:["Ctrl+e"],COLOR_PICKER:["Ctrl+p"],CLEAR_LINEN:["Ctrl+l"],TOGGLE_MUTE:["Ctrl+m"],ESCAPE:["Escape"]},Ir={SELECT_1:["1"],SELECT_2:["2"],SELECT_3:["3"],SELECT_4:["4"],SELECT_5:["5"],SELECT_6:["6"],SELECT_7:["7"],SELECT_8:["8"],SELECT_9:["9"],SELECT_0:["0"]},Dr={navigation:Tr,canvas:Pr,history:Mr,view:Ar,studio:Lr,palette:Ir};class Or{definitions=[];constructor(){Object.values(Dr).forEach(t=>{Object.entries(t).forEach(([r,o])=>{o.forEach(a=>{const n=a.toLowerCase().split("+"),s=n[n.length-1],c=n.includes("ctrl"),p=n.includes("shift"),f=n.includes("alt");this.definitions.push({action:r,key:s,modifiers:{ctrl:c,shift:p,alt:f},modifierCount:(c?1:0)+(p?1:0)+(f?1:0)})})})}),this.definitions.sort((t,r)=>r.modifierCount-t.modifierCount)}getBestMatch(t){const r=t.key.toLowerCase(),o=t.ctrlKey||t.metaKey,a=t.shiftKey,n=t.altKey;for(const s of this.definitions){const c=r===s.key||t.code.toLowerCase()===`key${s.key}`;if(["UP","DOWN","LEFT","RIGHT"].includes(s.action)){if(r===s.key||t.key===s.key)return s.action;continue}if(c&&o===s.modifiers.ctrl&&a===s.modifiers.shift&&n===s.modifiers.alt)return s.action}return null}getLabel(t){const r=this.definitions.find(o=>o.action===t);return r?r.key.toUpperCase():""}}const dt=new Or;var Rr=H('<div id="picker-overlay" class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/20 backdrop-blur-sm"><div class="bg-[#fdf6e3] p-8 rounded-[2.5rem] border-8 border-white shadow-2xl w-80 flex flex-col gap-6 ring-1 ring-black/5"><div class="flex justify-between items-center"><span class="font-serif italic text-2xl text-studio-warm"> </span> <button class="text-[10px] uppercase font-bold opacity-30 hover:opacity-100 tracking-widest">Cancel</button></div> <div class="h-32 rounded-3xl border-4 border-white shadow-inner flex items-center justify-center relative overflow-hidden bg-[#eee8d5]"><div class="absolute inset-0 tech-checker opacity-30"></div> <div class="z-10 h-20 w-20 rounded-full border-4 border-white shadow-lg"></div></div> <div class="flex flex-col gap-5"><div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] uppercase font-black opacity-30 tracking-wider"><span>Hue</span> <span> </span></div> <input type="range" min="0" max="360" class="custom-slider hue-slider svelte-13rslnh"/></div> <div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] uppercase font-black opacity-30 tracking-wider"><span>Saturation</span> <span> </span></div> <input type="range" min="0" max="100" class="custom-slider svelte-13rslnh"/></div> <div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] uppercase font-black opacity-30 tracking-wider"><span>Lightness</span> <span> </span></div> <input type="range" min="0" max="100" class="custom-slider svelte-13rslnh"/></div> <div class="flex flex-col gap-2"><div class="flex justify-between text-[10px] uppercase font-black opacity-30 tracking-wider"><span>Opacity (Alpha)</span> <span> </span></div> <input type="range" min="0" max="100" class="custom-slider alpha-slider svelte-13rslnh"/></div></div> <div class="flex flex-col gap-3"><div class="relative"><input type="text" maxlength="9" class="w-full text-center font-mono text-xs opacity-60 bg-white/80 py-2 rounded-xl border border-black/5 focus:outline-none focus:ring-2 focus:ring-studio-warm/20"/> <span class="absolute right-3 top-1/2 -translate-y-1/2 text-[8px] uppercase font-bold opacity-20">Hex</span></div> <button class="w-full bg-studio-teal text-white font-serif italic py-3 rounded-2xl shadow-md hover:scale-[1.02] active:scale-100 transition-all flex justify-center items-center gap-2"><span>âœ¨</span> Apply Color</button></div></div></div>');function Se(e,t){yt(t,!0);let r=ue(t,"value",15),o=ue(t,"title",3,"Natural Dye Basin"),a=M(0),n=M(100),s=M(50),c=M(100);function p(T){(!T||!/^#([0-9A-F]{6}|[0-9A-F]{8})$/i.test(T))&&(T="#fdf6e3ff");let Z=parseInt(T.slice(1,3),16)/255,Y=parseInt(T.slice(3,5),16)/255,at=parseInt(T.slice(5,7),16)/255,Ct=T.length===9?parseInt(T.slice(7,9),16)/255:1,g=Math.max(Z,Y,at),S=Math.min(Z,Y,at),N,F,ot=(g+S)/2;if(g===S)N=F=0;else{let G=g-S;switch(F=ot>.5?G/(2-g-S):G/(g+S),g){case Z:N=(Y-at)/G+(Y<at?6:0);break;case Y:N=(at-Z)/G+2;break;case at:N=(Z-Y)/G+4;break}N/=6}return{h:N*360,s:F*100,l:ot*100,a:Ct*100}}dr(()=>{const T=p(r());C(a,T.h,!0),C(n,T.s,!0),C(s,T.l,!0),C(c,T.a,!0)});function f(T,Z,Y,at){Y/=100;const Ct=Math.round(at/100*255).toString(16).padStart(2,"0"),g=Z*Math.min(Y,1-Y)/100,S=N=>{const F=(N+T/30)%12,ot=Y-g*Math.max(Math.min(F-3,9-F,1),-1);return Math.round(255*ot).toString(16).padStart(2,"0")};return`#${S(0)}${S(8)}${S(4)}${Ct}`}mt(()=>{r(f(l(a),l(n),l(s),l(c)))});function h(T){const Z=T.target.value;/^#([0-9A-F]{6}|[0-9A-F]{8})$/i.test(Z)&&r(Z)}function _(T){T.key==="Enter"&&t.onClose()}function x(T){T.target.id==="picker-overlay"&&t.onClose()}mt(()=>(i.pushEscapeAction(t.onClose),()=>i.popEscapeAction(t.onClose)));var b=Rr();b.__mousedown=x;var E=v(b),w=v(E),d=v(w),y=v(d,!0);u(d);var P=m(d,2);P.__click=function(...T){t.onClose?.apply(this,T)},u(w);var O=m(w,2),k=m(v(O),2);u(O);var L=m(O,2),B=v(L),I=v(B),U=m(v(I),2),z=v(U);u(U),u(I);var D=m(I,2);Et(D),u(B);var q=m(B,2),et=v(q),rt=m(v(et),2),wt=v(rt);u(rt),u(et);var it=m(et,2);Et(it),u(q);var Q=m(q,2),ct=v(Q),ft=m(v(ct),2),St=v(ft);u(ft),u(ct);var R=m(ct,2);Et(R),u(Q);var $=m(Q,2),W=v($),st=m(v(W),2),Tt=v(st);u(st),u(W);var At=m(W,2);Et(At),u($),u(L);var Lt=m(L,2),kt=v(Lt),pt=v(kt);Et(pt),pt.__input=h,pt.__keydown=_,Mt(2),u(kt);var jt=m(kt,2);jt.__click=function(...T){t.onClose?.apply(this,T)},u(Lt),u(E),u(b),V((T,Z,Y,at,Ct)=>{j(y,o()),X(k,`background-color: ${r()??""};`),j(z,`${T??""}Â°`),j(wt,`${Z??""}%`),j(St,`${Y??""}%`),j(Tt,`${at??""}%`),Ce(pt,Ct)},[()=>Math.round(l(a)),()=>Math.round(l(n)),()=>Math.round(l(s)),()=>Math.round(l(c)),()=>r().toUpperCase()]),Ht(D,()=>l(a),T=>C(a,T)),Ht(it,()=>l(n),T=>C(n,T)),Ht(R,()=>l(s),T=>C(s,T)),Ht(At,()=>l(c),T=>C(c,T)),A(e,b),_t()}Ut(["mousedown","click","input","keydown"]);var Nr=H('<img alt="Preview" class="max-h-full max-w-full shadow-lg" style="image-rendering: pixelated;"/>'),$r=H("<button> </button>"),Hr=H("<button><div></div> </button>"),Br=H('<div class="fixed inset-0 z-[1000] flex items-center justify-center bg-black/20 backdrop-blur-sm" id="export-overlay"><div class="flex max-h-[90vh] w-[500px] flex-col gap-6 overflow-y-auto rounded-[2.5rem] border-8 border-white bg-[#fdf6e3] p-8 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between"><span class="font-serif text-2xl text-studio-warm italic">Export Project</span> <button class="text-[10px] font-bold tracking-widest uppercase opacity-30 transition-opacity hover:opacity-100">Cancel</button></div> <div class="flex flex-col gap-3"><span class="text-[10px] font-black tracking-wider uppercase opacity-30">Linen Preview</span> <div class="artisan-checker relative flex h-48 items-center justify-center overflow-hidden rounded-2xl border-4 border-white bg-[#eee8d5] shadow-inner svelte-1ed95g7"><!></div></div> <div class="grid grid-cols-2 gap-6"><div class="flex flex-col gap-3"><span class="text-[10px] font-black tracking-wider uppercase opacity-30">Scaling</span> <div class="flex flex-wrap gap-2"></div> <div class="relative mt-1"><input type="number" class="w-full rounded-xl border-2 border-black/5 bg-white/50 px-3 py-1.5 font-mono text-xs outline-none transition-colors focus:border-studio-warm/30"/> <span class="pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-[8px] font-bold text-studio-text italic opacity-20">px</span></div></div> <div class="flex flex-col gap-3"><span class="text-[10px] font-black tracking-wider uppercase opacity-30">Background Dye</span> <div class="flex flex-col gap-2"><!> <button><div class="h-3 w-3 rounded-sm border border-black/10 bg-gradient-to-tr from-rose-300 via-sage-300 to-sky-300"></div> Custom Dye...</button></div></div></div> <div class="mt-2 flex gap-3"><button class="flex flex-1 flex-col items-center rounded-2xl bg-studio-teal py-3 text-white shadow-md transition-all font-serif hover:scale-[1.02] italic active:scale-100"><span class="text-lg">Export PNG</span> <span class="mt-1 text-[8px] font-bold tracking-widest uppercase opacity-60">Raster Print</span></button> <button class="flex flex-1 flex-col items-center rounded-2xl bg-studio-warm py-3 text-white shadow-md transition-all font-serif hover:scale-[1.02] italic active:scale-100"><span class="text-lg">Export SVG</span> <span class="mt-1 text-[8px] font-bold tracking-widest uppercase opacity-60">Vector Tapestry</span></button></div></div></div> <!>',1);function Ur(e,t){yt(t,!0);let r=M(i.gridWidth*i.exportScale),o=M(!1),a=M(""),n=M(!1);const s=[.5,1,2,4,10,20],c=[{label:"Transparent",value:"transparent"},{label:"Studio Cream",value:"#fdf6e3"},{label:"White",value:"#ffffff"},{label:"Black",value:"#000000"}];async function p(){C(a,await se.toPNG(i.gridWidth,i.gridHeight,i.pixelData,5,i.exportBgColor),!0)}function f(R){i.exportScale=R,C(r,i.gridWidth*R),C(o,!1)}function h(R){const $=parseInt(R.target.value);!isNaN($)&&$>0&&(C(r,$,!0),i.exportScale=$/i.gridWidth,C(o,!0))}function _(){window.dispatchEvent(new CustomEvent("app:close-export"))}mt(()=>{i.exportBgColor,p()}),mt(()=>(i.pushEscapeAction(_),()=>i.popEscapeAction(_))),Kt(()=>{p()});var x=Br(),b=bt(x);b.__mousedown=R=>R.target.id==="export-overlay"&&_();var E=v(b),w=v(E),d=m(v(w),2);d.__click=_,u(w);var y=m(w,2),P=m(v(y),2),O=v(P);{var k=R=>{var $=Nr();V(()=>Vt($,"src",l(a))),A(R,$)};K(O,R=>{l(a)&&R(k)})}u(P),u(y);var L=m(y,2),B=v(L),I=m(v(B),2);lt(I,21,()=>s,nt,(R,$)=>{var W=$r();W.__click=()=>f(l($));var st=v(W);u(W),V(()=>{gt(W,1,`rounded-full border-2 px-2.5 py-1 font-mono text-[10px] transition-all ${!l(o)&&i.exportScale===l($)?"border-studio-warm bg-studio-warm text-white":"border-black/5 bg-white opacity-60 hover:opacity-100"}`),j(st,`${l($)??""}x`)}),A(R,W)}),u(I);var U=m(I,2),z=v(U);Et(z),z.__input=h,Mt(2),u(U),u(B);var D=m(B,2),q=m(v(D),2),et=v(q);lt(et,17,()=>c,nt,(R,$)=>{var W=Hr();W.__click=()=>i.exportBgColor=l($).value;var st=v(W),Tt=m(st);u(W),V(()=>{gt(W,1,`flex items-center gap-2 rounded-lg border-2 p-1.5 font-serif text-[10px] transition-all italic ${i.exportBgColor===l($).value?"border-studio-warm bg-white shadow-sm":"border-transparent opacity-60 hover:opacity-100"}`),gt(st,1,`h-3 w-3 rounded-sm border border-black/10 ${l($).value==="transparent"?"artisan-checker":""}`,"svelte-1ed95g7"),X(st,`background-color: ${(l($).value==="transparent"?"transparent":l($).value)??""};`),j(Tt,` ${l($).label??""}`)}),A(R,W)});var rt=m(et,2);rt.__click=()=>{i.exportBgColor==="transparent"&&(i.exportBgColor="#fdf6e3"),C(n,!0)};var wt=v(rt);Mt(),u(rt),u(q),u(D),u(L);var it=m(L,2),Q=v(it);Q.__click=()=>t.onExport("png",i.exportScale,i.exportBgColor);var ct=m(Q,2);ct.__click=()=>t.onExport("svg",1,i.exportBgColor),u(it),u(E),u(b);var ft=m(b,2);{var St=R=>{Se(R,{onClose:()=>C(n,!1),title:"Background Dye",get value(){return i.exportBgColor},set value($){i.exportBgColor=$}})};K(ft,R=>{l(n)&&R(St)})}V((R,$,W)=>{Ce(z,R),gt(rt,1,`flex items-center gap-2 rounded-lg border-2 p-1.5 font-serif text-[10px] transition-all italic ${$??""}`),X(wt,`background-color: ${W??""}`)},[()=>Math.round(l(r)),()=>c.some(R=>R.value===i.exportBgColor)?"border-transparent opacity-60 hover:opacity-100":"border-studio-warm bg-white shadow-sm",()=>c.some(R=>R.value===i.exportBgColor)?"":i.exportBgColor]),A(e,x),_t()}Ut(["mousedown","click","input"]);var zr=H('<div class="p-8 text-center font-serif text-xs italic opacity-30">No such pattern found in the studio...</div>'),Wr=H('<span class="rounded bg-black/10 px-2 py-1 font-mono text-[10px] opacity-50"> </span>'),Fr=H('<button><span class="font-serif italic"> </span> <!></button>'),Gr=H(`<div class="fixed inset-0 z-[1000] flex items-start justify-center bg-black/10 pt-32 backdrop-blur-sm" id="palette-overlay"><div class="flex w-[500px] flex-col overflow-hidden rounded-3xl border-8 border-white bg-[#fdf6e3] shadow-2xl ring-1 ring-black/5"><div class="border-b border-studio-text/5 bg-white/30 p-6"><div class="flex items-center gap-4"><span class="font-serif text-xl italic opacity-20">ðŸ“–</span> <input placeholder="Search the Pattern Book..." class="w-full bg-transparent font-serif text-lg text-studio-text italic outline-none placeholder:opacity-30"/></div></div> <div class="max-h-[400px] overflow-y-auto p-2"><!></div> <div class="border-t border-studio-text/5 bg-studio-text/[0.02] p-4 text-center"><span class="text-[9px] font-black tracking-widest uppercase opacity-20">Artisan's Pattern Book</span></div></div></div>`);function Vr(e,t){yt(t,!0);const r=[{id:"open-help",label:"Help: Open Artisan's Guide",shortcut:"F1",action:()=>i.showHelp=!0},{id:"open-export",label:"Export: Open Export Window",shortcut:dt.getLabel("EXPORT"),action:()=>{}},{id:"open-dye-basin",label:"Color: Open Color Wheel (Dye Basin)",shortcut:dt.getLabel("COLOR_PICKER"),action:()=>i.showColorPicker=!0},{id:"toggle-mute",label:"Studio: Toggle Audio Feedback (Mute/Unmute)",shortcut:dt.getLabel("TOGGLE_MUTE"),action:()=>i.toggleMute()},{id:"pick-dye",label:"Color: Eyedropper (Pick Dye from Canvas)",shortcut:dt.getLabel("EYEDROPPER"),action:()=>i.pickColor()},{id:"reset-zoom",label:"View: Reset Loom Zoom",shortcut:dt.getLabel("RESET_ZOOM"),action:()=>i.resetZoom()},{id:"undo",label:"Edit: Undo Last Stitch",shortcut:dt.getLabel("UNDO"),action:()=>i.undo()},{id:"redo",label:"Edit: Redo Last Stitch",shortcut:dt.getLabel("REDO"),action:()=>i.redo()},{id:"clear-linen",label:"Project: Clear the Linen (Full Reset)",shortcut:dt.getLabel("CLEAR_LINEN"),action:()=>i.clearCanvas()}];let o=M(""),a=M(0),n,s,c=Rt(()=>r.filter(k=>k.label.toLowerCase().includes(l(o).toLowerCase())));mt(()=>{l(o),C(a,0)}),mt(()=>{if(s&&l(a)>=0){const k=s.children[l(a)];k&&k.scrollIntoView({block:"nearest",behavior:"smooth"})}});function p(k){k.action(),k.id==="open-export"&&window.dispatchEvent(new CustomEvent("app:execute-command",{detail:"open-export"})),h()}function f(k){k.key==="ArrowDown"?(k.preventDefault(),C(a,(l(a)+1)%l(c).length)):k.key==="ArrowUp"?(k.preventDefault(),C(a,(l(a)-1+l(c).length)%l(c).length)):k.key==="Enter"&&(k.preventDefault(),l(c)[l(a)]&&p(l(c)[l(a)]))}function h(){i.showCommandPalette=!1}mt(()=>(i.pushEscapeAction(h),()=>i.popEscapeAction(h))),Kt(()=>{n.focus()});var _=Gr();_.__mousedown=k=>k.target.id==="palette-overlay"&&h();var x=v(_),b=v(x),E=v(b),w=m(v(E),2);Et(w),w.__keydown=f,ve(w,k=>n=k,()=>n),u(E),u(b);var d=m(b,2),y=v(d);{var P=k=>{var L=zr();A(k,L)},O=k=>{var L=Bt(),B=bt(L);lt(B,17,()=>l(c),nt,(I,U,z)=>{var D=Fr();D.__click=()=>p(l(U));var q=v(D),et=v(q,!0);u(q);var rt=m(q,2);{var wt=it=>{var Q=Wr(),ct=v(Q,!0);u(Q),V(()=>j(ct,l(U).shortcut)),A(it,Q)};K(rt,it=>{l(U).shortcut&&it(wt)})}u(D),V(()=>{gt(D,1,`flex w-full items-center justify-between rounded-2xl px-6 py-4 text-left transition-all ${z===l(a)?"scale-[1.02] bg-studio-warm text-white shadow-md":"hover:bg-studio-text/5"}`),j(et,l(U).label)}),A(I,D)}),A(k,L)};K(y,k=>{l(c).length===0?k(P):k(O,!1)})}u(d),ve(d,k=>s=k,()=>s),Mt(2),u(x),u(_),Ht(w,()=>l(o),k=>C(o,k)),A(e,_),_t()}Ut(["mousedown","keydown","click"]);var Kr=H('<div class="flex items-center justify-between group"><span class="font-serif italic text-sm opacity-70 group-hover:opacity-100 transition-opacity"> </span> <div class="flex gap-1"><kbd class="rounded-lg bg-white border-2 border-black/[0.03] px-3 py-1 font-mono text-[10px] shadow-sm text-studio-warm"> </kbd></div></div>'),jr=H('<div class="flex flex-col gap-4"><h3 class="font-serif text-xl text-studio-text italic border-b border-studio-text/10 pb-2"> </h3> <div class="grid grid-cols-1 gap-3"></div></div>'),qr=H(`<div class="fixed inset-0 z-[1200] flex items-center justify-center bg-black/20 backdrop-blur-sm" id="help-overlay"><div class="flex max-h-[85vh] w-[600px] flex-col gap-8 overflow-y-auto rounded-[3rem] border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between"><div class="flex flex-col"><span class="font-serif text-3xl text-studio-warm italic">Artisan's Guide</span> <span class="text-[10px] font-bold tracking-[0.2em] uppercase opacity-30 font-serif">Mastering the Digital Loom</span></div> <button class="rounded-full bg-white/50 px-4 py-2 text-[10px] font-bold tracking-widest uppercase opacity-40 transition-all hover:opacity-100 border border-black/5">Got it</button></div> <div class="grid grid-cols-1 gap-8"></div> <div class="mt-4 border-t border-studio-text/5 pt-6 text-center"><p class="font-serif text-xs italic opacity-30">"Every stitch is a story, every pixel a memory."</p></div></div></div>`);function Zr(e,t){yt(t,!0);function r(){i.showHelp=!1}mt(()=>(i.pushEscapeAction(r),()=>i.popEscapeAction(r)));const o=[{category:"Artisan Navigation",items:[{label:"Move the Needle",keys:"Arrow Keys"},{label:"Loom Zoom In/Out",keys:"+ / -"},{label:"Reset View",keys:"Ctrl + 0"}]},{category:"Digital Stitching",items:[{label:"Place Stitch",keys:"Space"},{label:"Unstitch (Erase)",keys:"Backspace / Del"},{label:"Threading (Flow Mode)",keys:"Hold Shift + Arrows"},{label:"Unravelling (Erase Flow)",keys:"Hold Shift + Ctrl + Arrows"},{label:"Block Looming (2D Fill)",keys:"Hold Shift + Alt + Arrows"}]},{category:"Studio Tools",items:[{label:"Pattern Book (Catalog)",keys:"Ctrl + K"},{label:"Natural Dye Basin (Color)",keys:"Ctrl + P"},{label:"Pick Dye (Eyedropper)",keys:"I or Alt + Space"},{label:"Finish & Export",keys:"Ctrl + E"},{label:"Undo / Redo",keys:"Ctrl + Z / Ctrl + Y"},{label:"Toggle Studio Sounds",keys:"Ctrl + M"}]}];var a=qr();a.__mousedown=f=>f.target.id==="help-overlay"&&r();var n=v(a),s=v(n),c=m(v(s),2);c.__click=r,u(s);var p=m(s,2);lt(p,21,()=>o,nt,(f,h)=>{var _=jr(),x=v(_),b=v(x,!0);u(x);var E=m(x,2);lt(E,21,()=>l(h).items,nt,(w,d)=>{var y=Kr(),P=v(y),O=v(P,!0);u(P);var k=m(P,2),L=v(k),B=v(L,!0);u(L),u(k),u(y),V(()=>{j(O,l(d).label),j(B,l(d).keys)}),A(w,y)}),u(E),u(_),V(()=>j(b,l(h).category)),A(f,_)}),u(p),Mt(2),u(n),u(a),A(e,a),_t()}Ut(["mousedown","click"]);const Yr=e=>e;function Xr(e){const t=e-1;return t*t*t+1}function xe(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function Ft(e,{delay:t=0,duration:r=400,easing:o=Yr}={}){const a=+getComputedStyle(e).opacity;return{delay:t,duration:r,easing:o,css:n=>`opacity: ${n*a}`}}function Qr(e,{delay:t=0,duration:r=400,easing:o=Xr,x:a=0,y:n=0,opacity:s=0}={}){const c=getComputedStyle(e),p=+c.opacity,f=c.transform==="none"?"":c.transform,h=p*(1-s),[_,x]=xe(a),[b,E]=xe(n);return{delay:t,duration:r,easing:o,css:(w,d)=>`
			transform: ${f} translate(${(1-w)*_}${x}, ${(1-w)*b}${E});
			opacity: ${p-h*d}`}}var Jr=H(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-[#fdf6e3] background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png'); svelte-1yxrgyh"><div class="flex flex-col items-center gap-2 animate-pulse svelte-1yxrgyh"><div class="h-16 w-16 rounded-full border-4 border-studio-warm/20 flex items-center justify-center bg-white shadow-sm mb-4 svelte-1yxrgyh"><span class="text-3xl font-serif italic text-studio-warm svelte-1yxrgyh">R</span></div> <h1 class="text-5xl font-serif italic text-studio-warm tracking-tighter svelte-1yxrgyh">Rupa</h1> <p class="text-[10px] uppercase tracking-[0.4em] font-serif font-bold opacity-30 svelte-1yxrgyh">The Weaver's Studio</p></div> <div class="absolute bottom-16 flex flex-col items-center gap-4 svelte-1yxrgyh"><div class="w-32 h-0.5 bg-studio-text/5 rounded-full overflow-hidden svelte-1yxrgyh"><div class="h-full bg-studio-warm/40 animate-[loading_2s_ease-in-out_infinite] svelte-1yxrgyh"></div></div> <span class="text-[9px] font-serif italic opacity-20 italic svelte-1yxrgyh">Preparing the linen...</span></div></div>`);function ti(e,t){yt(t,!0);let r=M(!0);Kt(()=>{const s=setTimeout(()=>{C(r,!1),setTimeout(()=>{i.isAppReady=!0},800)},2e3);return()=>clearTimeout(s)});var o=Bt(),a=bt(o);{var n=s=>{var c=Jr();$t(2,c,()=>Ft,()=>({duration:800})),A(s,c)};K(a,s=>{l(r)&&s(n)})}A(e,o),_t()}var ei=H('<div class="absolute inset-[-4px] border-2 border-white rounded-sm animate-ping opacity-20 z-0"></div> <div class="absolute -top-10 left-1/2 -translate-x-1/2 flex flex-col items-center z-[110]"><div class="relative h-7 w-7 rounded-full rounded-br-none border-4 border-white shadow-xl bg-white ring-1 ring-black/5 overflow-hidden" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="w-0.5 h-2 bg-white -mt-0.5 shadow-sm rounded-full opacity-80"></div></div>',1),ri=H('<div class="cursor-container absolute inset-0 svelte-1f6cquq"><div class="bloom-wrapper svelte-1f6cquq"><div class="petal p-top svelte-1f6cquq"></div> <div class="petal p-bottom svelte-1f6cquq"></div> <div class="petal p-left svelte-1f6cquq"></div> <div class="petal p-right svelte-1f6cquq"></div> <div class="center-dot svelte-1f6cquq"></div></div> <!></div>');function ii(e,t){yt(t,!1),we();var r=Bt(),o=bt(r);{var a=n=>{var s=ri(),c=m(v(s),2);{var p=f=>{var h=ei(),_=bt(h),x=m(_,2),b=v(x),E=v(b);u(b),Mt(2),u(x),V(()=>{X(_,`background-color: ${i.activeColor??""};`),X(E,`background-color: ${i.activeColor??""};`)}),$t(3,_,()=>Ft,()=>({duration:400})),$t(1,x,()=>Qr,()=>({y:-10,duration:400})),$t(2,x,()=>Ft,()=>({duration:400})),A(f,h)};K(c,f=>{i.isPicking&&f(p)})}u(s),$t(3,s,()=>Ft,()=>({duration:800})),A(n,s)};K(o,n=>{i.isCursorVisible&&n(a)})}A(e,r),_t()}var si=H('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-studio-text/10"></div>'),ai=H('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-studio-text/10"></div>'),oi=H("<div><!></div>"),ni=H('<div class="absolute z-40 border-2 border-dashed border-studio-warm bg-studio-warm/10 pointer-events-none"><div class="absolute h-2 w-2 bg-studio-warm border border-white shadow-sm -translate-x-1/2 -translate-y-1/2"></div></div>'),li=H('<div class="stitch-grid-pattern artisan-checker-small relative shrink-0 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] shadow-sm"><div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-studio-text/30"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-studio-text/30"></div> <!> <!></div> <!> <!></div>');function ci(e,t){yt(t,!1),we();var r=li(),o=v(r),a=m(v(o),4);lt(a,0,()=>[-24,-16,-8,8,16,24],nt,(f,h)=>{const _=J(()=>50+h/i.gridWidth*100);var x=Bt(),b=bt(x);{var E=w=>{var d=si();V(()=>X(d,`left: ${l(_)??""}%`)),A(w,d)};K(b,w=>{l(_)>0&&l(_)<100&&w(E)})}A(f,x)});var n=m(a,2);lt(n,0,()=>[-24,-16,-8,8,16,24],nt,(f,h)=>{const _=J(()=>50+h/i.gridHeight*100);var x=Bt(),b=bt(x);{var E=w=>{var d=ai();V(()=>X(d,`top: ${l(_)??""}%`)),A(w,d)};K(b,w=>{l(_)>0&&l(_)<100&&w(E)})}A(f,x)}),u(o);var s=m(o,2);lt(s,1,()=>i.pixelData,nt,(f,h,_)=>{const x=J(()=>_%i.gridWidth),b=J(()=>Math.floor(_/i.gridWidth)),E=J(()=>i.cursorPos.x===l(x)&&i.cursorPos.y===l(b)),w=J(()=>l(h)==="#eee8d5");var d=oi(),y=v(d);{var P=O=>{ii(O,{})};K(y,O=>{l(E)&&O(P)})}u(d),V(()=>{gt(d,1,`cell-stitch relative h-full w-full ${l(E)?"z-30":"z-10"}`),X(d,`background-color: ${(l(w)?"rgba(238, 232, 213, 0.01)":l(h))??""};`)}),A(f,d)});var c=m(s,2);{var p=f=>{const h=J(()=>Math.min(i.selectionStart.x,i.selectionEnd.x)),_=J(()=>Math.max(i.selectionStart.x,i.selectionEnd.x)),x=J(()=>Math.min(i.selectionStart.y,i.selectionEnd.y)),b=J(()=>Math.max(i.selectionStart.y,i.selectionEnd.y)),E=J(()=>l(_)-l(h)+1),w=J(()=>l(b)-l(x)+1);var d=ni(),y=v(d);u(d),V(()=>{X(d,`
				left: ${l(h)/i.gridWidth*100}%; 
				top: ${l(x)/i.gridHeight*100}%; 
				width: ${l(E)/i.gridWidth*100}%; 
				height: ${l(w)/i.gridHeight*100}%;
			`),X(y,`
					left: ${(i.selectionStart.x-l(h)+.5)/l(E)*100}%;
					top: ${(i.selectionStart.y-l(x)+.5)/l(w)*100}%;
				`)}),A(f,d)};K(c,f=>{i.isBlockMode&&i.selectionStart&&i.selectionEnd&&f(p)})}u(r),V(()=>X(r,`
		display: grid;
		grid-template-columns: repeat(${i.gridWidth??""}, 1fr); 
		grid-template-rows: repeat(${i.gridHeight??""}, 1fr);
		width: min(75vh, 75vw); 
		height: min(75vh, 75vw);
		--grid-cols: ${i.gridWidth??""}; 
		--grid-rows: ${i.gridHeight??""}; 
		transform: ${i.cameraTransform??""};
		background-color: #eee8d5;
	`)),A(e,r),_t()}var di=H("<button></button>"),ui=H('<button aria-label="Select used dye"></button>'),vi=H('<div class="flex w-full flex-col items-end"><span class="mb-1.5 font-serif text-[8px] font-bold uppercase opacity-40">Canvas Dyes</span> <div class="grid grid-cols-3 gap-1.5 rounded-lg border border-white bg-white/30 p-1.5"></div></div>'),fi=H('<div class="status-tag animate-pulse border-studio-teal/20 bg-studio-teal/10 text-studio-teal shadow-sm"><!></div>'),pi=H('<div class="status-tag font-serif italic opacity-60">Studio Ready</div>'),hi=H(`<!> <!> <!> <!> <!> <div class="pointer-events-none fixed top-0 left-0 z-40 flex w-full justify-center p-6"><div class="flex flex-col items-center"><span class="font-serif text-4xl text-studio-warm italic opacity-90 drop-shadow-sm">Rupa</span> <span class="-mt-1 font-serif text-[9px] font-bold tracking-[0.3em] uppercase opacity-30">The Weaver's Studio</span></div></div> <div class="fixed top-1/2 left-0 z-50 -translate-y-1/2 p-2"><div class="artisan-panel side-panel-left flex flex-col gap-2 p-2"><span class="mb-1 text-center font-serif text-[7px] font-bold uppercase opacity-30">Dyes</span> <!> <div class="mx-auto my-1 h-px w-4 bg-studio-text/10"></div> <button class="via-sage-300 h-7 w-7 rounded-full border-2 border-dashed border-studio-warm/40 bg-gradient-to-tr from-rose-300 via-sage-300 to-sky-300 shadow-sm transition-all hover:scale-110 hover:border-studio-warm" title="Natural Dye Basin (Ctrl + P)"></button></div></div> <div class="fixed top-1/2 right-0 z-50 -translate-y-1/2 p-2"><div class="artisan-panel side-panel-right flex w-32 flex-col items-end gap-5 p-4"><div class="flex w-full flex-col items-end"><span class="mb-1 font-serif text-[8px] font-bold uppercase opacity-40">Needle</span> <div class="flex w-full flex-col items-end rounded-lg border border-white/50 bg-black/5 p-1.5"><span class="font-mono text-[10px] text-studio-text"> </span> <span class="mt-0.5 font-mono text-[9px] opacity-40"> </span></div></div> <!> <div class="flex w-full flex-col items-end"><span class="mb-1 font-serif text-[8px] font-bold uppercase opacity-40">Dye</span> <div class="h-10 w-10 overflow-hidden rounded-xl border-4 border-white bg-white p-0.5 shadow-lg ring-1 ring-studio-warm/10"><div class="h-full w-full rounded-lg"></div></div></div></div></div> <div class="relative flex h-screen flex-1 items-center justify-center overflow-hidden"><div class="artisan-frame flex h-[80vh] w-[82vw] items-center justify-center overflow-hidden"><!></div></div> <div class="fixed bottom-0 left-0 z-50 flex w-full justify-center p-6"><div class="artisan-panel bottom-panel flex items-center gap-8 border-t-4 border-white px-8 py-4 shadow-xl"><div class="flex gap-3"><button class="artisan-tool-btn"><span>ðŸ“–</span> Catalog</button> <button class="artisan-tool-btn"><span>ðŸ§º</span> Export</button> <button class="artisan-tool-btn"><span>ðŸŒ¿</span> Clear</button> <button class="artisan-tool-btn"><span> </span> </button></div> <div class="h-8 w-px bg-studio-text/10"></div> <div class="flex gap-4"><!></div></div></div>`,1);function wi(e,t){yt(t,!0);let r=M(!1);async function o(g,S=10,N="transparent"){if(g==="svg"){const F=se.toSVG(i.gridWidth,i.gridHeight,i.pixelData,N),ot=new Blob([F],{type:"image/svg+xml"}),G=URL.createObjectURL(ot);a(G,"stitch-art.svg")}else{const F=await se.toPNG(i.gridWidth,i.gridHeight,i.pixelData,S,N);a(F,"stitch-art.png")}C(r,!1)}function a(g,S){const N=document.createElement("a");N.href=g,N.download=S,N.click()}function n(g){if(!i.isAppReady)return;if(i.resetInactivityTimer(),g.target instanceof HTMLInputElement||g.target instanceof HTMLTextAreaElement||g.target.isContentEditable){g.key==="Escape"&&(i.handleEscape(),g.preventDefault());return}if(i.isShiftPressed=g.shiftKey,i.isCtrlPressed=g.ctrlKey||g.metaKey,i.isAltPressed=g.altKey,i.isBlockMode&&!i.selectionStart&&i.startSelection(),g.key==="F1"){g.preventDefault(),i.showHelp=!i.showHelp;return}const S=dt.getBestMatch(g);if(S)switch(["UP","DOWN","LEFT","RIGHT"].includes(S)||g.preventDefault(),S){case"UP":return i.moveCursor(0,-1);case"DOWN":return i.moveCursor(0,1);case"LEFT":return i.moveCursor(-1,0);case"RIGHT":return i.moveCursor(1,0);case"ESCAPE":return i.handleEscape();case"COMMAND_PALETTE":return i.showCommandPalette=!i.showCommandPalette;case"COLOR_PICKER":return i.showColorPicker=!i.showColorPicker;case"EXPORT":return C(r,!0);case"STITCH":return i.stitch();case"UNSTITCH":case"UNSTITCH_MOD":return i.unstitch();case"EYEDROPPER":return i.pickColor();case"CLEAR_LINEN":return i.clearCanvas();case"UNDO":return i.undo();case"REDO":return i.redo();case"ZOOM_IN":return i.setZoom(.1);case"ZOOM_OUT":return i.setZoom(-.1);case"RESET_ZOOM":return i.resetZoom();case"TOGGLE_MUTE":return i.toggleMute();default:if(S.startsWith("SELECT_")){const N=parseInt(S.split("_")[1]);return i.selectPalette(N===0?9:N-1)}}}function s(g){const S=i.isBlockMode;g.key==="Shift"&&(i.isShiftPressed=!1),(g.key==="Control"||g.key==="Meta")&&(i.isCtrlPressed=!1),g.key==="Alt"&&(i.isAltPressed=!1),S&&!i.isBlockMode&&i.commitSelection()}Kt(()=>{const g=N=>{N.detail==="open-export"&&C(r,!0),N.detail==="export-svg"&&o("svg")},S=()=>{C(r,!1)};return window.addEventListener("keydown",n),window.addEventListener("keyup",s),window.addEventListener("app:execute-command",g),window.addEventListener("app:close-export",S),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",s),window.removeEventListener("app:execute-command",g),window.removeEventListener("app:close-export",S)}});var c=hi(),p=bt(c);ti(p,{});var f=m(p,2);{var h=g=>{Zr(g,{})};K(f,g=>{i.showHelp&&g(h)})}var _=m(f,2);{var x=g=>{Vr(g,{})};K(_,g=>{i.showCommandPalette&&g(x)})}var b=m(_,2);{var E=g=>{Se(g,{onClose:()=>i.showColorPicker=!1,get value(){return i.activeColor},set value(S){i.activeColor=S}})};K(b,g=>{i.showColorPicker&&g(E)})}var w=m(b,2);{var d=g=>{Ur(g,{onExport:o})};K(w,g=>{l(r)&&g(d)})}var y=m(w,4),P=v(y),O=m(v(P),2);lt(O,17,()=>i.palette,nt,(g,S,N)=>{var F=di();F.__click=()=>i.selectPalette(N),Vt(F,"aria-label",`Select dye ${N+1}`),V(()=>{gt(F,1,`h-7 w-7 rounded-full border-2 transition-all ${i.activeColor===l(S)?"scale-110 border-studio-warm shadow-md ring-2 ring-white":"border-white opacity-70 hover:scale-105 hover:opacity-100"}`),X(F,`background-color: ${l(S)??""};`)}),A(g,F)});var k=m(O,4);k.__click=()=>i.showColorPicker=!0,u(P),u(y);var L=m(y,2),B=v(L),I=v(B),U=m(v(I),2),z=v(U),D=v(z);u(z);var q=m(z,2),et=v(q);u(q),u(U),u(I);var rt=m(I,2);{var wt=g=>{var S=vi(),N=m(v(S),2);lt(N,21,()=>i.usedColors,nt,(F,ot)=>{var G=ui();G.__click=()=>i.activeColor=l(ot),V(()=>{gt(G,1,`h-4 w-4 rounded border transition-all hover:scale-110 ${i.activeColor===l(ot)?"border-studio-warm ring-1 ring-studio-warm/30":"border-black/5 opacity-60"}`),X(G,`background-color: ${l(ot)??""};`)}),A(F,G)}),u(N),u(S),A(g,S)};K(rt,g=>{i.usedColors.length>0&&g(wt)})}var it=m(rt,2),Q=m(v(it),2),ct=v(Q);u(Q),u(it),u(B),u(L);var ft=m(L,2),St=v(ft),R=v(St);ci(R,{}),u(St),u(ft);var $=m(ft,2),W=v($),st=v(W),Tt=v(st);Tt.__click=()=>i.showCommandPalette=!0;var At=m(Tt,2);At.__click=()=>C(r,!0);var Lt=m(At,2);Lt.__click=()=>i.clearCanvas();var kt=m(Lt,2);kt.__click=()=>i.toggleMute();var pt=v(kt),jt=v(pt,!0);u(pt);var T=m(pt);u(kt),u(st);var Z=m(st,4),Y=v(Z);{var at=g=>{var S=fi(),N=v(S);{var F=G=>{var zt=ne("âœ¨ Block Looming");A(G,zt)},ot=G=>{var zt=ne();V(()=>j(zt,i.isCtrlPressed?"âœ¨ Unravelling":"ðŸ§µ Threading")),A(G,zt)};K(N,G=>{i.isBlockMode?G(F):G(ot,!1)})}u(S),A(g,S)},Ct=g=>{var S=pi();A(g,S)};K(Y,g=>{i.isShiftPressed?g(at):g(Ct,!1)})}u(Z),u(W),u($),V(g=>{j(D,`X:${i.displayCoords.x??""} Y:${i.displayCoords.y??""}`),j(et,`Z: ${g??""}%`),X(ct,`background-color: ${i.activeColor??""};`),j(jt,i.isMuted?"ðŸ”‡":"ðŸ”Š"),j(T,` ${i.isMuted?"Unmute":"Mute"}`)},[()=>Math.round(i.zoomLevel*100)]),A(e,c),_t()}Ut(["click"]);export{wi as component};
