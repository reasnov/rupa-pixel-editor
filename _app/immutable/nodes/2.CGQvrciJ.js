import{a as C,f as L,c as yt}from"../chunks/Cx-w2dTA.js";import{i as rt}from"../chunks/Dpj273zA.js";import{o as Nt}from"../chunks/BXWHnU33.js";import{aL as fe,b as ae,h as q,D as ne,a as Dt,aM as oe,I as Rt,Z as pe,n as p,F as he,H as Ae,G as Zt,J as Ft,f as Ot,a9 as ge,aD as be,al as Wt,c as mt,aN as lt,e as Vt,aO as xe,s as me,V as tt,aP as ye,aB as Qt,aQ as we,aR as _e,aH as Ee,a6 as Kt,aS as Ce,r as le,p as ce,aT as zt,a8 as Yt,aU as Se,aV as Te,aA as ke,d as Le,ax as Ie,Q as Pe,E as Oe,aW as Me,a1 as Ne,aF as Be,aX as De,aY as Re,aZ as wt,au as de,j as Tt,a_ as Fe,a$ as ze,b0 as Ue,b1 as Ge,b2 as He,b3 as Ve,b4 as Ke,b5 as $e,aI as je,a5 as Qe,b6 as Ye,N as T,aJ as I,M as ht,aK as ft,y as H,A as M,B as V,w as f,C as b,x as v,am as kt,z as ct,i as Lt}from"../chunks/CxgkwXwj.js";import{i as $,p as Y}from"../chunks/DiKYKMMy.js";import{a as Xe,s as R,d as at,e as Ze}from"../chunks/BeGHtlVE.js";import{B as We}from"../chunks/b41NLIMk.js";import{s as qe}from"../chunks/Dajp9mcG.js";const Je=Symbol("NaN");function ti(r,t,e){q&&ne();var i=new We(r),s=!fe();ae(()=>{var a=t();a!==a&&(a=Je),s&&a!==null&&typeof a=="object"&&(a={}),i.ensure(a,e)})}function At(r,t){return t}function ei(r,t,e){for(var i=[],s=t.length,a,n=t.length,o=0;o<s;o++){let h=t[o];ce(h,()=>{if(a){if(a.pending.delete(h),a.done.add(h),a.pending.size===0){var A=r.outrogroups;$t(Qt(a.done)),A.delete(a),A.size===0&&(r.outrogroups=null)}}else n-=1},!1)}if(n===0){var c=i.length===0&&e!==null;if(c){var d=e,u=d.parentNode;ke(u),u.append(d),r.items.clear()}$t(t,!c)}else a={pending:new Set(t),done:new Set},(r.outrogroups??=new Set).add(a)}function $t(r,t=!0){for(var e=0;e<r.length;e++)Le(r[e],t)}var qt;function dt(r,t,e,i,s,a=null){var n=r,o=new Map,c=(t&oe)!==0;if(c){var d=r;n=q?Rt(pe(d)):d.appendChild(Dt())}q&&ne();var u=null,h=tt(()=>{var m=e();return ye(m)?m:m==null?[]:Qt(m)}),A,x=!0;function w(){g.fallback=u,ii(g,A,n,t,i),u!==null&&(A.length===0?(u.f&lt)===0?le(u):(u.f^=lt,St(u,null,n)):ce(u,()=>{u=null}))}var _=ae(()=>{A=p(h);var m=A.length;let O=!1;if(q){var S=he(n)===Ae;S!==(m===0)&&(n=Zt(),Rt(n),Ft(!1),O=!0)}for(var D=new Set,y=mt,P=me(),E=0;E<m;E+=1){q&&Ot.nodeType===ge&&Ot.data===be&&(n=Ot,O=!0,Ft(!1));var N=A[E],U=i(N,E),B=x?null:o.get(U);B?(B.v&&Wt(B.v,N),B.i&&Wt(B.i,E),P&&y.unskip_effect(B.e)):(B=ri(o,x?n:qt??=Dt(),N,U,E,s,t,e),x||(B.e.f|=lt),o.set(U,B)),D.add(U)}if(m===0&&a&&!u&&(x?u=Vt(()=>a(n)):(u=Vt(()=>a(qt??=Dt())),u.f|=lt)),m>D.size&&xe(),q&&m>0&&Rt(Zt()),!x)if(P){for(const[k,K]of o)D.has(k)||y.skip_effect(K.e);y.oncommit(w),y.ondiscard(()=>{})}else w();O&&Ft(!0),p(h)}),g={effect:_,items:o,outrogroups:null,fallback:u};x=!1,q&&(n=Ot)}function _t(r){for(;r!==null&&(r.f&Se)===0;)r=r.next;return r}function ii(r,t,e,i,s){var a=(i&Te)!==0,n=t.length,o=r.items,c=_t(r.effect.first),d,u=null,h,A=[],x=[],w,_,g,m;if(a)for(m=0;m<n;m+=1)w=t[m],_=s(w,m),g=o.get(_).e,(g.f&lt)===0&&(g.nodes?.a?.measure(),(h??=new Set).add(g));for(m=0;m<n;m+=1){if(w=t[m],_=s(w,m),g=o.get(_).e,r.outrogroups!==null)for(const B of r.outrogroups)B.pending.delete(g),B.done.delete(g);if((g.f&lt)!==0)if(g.f^=lt,g===c)St(g,null,e);else{var O=u?u.next:c;g===r.effect.last&&(r.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),ut(r,u,g),ut(r,g,O),St(g,O,e),u=g,A=[],x=[],c=_t(u.next);continue}if((g.f&zt)!==0&&(le(g),a&&(g.nodes?.a?.unfix(),(h??=new Set).delete(g))),g!==c){if(d!==void 0&&d.has(g)){if(A.length<x.length){var S=x[0],D;u=S.prev;var y=A[0],P=A[A.length-1];for(D=0;D<A.length;D+=1)St(A[D],S,e);for(D=0;D<x.length;D+=1)d.delete(x[D]);ut(r,y.prev,P.next),ut(r,u,y),ut(r,P,S),c=S,u=P,m-=1,A=[],x=[]}else d.delete(g),St(g,c,e),ut(r,g.prev,g.next),ut(r,g,u===null?r.effect.first:u.next),ut(r,u,g),u=g;continue}for(A=[],x=[];c!==null&&c!==g;)(d??=new Set).add(c),x.push(c),c=_t(c.next);if(c===null)continue}(g.f&lt)===0&&A.push(g),u=g,c=_t(g.next)}if(r.outrogroups!==null){for(const B of r.outrogroups)B.pending.size===0&&($t(Qt(B.done)),r.outrogroups?.delete(B));r.outrogroups.size===0&&(r.outrogroups=null)}if(c!==null||d!==void 0){var E=[];if(d!==void 0)for(g of d)(g.f&zt)===0&&E.push(g);for(;c!==null;)(c.f&zt)===0&&c!==r.fallback&&E.push(c),c=_t(c.next);var N=E.length;if(N>0){var U=(i&oe)!==0&&n===0?e:null;if(a){for(m=0;m<N;m+=1)E[m].nodes?.a?.measure();for(m=0;m<N;m+=1)E[m].nodes?.a?.fix()}ei(r,E,U)}}a&&Yt(()=>{if(h!==void 0)for(g of h)g.nodes?.a?.apply()})}function ri(r,t,e,i,s,a,n,o){var c=(n&we)!==0?(n&_e)===0?Ee(e,!1,!1):Kt(e):null,d=(n&Ce)!==0?Kt(s):null;return{v:c,i:d,e:Vt(()=>(a(t,c??e,d??s,o),()=>{r.delete(i)}))}}function St(r,t,e){if(r.nodes)for(var i=r.nodes.start,s=r.nodes.end,a=t&&(t.f&lt)===0?t.nodes.start:e;i!==null;){var n=Ie(i);if(a.before(i),i===s)return;i=n}}function ut(r,t,e){t===null?r.effect.first=e:t.next=e,e===null?r.effect.last=t:e.prev=t}const si=()=>performance.now(),ot={tick:r=>requestAnimationFrame(r),now:()=>si(),tasks:new Set};function ue(){const r=ot.now();ot.tasks.forEach(t=>{t.c(r)||(ot.tasks.delete(t),t.f())}),ot.tasks.size!==0&&ot.tick(ue)}function ai(r){let t;return ot.tasks.size===0&&ot.tick(ue),{promise:new Promise(e=>{ot.tasks.add(t={c:r,f:e})}),abort(){ot.tasks.delete(t)}}}function Mt(r,t){de(()=>{r.dispatchEvent(new CustomEvent(t))})}function ni(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const t=r.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(e=>e[0].toUpperCase()+e.slice(1)).join("")}function Jt(r){const t={},e=r.split(";");for(const i of e){const[s,a]=i.split(":");if(!s||a===void 0)break;const n=ni(s.trim());t[n]=a.trim()}return t}const oi=r=>r;function Z(r,t,e,i){var s=(r&Fe)!==0,a=(r&ze)!==0,n=s&&a,o=(r&De)!==0,c=n?"both":s?"in":"out",d,u=t.inert,h=t.style.overflow,A,x;function w(){return de(()=>d??=e()(t,i?.()??{},{direction:c}))}var _={is_global:o,in(){if(t.inert=u,!s){x?.abort(),x?.reset?.();return}a||A?.abort(),A=jt(t,w(),x,1,()=>{Mt(t,"introend"),A?.abort(),A=d=void 0,t.style.overflow=h})},out(S){if(!a){S?.(),d=void 0;return}t.inert=!0,x=jt(t,w(),A,0,()=>{Mt(t,"outroend"),S?.()})},stop:()=>{A?.abort(),x?.abort()}},g=Pe;if((g.nodes.t??=[]).push(_),s&&Xe){var m=o;if(!m){for(var O=g.parent;O&&(O.f&Oe)!==0;)for(;(O=O.parent)&&(O.f&Me)===0;);m=!O||(O.f&Ne)!==0}m&&Be(()=>{Tt(()=>_.in())})}}function jt(r,t,e,i,s){var a=i===1;if(Re(t)){var n,o=!1;return Yt(()=>{if(!o){var g=t({direction:a?"in":"out"});n=jt(r,g,e,i,s)}}),{abort:()=>{o=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(e?.deactivate(),!t?.duration&&!t?.delay)return Mt(r,a?"introstart":"outrostart"),s(),{abort:wt,deactivate:wt,reset:wt,t:()=>i};const{delay:c=0,css:d,tick:u,easing:h=oi}=t;var A=[];if(a&&e===void 0&&(u&&u(0,1),d)){var x=Jt(d(0,1));A.push(x,x)}var w=()=>1-i,_=r.animate(A,{duration:c,fill:"forwards"});return _.onfinish=()=>{_.cancel(),Mt(r,a?"introstart":"outrostart");var g=e?.t()??1-i;e?.abort();var m=i-g,O=t.duration*Math.abs(m),S=[];if(O>0){var D=!1;if(d)for(var y=Math.ceil(O/16.666666666666668),P=0;P<=y;P+=1){var E=g+m*h(P/y),N=Jt(d(E,1-E));S.push(N),D||=N.overflow==="hidden"}D&&(r.style.overflow="hidden"),w=()=>{var U=_.currentTime;return g+m*h(U/O)},u&&ai(()=>{if(_.playState!=="running")return!1;var U=w();return u(U,1-U),!0})}_=r.animate(S,{duration:O,fill:"forwards"}),_.onfinish=()=>{w=()=>i,u?.(i,1-i),s()}},{abort:()=>{_&&(_.cancel(),_.effect=null,_.onfinish=wt)},deactivate:()=>{s=wt},reset:()=>{i===0&&u?.(1,0)},t:()=>w()}}function ve(r){var t,e,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(t=0;t<s;t++)r[t]&&(e=ve(r[t]))&&(i&&(i+=" "),i+=e)}else for(e in r)r[e]&&(i&&(i+=" "),i+=e);return i}function li(){for(var r,t,e=0,i="",s=arguments.length;e<s;e++)(r=arguments[e])&&(t=ve(r))&&(i&&(i+=" "),i+=t);return i}function ci(r){return typeof r=="object"?li(r):r??""}const te=[...` 	
\r\f¬†\v\uFEFF`];function di(r,t,e){var i=r==null?"":""+r;if(t&&(i=i?i+" "+t:t),e){for(var s in e)if(e[s])i=i?i+" "+s:s;else if(i.length)for(var a=s.length,n=0;(n=i.indexOf(s,n))>=0;){var o=n+a;(n===0||te.includes(i[n-1]))&&(o===i.length||te.includes(i[o]))?i=(n===0?"":i.substring(0,n))+i.substring(o+1):n=o}}return i===""?null:i}function ui(r,t){return r==null?null:String(r)}function et(r,t,e,i,s,a){var n=r.__className;if(q||n!==e||n===void 0){var o=di(e,i,a);(!q||o!==r.getAttribute("class"))&&(o==null?r.removeAttribute("class"):r.className=o),r.__className=e}else if(a&&s!==a)for(var c in a){var d=!!a[c];(s==null||d!==!!s[c])&&r.classList.toggle(c,d)}return a}function it(r,t,e,i){var s=r.__style;if(q||s!==t){var a=ui(t);(!q||a!==r.getAttribute("style"))&&(a==null?r.removeAttribute("style"):r.style.cssText=a),r.__style=t}return i}const vi=Symbol("is custom element"),fi=Symbol("is html");function gt(r){if(q){var t=!1,e=()=>{if(!t){if(t=!0,r.hasAttribute("value")){var i=r.value;xt(r,"value",null),r.value=i}if(r.hasAttribute("checked")){var s=r.checked;xt(r,"checked",null),r.checked=s}}};r.__on_r=e,Yt(e),Ve()}}function xt(r,t,e,i){var s=pi(r);q&&(s[t]=r.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&r.nodeName==="LINK")||s[t]!==(s[t]=e)&&(t==="loading"&&(r[Ke]=e),e==null?r.removeAttribute(t):typeof e!="string"&&hi(r).includes(t)?r[t]=e:r.setAttribute(t,e))}function pi(r){return r.__attributes??={[vi]:r.nodeName.includes("-"),[fi]:r.namespaceURI===Ue}}var ee=new Map;function hi(r){var t=r.getAttribute("is")||r.nodeName,e=ee.get(t);if(e)return e;ee.set(t,e=[]);for(var i,s=r,a=Element.prototype;a!==s;){i=He(s);for(var n in i)i[n].set&&e.push(n);s=Ge(s)}return e}function bt(r,t,e=t){var i=new WeakSet;$e(r,"input",async s=>{var a=s?r.defaultValue:r.value;if(a=Ut(r)?Gt(a):a,e(a),mt!==null&&i.add(mt),await je(),a!==(a=t())){var n=r.selectionStart,o=r.selectionEnd,c=r.value.length;if(r.value=a??"",o!==null){var d=r.value.length;n===o&&o===c&&d>c?(r.selectionStart=d,r.selectionEnd=d):(r.selectionStart=n,r.selectionEnd=Math.min(o,d))}}}),(q&&r.defaultValue!==r.value||Tt(t)==null&&r.value)&&(e(Ut(r)?Gt(r.value):r.value),mt!==null&&i.add(mt)),Qe(()=>{var s=t();if(r===document.activeElement){var a=Ye??mt;if(i.has(a))return}Ut(r)&&s===Gt(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function Ut(r){var t=r.type;return t==="number"||t==="range"}function Gt(r){return r===""?null:+r}function Bt(r){var t=Kt(0);return function(){return arguments.length===1?(T(t,p(t)+1),arguments[0]):(p(t),r())}}class Ai{#t=I(32);get width(){return p(this.#t)}set width(t){T(this.#t,t,!0)}#e=I(32);get height(){return p(this.#e)}set height(t){T(this.#e,t,!0)}#i=I(ht([]));get stitches(){return p(this.#i)}set stitches(t){T(this.#i,t,!0)}constructor(t=32,e=32){this.width=t,this.height=e,this.stitches=Array(t*e).fill(null)}reset(t,e,i){this.width=t,this.height=e,this.stitches=i}clear(){this.stitches=this.stitches.map(()=>null)}getIndex(t,e){return e*this.width+t}getColor(t,e){return this.stitches[this.getIndex(t,e)]}setColor(t,e,i){this.stitches[this.getIndex(t,e)]=i}isValidCoord(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}}class gi{#t=I(ht({x:0,y:0}));get pos(){return p(this.#t)}set pos(t){T(this.#t,t,!0)}#e=I(!0);get isVisible(){return p(this.#e)}set isVisible(t){T(this.#e,t,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(t,e){this.pos={x:t,y:e},this.resetInactivityTimer()}}class bi{#t=I("#073642");get activeDye(){return p(this.#t)}set activeDye(t){T(this.#t,t,!0)}#e=I(ht(["#073642","#586e75","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"]));get swatches(){return p(this.#e)}set swatches(t){T(this.#e,t,!0)}select(t){t>=0&&t<this.swatches.length&&(this.activeDye=this.swatches[t])}setDye(t){this.activeDye=t}}class xi{#t=I(1);get zoomLevel(){return p(this.#t)}set zoomLevel(t){T(this.#t,t,!0)}#e=I(!1);get isMuted(){return p(this.#e)}set isMuted(t){T(this.#e,t,!0)}#i=I(!1);get isAppReady(){return p(this.#i)}set isAppReady(t){T(this.#i,t,!0)}#r=I(!1);get isPicking(){return p(this.#r)}set isPicking(t){T(this.#r,t,!0)}#s=I(!1);get showDyeBasin(){return p(this.#s)}set showDyeBasin(t){T(this.#s,t,!0)}#a=I(!1);get showPatternCatalog(){return p(this.#a)}set showPatternCatalog(t){T(this.#a,t,!0)}#n=I(!1);get showArtisanGuide(){return p(this.#n)}set showArtisanGuide(t){T(this.#n,t,!0)}#o=I(!1);get showArtifactCrate(){return p(this.#o)}set showArtifactCrate(t){T(this.#o,t,!0)}#l=I(!1);get showLinenSettings(){return p(this.#l)}set showLinenSettings(t){T(this.#l,t,!0)}#c=I(!1);get showArchivePattern(){return p(this.#c)}set showArchivePattern(t){T(this.#c,t,!0)}#d=I(!1);get showGoTo(){return p(this.#d)}set showGoTo(t){T(this.#d,t,!0)}#u=I(10);get exportScale(){return p(this.#u)}set exportScale(t){T(this.#u,t,!0)}#v=I("transparent");get exportBgColor(){return p(this.#v)}set exportBgColor(t){T(this.#v,t,!0)}escapeStack=[];setZoom(t){const e=this.zoomLevel+t;this.zoomLevel=Math.max(.5,Math.min(5,Number(e.toFixed(1))))}resetZoom(){this.zoomLevel=1}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(t){this.escapeStack.push(t)}popEscapeAction(t){this.escapeStack=this.escapeStack.filter(e=>e!==t)}handleEscape(){const t=this.escapeStack.pop();return t?(t(),!0):!1}}class mi{#t=I("Untitled Stitch");get name(){return p(this.#t)}set name(t){T(this.#t,t,!0)}#e=I(null);get currentFilePath(){return p(this.#e)}set currentFilePath(t){T(this.#e,t,!0)}#i=I(null);get lastSaved(){return p(this.#i)}set lastSaved(t){T(this.#i,t,!0)}#r=I(null);get clipboard(){return p(this.#r)}set clipboard(t){T(this.#r,t,!0)}setMetadata(t,e=null){this.name=t,this.currentFilePath=e,this.lastSaved=new Date}}class yi{#t=I(null);get start(){return p(this.#t)}set start(t){T(this.#t,t,!0)}#e=I(null);get end(){return p(this.#e)}set end(t){T(this.#e,t,!0)}get isActive(){return this.start!==null}begin(t,e){this.start={x:t,y:e},this.end={x:t,y:e}}update(t,e){this.start&&(this.end={x:t,y:e})}clear(){this.start=null,this.end=null}get bounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}}class wi{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(t){t.oldColor!==t.newColor&&(this.currentBatch?this.currentBatch.push(t):(this.undoStack.push(t),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const t=this.undoStack.pop();return t?(this.redoStack.push(t),t):null}redo(){const t=this.redoStack.pop();return t?(this.undoStack.push(t),t):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const X=new wi;class _i{ctx=null;init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}playTone(t,e,i="sine",s=.1,a=1e-4){if(this.init(),!this.ctx||l.isMuted)return;const n=this.ctx.createOscillator(),o=this.ctx.createGain();n.type=i,n.frequency.setValueAtTime(t,this.ctx.currentTime),o.gain.setValueAtTime(s,this.ctx.currentTime),o.gain.exponentialRampToValueAtTime(a,this.ctx.currentTime+e),n.connect(o),o.connect(this.ctx.destination),n.start(),n.stop(this.ctx.currentTime+e)}playMove(){this.playTone(450,.08,"sine",.15)}playStitch(){this.playTone(1200,.15,"sine",.03),setTimeout(()=>this.playTone(1500,.1,"sine",.02),50)}playUnstitch(){if(this.init(),!this.ctx||l.isMuted)return;const t=.25,e=this.ctx.sampleRate*t,i=this.ctx.createBuffer(1,e,this.ctx.sampleRate),s=i.getChannelData(0);for(let c=0;c<e;c++)s[c]=Math.random()*2-1;const a=this.ctx.createBufferSource();a.buffer=i;const n=this.ctx.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(1500,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+t);const o=this.ctx.createGain();o.gain.setValueAtTime(.1,this.ctx.currentTime),o.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+t),a.connect(n),n.connect(o),o.connect(this.ctx.destination),a.start()}}const W=new _i;class Ei{move(t,e){const i=Math.max(0,Math.min(l.linen.width-1,l.needle.pos.x+t)),s=Math.max(0,Math.min(l.linen.height-1,l.needle.pos.y+e));return i!==l.needle.pos.x||s!==l.needle.pos.y?(l.needle.setPos(i,s),W.playMove(),!0):!1}}class Ci{stitch(){const{x:t,y:e}=l.needle.pos,i=l.linen.getIndex(t,e),s=l.linen.stitches[i],a=l.paletteState.activeDye;s!==a&&(X.push({index:i,oldColor:s,newColor:a}),l.linen.setColor(t,e,a),W.playStitch())}unstitch(){const{x:t,y:e}=l.needle.pos,i=l.linen.getIndex(t,e),s=l.linen.stitches[i];s!==null&&(X.push({index:i,oldColor:s,newColor:null}),l.linen.setColor(t,e,null),W.playUnstitch())}pickDye(){const{x:t,y:e}=l.needle.pos,i=l.linen.getColor(t,e);i!==null&&(l.paletteState.setDye(i),W.playStitch(),l.studio.isPicking=!0,setTimeout(()=>{l.studio.isPicking=!1},1500))}}class Si{resize(t,e){const i=Array(t*e).fill("#eee8d5");for(let s=0;s<Math.min(l.linen.height,e);s++)for(let a=0;a<Math.min(l.linen.width,t);a++){const n=s*l.linen.width+a,o=s*t+a;i[o]=l.linen.stitches[n]}l.linen.reset(t,e,i),X.clear(),W.playStitch()}flip(t){const{width:e,height:i,stitches:s}=l.linen,a=[...s];if(t==="horizontal")for(let n=0;n<i;n++){const o=s.slice(n*e,(n+1)*e);o.reverse();for(let c=0;c<e;c++)a[n*e+c]=o[c]}else for(let n=0;n<i;n++)for(let o=0;o<e;o++){const c=n*e+o,d=(i-1-n)*e+o;a[d]=s[c]}l.linen.stitches=a,X.clear(),W.playStitch()}rotate(){const{width:t,height:e,stitches:i}=l.linen;if(t!==e)return;const s=Array(t*e).fill("#eee8d5");for(let a=0;a<e;a++)for(let n=0;n<t;n++){const o=a*t+n,c=n*t+(e-1-a);s[c]=i[o]}l.linen.stitches=s,X.clear(),W.playStitch()}clearAll(){confirm("Are you sure you want to unravel the entire project?")&&(l.linen.clear(),X.clear(),W.playUnstitch())}}class Ti{copy(){const t=l.selection.bounds;if(!t)return;const{x1:e,x2:i,y1:s,y2:a}=t,n=i-e+1,o=a-s+1,c=[];for(let d=s;d<=a;d++)for(let u=e;u<=i;u++)c.push(l.linen.getColor(u,d));l.project.clipboard={width:n,height:o,data:c},W.playStitch()}cut(){this.copy();const t=l.selection.bounds;if(!t)return;const{x1:e,x2:i,y1:s,y2:a}=t;X.beginBatch();for(let n=s;n<=a;n++)for(let o=e;o<=i;o++){const c=l.linen.getIndex(o,n),d=l.linen.stitches[c];d!==null&&(X.push({index:c,oldColor:d,newColor:null}),l.linen.setColor(o,n,null))}X.endBatch(),W.playUnstitch()}paste(){const t=l.project.clipboard;if(!t)return;const{x:e,y:i}=l.needle.pos;X.beginBatch();for(let s=0;s<t.height;s++)for(let a=0;a<t.width;a++){const n=e+a,o=i+s;if(l.linen.isValidCoord(n,o)){const c=l.linen.getIndex(n,o),d=l.linen.stitches[c],u=t.data[s*t.width+a];d!==u&&(X.push({index:c,oldColor:d,newColor:u}),l.linen.setColor(n,o,u))}}X.endBatch(),W.playStitch()}}class ki{serialize(){return JSON.stringify({version:l.version,metadata:{name:l.project.name,lastModified:new Date().toISOString()},dimensions:{width:l.linen.width,height:l.linen.height},palette:l.paletteState.swatches,pixelData:l.linen.stitches})}async save(){const t=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(t);return}const e=await window.electronAPI.saveFile(t,l.project.currentFilePath||void 0);e&&(l.project.setMetadata(l.project.name,e),W.playStitch())}webDownload(t){const e=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download=`${l.project.name.toLowerCase().replace(/\s+/g,"-")}.rupa`,s.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const t=await window.electronAPI.openFile();t&&(this.deserialize(t.content),l.project.setMetadata(l.project.name,t.filePath),W.playStitch())}webUpload(){const t=document.createElement("input");t.type="file",t.accept=".rupa",t.onchange=e=>{const i=e.target.files?.[0];if(i){const s=new FileReader;s.onload=a=>this.deserialize(a.target?.result),s.readAsText(i)}},t.click()}async backup(){const t=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(t),l.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",t)}deserialize(t){try{const e=JSON.parse(t);l.linen.reset(e.dimensions.width,e.dimensions.height,e.pixelData),l.paletteState.swatches=e.palette,l.project.name=e.metadata.name,X.clear()}catch(e){console.error("Failed to restore pattern book:",e)}}}class Li{movement=new Ei;stitching=new Ci;manipulation=new Si;clipboard=new Ti;persistence=new ki;moveNeedle(t,e){return this.movement.move(t,e)}stitch(){this.stitching.stitch()}unstitch(){this.stitching.unstitch()}pickDye(){this.stitching.pickDye()}startSelection(){l.selection.begin(l.needle.pos.x,l.needle.pos.y)}updateSelection(){l.selection.update(l.needle.pos.x,l.needle.pos.y)}commitSelection(){const t=l.selection.bounds;if(!t)return;const{x1:e,x2:i,y1:s,y2:a}=t,n=l.paletteState.activeDye;history.beginBatch();for(let o=s;o<=a;o++)for(let c=e;c<=i;c++){const d=l.linen.getIndex(c,o),u=l.linen.stitches[d];u!==n&&(history.push({index:d,oldColor:u,newColor:n}),l.linen.setColor(c,o,n))}history.endBatch(),sfx.playStitch()}clearLinen(){this.manipulation.clearAll()}resizeLinen(t,e){this.manipulation.resize(t,e)}flipLinen(t){this.manipulation.flip(t)}rotateLinen(){this.manipulation.rotate()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),l.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}}const z=new Li;class Ii{version="0.3.0";linen=new Ai;needle=new gi;paletteState=new bi;studio=new xi;project=new mi;selection=new yi;get stitches(){return this.linen.stitches}set stitches(t){this.linen.stitches=t}get linenWidth(){return this.linen.width}set linenWidth(t){this.linen.width=t}get linenHeight(){return this.linen.height}set linenHeight(t){this.linen.height=t}get needlePos(){return this.needle.pos}set needlePos(t){this.needle.pos=t}get activeDye(){return this.paletteState.activeDye}set activeDye(t){this.paletteState.activeDye=t}get palette(){return this.paletteState.swatches}set palette(t){this.paletteState.swatches=t}get zoomLevel(){return this.studio.zoomLevel}set zoomLevel(t){this.studio.zoomLevel=t}get isMuted(){return this.studio.isMuted}set isMuted(t){this.studio.isMuted=t}get isPicking(){return this.studio.isPicking}set isPicking(t){this.studio.isPicking=t}get isAppReady(){return this.studio.isAppReady}set isAppReady(t){this.studio.isAppReady=t}get isNeedleVisible(){return this.needle.isVisible}set isNeedleVisible(t){this.needle.isVisible=t}get projectName(){return this.project.name}set projectName(t){this.project.name=t}get currentFilePath(){return this.project.currentFilePath}set currentFilePath(t){this.project.currentFilePath=t}get lastSaved(){return this.project.lastSaved}set lastSaved(t){this.project.lastSaved=t}get clipboard(){return this.project.clipboard}set clipboard(t){this.project.clipboard=t}get showDyeBasin(){return this.studio.showDyeBasin}set showDyeBasin(t){this.studio.showDyeBasin=t}get showPatternCatalog(){return this.studio.showPatternCatalog}set showPatternCatalog(t){this.studio.showPatternCatalog=t}get showArtisanGuide(){return this.studio.showArtisanGuide}set showArtisanGuide(t){this.studio.showArtisanGuide=t}get showArtifactCrate(){return this.studio.showArtifactCrate}set showArtifactCrate(t){this.studio.showArtifactCrate=t}get showLinenSettings(){return this.studio.showLinenSettings}set showLinenSettings(t){this.studio.showLinenSettings=t}get showArchivePattern(){return this.studio.showArchivePattern}set showArchivePattern(t){this.studio.showArchivePattern=t}get showGoTo(){return this.studio.showGoTo}set showGoTo(t){this.studio.showGoTo=t}get exportScale(){return this.studio.exportScale}set exportScale(t){this.studio.exportScale=t}get exportBgColor(){return this.studio.exportBgColor}set exportBgColor(t){this.studio.exportBgColor=t}get selectionStart(){return this.selection.start}set selectionStart(t){this.selection.start=t}get selectionEnd(){return this.selection.end}set selectionEnd(t){this.selection.end=t}#t=ft(()=>{const t=new Set;return this.linen.stitches.forEach(e=>{e!==null&&t.add(e)}),Array.from(t)});get usedColors(){return p(this.#t)}set usedColors(t){T(this.#t,t)}#e=ft(()=>{const t=(e,i)=>{const s=Math.floor(i/2);return i%2===0?e<s?e-s:e-s+1:e-s};return{x:t(this.needle.pos.x,this.linen.width),y:-t(this.needle.pos.y,this.linen.height)}});get displayCoords(){return p(this.#e)}set displayCoords(t){T(this.#e,t)}#i=ft(()=>{if(this.studio.zoomLevel<=1)return`scale(${this.studio.zoomLevel})`;const t=(this.needle.pos.x+.5)/this.linen.width*100,e=(this.needle.pos.y+.5)/this.linen.height*100;return`translate(${50-t}%, ${50-e}%) scale(${this.studio.zoomLevel})`});get cameraTransform(){return p(this.#i)}set cameraTransform(t){T(this.#i,t)}resetInactivityTimer(){this.needle.resetInactivityTimer()}toggleMute(){this.studio.toggleMute()}setZoom(t){this.studio.setZoom(t)}resetZoom(){this.studio.resetZoom()}selectPalette(t){this.paletteState.select(t)}pushEscapeAction(t){this.studio.pushEscapeAction(t)}popEscapeAction(t){this.studio.popEscapeAction(t)}handleEscape(){return this.studio.handleEscape()}undo(){const t=X.undo();if(t){if(Array.isArray(t))for(let e=t.length-1;e>=0;e--){const i=t[e];this.linen.stitches[i.index]=i.oldColor}else this.linen.stitches[t.index]=t.oldColor;W.playUnstitch()}this.needle.resetInactivityTimer()}redo(){const t=X.redo();if(t){if(Array.isArray(t))for(const e of t)this.linen.stitches[e.index]=e.newColor;else this.linen.stitches[t.index]=t.newColor;W.playStitch()}this.needle.resetInactivityTimer()}clearLinen(){z.clearLinen()}pickDye(){z.pickDye()}loadProject(){z.load()}copySelection(){z.copy()}cutSelection(){z.cut()}pasteSelection(){z.paste()}flipLinen(t){z.flipLinen(t)}rotateLinen(){z.rotateLinen()}}const l=new Ii,Pi={UP:["ArrowUp"],DOWN:["ArrowDown"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"],GOTO:["g"]},Oi={STITCH:["Space","Shift+Space"],UNSTITCH:["Backspace","Delete"],UNSTITCH_MOD:["Ctrl+Space"],EYEDROPPER:["i","Alt+Space"]},Mi={UNDO:["Ctrl+z"],REDO:["Ctrl+Shift+z","Ctrl+y"]},Ni={COPY:["Ctrl+c"],CUT:["Ctrl+x"],PASTE:["Ctrl+v"],FLIP_H:["h"],FLIP_V:["v"],ROTATE:["r"]},Bi={ZOOM_IN:["+","="],ZOOM_OUT:["-"],RESET_ZOOM:["Ctrl+0"]},Di={COMMAND_PALETTE:["Ctrl+k"],EXPORT:["Ctrl+e"],SAVE:["Ctrl+s"],OPEN:["Ctrl+o"],SETTINGS:["Ctrl+,"],COLOR_PICKER:["Ctrl+p"],CLEAR_LINEN:["Ctrl+l"],TOGGLE_MUTE:["Ctrl+m"],ESCAPE:["Escape"]},Ri={SELECT_1:["1"],SELECT_2:["2"],SELECT_3:["3"],SELECT_4:["4"],SELECT_5:["5"],SELECT_6:["6"],SELECT_7:["7"],SELECT_8:["8"],SELECT_9:["9"],SELECT_0:["0"]},Fi={FLOW_STITCH:["Control"],FLOW_UNSTITCH:["Ctrl+Shift"],FLOW_SELECT:["Shift"]},zi={navigation:Pi,canvas:Oi,history:Mi,manipulation:Ni,view:Bi,studio:Di,palette:Ri,modifiers:Fi};class Ui{patterns=[];#t=I(ht([]));get activeKeys(){return p(this.#t)}set activeKeys(t){T(this.#t,t,!0)}#e=I(!1);get isCtrlActive(){return p(this.#e)}set isCtrlActive(t){T(this.#e,t,!0)}#i=I(!1);get isShiftActive(){return p(this.#i)}set isShiftActive(t){T(this.#i,t,!0)}#r=I(!1);get isAltActive(){return p(this.#r)}set isAltActive(t){T(this.#r,t,!0)}constructor(){this.loadPatterns()}loadPatterns(){const t={UP:"MOVE_UP",DOWN:"MOVE_DOWN",LEFT:"MOVE_LEFT",RIGHT:"MOVE_RIGHT",GOTO:"GOTO",STITCH:"STITCH",UNSTITCH:"UNSTITCH",EYEDROPPER:"PICK_DYE",SAVE:"OPEN_ARCHIVE",OPEN:"OPEN",SETTINGS:"OPEN_SETTINGS",FLOW_STITCH:"FLOW_STITCH",FLOW_UNSTITCH:"FLOW_UNSTITCH",FLOW_SELECT:"FLOW_SELECT",UNDO:"UNDO",REDO:"REDO",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",COMMAND_PALETTE:"OPEN_PALETTE",COLOR_PICKER:"OPEN_DYES",EXPORT:"OPEN_EXPORT",CLEAR_LINEN:"CLEAR_LINEN",TOGGLE_MUTE:"TOGGLE_MUTE",ESCAPE:"ESCAPE",COPY:"COPY",CUT:"CUT",PASTE:"PASTE",FLIP_H:"FLIP_H",FLIP_V:"FLIP_V",ROTATE:"ROTATE",SELECT_1:"SELECT_DYE_1",SELECT_2:"SELECT_DYE_2",SELECT_3:"SELECT_DYE_3",SELECT_4:"SELECT_DYE_4",SELECT_5:"SELECT_DYE_5",SELECT_6:"SELECT_DYE_6",SELECT_7:"SELECT_DYE_7",SELECT_8:"SELECT_DYE_8",SELECT_9:"SELECT_DYE_9",SELECT_0:"SELECT_DYE_0"};Object.values(zi).forEach(e=>{Object.entries(e).forEach(([i,s])=>{const a=t[i];a&&s.forEach(n=>{const o=n.toLowerCase().split("+");let c=o[o.length-1].trim();c==="space"&&(c=" "),(c==="ctrl"||c==="control")&&(c="control"),this.patterns.push({intent:a,key:c,ctrl:o.includes("ctrl")||o.includes("control"),shift:o.includes("shift"),alt:o.includes("alt")})})})}),this.patterns.sort((e,i)=>{const s=a=>(a.ctrl?1:0)+(a.shift?1:0)+(a.alt?1:0);return s(i)-s(e)})}updatePhysicalState(t,e){const i=t.key.toLowerCase();e==="down"?this.activeKeys.includes(i)||this.activeKeys.push(i):(this.activeKeys=this.activeKeys.filter(s=>s!==i),i==="alt"&&!t.altKey&&(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))),this.isCtrlActive=t.ctrlKey||t.metaKey,this.isShiftActive=t.shiftKey,this.isAltActive=t.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="control"&&s!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))}getIntent(t){const e=t.key.toLowerCase();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(e)){if(e==="arrowup")return"MOVE_UP";if(e==="arrowdown")return"MOVE_DOWN";if(e==="arrowleft")return"MOVE_LEFT";if(e==="arrowright")return"MOVE_RIGHT"}for(const i of this.patterns)if(e===i.key&&this.isCtrlActive===i.ctrl&&this.isShiftActive===i.shift&&this.isAltActive===i.alt)return i.intent;return null}getLabel(t){const e=this.patterns.find(s=>s.intent===t);if(!e)return"";let i="";return e.ctrl&&(i+="Ctrl+"),e.shift&&(i+="Shift+"),e.alt&&(i+="Alt+"),i+=e.key===" "?"Space":e.key.toUpperCase(),i}}const G=new Ui;class Gi{#t=ft(()=>l.isPicking?{type:"PICKING",label:"Picking Dye",icon:"üìç",color:"var(--color-brand)",isPulse:!0}:G.isCtrlActive&&G.isShiftActive?{type:"UNRAVELLING",label:"Unravelling",icon:"üß∂",color:"var(--color-brand)",isPulse:!0}:G.isShiftActive?{type:"LOOMING",label:"Block Looming",icon:"‚ú®",color:"var(--color-brand)",isPulse:!0}:G.isCtrlActive?{type:"THREADING",label:"Threading",icon:"üßµ",color:"var(--color-studio-teal)",isPulse:!0}:{type:"RESTING",label:"Studio Ready",icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return p(this.#t)}set current(t){T(this.#t,t)}}const J=new Gi;class Hi{handleInput(t,e){if(!l.studio.isAppReady)return;G.updatePhysicalState(t,e);const i=t.target;if(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i.isContentEditable){e==="down"&&t.key==="Escape"&&l.handleEscape();return}if(l.needle.resetInactivityTimer(),e==="down"){const s=G.getIntent(t);console.log("Loom Intent:",s,"Key:",t.key,"Shift:",t.shiftKey),s&&this.executeIntent(s,t)}}executeIntent(t,e){switch(t.startsWith("MOVE_")||e.preventDefault(),t){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"GOTO":return l.studio.showGoTo=!0;case"STITCH":return l.selection.isActive?z.commitSelection():z.stitching.stitch();case"UNSTITCH":return z.stitching.unstitch();case"PICK_DYE":return z.stitching.pickDye();case"COPY":return z.clipboard.copy();case"CUT":return z.clipboard.cut();case"PASTE":return z.clipboard.paste();case"UNDO":return l.undo();case"REDO":return l.redo();case"SAVE":return z.persistence.save();case"OPEN":return z.persistence.load();case"OPEN_ARCHIVE":return l.studio.showArchivePattern=!0;case"OPEN_SETTINGS":return l.studio.showLinenSettings=!0;case"ESCAPE":if(l.selection.isActive){l.selection.clear();return}return l.handleEscape();case"OPEN_PALETTE":return l.studio.showPatternCatalog=!l.studio.showPatternCatalog;case"OPEN_DYES":return l.studio.showDyeBasin=!l.studio.showDyeBasin;case"OPEN_EXPORT":return l.studio.showArtifactCrate=!0;case"OPEN_HELP":return l.studio.showArtisanGuide=!0;case"ZOOM_IN":return l.studio.setZoom(.1);case"ZOOM_OUT":return l.studio.setZoom(-.1);case"RESET_ZOOM":return l.studio.resetZoom();case"CLEAR_LINEN":return z.manipulation.clearAll();case"TOGGLE_MUTE":return l.studio.toggleMute();case"FLIP_H":return z.manipulation.flip("horizontal");case"FLIP_V":return z.manipulation.flip("vertical");case"ROTATE":return z.manipulation.rotate();default:if(t.startsWith("SELECT_DYE_")){const s=parseInt(t.split("_")[2]);return l.paletteState.select(s===0?9:s-1)}}}executeMove(t,e){if(z.movement.move(t,e)){const i=J.current.type;i==="LOOMING"&&(l.selection.isActive||z.startSelection(),z.updateSelection()),i==="THREADING"&&z.stitching.stitch(),i==="UNRAVELLING"&&z.stitching.unstitch()}}}const ie=new Hi;class re{static toSVG(t,e,i,s="transparent"){let a=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${e}" shape-rendering="crispEdges">`;s!=="transparent"&&(a+=`<rect width="${t}" height="${e}" fill="${s}" />`);const n=new Array(i.length).fill(!1);for(let o=0;o<e;o++)for(let c=0;c<t;c++){const d=o*t+c,u=i[d];if(u===null||n[d])continue;const h=this.findCluster(c,o,t,e,i,n);this.greedyRectMerge(h,t).forEach(x=>{a+=`<rect x="${x.x}" y="${x.y}" width="${x.w}" height="${x.h}" fill="${u}" />`})}return a+="</svg>",a}static findCluster(t,e,i,s,a,n){const o=a[e*i+t],c=new Set,d=[[t,e]];for(n[e*i+t]=!0,c.add(e*i+t);d.length>0;){const[u,h]=d.shift(),A=[[u+1,h],[u-1,h],[u,h+1],[u,h-1]];for(const[x,w]of A)if(x>=0&&x<i&&w>=0&&w<s){const _=w*i+x;!n[_]&&a[_]===o&&(n[_]=!0,c.add(_),d.push([x,w]))}}return c}static greedyRectMerge(t,e){const i=[],s=new Set,a=Array.from(t).sort((n,o)=>n-o);for(const n of a){if(s.has(n))continue;const o=n%e,c=Math.floor(n/e);let d=1;for(;t.has(c*e+(o+d))&&!s.has(c*e+(o+d));)d++;let u=1,h=!0;for(;h;){const A=c+u;for(let x=o;x<o+d;x++){const w=A*e+x;if(!t.has(w)||s.has(w)){h=!1;break}}h&&u++}i.push({x:o,y:c,w:d,h:u});for(let A=c;A<c+u;A++)for(let x=o;x<o+d;x++)s.add(A*e+x)}return i}static async toPNG(t,e,i,s,a="transparent"){const n=document.createElement("canvas"),o=Math.max(1,Math.round(t*s)),c=Math.max(1,Math.round(e*s));n.width=o,n.height=c;const d=n.getContext("2d");if(!d)throw new Error("Could not get canvas context");return d.imageSmoothingEnabled=!1,a!=="transparent"&&(d.fillStyle=a,d.fillRect(0,0,o,c)),i.forEach((u,h)=>{if(u===null)return;const A=h%t,x=Math.floor(h/t);d.fillStyle=u,d.fillRect(Math.floor(A*s),Math.floor(x*s),Math.ceil(s),Math.ceil(s))}),n.toDataURL("image/png")}}var Vi=L(`<div class="pointer-events-none fixed top-0 left-0 z-40 flex w-full justify-center p-6"><div class="flex flex-col items-center"><span class="font-tiny5 text-4xl text-brand opacity-90 drop-shadow-sm">Rupa</span> <span class="-mt-1 font-serif text-[9px] font-bold tracking-[0.3em] uppercase opacity-30">The Weaver's Studio</span></div></div>`);function Ki(r){var t=Vi();C(r,t)}var vt=Bt(()=>l),$i=L('<div class="artisan-panel pointer-events-auto flex gap-2 rounded-2xl border-b-2 border-white px-4 py-2 shadow-sm"><button class="artisan-tool-btn !py-1.5"><span>üìñ</span> Catalog</button> <button class="artisan-tool-btn !py-1.5"><span>üß∫</span> Export</button> <button class="artisan-tool-btn !py-1.5"><span>üåø</span> Clear</button> <button class="artisan-tool-btn !py-1.5"><span> </span> </button></div>');function ji(r,t){H(t,!1),rt();var e=$i(),i=f(e);i.__click=()=>vt(vt().studio.showPatternCatalog=!0);var s=b(i,2);s.__click=()=>vt(vt().studio.showArtifactCrate=!0);var a=b(s,2);a.__click=()=>vt().clearLinen();var n=b(a,2);n.__click=()=>vt().studio.toggleMute();var o=f(n),c=f(o,!0);v(o);var d=b(o);v(n),v(e),M(()=>{R(c,vt().studio.isMuted?"üîá":"üîä"),R(d,` ${vt().studio.isMuted?"Unmute":"Mute"}`)}),C(r,e),V()}at(["click"]);const Qi=r=>r;function Xt(r){const t=r-1;return t*t*t+1}function se(r){const t=typeof r=="string"&&r.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[r,"px"]}function pt(r,{delay:t=0,duration:e=400,easing:i=Qi}={}){const s=+getComputedStyle(r).opacity;return{delay:t,duration:e,easing:i,css:a=>`opacity: ${a*s}`}}function Yi(r,{delay:t=0,duration:e=400,easing:i=Xt,x:s=0,y:a=0,opacity:n=0}={}){const o=getComputedStyle(r),c=+o.opacity,d=o.transform==="none"?"":o.transform,u=c*(1-n),[h,A]=se(s),[x,w]=se(a);return{delay:t,duration:e,easing:i,css:(_,g)=>`
			transform: ${d} translate(${(1-_)*h}${A}, ${(1-_)*x}${w});
			opacity: ${c-u*g}`}}function Xi(r,{delay:t=0,duration:e=400,easing:i=Xt,axis:s="y"}={}){const a=getComputedStyle(r),n=+a.opacity,o=s==="y"?"height":"width",c=parseFloat(a[o]),d=s==="y"?["top","bottom"]:["left","right"],u=d.map(m=>`${m[0].toUpperCase()}${m.slice(1)}`),h=parseFloat(a[`padding${u[0]}`]),A=parseFloat(a[`padding${u[1]}`]),x=parseFloat(a[`margin${u[0]}`]),w=parseFloat(a[`margin${u[1]}`]),_=parseFloat(a[`border${u[0]}Width`]),g=parseFloat(a[`border${u[1]}Width`]);return{delay:t,duration:e,easing:i,css:m=>`overflow: hidden;opacity: ${Math.min(m*20,1)*n};${o}: ${m*c}px;padding-${d[0]}: ${m*h}px;padding-${d[1]}: ${m*A}px;margin-${d[0]}: ${m*x}px;margin-${d[1]}: ${m*w}px;border-${d[0]}-width: ${m*_}px;border-${d[1]}-width: ${m*g}px;min-${o}: 0`}}function It(r,{delay:t=0,duration:e=400,easing:i=Xt,start:s=0,opacity:a=0}={}){const n=getComputedStyle(r),o=+n.opacity,c=n.transform==="none"?"":n.transform,d=1-s,u=o*(1-a);return{delay:t,duration:e,easing:i,css:(h,A)=>`
			transform: ${c} scale(${1-d*A});
			opacity: ${o-u*A}
		`}}var Zi=L('<span class="mr-4 font-serif text-[9px] font-bold tracking-widest uppercase opacity-20"> </span>'),Wi=L('<div class="pointer-events-auto flex flex-col items-end gap-2"><div class="artisan-panel rounded-2xl border-b-2 border-white px-6 py-3 shadow-sm"><h2 class="font-serif text-xs font-bold tracking-[0.2em] uppercase opacity-40"> </h2></div> <!></div>');function qi(r,t){H(t,!1),rt();var e=Wi(),i=f(e),s=f(i),a=f(s,!0);v(s),v(i);var n=b(i,2);{var o=c=>{var d=Zi(),u=f(d);v(d),M(h=>R(u,`Last Archived: ${h??""}`),[()=>l.project.lastSaved.toLocaleTimeString()]),Z(3,d,()=>pt),C(c,d)};$(n,c=>{l.project.lastSaved&&c(o)})}v(e),M(()=>R(a,l.project.name)),C(r,e),V()}var Ji=L('<div class="pointer-events-none fixed top-0 left-0 z-50 flex w-full items-start justify-between p-8"><div class="flex items-start gap-8"><div class="pointer-events-auto"><!></div> <!></div> <!></div>');function tr(r){var t=Ji(),e=f(t),i=f(e),s=f(i);Ki(s),v(i);var a=b(i,2);ji(a,{}),v(e);var n=b(e,2);qi(n,{}),v(t),C(r,t)}var Et=Bt(()=>l),er=L("<button></button>"),ir=L('<div class="artisan-panel flex flex-col gap-2 rounded-2xl border-l-2 border-white p-2 shadow-sm"><span class="mb-1 text-center font-serif text-[7px] font-bold uppercase opacity-30">Dyes</span> <!> <div class="mx-auto my-1 h-px w-4 bg-studio-text/10"></div> <button class="h-7 w-7 rounded-full border-2 border-dashed border-brand/40 bg-gradient-to-tr from-rose-200 to-sky-200 shadow-sm transition-all hover:scale-110 hover:border-brand" title="Natural Dye Basin"></button></div>');function rr(r,t){H(t,!1),rt();var e=ir(),i=b(f(e),2);dt(i,1,()=>Et().palette,At,(a,n,o)=>{var c=er();c.__click=()=>Et().selectPalette(o),xt(c,"aria-label",`Select dye ${o+1}`),M(()=>{et(c,1,`h-7 w-7 rounded-full border-2 transition-all ${Et().activeDye===p(n)?"scale-110 border-brand shadow-md ring-2 ring-white":"border-white opacity-70 hover:scale-105 hover:opacity-100"}`),it(c,`background-color: ${p(n)??""};`)}),C(a,c)});var s=b(i,4);s.__click=()=>Et(Et().studio.showDyeBasin=!0),v(e),C(r,e),V()}at(["click"]);var sr=L('<div class="pointer-events-none fixed top-0 left-0 z-40 flex h-full items-center p-8"><div class="pointer-events-auto"><!></div></div>');function ar(r){var t=sr(),e=f(t),i=f(e);rr(i,{}),v(e),v(t),C(r,t)}var Ct=Bt(()=>l),nr=L('<button class="group relative h-5 w-5 shrink-0 rounded-md border-2 border-white shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[6px] drop-shadow-sm">üìç</span></div></button>'),or=L('<div class="flex h-5 w-5 items-center justify-center rounded-md border-2 border-dashed border-studio-text/10"><span class="text-[6px] opacity-20">üßµ</span></div>'),lr=L('<div class="artisan-panel flex flex-col gap-4 border-r-2 border-white px-3 py-4 shadow-sm"><div class="flex flex-col items-center gap-2"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Active Dye</span> <div class="h-8 w-8 rounded-lg border-2 border-white shadow-md transition-colors"></div> <span class="font-mono text-[8px] font-bold tracking-tighter uppercase opacity-40"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col gap-3"><span class="text-center font-serif text-[7px] font-bold uppercase opacity-30">Used Dyes</span> <div class="no-scrollbar grid max-h-[140px] grid-cols-3 gap-1.5 overflow-y-auto svelte-1dy8mnv"></div></div></div>');function cr(r,t){H(t,!1),rt();var e=lr(),i=f(e),s=b(f(i),2),a=b(s,2),n=f(a,!0);v(a),v(i);var o=b(i,4),c=b(f(o),2);dt(c,5,()=>Ct().usedColors,d=>d,(d,u)=>{var h=nr();h.__click=()=>Ct(Ct().paletteState.activeDye=p(u)),M(()=>{it(h,`background-color: ${p(u)??""};`),xt(h,"title",p(u))}),Z(3,h,()=>Xi,()=>({duration:200})),C(d,h)},d=>{var u=or();C(d,u)}),v(c),v(o),v(e),M(()=>{it(s,`background-color: ${Ct().paletteState.activeDye??""};`),R(n,Ct().paletteState.activeDye)}),C(r,e),V()}at(["click"]);var dr=L('<div class="artisan-panel stats-panel rounded-2xl border-r-2 border-white px-4 py-3 shadow-sm"><div class="flex flex-col gap-2"><div class="flex flex-col"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Needle Focus</span> <span class="font-mono text-[10px] font-bold tabular-nums"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Linen Size</span> <span class="font-mono text-[10px] font-bold tabular-nums"> </span></div></div></div>');function ur(r,t){H(t,!1),rt();var e=dr(),i=f(e),s=f(i),a=b(f(s),2),n=f(a);v(a),v(s);var o=b(s,4),c=b(f(o),2),d=f(c);v(c),v(o),v(i),v(e),M(()=>{R(n,`${l.displayCoords.x??""}, ${l.displayCoords.y??""}`),R(d,`${l.linen.width??""}√ó${l.linen.height??""}`)}),C(r,e),V()}var vr=L('<div class="pointer-events-none fixed top-0 right-0 z-40 flex h-full flex-col items-end justify-center gap-6 p-8"><div class="pointer-events-auto"><!></div> <div class="pointer-events-auto"><!></div></div>');function fr(r){var t=vr(),e=f(t),i=f(e);ur(i,{}),v(e);var s=b(e,2),a=f(s);cr(a,{}),v(s),v(t),C(r,t)}var pr=L('<span class="text-xs"> </span>'),hr=L('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),Ar=L("<div><!> <span> </span> <!></div>"),gr=L('<div class="text-[8px] font-bold tracking-[0.2em] uppercase opacity-20"> </div>'),br=L('<div><div class="flex w-[180px] items-center"><!></div> <!></div>');function xr(r,t){H(t,!1),rt();var e=br(),i=f(e),s=f(i);ti(s,()=>J.current.type,o=>{var c=Ar(),d=f(c);{var u=_=>{var g=pr(),m=f(g,!0);v(g),M(()=>R(m,J.current.icon)),C(_,g)};$(d,_=>{J.current.icon&&_(u)})}var h=b(d,2),A=f(h,!0);v(h);var x=b(h,2);{var w=_=>{var g=hr(),m=f(g);v(g),M(()=>R(m,`v${l.version??""}`)),C(_,g)};$(x,_=>{J.current.type==="RESTING"&&_(w)})}v(c),M(()=>{et(c,1,`status-tag flex items-center gap-2 ${J.current.isPulse?"animate-pulse":""}`),it(c,`
					border-color: color-mix(in srgb, ${J.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${J.current.color??""} 10%, transparent);
					color: ${J.current.color??""};
				`),et(h,1,ci(J.current.type==="RESTING"?"font-serif italic opacity-60":"font-bold")),R(A,J.current.label)}),C(o,c)}),v(i);var a=b(i,2);{var n=o=>{const c=tt(()=>l.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var d=gr(),u=f(d);v(d),M(()=>R(u,`Linen Backed Up: ${p(c)??""}`)),C(o,d)};$(a,o=>{l.project.lastSaved&&o(n)})}v(e),M(()=>et(e,1,`flex items-center gap-4 transition-opacity duration-1000 ${l.needle.isVisible?"opacity-100":"opacity-0"}`)),C(r,e),V()}var mr=L('<span class="rounded bg-brand/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-brand uppercase"> </span>'),yr=L('<span class="font-mono text-[9px] italic opacity-20">None</span>'),wr=L('<div class="flex items-center gap-1.5"><span class="text-[10px]">üíæ</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand uppercase"> </span></div> <div class="h-3 w-px bg-brand/20"></div>',1),_r=L('<div class="pointer-events-none fixed bottom-0 left-0 z-[1000] w-full"><div class="flex h-7 w-full items-center justify-between border-t border-brand/20 bg-white/90 px-6 shadow-2xl backdrop-blur-md"><div class="flex items-center gap-6"><div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic">Chord:</span> <div class="flex min-w-[120px] gap-1.5"><!></div></div> <div class="h-3 w-px bg-brand/10"></div> <div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic">Stance:</span> <span class="font-mono text-[9px] font-bold text-brand uppercase"> </span></div></div> <div class="flex items-center gap-4 opacity-40"><!> <div class="flex gap-3 font-mono text-[8px] font-bold tracking-tighter uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-brand/20"></div> <span class="font-mono text-[9px] font-black tracking-widest text-brand/60 uppercase">Technical Ledger</span></div></div></div>');function Er(r,t){H(t,!1),rt();var e=_r(),i=f(e),s=f(i),a=f(s),n=b(f(a),2),o=f(n);{var c=E=>{var N=yt(),U=ct(N);dt(U,1,()=>G.activeKeys,At,(B,k)=>{var K=mr(),j=f(K,!0);v(K),M(()=>R(j,p(k)===" "?"Space":p(k))),C(B,K)}),C(E,N)},d=E=>{var N=yr();C(E,N)};$(o,E=>{G.activeKeys.length>0?E(c):E(d,!1)})}v(n),v(a);var u=b(a,4),h=b(f(u),2),A=f(h,!0);v(h),v(u),v(s);var x=b(s,2),w=f(x);{var _=E=>{var N=wr(),U=ct(N),B=b(f(U),2),k=f(B);v(B),v(U),kt(2),M(K=>R(k,`Backed up: ${K??""}`),[()=>l.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})]),Z(3,U,()=>pt),C(E,N)};$(w,E=>{l.lastSaved&&E(_)})}var g=b(w,2),m=f(g),O=f(m);v(m);var S=b(m,2),D=f(S);v(S);var y=b(S,2),P=f(y);v(y),v(g),kt(4),v(x),v(i),v(e),M(E=>{R(A,J.current.type),R(O,`Pos: ${l.needlePos.x??""},${l.needlePos.y??""}`),R(D,`Size: ${l.linenWidth??""}x${l.linenHeight??""}`),R(P,`Zoom: ${E??""}%`)},[()=>Math.round(l.zoomLevel*100)]),C(r,e),V()}var Cr=L('<div class="pointer-events-none fixed bottom-0 left-0 z-50 flex w-full flex-col items-center"><div class="pointer-events-auto mb-6"><!></div> <div class="pointer-events-auto w-full"><!></div></div>');function Sr(r){var t=Cr(),e=f(t),i=f(e);xr(i,{}),v(e);var s=b(e,2),a=f(s);Er(a,{}),v(s),v(t),C(r,t)}var Tr=L('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-studio-text/10"></div>'),kr=L('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-studio-text/10"></div>'),Lr=L('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-studio-text/30"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-studio-text/30"></div> <!> <!></div>');function Ir(r,t){H(t,!1),rt();var e=Lr(),i=b(f(e),4);dt(i,0,()=>[-24,-16,-8,8,16,24],At,(a,n)=>{const o=tt(()=>50+n/l.linen.width*100);var c=yt(),d=ct(c);{var u=h=>{var A=Tr();M(()=>it(A,`left: ${p(o)??""}%`)),C(h,A)};$(d,h=>{p(o)>0&&p(o)<100&&h(u)})}C(a,c)});var s=b(i,2);dt(s,0,()=>[-24,-16,-8,8,16,24],At,(a,n)=>{const o=tt(()=>50+n/l.linen.height*100);var c=yt(),d=ct(c);{var u=h=>{var A=kr();M(()=>it(A,`top: ${p(o)??""}%`)),C(h,A)};$(d,h=>{p(o)>0&&p(o)<100&&h(u)})}C(a,c)}),v(e),C(r,e),V()}var Pr=L('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-full rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-full bg-white opacity-80 shadow-sm"></div></div>',1),Or=L('<div class="cursor-container absolute inset-0 svelte-4tpgo2"><div class="bloom-wrapper svelte-4tpgo2"><div class="petal p-top svelte-4tpgo2"></div> <div class="petal p-bottom svelte-4tpgo2"></div> <div class="petal p-left svelte-4tpgo2"></div> <div class="petal p-right svelte-4tpgo2"></div> <div class="center-dot svelte-4tpgo2"></div></div> <!></div>');function Mr(r,t){H(t,!1),rt();var e=yt(),i=ct(e);{var s=a=>{var n=Or(),o=b(f(n),2);{var c=d=>{var u=Pr(),h=ct(u),A=b(h,2),x=f(A),w=f(x);v(x),kt(2),v(A),M(()=>{it(h,`background-color: ${l.activeDye??""};`),it(w,`background-color: ${l.activeDye??""};`)}),Z(3,h,()=>pt,()=>({duration:400})),Z(1,A,()=>Yi,()=>({y:-10,duration:400})),Z(2,A,()=>pt,()=>({duration:400})),C(d,u)};$(o,d=>{l.isPicking&&d(c)})}v(n),Z(3,n,()=>pt,()=>({duration:800})),C(a,n)};$(i,a=>{l.isNeedleVisible&&a(s)})}C(r,e),V()}var Nr=L("<div><!></div>");function Br(r,t){let e=ft(()=>t.activeX===t.x&&t.activeY===t.y),i=ft(()=>t.color===null);var s=Nr(),a=f(s);{var n=o=>{Mr(o,{})};$(a,o=>{p(e)&&o(n)})}v(s),M(()=>{et(s,1,`cell-stitch relative h-full w-full ${p(e)?"z-30":"z-10"}`),it(s,`background-color: ${(p(i)?"transparent":t.color)??""};`)}),C(r,s)}var Dr=L('<div class="marching-ants pointer-events-none absolute z-40 svelte-1onh8x1"></div>');function Rr(r,t){H(t,!1),rt();var e=yt(),i=ct(e);{var s=a=>{const n=tt(()=>J.current.type==="LOOMING"),o=tt(()=>Math.min(l.selection.start.x,l.selection.end.x)),c=tt(()=>Math.max(l.selection.start.x,l.selection.end.x)),d=tt(()=>Math.min(l.selection.start.y,l.selection.end.y)),u=tt(()=>Math.max(l.selection.start.y,l.selection.end.y)),h=tt(()=>p(c)-p(o)+1),A=tt(()=>p(u)-p(d)+1);var x=Dr();M(()=>it(x,`
            left: ${p(o)/l.linen.width*100}%; 
            top: ${p(d)/l.linen.height*100}%; 
            width: ${p(h)/l.linen.width*100}%; 
            height: ${p(A)/l.linen.height*100}%;
            --lasso-color: ${p(n)?"var(--color-brand)":"rgba(0,0,0,0.3)"};
            box-shadow: 0 0 0 1px rgba(255,255,255,0.5);
        `)),C(a,x)};$(i,a=>{l.selection.isActive&&l.selection.start&&l.selection.end&&a(s)})}C(r,e),V()}var Fr=L('<div class="stitch-grid-pattern artisan-checker-small relative shrink-0 origin-center shadow-sm transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]"><!> <!> <!></div>');function zr(r,t){H(t,!1),rt();var e=Fr(),i=f(e);Ir(i,{});var s=b(i,2);dt(s,1,()=>l.stitches,At,(n,o,c)=>{const d=tt(()=>c%l.linen.width),u=tt(()=>Math.floor(c/l.linen.width));Br(n,{get color(){return p(o)},get x(){return p(d)},get y(){return p(u)},get activeX(){return l.needle.pos.x},get activeY(){return l.needle.pos.y}})});var a=b(s,2);Rr(a,{}),v(e),M(()=>it(e,`
		display: grid;
		grid-template-columns: repeat(${l.linen.width??""}, 1fr); 
		grid-template-rows: repeat(${l.linen.height??""}, 1fr);
		width: min(75vh, 75vw); 
		height: min(75vh, 75vw);
		--grid-cols: ${l.linen.width??""}; 
		--grid-rows: ${l.linen.height??""}; 
		transform: ${l.cameraTransform??""};
		background-color: #eee8d5;
	`)),C(r,e),V()}const Ur="data:image/png;base64,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";var Gr=L(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-[#fdf6e3] svelte-1k59vfz" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');"><div class="flex flex-col items-center gap-2 svelte-1k59vfz"><div class="mb-6 flex animate-bounce items-center justify-center svelte-1k59vfz"><img alt="Rupa Icon" class="h-24 w-auto drop-shadow-md svelte-1k59vfz"/></div> <h1 class="font-tiny5 text-6xl text-brand drop-shadow-sm svelte-1k59vfz">Rupa</h1> <p class="font-serif text-[10px] font-bold tracking-[0.4em] uppercase opacity-40 svelte-1k59vfz">The Weaver's Studio</p></div> <div class="absolute bottom-16 flex flex-col items-center gap-4 svelte-1k59vfz"><div class="h-0.5 w-48 overflow-hidden rounded-full bg-black/5 svelte-1k59vfz"><div class="h-full animate-[loading_2s_ease-in-out_infinite] bg-brand/60 svelte-1k59vfz"></div></div> <div class="flex flex-col items-center gap-1 svelte-1k59vfz"><span class="font-serif text-[10px] italic opacity-40 svelte-1k59vfz">Preparing the digital linen...</span> <span class="font-mono text-[9px] font-bold tracking-widest uppercase opacity-20 svelte-1k59vfz"> </span></div></div></div>`);function Hr(r,t){H(t,!0);let e=I(!0);Nt(()=>{const n=setTimeout(()=>{T(e,!1),setTimeout(()=>{l.isAppReady=!0},800)},2e3);return()=>clearTimeout(n)});var i=yt(),s=ct(i);{var a=n=>{var o=Gr(),c=f(o),d=f(c),u=f(d);v(d),kt(4),v(c);var h=b(c,2),A=b(f(h),2),x=b(f(A),2),w=f(x);v(x),v(A),v(h),v(o),M(()=>{xt(u,"src",Ur),R(w,`Version ${l.version??""}`)}),Z(2,o,()=>pt,()=>({duration:800})),C(n,o)};$(s,n=>{p(e)&&n(a)})}C(r,i),V()}var Vr=L('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><span> </span> <span> </span></div> <input type="range"/></div>');function Ht(r,t){H(t,!0);let e=Y(t,"value",15),i=Y(t,"min",3,0),s=Y(t,"unit",3,""),a=Y(t,"isHue",3,!1);var n=Vr(),o=f(n),c=f(o),d=f(c,!0);v(c);var u=b(c,2),h=f(u);v(u),v(o);var A=b(o,2);gt(A);let x;v(n),M(w=>{R(d,t.label),R(h,`${w??""}${s()??""}`),xt(A,"min",i()),xt(A,"max",t.max),x=et(A,1,"custom-slider svelte-7qe4gg",null,x,{"hue-slider":a()})},[()=>Math.round(e())]),bt(A,e),C(r,n),V()}var Kr=L('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/20 backdrop-blur-sm"><div class="flex w-[400px] flex-col gap-8 rounded-[3rem] border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl">‚õ≤</span> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand">Dye Basin</h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30">Mix your threads</span></div></div> <div class="h-12 w-12 rounded-2xl border-2 border-white shadow-inner"></div></div> <div class="flex flex-col gap-6"><!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-2xl border border-black/5 bg-white/50 p-4"><span class="font-mono text-sm font-bold opacity-40">HEX</span> <input type="text" class="w-full bg-transparent font-mono text-lg font-bold uppercase focus:outline-none"/></div> <button class="artisan-primary-btn w-full py-4">Seal the Dye</button></div></div></div>');function $r(r,t){H(t,!0);let e=Y(t,"value",15),i=I(0),s=I(0),a=I(0),n=I(1);Lt(()=>{const y=o(e());Tt(()=>{T(i,y.h,!0),T(s,y.s,!0),T(a,y.l,!0),T(n,y.a/100)})}),Lt(()=>{const y=c(p(i),p(s),p(a),p(n));Tt(()=>{e(y)})});function o(y){let P=0,E=0,N=0,U=1;y.length===4?(P=parseInt(y[1]+y[1],16),E=parseInt(y[2]+y[2],16),N=parseInt(y[3]+y[3],16)):y.length===7&&(P=parseInt(y.substring(1,3),16),E=parseInt(y.substring(3,5),16),N=parseInt(y.substring(5,7),16)),P/=255,E/=255,N/=255;const B=Math.max(P,E,N),k=Math.min(P,E,N);let K=0,j=0,Q=(B+k)/2;if(B!==k){const st=B-k;switch(j=Q>.5?st/(2-B-k):st/(B+k),B){case P:K=(E-N)/st+(E<N?6:0);break;case E:K=(N-P)/st+2;break;case N:K=(P-E)/st+4;break}K/=6}return{h:K*360,s:j*100,l:Q*100,a:U*100}}function c(y,P,E,N){y/=360,P/=100,E/=100;let U,B,k;if(P===0)U=B=k=E;else{const j=E<.5?E*(1+P):E+P-E*P,Q=2*E-j,st=nt=>(nt<0&&(nt+=1),nt>1&&(nt-=1),nt<1/6?Q+(j-Q)*6*nt:nt<1/2?j:nt<2/3?Q+(j-Q)*(2/3-nt)*6:Q);U=st(y+1/3),B=st(y),k=st(y-1/3)}const K=j=>Math.round(j*255).toString(16).padStart(2,"0");return`#${K(U)}${K(B)}${K(k)}`}var d=Kr();d.__mousedown=y=>y.target===y.currentTarget&&t.onClose();var u=f(d),h=f(u),A=b(f(h),2);v(h);var x=b(h,2),w=f(x);Ht(w,{label:"Hue",max:360,unit:"¬∞",isHue:!0,get value(){return p(i)},set value(y){T(i,y,!0)}});var _=b(w,2);Ht(_,{label:"Saturation",max:100,unit:"%",get value(){return p(s)},set value(y){T(s,y,!0)}});var g=b(_,2);Ht(g,{label:"Lightness",max:100,unit:"%",get value(){return p(a)},set value(y){T(a,y,!0)}}),v(x);var m=b(x,2),O=f(m),S=b(f(O),2);gt(S),v(O);var D=b(O,2);D.__click=function(...y){t.onClose?.apply(this,y)},v(m),v(u),v(d),M(()=>it(A,`background-color: ${e()??""};`)),bt(S,e),Z(1,u,()=>It,()=>({duration:200,start:.95})),Z(2,u,()=>It,()=>({duration:150,start:1,opacity:0})),Z(3,d,()=>pt,()=>({duration:150})),C(r,d),V()}at(["mousedown","click"]);var jr=L("<span> </span>"),Qr=L('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function Yr(r,t){H(t,!0);var e=Qr();e.__click=()=>{t.action.action(),t.onSelect()};var i=f(e),s=f(i,!0);v(i);var a=b(i,2);{var n=o=>{var c=jr(),d=f(c,!0);v(c),M(()=>{et(c,1,`font-mono text-[10px] font-bold uppercase ${t.isSelected?"text-white/60":"opacity-20"}`),R(d,t.action.shortcut)}),C(o,c)};$(a,o=>{t.action.shortcut&&o(n)})}v(e),M(()=>{et(e,1,`artisan-action-btn flex items-center justify-between rounded-2xl px-6 py-4 transition-all ${t.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),R(s,t.action.label)}),Ze("mouseenter",e,function(...o){t.onSelect?.apply(this,o)}),C(r,e),V()}at(["click"]);var Xr=L('<div class="p-8 text-center font-serif text-sm italic opacity-40"> </div>'),Zr=L('<div class="flex flex-col gap-1"></div>'),Wr=L('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm"><div class="flex w-[600px] flex-col overflow-hidden rounded-[2.5rem] border border-black/5 bg-[#fdf6e3]/95 shadow-2xl"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40">üìñ</span> <input id="catalog-search" type="text" placeholder="Search for a pattern or studio action..." class="w-full bg-transparent font-serif text-xl focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-1fnfmu0"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] uppercase opacity-30">Use Arrows to Navigate ‚Ä¢ Enter to Weave</span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] uppercase opacity-30"> </span></div></div></div>');function qr(r,t){H(t,!0);let e=Y(t,"onClose",3,()=>l.studio.showPatternCatalog=!1),i=I(""),s=I(0);const a=[{id:"save-project",label:"File: Open Archive Pattern Window",shortcut:G.getLabel("OPEN_ARCHIVE"),action:()=>l.showArchivePattern=!0},{id:"open-project",label:"File: Open Artisan Project (.rupa)",shortcut:G.getLabel("OPEN"),action:()=>l.loadProject()},{id:"open-dye-basin",label:"Color: Open Color Wheel (Dye Basin)",shortcut:G.getLabel("OPEN_DYES"),action:()=>l.showDyeBasin=!0},{id:"toggle-mute",label:"Studio: Toggle Audio Feedback (Mute/Unmute)",shortcut:G.getLabel("TOGGLE_MUTE"),action:()=>l.toggleMute()},{id:"pick-dye",label:"Color: Eyedropper (Pick Dye from Canvas)",shortcut:G.getLabel("PICK_DYE"),action:()=>l.pickDye()},{id:"reset-zoom",label:"View: Reset Loom Zoom",shortcut:G.getLabel("RESET_ZOOM"),action:()=>l.resetZoom()},{id:"goto",label:"Navigation: Go to Coordinate (Direct Jump)",shortcut:G.getLabel("GOTO"),action:()=>l.showGoTo=!0},{id:"undo",label:"Edit: Undo Last Stitch",shortcut:G.getLabel("UNDO"),action:()=>l.undo()},{id:"redo",label:"Edit: Redo Last Stitch",shortcut:G.getLabel("REDO"),action:()=>l.redo()},{id:"clear-linen",label:"Project: Clear the Linen (Full Reset)",shortcut:G.getLabel("CLEAR_LINEN"),action:()=>l.clearLinen()},{id:"copy-pattern",label:"Selection: Copy Pattern to Clipboard",shortcut:G.getLabel("COPY"),action:()=>l.copySelection()},{id:"cut-pattern",label:"Selection: Cut Pattern (Move source to clipboard)",shortcut:G.getLabel("CUT"),action:()=>l.cutSelection()},{id:"paste-pattern",label:"Selection: Paste Pattern from Clipboard",shortcut:G.getLabel("PASTE"),action:()=>l.pasteSelection()},{id:"flip-h",label:"Transform: Flip Linen Horizontally",shortcut:G.getLabel("FLIP_H"),action:()=>l.flipLinen("horizontal")},{id:"flip-v",label:"Transform: Flip Linen Vertically",shortcut:G.getLabel("FLIP_V"),action:()=>l.flipLinen("vertical")},{id:"rotate-linen",label:"Transform: Rotate Linen 90¬∞ Clockwise",shortcut:G.getLabel("ROTATE"),action:()=>l.rotateLinen()}];let n=ft(()=>a.filter(S=>S.label.toLowerCase().includes(p(i).toLowerCase())));Lt(()=>{p(i),T(s,0)}),Lt(()=>{p(s),p(n);const S=document.querySelector(".artisan-action-btn.active");S&&S.scrollIntoView({block:"nearest"})});function o(S){S.key==="ArrowDown"?(S.preventDefault(),T(s,(p(s)+1)%p(n).length)):S.key==="ArrowUp"?(S.preventDefault(),T(s,(p(s)-1+p(n).length)%p(n).length)):S.key==="Enter"?(S.preventDefault(),p(n)[p(s)]&&(p(n)[p(s)].action(),e()())):S.key==="Escape"&&e()()}Nt(()=>document.getElementById("catalog-search")?.focus());var c=Wr();c.__mousedown=S=>S.target===S.currentTarget&&e()(),c.__keydown=o;var d=f(c),u=f(d),h=b(f(u),2);gt(h),v(u);var A=b(u,2),x=f(A);{var w=S=>{var D=Xr(),y=f(D);v(D),M(()=>R(y,`No patterns found for "${p(i)??""}"`)),C(S,D)},_=S=>{var D=Zr();dt(D,21,()=>p(n),At,(y,P,E)=>{{let N=ft(()=>p(s)===E);Yr(y,{get action(){return p(P)},get isSelected(){return p(N)},onSelect:()=>T(s,E,!0)})}}),v(D),C(S,D)};$(x,S=>{p(n).length===0?S(w):S(_,!1)})}v(A);var g=b(A,2),m=b(f(g),2),O=f(m);v(m),v(g),v(d),v(c),M(()=>R(O,`${p(n).length??""} Actions Available`)),bt(h,()=>p(i),S=>T(i,S)),Z(3,d,()=>It,()=>({duration:150,start:.98})),C(r,c),V()}at(["mousedown","keydown"]);var Jr=L('<span class="text-3xl"> </span>'),ts=L('<span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30"> </span>'),es=L('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/20 backdrop-blur-sm"><div class="flex flex-col gap-8 overflow-hidden rounded-[2rem] border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between border-b border-studio-text/5 pb-6"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand"> </h2> <!></div></div> <button class="rounded-full border border-black/5 bg-white/50 px-4 py-2 text-[10px] font-bold tracking-widest uppercase opacity-40 transition-all hover:opacity-100">Close</button></div> <div class="custom-scrollbar flex-1 overflow-y-auto pr-2 svelte-32v57s"><!></div></div></div>');function Pt(r,t){H(t,!0);let e=Y(t,"title",3,""),i=Y(t,"subtitle",3,""),s=Y(t,"icon",3,""),a=Y(t,"width",3,"500px"),n=Y(t,"maxHeight",3,"85vh");Lt(()=>(Tt(()=>{l.pushEscapeAction(t.onClose)}),()=>l.popEscapeAction(t.onClose)));var o=es();o.__mousedown=y=>y.target===y.currentTarget&&t.onClose();var c=f(o),d=f(c),u=f(d),h=f(u);{var A=y=>{var P=Jr(),E=f(P,!0);v(P),M(()=>R(E,s())),C(y,P)};$(h,y=>{s()&&y(A)})}var x=b(h,2),w=f(x),_=f(w,!0);v(w);var g=b(w,2);{var m=y=>{var P=ts(),E=f(P,!0);v(P),M(()=>R(E,i())),C(y,P)};$(g,y=>{i()&&y(m)})}v(x),v(u);var O=b(u,2);O.__click=function(...y){t.onClose?.apply(this,y)},v(d);var S=b(d,2),D=f(S);qe(D,()=>t.children),v(S),v(c),v(o),M(()=>{it(c,`width: ${a()??""}; max-height: ${n()??""};`),R(_,e())}),Z(1,c,()=>It,()=>({duration:200,start:.95})),Z(2,c,()=>It,()=>({duration:150,start:1,opacity:0})),Z(3,o,()=>pt,()=>({duration:150})),C(r,o),V()}at(["mousedown","click"]);var is=L('<div class="flex flex-col gap-8"><div class="grid grid-cols-2 gap-4"><button><span class="text-4xl">üñºÔ∏è</span> <div class="text-center"><h3 class="font-serif text-sm font-bold tracking-tight uppercase">Raster PNG</h3> <span class="font-serif text-[9px] font-bold tracking-widest uppercase opacity-40">Pixel Perfect</span></div></button> <button><span class="text-4xl">üìê</span> <div class="text-center"><h3 class="font-serif text-sm font-bold tracking-tight uppercase">Vector SVG</h3> <span class="font-serif text-[9px] font-bold tracking-widest uppercase opacity-40">Infinite Scale</span></div></button></div> <div class="flex flex-col gap-6 rounded-3xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Artifact Scale</span> <span class="font-serif text-[10px] opacity-40">Multiplier for raster output size</span></div> <input type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg focus:outline-none"/></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Background</span> <span class="font-serif text-[10px] opacity-40">Fill empty stitches with color</span></div> <div class="flex gap-2"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" title="Transparent"></button> <button title="Studio Cream"></button> <button title="Deep Black"></button></div></div></div> <button class="artisan-primary-btn w-full py-5 text-xl">Weave & Export Artifact</button></div>');function rs(r,t){H(t,!0);let e=Y(t,"onClose",3,()=>l.showArtifactCrate=!1),i=I("png");Pt(r,{title:"Artifact Crate",subtitle:"Prepare Artifacts for Export",icon:"üß∫",get onClose(){return e()},children:(s,a)=>{var n=is(),o=f(n),c=f(o);c.__click=()=>T(i,"png");var d=b(c,2);d.__click=()=>T(i,"svg"),v(o);var u=b(o,2),h=f(u),A=b(f(h),2);gt(A),v(h);var x=b(h,2),w=b(f(x),2),_=f(w);_.__click=()=>l.studio.exportBgColor="transparent";var g=b(_,2);g.__click=()=>l.studio.exportBgColor="#eee8d5";var m=b(g,2);m.__click=()=>l.studio.exportBgColor="#000000",v(w),v(x),v(u);var O=b(u,2);O.__click=()=>t.onExport(p(i),l.studio.exportScale,l.studio.exportBgColor),v(n),M(()=>{et(c,1,`flex flex-col items-center gap-3 rounded-3xl border-2 p-8 transition-all ${p(i)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),et(d,1,`flex flex-col items-center gap-3 rounded-3xl border-2 p-8 transition-all ${p(i)==="svg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),et(_,1,`h-10 w-10 rounded-full border-2 ${l.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),et(g,1,`h-10 w-10 rounded-full border-2 ${l.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),et(m,1,`h-10 w-10 rounded-full border-2 ${l.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`)}),bt(A,()=>l.studio.exportScale,S=>l.studio.exportScale=S),C(s,n)},$$slots:{default:!0}}),V()}at(["click"]);var ss=L('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function as(r,t){H(t,!0);var e=ss(),i=f(e),s=f(i,!0);v(i);var a=b(i,2),n=f(a,!0);v(a),v(e),M(o=>{R(s,t.label),R(n,o)},[()=>G.getLabel(t.intent)]),C(r,e),V()}var ns=L('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function os(r,t){H(t,!0);var e=ns(),i=f(e),s=f(i,!0);v(i);var a=b(i,2);dt(a,21,()=>t.group.items,At,(n,o)=>{as(n,{get intent(){return p(o).intent},get label(){return p(o).label}})}),v(a),v(e),M(()=>R(s,t.group.group)),C(r,e),V()}var ls=L('<div class="grid grid-cols-1 gap-8"></div>');function cs(r,t){H(t,!0);let e=Y(t,"onClose",3,()=>l.studio.showArtisanGuide=!1);const i=[{group:"Navigation & Looming",items:[{intent:"MOVE_UP",label:"Move Needle"},{intent:"GOTO",label:"Go to Coordinate"},{intent:"FLOW_SELECT",label:"Block Selection (Hold)"},{intent:"ESCAPE",label:"Clear Selection / Dismiss"}]},{group:"Digital Stitching",items:[{intent:"STITCH",label:"Stitch (Color Cell)"},{intent:"UNSTITCH",label:"Unstitch (Clear Cell)"},{intent:"FLOW_STITCH",label:"Continuous Threading (Hold)"},{intent:"FLOW_UNSTITCH",label:"Continuous Unravelling (Hold)"},{intent:"PICK_DYE",label:"Pick Dye from Linen"}]},{group:"History & Studio",items:[{intent:"UNDO",label:"Undo Last Stitch"},{intent:"REDO",label:"Redo Last Stitch"},{intent:"OPEN_PALETTE",label:"Open Pattern Catalog"},{intent:"OPEN_EXPORT",label:"Export Artifact Crate"},{intent:"OPEN_SETTINGS",label:"Linen Settings"}]}];Pt(r,{title:"Artisan's Guide",subtitle:"Mastering the Digital Loom",icon:"üìú",get onClose(){return e()},width:"600px",children:(s,a)=>{var n=ls();dt(n,21,()=>i,At,(o,c)=>{os(o,{get group(){return p(c)}})}),v(n),C(s,n)},$$slots:{default:!0}}),V()}var ds=L(`<div class="flex flex-col gap-6"><div class="rounded-2xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Pattern Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your work as a dedicated file on your machine or in your browser's archive.</p></div> <div class="flex flex-col gap-3"><button class="artisan-primary-btn w-full">Archive to Pattern Book</button> <button class="artisan-secondary-btn w-full">Restore from Pattern Book</button></div></div>`);function us(r,t){H(t,!0);let e=Y(t,"onClose",3,()=>l.studio.showArchivePattern=!1);Pt(r,{title:"Archive Pattern",subtitle:"Preserving Digital Stitches",icon:"üíæ",get onClose(){return e()},width:"400px",children:(i,s)=>{var a=ds(),n=b(f(a),2),o=f(n);o.__click=()=>{z.persistence.save(),e()()};var c=b(o,2);c.__click=()=>{z.persistence.load(),e()()},v(n),v(a),C(i,a)},$$slots:{default:!0}}),V()}at(["click"]);var vs=L(`<div class="flex flex-col gap-8"><div class="flex flex-col gap-6 rounded-3xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Width</label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Height</label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed italic opacity-40">Note: Resizing will center your current work on the new frame. Large dimensions may affect
				performance in certain environments.</p></div> <button class="artisan-primary-btn w-full py-4 text-lg">Re-stretch Linen</button></div>`);function fs(r,t){H(t,!0);let e=Y(t,"onClose",3,()=>l.studio.showLinenSettings=!1),i=I(ht(l.linen.width)),s=I(ht(l.linen.height));function a(){z.manipulation.resize(p(i),p(s)),e()()}Pt(r,{title:"Linen Settings",subtitle:"Configure the Weaver's Frame",icon:"üìê",get onClose(){return e()},width:"450px",children:(n,o)=>{var c=vs(),d=f(c),u=f(d),h=f(u),A=b(f(h),2);gt(A),v(h);var x=b(h,2),w=b(f(x),2);gt(w),v(x),v(u),kt(2),v(d);var _=b(d,2);_.__click=a,v(c),bt(A,()=>p(i),g=>T(i,g)),bt(w,()=>p(s),g=>T(s,g)),C(n,c)},$$slots:{default:!0}}),V()}at(["click"]);var ps=L('<div class="flex flex-col gap-8"><div class="flex flex-col gap-6 rounded-3xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Cartesian X</label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Cartesian Y</label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed italic opacity-40"> </p></div> <button class="artisan-primary-btn w-full py-4 text-lg">Move Needle</button></div>');function hs(r,t){H(t,!0);let e=Y(t,"onClose",3,()=>l.studio.showGoTo=!1),i=I(ht(l.displayCoords.x)),s=I(ht(l.displayCoords.y));function a(){const o=Math.floor(l.linen.width/2),c=Math.floor(l.linen.height/2);let d,u;l.linen.width%2===0?d=p(i)<0?p(i)+o:p(i)+o-1:d=p(i)+o;const h=-p(s);l.linen.height%2===0?u=h<0?h+c:h+c-1:u=h+c;const A=Math.max(0,Math.min(l.linen.width-1,d)),x=Math.max(0,Math.min(l.linen.height-1,u));l.needle.setPos(A,x),e()()}function n(o){o.key==="Enter"&&a()}Nt(()=>{document.getElementById("goto-x")?.focus()}),Pt(r,{title:"Go To Coordinate",subtitle:"Direct Needle Placement",icon:"üìç",get onClose(){return e()},width:"400px",children:(o,c)=>{var d=ps(),u=f(d),h=f(u),A=f(h),x=b(f(A),2);gt(x),x.__keydown=n,v(A);var w=b(A,2),_=b(f(w),2);gt(_),_.__keydown=n,v(w),v(h);var g=b(h,2),m=f(g);v(g),v(u);var O=b(u,2);O.__click=a,v(d),M(()=>R(m,`Current Position: ${l.displayCoords.x??""}, ${l.displayCoords.y??""}`)),bt(x,()=>p(i),S=>T(i,S)),bt(_,()=>p(s),S=>T(s,S)),C(o,d)},$$slots:{default:!0}}),V()}at(["keydown","click"]);var F=Bt(()=>l),As=L('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="relative flex h-screen flex-1 items-center justify-center overflow-hidden"><div class="artisan-frame flex h-[80vh] w-[82vw] items-center justify-center overflow-hidden"><!></div></div>',1);function Cs(r,t){H(t,!1);async function e(k,K=10,j="transparent"){if(k==="svg"){const Q=re.toSVG(F().linen.width,F().linen.height,F().linen.stitches,j),st=new Blob([Q],{type:"image/svg+xml"});i(URL.createObjectURL(st),"stitch-art.svg")}else{const Q=await re.toPNG(F().linen.width,F().linen.height,F().linen.stitches,K,j);i(Q,"stitch-art.png")}F(F().studio.showArtifactCrate=!1)}function i(k,K){const j=document.createElement("a");j.href=k,j.download=K,j.click()}Nt(()=>{const k=setInterval(()=>z.persistence.backup(),6e5),K=Q=>ie.handleInput(Q,"down"),j=Q=>ie.handleInput(Q,"up");return window.addEventListener("keydown",K),window.addEventListener("keyup",j),()=>{window.removeEventListener("keydown",K),window.removeEventListener("keyup",j),clearInterval(k)}}),rt();var s=As(),a=ct(s);Hr(a,{});var n=b(a,2);{var o=k=>{cs(k,{onClose:()=>F(F().studio.showArtisanGuide=!1)})};$(n,k=>{F().studio.showArtisanGuide&&k(o)})}var c=b(n,2);{var d=k=>{qr(k,{onClose:()=>F(F().studio.showPatternCatalog=!1)})};$(c,k=>{F().studio.showPatternCatalog&&k(d)})}var u=b(c,2);{var h=k=>{$r(k,{get value(){return F().paletteState.activeDye},onClose:()=>F(F().studio.showDyeBasin=!1)})};$(u,k=>{F().studio.showDyeBasin&&k(h)})}var A=b(u,2);{var x=k=>{rs(k,{onExport:e,onClose:()=>F(F().studio.showArtifactCrate=!1)})};$(A,k=>{F().studio.showArtifactCrate&&k(x)})}var w=b(A,2);{var _=k=>{us(k,{onClose:()=>F(F().studio.showArchivePattern=!1)})};$(w,k=>{F().studio.showArchivePattern&&k(_)})}var g=b(w,2);{var m=k=>{fs(k,{onClose:()=>F(F().studio.showLinenSettings=!1)})};$(g,k=>{F().studio.showLinenSettings&&k(m)})}var O=b(g,2);{var S=k=>{hs(k,{onClose:()=>F(F().studio.showGoTo=!1)})};$(O,k=>{F().studio.showGoTo&&k(S)})}var D=b(O,2);tr(D);var y=b(D,2);ar(y);var P=b(y,2);fr(P);var E=b(P,2);Sr(E);var N=b(E,2),U=f(N),B=f(U);zr(B,{}),v(U),v(N),C(r,s),V()}export{Cs as component};
