import{a as y,f as E,c as Te,t as Fe}from"../chunks/BmlXhWgQ.js";import{i as ee}from"../chunks/DCqsXQoh.js";import{o as Be}from"../chunks/BRhPe-qL.js";import{aL as Tt,b as xt,h as re,J as bt,a as Qe,aM as mt,L as Xe,D as kt,n as u,N as It,O as Lt,P as ut,Q as Ye,f as je,aa as Pt,aE as Vt,am as vt,c as Pe,aN as _e,e as et,aO as Mt,s as Ot,a4 as le,aP as Ft,aC as nt,aQ as Nt,aR as Bt,aH as Dt,a8 as tt,aS as Rt,r as _t,p as yt,aT as qe,U as ot,aU as jt,aV as Gt,aB as Ut,d as Ht,ay as zt,G as $t,E as Kt,aW as Wt,I as Qt,R as Xt,aX as Yt,aY as qt,aZ as Ve,av as wt,j as Se,a_ as Zt,a$ as Jt,b0 as ei,b1 as ti,b2 as ii,b3 as si,b4 as ai,b5 as ri,aI as ni,S as oi,b6 as li,_ as m,aJ as S,Z as ce,aK as ye,y as D,A as F,B as R,w as h,C as p,x as v,an as ke,z as de,i as pe}from"../chunks/BXVrYw-p.js";import{_ as ci,i as B,p as X,b as di}from"../chunks/cqfVEr0w.js";import{a as ui,s as N,d as ne,e as be}from"../chunks/Cmj8SDrg.js";import{B as vi}from"../chunks/DqvdEAMI.js";import{s as hi}from"../chunks/B84QSUQY.js";const fi=Symbol("NaN");function pi(r,e,t){re&&bt();var i=new vi(r),s=!Tt();xt(()=>{var n=e();n!==n&&(n=fi),s&&n!==null&&typeof n=="object"&&(n={}),i.ensure(n,t)})}function Ae(r,e){return e}function gi(r,e,t){for(var i=[],s=e.length,n,o=e.length,l=0;l<s;l++){let g=e[l];yt(g,()=>{if(n){if(n.pending.delete(g),n.done.add(g),n.pending.size===0){var A=r.outrogroups;it(nt(n.done)),A.delete(n),A.size===0&&(r.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=i.length===0&&t!==null;if(c){var d=t,f=d.parentNode;Ut(f),f.append(d),r.items.clear()}it(e,!c)}else n={pending:new Set(e),done:new Set},(r.outrogroups??=new Set).add(n)}function it(r,e=!0){for(var t=0;t<r.length;t++)Ht(r[t],e)}var ht;function he(r,e,t,i,s,n=null){var o=r,l=new Map,c=(e&mt)!==0;if(c){var d=r;o=re?Xe(kt(d)):d.appendChild(Qe())}re&&bt();var f=null,g=le(()=>{var _=t();return Ft(_)?_:_==null?[]:nt(_)}),A,b=!0;function C(){x.fallback=f,Ai(x,A,o,e,i),f!==null&&(A.length===0?(f.f&_e)===0?_t(f):(f.f^=_e,Oe(f,null,o)):yt(f,()=>{f=null}))}var w=xt(()=>{A=u(g);var _=A.length;let L=!1;if(re){var k=It(o)===Lt;k!==(_===0)&&(o=ut(),Xe(o),Ye(!1),L=!0)}for(var T=new Set,K=Pe,M=Ot(),V=0;V<_;V+=1){re&&je.nodeType===Pt&&je.data===Vt&&(o=je,L=!0,Ye(!1));var j=A[V],G=i(j,V),I=b?null:l.get(G);I?(I.v&&vt(I.v,j),I.i&&vt(I.i,V),M&&K.unskip_effect(I.e)):(I=xi(l,b?o:ht??=Qe(),j,G,V,s,e,t),b||(I.e.f|=_e),l.set(G,I)),T.add(G)}if(_===0&&n&&!f&&(b?f=et(()=>n(o)):(f=et(()=>n(ht??=Qe())),f.f|=_e)),_>T.size&&Mt(),re&&_>0&&Xe(ut()),!b)if(M){for(const[U,q]of l)T.has(U)||K.skip_effect(q.e);K.oncommit(C),K.ondiscard(()=>{})}else C();L&&Ye(!0),u(g)}),x={effect:w,items:l,outrogroups:null,fallback:f};b=!1,re&&(o=je)}function Me(r){for(;r!==null&&(r.f&jt)===0;)r=r.next;return r}function Ai(r,e,t,i,s){var n=(i&Gt)!==0,o=e.length,l=r.items,c=Me(r.effect.first),d,f=null,g,A=[],b=[],C,w,x,_;if(n)for(_=0;_<o;_+=1)C=e[_],w=s(C,_),x=l.get(w).e,(x.f&_e)===0&&(x.nodes?.a?.measure(),(g??=new Set).add(x));for(_=0;_<o;_+=1){if(C=e[_],w=s(C,_),x=l.get(w).e,r.outrogroups!==null)for(const I of r.outrogroups)I.pending.delete(x),I.done.delete(x);if((x.f&_e)!==0)if(x.f^=_e,x===c)Oe(x,null,t);else{var L=f?f.next:c;x===r.effect.last&&(r.effect.last=x.prev),x.prev&&(x.prev.next=x.next),x.next&&(x.next.prev=x.prev),we(r,f,x),we(r,x,L),Oe(x,L,t),f=x,A=[],b=[],c=Me(f.next);continue}if((x.f&qe)!==0&&(_t(x),n&&(x.nodes?.a?.unfix(),(g??=new Set).delete(x))),x!==c){if(d!==void 0&&d.has(x)){if(A.length<b.length){var k=b[0],T;f=k.prev;var K=A[0],M=A[A.length-1];for(T=0;T<A.length;T+=1)Oe(A[T],k,t);for(T=0;T<b.length;T+=1)d.delete(b[T]);we(r,K.prev,M.next),we(r,f,K),we(r,M,k),c=k,f=M,_-=1,A=[],b=[]}else d.delete(x),Oe(x,c,t),we(r,x.prev,x.next),we(r,x,f===null?r.effect.first:f.next),we(r,f,x),f=x;continue}for(A=[],b=[];c!==null&&c!==x;)(d??=new Set).add(c),b.push(c),c=Me(c.next);if(c===null)continue}(x.f&_e)===0&&A.push(x),f=x,c=Me(x.next)}if(r.outrogroups!==null){for(const I of r.outrogroups)I.pending.size===0&&(it(nt(I.done)),r.outrogroups?.delete(I));r.outrogroups.size===0&&(r.outrogroups=null)}if(c!==null||d!==void 0){var V=[];if(d!==void 0)for(x of d)(x.f&qe)===0&&V.push(x);for(;c!==null;)(c.f&qe)===0&&c!==r.fallback&&V.push(c),c=Me(c.next);var j=V.length;if(j>0){var G=(i&mt)!==0&&o===0?t:null;if(n){for(_=0;_<j;_+=1)V[_].nodes?.a?.measure();for(_=0;_<j;_+=1)V[_].nodes?.a?.fix()}gi(r,V,G)}}n&&ot(()=>{if(g!==void 0)for(x of g)x.nodes?.a?.apply()})}function xi(r,e,t,i,s,n,o,l){var c=(o&Nt)!==0?(o&Bt)===0?Dt(t,!1,!1):tt(t):null,d=(o&Rt)!==0?tt(s):null;return{v:c,i:d,e:et(()=>(n(e,c??t,d??s,l),()=>{r.delete(i)}))}}function Oe(r,e,t){if(r.nodes)for(var i=r.nodes.start,s=r.nodes.end,n=e&&(e.f&_e)===0?e.nodes.start:t;i!==null;){var o=zt(i);if(n.before(i),i===s)return;i=o}}function we(r,e,t){e===null?r.effect.first=t:e.next=t,t===null?r.effect.last=e:t.prev=e}const bi=()=>performance.now(),me={tick:r=>requestAnimationFrame(r),now:()=>bi(),tasks:new Set};function Et(){const r=me.now();me.tasks.forEach(e=>{e.c(r)||(me.tasks.delete(e),e.f())}),me.tasks.size!==0&&me.tick(Et)}function mi(r){let e;return me.tasks.size===0&&me.tick(Et),{promise:new Promise(t=>{me.tasks.add(e={c:r,f:t})}),abort(){me.tasks.delete(e)}}}function He(r,e){wt(()=>{r.dispatchEvent(new CustomEvent(e))})}function _i(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function ft(r){const e={},t=r.split(";");for(const i of t){const[s,n]=i.split(":");if(!s||n===void 0)break;const o=_i(s.trim());e[o]=n.trim()}return e}const yi=r=>r;function J(r,e,t,i){var s=(r&Zt)!==0,n=(r&Jt)!==0,o=s&&n,l=(r&Yt)!==0,c=o?"both":s?"in":"out",d,f=e.inert,g=e.style.overflow,A,b;function C(){return wt(()=>d??=t()(e,i?.()??{},{direction:c}))}var w={is_global:l,in(){if(e.inert=f,!s){b?.abort(),b?.reset?.();return}n||A?.abort(),A=st(e,C(),b,1,()=>{He(e,"introend"),A?.abort(),A=d=void 0,e.style.overflow=g})},out(k){if(!n){k?.(),d=void 0;return}e.inert=!0,b=st(e,C(),A,0,()=>{He(e,"outroend"),k?.()})},stop:()=>{A?.abort(),b?.abort()}},x=$t;if((x.nodes.t??=[]).push(w),s&&ui){var _=l;if(!_){for(var L=x.parent;L&&(L.f&Kt)!==0;)for(;(L=L.parent)&&(L.f&Wt)===0;);_=!L||(L.f&Qt)!==0}_&&Xt(()=>{Se(()=>w.in())})}}function st(r,e,t,i,s){var n=i===1;if(qt(e)){var o,l=!1;return ot(()=>{if(!l){var x=e({direction:n?"in":"out"});o=st(r,x,t,i,s)}}),{abort:()=>{l=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return He(r,n?"introstart":"outrostart"),s(),{abort:Ve,deactivate:Ve,reset:Ve,t:()=>i};const{delay:c=0,css:d,tick:f,easing:g=yi}=e;var A=[];if(n&&t===void 0&&(f&&f(0,1),d)){var b=ft(d(0,1));A.push(b,b)}var C=()=>1-i,w=r.animate(A,{duration:c,fill:"forwards"});return w.onfinish=()=>{w.cancel(),He(r,n?"introstart":"outrostart");var x=t?.t()??1-i;t?.abort();var _=i-x,L=e.duration*Math.abs(_),k=[];if(L>0){var T=!1;if(d)for(var K=Math.ceil(L/16.666666666666668),M=0;M<=K;M+=1){var V=x+_*g(M/K),j=ft(d(V,1-V));k.push(j),T||=j.overflow==="hidden"}T&&(r.style.overflow="hidden"),C=()=>{var G=w.currentTime;return x+_*g(G/L)},f&&mi(()=>{if(w.playState!=="running")return!1;var G=C();return f(G,1-G),!0})}w=r.animate(k,{duration:L,fill:"forwards"}),w.onfinish=()=>{C=()=>i,f?.(i,1-i),s()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=Ve)},deactivate:()=>{s=Ve},reset:()=>{i===0&&f?.(1,0)},t:()=>C()}}function St(r){var e,t,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=St(r[e]))&&(i&&(i+=" "),i+=t)}else for(t in r)r[t]&&(i&&(i+=" "),i+=t);return i}function wi(){for(var r,e,t=0,i="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=St(r))&&(i&&(i+=" "),i+=e);return i}function Ei(r){return typeof r=="object"?wi(r):r??""}const pt=[...` 	
\r\fÂ \v\uFEFF`];function Si(r,e,t){var i=r==null?"":""+r;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var n=s.length,o=0;(o=i.indexOf(s,o))>=0;){var l=o+n;(o===0||pt.includes(i[o-1]))&&(l===i.length||pt.includes(i[l]))?i=(o===0?"":i.substring(0,o))+i.substring(l+1):o=l}}return i===""?null:i}function Ci(r,e){return r==null?null:String(r)}function W(r,e,t,i,s,n){var o=r.__className;if(re||o!==t||o===void 0){var l=Si(t,i,n);(!re||l!==r.getAttribute("class"))&&(l==null?r.removeAttribute("class"):r.className=l),r.__className=t}else if(n&&s!==n)for(var c in n){var d=!!n[c];(s==null||d!==!!s[c])&&r.classList.toggle(c,d)}return n}function ie(r,e,t,i){var s=r.__style;if(re||s!==e){var n=Ci(e);(!re||n!==r.getAttribute("style"))&&(n==null?r.removeAttribute("style"):r.style.cssText=n),r.__style=e}return i}const Ti=Symbol("is custom element"),ki=Symbol("is html");function ue(r){if(re){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var i=r.value;Ce(r,"value",null),r.value=i}if(r.hasAttribute("checked")){var s=r.checked;Ce(r,"checked",null),r.checked=s}}};r.__on_r=t,ot(t),si()}}function Ce(r,e,t,i){var s=Ii(r);re&&(s[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(r[ai]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Li(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Ii(r){return r.__attributes??={[Ti]:r.nodeName.includes("-"),[ki]:r.namespaceURI===ei}}var gt=new Map;function Li(r){var e=r.getAttribute("is")||r.nodeName,t=gt.get(e);if(t)return t;gt.set(e,t=[]);for(var i,s=r,n=Element.prototype;n!==s;){i=ii(s);for(var o in i)i[o].set&&t.push(o);s=ti(s)}return t}function ve(r,e,t=e){var i=new WeakSet;ri(r,"input",async s=>{var n=s?r.defaultValue:r.value;if(n=Ze(r)?Je(n):n,t(n),Pe!==null&&i.add(Pe),await ni(),n!==(n=e())){var o=r.selectionStart,l=r.selectionEnd,c=r.value.length;if(r.value=n??"",l!==null){var d=r.value.length;o===l&&l===c&&d>c?(r.selectionStart=d,r.selectionEnd=d):(r.selectionStart=o,r.selectionEnd=Math.min(l,d))}}}),(re&&r.defaultValue!==r.value||Se(e)==null&&r.value)&&(t(Ze(r)?Je(r.value):r.value),Pe!==null&&i.add(Pe)),oi(()=>{var s=e();if(r===document.activeElement){var n=li??Pe;if(i.has(n))return}Ze(r)&&s===Je(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function Ze(r){var e=r.type;return e==="number"||e==="range"}function Je(r){return r===""?null:+r}function lt(r){var e=tt(0);return function(){return arguments.length===1?(m(e,u(e)+1),arguments[0]):(u(e),r())}}class Pi{project;constructor(e){this.project=e}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get stitches(){return this.project.activeFrame.activeVeil.stitches}get compositeStitches(){return this.project.activeFrame.compositeStitches}set stitches(e){this.project.activeFrame.activeVeil.stitches=e}reset(e,t,i){this.width=e,this.height=t,this.stitches=i}clear(){this.project.activeFrame.activeVeil.clear()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.stitches[this.getIndex(e,t)]}setColor(e,t,i){this.stitches[this.getIndex(e,t)]=i}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}}class Vi{#e=S(ce({x:0,y:0}));get pos(){return u(this.#e)}set pos(e){m(this.#e,e,!0)}#t=S(!0);get isVisible(){return u(this.#t)}set isVisible(e){m(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}class Mi{#e=S("#073642");get activeDye(){return u(this.#e)}set activeDye(e){m(this.#e,e,!0)}#t=S(ce(["#073642","#586e75","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"]));get swatches(){return u(this.#t)}set swatches(e){m(this.#t,e,!0)}select(e){e>=0&&e<this.swatches.length&&(this.activeDye=this.swatches[e])}setDye(e){this.activeDye=e}}class Oi{#e=S(1);get zoomLevel(){return u(this.#e)}set zoomLevel(e){m(this.#e,e,!0)}#t=S(!1);get isMuted(){return u(this.#t)}set isMuted(e){m(this.#t,e,!0)}#i=S(!0);get isAmbientPlaying(){return u(this.#i)}set isAmbientPlaying(e){m(this.#i,e,!0)}#s=S(!1);get isAppReady(){return u(this.#s)}set isAppReady(e){m(this.#s,e,!0)}#a=S(!1);get isPicking(){return u(this.#a)}set isPicking(e){m(this.#a,e,!0)}#r=S(.5);get bgmVolume(){return u(this.#r)}set bgmVolume(e){m(this.#r,e,!0)}#n=S(.5);get sfxVolume(){return u(this.#n)}set sfxVolume(e){m(this.#n,e,!0)}sessionStartTime=Date.now();#o=S(0);get usageMinutes(){return u(this.#o)}set usageMinutes(e){m(this.#o,e,!0)}#l=S(0);get usageSeconds(){return u(this.#l)}set usageSeconds(e){m(this.#l,e,!0)}#c=ye(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),i=Math.floor(e%3600/60),s=e%60;return`${t>0?t+":":""}${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`});get sessionTimeLabel(){return u(this.#c)}set sessionTimeLabel(e){m(this.#c,e)}#d=S(!1);get showDyeBasin(){return u(this.#d)}set showDyeBasin(e){m(this.#d,e,!0)}#u=S(!1);get showAudioBasin(){return u(this.#u)}set showAudioBasin(e){m(this.#u,e,!0)}#v=S(!1);get showPatternCatalog(){return u(this.#v)}set showPatternCatalog(e){m(this.#v,e,!0)}#h=S(!1);get showArtisanGuide(){return u(this.#h)}set showArtisanGuide(e){m(this.#h,e,!0)}#f=S(!1);get showArtisanCodex(){return u(this.#f)}set showArtisanCodex(e){m(this.#f,e,!0)}#p=S(!1);get showArtifactCrate(){return u(this.#p)}set showArtifactCrate(e){m(this.#p,e,!0)}#g=S(!1);get showLinenSettings(){return u(this.#g)}set showLinenSettings(e){m(this.#g,e,!0)}#A=S(!1);get showArchivePattern(){return u(this.#A)}set showArchivePattern(e){m(this.#A,e,!0)}#x=S(!1);get showGoTo(){return u(this.#x)}set showGoTo(e){m(this.#x,e,!0)}#b=S("#eee8d5");get canvasBgColor(){return u(this.#b)}set canvasBgColor(e){m(this.#b,e,!0)}#m=S(10);get exportScale(){return u(this.#m)}set exportScale(e){m(this.#m,e,!0)}#_=S("transparent");get exportBgColor(){return u(this.#_)}set exportBgColor(e){m(this.#_,e,!0)}escapeStack=[];setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.5,Math.min(5,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();return e?(e(),!0):!1}}class at{id=crypto.randomUUID();#e=S("New Veil");get name(){return u(this.#e)}set name(e){m(this.#e,e,!0)}#t=S(!0);get isVisible(){return u(this.#t)}set isVisible(e){m(this.#t,e,!0)}#i=S(!1);get isLocked(){return u(this.#i)}set isLocked(e){m(this.#i,e,!0)}#s=S(1);get opacity(){return u(this.#s)}set opacity(e){m(this.#s,e,!0)}#a=S(ce([]));get stitches(){return u(this.#a)}set stitches(e){m(this.#a,e,!0)}constructor(e,t,i){this.name=e,this.stitches=Array(t*i).fill(null)}clear(){this.stitches.fill(null)}hasStitch(e){return this.stitches[e]!==null}}class ze{id=crypto.randomUUID();#e=S("Untitled Frame");get name(){return u(this.#e)}set name(e){m(this.#e,e,!0)}#t=S(32);get width(){return u(this.#t)}set width(e){m(this.#t,e,!0)}#i=S(32);get height(){return u(this.#i)}set height(e){m(this.#i,e,!0)}#s=S(ce([]));get veils(){return u(this.#s)}set veils(e){m(this.#s,e,!0)}#a=S(0);get activeVeilIndex(){return u(this.#a)}set activeVeilIndex(e){m(this.#a,e,!0)}constructor(e,t=32,i=32){this.name=e,this.width=t,this.height=i,this.veils=[new at("Base Veil",t,i)]}get activeVeil(){return this.veils[this.activeVeilIndex]}addVeil(e){const t=e||`Veil ${this.veils.length+1}`,i=new at(t,this.width,this.height);return this.veils.push(i),this.activeVeilIndex=this.veils.length-1,i}removeVeil(e){this.veils.length<=1||(this.veils.splice(e,1),this.activeVeilIndex>=this.veils.length&&(this.activeVeilIndex=this.veils.length-1))}get compositeStitches(){const e=new Array(this.width*this.height).fill(null);for(const t of this.veils)if(t.isVisible)for(let i=0;i<e.length;i++){const s=t.stitches[i];s!==null&&(e[i]=s)}return e}}class Fi{#e=S("Untitled Stitch");get name(){return u(this.#e)}set name(e){m(this.#e,e,!0)}#t=S(null);get currentFilePath(){return u(this.#t)}set currentFilePath(e){m(this.#t,e,!0)}#i=S(null);get lastSaved(){return u(this.#i)}set lastSaved(e){m(this.#i,e,!0)}#s=S(ce([]));get frames(){return u(this.#s)}set frames(e){m(this.#s,e,!0)}#a=S(0);get activeFrameIndex(){return u(this.#a)}set activeFrameIndex(e){m(this.#a,e,!0)}#r=S(null);get clipboard(){return u(this.#r)}set clipboard(e){m(this.#r,e,!0)}constructor(){this.frames=[new ze("Main Motif")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,i=new ze(t);return this.frames.push(i),this.activeFrameIndex=this.frames.length-1,i}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e,t=null){this.name=e,this.currentFilePath=t,this.lastSaved=new Date}}class Ni{#e=S(null);get start(){return u(this.#e)}set start(e){m(this.#e,e,!0)}#t=S(null);get end(){return u(this.#t)}set end(e){m(this.#t,e,!0)}get isActive(){return this.start!==null}begin(e,t){this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null}get bounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}}class Bi{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){e.oldColor!==e.newColor&&(this.currentBatch?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const Y=new Bi;class Di{ctx=null;init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}playTone(e,t,i="sine",s=.1,n=1e-4){if(this.init(),!this.ctx||a.isMuted)return;const o=this.ctx.createOscillator(),l=this.ctx.createGain();o.type=i,o.frequency.setValueAtTime(e,this.ctx.currentTime);const c=s*a.sfxVolume;l.gain.setValueAtTime(c,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(n,this.ctx.currentTime+t),o.connect(l),l.connect(this.ctx.destination),o.start(),o.stop(this.ctx.currentTime+t)}playMove(){this.playTone(450,.08,"sine",.15)}playStitch(){this.playTone(1200,.15,"sine",.03),setTimeout(()=>this.playTone(1500,.1,"sine",.02),50)}playScale(e){const t=[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25],i=t[e%t.length];this.playTone(i,.15,"sine",.12)}playUnstitch(){if(this.init(),!this.ctx||a.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,i=this.ctx.createBuffer(1,t,this.ctx.sampleRate),s=i.getChannelData(0);for(let d=0;d<t;d++)s[d]=Math.random()*2-1;const n=this.ctx.createBufferSource();n.buffer=i;const o=this.ctx.createBiquadFilter();o.type="lowpass",o.frequency.setValueAtTime(1500,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const l=this.ctx.createGain(),c=.1*a.sfxVolume;l.gain.setValueAtTime(c,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),n.connect(o),o.connect(l),l.connect(this.ctx.destination),n.start()}}const z=new Di;class Ri{move(e,t){const i=Math.max(0,Math.min(a.linen.width-1,a.needle.pos.x+e)),s=Math.max(0,Math.min(a.linen.height-1,a.needle.pos.y+t));return i!==a.needle.pos.x||s!==a.needle.pos.y?(a.needle.setPos(i,s),z.playMove(),!0):!1}internalToCartesian(e,t,i,s){const n=(o,l)=>{const c=Math.floor(l/2);return l%2===0?o<c?o-c:o-c+1:o-c};return{x:n(e,i),y:-n(t,s)}}cartesianToInternal(e,t,i,s){const n=Math.floor(i/2),o=Math.floor(s/2);let l,c;i%2===0?l=e<0?e+n:e+n-1:l=e+n;const d=-t;return s%2===0?c=d<0?d+o:d+o-1:c=d+o,{x:Math.max(0,Math.min(i-1,l)),y:Math.max(0,Math.min(s-1,c))}}jumpTo(e,t){const{x:i,y:s}=this.cartesianToInternal(e,t,a.linen.width,a.linen.height);a.needle.setPos(i,s)}}class ji{stitch(){const{x:e,y:t}=a.needle.pos,i=a.linen.getIndex(e,t),s=a.linen.stitches[i],n=a.paletteState.activeDye;s!==n&&(Y.push({index:i,oldColor:s,newColor:n}),a.linen.setColor(e,t,n),z.playStitch())}unstitch(){const{x:e,y:t}=a.needle.pos,i=a.linen.getIndex(e,t),s=a.linen.stitches[i];s!==null&&(Y.push({index:i,oldColor:s,newColor:null}),a.linen.setColor(e,t,null),z.playUnstitch())}pickDye(){const{x:e,y:t}=a.needle.pos,i=a.linen.getColor(e,t);i!==null&&(a.paletteState.setDye(i),z.playStitch(),a.studio.isPicking=!0,setTimeout(()=>{a.studio.isPicking=!1},1500))}}class Gi{resize(e,t){const i=Array(e*t).fill("#eee8d5");for(let s=0;s<Math.min(a.linen.height,t);s++)for(let n=0;n<Math.min(a.linen.width,e);n++){const o=s*a.linen.width+n,l=s*e+n;i[l]=a.linen.stitches[o]}a.linen.reset(e,t,i),Y.clear(),z.playStitch()}flip(e){const{width:t,height:i,stitches:s}=a.linen,n=[...s];if(e==="horizontal")for(let o=0;o<i;o++){const l=s.slice(o*t,(o+1)*t);l.reverse();for(let c=0;c<t;c++)n[o*t+c]=l[c]}else for(let o=0;o<i;o++)for(let l=0;l<t;l++){const c=o*t+l,d=(i-1-o)*t+l;n[d]=s[c]}a.linen.stitches=n,Y.clear(),z.playStitch()}rotate(){const{width:e,height:t,stitches:i}=a.linen;if(e!==t)return;const s=Array(e*t).fill("#eee8d5");for(let n=0;n<t;n++)for(let o=0;o<e;o++){const l=n*e+o,c=o*e+(t-1-n);s[c]=i[l]}a.linen.stitches=s,Y.clear(),z.playStitch()}clearAll(){confirm("Are you sure you want to unravel the entire project?")&&(a.linen.clear(),Y.clear(),z.playUnstitch())}}class Ui{copy(){const e=a.selection.bounds;if(!e)return;const{x1:t,x2:i,y1:s,y2:n}=e,o=i-t+1,l=n-s+1,c=[];for(let d=s;d<=n;d++)for(let f=t;f<=i;f++)c.push(a.linen.getColor(f,d));a.project.clipboard={width:o,height:l,data:c},z.playStitch()}cut(){this.copy();const e=a.selection.bounds;if(!e)return;const{x1:t,x2:i,y1:s,y2:n}=e;Y.beginBatch();for(let o=s;o<=n;o++)for(let l=t;l<=i;l++){const c=a.linen.getIndex(l,o),d=a.linen.stitches[c];d!==null&&(Y.push({index:c,oldColor:d,newColor:null}),a.linen.setColor(l,o,null))}Y.endBatch(),z.playUnstitch()}paste(){const e=a.project.clipboard;if(!e)return;const{x:t,y:i}=a.needle.pos;Y.beginBatch();for(let s=0;s<e.height;s++)for(let n=0;n<e.width;n++){const o=t+n,l=i+s;if(a.linen.isValidCoord(o,l)){const c=a.linen.getIndex(o,l),d=a.linen.stitches[c],f=e.data[s*e.width+n];d!==f&&(Y.push({index:c,oldColor:d,newColor:f}),a.linen.setColor(o,l,f))}}Y.endBatch(),z.playStitch()}}class Hi{serialize(){return JSON.stringify({version:a.version,metadata:{name:a.project.name,lastModified:new Date().toISOString()},palette:a.paletteState.swatches,folio:{frames:a.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,veils:e.veils.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,stitches:t.stitches}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,a.project.currentFilePath||void 0);t&&(a.project.setMetadata(a.project.name,t),z.playStitch())}webDownload(e){const t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=`${a.project.name.toLowerCase().replace(/\s+/g,"-")}.rupa`,s.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),a.project.setMetadata(a.project.name,e.filePath),z.playStitch())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const i=t.target.files?.[0];if(i){const s=new FileReader;s.onload=n=>this.deserialize(n.target?.result),s.readAsText(i)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),a.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}deserialize(e){try{const t=JSON.parse(e);if(a.paletteState.swatches=t.palette,a.project.name=t.metadata.name,t.folio)a.project.frames=t.folio.frames.map(i=>{const s=new ze(i.name,i.width,i.height);return s.veils=i.veils.map(n=>{const o=new at(n.name,i.width,i.height);return o.isVisible=n.isVisible,o.isLocked=n.isLocked,o.stitches=n.stitches,o}),s});else if(t.pixelData){const i=new ze("Restored Motif",t.dimensions.width,t.dimensions.height);i.veils[0].stitches=t.pixelData,a.project.frames=[i]}a.project.activeFrameIndex=0,Y.clear()}catch(t){console.error("Failed to restore pattern book:",t)}}}class zi{addFrame(e){const t=a.project.addFrame(e);return z.playStitch(),t}removeFrame(e){a.project.removeFrame(e),z.playUnstitch()}nextFrame(){a.project.activeFrameIndex=(a.project.activeFrameIndex+1)%a.project.frames.length,z.playMove()}prevFrame(){a.project.activeFrameIndex=(a.project.activeFrameIndex-1+a.project.frames.length)%a.project.frames.length,z.playMove()}addVeil(e){const t=a.project.activeFrame.addVeil(e);return z.playStitch(),t}removeVeil(e){a.project.activeFrame.removeVeil(e),z.playUnstitch()}nextVeil(){const e=a.project.activeFrame;e.activeVeilIndex=(e.activeVeilIndex+1)%e.veils.length,z.playMove()}prevVeil(){const e=a.project.activeFrame;e.activeVeilIndex=(e.activeVeilIndex-1+e.veils.length)%e.veils.length,z.playMove()}toggleLock(e){const t=e!==void 0?a.project.activeFrame.veils[e]:a.project.activeFrame.activeVeil;t&&(t.isLocked=!t.isLocked,z.playStitch())}toggleVisibility(e){const t=e!==void 0?a.project.activeFrame.veils[e]:a.project.activeFrame.activeVeil;t&&(t.isVisible=!t.isVisible,z.playStitch())}reorderVeil(e,t){const i=a.project.activeFrame;if(e===t||t<0||t>=i.veils.length)return;const[s]=i.veils.splice(e,1);i.veils.splice(t,0,s),i.activeVeilIndex===e?i.activeVeilIndex=t:e<i.activeVeilIndex&&t>=i.activeVeilIndex?i.activeVeilIndex--:e>i.activeVeilIndex&&t<=i.activeVeilIndex&&i.activeVeilIndex++,z.playMove()}reorderFrame(e,t){const i=a.project;if(e===t||t<0||t>=i.frames.length)return;const[s]=i.frames.splice(e,1);i.frames.splice(t,0,s),i.activeFrameIndex===e?i.activeFrameIndex=t:e<i.activeFrameIndex&&t>=i.activeFrameIndex?i.activeFrameIndex--:e>i.activeFrameIndex&&t<=i.activeFrameIndex&&i.activeFrameIndex++,z.playMove()}moveVeilUp(){const e=a.project.activeFrame,t=e.activeVeilIndex;t<e.veils.length-1&&this.reorderVeil(t,t+1)}moveVeilDown(){const t=a.project.activeFrame.activeVeilIndex;t>0&&this.reorderVeil(t,t-1)}}class $i{begin(e,t){a.selection.begin(e,t)}update(e,t){a.selection.isActive&&a.selection.update(e,t)}clear(){a.selection.clear()}commit(){const e=a.selection.bounds;if(!e)return;const{x1:t,x2:i,y1:s,y2:n}=e,o=a.paletteState.activeDye;Y.beginBatch();let l=!1;for(let c=s;c<=n;c++)for(let d=t;d<=i;d++){const f=a.linen.getIndex(d,c),g=a.linen.stitches[f];g!==o&&(Y.push({index:f,oldColor:g,newColor:o}),a.linen.setColor(d,c,o),l=!0)}Y.endBatch(),l&&z.playStitch()}}class $e{static spin(e){const{h:t,s:i,l:s,a:n}=e,o=t/360,l=i/100,c=s/100;let d,f,g;if(l===0)d=f=g=c;else{const w=c<.5?c*(1+l):c+l-c*l,x=2*c-w,_=L=>(L<0&&(L+=1),L>1&&(L-=1),L<1/6?x+(w-x)*6*L:L<1/2?w:L<2/3?x+(w-x)*(2/3-L)*6:x);d=_(o+1/3),f=_(o),g=_(o-1/3)}const A=w=>Math.round(w*255).toString(16).padStart(2,"0"),b=Math.round(n*255).toString(16).padStart(2,"0"),C=`#${A(d)}${A(f)}${A(g)}`;return b==="ff"?C:C+b}static unravel(e){let t=0,i=0,s=0,n=1;const o=e.replace("#","");o.length===3||o.length===4?(t=parseInt(o[0]+o[0],16),i=parseInt(o[1]+o[1],16),s=parseInt(o[2]+o[2],16),o.length===4&&(n=parseInt(o[3]+o[3],16)/255)):(o.length===6||o.length===8)&&(t=parseInt(o.substring(0,2),16),i=parseInt(o.substring(2,4),16),s=parseInt(o.substring(4,6),16),o.length===8&&(n=parseInt(o.substring(6,8),16)/255)),t/=255,i/=255,s/=255;const l=Math.max(t,i,s),c=Math.min(t,i,s);let d=0,f=0,g=(l+c)/2;if(l!==c){const A=l-c;switch(f=g>.5?A/(2-l-c):A/(l+c),l){case t:d=(i-s)/A+(i<s?6:0);break;case i:d=(s-t)/A+2;break;case s:d=(t-i)/A+4;break}d/=6}return{h:Math.round(d*360),s:Math.round(f*100),l:Math.round(g*100),a:parseFloat(n.toFixed(2))}}static weather(e,t){const i=this.unravel(e);return i.l=Math.max(0,Math.min(100,i.l+t*100)),this.spin(i)}static pigment(e,t){const i=this.unravel(e);return i.s=Math.max(0,Math.min(100,i.s+t*100)),this.spin(i)}static strength(e,t){const i=this.unravel(e);return i.a=Math.max(0,Math.min(1,t)),this.spin(i)}static entwine(e,t,i=.5){this.unravel(e),this.unravel(t);const s=this.hexToRgb(e),n=this.hexToRgb(t),o={r:Math.round(s.r*(1-i)+n.r*i),g:Math.round(s.g*(1-i)+n.g*i),b:Math.round(s.b*(1-i)+n.b*i),a:s.a*(1-i)+n.a*i};return this.rgbToHex(o.r,o.g,o.b,o.a)}static hexToRgb(e){this.unravel(e);const t=e.replace("#","");let i=0,s=0,n=0,o=1;return(t.length===6||t.length===8)&&(i=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16),t.length===8&&(o=parseInt(t.substring(6,8),16)/255)),{r:i,g:s,b:n,a:o}}static rgbToHex(e,t,i,s){const n=c=>Math.round(c).toString(16).padStart(2,"0"),o=Math.round(s*255).toString(16).padStart(2,"0"),l=`#${n(e)}${n(t)}${n(i)}`;return o==="ff"?l:l+o}}class Ki{select(e){a.paletteState.select(e),z.playScale(e)}setDye(e){a.paletteState.setDye(e),z.playStitch()}pickFromLinen(){const{x:e,y:t}=a.needle.pos,i=a.linen.getColor(e,t);i!==null&&(this.setDye(i),a.studio.isPicking=!0,setTimeout(()=>{a.studio.isPicking=!1},1500))}weatherPalette(e){a.paletteState.swatches=a.paletteState.swatches.map(t=>$e.weather(t,e)),z.playStitch()}mixActiveDye(e,t=.5){const i=$e.entwine(a.activeDye,e,t);this.setDye(i)}}class Wi{movement=new Ri;stitching=new ji;manipulation=new Gi;clipboard=new Ui;persistence=new Hi;folio=new zi;selection=new $i;dye=new Ki;moveNeedle(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}stitch(){this.stitching.stitch()}unstitch(){this.stitching.unstitch()}pickDye(){this.dye.pickFromLinen()}startSelection(){this.selection.begin(a.needle.pos.x,a.needle.pos.y)}updateSelection(){this.selection.update(a.needle.pos.x,a.needle.pos.y)}commitSelection(){this.selection.commit()}clearLinen(){this.manipulation.clearAll()}resizeLinen(e,t){this.manipulation.resize(e,t)}flipLinen(e){this.manipulation.flip(e)}rotateLinen(){this.manipulation.rotate()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),a.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async createArtifact(e,t=10,i="transparent"){const{ExportEngine:s}=await ci(async()=>{const{ExportEngine:c}=await import("../chunks/sXv3HDRT.js");return{ExportEngine:c}},[],import.meta.url),{width:n,height:o,compositeStitches:l}=a.linen;if(e==="svg"){const c=s.toSVG(n,o,l,i),d=new Blob([c],{type:"image/svg+xml"});this.download(URL.createObjectURL(d),`${a.project.name}.svg`)}else{const c=await s.toPNG(n,o,l,t,i);this.download(c,`${a.project.name}.png`)}a.studio.showArtifactCrate=!1}download(e,t){const i=document.createElement("a");i.href=e,i.download=t.toLowerCase().replace(/\s+/g,"-"),i.click()}}const P=new Wi;class Qi{version="0.4.0";project=new Fi;linen=new Pi(this.project);needle=new Vi;paletteState=new Mi;studio=new Oi;selection=new Ni;get stitches(){return this.linen.stitches}set stitches(e){this.linen.stitches=e}get linenWidth(){return this.linen.width}set linenWidth(e){this.linen.width=e}get linenHeight(){return this.linen.height}set linenHeight(e){this.linen.height=e}get needlePos(){return this.needle.pos}set needlePos(e){this.needle.pos=e}get activeDye(){return this.paletteState.activeDye}set activeDye(e){this.paletteState.activeDye=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get zoomLevel(){return this.studio.zoomLevel}set zoomLevel(e){this.studio.zoomLevel=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get isAmbientPlaying(){return this.studio.isAmbientPlaying}set isAmbientPlaying(e){this.studio.isAmbientPlaying=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get usageMinutes(){return this.studio.usageMinutes}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isNeedleVisible(){return this.needle.isVisible}set isNeedleVisible(e){this.needle.isVisible=e}get projectName(){return this.project.name}set projectName(e){this.project.name=e}get currentFilePath(){return this.project.currentFilePath}set currentFilePath(e){this.project.currentFilePath=e}get lastSaved(){return this.project.lastSaved}set lastSaved(e){this.project.lastSaved=e}get clipboard(){return this.project.clipboard}set clipboard(e){this.project.clipboard=e}get showDyeBasin(){return this.studio.showDyeBasin}set showDyeBasin(e){this.studio.showDyeBasin=e}get showAudioBasin(){return this.studio.showAudioBasin}set showAudioBasin(e){this.studio.showAudioBasin=e}get showPatternCatalog(){return this.studio.showPatternCatalog}set showPatternCatalog(e){this.studio.showPatternCatalog=e}get showArtisanGuide(){return this.studio.showArtisanGuide}set showArtisanGuide(e){this.studio.showArtisanGuide=e}get showArtisanCodex(){return this.studio.showArtisanCodex}set showArtisanCodex(e){this.studio.showArtisanCodex=e}get showArtifactCrate(){return this.studio.showArtifactCrate}set showArtifactCrate(e){this.studio.showArtifactCrate=e}get showLinenSettings(){return this.studio.showLinenSettings}set showLinenSettings(e){this.studio.showLinenSettings=e}get showArchivePattern(){return this.studio.showArchivePattern}set showArchivePattern(e){this.studio.showArchivePattern=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get exportScale(){return this.studio.exportScale}set exportScale(e){this.studio.exportScale=e}get exportBgColor(){return this.studio.exportBgColor}set exportBgColor(e){this.studio.exportBgColor=e}get selectionStart(){return this.selection.start}set selectionStart(e){this.selection.start=e}get selectionEnd(){return this.selection.end}set selectionEnd(e){this.selection.end=e}#e=ye(()=>{const e=new Set;return this.linen.compositeStitches.forEach(t=>{t!==null&&e.add(t)}),Array.from(e)});get usedColors(){return u(this.#e)}set usedColors(e){m(this.#e,e)}#t=ye(()=>{const e=(t,i)=>{const s=Math.floor(i/2);return i%2===0?t<s?t-s:t-s+1:t-s};return{x:e(this.needle.pos.x,this.linen.width),y:-e(this.needle.pos.y,this.linen.height)}});get displayCoords(){return u(this.#t)}set displayCoords(e){m(this.#t,e)}#i=ye(()=>{if(this.studio.zoomLevel<=1)return`scale(${this.studio.zoomLevel})`;const e=(this.needle.pos.x+.5)/this.linen.width*100,t=(this.needle.pos.y+.5)/this.linen.height*100;return`translate(${50-e}%, ${50-t}%) scale(${this.studio.zoomLevel})`});get cameraTransform(){return u(this.#i)}set cameraTransform(e){m(this.#i,e)}resetInactivityTimer(){this.needle.resetInactivityTimer()}toggleMute(){this.studio.toggleMute()}setZoom(e){this.studio.setZoom(e)}resetZoom(){this.studio.resetZoom()}selectPalette(e){this.paletteState.select(e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}handleEscape(){return this.studio.handleEscape()}undo(){const e=Y.undo();if(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--){const i=e[t];this.linen.stitches[i.index]=i.oldColor}else this.linen.stitches[e.index]=e.oldColor;z.playUnstitch()}this.needle.resetInactivityTimer()}redo(){const e=Y.redo();if(e){if(Array.isArray(e))for(const t of e)this.linen.stitches[t.index]=t.newColor;else this.linen.stitches[e.index]=e.newColor;z.playStitch()}this.needle.resetInactivityTimer()}clearLinen(){P.clearLinen()}pickDye(){P.pickDye()}loadProject(){P.load()}copySelection(){P.copy()}cutSelection(){P.cut()}pasteSelection(){P.paste()}flipLinen(e){P.flipLinen(e)}rotateLinen(){P.rotateLinen()}}const a=new Qi,Xi={UP:["ArrowUp"],DOWN:["ArrowDown"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"],GOTO:["g"]},Yi={STITCH:["Space","Shift+Space"],UNSTITCH:["Backspace","Delete"],UNSTITCH_MOD:["Ctrl+Space"],EYEDROPPER:["i","Alt+Space"]},qi={UNDO:["Ctrl+z"],REDO:["Ctrl+Shift+z","Ctrl+y"]},Zi={COPY:["Ctrl+c"],CUT:["Ctrl+x"],PASTE:["Ctrl+v"],FLIP_H:["h"],FLIP_V:["v"],ROTATE:["r"]},Ji={ZOOM_IN:["+","="],ZOOM_OUT:["-"],RESET_ZOOM:["Ctrl+0"]},es={COMMAND_PALETTE:["Ctrl+k"],EXPORT:["Ctrl+e"],SAVE:["Ctrl+s"],OPEN:["Ctrl+o"],SETTINGS:["Ctrl+,"],COLOR_PICKER:["Ctrl+p"],AUDIO_SETTINGS:["Ctrl+Shift+a"],USER_GUIDE:["F1","Ctrl+?"],CLEAR_LINEN:["Ctrl+l"],TOGGLE_MUTE:["Ctrl+m"],ESCAPE:["Escape"]},ts={SELECT_1:["1"],SELECT_2:["2"],SELECT_3:["3"],SELECT_4:["4"],SELECT_5:["5"],SELECT_6:["6"],SELECT_7:["7"],SELECT_8:["8"],SELECT_9:["9"],SELECT_0:["0"]},is={NEW_FRAME:["Alt+n"],NEXT_FRAME:["Alt+PageDown","Tab"],PREV_FRAME:["Alt+PageUp","Shift+Tab"],DELETE_FRAME:["Alt+Backspace"]},ss={NEW_VEIL:["Alt+Shift+n"],NEXT_VEIL:["Alt+ArrowDown"],PREV_VEIL:["Alt+ArrowUp"],TOGGLE_VEIL_LOCK:["Alt+l"],TOGGLE_VEIL_VISIBILITY:["Alt+h"],MERGE_VEILS:["Alt+m"],MOVE_VEIL_UP:["["],MOVE_VEIL_DOWN:["]"],DELETE_VEIL:["Alt+Shift+Backspace"]},as={FLOW_STITCH:["Control"],FLOW_UNSTITCH:["Ctrl+Shift"],FLOW_SELECT:["Shift"]},rs={OS_CLOSE_WINDOW:["Ctrl+w"],OS_QUIT:["Ctrl+q","Alt+f4"],OS_NEW_WINDOW:["Ctrl+n"],OS_RELOAD:["Ctrl+r","F5"],OS_DEV_TOOLS:["Ctrl+Shift+i","F12"],OS_FIND:["Ctrl+f"],OS_PRINT:["Ctrl+p","Ctrl+Shift+p"],OS_FULLSCREEN:["F11"]},ns={navigation:Xi,canvas:Yi,history:qi,manipulation:Zi,view:Ji,studio:es,palette:ts,folio:is,veils:ss,modifiers:as,reserved_do_not_use:rs};class os{buffer=[];timeout=null;#e=S(ce([]));get currentSequence(){return u(this.#e)}set currentSequence(e){m(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const i=this.buffer.join(","),s={"g,c":"GOTO","f,n":"NEW_FRAME","v,n":"NEW_VEIL","v,l":"TOGGLE_VEIL_LOCK","v,h":"TOGGLE_VEIL_VISIBILITY","v,m":"MERGE_VEILS"};if(s[i]){const n=s[i];return this.reset(),n}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const rt=new os;class ls{patterns=[];#e=S(ce([]));get activeKeys(){return u(this.#e)}set activeKeys(e){m(this.#e,e,!0)}#t=S(!1);get isCtrlActive(){return u(this.#t)}set isCtrlActive(e){m(this.#t,e,!0)}#i=S(!1);get isShiftActive(){return u(this.#i)}set isShiftActive(e){m(this.#i,e,!0)}#s=S(!1);get isAltActive(){return u(this.#s)}set isAltActive(e){m(this.#s,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){const e={UP:"MOVE_UP",DOWN:"MOVE_DOWN",LEFT:"MOVE_LEFT",RIGHT:"MOVE_RIGHT",GOTO:"GOTO",STITCH:"STITCH",UNSTITCH:"UNSTITCH",EYEDROPPER:"PICK_DYE",SAVE:"OPEN_ARCHIVE",OPEN:"OPEN",SETTINGS:"OPEN_SETTINGS",FLOW_STITCH:"FLOW_STITCH",FLOW_UNSTITCH:"FLOW_UNSTITCH",FLOW_SELECT:"FLOW_SELECT",UNDO:"UNDO",REDO:"REDO",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",COMMAND_PALETTE:"OPEN_PALETTE",COLOR_PICKER:"OPEN_DYES",AUDIO_SETTINGS:"OPEN_AUDIO",USER_GUIDE:"OPEN_CODEX",EXPORT:"OPEN_EXPORT",CLEAR_LINEN:"CLEAR_LINEN",TOGGLE_MUTE:"TOGGLE_MUTE",ESCAPE:"ESCAPE",COPY:"COPY",CUT:"CUT",PASTE:"PASTE",FLIP_H:"FLIP_H",FLIP_V:"FLIP_V",ROTATE:"ROTATE",NEW_FRAME:"NEW_FRAME",NEXT_FRAME:"NEXT_FRAME",PREV_FRAME:"PREV_FRAME",DELETE_FRAME:"DELETE_FRAME",NEW_VEIL:"NEW_VEIL",NEXT_VEIL:"NEXT_VEIL",PREV_VEIL:"PREV_VEIL",TOGGLE_VEIL_LOCK:"TOGGLE_VEIL_LOCK",TOGGLE_VEIL_VISIBILITY:"TOGGLE_VEIL_VISIBILITY",MOVE_VEIL_UP:"MOVE_VEIL_UP",MOVE_VEIL_DOWN:"MOVE_VEIL_DOWN",MERGE_VEILS:"MERGE_VEILS",DELETE_VEIL:"DELETE_VEIL",SELECT_1:"SELECT_DYE_1",SELECT_2:"SELECT_DYE_2",SELECT_3:"SELECT_DYE_3",SELECT_4:"SELECT_DYE_4",SELECT_5:"SELECT_DYE_5",SELECT_6:"SELECT_DYE_6",SELECT_7:"SELECT_DYE_7",SELECT_8:"SELECT_DYE_8",SELECT_9:"SELECT_DYE_9",SELECT_0:"SELECT_DYE_0"};Object.values(ns).forEach(t=>{Object.entries(t).forEach(([i,s])=>{const n=e[i];n&&s.forEach(o=>{const l=o.toLowerCase().split("+");let c=l[l.length-1].trim();c==="space"&&(c=" "),(c==="ctrl"||c==="control")&&(c="control"),this.patterns.push({intent:n,key:c,ctrl:l.includes("ctrl")||l.includes("control"),shift:l.includes("shift"),alt:l.includes("alt")})})})}),this.patterns.sort((t,i)=>{const s=n=>(n.ctrl?1:0)+(n.shift?1:0)+(n.alt?1:0);return s(i)-s(t)})}updatePhysicalState(e,t){const i=e.key.toLowerCase();t==="down"?this.activeKeys.includes(i)||this.activeKeys.push(i):(this.activeKeys=this.activeKeys.filter(s=>s!==i),i==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="control"&&s!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const i=rt.process(t);if(i)return i}else rt.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const i of this.patterns)if(t===i.key&&this.isCtrlActive===i.ctrl&&this.isShiftActive===i.shift&&this.isAltActive===i.alt)return i.intent;return null}getLabel(e){const t=this.patterns.find(s=>s.intent===e);if(!t)return"";let i="";return t.ctrl&&(i+="Ctrl+"),t.shift&&(i+="Shift+"),t.alt&&(i+="Alt+"),i+=t.key===" "?"Space":t.key.toUpperCase(),i}}const H=new ls;class cs{#e=ye(()=>rt.isActive?{type:"ORGANIZING",label:"Weaving...",icon:"ðŸ“‘",color:"var(--color-brand)",isPulse:!0}:a.isPicking?{type:"PICKING",label:"Picking Dye",icon:"ðŸ“",color:"var(--color-brand)",isPulse:!0}:H.isCtrlActive&&H.isShiftActive?{type:"UNRAVELLING",label:"Unravelling",icon:"ðŸ§¶",color:"var(--color-brand)",isPulse:!0}:H.isShiftActive?{type:"LOOMING",label:"Block Looming",icon:"âœ¨",color:"var(--color-brand)",isPulse:!0}:H.isCtrlActive?{type:"THREADING",label:"Threading",icon:"ðŸ§µ",color:"var(--color-studio-teal)",isPulse:!0}:{type:"RESTING",label:"Studio Ready",icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return u(this.#e)}set current(e){m(this.#e,e)}}const oe=new cs;class ds{ctx=null;isPlaying=!1;nextNoteTime=0;timer=null;scale=[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25];chords=[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]];currentChordIndex=0;init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}toggle(){this.isPlaying?this.stop():this.start()}start(){this.init(),!this.isPlaying&&(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||!this.ctx||a.studio.isMuted||!a.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){if(!this.ctx)return;const t=this.chords[this.currentChordIndex],s=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(s,e),this.pianoPluck(s*2,e,.02),Math.random()>.7&&this.pianoPluck(s*.5,e+.05,.03)}pianoPluck(e,t,i=.06){if(!this.ctx)return;const s=a.usageMinutes;let n=0;s>=30&&s<60?n=(s-30)/30:s>=60&&(n=1);const o=i*n*a.bgmVolume;if(o<.001)return;const l=this.ctx.createOscillator(),c=this.ctx.createGain(),d=this.ctx.createBiquadFilter();l.type=Math.random()>.5?"sine":"triangle",l.frequency.setValueAtTime(e,t),d.type="lowpass",d.frequency.setValueAtTime(1200,t),d.frequency.exponentialRampToValueAtTime(400,t+1.5),c.gain.setValueAtTime(0,t),c.gain.linearRampToValueAtTime(o,t+.02),c.gain.exponentialRampToValueAtTime(1e-4,t+2.5),l.connect(d),d.connect(c),c.connect(this.ctx.destination),l.start(t),l.stop(t+2.6)}}const us=new ds;class vs{backupInterval=null;mount(){this.backupInterval=setInterval(()=>P.persistence.backup(),600*1e3),us.start();const e=i=>this.handleInput(i,"down"),t=i=>this.handleInput(i,"up");return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t),clearInterval(this.backupInterval)}}handleInput(e,t){if(!a.studio.isAppReady)return;H.updatePhysicalState(e,t);const i=e.target;if(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i.isContentEditable){t==="down"&&e.key==="Escape"&&a.handleEscape();return}if(a.needle.resetInactivityTimer(),t==="down"){const s=H.getIntent(e);console.log("Loom Intent:",s,"Key:",e.key,"Shift:",e.shiftKey),s&&this.executeIntent(s,e)}}executeIntent(e,t){switch(e.startsWith("MOVE_")||t.preventDefault(),e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"GOTO":return a.studio.showGoTo=!0;case"STITCH":return a.selection.isActive?P.commitSelection():P.stitching.stitch();case"UNSTITCH":return P.stitching.unstitch();case"PICK_DYE":return P.stitching.pickDye();case"COPY":return P.clipboard.copy();case"CUT":return P.clipboard.cut();case"PASTE":return P.clipboard.paste();case"UNDO":return a.undo();case"REDO":return a.redo();case"SAVE":return P.persistence.save();case"OPEN":return P.persistence.load();case"OPEN_ARCHIVE":return a.studio.showArchivePattern=!0;case"OPEN_SETTINGS":return a.studio.showLinenSettings=!0;case"ESCAPE":if(a.selection.isActive){a.selection.clear();return}return a.handleEscape();case"OPEN_PALETTE":return a.studio.showPatternCatalog=!a.studio.showPatternCatalog;case"OPEN_DYES":return a.studio.showDyeBasin=!a.studio.showDyeBasin;case"OPEN_AUDIO":return a.studio.showAudioBasin=!a.studio.showAudioBasin;case"OPEN_EXPORT":return a.studio.showArtifactCrate=!0;case"OPEN_HELP":return a.studio.showArtisanGuide=!0;case"OPEN_CODEX":return a.studio.showArtisanCodex=!0;case"ZOOM_IN":return a.studio.setZoom(.1);case"ZOOM_OUT":return a.studio.setZoom(-.1);case"RESET_ZOOM":return a.studio.resetZoom();case"CLEAR_LINEN":return P.manipulation.clearAll();case"TOGGLE_MUTE":return a.studio.toggleMute();case"FLIP_H":return P.manipulation.flip("horizontal");case"FLIP_V":return P.manipulation.flip("vertical");case"ROTATE":return P.manipulation.rotate();case"NEW_FRAME":return P.folio.addFrame();case"NEXT_FRAME":return P.folio.nextFrame();case"PREV_FRAME":return P.folio.prevFrame();case"DELETE_FRAME":return P.folio.removeFrame(a.project.activeFrameIndex);case"NEW_VEIL":return P.folio.addVeil();case"NEXT_VEIL":return P.folio.nextVeil();case"PREV_VEIL":return P.folio.prevVeil();case"DELETE_VEIL":return P.folio.removeVeil(a.project.activeFrame.activeVeilIndex);case"TOGGLE_VEIL_LOCK":return P.folio.toggleLock();case"TOGGLE_VEIL_VISIBILITY":return P.folio.toggleVisibility();case"MOVE_VEIL_UP":return P.folio.moveVeilUp();case"MOVE_VEIL_DOWN":return P.folio.moveVeilDown();case"SWITCH_FOCUS":return;default:if(e.startsWith("SELECT_DYE_")){const s=parseInt(e.split("_")[2]);return P.dye.select(s===0?9:s-1)}}}executeMove(e,t){if(P.movement.move(e,t)){const i=oe.current.type;i==="LOOMING"&&(a.selection.isActive||P.startSelection(),P.updateSelection()),i==="THREADING"&&P.stitching.stitch(),i==="UNRAVELLING"&&P.stitching.unstitch()}}}const hs=new vs;var fs=E(`<div class="pointer-events-none fixed top-0 left-0 z-40 flex w-full justify-center p-6"><div class="flex flex-col items-center"><span class="font-tiny5 text-4xl text-brand opacity-90 drop-shadow-sm">Rupa</span> <span class="-mt-1 font-serif text-[9px] font-bold tracking-[0.3em] uppercase opacity-30">The Weaver's Studio</span></div></div>`);function ps(r){var e=fs();y(r,e)}var Ee=lt(()=>a),gs=E('<div class="flex items-center gap-3"><button class="artisan-tool-btn !py-1.5"><span>ðŸ“–</span> Catalog</button> <button class="artisan-tool-btn !py-1.5"><span>ðŸ§º</span> Export</button> <button class="artisan-tool-btn !py-1.5"><span>ðŸŒ¿</span> Clear</button> <button class="artisan-tool-btn !py-1.5"><span> </span> Audio</button></div>');function As(r,e){D(e,!1),ee();var t=gs(),i=h(t);i.__click=()=>Ee(Ee().studio.showPatternCatalog=!0);var s=p(i,2);s.__click=()=>Ee(Ee().studio.showArtifactCrate=!0);var n=p(s,2);n.__click=()=>Ee().clearLinen();var o=p(n,2);o.__click=()=>Ee(Ee().showAudioBasin=!0);var l=h(o),c=h(l,!0);v(l),ke(),v(o),v(t),F(()=>N(c,Ee().isMuted?"ðŸ”‡":"ðŸ”Š")),y(r,t),R()}ne(["click"]);const xs=r=>r;function ct(r){const e=r-1;return e*e*e+1}function At(r){const e=typeof r=="string"&&r.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[r,"px"]}function ge(r,{delay:e=0,duration:t=400,easing:i=xs}={}){const s=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:i,css:n=>`opacity: ${n*s}`}}function bs(r,{delay:e=0,duration:t=400,easing:i=ct,x:s=0,y:n=0,opacity:o=0}={}){const l=getComputedStyle(r),c=+l.opacity,d=l.transform==="none"?"":l.transform,f=c*(1-o),[g,A]=At(s),[b,C]=At(n);return{delay:e,duration:t,easing:i,css:(w,x)=>`
			transform: ${d} translate(${(1-w)*g}${A}, ${(1-w)*b}${C});
			opacity: ${c-f*x}`}}function ms(r,{delay:e=0,duration:t=400,easing:i=ct,axis:s="y"}={}){const n=getComputedStyle(r),o=+n.opacity,l=s==="y"?"height":"width",c=parseFloat(n[l]),d=s==="y"?["top","bottom"]:["left","right"],f=d.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),g=parseFloat(n[`padding${f[0]}`]),A=parseFloat(n[`padding${f[1]}`]),b=parseFloat(n[`margin${f[0]}`]),C=parseFloat(n[`margin${f[1]}`]),w=parseFloat(n[`border${f[0]}Width`]),x=parseFloat(n[`border${f[1]}Width`]);return{delay:e,duration:t,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*c}px;padding-${d[0]}: ${_*g}px;padding-${d[1]}: ${_*A}px;margin-${d[0]}: ${_*b}px;margin-${d[1]}: ${_*C}px;border-${d[0]}-width: ${_*w}px;border-${d[1]}-width: ${_*x}px;min-${l}: 0`}}function Ne(r,{delay:e=0,duration:t=400,easing:i=ct,start:s=0,opacity:n=0}={}){const o=getComputedStyle(r),l=+o.opacity,c=o.transform==="none"?"":o.transform,d=1-s,f=l*(1-n);return{delay:e,duration:t,easing:i,css:(g,A)=>`
			transform: ${c} scale(${1-d*A});
			opacity: ${l-f*A}
		`}}var _s=E('<span class="font-mono text-[8px] font-bold tracking-widest uppercase opacity-30"> </span>'),ys=E('<div class="flex flex-col items-end px-4"><h2 class="font-serif text-sm font-bold tracking-[0.1em] uppercase opacity-60"> </h2> <!></div>');function ws(r,e){D(e,!1),ee();var t=ys(),i=h(t),s=h(i,!0);v(i);var n=p(i,2);{var o=l=>{var c=_s(),d=h(c);v(c),F(f=>N(d,`Archived ${f??""}`),[()=>a.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),J(3,c,()=>ge),y(l,c)};B(n,l=>{a.project.lastSaved&&l(o)})}v(t),F(()=>N(s,a.project.name)),y(r,t),R()}var Es=E('<div class="hud-panel flex h-16 w-full items-center justify-between px-6 py-2"><div class="flex items-center gap-6"><!> <div class="h-8 w-[2px] bg-grid-border"></div> <!></div> <!></div>');function Ss(r){var e=Es(),t=h(e),i=h(t);ps(i);var s=p(i,4);As(s,{}),v(t);var n=p(t,2);ws(n,{}),v(e),y(r,e)}var Cs=E('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Delete Frame">ðŸ—‘ï¸</button>'),Ts=E('<div class="h-1.5 w-1.5 rounded-xl bg-brand"></div>'),ks=E('<div role="button" tabindex="0" draggable="true"><div class="flex items-center gap-3 overflow-hidden"><span class="text-xs opacity-40"></span> <span class="truncate font-serif text-sm font-medium"> </span></div> <div class="flex items-center gap-2"><!> <!></div></div>'),Is=E('<div class="flex flex-col gap-1"></div>'),Ls=E('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand" title="Delete Veil">ðŸ—‘ï¸</button>'),Ps=E('<div class="h-1.5 w-1.5 rounded-xl bg-brand"></div>'),Vs=E('<div role="button" tabindex="0" draggable="true"><div class="flex items-center gap-3 overflow-hidden"><button> </button> <span> </span></div> <div class="flex items-center gap-2"><button> </button> <!> <!></div></div>'),Ms=E('<div class="flex flex-col gap-1"></div>'),Os=E('<div class="flex w-full flex-col overflow-hidden rounded-xl border border-black/5 bg-[#fdf6e3]/80 shadow-lg backdrop-blur-md"><div class="flex border-b border-black/5 bg-black/5 p-1"><button><span>ðŸ–¼ï¸</span> Frames</button> <button><span>ðŸ§µ</span> Veils</button></div> <div class="custom-scrollbar max-h-[30vh] overflow-y-auto p-3"><!></div> <div class="flex items-center justify-between bg-black/5 px-5 py-2"><button class="flex items-center gap-1 font-serif text-[8px] font-bold tracking-[0.2em] uppercase opacity-30 hover:opacity-60"><span>ï¼‹</span> </button> <span class="font-serif text-[8px] font-bold tracking-[0.2em] uppercase opacity-30"> </span></div></div>');function Fs(r,e){D(e,!0);let t=S("veils"),i=S(null),s=S(null);function n(M){m(i,M,!0)}function o(M,V){M.preventDefault(),m(s,V,!0)}function l(M,V){M.preventDefault(),u(i)!==null&&(u(t)==="veils"?P.folio.reorderVeil(u(i),V):P.folio.reorderFrame(u(i),V)),m(i,null),m(s,null)}function c(){m(i,null),m(s,null)}var d=Os(),f=h(d),g=h(f);g.__click=()=>m(t,"frames");var A=p(g,2);A.__click=()=>m(t,"veils"),v(f);var b=p(f,2),C=h(b);{var w=M=>{var V=Is();he(V,21,()=>a.project.frames,Ae,(j,G,I)=>{var U=ks();U.__click=()=>a.project.activeFrameIndex=I,U.__keydown=te=>te.key==="Enter"&&(a.project.activeFrameIndex=I);var q=h(U),se=h(q);se.textContent=I+1;var Q=p(se,2),O=h(Q,!0);v(Q),v(q);var ae=p(q,2),fe=h(ae);{var xe=te=>{var Le=Cs();Le.__click=We=>{We.stopPropagation(),P.folio.removeFrame(I)},y(te,Le)};B(fe,te=>{a.project.frames.length>1&&te(xe)})}var Ke=p(fe,2);{var De=te=>{var Le=Ts();y(te,Le)};B(Ke,te=>{I===a.project.activeFrameIndex&&te(De)})}v(ae),v(U),F(()=>{W(U,1,`group flex cursor-grab items-center justify-between rounded-xl px-4 py-3 transition-all ${I===a.project.activeFrameIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${u(s)===I&&u(i)!==I?"border-t-2 border-brand":""} ${u(i)===I?"opacity-40":""}`),N(O,u(G).name)}),be("dragstart",U,()=>n(I)),be("dragover",U,te=>o(te,I)),be("drop",U,te=>l(te,I)),be("dragend",U,c),y(j,U)}),v(V),J(3,V,()=>ge,()=>({duration:150})),y(M,V)},x=M=>{var V=Ms();he(V,21,()=>a.project.activeFrame.veils,Ae,(j,G,I)=>{var U=Vs();U.__click=()=>a.project.activeFrame.activeVeilIndex=I,U.__keydown=Z=>Z.key==="Enter"&&(a.project.activeFrame.activeVeilIndex=I);var q=h(U),se=h(q);se.__click=Z=>{Z.stopPropagation(),P.folio.toggleVisibility(I)};var Q=h(se,!0);v(se);var O=p(se,2),ae=h(O,!0);v(O),v(q);var fe=p(q,2),xe=h(fe);xe.__click=Z=>{Z.stopPropagation(),P.folio.toggleLock(I)};var Ke=h(xe,!0);v(xe);var De=p(xe,2);{var te=Z=>{var Re=Ls();Re.__click=Ct=>{Ct.stopPropagation(),P.folio.removeVeil(I)},y(Z,Re)};B(De,Z=>{a.project.activeFrame.veils.length>1&&Z(te)})}var Le=p(De,2);{var We=Z=>{var Re=Ps();y(Z,Re)};B(Le,Z=>{I===a.project.activeFrame.activeVeilIndex&&Z(We)})}v(fe),v(U),F(()=>{W(U,1,`group flex cursor-grab items-center justify-between rounded-xl px-4 py-3 transition-all ${I===a.project.activeFrame.activeVeilIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${u(s)===I&&u(i)!==I?"border-t-2 border-brand":""} ${u(i)===I?"opacity-40":""}`),W(se,1,`text-xs transition-opacity ${u(G).isVisible?"opacity-100":"opacity-20"}`),N(Q,u(G).isVisible?"ðŸ‘ï¸":"ðŸ•¶ï¸"),W(O,1,`truncate font-serif text-sm font-medium ${u(G).isVisible?"":"opacity-40"}`),N(ae,u(G).name),W(xe,1,`text-[10px] transition-opacity ${u(G).isLocked?"opacity-100":"opacity-20"}`),N(Ke,u(G).isLocked?"ðŸ”’":"ðŸ”“")}),be("dragstart",U,()=>n(I)),be("dragover",U,Z=>o(Z,I)),be("drop",U,Z=>l(Z,I)),be("dragend",U,c),y(j,U)}),v(V),J(3,V,()=>ge,()=>({duration:150})),y(M,V)};B(C,M=>{u(t)==="frames"?M(w):M(x,!1)})}v(b);var _=p(b,2),L=h(_);L.__click=()=>{u(t)==="frames"?P.folio.addFrame():P.folio.addVeil()};var k=p(h(L));v(L);var T=p(L,2),K=h(T,!0);v(T),v(_),v(d),F(()=>{W(g,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${u(t)==="frames"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),W(A,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${u(t)==="veils"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),N(k,` Add ${u(t)==="frames"?"Frame":"Veil"}`),N(K,u(t)==="frames"?a.project.frames.length+" Frames":a.project.activeFrame.veils.length+" Veils")}),y(r,d),R()}ne(["click","keydown"]);var Ns=E('<aside class="side-panel-left flex h-full w-64 flex-col gap-6 border-r-2 border-grid-border p-4"><div class="flex-1 overflow-y-auto"><!></div></aside>');function Bs(r){var e=Ns(),t=h(e),i=h(t);Fs(i,{}),v(t),v(e),y(r,e)}var Ds=E('<button class="group artisan-checker-small relative h-5 w-5 shrink-0 rounded-md border-2 border-white shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[6px] drop-shadow-sm">ðŸ“</span></div></button>'),Rs=E('<div class="flex h-5 w-5 items-center justify-center rounded-md border-2 border-dashed border-studio-text/10"><span class="text-[6px] opacity-20">ðŸ§µ</span></div>'),js=E('<div class="artisan-panel flex w-full flex-col gap-4 px-3 py-4 shadow-sm"><div class="flex flex-col items-center gap-2"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Active Dye</span> <div class="artisan-checker-small h-8 w-8 rounded-lg border-2 border-white shadow-md transition-colors"></div> <span class="font-mono text-[8px] font-bold tracking-tighter uppercase opacity-40"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col gap-3"><span class="text-center font-serif text-[7px] font-bold uppercase opacity-30">Used Dyes</span> <div class="no-scrollbar flex max-h-[150px] flex-row flex-wrap gap-1.5 overflow-y-auto svelte-1dy8mnv"></div></div></div>');function Gs(r,e){D(e,!1),ee();var t=js(),i=h(t),s=p(h(i),2),n=p(s,2),o=h(n,!0);v(n),v(i);var l=p(i,4),c=p(h(l),2);he(c,5,()=>a.usedColors,d=>d,(d,f)=>{var g=Ds();g.__click=()=>P.dye.setDye(u(f)),F(()=>{ie(g,`background-color: ${u(f)??""};`),Ce(g,"title",u(f))}),J(3,g,()=>ms,()=>({duration:200})),y(d,g)},d=>{var f=Rs();y(d,f)}),v(c),v(l),v(t),F(()=>{ie(s,`background-color: ${a.paletteState.activeDye??""};`),N(o,a.paletteState.activeDye)}),y(r,t),R()}ne(["click"]);var Us=E('<div class="artisan-panel stats-panel w-full rounded-xl px-4 py-3 shadow-sm"><div class="flex flex-col gap-2"><div class="flex flex-col"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Needle Focus</span> <span class="font-mono text-[10px] font-bold tabular-nums"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Linen Size</span> <span class="font-mono text-[10px] font-bold tabular-nums"> </span></div></div></div>');function Hs(r,e){D(e,!1),ee();var t=Us(),i=h(t),s=h(i),n=p(h(s),2),o=h(n);v(n),v(s);var l=p(s,4),c=p(h(l),2),d=h(c);v(c),v(l),v(i),v(t),F(()=>{N(o,`${a.displayCoords.x??""}, ${a.displayCoords.y??""}`),N(d,`${a.linen.width??""}Ã—${a.linen.height??""}`)}),y(r,t),R()}var Ge=lt(()=>a),zs=E("<button></button>"),$s=E('<div class="artisan-panel flex w-full flex-col gap-3 rounded-xl p-3 shadow-sm"><span class="text-center font-serif text-[7px] font-bold uppercase opacity-30">Dye Palette</span> <div class="grid grid-cols-4 gap-2"><!> <button class="flex h-8 w-8 items-center justify-center rounded-lg border-2 border-dashed border-brand/40 bg-gradient-to-tr from-rose-200 to-sky-200 shadow-sm transition-all hover:scale-110 hover:border-brand" title="Natural Dye Basin"><span class="text-xs">ï¼‹</span></button></div></div>');function Ks(r,e){D(e,!1),ee();var t=$s(),i=p(h(t),2),s=h(i);he(s,1,()=>Ge().palette,Ae,(o,l,c)=>{var d=zs();d.__click=()=>P.dye.select(c),Ce(d,"aria-label",`Select dye ${c+1}`),F(()=>{W(d,1,`artisan-checker-small h-8 w-8 rounded-lg border-2 transition-all ${Ge().activeDye===u(l)?"scale-110 border-brand shadow-md ring-2 ring-white":"border-white opacity-70 hover:scale-105 hover:opacity-100"}`),ie(d,`background-color: ${u(l)??""};`)}),y(o,d)});var n=p(s,2);n.__click=()=>Ge(Ge().studio.showDyeBasin=!0),v(i),v(t),y(r,t),R()}ne(["click"]);var Ws=E('<aside class="side-panel-right flex h-full w-64 flex-col gap-6 border-l-2 border-grid-border p-4"><div class="flex flex-col gap-4"><!> <!></div> <div class="flex-1"></div> <!></aside>');function Qs(r){var e=Ws(),t=h(e),i=h(t);Gs(i,{});var s=p(i,2);Ks(s,{}),v(t);var n=p(t,4);Hs(n,{}),v(e),y(r,e)}var Xs=E('<span class="text-xs"> </span>'),Ys=E('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),qs=E("<div><!> <span> </span> <!></div>"),Zs=E('<div class="text-[8px] font-bold tracking-[0.2em] uppercase opacity-20"> </div>'),Js=E('<div><div class="flex w-[180px] items-center"><!></div> <!></div>');function ea(r,e){D(e,!1),ee();var t=Js(),i=h(t),s=h(i);pi(s,()=>oe.current.type,l=>{var c=qs(),d=h(c);{var f=w=>{var x=Xs(),_=h(x,!0);v(x),F(()=>N(_,oe.current.icon)),y(w,x)};B(d,w=>{oe.current.icon&&w(f)})}var g=p(d,2),A=h(g,!0);v(g);var b=p(g,2);{var C=w=>{var x=Ys(),_=h(x);v(x),F(()=>N(_,`v${a.version??""}`)),y(w,x)};B(b,w=>{oe.current.type==="RESTING"&&w(C)})}v(c),F(()=>{W(c,1,`status-tag flex items-center gap-2 ${oe.current.isPulse?"animate-pulse":""}`),ie(c,`
					border-color: color-mix(in srgb, ${oe.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${oe.current.color??""} 10%, transparent);
					color: ${oe.current.color??""};
				`),W(g,1,Ei(oe.current.type==="RESTING"?"font-serif italic opacity-60":"font-bold")),N(A,oe.current.label)}),y(l,c)}),v(i);var n=p(i,2);{var o=l=>{const c=le(()=>a.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var d=Zs(),f=h(d);v(d),F(()=>N(f,`Linen Backed Up: ${u(c)??""}`)),y(l,d)};B(n,l=>{a.project.lastSaved&&l(o)})}v(t),F(()=>W(t,1,`flex items-center gap-4 transition-opacity duration-1000 ${a.needle.isVisible?"opacity-100":"opacity-0"}`)),y(r,t),R()}var ta=E('<span class="rounded bg-brand/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-brand uppercase"> </span>'),ia=E('<span class="font-mono text-[9px] italic opacity-20">None</span>'),sa=E('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic">Chord:</span> <div class="flex min-w-[120px] gap-1.5"><!></div></div>');function aa(r,e){D(e,!1),ee();var t=sa(),i=p(h(t),2),s=h(i);{var n=l=>{var c=Te(),d=de(c);he(d,1,()=>H.activeKeys,Ae,(f,g)=>{var A=ta(),b=h(A,!0);v(A),F(()=>N(b,u(g)===" "?"Space":u(g))),y(f,A)}),y(l,c)},o=l=>{var c=ia();y(l,c)};B(s,l=>{H.activeKeys.length>0?l(n):l(o,!1)})}v(i),v(t),y(r,t),R()}var ra=E('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic">Stance:</span> <span class="font-mono text-[9px] font-bold text-brand uppercase"> </span></div>');function na(r,e){D(e,!1),ee();var t=ra(),i=p(h(t),2),s=h(i,!0);v(i),v(t),F(()=>N(s,oe.current.type)),y(r,t),R()}var oa=E('<div class="flex items-center gap-1.5" title="Atmosphere Status"><span>ðŸŽ¹</span> <span class="font-serif text-[8px] font-bold tracking-wider text-brand/40 uppercase italic"><!></span></div>');function la(r,e){D(e,!1),ee();var t=oa(),i=h(t),s=p(i,2),n=h(s);{var o=c=>{var d=Fe("Silent");y(c,d)},l=c=>{var d=Te(),f=de(d);{var g=b=>{var C=Fe("Weaving");y(b,C)},A=b=>{var C=Fe("Resonance");y(b,C)};B(f,b=>{a.usageMinutes<60?b(g):b(A,!1)},!0)}y(c,d)};B(n,c=>{a.usageMinutes<30?c(o):c(l,!1)})}v(s),v(t),F(()=>W(i,1,`text-[9px] ${a.usageMinutes>=30?"animate-pulse":"opacity-20 grayscale"}`)),y(r,t),R()}var ca=E('<div class="flex items-center gap-1.5" title="Working Time"><span class="text-[9px] opacity-40">â³</span> <span class="font-mono text-[9px] font-bold text-brand/60 tabular-nums"> </span></div>');function da(r,e){D(e,!1),ee();var t=ca(),i=p(h(t),2),s=h(i,!0);v(i),v(t),F(()=>N(s,a.studio.sessionTimeLabel)),y(r,t),R()}var ua=E('<div class="flex items-center gap-1.5"><span class="text-[10px]">ðŸ’¾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand uppercase"> </span></div> <div class="h-3 w-px bg-brand/20"></div>',1),va=E('<div class="flex items-center gap-4 opacity-40"><!> <div class="flex gap-3 font-mono text-[8px] font-bold tracking-tighter uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-brand/20"></div> <span class="font-mono text-[9px] font-black tracking-widest text-brand/60 uppercase">Technical Ledger</span></div>');function ha(r,e){D(e,!1),ee();var t=va(),i=h(t);{var s=A=>{var b=ua(),C=de(b),w=p(h(C),2),x=h(w);v(w),v(C),ke(2),F(_=>N(x,`Backed up: ${_??""}`),[()=>a.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})]),J(3,C,()=>ge),y(A,b)};B(i,A=>{a.lastSaved&&A(s)})}var n=p(i,2),o=h(n),l=h(o);v(o);var c=p(o,2),d=h(c);v(c);var f=p(c,2),g=h(f);v(f),v(n),ke(4),v(t),F(A=>{N(l,`Pos: ${a.needlePos.x??""},${a.needlePos.y??""}`),N(d,`Size: ${a.linenWidth??""}x${a.linenHeight??""}`),N(g,`Zoom: ${A??""}%`)},[()=>Math.round(a.zoomLevel*100)]),y(r,t),R()}var fa=E('<div class="flex flex-1 items-center justify-between px-6 opacity-60 transition-opacity hover:opacity-100"><div class="flex items-center gap-6"><!> <div class="h-3 w-px bg-brand/10"></div> <!> <div class="h-3 w-px bg-brand/10"></div> <div class="flex items-center gap-4"><!> <!></div></div> <!></div>');function pa(r){var e=fa(),t=h(e),i=h(t);aa(i,{});var s=p(i,4);na(s,{});var n=p(s,4),o=h(n);da(o,{});var l=p(o,2);la(l,{}),v(n),v(t);var c=p(t,2);ha(c,{}),v(e),y(r,e)}var ga=E('<footer class="hud-panel flex h-10 w-full items-center justify-between border-t-2 border-grid-border bg-canvas-bg px-4 py-1"><div class="flex items-center gap-4"><!></div> <!></footer>');function Aa(r){var e=ga(),t=h(e),i=h(t);ea(i,{}),v(t);var s=p(t,2);pa(s),v(e),y(r,e)}var xa=E('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-studio-text/10"></div>'),ba=E('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-studio-text/10"></div>'),ma=E('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-studio-text/30"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-studio-text/30"></div> <!> <!></div>');function _a(r,e){D(e,!1),ee();var t=ma(),i=p(h(t),4);he(i,0,()=>[-24,-16,-8,8,16,24],Ae,(n,o)=>{const l=le(()=>50+o/a.linen.width*100);var c=Te(),d=de(c);{var f=g=>{var A=xa();F(()=>ie(A,`left: ${u(l)??""}%`)),y(g,A)};B(d,g=>{u(l)>0&&u(l)<100&&g(f)})}y(n,c)});var s=p(i,2);he(s,0,()=>[-24,-16,-8,8,16,24],Ae,(n,o)=>{const l=le(()=>50+o/a.linen.height*100);var c=Te(),d=de(c);{var f=g=>{var A=ba();F(()=>ie(A,`top: ${u(l)??""}%`)),y(g,A)};B(d,g=>{u(l)>0&&u(l)<100&&g(f)})}y(n,c)}),v(t),y(r,t),R()}var ya=E('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),wa=E('<div class="cursor-container absolute inset-0 svelte-4tpgo2"><div class="bloom-wrapper svelte-4tpgo2"><div class="petal p-top svelte-4tpgo2"></div> <div class="petal p-bottom svelte-4tpgo2"></div> <div class="petal p-left svelte-4tpgo2"></div> <div class="petal p-right svelte-4tpgo2"></div> <div class="center-dot svelte-4tpgo2"></div></div> <!></div>');function Ea(r,e){D(e,!1),ee();var t=Te(),i=de(t);{var s=n=>{var o=wa(),l=p(h(o),2);{var c=d=>{var f=ya(),g=de(f),A=p(g,2),b=h(A),C=h(b);v(b),ke(2),v(A),F(()=>{ie(g,`background-color: ${a.activeDye??""};`),ie(C,`background-color: ${a.activeDye??""};`)}),J(3,g,()=>ge,()=>({duration:400})),J(1,A,()=>bs,()=>({y:-10,duration:400})),J(2,A,()=>ge,()=>({duration:400})),y(d,f)};B(l,d=>{a.isPicking&&d(c)})}v(o),J(3,o,()=>ge,()=>({duration:800})),y(n,o)};B(i,n=>{a.isNeedleVisible&&n(s)})}y(r,t),R()}var Sa=E("<div><!></div>");function Ca(r,e){let t=ye(()=>e.activeX===e.x&&e.activeY===e.y),i=ye(()=>e.color===null);var s=Sa(),n=h(s);{var o=l=>{Ea(l,{})};B(n,l=>{u(t)&&l(o)})}v(s),F(()=>{W(s,1,`cell-stitch relative h-full w-full ${u(t)?"z-30":"z-10"}`),ie(s,`background-color: ${(u(i)?"transparent":e.color)??""};`)}),y(r,s)}var Ta=E('<div class="marching-ants pointer-events-none absolute z-40 svelte-1onh8x1"></div>');function ka(r,e){D(e,!1),ee();var t=Te(),i=de(t);{var s=n=>{const o=le(()=>oe.current.type==="LOOMING"),l=le(()=>Math.min(a.selection.start.x,a.selection.end.x)),c=le(()=>Math.max(a.selection.start.x,a.selection.end.x)),d=le(()=>Math.min(a.selection.start.y,a.selection.end.y)),f=le(()=>Math.max(a.selection.start.y,a.selection.end.y)),g=le(()=>u(c)-u(l)+1),A=le(()=>u(f)-u(d)+1);var b=Ta();F(()=>ie(b,`
            left: ${u(l)/a.linen.width*100}%; 
            top: ${u(d)/a.linen.height*100}%; 
            width: ${u(g)/a.linen.width*100}%; 
            height: ${u(A)/a.linen.height*100}%;
            --lasso-color: ${u(o)?"var(--color-brand)":"rgba(0,0,0,0.3)"};
            box-shadow: 0 0 0 1px rgba(255,255,255,0.5);
        `)),y(n,b)};B(i,n=>{a.selection.isActive&&a.selection.start&&a.selection.end&&n(s)})}y(r,t),R()}var Ia=E('<div class="stitch-grid-pattern artisan-checker-small relative shrink-0 origin-center shadow-sm transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]"><!> <!> <!></div>');function La(r,e){D(e,!1),ee();var t=Ia(),i=h(t);_a(i,{});var s=p(i,2);he(s,1,()=>a.linen.compositeStitches,Ae,(o,l,c)=>{const d=le(()=>c%a.linen.width),f=le(()=>Math.floor(c/a.linen.width));Ca(o,{get color(){return u(l)},get x(){return u(d)},get y(){return u(f)},get activeX(){return a.needle.pos.x},get activeY(){return a.needle.pos.y}})});var n=p(s,2);ka(n,{}),v(t),F(()=>ie(t,`
		display: grid;
		grid-template-columns: repeat(${a.linen.width??""}, 1fr); 
		grid-template-rows: repeat(${a.linen.height??""}, 1fr);
		width: min(75vh, 75vw); 
		height: min(75vh, 75vw);
		--grid-cols: ${a.linen.width??""}; 
		--grid-rows: ${a.linen.height??""}; 
		transform: ${a.cameraTransform??""};
		background-color: ${a.studio.canvasBgColor??""};
	`)),y(r,t),R()}const Pa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var Va=E(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-[#fdf6e3] svelte-1k59vfz" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');"><div class="flex flex-col items-center gap-2 svelte-1k59vfz"><div class="mb-6 flex animate-bounce items-center justify-center svelte-1k59vfz"><img alt="Rupa Icon" class="h-24 w-auto drop-shadow-md svelte-1k59vfz"/></div> <h1 class="font-tiny5 text-6xl text-brand drop-shadow-sm svelte-1k59vfz">Rupa</h1> <p class="font-serif text-[10px] font-bold tracking-[0.4em] uppercase opacity-40 svelte-1k59vfz">The Weaver's Studio</p></div> <div class="absolute bottom-16 flex flex-col items-center gap-4 svelte-1k59vfz"><div class="h-0.5 w-48 overflow-hidden rounded-xl bg-black/5 svelte-1k59vfz"><div class="h-full animate-[loading_2s_ease-in-out_infinite] bg-brand/60 svelte-1k59vfz"></div></div> <div class="flex flex-col items-center gap-1 svelte-1k59vfz"><span class="font-serif text-[10px] italic opacity-40 svelte-1k59vfz">Preparing the digital linen...</span> <span class="font-mono text-[9px] font-bold tracking-widest uppercase opacity-20 svelte-1k59vfz"> </span></div></div></div>`);function Ma(r,e){D(e,!0);let t=S(!0);Be(()=>{const o=setTimeout(()=>{m(t,!1),setTimeout(()=>{a.isAppReady=!0,a.showArtisanCodex=!0},800)},2e3);return()=>clearTimeout(o)});var i=Te(),s=de(i);{var n=o=>{var l=Va(),c=h(l),d=h(c),f=h(d);v(d),ke(4),v(c);var g=p(c,2),A=p(h(g),2),b=p(h(A),2),C=h(b);v(b),v(A),v(g),v(l),F(()=>{Ce(f,"src",Pa),N(C,`Version ${a.version??""}`)}),J(2,l,()=>ge,()=>({duration:800})),y(o,l)};B(s,o=>{u(t)&&o(n)})}y(r,i),R()}var Oa=E('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><span> </span> <span> </span></div> <input type="range"/></div>');function Ue(r,e){D(e,!0);let t=X(e,"value",15),i=X(e,"min",3,0),s=X(e,"step",3,1),n=X(e,"unit",3,""),o=X(e,"isHue",3,!1);var l=Oa(),c=h(l),d=h(c),f=h(d,!0);v(d);var g=p(d,2),A=h(g);v(g),v(c);var b=p(c,2);ue(b);let C;v(l),F(w=>{N(f,e.label),N(A,`${w??""}${n()??""}`),Ce(b,"min",i()),Ce(b,"max",e.max),Ce(b,"step",s()),C=W(b,1,"custom-slider svelte-7qe4gg",null,C,{"hue-slider":o()})},[()=>s()<1?t().toFixed(2):Math.round(t())]),ve(b,t),y(r,l),R()}var Fa=E('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="button" tabindex="-1"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl">â›²</span> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand">Dye Basin</h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30">Mix your threads</span></div></div> <div class="artisan-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><span class="font-mono text-sm font-bold opacity-40">HEX</span> <input type="text" class="w-full bg-transparent font-mono text-lg font-bold uppercase focus:outline-none"/></div> <button class="artisan-primary-btn w-full py-4">Seal the Dye</button></div></div></div>');function dt(r,e){D(e,!0);let t=X(e,"value",15),i=S(0),s=S(0),n=S(0),o=S(1);pe(()=>{const T=$e.unravel(t());Se(()=>{m(i,T.h,!0),m(s,T.s,!0),m(n,T.l,!0),m(o,T.a,!0)})}),pe(()=>{const T=$e.spin({h:u(i),s:u(s),l:u(n),a:u(o)});Se(()=>{t(T)})}),pe(()=>(Se(()=>a.pushEscapeAction(e.onClose)),()=>a.popEscapeAction(e.onClose)));var l=Fa();l.__mousedown=T=>T.target===T.currentTarget&&e.onClose();var c=h(l),d=h(c),f=p(h(d),2);v(d);var g=p(d,2),A=h(g);Ue(A,{label:"Hue",max:360,unit:"Â°",isHue:!0,get value(){return u(i)},set value(T){m(i,T,!0)}});var b=p(A,2);Ue(b,{label:"Saturation",max:100,unit:"%",get value(){return u(s)},set value(T){m(s,T,!0)}});var C=p(b,2);Ue(C,{label:"Lightness",max:100,unit:"%",get value(){return u(n)},set value(T){m(n,T,!0)}});var w=p(C,2);Ue(w,{label:"Alpha",min:0,max:1,step:.01,unit:"",get value(){return u(o)},set value(T){m(o,T,!0)}}),v(g);var x=p(g,2),_=h(x),L=p(h(_),2);ue(L),v(_);var k=p(_,2);k.__click=function(...T){e.onClose?.apply(this,T)},v(x),v(c),v(l),F(()=>ie(f,`background-color: ${t()??""};`)),ve(L,t),J(1,c,()=>Ne,()=>({duration:200,start:.95})),J(2,c,()=>Ne,()=>({duration:150,start:1,opacity:0})),J(3,l,()=>ge,()=>({duration:150})),y(r,l),R()}ne(["mousedown","click"]);var Na=E("<span> </span>"),Ba=E('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function Da(r,e){D(e,!0);var t=Ba();t.__click=()=>{e.action.action(),e.onSelect()};var i=h(t),s=h(i,!0);v(i);var n=p(i,2);{var o=l=>{var c=Na(),d=h(c,!0);v(c),F(()=>{W(c,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),N(d,e.action.shortcut)}),y(l,c)};B(n,l=>{e.action.shortcut&&l(o)})}v(t),F(()=>{W(t,1,`artisan-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),N(s,e.action.label)}),be("mouseenter",t,function(...l){e.onSelect?.apply(this,l)}),y(r,t),R()}ne(["click"]);var Ra=E('<div class="p-8 text-center font-serif text-sm italic opacity-40"> </div>'),ja=E('<div class="flex flex-col gap-1"></div>'),Ga=E('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="button" tabindex="-1"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-[#fdf6e3]/95 shadow-2xl"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40">ðŸ“–</span> <input id="catalog-search" type="text" placeholder="Search for a pattern or studio action..." class="w-full bg-transparent font-serif text-xl focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-1fnfmu0"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] uppercase opacity-30">Use Arrows to Navigate â€¢ Enter to Weave</span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] uppercase opacity-30"> </span></div></div></div>');function Ua(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.studio.showPatternCatalog=!1),i=S(""),s=S(0);const n=[{id:"save-project",label:"File: Open Archive Pattern Window",shortcut:H.getLabel("OPEN_ARCHIVE"),action:()=>a.showArchivePattern=!0},{id:"open-project",label:"File: Open Artisan Project (.rupa)",shortcut:H.getLabel("OPEN"),action:()=>a.studio.showArchivePattern=!0},{id:"open-dye-basin",label:"Color: Open Color Wheel (Dye Basin)",shortcut:H.getLabel("OPEN_DYES"),action:()=>a.showDyeBasin=!0},{id:"open-audio-basin",label:"Audio: Open Harmony & Atmosphere Tuning",shortcut:H.getLabel("OPEN_AUDIO"),action:()=>a.showAudioBasin=!0},{id:"toggle-mute",label:"Audio: Master Mute Toggle",shortcut:H.getLabel("TOGGLE_MUTE"),action:()=>a.toggleMute()},{id:"pick-dye",label:"Color: Eyedropper (Pick Dye from Canvas)",shortcut:H.getLabel("PICK_DYE"),action:()=>a.pickDye()},{id:"reset-zoom",label:"View: Reset Loom Zoom",shortcut:H.getLabel("RESET_ZOOM"),action:()=>a.resetZoom()},{id:"goto",label:"Navigation: Go to Coordinate (Direct Jump)",shortcut:H.getLabel("GOTO"),action:()=>a.showGoTo=!0},{id:"undo",label:"Edit: Undo Last Stitch",shortcut:H.getLabel("UNDO"),action:()=>a.undo()},{id:"redo",label:"Edit: Redo Last Stitch",shortcut:H.getLabel("REDO"),action:()=>a.redo()},{id:"clear-linen",label:"Project: Clear the Linen (Full Reset)",shortcut:H.getLabel("CLEAR_LINEN"),action:()=>a.clearLinen()},{id:"new-frame",label:"Folio: Add New Frame (Canvas)",shortcut:H.getLabel("NEW_FRAME"),action:()=>P.folio.addFrame()},{id:"next-frame",label:"Folio: Turn to Next Page (Frame)",shortcut:H.getLabel("NEXT_FRAME"),action:()=>P.folio.nextFrame()},{id:"new-veil",label:"Veils: Add New Veil (Layer)",shortcut:H.getLabel("NEW_VEIL"),action:()=>P.folio.addVeil()},{id:"copy-pattern",label:"Selection: Copy Pattern to Clipboard",shortcut:H.getLabel("COPY"),action:()=>a.copySelection()},{id:"cut-pattern",label:"Selection: Cut Pattern (Move source to clipboard)",shortcut:H.getLabel("CUT"),action:()=>a.cutSelection()},{id:"paste-pattern",label:"Selection: Paste Pattern from Clipboard",shortcut:H.getLabel("PASTE"),action:()=>a.pasteSelection()},{id:"flip-h",label:"Transform: Flip Linen Horizontally",shortcut:H.getLabel("FLIP_H"),action:()=>a.flipLinen("horizontal")},{id:"flip-v",label:"Transform: Flip Linen Vertically",shortcut:H.getLabel("FLIP_V"),action:()=>a.flipLinen("vertical")},{id:"rotate-linen",label:"Transform: Rotate Linen 90Â° Clockwise",shortcut:H.getLabel("ROTATE"),action:()=>a.rotateLinen()},{id:"open-codex",label:"Help: Open The Artisan's Codex (User Guide)",shortcut:H.getLabel("OPEN_CODEX"),action:()=>a.showArtisanCodex=!0},{id:"open-shortcuts",label:"Help: Show Quick Shortcut Guide",shortcut:H.getLabel("OPEN_HELP"),action:()=>a.showArtisanGuide=!0}];let o=ye(()=>n.filter(k=>k.label.toLowerCase().includes(u(i).toLowerCase())));pe(()=>{u(i),m(s,0)}),pe(()=>{u(s),u(o);const k=document.querySelector(".artisan-action-btn.active");k&&k.scrollIntoView({block:"nearest"})});function l(k){k.key==="ArrowDown"?(k.preventDefault(),m(s,(u(s)+1)%u(o).length)):k.key==="ArrowUp"?(k.preventDefault(),m(s,(u(s)-1+u(o).length)%u(o).length)):k.key==="Enter"?(k.preventDefault(),u(o)[u(s)]&&(u(o)[u(s)].action(),t()())):k.key==="Escape"&&t()()}Be(()=>document.getElementById("catalog-search")?.focus()),pe(()=>(Se(()=>a.pushEscapeAction(t())),()=>a.popEscapeAction(t())));var c=Ga();c.__mousedown=k=>k.target===k.currentTarget&&t()(),c.__keydown=l;var d=h(c),f=h(d),g=p(h(f),2);ue(g),v(f);var A=p(f,2),b=h(A);{var C=k=>{var T=Ra(),K=h(T);v(T),F(()=>N(K,`No patterns found for "${u(i)??""}"`)),y(k,T)},w=k=>{var T=ja();he(T,21,()=>u(o),Ae,(K,M,V)=>{{let j=ye(()=>u(s)===V);Da(K,{get action(){return u(M)},get isSelected(){return u(j)},onSelect:()=>m(s,V,!0)})}}),v(T),y(k,T)};B(b,k=>{u(o).length===0?k(C):k(w,!1)})}v(A);var x=p(A,2),_=p(h(x),2),L=h(_);v(_),v(x),v(d),v(c),F(()=>N(L,`${u(o).length??""} Actions Available`)),ve(g,()=>u(i),k=>m(i,k)),J(3,d,()=>Ne,()=>({duration:150,start:.98})),y(r,c),R()}ne(["mousedown","keydown"]);var Ha=E('<span class="text-3xl"> </span>'),za=E('<span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30"> </span>'),$a=E('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/20 backdrop-blur-sm"><div class="flex flex-col gap-8 overflow-hidden rounded-xl border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between border-b border-studio-text/5 pb-6"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand"> </h2> <!></div></div> <button class="rounded-xl border border-black/5 bg-white/50 px-4 py-2 text-[10px] font-bold tracking-widest uppercase opacity-40 transition-all hover:opacity-100">Close</button></div> <div><!></div></div></div>');function Ie(r,e){D(e,!0);let t=X(e,"title",3,""),i=X(e,"subtitle",3,""),s=X(e,"icon",3,""),n=X(e,"width",3,"500px"),o=X(e,"maxHeight",3,"85vh"),l=X(e,"scrollable",3,!0);pe(()=>(Se(()=>{a.pushEscapeAction(e.onClose)}),()=>a.popEscapeAction(e.onClose)));var c=$a();c.__mousedown=M=>M.target===M.currentTarget&&e.onClose();var d=h(c),f=h(d),g=h(f),A=h(g);{var b=M=>{var V=Ha(),j=h(V,!0);v(V),F(()=>N(j,s())),y(M,V)};B(A,M=>{s()&&M(b)})}var C=p(A,2),w=h(C),x=h(w,!0);v(w);var _=p(w,2);{var L=M=>{var V=za(),j=h(V,!0);v(V),F(()=>N(j,i())),y(M,V)};B(_,M=>{i()&&M(L)})}v(C),v(g);var k=p(g,2);k.__click=function(...M){e.onClose?.apply(this,M)},v(f);var T=p(f,2),K=h(T);hi(K,()=>e.children),v(T),v(d),v(c),F(()=>{ie(d,`width: ${n()??""}; max-height: ${o()??""};`),N(x,t()),W(T,1,`custom-scrollbar flex-1 ${l()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),J(1,d,()=>Ne,()=>({duration:200,start:.95})),J(2,d,()=>Ne,()=>({duration:150,start:1,opacity:0})),J(3,c,()=>ge,()=>({duration:150})),y(r,c),R()}ne(["mousedown","click"]);var Ka=E('<div class="flex flex-col items-center gap-3"><div class="artisan-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function Wa(r,e){D(e,!0);let t=S(null);pe(()=>{if(!u(t))return;const g=u(t).getContext("2d");if(!g)return;const A=a.linen.width,b=a.linen.height,C=a.linen.compositeStitches,w=400,x=Math.min(w/A,w/b);u(t).width=A*x,u(t).height=b*x,g.imageSmoothingEnabled=!1,e.bgColor==="transparent"?g.clearRect(0,0,u(t).width,u(t).height):(g.fillStyle=e.bgColor,g.fillRect(0,0,u(t).width,u(t).height)),C.forEach((_,L)=>{if(_===null)return;const k=L%A,T=Math.floor(L/A);g.fillStyle=_,g.fillRect(Math.floor(k*x),Math.floor(T*x),Math.ceil(x),Math.ceil(x))})});var i=Ka(),s=h(i),n=h(s);di(n,g=>m(t,g),()=>u(t)),v(s);var o=p(s,2),l=h(o),c=h(l);v(l);var d=p(l,2),f=h(d);v(d),v(o),v(i),F((g,A)=>{N(c,`${e.format??""} Artifact`),N(f,`${g??""} Ã— ${A??""} pixels`)},[()=>Math.round(a.linen.width*e.scale),()=>Math.round(a.linen.height*e.scale)]),y(r,i),R()}var Qa=E('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span>ðŸŽ¨</span> Match Linen Backdrop</button>'),Xa=E('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-8 overflow-y-auto pr-4"><div class="grid grid-cols-2 gap-4"><button><span class="text-4xl">ðŸ–¼ï¸</span> <div class="text-center"><h3 class="font-serif text-sm font-bold tracking-tight uppercase">Raster PNG</h3> <span class="font-serif text-[9px] font-bold tracking-widest uppercase opacity-40">Pixel Perfect</span></div></button> <button><span class="text-4xl">ðŸ“</span> <div class="text-center"><h3 class="font-serif text-sm font-bold tracking-tight uppercase">Vector SVG</h3> <span class="font-serif text-[9px] font-bold tracking-widest uppercase opacity-40">Infinite Scale</span></div></button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Artifact Scale</span> <span class="font-serif text-[10px] opacity-40">Multiplier for raster output size</span></div> <input type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg focus:outline-none"/></div> <div class="h-px w-full bg-black/5"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Background</span> <span class="font-serif text-[10px] opacity-40">Fill empty stitches with color</span></div> <div class="flex flex-wrap items-center gap-3"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" title="Transparent"></button> <button title="Studio Cream"></button> <button title="Deep Black"></button> <div class="flex items-center gap-2"><button title="Custom Backdrop"></button></div></div> <!></div></div> <button class="artisan-primary-btn w-full py-5 text-xl">Weave & Export Artifact</button></div></div>'),Ya=E("<!> <!>",1);function qa(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.showArtifactCrate=!1),i=S("png"),s=S(!1),n=S(ce(a.studio.canvasBgColor));Be(()=>{a.studio.canvasBgColor!=="#eee8d5"&&(a.studio.exportBgColor=a.studio.canvasBgColor,m(n,a.studio.canvasBgColor,!0))}),pe(()=>{a.studio.exportBgColor!=="transparent"&&a.studio.exportBgColor!=="#eee8d5"&&a.studio.exportBgColor!=="#000000"&&(a.studio.exportBgColor=u(n))});var o=Ya(),l=de(o);{var c=f=>{dt(f,{onClose:()=>m(s,!1),get value(){return u(n)},set value(g){m(n,g,!0)}})};B(l,f=>{u(s)&&f(c)})}var d=p(l,2);Ie(d,{title:"Artifact Crate",subtitle:"Prepare Artifacts for Export",icon:"ðŸ§º",get onClose(){return t()},width:"1000px",scrollable:!1,children:(f,g)=>{var A=Xa(),b=h(A),C=h(b);Wa(C,{get format(){return u(i)},get scale(){return a.studio.exportScale},get bgColor(){return a.studio.exportBgColor}}),v(b);var w=p(b,2),x=h(w),_=h(x);_.__click=()=>m(i,"png");var L=p(_,2);L.__click=()=>m(i,"svg"),v(x);var k=p(x,2),T=h(k),K=p(h(T),2);ue(K),v(T);var M=p(T,4),V=p(h(M),2),j=h(V);j.__click=()=>a.studio.exportBgColor="transparent";var G=p(j,2);G.__click=()=>a.studio.exportBgColor="#eee8d5";var I=p(G,2);I.__click=()=>a.studio.exportBgColor="#000000";var U=p(I,2),q=h(U);q.__click=()=>{m(n,u(n),!0),a.studio.exportBgColor=u(n),m(s,!0)},v(U),v(V);var se=p(V,2);{var Q=ae=>{var fe=Qa();fe.__click=()=>{m(n,a.studio.canvasBgColor,!0),a.studio.exportBgColor=u(n)},y(ae,fe)};B(se,ae=>{a.studio.canvasBgColor!=="#eee8d5"&&ae(Q)})}v(M),v(k);var O=p(k,2);O.__click=()=>e.onExport(u(i),a.studio.exportScale,a.studio.exportBgColor),v(w),v(A),F(()=>{W(_,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-8 transition-all ${u(i)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),W(L,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-8 transition-all ${u(i)==="svg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),W(j,1,`h-10 w-10 rounded-xl border-2 ${a.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),W(G,1,`h-10 w-10 rounded-xl border-2 ${a.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),W(I,1,`h-10 w-10 rounded-xl border-2 ${a.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),W(q,1,`h-10 w-16 rounded-xl border-2 ${a.studio.exportBgColor===u(n)?"border-brand":"border-black/5"} artisan-checker-small transition-transform hover:scale-105`),ie(q,`background-color: ${u(n)??""};`)}),ve(K,()=>a.studio.exportScale,ae=>a.studio.exportScale=ae),y(f,A)},$$slots:{default:!0}}),y(r,o),R()}ne(["click"]);var Za=E('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function Ja(r,e){D(e,!0);var t=Za(),i=h(t),s=h(i,!0);v(i);var n=p(i,2),o=h(n,!0);v(n),v(t),F(l=>{N(s,e.label),N(o,l)},[()=>H.getLabel(e.intent)]),y(r,t),R()}var er=E('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function tr(r,e){D(e,!0);var t=er(),i=h(t),s=h(i,!0);v(i);var n=p(i,2);he(n,21,()=>e.group.items,Ae,(o,l)=>{Ja(o,{get intent(){return u(l).intent},get label(){return u(l).label}})}),v(n),v(t),F(()=>N(s,e.group.group)),y(r,t),R()}var ir=E('<div class="grid grid-cols-1 gap-8"></div>');function sr(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.studio.showArtisanGuide=!1);const i=[{group:"Navigation & Looming",items:[{intent:"MOVE_UP",label:"Move Needle"},{intent:"GOTO",label:"Go to Coordinate"},{intent:"FLOW_SELECT",label:"Block Selection (Hold)"},{intent:"ESCAPE",label:"Clear Selection / Dismiss"}]},{group:"Digital Stitching",items:[{intent:"STITCH",label:"Stitch (Color Cell)"},{intent:"UNSTITCH",label:"Unstitch (Clear Cell)"},{intent:"FLOW_STITCH",label:"Continuous Threading (Hold)"},{intent:"FLOW_UNSTITCH",label:"Continuous Unravelling (Hold)"},{intent:"PICK_DYE",label:"Pick Dye from Linen"}]},{group:"History & Studio",items:[{intent:"UNDO",label:"Undo Last Stitch"},{intent:"REDO",label:"Redo Last Stitch"},{intent:"OPEN_PALETTE",label:"Open Pattern Catalog"},{intent:"OPEN_EXPORT",label:"Export Artifact Crate"},{intent:"OPEN_SETTINGS",label:"Linen Settings"}]},{group:"Folio & Veils",items:[{intent:"NEXT_FRAME",label:"Next Frame (Turn Page)"},{intent:"NEW_VEIL",label:"Add New Veil"},{intent:"MOVE_VEIL_UP",label:"Move Veil Up"},{intent:"MOVE_VEIL_DOWN",label:"Move Veil Down"},{intent:"TOGGLE_VEIL_VISIBILITY",label:"Show/Hide Veil"}]}];Ie(r,{title:"Artisan's Guide",subtitle:"Mastering the Digital Loom",icon:"ðŸ“œ",get onClose(){return t()},width:"600px",children:(s,n)=>{var o=ir();he(o,21,()=>i,Ae,(l,c)=>{tr(l,{get group(){return u(c)}})}),v(o),y(s,o)},$$slots:{default:!0}}),R()}var ar=E(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Pattern Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your work as a dedicated file on your machine or in your browser's archive.</p></div> <div class="flex flex-col gap-3"><button class="artisan-primary-btn w-full">Archive to Pattern Book</button> <button class="artisan-secondary-btn w-full">Restore from Pattern Book</button></div></div>`);function rr(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.studio.showArchivePattern=!1);Ie(r,{title:"Archive Pattern",subtitle:"Preserving Digital Stitches",icon:"ðŸ’¾",get onClose(){return t()},width:"400px",children:(i,s)=>{var n=ar(),o=p(h(n),2),l=h(o);l.__click=()=>{P.persistence.save(),t()()};var c=p(l,2);c.__click=()=>{P.persistence.load(),t()()},v(o),v(n),y(i,n)},$$slots:{default:!0}}),R()}ne(["click"]);var nr=E(`<div class="flex flex-col gap-8"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-2"><label for="project-name" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Project Name</label> <input id="project-name" type="text" placeholder="Unnamed Pattern" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-serif text-lg focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5"></div> <div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Width</label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Height</label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Linen Backdrop</span> <span class="font-serif text-[10px] opacity-40">Visual background color</span></div> <button class="group relative flex items-center gap-3"><div class="artisan-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">ðŸŽ¨</div></button></div> <p class="font-serif text-[10px] leading-relaxed italic opacity-40">Note: Resizing will center your current work on the new frame. Large dimensions may affect
				performance in certain environments.</p></div> <button class="artisan-primary-btn w-full py-4 text-lg">Re-stretch Linen</button></div>`),or=E("<!> <!>",1);function lr(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.studio.showLinenSettings=!1),i=S(ce(a.linen.width)),s=S(ce(a.linen.height)),n=S(!1);function o(){P.manipulation.resize(u(i),u(s)),t()()}var l=or(),c=de(l);{var d=g=>{dt(g,{onClose:()=>m(n,!1),get value(){return a.studio.canvasBgColor},set value(A){a.studio.canvasBgColor=A}})};B(c,g=>{u(n)&&g(d)})}var f=p(c,2);Ie(f,{title:"Linen Settings",subtitle:"Configure the Weaver's Frame",icon:"ðŸ“",get onClose(){return t()},width:"450px",children:(g,A)=>{var b=nr(),C=h(b),w=h(C),x=p(h(w),2);ue(x),v(w);var _=p(w,4),L=h(_),k=p(h(L),2);ue(k),v(L);var T=p(L,2),K=p(h(T),2);ue(K),v(T),v(_);var M=p(_,4),V=p(h(M),2);V.__click=()=>m(n,!0);var j=h(V);ke(2),v(V),v(M),ke(2),v(C);var G=p(C,2);G.__click=o,v(b),F(()=>ie(j,`background-color: ${a.studio.canvasBgColor??""};`)),ve(x,()=>a.project.name,I=>a.project.name=I),ve(k,()=>u(i),I=>m(i,I)),ve(K,()=>u(s),I=>m(s,I)),y(g,b)},$$slots:{default:!0}}),y(r,l),R()}ne(["click"]);var cr=E('<div class="flex flex-col gap-8"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Cartesian X</label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest uppercase opacity-40">Cartesian Y</label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed italic opacity-40"> </p></div> <button class="artisan-primary-btn w-full py-4 text-lg">Move Needle</button></div>');function dr(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.studio.showGoTo=!1),i=S(ce(a.displayCoords.x)),s=S(ce(a.displayCoords.y));function n(){P.jumpTo(u(i),u(s)),t()()}function o(l){l.key==="Enter"&&n()}Be(()=>{document.getElementById("goto-x")?.focus()}),Ie(r,{title:"Go To Coordinate",subtitle:"Direct Needle Placement",icon:"ðŸ“",get onClose(){return t()},width:"400px",children:(l,c)=>{var d=cr(),f=h(d),g=h(f),A=h(g),b=p(h(A),2);ue(b),b.__keydown=o,v(A);var C=p(A,2),w=p(h(C),2);ue(w),w.__keydown=o,v(C),v(g);var x=p(g,2),_=h(x);v(x),v(f);var L=p(f,2);L.__click=n,v(d),F(()=>N(_,`Current Position: ${a.displayCoords.x??""}, ${a.displayCoords.y??""}`)),ve(b,()=>u(i),k=>m(i,k)),ve(w,()=>u(s),k=>m(s,k)),y(l,d)},$$slots:{default:!0}}),R()}ne(["keydown","click"]);var ur=E('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all studio resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Stitch Resonance (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Atmosphere Protocol</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="artisan-primary-btn w-full py-4">Seal Settings</button></div>');function vr(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.studio.showAudioBasin=!1);pe(()=>(Se(()=>a.pushEscapeAction(t())),()=>a.popEscapeAction(t()))),Ie(r,{title:"Audio Basin",subtitle:"Harmony & Atmosphere Tuning",icon:"ðŸ”Š",get onClose(){return t()},width:"450px",children:(i,s)=>{var n=ur(),o=h(n),l=p(h(o),2);l.__click=()=>a.toggleMute();var c=h(l,!0);v(l),v(o);var d=p(o,2),f=h(d),g=h(f),A=p(h(g),2),b=h(A);v(A),v(g);var C=p(g,2);ue(C),v(f);var w=p(f,2),x=h(w),_=p(h(x),2),L=h(_);v(_),v(x);var k=p(x,2);ue(k),v(w),v(d);var T=p(d,2),K=p(h(T),2),M=h(K),V=p(h(M),2),j=h(V);v(V),v(M);var G=p(M,2),I=h(G);{var U=Q=>{var O=Fe(`The piano awaits in silence. It will begin to weave its melody after 30 minutes of
						artisanry.`);y(Q,O)},q=Q=>{var O=Fe("The piano has begun its weave. Volume will reach full depth at 60 minutes.");y(Q,O)};B(I,Q=>{a.usageMinutes<30?Q(U):Q(q,!1)})}v(G),v(K),v(T);var se=p(T,2);se.__click=function(...Q){t()?.apply(this,Q)},v(n),F((Q,O)=>{W(l,1,`artisan-secondary-btn !px-6 !py-2 ${a.isMuted?"bg-brand text-white":""}`),N(c,a.isMuted?"ðŸ”‡ Muted":"ðŸ”Š Active"),N(b,`${Q??""}%`),N(L,`${O??""}%`),N(j,`${a.usageMinutes??""} minutes`)},[()=>Math.round(a.sfxVolume*100),()=>Math.round(a.bgmVolume*100)]),ve(C,()=>a.sfxVolume,Q=>a.sfxVolume=Q),ve(k,()=>a.bgmVolume,Q=>a.bgmVolume=Q),y(i,n)},$$slots:{default:!0}}),R()}ne(["click"]);var hr=E(`<div class="flex flex-col gap-10"><section class="flex flex-col gap-4"><h3 class="font-tiny5 text-2xl text-brand">The Path of Rupa</h3> <p class="font-serif text-lg leading-relaxed italic opacity-70">"Every stitch is a decision, every motif a story."</p> <p class="font-serif text-sm leading-relaxed opacity-60">Welcome, Artisan. Rupa is a meditative space for pixel craftsmanship. Unlike traditional
				editors, Rupa is designed to be played like an instrument, where your fingers dance across
				the keys to weave digital linen into intricate patterns.</p></section> <div class="grid grid-cols-2 gap-8"><div class="rounded-2xl border border-black/5 bg-black/5 p-6"><h4 class="font-tiny5 mb-3 text-lg text-brand">The Linen & Needle</h4> <p class="font-serif text-xs leading-relaxed opacity-60">The <strong>Linen</strong> is your canvasâ€”a digital fabric awaiting your touch. The <strong>Needle</strong> is your focus, the precise point where dye meets fiber. Move the needle
					with rhythmic grace using your arrow keys.</p></div> <div class="rounded-2xl border border-black/5 bg-black/5 p-6"><h4 class="font-tiny5 mb-3 text-lg text-brand">Dyes & Stitches</h4> <p class="font-serif text-xs leading-relaxed opacity-60">A <strong>Stitch</strong> is a single unit of color. Apply <strong>Dyes</strong> using the Space
					bar. Select your threads using the number keys (1-0), each resonating with its own musical note.</p></div></div> <section class="flex flex-col gap-6"><h3 class="font-tiny5 text-2xl text-brand">Advanced Weaving</h3> <div class="flex flex-col gap-4"><div class="flex gap-6"><div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-brand/10 text-xl">ðŸ§µ</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold uppercase opacity-80">Continuous Threading</span> <p class="font-serif text-xs leading-relaxed opacity-60">Hold <strong>Control</strong> while moving to pull a continuous line of dye. Combine
							with <strong>Shift</strong> to unravel (erase) as you move.</p></div></div> <div class="flex gap-6"><div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-brand/10 text-xl">ðŸ•¸ï¸</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold uppercase opacity-80">The Active Loom (Selection)</span> <p class="font-serif text-xs leading-relaxed opacity-60">Hold <strong>Shift</strong> to define an area. Once loomed, you can fill the region
							with Space, or use <strong>Ctrl+C/X/V</strong> to capture and place swatches of your work.</p></div></div> <div class="flex gap-6"><div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-brand/10 text-xl">ðŸŽ¹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold uppercase opacity-80">Atmosphere Protocol</span> <p class="font-serif text-xs leading-relaxed opacity-60">The studio rewards focus. Silence reigns for the first 30 minutes, after which the
							Piano begins to weave its melody, reaching full resonance after an hour of creation.</p></div></div></div></section> <footer class="border-t border-black/5 pt-8 text-center"><p class="font-serif text-xs italic opacity-40">"May your stitches be true and your colors ever-vivid."</p> <button class="artisan-primary-btn mt-6 px-12">Begin the Weave</button></footer></div>`);function fr(r,e){D(e,!0);let t=X(e,"onClose",3,()=>a.showArtisanCodex=!1);Ie(r,{title:"The Artisan's Codex",subtitle:"The Sacred Scroll of Digital Weaving",icon:"ðŸ“œ",get onClose(){return t()},width:"800px",children:(i,s)=>{var n=hr(),o=p(h(n),6),l=p(h(o),2);l.__click=function(...c){t()?.apply(this,c)},v(o),v(n),y(i,n)},$$slots:{default:!0}}),R()}ne(["click"]);var $=lt(()=>a),pr=E('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg"><!> <div class="flex flex-1 overflow-hidden"><!> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20"><div class="artisan-frame flex h-[96%] w-[96%] items-center justify-center overflow-hidden"><!></div></main> <!></div> <!></div>',1);function Er(r,e){D(e,!1),Be(()=>hs.mount()),ee();var t=pr(),i=de(t);Ma(i,{});var s=p(i,2);{var n=O=>{sr(O,{onClose:()=>$($().studio.showArtisanGuide=!1)})};B(s,O=>{$().studio.showArtisanGuide&&O(n)})}var o=p(s,2);{var l=O=>{Ua(O,{onClose:()=>$($().studio.showPatternCatalog=!1)})};B(o,O=>{$().studio.showPatternCatalog&&O(l)})}var c=p(o,2);{var d=O=>{dt(O,{onClose:()=>$($().studio.showDyeBasin=!1),get value(){return $().paletteState.activeDye},set value(ae){$($().paletteState.activeDye=ae)},$$legacy:!0})};B(c,O=>{$().studio.showDyeBasin&&O(d)})}var f=p(c,2);{var g=O=>{qa(O,{onExport:(ae,fe,xe)=>P.createArtifact(ae,fe,xe),onClose:()=>$($().studio.showArtifactCrate=!1)})};B(f,O=>{$().studio.showArtifactCrate&&O(g)})}var A=p(f,2);{var b=O=>{rr(O,{onClose:()=>$($().studio.showArchivePattern=!1)})};B(A,O=>{$().studio.showArchivePattern&&O(b)})}var C=p(A,2);{var w=O=>{lr(O,{onClose:()=>$($().studio.showLinenSettings=!1)})};B(C,O=>{$().studio.showLinenSettings&&O(w)})}var x=p(C,2);{var _=O=>{dr(O,{onClose:()=>$($().studio.showGoTo=!1)})};B(x,O=>{$().studio.showGoTo&&O(_)})}var L=p(x,2);{var k=O=>{vr(O,{onClose:()=>$($().studio.showAudioBasin=!1)})};B(L,O=>{$().studio.showAudioBasin&&O(k)})}var T=p(L,2);{var K=O=>{fr(O,{onClose:()=>$($().studio.showArtisanCodex=!1)})};B(T,O=>{$().studio.showArtisanCodex&&O(K)})}var M=p(T,2),V=h(M);Ss(V);var j=p(V,2),G=h(j);Bs(G);var I=p(G,2),U=h(I),q=h(U);La(q,{}),v(U),v(I);var se=p(I,2);Qs(se),v(j);var Q=p(j,2);Aa(Q),v(M),y(r,t),R()}export{Er as component};
