import{a as C,f as L,c as Le,t as Ze,d as ft}from"../chunks/CT3rNpRm.js";import{i as be}from"../chunks/C6JRCGcY.js";import{o as Je}from"../chunks/BvmbLuiR.js";import{aL as Ii,b as ni,h as we,J as oi,a as At,aM as li,L as wt,D as Pi,n as d,N as Li,O as Mi,P as Qt,Q as kt,f as ot,aa as Vi,aE as Fi,am as Xt,c as ze,aN as De,e as It,aO as Bi,s as ji,a4 as dt,aP as Di,aC as Ft,aQ as Oi,aR as Ni,aH as Ri,a9 as Pt,aS as $i,r as ci,p as di,aT as St,U as Bt,aU as Gi,aV as Ui,aB as Hi,d as zi,ay as Ki,G as qi,E as Yi,aW as Qi,I as Xi,R as Zi,j as Ge,aX as Wi,aY as Ji,aZ as qe,au as ui,a_ as es,a$ as ts,b0 as is,b1 as ss,b2 as as,b3 as rs,b4 as ns,b5 as os,aI as ls,S as cs,b6 as ds,_,aJ as P,Z as pe,aK as X,y as O,A as v,C as p,B as u,w as q,z as Y,x as re,an as et,i as Ie,b7 as Zt}from"../chunks/B9e7bFDo.js";import{_ as jt,p as te,i as U,b as hi}from"../chunks/--fYlN4-.js";import{a as us,s as G,d as ue,e as Ae}from"../chunks/DBiZJtWt.js";import{B as hs}from"../chunks/DU247ba0.js";import{s as vs}from"../chunks/W8-T86TG.js";const ps=Symbol("NaN");function fs(l,e,t){we&&oi();var i=new hs(l),s=!Ii();ni(()=>{var a=e();a!==a&&(a=ps),s&&a!==null&&typeof a=="object"&&(a={}),i.ensure(a,t)})}function ve(l,e){return e}function gs(l,e,t){for(var i=[],s=e.length,a,n=e.length,o=0;o<s;o++){let g=e[o];di(g,()=>{if(a){if(a.pending.delete(g),a.done.add(g),a.pending.size===0){var x=l.outrogroups;Lt(Ft(a.done)),x.delete(a),x.size===0&&(l.outrogroups=null)}}else n-=1},!1)}if(n===0){var c=i.length===0&&t!==null;if(c){var h=t,f=h.parentNode;Hi(f),f.append(h),l.items.clear()}Lt(e,!c)}else a={pending:new Set(e),done:new Set},(l.outrogroups??=new Set).add(a)}function Lt(l,e=!0){for(var t=0;t<l.length;t++)zi(l[t],e)}var Wt;function de(l,e,t,i,s,a=null){var n=l,o=new Map,c=(e&li)!==0;if(c){var h=l;n=we?wt(Pi(h)):h.appendChild(At())}we&&oi();var f=null,g=dt(()=>{var y=t();return Di(y)?y:y==null?[]:Ft(y)}),x,m=!0;function A(){b.fallback=f,xs(b,x,n,e,i),f!==null&&(x.length===0?(f.f&De)===0?ci(f):(f.f^=De,Xe(f,null,n)):di(f,()=>{f=null}))}var k=ni(()=>{x=d(g);var y=x.length;let S=!1;if(we){var M=Li(n)===Mi;M!==(y===0)&&(n=Qt(),wt(n),kt(!1),S=!0)}for(var I=new Set,T=ze,E=ji(),w=0;w<y;w+=1){we&&ot.nodeType===Vi&&ot.data===Fi&&(n=ot,S=!0,kt(!1));var V=x[w],D=i(V,w),N=m?null:o.get(D);N?(N.v&&Xt(N.v,V),N.i&&Xt(N.i,w),E&&T.unskip_effect(N.e)):(N=bs(o,m?n:Wt??=At(),V,D,w,s,e,t),m||(N.e.f|=De),o.set(D,N)),I.add(D)}if(y===0&&a&&!f&&(m?f=It(()=>a(n)):(f=It(()=>a(Wt??=At())),f.f|=De)),y>I.size&&Bi(),we&&y>0&&wt(Qt()),!m)if(E){for(const[B,H]of o)I.has(B)||T.skip_effect(H.e);T.oncommit(A),T.ondiscard(()=>{})}else A();S&&kt(!0),d(g)}),b={effect:k,items:o,outrogroups:null,fallback:f};m=!1,we&&(n=ot)}function Ye(l){for(;l!==null&&(l.f&Gi)===0;)l=l.next;return l}function xs(l,e,t,i,s){var a=(i&Ui)!==0,n=e.length,o=l.items,c=Ye(l.effect.first),h,f=null,g,x=[],m=[],A,k,b,y;if(a)for(y=0;y<n;y+=1)A=e[y],k=s(A,y),b=o.get(k).e,(b.f&De)===0&&(b.nodes?.a?.measure(),(g??=new Set).add(b));for(y=0;y<n;y+=1){if(A=e[y],k=s(A,y),b=o.get(k).e,l.outrogroups!==null)for(const N of l.outrogroups)N.pending.delete(b),N.done.delete(b);if((b.f&De)!==0)if(b.f^=De,b===c)Xe(b,null,t);else{var S=f?f.next:c;b===l.effect.last&&(l.effect.last=b.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),Oe(l,f,b),Oe(l,b,S),Xe(b,S,t),f=b,x=[],m=[],c=Ye(f.next);continue}if((b.f&St)!==0&&(ci(b),a&&(b.nodes?.a?.unfix(),(g??=new Set).delete(b))),b!==c){if(h!==void 0&&h.has(b)){if(x.length<m.length){var M=m[0],I;f=M.prev;var T=x[0],E=x[x.length-1];for(I=0;I<x.length;I+=1)Xe(x[I],M,t);for(I=0;I<m.length;I+=1)h.delete(m[I]);Oe(l,T.prev,E.next),Oe(l,f,T),Oe(l,E,M),c=M,f=E,y-=1,x=[],m=[]}else h.delete(b),Xe(b,c,t),Oe(l,b.prev,b.next),Oe(l,b,f===null?l.effect.first:f.next),Oe(l,f,b),f=b;continue}for(x=[],m=[];c!==null&&c!==b;)(h??=new Set).add(c),m.push(c),c=Ye(c.next);if(c===null)continue}(b.f&De)===0&&x.push(b),f=b,c=Ye(b.next)}if(l.outrogroups!==null){for(const N of l.outrogroups)N.pending.size===0&&(Lt(Ft(N.done)),l.outrogroups?.delete(N));l.outrogroups.size===0&&(l.outrogroups=null)}if(c!==null||h!==void 0){var w=[];if(h!==void 0)for(b of h)(b.f&St)===0&&w.push(b);for(;c!==null;)(c.f&St)===0&&c!==l.fallback&&w.push(c),c=Ye(c.next);var V=w.length;if(V>0){var D=(i&li)!==0&&n===0?t:null;if(a){for(y=0;y<V;y+=1)w[y].nodes?.a?.measure();for(y=0;y<V;y+=1)w[y].nodes?.a?.fix()}gs(l,w,D)}}a&&Bt(()=>{if(g!==void 0)for(b of g)b.nodes?.a?.apply()})}function bs(l,e,t,i,s,a,n,o){var c=(n&Oi)!==0?(n&Ni)===0?Ri(t,!1,!1):Pt(t):null,h=(n&$i)!==0?Pt(s):null;return{v:c,i:h,e:It(()=>(a(e,c??t,h??s,o),()=>{l.delete(i)}))}}function Xe(l,e,t){if(l.nodes)for(var i=l.nodes.start,s=l.nodes.end,a=e&&(e.f&De)===0?e.nodes.start:t;i!==null;){var n=Ki(i);if(a.before(i),i===s)return;i=n}}function Oe(l,e,t){e===null?l.effect.first=t:e.next=t,t===null?l.effect.last=e:t.prev=e}const ms=()=>performance.now(),je={tick:l=>requestAnimationFrame(l),now:()=>ms(),tasks:new Set};function vi(){const l=je.now();je.tasks.forEach(e=>{e.c(l)||(je.tasks.delete(e),e.f())}),je.tasks.size!==0&&je.tick(vi)}function _s(l){let e;return je.tasks.size===0&&je.tick(vi),{promise:new Promise(t=>{je.tasks.add(e={c:l,f:t})}),abort(){je.tasks.delete(e)}}}function ut(l,e){ui(()=>{l.dispatchEvent(new CustomEvent(e))})}function ys(l){if(l==="float")return"cssFloat";if(l==="offset")return"cssOffset";if(l.startsWith("--"))return l;const e=l.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Jt(l){const e={},t=l.split(";");for(const i of t){const[s,a]=i.split(":");if(!s||a===void 0)break;const n=ys(s.trim());e[n]=a.trim()}return e}const As=l=>l;function ne(l,e,t,i){var s=(l&es)!==0,a=(l&ts)!==0,n=s&&a,o=(l&Wi)!==0,c=n?"both":s?"in":"out",h,f=e.inert,g=e.style.overflow,x,m;function A(){return ui(()=>h??=t()(e,i?.()??{},{direction:c}))}var k={is_global:o,in(){if(e.inert=f,!s){m?.abort(),m?.reset?.();return}a||x?.abort(),x=Mt(e,A(),m,1,()=>{ut(e,"introend"),x?.abort(),x=h=void 0,e.style.overflow=g})},out(M){if(!a){M?.(),h=void 0;return}e.inert=!0,m=Mt(e,A(),x,0,()=>{ut(e,"outroend"),M?.()})},stop:()=>{x?.abort(),m?.abort()}},b=qi;if((b.nodes.t??=[]).push(k),s&&us){var y=o;if(!y){for(var S=b.parent;S&&(S.f&Yi)!==0;)for(;(S=S.parent)&&(S.f&Qi)===0;);y=!S||(S.f&Xi)!==0}y&&Zi(()=>{Ge(()=>k.in())})}}function Mt(l,e,t,i,s){var a=i===1;if(Ji(e)){var n,o=!1;return Bt(()=>{if(!o){var b=e({direction:a?"in":"out"});n=Mt(l,b,t,i,s)}}),{abort:()=>{o=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(t?.deactivate(),!e?.duration&&!e?.delay)return ut(l,a?"introstart":"outrostart"),s(),{abort:qe,deactivate:qe,reset:qe,t:()=>i};const{delay:c=0,css:h,tick:f,easing:g=As}=e;var x=[];if(a&&t===void 0&&(f&&f(0,1),h)){var m=Jt(h(0,1));x.push(m,m)}var A=()=>1-i,k=l.animate(x,{duration:c,fill:"forwards"});return k.onfinish=()=>{k.cancel(),ut(l,a?"introstart":"outrostart");var b=t?.t()??1-i;t?.abort();var y=i-b,S=e.duration*Math.abs(y),M=[];if(S>0){var I=!1;if(h)for(var T=Math.ceil(S/16.666666666666668),E=0;E<=T;E+=1){var w=b+y*g(E/T),V=Jt(h(w,1-w));M.push(V),I||=V.overflow==="hidden"}I&&(l.style.overflow="hidden"),A=()=>{var D=k.currentTime;return b+y*g(D/S)},f&&_s(()=>{if(k.playState!=="running")return!1;var D=A();return f(D,1-D),!0})}k=l.animate(M,{duration:S,fill:"forwards"}),k.onfinish=()=>{A=()=>i,f?.(i,1-i),s()}},{abort:()=>{k&&(k.cancel(),k.effect=null,k.onfinish=qe)},deactivate:()=>{s=qe},reset:()=>{i===0&&f?.(1,0)},t:()=>A()}}function pi(l){var e,t,i="";if(typeof l=="string"||typeof l=="number")i+=l;else if(typeof l=="object")if(Array.isArray(l)){var s=l.length;for(e=0;e<s;e++)l[e]&&(t=pi(l[e]))&&(i&&(i+=" "),i+=t)}else for(t in l)l[t]&&(i&&(i+=" "),i+=t);return i}function ws(){for(var l,e,t=0,i="",s=arguments.length;t<s;t++)(l=arguments[t])&&(e=pi(l))&&(i&&(i+=" "),i+=e);return i}function ks(l){return typeof l=="object"?ws(l):l??""}const ei=[...` 	
\r\fÂ \v\uFEFF`];function Ss(l,e,t){var i=l==null?"":""+l;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var a=s.length,n=0;(n=i.indexOf(s,n))>=0;){var o=n+a;(n===0||ei.includes(i[n-1]))&&(o===i.length||ei.includes(i[o]))?i=(n===0?"":i.substring(0,n))+i.substring(o+1):n=o}}return i===""?null:i}function Cs(l,e){return l==null?null:String(l)}function z(l,e,t,i,s,a){var n=l.__className;if(we||n!==t||n===void 0){var o=Ss(t,i,a);(!we||o!==l.getAttribute("class"))&&(o==null?l.removeAttribute("class"):e?l.className=o:l.setAttribute("class",o)),l.__className=t}else if(a&&s!==a)for(var c in a){var h=!!a[c];(s==null||h!==!!s[c])&&l.classList.toggle(c,h)}return a}function J(l,e,t,i){var s=l.__style;if(we||s!==e){var a=Cs(e);(!we||a!==l.getAttribute("style"))&&(a==null?l.removeAttribute("style"):l.style.cssText=a),l.__style=e}return i}const Es=Symbol("is custom element"),Ts=Symbol("is html");function ge(l){if(we){var e=!1,t=()=>{if(!e){if(e=!0,l.hasAttribute("value")){var i=l.value;j(l,"value",null),l.value=i}if(l.hasAttribute("checked")){var s=l.checked;j(l,"checked",null),l.checked=s}}};l.__on_r=t,Bt(t),ns()}}function j(l,e,t,i){var s=Is(l);we&&(s[e]=l.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&l.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(l[is]=t),t==null?l.removeAttribute(e):typeof t!="string"&&Ps(l).includes(e)?l[e]=t:l.setAttribute(e,t))}function Is(l){return l.__attributes??={[Es]:l.nodeName.includes("-"),[Ts]:l.namespaceURI===ss}}var ti=new Map;function Ps(l){var e=l.getAttribute("is")||l.nodeName,t=ti.get(e);if(t)return t;ti.set(e,t=[]);for(var i,s=l,a=Element.prototype;a!==s;){i=rs(s);for(var n in i)i[n].set&&t.push(n);s=as(s)}return t}function xe(l,e,t=e){var i=new WeakSet;os(l,"input",async s=>{var a=s?l.defaultValue:l.value;if(a=Ct(l)?Et(a):a,t(a),ze!==null&&i.add(ze),await ls(),a!==(a=e())){var n=l.selectionStart,o=l.selectionEnd,c=l.value.length;if(l.value=a??"",o!==null){var h=l.value.length;n===o&&o===c&&h>c?(l.selectionStart=h,l.selectionEnd=h):(l.selectionStart=n,l.selectionEnd=Math.min(o,h))}}}),(we&&l.defaultValue!==l.value||Ge(e)==null&&l.value)&&(t(Ct(l)?Et(l.value):l.value),ze!==null&&i.add(ze)),cs(()=>{var s=e();if(l===document.activeElement){var a=ds??ze;if(i.has(a))return}Ct(l)&&s===Et(l.value)||l.type==="date"&&!s&&!l.value||s!==l.value&&(l.value=s??"")})}function Ct(l){var e=l.type;return e==="number"||e==="range"}function Et(l){return l===""?null:+l}function gt(l){var e=Pt(0);return function(){return arguments.length===1?(_(e,d(e)+1),arguments[0]):(d(e),l())}}class Ls{project;#e=P(pe([]));get stitchBuffer(){return d(this.#e)}set stitchBuffer(e){_(this.#e,e,!0)}#t=P(pe([]));get strokePoints(){return d(this.#t)}set strokePoints(e){_(this.#t,e,!0)}internalBuffer=new Set;constructor(e){this.project=e}get width(){return this.project.activeFrame.width}set width(e){this.project.activeFrame.width=e}get height(){return this.project.activeFrame.height}set height(e){this.project.activeFrame.height=e}get stitches(){return this.project.activeFrame.activeVeil.stitches}get compositeStitches(){return this.project.activeFrame.compositeStitches}set stitches(e){this.project.activeFrame.activeVeil.stitches=e}clearBuffer(){this.internalBuffer.clear(),this.stitchBuffer=[],this.strokePoints=[]}addBatchToBuffer(e){const t=[...this.strokePoints];e.forEach(i=>{const s=Math.floor(i.x),a=Math.floor(i.y);this.isValidCoord(s,a)&&(this.internalBuffer.add(this.getIndex(s,a)),t.push({x:i.x,y:i.y}))}),this.strokePoints=t,this.stitchBuffer=Array.from(this.internalBuffer)}addToBuffer(e,t){this.addBatchToBuffer([{x:e,y:t}])}reset(e,t,i){this.width=e,this.height=t,this.stitches=i}clear(){this.project.activeFrame.activeVeil.clear()}getIndex(e,t){return t*this.width+e}getColor(e,t){return this.stitches[this.getIndex(e,t)]}setColor(e,t,i){this.stitches[this.getIndex(e,t)]=i}isValidCoord(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}}class Ms{#e=P(pe({x:0,y:0}));get pos(){return d(this.#e)}set pos(e){_(this.#e,e,!0)}#t=P(!0);get isVisible(){return d(this.#t)}set isVisible(e){_(this.#t,e,!0)}inactivityTimer=null;INACTIVITY_TIMEOUT=2e4;resetInactivityTimer(){this.isVisible=!0,this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.inactivityTimer=setTimeout(()=>{this.isVisible=!1},this.INACTIVITY_TIMEOUT)}setPos(e,t){this.pos={x:e,y:t},this.resetInactivityTimer()}}const Vs=["#2d3319","#4b5d16","#859900","#a2ad59","#eee8d5","#fdf6e3","#93a1a1","#586e75","#073642","#002b36"],Fs=["#002b36","#073642","#586e75","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#2aa198","#859900"],Tt={default:["#073642","#586e75","#859900","#2aa198","#268bd2","#6c71c4","#d33682","#dc322f","#cb4b16","#b58900"],botanical:Vs,sunset:Fs};class Bs{#e=P(pe(Tt.default[0]));get activeDye(){return d(this.#e)}set activeDye(e){_(this.#e,e,!0)}#t=P(pe(Tt.default));get swatches(){return d(this.#t)}set swatches(e){_(this.#t,e,!0)}select(e){e>=0&&e<this.swatches.length&&(this.activeDye=this.swatches[e])}setDye(e){this.activeDye=e}loadPalette(e){this.swatches=Tt[e],this.activeDye=this.swatches[0]}}class js{#e=P(1);get zoomLevel(){return d(this.#e)}set zoomLevel(e){_(this.#e,e,!0)}#t=P(!1);get isMuted(){return d(this.#t)}set isMuted(e){_(this.#t,e,!0)}#i=P(!0);get isAmbientPlaying(){return d(this.#i)}set isAmbientPlaying(e){_(this.#i,e,!0)}#s=P(!1);get isAppReady(){return d(this.#s)}set isAppReady(e){_(this.#s,e,!0)}#a=P(!1);get isPicking(){return d(this.#a)}set isPicking(e){_(this.#a,e,!0)}#r=P(50);get stabilization(){return d(this.#r)}set stabilization(e){_(this.#r,e,!0)}#n=P(.5);get bgmVolume(){return d(this.#n)}set bgmVolume(e){_(this.#n,e,!0)}#o=P(.5);get sfxVolume(){return d(this.#o)}set sfxVolume(e){_(this.#o,e,!0)}#l=P(10);get fps(){return d(this.#l)}set fps(e){_(this.#l,e,!0)}#c=P(!1);get isKineticMode(){return d(this.#c)}set isKineticMode(e){_(this.#c,e,!0)}#d=P(!1);get showGhostThreads(){return d(this.#d)}set showGhostThreads(e){_(this.#d,e,!0)}sessionStartTime=Date.now();#u=P(0);get usageMinutes(){return d(this.#u)}set usageMinutes(e){_(this.#u,e,!0)}#h=P(0);get usageSeconds(){return d(this.#h)}set usageSeconds(e){_(this.#h,e,!0)}#v=X(()=>{const e=this.usageSeconds,t=Math.floor(e/3600),i=Math.floor(e%3600/60),s=e%60;return`${t>0?t+":":""}${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`});get sessionTimeLabel(){return d(this.#v)}set sessionTimeLabel(e){_(this.#v,e)}#p=P(!1);get showDyeBasin(){return d(this.#p)}set showDyeBasin(e){_(this.#p,e,!0)}#f=P(!1);get showAudioBasin(){return d(this.#f)}set showAudioBasin(e){_(this.#f,e,!0)}#g=P(!1);get showPatternCatalog(){return d(this.#g)}set showPatternCatalog(e){_(this.#g,e,!0)}#x=P(!1);get showArtisanGuide(){return d(this.#x)}set showArtisanGuide(e){_(this.#x,e,!0)}#b=P(!1);get showArtisanCodex(){return d(this.#b)}set showArtisanCodex(e){_(this.#b,e,!0)}#m=P(!1);get showArtifactCrate(){return d(this.#m)}set showArtifactCrate(e){_(this.#m,e,!0)}#_=P(!1);get showLinenSettings(){return d(this.#_)}set showLinenSettings(e){_(this.#_,e,!0)}#y=P(!1);get showArchivePattern(){return d(this.#y)}set showArchivePattern(e){_(this.#y,e,!0)}#A=P(!1);get showGoTo(){return d(this.#A)}set showGoTo(e){_(this.#A,e,!0)}#w=P("veils");get folioActiveTab(){return d(this.#w)}set folioActiveTab(e){_(this.#w,e,!0)}#k=P("#eee8d5");get canvasBgColor(){return d(this.#k)}set canvasBgColor(e){_(this.#k,e,!0)}#S=P(10);get exportScale(){return d(this.#S)}set exportScale(e){_(this.#S,e,!0)}#C=P("transparent");get exportBgColor(){return d(this.#C)}set exportBgColor(e){_(this.#C,e,!0)}escapeStack=[];setZoom(e){const t=this.zoomLevel+e;this.zoomLevel=Math.max(.5,Math.min(5,Number(t.toFixed(1))))}resetZoom(){this.zoomLevel=1}toggleMute(){this.isMuted=!this.isMuted}pushEscapeAction(e){this.escapeStack.push(e)}popEscapeAction(e){this.escapeStack=this.escapeStack.filter(t=>t!==e)}handleEscape(){const e=this.escapeStack.pop();return e?(e(),!0):!1}}class We{id=crypto.randomUUID();#e=P("New Veil");get name(){return d(this.#e)}set name(e){_(this.#e,e,!0)}#t=P(!0);get isVisible(){return d(this.#t)}set isVisible(e){_(this.#t,e,!0)}#i=P(!1);get isLocked(){return d(this.#i)}set isLocked(e){_(this.#i,e,!0)}#s=P(1);get opacity(){return d(this.#s)}set opacity(e){_(this.#s,e,!0)}#a=P(pe([]));get stitches(){return d(this.#a)}set stitches(e){_(this.#a,e,!0)}constructor(e,t,i){this.name=e,this.stitches=Array(t*i).fill(null)}clone(e,t){const i=new We(this.name,e,t);return i.stitches=[...this.stitches],i.isVisible=this.isVisible,i.isLocked=this.isLocked,i.opacity=this.opacity,i}clear(){this.stitches.fill(null)}hasStitch(e){return this.stitches[e]!==null}}class ht{id=crypto.randomUUID();#e=P("Untitled Frame");get name(){return d(this.#e)}set name(e){_(this.#e,e,!0)}#t=P(32);get width(){return d(this.#t)}set width(e){_(this.#t,e,!0)}#i=P(32);get height(){return d(this.#i)}set height(e){_(this.#i,e,!0)}#s=P(100);get duration(){return d(this.#s)}set duration(e){_(this.#s,e,!0)}#a=P(pe([]));get veils(){return d(this.#a)}set veils(e){_(this.#a,e,!0)}#r=P(0);get activeVeilIndex(){return d(this.#r)}set activeVeilIndex(e){_(this.#r,e,!0)}constructor(e,t=32,i=32){this.name=e,this.width=t,this.height=i,this.veils=[new We("Base Veil",t,i)]}get activeVeil(){return this.veils[this.activeVeilIndex]}addVeil(e){const t=e||`Veil ${this.veils.length+1}`,i=new We(t,this.width,this.height);return this.veils.push(i),this.activeVeilIndex=this.veils.length-1,i}removeVeil(e){this.veils.length<=1||(this.veils.splice(e,1),this.activeVeilIndex>=this.veils.length&&(this.activeVeilIndex=this.veils.length-1))}get compositeStitches(){const e=new Array(this.width*this.height).fill(null);for(const t of this.veils)if(t.isVisible)for(let i=0;i<e.length;i++){const s=t.stitches[i];s!==null&&(e[i]=s)}return e}}class Ds{#e=P("Untitled Stitch");get name(){return d(this.#e)}set name(e){_(this.#e,e,!0)}#t=P(null);get currentFilePath(){return d(this.#t)}set currentFilePath(e){_(this.#t,e,!0)}#i=P(null);get lastSaved(){return d(this.#i)}set lastSaved(e){_(this.#i,e,!0)}#s=P(pe([]));get frames(){return d(this.#s)}set frames(e){_(this.#s,e,!0)}#a=P(0);get activeFrameIndex(){return d(this.#a)}set activeFrameIndex(e){_(this.#a,e,!0)}#r=P(!1);get isPlaying(){return d(this.#r)}set isPlaying(e){_(this.#r,e,!0)}#n=P(null);get clipboard(){return d(this.#n)}set clipboard(e){_(this.#n,e,!0)}constructor(){this.frames=[new ht("Main Motif")]}get activeFrame(){return this.frames[this.activeFrameIndex]}addFrame(e){const t=e||`Frame ${this.frames.length+1}`,i=new ht(t);return this.frames.push(i),this.activeFrameIndex=this.frames.length-1,i}removeFrame(e){this.frames.length<=1||(this.frames.splice(e,1),this.activeFrameIndex>=this.frames.length&&(this.activeFrameIndex=this.frames.length-1))}setMetadata(e,t=null){this.name=e,this.currentFilePath=t,this.lastSaved=new Date}}class Os{#e=P(null);get start(){return d(this.#e)}set start(e){_(this.#e,e,!0)}#t=P(null);get end(){return d(this.#t)}set end(e){_(this.#t,e,!0)}#i=P(pe([]));get indices(){return d(this.#i)}set indices(e){_(this.#i,e,!0)}#s=P(pe([]));get vertices(){return d(this.#s)}set vertices(e){_(this.#s,e,!0)}get isActive(){return this.indices.length>0||this.start!==null||this.vertices.length>0}begin(e,t){this.clear(),this.start={x:e,y:t},this.end={x:e,y:t}}update(e,t){this.start&&(this.end={x:e,y:t})}clear(){this.start=null,this.end=null,this.indices=[],this.vertices=[]}getPoints(e){const t=new Map;this.indices.forEach(s=>{t.set(s,{x:s%e,y:Math.floor(s/e)})});const i=this.rectangularBounds;if(i)for(let s=i.y1;s<=i.y2;s++)for(let a=i.x1;a<=i.x2;a++){const n=s*e+a;t.set(n,{x:a,y:s})}return Array.from(t.values())}getBoundaryEdges(e){const t=[],i=this.getPoints(e);if(i.length===0)return t;const s=new Set(i.map(a=>`${a.x},${a.y}`));return i.forEach(a=>{s.has(`${a.x},${a.y-1}`)||t.push({x1:a.x,y1:a.y,x2:a.x+1,y2:a.y}),s.has(`${a.x},${a.y+1}`)||t.push({x1:a.x,y1:a.y+1,x2:a.x+1,y2:a.y+1}),s.has(`${a.x-1},${a.y}`)||t.push({x1:a.x,y1:a.y,x2:a.x,y2:a.y+1}),s.has(`${a.x+1},${a.y}`)||t.push({x1:a.x+1,y1:a.y,x2:a.x+1,y2:a.y+1})}),t}get rectangularBounds(){return!this.start||!this.end?null:{x1:Math.min(this.start.x,this.end.x),x2:Math.max(this.start.x,this.end.x),y1:Math.min(this.start.y,this.end.y),y2:Math.max(this.start.y,this.end.y)}}getEffectiveBounds(e){const t=this.getPoints(e);if(t.length===0)return null;let i=1/0,s=-1/0,a=1/0,n=-1/0;return t.forEach(o=>{o.x<i&&(i=o.x),o.x>s&&(s=o.x),o.y<a&&(a=o.y),o.y>n&&(n=o.y)}),{x1:i,x2:s,y1:a,y2:n,width:s-i+1,height:n-a+1}}}class Ns{undoStack=[];redoStack=[];maxHistory=500;currentBatch=null;beginBatch(){this.currentBatch=[]}endBatch(){this.currentBatch&&this.currentBatch.length>0&&(this.undoStack.push(this.currentBatch),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()),this.currentBatch=null}push(e){!("isStructural"in e)&&!Array.isArray(e)&&e.oldColor===e.newColor||(this.currentBatch&&!("isStructural"in e)&&!Array.isArray(e)?this.currentBatch.push(e):(this.undoStack.push(e),this.redoStack=[],this.undoStack.length>this.maxHistory&&this.undoStack.shift()))}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),e):null}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.currentBatch=null}}const K=new Ns;class Rs{context=null;get ctx(){return this.context||(this.context=new(window.AudioContext||window.webkitAudioContext)),this.context}async resume(){this.ctx.state==="suspended"&&await this.ctx.resume()}get isReady(){return this.context!==null&&this.context.state==="running"}}const Dt=new Rs,$s={"c-major":[261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25]},Gs={move:{freq:450,duration:.08,volume:.15},stitch:{freq:1200,duration:.15,volume:.03},startup:{freq:220,duration:.8,volume:.1},ready:[523.25,659.25,783.99,1046.5]},Us={scale:[155.56,174.61,196,233.08,261.63,311.13,349.23,392,466.16,523.25],chords:[[155.56,196,233.08,261.63],[174.61,233.08,349.23,466.16],[130.81,196,261.63,311.13],[116.54,174.61,233.08,349.23]],fade:{startMins:30,fullMins:60}},Re={scales:$s,tones:Gs,ambient:Us};class Hs{get ctx(){return Dt.ctx}playTone(e,t,i="sine",s=.1,a=1e-4){if(r.isMuted)return;const n=this.ctx.createOscillator(),o=this.ctx.createGain();n.type=i,n.frequency.setValueAtTime(e,this.ctx.currentTime);const c=s*r.sfxVolume;o.gain.setValueAtTime(c,this.ctx.currentTime),o.gain.exponentialRampToValueAtTime(a,this.ctx.currentTime+t),n.connect(o),o.connect(this.ctx.destination),n.start(),n.stop(this.ctx.currentTime+t)}playMove(){const{freq:e,duration:t,volume:i}=Re.tones.move;this.playTone(e,t,"sine",i)}playStitch(){const{freq:e,duration:t,volume:i}=Re.tones.stitch;this.playTone(e,t,"sine",i),setTimeout(()=>this.playTone(e*1.25,t*.6,"sine",i*.6),50)}playScale(e){const t=Re.scales["c-major"],i=t[e%t.length];this.playTone(i,.15,"sine",.12)}playUnstitch(){if(r.isMuted)return;const e=.25,t=this.ctx.sampleRate*e,i=this.ctx.createBuffer(1,t,this.ctx.sampleRate),s=i.getChannelData(0);for(let h=0;h<t;h++)s[h]=Math.random()*2-1;const a=this.ctx.createBufferSource();a.buffer=i;const n=this.ctx.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(1500,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+e);const o=this.ctx.createGain(),c=.1*r.sfxVolume;o.gain.setValueAtTime(c,this.ctx.currentTime),o.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+e),a.connect(n),n.connect(o),o.connect(this.ctx.destination),a.start()}playStartup(){const{freq:e,duration:t,volume:i}=Re.tones.startup;this.playTone(e,t,"sine",i),this.playTone(e/2,t*1.5,"sine",i/2)}playReady(){Re.tones.ready.forEach((t,i)=>{setTimeout(()=>this.playTone(t,.4,"sine",.05),i*100)})}}const $=new Hs;class zs{move(e,t){const i=Math.max(0,Math.min(r.linen.width-1,r.needle.pos.x+e)),s=Math.max(0,Math.min(r.linen.height-1,r.needle.pos.y+t));return i!==r.needle.pos.x||s!==r.needle.pos.y?(r.needle.setPos(i,s),$.playMove(),!0):!1}internalToCartesian(e,t,i,s){const a=(n,o)=>{const c=Math.floor(o/2);return o%2===0?n<c?n-c:n-c+1:n-c};return{x:a(e,i),y:-a(t,s)}}cartesianToInternal(e,t,i,s){const a=Math.floor(i/2),n=Math.floor(s/2);let o,c;i%2===0?o=e<0?e+a:e+a-1:o=e+a;const h=-t;return s%2===0?c=h<0?h+n:h+n-1:c=h+n,{x:Math.max(0,Math.min(i-1,o)),y:Math.max(0,Math.min(s-1,c))}}jumpTo(e,t){const{x:i,y:s}=this.cartesianToInternal(e,t,r.linen.width,r.linen.height);r.needle.setPos(i,s)}jumpHome(){const e=Math.floor(r.linen.width/2),t=Math.floor(r.linen.height/2);r.needle.setPos(e,t),$.playMove()}}class ct{static getLinePoints(e,t,i,s,a=0){e=Math.floor(e),t=Math.floor(t),i=Math.floor(i),s=Math.floor(s);const n=[],o=Math.abs(i-e),c=Math.abs(s-t),h=e<i?1:-1,f=t<s?1:-1;let g=o-c;for(;;){n.push({x:e,y:t});const x=o===c,m=o===0||c===0;if(a>.9&&!x&&!m&&(o>c?n.push({x:e,y:t+f}):n.push({x:e+h,y:t})),e===i&&t===s)break;const A=2*g;A>-c&&(g-=c,e+=h),A<o&&(g+=o,t+=f)}return n}static getCirclePoints(e,t,i){e=Math.floor(e),t=Math.floor(t),i=Math.round(i);const s=[];let a=i,n=0,o=0;for(;a>=n;)[{x:e+a,y:t+n},{x:e+n,y:t+a},{x:e-n,y:t+a},{x:e-a,y:t+n},{x:e-a,y:t-n},{x:e-n,y:t-a},{x:e+n,y:t-a},{x:e+a,y:t-n}].forEach(h=>s.push(h)),o<=0&&(n+=1,o+=2*n+1),o>0&&(a-=1,o-=2*a+1);return s}static fitArc(e,t){if(e.length<10)return null;let i=0,s=0;e.forEach(w=>{i+=w.x,s+=w.y});const a=i/e.length,n=s/e.length;let o=0;const c=e.map(w=>{const V=Math.sqrt((w.x-a)**2+(w.y-n)**2);return o+=V,V}),h=o/e.length;let f=0;if(c.forEach(w=>{f+=(w-h)**2}),Math.sqrt(f/e.length)/(h||1)>t)return null;const m=e[0],A=e[e.length-1],b=Math.sqrt((m.x-A.x)**2+(m.y-A.y)**2)<h*1.5||e.length>h*Math.PI*1.5,y=[],S=Math.atan2(e[0].y-n,e[0].x-a),M=Math.atan2(e[e.length-1].y-n,e[e.length-1].x-a),I=Math.max(32,Math.floor(h*10));let T=M-S;for(;T>Math.PI;)T-=Math.PI*2;for(;T<-Math.PI;)T+=Math.PI*2;const E=b?Math.PI*2:T;for(let w=0;w<=I;w++){const V=S+E*(w/I);y.push({x:a+Math.cos(V)*h,y:n+Math.sin(V)*h})}return{cx:a,cy:n,r:h,isFull:b,points:y}}static perpendicularDistance(e,t,i){const s=i.x-t.x,a=i.y-t.y;return s===0&&a===0?Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2):Math.abs(a*e.x-s*e.y+i.x*t.y-i.y*t.x)/Math.sqrt(s*s+a*a)}}class ii{static simplify(e,t){if(e.length<=2||t<=0)return e;let i=0,s=0;const a=e[0],n=e[e.length-1];for(let o=1;o<e.length-1;o++){const c=ct.perpendicularDistance(e[o],a,n);c>i&&(s=o,i=c)}if(i>t){const o=this.simplify(e.slice(0,s+1),t),c=this.simplify(e.slice(s),t);return[...o.slice(0,-1),...c]}else return[a,n]}static smooth(e,t){if(e.length<=2||t<=0)return e;const i=[...e],s=Math.floor(t/10)+1;for(let a=1;a<e.length-1;a++){let n=0,o=0,c=0;for(let h=a-s;h<=a+s;h++)h>=0&&h<e.length&&(n+=e[h].x,o+=e[h].y,c++);i[a]={x:n/c,y:o/c}}return i}}class Ne{static getLinePoints(e,t,i,s,a=0){return ct.getLinePoints(e,t,i,s,a)}static simplifyPath(e,t){return ii.simplify(e,t)}static smoothPath(e,t){return ii.smooth(e,t)}static fitArc(e,t){if(t<10)return null;const i=.05+t/100*.35;return ct.fitArc(e,i)}static getCirclePoints(e,t,i){return ct.getCirclePoints(e,t,i)}static floodFill(e,t,i,s,a,n){const o=e[a*t+s];if(o===n)return e;const c=[...e],h=[[s,a]],f=new Set;for(;h.length>0;){const[g,x]=h.pop(),m=x*t+g;if(!f.has(m)){f.add(m),c[m]=n;const A=[[g+1,x],[g-1,x],[g,x+1],[g,x-1]];for(const[k,b]of A)k>=0&&k<t&&b>=0&&b<i&&c[b*t+k]===o&&h.push([k,b])}}return c}static recolor(e,t,i){return e.map(s=>s===t?i:s)}static getPaletteUsage(e){const t=new Set;return e.forEach(i=>{i&&t.add(i)}),t}}class Ks{stitch(e,t){const i=e!==void 0?Math.floor(e):r.needle.pos.x,s=t!==void 0?Math.floor(t):r.needle.pos.y,a=r.linen.getIndex(i,s),n=r.linen.stitches[a],o=r.paletteState.activeDye;if(n!==o){const c=[...r.linen.stitches];c[a]=o,r.linen.stitches=c,K.push({index:a,oldColor:n,newColor:o}),$.playStitch()}}unstitch(e,t){const i=e!==void 0?Math.floor(e):r.needle.pos.x,s=t!==void 0?Math.floor(t):r.needle.pos.y,a=r.linen.getIndex(i,s),n=r.linen.stitches[a];if(n!==null){const o=[...r.linen.stitches];o[a]=null,r.linen.stitches=o,K.push({index:a,oldColor:n,newColor:null}),$.playUnstitch()}}beginStroke(e,t){r.linen.clearBuffer(),r.linen.addToBuffer(e,t)}continueStroke(e,t,i,s){const a=Ne.getLinePoints(i,s,e,t,0);r.linen.addBatchToBuffer(a)}endStroke(){this.commitBuffer()}cancelStroke(){r.linen.clearBuffer(),$.playUnstitch()}snapCurrentStroke(){const e=r.linen.strokePoints;if(e.length<5)return;const t=r.studio.stabilization,i=Ne.smoothPath(e,t/10),s=Ne.fitArc(i,t);r.linen.clearBuffer();let a=[],n=[];if(s&&s.isFull)n=s.points,a=Ne.getCirclePoints(s.cx,s.cy,s.r);else{const o=Ne.simplifyPath(i,t/100*2);if(o.length===2){let c={...o[0]},h={...o[o.length-1]};const f=Math.abs(h.x-c.x),g=Math.abs(h.y-c.y),x=3;if(f<x)h.x=c.x;else if(g<x)h.y=c.y;else if(Math.abs(f-g)<x){const m=Math.max(f,g);h.x=c.x+m*Math.sign(h.x-c.x),h.y=c.y+m*Math.sign(h.y-c.y)}n=[c,h],a=Ne.getLinePoints(c.x,c.y,h.x,h.y,0)}else if(s){n=s.points;for(let c=0;c<n.length-1;c++)a.push(...Ne.getLinePoints(n[c].x,n[c].y,n[c+1].x,n[c+1].y,t/100))}else{n=o;for(let c=0;c<n.length-1;c++)a.push(...Ne.getLinePoints(n[c].x,n[c].y,n[c+1].x,n[c+1].y,t/100))}}r.linen.addBatchToBuffer(a),r.linen.strokePoints=n,$.playStitch()}commitBuffer(){const e=r.linen.stitchBuffer;if(e.length===0){r.linen.clearBuffer();return}const t=r.paletteState.activeDye,i=[],s=[...r.linen.stitches];e.forEach(a=>{const n=s[a];n!==t&&(i.push({index:a,oldColor:n,newColor:t}),s[a]=t)}),i.length>0&&(r.linen.stitches=s,K.push(i),$.playStitch()),r.linen.clearBuffer()}}class qs{resize(e,t){const i=Array(e*t).fill("#eee8d5");for(let s=0;s<Math.min(r.linen.height,t);s++)for(let a=0;a<Math.min(r.linen.width,e);a++){const n=s*r.linen.width+a,o=s*e+a;i[o]=r.linen.stitches[n]}r.linen.reset(e,t,i),K.clear(),$.playStitch()}flip(e){const{width:t,height:i,stitches:s}=r.linen,a=[...s];if(e==="horizontal")for(let n=0;n<i;n++){const o=s.slice(n*t,(n+1)*t);o.reverse();for(let c=0;c<t;c++)a[n*t+c]=o[c]}else for(let n=0;n<i;n++)for(let o=0;o<t;o++){const c=n*t+o,h=(i-1-n)*t+o;a[h]=s[c]}r.linen.stitches=a,K.clear(),$.playStitch()}rotate(){const{width:e,height:t,stitches:i}=r.linen;if(e!==t)return;const s=Array(e*t).fill("#eee8d5");for(let a=0;a<t;a++)for(let n=0;n<e;n++){const o=a*e+n,c=n*e+(t-1-a);s[c]=i[o]}r.linen.stitches=s,K.clear(),$.playStitch()}clearAll(){confirm("Are you sure you want to unravel the entire project?")&&(r.linen.clear(),K.clear(),$.playUnstitch())}bleach(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t),s=r.activeDye;if(i===s)return;const{stitches:a}=r.linen,n=[],o=r.selection.isActive,c=r.selection.indices;a.forEach((h,f)=>{const g=h===i,x=!o||c.includes(f);g&&x&&(n.push({index:f,oldColor:i,newColor:s}),r.linen.stitches[f]=s)}),n.length>0&&(K.beginBatch(),n.forEach(h=>K.push(h)),K.endBatch(),$.playStitch())}}class Ys{copy(){const e=r.linen.width,t=r.selection.getPoints(e),i=r.selection.getEffectiveBounds(e);if(!i||t.length===0)return;const s=new Array(i.width*i.height).fill(null);t.forEach(a=>{const n=a.y*e+a.x,o=a.x-i.x1,h=(a.y-i.y1)*i.width+o;s[h]=r.linen.stitches[n]}),r.project.clipboard={width:i.width,height:i.height,data:s},$.playStitch()}cut(){this.copy();const e=r.linen.width,t=r.selection.getPoints(e);t.length!==0&&(K.beginBatch(),t.forEach(i=>{const s=i.y*e+i.x,a=r.linen.stitches[s];K.push({index:s,oldColor:a,newColor:null}),r.linen.stitches[s]=null}),K.endBatch(),$.playUnstitch(),r.selection.clear())}paste(){const e=r.project.clipboard;if(!e)return;const{x:t,y:i}=r.needle.pos,{width:s,height:a}=r.linen;K.beginBatch();for(let n=0;n<e.height;n++)for(let o=0;o<e.width;o++){const c=t+o,h=i+n;if(c>=0&&c<s&&h>=0&&h<a){const f=n*e.width+o,g=e.data[f];if(g!==null){const x=h*s+c,m=r.linen.stitches[x];K.push({index:x,oldColor:m,newColor:g}),r.linen.stitches[x]=g}}}K.endBatch(),$.playStitch()}}class Qs{serialize(){return JSON.stringify({version:r.version,metadata:{name:r.project.name,lastModified:new Date().toISOString()},palette:r.paletteState.swatches,folio:{frames:r.project.frames.map(e=>({name:e.name,width:e.width,height:e.height,veils:e.veils.map(t=>({name:t.name,isVisible:t.isVisible,isLocked:t.isLocked,stitches:t.stitches}))}))}})}async save(){const e=this.serialize();if(typeof window.electronAPI>"u"){this.webDownload(e);return}const t=await window.electronAPI.saveFile(e,r.project.currentFilePath||void 0);t&&(r.project.setMetadata(r.project.name,t),$.playStitch())}webDownload(e){const t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=`${r.project.name.toLowerCase().replace(/\s+/g,"-")}.rupa`,s.click()}async load(){if(typeof window.electronAPI>"u"){this.webUpload();return}const e=await window.electronAPI.openFile();e&&(this.deserialize(e.content),r.project.setMetadata(r.project.name,e.filePath),$.playStitch())}webUpload(){const e=document.createElement("input");e.type="file",e.accept=".rupa",e.onchange=t=>{const i=t.target.files?.[0];if(i){const s=new FileReader;s.onload=a=>this.deserialize(a.target?.result),s.readAsText(i)}},e.click()}async backup(){const e=this.serialize();window.electronAPI?(await window.electronAPI.autoSave(e),r.project.lastSaved=new Date):localStorage.setItem("rupa_auto_backup",e)}deserialize(e){try{const t=JSON.parse(e);if(r.paletteState.swatches=t.palette,r.project.name=t.metadata.name,t.folio)r.project.frames=t.folio.frames.map(i=>{const s=new ht(i.name,i.width,i.height);return s.veils=i.veils.map(a=>{const n=new We(a.name,i.width,i.height);return n.isVisible=a.isVisible,n.isLocked=a.isLocked,n.stitches=a.stitches,n}),s});else if(t.pixelData){const i=new ht("Restored Motif",t.dimensions.width,t.dimensions.height);i.veils[0].stitches=t.pixelData,r.project.frames=[i]}r.project.activeFrameIndex=0,K.clear()}catch(t){console.error("Failed to restore pattern book:",t)}}}class Xs{addFrame(e){const t=r.project,i=t.activeFrameIndex,s=t.addFrame(e),a=t.activeFrameIndex;return K.push({isStructural:!0,label:"Add Frame",undo:()=>{t.frames.splice(a,1),t.activeFrameIndex=i},redo:()=>{t.frames.splice(a,0,s),t.activeFrameIndex=a}}),$.playStitch(),s}removeFrame(e){const t=r.project;if(t.frames.length<=1)return;const i=t.frames[e],s=t.activeFrameIndex;t.removeFrame(e);const a=t.activeFrameIndex;K.push({isStructural:!0,label:"Remove Frame",undo:()=>{t.frames.splice(e,0,i),t.activeFrameIndex=s},redo:()=>{t.removeFrame(e),t.activeFrameIndex=a}}),$.playUnstitch()}duplicateFrame(e){const t=r.project,i=t.frames[e],s=t.activeFrameIndex,a=t.addFrame(`${i.name} (Copy)`),n=t.activeFrameIndex;a.width=i.width,a.height=i.height,a.duration=i.duration,a.veils=i.veils.map(o=>o.clone(i.width,i.height)),K.push({isStructural:!0,label:"Duplicate Frame",undo:()=>{t.frames.splice(n,1),t.activeFrameIndex=s},redo:()=>{t.frames.splice(n,0,a),t.activeFrameIndex=n}}),$.playStitch()}nextFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex+1)%e.frames.length,K.push({isStructural:!0,label:"Next Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t+1)%e.frames.length}),$.playMove()}prevFrame(){const e=r.project,t=e.activeFrameIndex;e.activeFrameIndex=(e.activeFrameIndex-1+e.frames.length)%e.frames.length,K.push({isStructural:!0,label:"Prev Frame",undo:()=>e.activeFrameIndex=t,redo:()=>e.activeFrameIndex=(t-1+e.frames.length)%e.frames.length}),$.playMove()}addVeil(e){const t=r.project.activeFrame,i=t.activeVeilIndex,s=t.addVeil(e),a=t.activeVeilIndex;return K.push({isStructural:!0,label:"Add Veil",undo:()=>{t.veils.splice(a,1),t.activeVeilIndex=i},redo:()=>{t.veils.splice(a,0,s),t.activeVeilIndex=a}}),$.playStitch(),s}removeVeil(e){const t=r.project.activeFrame;if(t.veils.length<=1)return;const i=t.veils[e],s=t.activeVeilIndex;t.removeVeil(e);const a=t.activeVeilIndex;K.push({isStructural:!0,label:"Remove Veil",undo:()=>{t.veils.splice(e,0,i),t.activeVeilIndex=s},redo:()=>{t.removeVeil(e),t.activeVeilIndex=a}}),$.playUnstitch()}duplicateVeil(e){const t=r.project.activeFrame,i=t.veils[e],s=t.activeVeilIndex,a=i.clone(t.width,t.height);a.name=`${i.name} (Copy)`;const n=e+1;t.veils.splice(n,0,a),t.activeVeilIndex=n,K.push({isStructural:!0,label:"Duplicate Veil",undo:()=>{t.veils.splice(n,1),t.activeVeilIndex=s},redo:()=>{t.veils.splice(n,0,a),t.activeVeilIndex=n}}),$.playStitch()}nextVeil(){const e=r.project.activeFrame,t=e.activeVeilIndex;e.activeVeilIndex=(e.activeVeilIndex+1)%e.veils.length,K.push({isStructural:!0,label:"Next Veil",undo:()=>e.activeVeilIndex=t,redo:()=>e.activeVeilIndex=(t+1)%e.veils.length}),$.playMove()}prevVeil(){const e=r.project.activeFrame,t=e.activeVeilIndex;e.activeVeilIndex=(e.activeVeilIndex-1+e.veils.length)%e.veils.length,K.push({isStructural:!0,label:"Prev Veil",undo:()=>e.activeVeilIndex=t,redo:()=>e.activeVeilIndex=(t-1+e.veils.length)%e.veils.length}),$.playMove()}toggleLock(e){const t=e!==void 0?r.project.activeFrame.veils[e]:r.project.activeFrame.activeVeil;if(t){const i=t.isLocked;t.isLocked=!t.isLocked,K.push({isStructural:!0,label:"Toggle Veil Lock",undo:()=>t.isLocked=i,redo:()=>t.isLocked=!i}),$.playStitch()}}toggleVisibility(e){const t=e!==void 0?r.project.activeFrame.veils[e]:r.project.activeFrame.activeVeil;if(t){const i=t.isVisible;t.isVisible=!t.isVisible,K.push({isStructural:!0,label:"Toggle Veil Visibility",undo:()=>t.isVisible=i,redo:()=>t.isVisible=!i}),$.playStitch()}}reorderVeil(e,t){const i=r.project.activeFrame;if(e===t||t<0||t>=i.veils.length)return;const s=i.activeVeilIndex;((o,c)=>{const[h]=i.veils.splice(o,1);i.veils.splice(c,0,h),i.activeVeilIndex===o?i.activeVeilIndex=c:o<i.activeVeilIndex&&c>=i.activeVeilIndex?i.activeVeilIndex--:o>i.activeVeilIndex&&c<=i.activeVeilIndex&&i.activeVeilIndex++})(e,t);const n=i.activeVeilIndex;K.push({isStructural:!0,label:"Reorder Veil",undo:()=>{i.veils.findIndex((c,h)=>h===t);const[o]=i.veils.splice(t,1);i.veils.splice(e,0,o),i.activeVeilIndex=s},redo:()=>{const[o]=i.veils.splice(e,1);i.veils.splice(t,0,o),i.activeVeilIndex=n}}),$.playMove()}reorderFrame(e,t){const i=r.project;if(e===t||t<0||t>=i.frames.length)return;const s=i.activeFrameIndex;((o,c)=>{const[h]=i.frames.splice(o,1);i.frames.splice(c,0,h),i.activeFrameIndex===o?i.activeFrameIndex=c:o<i.activeFrameIndex&&c>=i.activeFrameIndex?i.activeFrameIndex--:o>i.activeFrameIndex&&c<=i.activeFrameIndex&&i.activeFrameIndex++})(e,t);const n=i.activeFrameIndex;K.push({isStructural:!0,label:"Reorder Frame",undo:()=>{const[o]=i.frames.splice(t,1);i.frames.splice(e,0,o),i.activeFrameIndex=s},redo:()=>{const[o]=i.frames.splice(e,1);i.frames.splice(t,0,o),i.activeFrameIndex=n}}),$.playMove()}moveVeilUp(){const e=r.project.activeFrame,t=e.activeVeilIndex;t<e.veils.length-1&&this.reorderVeil(t,t+1)}moveVeilDown(){const t=r.project.activeFrame.activeVeilIndex;t>0&&this.reorderVeil(t,t-1)}}class Zs{begin(e,t){r.selection.begin(e,t)}update(e,t){r.selection.isActive&&r.selection.update(e,t)}clear(){r.selection.clear()}commit(){const e=r.selection.getPoints(r.linen.width);if(e.length===0)return;const t=r.paletteState.activeDye,i=r.linen.width;K.beginBatch();let s=!1;e.forEach(a=>{const n=a.y*i+a.x,o=r.linen.stitches[n];o!==t&&(K.push({index:n,oldColor:o,newColor:t}),r.linen.stitches[n]=t,s=!0)}),K.endBatch(),s&&$.playStitch()}spiritPick(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t),s=r.linen.width,a=r.linen.height,n=[[e,t]],o=new Set;for(r.selection.clear();n.length>0;){const[c,h]=n.shift(),f=h*s+c,g=`${c},${h}`;if(!o.has(g)&&(o.add(g),r.linen.getColor(c,h)===i)){r.selection.indices.push(f);const x=[[c+1,h],[c-1,h],[c,h+1],[c,h-1]];for(const[m,A]of x)m>=0&&m<s&&A>=0&&A<a&&n.push([m,A])}}r.selection.indices.length>0&&$.playScale(4)}addVertex(e,t){r.selection.vertices.push({x:e,y:t}),$.playStitch()}sealBinding(){const e=r.selection.vertices;if(e.length<3)return;const t=r.linen.width,i=r.linen.height,s=[];for(let a=0;a<i;a++)for(let n=0;n<t;n++)this.isPointInPoly(n,a,e)&&s.push(a*t+n);s.length>0&&(r.selection.indices=s,r.selection.vertices=[],$.playScale(6))}isPointInPoly(e,t,i){let s=!1;for(let a=0,n=i.length-1;a<i.length;n=a++){const o=i[a].x,c=i[a].y,h=i[n].x,f=i[n].y;c>t!=f>t&&e<(h-o)*(t-c)/(f-c)+o&&(s=!s)}return s}}class vt{static spin(e){const{h:t,s:i,l:s,a}=e,n=t/360,o=i/100,c=s/100;let h,f,g;if(o===0)h=f=g=c;else{const k=c<.5?c*(1+o):c+o-c*o,b=2*c-k,y=S=>(S<0&&(S+=1),S>1&&(S-=1),S<1/6?b+(k-b)*6*S:S<1/2?k:S<2/3?b+(k-b)*(2/3-S)*6:b);h=y(n+1/3),f=y(n),g=y(n-1/3)}const x=k=>Math.round(k*255).toString(16).padStart(2,"0"),m=Math.round(a*255).toString(16).padStart(2,"0"),A=`#${x(h)}${x(f)}${x(g)}`;return m==="ff"?A:A+m}static unravel(e){let t=0,i=0,s=0,a=1;const n=e.replace("#","");n.length===3||n.length===4?(t=parseInt(n[0]+n[0],16),i=parseInt(n[1]+n[1],16),s=parseInt(n[2]+n[2],16),n.length===4&&(a=parseInt(n[3]+n[3],16)/255)):(n.length===6||n.length===8)&&(t=parseInt(n.substring(0,2),16),i=parseInt(n.substring(2,4),16),s=parseInt(n.substring(4,6),16),n.length===8&&(a=parseInt(n.substring(6,8),16)/255)),t/=255,i/=255,s/=255;const o=Math.max(t,i,s),c=Math.min(t,i,s);let h=0,f=0,g=(o+c)/2;if(o!==c){const x=o-c;switch(f=g>.5?x/(2-o-c):x/(o+c),o){case t:h=(i-s)/x+(i<s?6:0);break;case i:h=(s-t)/x+2;break;case s:h=(t-i)/x+4;break}h/=6}return{h:Math.round(h*360),s:Math.round(f*100),l:Math.round(g*100),a:parseFloat(a.toFixed(2))}}static weather(e,t){const i=this.unravel(e);return i.l=Math.max(0,Math.min(100,i.l+t*100)),this.spin(i)}static pigment(e,t){const i=this.unravel(e);return i.s=Math.max(0,Math.min(100,i.s+t*100)),this.spin(i)}static strength(e,t){const i=this.unravel(e);return i.a=Math.max(0,Math.min(1,t)),this.spin(i)}static entwine(e,t,i=.5){this.unravel(e),this.unravel(t);const s=this.hexToRgb(e),a=this.hexToRgb(t),n={r:Math.round(s.r*(1-i)+a.r*i),g:Math.round(s.g*(1-i)+a.g*i),b:Math.round(s.b*(1-i)+a.b*i),a:s.a*(1-i)+a.a*i};return this.rgbToHex(n.r,n.g,n.b,n.a)}static hexToRgb(e){this.unravel(e);const t=e.replace("#","");let i=0,s=0,a=0,n=1;return(t.length===6||t.length===8)&&(i=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),a=parseInt(t.substring(4,6),16),t.length===8&&(n=parseInt(t.substring(6,8),16)/255)),{r:i,g:s,b:a,a:n}}static rgbToHex(e,t,i,s){const a=c=>Math.round(c).toString(16).padStart(2,"0"),n=Math.round(s*255).toString(16).padStart(2,"0"),o=`#${a(e)}${a(t)}${a(i)}`;return n==="ff"?o:o+n}}class Ws{select(e){r.paletteState.select(e),$.playScale(e)}setDye(e){r.paletteState.setDye(e),$.playStitch()}pickFromLinen(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t);i!==null&&(this.setDye(i),r.studio.isPicking=!0,setTimeout(()=>{r.studio.isPicking=!1},1500))}weatherPalette(e){r.paletteState.swatches=r.paletteState.swatches.map(t=>vt.weather(t,e)),$.playStitch()}mixActiveDye(e,t=.5){const i=vt.entwine(r.activeDye,e,t);this.setDye(i)}soak(){const{x:e,y:t}=r.needle.pos,i=r.linen.getColor(e,t),s=r.activeDye;if(i===s)return;const a=r.linen.width,n=r.linen.height,o=[[e,t]],c=new Set,h=[],f=r.selection.isActive,g=r.selection.indices;for(;o.length>0;){const[x,m]=o.shift(),A=m*a+x,k=`${x},${m}`;if(c.has(k))continue;c.add(k);const b=r.linen.getColor(x,m)===i,y=!f||g.includes(A);if(b&&y){h.push({index:A,oldColor:i,newColor:s}),r.linen.stitches[A]=s;const S=[[x+1,m],[x-1,m],[x,m+1],[x,m-1]];for(const[M,I]of S)M>=0&&M<a&&I>=0&&I<n&&o.push([M,I])}}h.length>0&&(K.beginBatch(),h.forEach(x=>K.push(x)),K.endBatch(),$.playStitch())}}class Js{movement=new zs;stitching=new Ks;manipulation=new qs;clipboard=new Ys;persistence=new Qs;folio=new Xs;selection=new Zs;dye=new Ws;moveNeedle(e,t){return this.movement.move(e,t)}jumpTo(e,t){this.movement.jumpTo(e,t)}jumpHome(){this.movement.jumpHome()}stitch(){this.stitching.stitch()}unstitch(){this.stitching.unstitch()}pickDye(){this.dye.pickFromLinen()}startSelection(){this.selection.begin(r.needle.pos.x,r.needle.pos.y)}updateSelection(){this.selection.update(r.needle.pos.x,r.needle.pos.y)}commitSelection(){this.selection.commit()}clearLinen(){this.manipulation.clearAll()}resizeLinen(e,t){this.manipulation.resize(e,t)}flipLinen(e){this.manipulation.flip(e)}rotateLinen(){this.manipulation.rotate()}copy(){this.clipboard.copy()}cut(){this.clipboard.cut()}paste(){this.clipboard.paste(),r.selection.clear()}save(){this.persistence.save()}load(){this.persistence.load()}backup(){this.persistence.backup()}async createArtifact(e,t=10,i="transparent"){const{ExportEngine:s}=await jt(async()=>{const{ExportEngine:f}=await import("../chunks/-29G2bDl.js");return{ExportEngine:f}},[],import.meta.url),{width:a,height:n,compositeStitches:o}=r.linen,c=["webm","gif","mp4"].includes(e),h=r.project.frames.length<=1&&c?"png":e;if(h==="svg")if(r.project.frames.length>1){const f=r.project.frames.map(m=>m.compositeStitches),g=s.toAnimatedSVG(a,n,f,r.studio.fps,i),x=new Blob([g],{type:"image/svg+xml"});this.download(URL.createObjectURL(x),`${r.project.name}-kinetic.svg`)}else{const f=s.toSVG(a,n,o,i),g=new Blob([f],{type:"image/svg+xml"});this.download(URL.createObjectURL(g),`${r.project.name}.svg`)}else if(h==="webm"||h==="mp4"){const f=r.project.frames.map(x=>x.compositeStitches),g=await s.toWebM(a,n,f,t,r.studio.fps,i);this.download(URL.createObjectURL(g),`${r.project.name}.${h}`)}else if(h==="gif"){const f=await s.toRaster(a,n,o,t,"png",i);this.download(f,`${r.project.name}.gif`)}else{const f=await s.toRaster(a,n,o,t,h,i);this.download(f,`${r.project.name}.${h}`)}r.studio.showArtifactCrate=!1}download(e,t){const i=document.createElement("a");i.href=e,i.download=t.toLowerCase().replace(/\s+/g,"-"),i.click()}}const F=new Js;class ea{version="0.6.0";project=new Ds;linen=new Ls(this.project);needle=new Ms;paletteState=new Bs;studio=new js;selection=new Os;get stitches(){return this.linen.stitches}set stitches(e){this.linen.stitches=e}get linenWidth(){return this.linen.width}set linenWidth(e){this.linen.width=e}get linenHeight(){return this.linen.height}set linenHeight(e){this.linen.height=e}get needlePos(){return this.needle.pos}set needlePos(e){this.needle.pos=e}get activeDye(){return this.paletteState.activeDye}set activeDye(e){this.paletteState.activeDye=e}get palette(){return this.paletteState.swatches}set palette(e){this.paletteState.swatches=e}get zoomLevel(){return this.studio.zoomLevel}set zoomLevel(e){this.studio.zoomLevel=e}get isMuted(){return this.studio.isMuted}set isMuted(e){this.studio.isMuted=e}get isAmbientPlaying(){return this.studio.isAmbientPlaying}set isAmbientPlaying(e){this.studio.isAmbientPlaying=e}get isKineticMode(){return this.studio.isKineticMode}set isKineticMode(e){this.studio.isKineticMode=e}get showGhostThreads(){return this.studio.showGhostThreads}set showGhostThreads(e){this.studio.showGhostThreads=e}get bgmVolume(){return this.studio.bgmVolume}set bgmVolume(e){this.studio.bgmVolume=e}get sfxVolume(){return this.studio.sfxVolume}set sfxVolume(e){this.studio.sfxVolume=e}get usageMinutes(){return this.studio.usageMinutes}constructor(){setInterval(()=>{const e=Date.now()-this.studio.sessionStartTime;this.studio.usageMinutes=Math.floor(e/6e4),this.studio.usageSeconds=Math.floor(e/1e3)},1e3)}get isPicking(){return this.studio.isPicking}set isPicking(e){this.studio.isPicking=e}get isAppReady(){return this.studio.isAppReady}set isAppReady(e){this.studio.isAppReady=e}get isNeedleVisible(){return this.needle.isVisible}set isNeedleVisible(e){this.needle.isVisible=e}get projectName(){return this.project.name}set projectName(e){this.project.name=e}get currentFilePath(){return this.project.currentFilePath}set currentFilePath(e){this.project.currentFilePath=e}get lastSaved(){return this.project.lastSaved}set lastSaved(e){this.project.lastSaved=e}get clipboard(){return this.project.clipboard}set clipboard(e){this.project.clipboard=e}get showDyeBasin(){return this.studio.showDyeBasin}set showDyeBasin(e){this.studio.showDyeBasin=e}get showAudioBasin(){return this.studio.showAudioBasin}set showAudioBasin(e){this.studio.showAudioBasin=e}get showPatternCatalog(){return this.studio.showPatternCatalog}set showPatternCatalog(e){this.studio.showPatternCatalog=e}get showArtisanGuide(){return this.studio.showArtisanGuide}set showArtisanGuide(e){this.studio.showArtisanGuide=e}get showArtisanCodex(){return this.studio.showArtisanCodex}set showArtisanCodex(e){this.studio.showArtisanCodex=e}get showArtifactCrate(){return this.studio.showArtifactCrate}set showArtifactCrate(e){this.studio.showArtifactCrate=e}get showLinenSettings(){return this.studio.showLinenSettings}set showLinenSettings(e){this.studio.showLinenSettings=e}get showArchivePattern(){return this.studio.showArchivePattern}set showArchivePattern(e){this.studio.showArchivePattern=e}get showGoTo(){return this.studio.showGoTo}set showGoTo(e){this.studio.showGoTo=e}get exportScale(){return this.studio.exportScale}set exportScale(e){this.studio.exportScale=e}get exportBgColor(){return this.studio.exportBgColor}set exportBgColor(e){this.studio.exportBgColor=e}get selectionStart(){return this.selection.start}set selectionStart(e){this.selection.start=e}get selectionEnd(){return this.selection.end}set selectionEnd(e){this.selection.end=e}#e=X(()=>{const e=new Set;return this.linen.compositeStitches.forEach(t=>{t!==null&&e.add(t)}),Array.from(e)});get usedColors(){return d(this.#e)}set usedColors(e){_(this.#e,e)}#t=X(()=>{const e=(t,i)=>{const s=Math.floor(i/2);return i%2===0?t<s?t-s:t-s+1:t-s};return{x:e(this.needle.pos.x,this.linen.width),y:-e(this.needle.pos.y,this.linen.height)}});get displayCoords(){return d(this.#t)}set displayCoords(e){_(this.#t,e)}#i=X(()=>{const e=this.studio.zoomLevel*.5;if(this.studio.zoomLevel<=1)return`translate(-50%, -50%) scale(${e})`;const t=(this.needle.pos.x+.5)/this.linen.width*100,i=(this.needle.pos.y+.5)/this.linen.height*100;return`translate(-${t}%, -${i}%) scale(${e})`});get cameraTransform(){return d(this.#i)}set cameraTransform(e){_(this.#i,e)}resetInactivityTimer(){this.needle.resetInactivityTimer()}toggleMute(){this.studio.toggleMute()}setZoom(e){this.studio.setZoom(e)}resetZoom(){this.studio.resetZoom()}selectPalette(e){this.paletteState.select(e)}pushEscapeAction(e){this.studio.pushEscapeAction(e)}popEscapeAction(e){this.studio.popEscapeAction(e)}handleEscape(){return this.studio.handleEscape()}undo(){const e=K.undo();if(e)if("isStructural"in e)e.undo(),$.playUnstitch();else if(Array.isArray(e)){for(let t=e.length-1;t>=0;t--){const i=e[t];this.linen.stitches[i.index]=i.oldColor}$.playUnstitch()}else this.linen.stitches[e.index]=e.oldColor,$.playUnstitch();this.needle.resetInactivityTimer()}redo(){const e=K.redo();if(e)if("isStructural"in e)e.redo(),$.playStitch();else if(Array.isArray(e)){for(const t of e)this.linen.stitches[t.index]=t.newColor;$.playStitch()}else this.linen.stitches[e.index]=e.newColor,$.playStitch();this.needle.resetInactivityTimer()}clearLinen(){F.clearLinen()}pickDye(){F.pickDye()}loadProject(){F.load()}copySelection(){F.copy()}cutSelection(){F.cut()}pasteSelection(){F.paste()}flipLinen(e){F.flipLinen(e)}rotateLinen(){F.rotateLinen()}}const r=new ea,ta={MOVE_UP:{label:"Step the Needle Up",keys:["ArrowUp"],group:"The Needle"},MOVE_DOWN:{label:"Step the Needle Down",keys:["ArrowDown"],group:"The Needle"},MOVE_LEFT:{label:"Step the Needle Left",keys:["ArrowLeft"],group:"The Needle"},MOVE_RIGHT:{label:"Step the Needle Right",keys:["ArrowRight"],group:"The Needle"},GOTO:{label:"Jump to Coordinate",keys:["g"],group:"The Needle"},JUMP_HOME:{label:"Return to Center",keys:["Ctrl+h"],group:"The Needle"}},ia={STITCH:{label:"Stitch (Apply Active Dye)",keys:["Space","Enter"],group:"The Hand"},UNSTITCH:{label:"Clear Fiber (Unstitch)",keys:["Backspace","Delete"],group:"The Hand"},PICK_DYE:{label:"Sample Fiber (Eyedropper)",keys:["i","Alt+Space"],group:"The Hand"},SOAK:{label:"Dye Soak (Flood Fill)",keys:["f"],group:"Artisan Magic"},BLEACH:{label:"Fiber Bleach (Recolor All)",keys:["Alt+r"],group:"Artisan Magic"},SPIRIT_PICK:{label:"Spirit Pick (Magic Selection)",keys:["w"],group:"Artisan Magic"}},sa={FLOW_STITCH:{label:"Continuous Threading",keys:["Ctrl"],group:"Continuous Weaving"},FLOW_UNSTITCH:{label:"Continuous Unravelling",keys:["Ctrl+Shift"],group:"Continuous Weaving"},FLOW_SELECT:{label:"Define Selection (Loom)",keys:["Shift"],group:"Continuous Weaving"}},aa={COPY:{label:"Capture to Swatch (Copy)",keys:["Ctrl+c"],group:"The Loom"},CUT:{label:"Snip to Swatch (Cut)",keys:["Ctrl+x"],group:"The Loom"},PASTE:{label:"Weave from Clipboard (Paste)",keys:["Ctrl+v"],group:"The Loom"},CLEAR_LINEN:{label:"Strip the Linen (Clear All)",keys:["Ctrl+l"],group:"The Loom"}},ra={FLIP_H:{label:"Flip Horizontally",keys:["h"],group:"Dimensions & Forms"},FLIP_V:{label:"Flip Vertically",keys:["v"],group:"Dimensions & Forms"},ROTATE:{label:"Rotate 90Â° Clockwise",keys:["r"],group:"Dimensions & Forms"},ZOOM_IN:{label:"Loom Zoom In",keys:["+","="],group:"Dimensions & Forms"},ZOOM_OUT:{label:"Loom Zoom Out",keys:["-"],group:"Dimensions & Forms"},RESET_ZOOM:{label:"Reset Loom Zoom",keys:["Ctrl+0"],group:"Dimensions & Forms"}},na={NEW_FRAME:{label:"New Time Thread (Frame)",keys:["Alt+n"],group:"The Spindle"},DUPLICATE_FRAME:{label:"Clone Current Thread",keys:["Ctrl+d"],group:"The Spindle"},DELETE_FRAME:{label:"Dissolve Thread",keys:["Alt+d"],group:"The Spindle"},NEXT_FRAME:{label:"Next Page (Frame)",keys:["Alt+PageDown","Tab"],group:"The Spindle"},PREV_FRAME:{label:"Previous Page (Frame)",keys:["Alt+PageUp","Shift+Tab"],group:"The Spindle"},PLAY_PULSE:{label:"Toggle Playback",keys:["p"],group:"The Spindle"},TOGGLE_GHOST_THREADS:{label:"See Ghost Threads (Onion Skin)",keys:["Alt+g"],group:"The Spindle"}},oa={NEW_VEIL:{label:"Add New Veil (Layer)",keys:["Alt+Shift+n"],group:"The Veils"},DUPLICATE_VEIL:{label:"Clone Active Veil",keys:["Ctrl+d"],group:"The Veils"},DELETE_VEIL:{label:"Remove Active Veil",keys:["Alt+d"],group:"The Veils"},MOVE_VEIL_UP:{label:"Lift Veil Up",keys:["["],group:"The Veils"},MOVE_VEIL_DOWN:{label:"Lower Veil Down",keys:["]"],group:"The Veils"},TOGGLE_VEIL_VISIBILITY:{label:"Reveal/Hide Veil",keys:["Alt+h"],group:"The Veils"},TOGGLE_VEIL_LOCK:{label:"Seal/Unseal Veil",keys:["Alt+l"],group:"The Veils"}},la={OPEN_PALETTE:{label:"Consult the Pattern Catalog",keys:["Ctrl+k"],group:"The Pattern Book"},OPEN_EXPORT:{label:"Open the Artifact Crate",keys:["Ctrl+e"],group:"The Pattern Book"},OPEN_ARCHIVE:{label:"Archive Pattern (Save)",keys:["Ctrl+s"],group:"The Pattern Book"},OPEN_SETTINGS:{label:"Studio Settings",keys:["Ctrl+,"],group:"The Pattern Book"},OPEN_CODEX:{label:"Open Artisan Codex",keys:["F1"],group:"The Pattern Book"},OPEN_DYES:{label:"Open Natural Dye Basin",keys:["b"],group:"The Pattern Book"},OPEN_HELP:{label:"Quick Guide",keys:["F2"],group:"The Pattern Book"},OPEN_AUDIO:{label:"Open Audio Basin",keys:["Ctrl+Shift+a"],group:"Atmosphere & Tuning"},TOGGLE_MUTE:{label:"Silence the Studio",keys:["Ctrl+m"],group:"Atmosphere & Tuning"},UNDO:{label:"Rewind Last Stitch",keys:["Ctrl+z"],group:"Atmosphere & Tuning"},REDO:{label:"Fast-Forward last Stitch",keys:["Ctrl+Shift+z","Ctrl+y"],group:"Atmosphere & Tuning"},ESCAPE:{label:"Clear Focus / Dismiss Overlays",keys:["Escape"],group:"Basic Rhythms"}},ca={SELECT_DYE_1:{label:"Select Dye 1",keys:["1"],group:"The Hand"},SELECT_DYE_2:{label:"Select Dye 2",keys:["2"],group:"The Hand"},SELECT_DYE_3:{label:"Select Dye 3",keys:["3"],group:"The Hand"},SELECT_DYE_4:{label:"Select Dye 4",keys:["4"],group:"The Hand"},SELECT_DYE_5:{label:"Select Dye 5",keys:["5"],group:"The Hand"},SELECT_DYE_6:{label:"Select Dye 6",keys:["6"],group:"The Hand"},SELECT_DYE_7:{label:"Select Dye 7",keys:["7"],group:"The Hand"},SELECT_DYE_8:{label:"Select Dye 8",keys:["8"],group:"The Hand"},SELECT_DYE_9:{label:"Select Dye 9",keys:["9"],group:"The Hand"},SELECT_DYE_0:{label:"Select Dye 0",keys:["0"],group:"The Hand"}},da={TAB_FRAMES:{label:"Focus Spindle Tab",keys:["Alt+1"],group:"The Spindle"},TAB_VEILS:{label:"Focus Veils Tab",keys:["Alt+2"],group:"The Veils"}},ua={navigation:ta,stitching:ia,flows:sa,manipulation:aa,transform:ra,kinetic:na,layering:oa,studio:la,palette:ca,tabs:da};class ha{buffer=[];timeout=null;#e=P(pe([]));get currentSequence(){return d(this.#e)}set currentSequence(e){_(this.#e,e,!0)}process(e){const t=e.toLowerCase();this.buffer.push(t),this.currentSequence=[...this.buffer],this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.reset(),1e3);const i=this.buffer.join(","),s={"g,c":"GOTO","f,n":"NEW_FRAME","v,n":"NEW_VEIL","v,l":"TOGGLE_VEIL_LOCK","v,h":"TOGGLE_VEIL_VISIBILITY","v,m":"MERGE_VEILS"};if(s[i]){const a=s[i];return this.reset(),a}return null}reset(){this.buffer=[],this.currentSequence=[],this.timeout&&clearTimeout(this.timeout)}get isActive(){return this.currentSequence.length>0}}const Vt=new ha;class va{patterns=[];#e=P(pe([]));get activeKeys(){return d(this.#e)}set activeKeys(e){_(this.#e,e,!0)}#t=P(!1);get isCtrlActive(){return d(this.#t)}set isCtrlActive(e){_(this.#t,e,!0)}#i=P(!1);get isShiftActive(){return d(this.#i)}set isShiftActive(e){_(this.#i,e,!0)}#s=P(!1);get isAltActive(){return d(this.#s)}set isAltActive(e){_(this.#s,e,!0)}constructor(){this.loadPatterns()}loadPatterns(){this.patterns=[],Object.values(ua).forEach(e=>{Object.entries(e).forEach(([t,i])=>{const{keys:s,group:a}=i,n=__({key:`shortcuts.labels.${t}`}),o=a.toLowerCase().replace(/ & /g,"_").replace(/ /g,"_"),c=__({key:`shortcuts.groups.${o}`});s.forEach(h=>{const f=h.toLowerCase().split("+");let g=f[f.length-1].trim();g==="space"&&(g=" "),(g==="ctrl"||g==="control")&&(g="control"),this.patterns.push({intent:t,key:g,ctrl:f.includes("ctrl")||f.includes("control"),shift:f.includes("shift"),alt:f.includes("alt"),label:n,group:c})})})}),this.patterns.sort((e,t)=>{const i=s=>(s.ctrl?1:0)+(s.shift?1:0)+(s.alt?1:0);return i(t)-i(e)})}getActions(){const e=new Set,t=[];return this.patterns.forEach(i=>{e.has(i.intent)||(e.add(i.intent),t.push({intent:i.intent,label:i.label,group:i.group,shortcut:this.getLabel(i.intent)}))}),t}getGroupedActions(){const e=this.getActions(),t={},i={MOVE_UP:"Arrows",MOVE_DOWN:"Arrows",MOVE_LEFT:"Arrows",MOVE_RIGHT:"Arrows",SELECT_DYE_1:"1-0",SELECT_DYE_2:"1-0",SELECT_DYE_3:"1-0",SELECT_DYE_4:"1-0",SELECT_DYE_5:"1-0",SELECT_DYE_6:"1-0",SELECT_DYE_7:"1-0",SELECT_DYE_8:"1-0",SELECT_DYE_9:"1-0",SELECT_DYE_0:"1-0"},s=[],a=new Set;return e.forEach(o=>{const c=i[o.intent];if(c){if(!a.has(c)){a.add(c);const h=c.toLowerCase(),f=__({key:`shortcuts.groups.${h}`});s.push({...o,label:f,customKey:c})}}else s.push(o)}),s.forEach(o=>{t[o.group]||(t[o.group]=[]),t[o.group].push(o)}),[__({key:"shortcuts.groups.basic_rhythms"}),__({key:"shortcuts.groups.the_needle"}),__({key:"shortcuts.groups.the_hand"}),__({key:"shortcuts.groups.continuous_weaving"}),__({key:"shortcuts.groups.artisan_magic"}),__({key:"shortcuts.groups.the_loom"}),__({key:"shortcuts.groups.dimensions_forms"}),__({key:"shortcuts.groups.the_spindle"}),__({key:"shortcuts.groups.the_veils"}),__({key:"shortcuts.groups.the_pattern_book"}),__({key:"shortcuts.groups.atmosphere_tuning"})].filter(o=>t[o]).map(o=>({group:o,items:t[o]}))}updatePhysicalState(e,t){const i=e.key.toLowerCase();t==="down"?this.activeKeys.includes(i)||this.activeKeys.push(i):(this.activeKeys=this.activeKeys.filter(s=>s!==i),i==="alt"&&!e.altKey&&(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))),this.isCtrlActive=e.ctrlKey||e.metaKey,this.isShiftActive=e.shiftKey,this.isAltActive=e.altKey,this.isCtrlActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="control"&&s!=="meta")),this.isShiftActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="shift")),this.isAltActive||(this.activeKeys=this.activeKeys.filter(s=>s!=="alt"))}getIntent(e){const t=e.key.toLowerCase();if(!this.isCtrlActive&&!this.isAltActive&&!this.isShiftActive){const i=Vt.process(t);if(i)return i}else Vt.reset();if(["arrowup","arrowdown","arrowleft","arrowright"].includes(t)){if(t==="arrowup")return"MOVE_UP";if(t==="arrowdown")return"MOVE_DOWN";if(t==="arrowleft")return"MOVE_LEFT";if(t==="arrowright")return"MOVE_RIGHT"}for(const i of this.patterns)if(t===i.key&&this.isCtrlActive===i.ctrl&&this.isShiftActive===i.shift&&this.isAltActive===i.alt)return i.intent;return null}getLabel(e){const t=this.patterns.find(c=>c.intent===e);if(!t)return"Unassigned";const i=[];t.ctrl&&i.push("Ctrl"),t.shift&&i.push("Shift"),t.alt&&i.push("Alt");let s=t.key;const a={" ":"Space",control:"Ctrl",meta:"Cmd",alt:"Alt",shift:"Shift",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right",backspace:"Backspace",delete:"Delete",enter:"Enter",escape:"Esc",tab:"Tab"},n=s.toLowerCase();a[n]?s=a[n]:s=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();const o=i.filter(c=>c.toLowerCase()!==s.toLowerCase());return o.length===0?s:o.join("+")+"+"+s}}const Te=new va;class pa{#e=X(()=>Vt.isActive?{type:"ORGANIZING",label:"Weaving...",icon:"ð",color:"var(--color-brand)",isPulse:!0}:r.isPicking?{type:"PICKING",label:"Picking Dye",icon:"ð",color:"var(--color-brand)",isPulse:!0}:Te.isCtrlActive&&Te.isShiftActive?{type:"UNRAVELLING",label:"Unravelling",icon:"ð§¶",color:"var(--color-brand)",isPulse:!0}:Te.isShiftActive?{type:"LOOMING",label:"Block Looming",icon:"â¨",color:"var(--color-brand)",isPulse:!0}:Te.isCtrlActive?{type:"THREADING",label:"Threading",icon:"ð§µ",color:"var(--color-studio-teal)",isPulse:!0}:{type:"RESTING",label:"Studio Ready",icon:"",color:"var(--color-studio-text)",isPulse:!1});get current(){return d(this.#e)}set current(e){_(this.#e,e)}}const fe=new pa;class fi{isPointerDown=!1;lastPosition={x:-1,y:-1};buttonType=null;holdTimer=null;isSnapped=!1;rafId=null;#e=P(!1);get isSnappedState(){return d(this.#e)}set isSnappedState(e){_(this.#e,e,!0)}mapToGrid(e,t,i){const s=i.getBoundingClientRect(),{width:a,height:n}=r.linen,o=(e-s.left)/s.width,c=(t-s.top)/s.height;return{x:o*a,y:c*n}}handleStart(e,t){this.isPointerDown=!0,this.isSnapped=!1,this.buttonType=e.button===2?"secondary":"primary";const i=this.mapToGrid(e.clientX,e.clientY,t);this.lastPosition={x:i.x,y:i.y},r.needle.pos={x:Math.floor(i.x),y:Math.floor(i.y)};const s=fe.current.type;this.buttonType==="primary"&&s!=="LOOMING"&&s!=="UNRAVELLING"&&(F.stitching.beginStroke(i.x,i.y),this.startHoldTimer())}handleMove(e,t){this.isPointerDown&&(this.rafId||(this.rafId=requestAnimationFrame(()=>{const i=this.mapToGrid(e.clientX,e.clientY,t),s=fe.current.type;this.buttonType==="primary"&&s!=="LOOMING"&&s!=="UNRAVELLING"&&(this.isSnapped||(F.stitching.continueStroke(i.x,i.y,this.lastPosition.x,this.lastPosition.y),this.resetHoldTimer())),this.lastPosition={x:i.x,y:i.y},this.rafId=null})))}handleEnd(){if(!this.isPointerDown)return;this.isPointerDown=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);const e=fe.current.type;this.buttonType==="primary"&&e!=="LOOMING"&&e!=="UNRAVELLING"?F.stitching.endStroke():r.linen.clearBuffer(),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1}cancel(){this.isPointerDown=!1,this.clearHoldTimer(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.buttonType=null,this.lastPosition={x:-1,y:-1},this.isSnapped=!1,this.isSnappedState=!1,F.stitching.cancelStroke()}startHoldTimer(){this.clearHoldTimer(),this.holdTimer=setTimeout(()=>{this.isPointerDown&&this.triggerSnap()},600)}resetHoldTimer(){this.isSnapped||this.startHoldTimer()}clearHoldTimer(){this.holdTimer&&clearTimeout(this.holdTimer),this.holdTimer=null}triggerSnap(){this.isSnapped=!0,this.isSnappedState=!0,F.stitching.snapCurrentStroke()}}const $e=new fi,fa=Object.freeze(Object.defineProperty({__proto__:null,ShuttlePointEngine:fi,shuttlepoint:$e},Symbol.toStringTag,{value:"Module"}));class ga{#e=P("KEYBOARD");get activeSource(){return d(this.#e)}set activeSource(e){_(this.#e,e,!0)}listeners=[];constructor(){}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}emit(e,t,i){this.activeSource=t;const s={intent:e,source:t,meta:i};this.listeners.forEach(a=>a(s))}mount(e,t){const i=s=>{if(!r.studio.isAppReady)return;const a=s.target;if(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a.isContentEditable)return;Te.updatePhysicalState(s,"down");const n=Te.getIntent(s);n&&(s.preventDefault(),this.emit(n,"KEYBOARD"))};if(t){const s=o=>{const c=o.pointerType==="pen"?"PEN":o.pointerType==="touch"?"TOUCH":"MOUSE";$e.handleStart(o,t),this.activeSource=c},a=o=>{$e.handleMove(o,t)},n=o=>{$e.handleEnd()};t.addEventListener("pointerdown",s),e.addEventListener("pointermove",a),e.addEventListener("pointerup",n)}return e.addEventListener("keydown",i),e.addEventListener("keyup",s=>Te.updatePhysicalState(s,"up")),()=>{e.removeEventListener("keydown",i)}}}const si=new ga;class xa{isPlaying=!1;nextNoteTime=0;timer=null;get ctx(){return Dt.ctx}scale=Re.ambient.scale;chords=Re.ambient.chords;currentChordIndex=0;toggle(){this.isPlaying?this.stop():this.start()}start(){this.isPlaying||(this.isPlaying=!0,this.nextNoteTime=this.ctx.currentTime,this.scheduler())}stop(){this.isPlaying=!1,clearTimeout(this.timer)}scheduler(){if(!this.isPlaying||r.studio.isMuted||!r.studio.isAmbientPlaying){this.timer=setTimeout(()=>this.scheduler(),100);return}for(;this.nextNoteTime<this.ctx.currentTime+.1;){this.playGenerativeNote(this.nextNoteTime);const e=.8+Math.random()*1.7;this.nextNoteTime+=e,Math.random()>.85&&(this.currentChordIndex=(this.currentChordIndex+1)%this.chords.length)}this.timer=setTimeout(()=>this.scheduler(),50)}playGenerativeNote(e){const t=this.chords[this.currentChordIndex],s=Math.random()>.3?t[Math.floor(Math.random()*t.length)]:this.scale[Math.floor(Math.random()*this.scale.length)];this.pianoPluck(s,e),this.pianoPluck(s*2,e,.02),Math.random()>.7&&this.pianoPluck(s*.5,e+.05,.03)}pianoPluck(e,t,i=.06){const{startMins:s,fullMins:a}=Re.ambient.fade,n=r.usageMinutes;let o=0;n>=s&&n<a?o=(n-s)/(a-s):n>=a&&(o=1);const c=i*o*r.bgmVolume;if(c<.001)return;const h=this.ctx.createOscillator(),f=this.ctx.createGain(),g=this.ctx.createBiquadFilter();h.type=Math.random()>.5?"sine":"triangle",h.frequency.setValueAtTime(e,t),g.type="lowpass",g.frequency.setValueAtTime(1200,t),g.frequency.exponentialRampToValueAtTime(400,t+1.5),f.gain.setValueAtTime(0,t),f.gain.linearRampToValueAtTime(c,t+.02),f.gain.exponentialRampToValueAtTime(1e-4,t+2.5),h.connect(g),g.connect(f),f.connect(this.ctx.destination),h.start(t),h.stop(t+2.6)}}const ba=new xa;class ma{interval=null;#e=X(()=>r.project.frames.reduce((e,t)=>e+t.duration,0));get totalDuration(){return d(this.#e)}set totalDuration(e){_(this.#e,e)}startPlayback(){if(!r.project.isPlaying){if(r.project.frames.length<=1){$.playUnstitch();return}r.project.isPlaying=!0,$.playStitch(),this.tick()}}stopPlayback(){r.project.isPlaying=!1,this.interval&&(clearTimeout(this.interval),this.interval=null)}togglePlayback(){r.project.isPlaying?this.stopPlayback():this.startPlayback()}tick(){if(!r.project.isPlaying)return;const e=r.project.activeFrame,t=(r.project.activeFrameIndex+1)%r.project.frames.length;this.interval=setTimeout(()=>{r.project.activeFrameIndex=t,this.tick()},e.duration)}}const gi=new ma;class xi{backupInterval=null;unsubscribeSynapse=null;mount(e=null){this.backupInterval=setInterval(()=>F.persistence.backup(),600*1e3),ba.start(),this.unsubscribeSynapse=si.subscribe(i=>{this.handleIntent(i.intent)});const t=si.mount(window,e);return()=>{this.unsubscribeSynapse&&this.unsubscribeSynapse(),t(),clearInterval(this.backupInterval)}}handleIntent(e){switch(Dt.resume(),r.needle.resetInactivityTimer(),e){case"MOVE_UP":return this.executeMove(0,-1);case"MOVE_DOWN":return this.executeMove(0,1);case"MOVE_LEFT":return this.executeMove(-1,0);case"MOVE_RIGHT":return this.executeMove(1,0);case"JUMP_HOME":return F.jumpHome();case"GOTO":return r.studio.showGoTo=!0;case"STITCH":return r.selection.isActive?F.commitSelection():F.stitching.stitch();case"UNSTITCH":return F.stitching.unstitch();case"SOAK":return F.dye.soak();case"BIND_VERTEX":return F.selection.addVertex(r.needle.pos.x,r.needle.pos.y);case"SEAL_BINDING":return r.selection.vertices.length>=3?F.selection.sealBinding():r.selection.isActive?F.commitSelection():F.stitching.stitch();case"PICK_DYE":return F.dye.pickFromLinen();case"COPY":return F.clipboard.copy();case"CUT":return F.clipboard.cut();case"PASTE":return F.clipboard.paste();case"BLEACH":return F.manipulation.bleach();case"UNDO":return r.undo();case"REDO":return r.redo();case"SAVE":return F.persistence.save();case"OPEN":return F.persistence.load();case"OPEN_ARCHIVE":return r.studio.showArchivePattern=!0;case"OPEN_SETTINGS":return r.studio.showLinenSettings=!0;case"ESCAPE":if(jt(async()=>{const{shuttlepoint:t}=await Promise.resolve().then(()=>fa);return{shuttlepoint:t}},void 0,import.meta.url).then(({shuttlepoint:t})=>{if(t.isPointerDown){t.cancel();return}}),r.selection.isActive){r.selection.clear();return}return r.handleEscape();case"OPEN_PALETTE":return r.studio.showPatternCatalog=!r.studio.showPatternCatalog;case"OPEN_DYES":return r.studio.showDyeBasin=!r.studio.showDyeBasin;case"OPEN_AUDIO":return r.studio.showAudioBasin=!r.studio.showAudioBasin;case"OPEN_EXPORT":return r.studio.showArtifactCrate=!0;case"OPEN_HELP":return r.studio.showArtisanGuide=!0;case"OPEN_CODEX":return r.studio.showArtisanCodex=!0;case"PLAY_PULSE":return gi.togglePlayback();case"TOGGLE_GHOST_THREADS":return r.studio.showGhostThreads=!r.studio.showGhostThreads;case"ZOOM_IN":return r.studio.setZoom(.1);case"ZOOM_OUT":return r.studio.setZoom(-.1);case"RESET_ZOOM":return r.studio.resetZoom();case"CLEAR_LINEN":return F.manipulation.clearAll();case"TOGGLE_MUTE":return r.studio.toggleMute();case"SPIRIT_PICK":return F.selection.spiritPick();case"FLIP_H":return F.manipulation.flip("horizontal");case"FLIP_V":return F.manipulation.flip("vertical");case"ROTATE":return F.manipulation.rotate();case"NEW_FRAME":return F.folio.addFrame();case"DUPLICATE_FRAME":return F.folio.duplicateFrame(r.project.activeFrameIndex);case"NEXT_FRAME":return F.folio.nextFrame();case"PREV_FRAME":return F.folio.prevFrame();case"DELETE_FRAME":return F.folio.removeFrame(r.project.activeFrameIndex);case"TAB_FRAMES":return r.studio.folioActiveTab="frames";case"TAB_VEILS":return r.studio.folioActiveTab="veils";case"NEW_VEIL":return F.folio.addVeil();case"DUPLICATE_VEIL":return F.folio.duplicateVeil(r.project.activeFrame.activeVeilIndex);case"NEXT_VEIL":return F.folio.nextVeil();case"PREV_VEIL":return F.folio.prevVeil();case"DELETE_VEIL":return F.folio.removeVeil(r.project.activeFrame.activeVeilIndex);case"TOGGLE_VEIL_LOCK":return F.folio.toggleLock();case"TOGGLE_VEIL_VISIBILITY":return F.folio.toggleVisibility();case"MOVE_VEIL_UP":return F.folio.moveVeilUp();case"MOVE_VEIL_DOWN":return F.folio.moveVeilDown();default:if(e.startsWith("SELECT_DYE_")){const t=parseInt(e.split("_")[2]);return F.dye.select(t===0?9:t-1)}}}executeMove(e,t){if(F.movement.move(e,t)){const i=fe.current.type;i==="LOOMING"&&(r.selection.isActive||F.startSelection(),F.updateSelection()),i==="THREADING"&&F.stitching.stitch(),i==="UNRAVELLING"&&F.stitching.unstitch()}}}const bi=new xi,_a=Object.freeze(Object.defineProperty({__proto__:null,TheLoom:xi,loom:bi},Symbol.toStringTag,{value:"Module"}));var ya=L(`<div class="flex flex-col items-center justify-center text-center"><h1>Rupa</h1> <p>The Weaver's Studio</p></div>`);function mi(l,e){let t=te(e,"size",3,"md");const i={sm:{h1:"text-xl",p:"text-[6px]"},md:{h1:"text-3xl",p:"text-[8px]"},lg:{h1:"text-6xl",p:"text-[12px]"}};let s=X(()=>i[t()]);var a=ya(),n=v(a),o=p(n,2);u(a),O(()=>{z(n,1,`font-tiny5 leading-none text-brand ${d(s).h1??""} tracking-tighter`),z(o,1,`font-serif font-bold tracking-[0.3em] uppercase opacity-40 ${d(s).p??""}`)}),C(l,a)}var Ee=gt(()=>r),Aa=L('<div class="flex items-center gap-3"><button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð§º</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð¿</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true"> </span> </button> <div class="mx-1 h-6 w-px bg-grid-border" aria-hidden="true"></div> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">ð</span> </button> <button class="artisan-tool-btn !py-1.5"><span aria-hidden="true">â¨ï¸</span> </button></div>');function wa(l,e){q(e,!1),be();var t=Aa(),i=v(t);i.__click=()=>Ee(Ee().studio.showPatternCatalog=!0);var s=p(v(i));s.nodeValue=` ${__({key:"hud.basin.catalog_title"})??""}`,u(i);var a=p(i,2);a.__click=()=>Ee(Ee().studio.showArtifactCrate=!0);var n=p(v(a));n.nodeValue=` ${__({key:"hud.actions.preserve_weave"})??""}`,u(a);var o=p(a,2);o.__click=()=>Ee().clearLinen();var c=p(v(o));c.nodeValue=` ${__({key:"hud.actions.clear_linen"})??""}`,u(o);var h=p(o,2);h.__click=()=>Ee(Ee().showAudioBasin=!0);var f=v(h),g=v(f,!0);u(f);var x=p(f);x.nodeValue=` ${__({key:"hud.atmosphere.title"})??""}`,u(h);var m=p(h,4);m.__click=()=>Ee(Ee().showArtisanCodex=!0);var A=p(v(m));A.nodeValue=` ${__({key:"codex.title"})??""}`,u(m);var k=p(m,2);k.__click=()=>Ee(Ee().showArtisanGuide=!0);var b=p(v(k));b.nodeValue=` ${__({key:"guide.title"})??""}`,u(k),u(t),O(()=>G(g,Ee().isMuted?"ð":"ð")),C(l,t),Y()}ue(["click"]);const ka=l=>l;function Ot(l){const e=l-1;return e*e*e+1}function ai(l){const e=typeof l=="string"&&l.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[l,"px"]}function Pe(l,{delay:e=0,duration:t=400,easing:i=ka}={}){const s=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:i,css:a=>`opacity: ${a*s}`}}function _i(l,{delay:e=0,duration:t=400,easing:i=Ot,x:s=0,y:a=0,opacity:n=0}={}){const o=getComputedStyle(l),c=+o.opacity,h=o.transform==="none"?"":o.transform,f=c*(1-n),[g,x]=ai(s),[m,A]=ai(a);return{delay:e,duration:t,easing:i,css:(k,b)=>`
			transform: ${h} translate(${(1-k)*g}${x}, ${(1-k)*m}${A});
			opacity: ${c-f*b}`}}function Sa(l,{delay:e=0,duration:t=400,easing:i=Ot,axis:s="y"}={}){const a=getComputedStyle(l),n=+a.opacity,o=s==="y"?"height":"width",c=parseFloat(a[o]),h=s==="y"?["top","bottom"]:["left","right"],f=h.map(y=>`${y[0].toUpperCase()}${y.slice(1)}`),g=parseFloat(a[`padding${f[0]}`]),x=parseFloat(a[`padding${f[1]}`]),m=parseFloat(a[`margin${f[0]}`]),A=parseFloat(a[`margin${f[1]}`]),k=parseFloat(a[`border${f[0]}Width`]),b=parseFloat(a[`border${f[1]}Width`]);return{delay:e,duration:t,easing:i,css:y=>`overflow: hidden;opacity: ${Math.min(y*20,1)*n};${o}: ${y*c}px;padding-${h[0]}: ${y*g}px;padding-${h[1]}: ${y*x}px;margin-${h[0]}: ${y*m}px;margin-${h[1]}: ${y*A}px;border-${h[0]}-width: ${y*k}px;border-${h[1]}-width: ${y*b}px;min-${o}: 0`}}function pt(l,{delay:e=0,duration:t=400,easing:i=Ot,start:s=0,opacity:a=0}={}){const n=getComputedStyle(l),o=+n.opacity,c=n.transform==="none"?"":n.transform,h=1-s,f=o*(1-a);return{delay:e,duration:t,easing:i,css:(g,x)=>`
			transform: ${c} scale(${1-h*x});
			opacity: ${o-f*x}
		`}}var Ca=L('<span class="font-mono text-[8px] font-bold tracking-widest text-studio-text/30 uppercase"> </span>'),Ea=L('<div class="flex flex-col items-end px-4"><h2 class="font-serif text-sm font-bold tracking-[0.1em] text-studio-text/60 uppercase"> </h2> <!></div>');function Ta(l,e){q(e,!1),be();var t=Ea(),i=v(t),s=v(i,!0);u(i);var a=p(i,2);{var n=o=>{var c=Ca(),h=v(c,!0);u(c),O(f=>G(h,f),[()=>__({key:"project.archived",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}})]),ne(3,c,()=>Pe),C(o,c)};U(a,o=>{r.project.lastSaved&&o(n)})}u(t),O(o=>G(s,o),[()=>r.project.name||__({key:"project.untitled"})]),C(l,t),Y()}var Ia=L('<div class="hud-panel flex h-16 w-full items-center justify-between px-6 py-2"><div class="flex items-center gap-10"><!> <div class="h-8 w-[2px] bg-grid-border opacity-50"></div> <!></div> <!></div>');function Pa(l){var e=Ia(),t=v(e),i=v(t);mi(i,{size:"md"});var s=p(i,4);wa(s,{}),u(t);var a=p(t,2);Ta(a,{}),u(e),C(l,e)}var La=L('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ðï¸</span></button>'),Ma=L('<div class="h-1.5 w-1.5 rounded-xl bg-brand" aria-hidden="true"></div>'),Va=L('<div role="listitem" draggable="true"><button class="flex flex-1 items-center gap-3 overflow-hidden py-3 pl-2 text-left"><span class="text-xs opacity-40" aria-hidden="true"></span> <span class="truncate font-serif text-sm font-medium text-studio-text"> </span></button> <div class="flex items-center gap-2 pr-2"><button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ð</span></button> <!> <!></div></div>'),Fa=L('<div class="flex flex-col gap-1" role="list"></div>'),Ba=L('<button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ðï¸</span></button>'),ja=L('<div class="h-1.5 w-1.5 rounded-xl bg-brand" aria-hidden="true"></div>'),Da=L('<div role="listitem" draggable="true"><div class="flex flex-1 items-center gap-3 overflow-hidden"><button><span aria-hidden="true"> </span></button> <button> </button></div> <div class="flex items-center gap-2 pr-2"><button><span aria-hidden="true"> </span></button> <button class="text-[10px] opacity-0 transition-opacity group-hover:opacity-40 hover:text-brand"><span aria-hidden="true">ð</span></button> <!> <!></div></div>'),Oa=L('<div class="flex flex-col gap-1" role="list"></div>'),Na=L('<div class="flex w-full flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/80 shadow-lg backdrop-blur-md" role="region" aria-label="Folio Ledger"><div class="flex border-b border-black/5 bg-black/5 p-1" role="tablist"><button role="tab"><span aria-hidden="true">ð¼ï¸</span> </button> <button role="tab"><span aria-hidden="true">ð§µ</span> </button></div> <div class="custom-scrollbar max-h-[30vh] overflow-y-auto p-3"><!></div> <div class="flex items-center justify-between bg-black/5 px-5 py-2"><button class="flex items-center gap-1 font-serif text-[8px] font-bold tracking-[0.2em] text-studio-text/30 uppercase hover:text-studio-text/60"><span aria-hidden="true">ï¼</span> </button> <span class="font-serif text-[8px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div>');function Ra(l,e){q(e,!0);let t=P(null),i=P(null);function s(w){_(t,w,!0)}function a(w,V){w.preventDefault(),_(i,V,!0)}function n(w,V){w.preventDefault(),d(t)!==null&&(r.studio.folioActiveTab==="veils"?F.folio.reorderVeil(d(t),V):F.folio.reorderFrame(d(t),V)),_(t,null),_(i,null)}function o(){_(t,null),_(i,null)}var c=Na(),h=v(c),f=v(h);f.__click=()=>r.studio.folioActiveTab="frames",j(f,"title",__({key:"shortcuts.labels.TAB_FRAMES"})+" (Alt+1)");var g=p(v(f));g.nodeValue=` ${__({key:"hud.ledger.frames"})??""}`,u(f);var x=p(f,2);x.__click=()=>r.studio.folioActiveTab="veils",j(x,"title",__({key:"shortcuts.labels.TAB_VEILS"})+" (Alt+2)");var m=p(v(x));m.nodeValue=` ${__({key:"hud.ledger.veils"})??""}`,u(x),u(h);var A=p(h,2),k=v(A);{var b=w=>{var V=Fa();de(V,21,()=>r.project.frames,ve,(D,N,B)=>{var H=Va(),oe=v(H);oe.__click=()=>r.project.activeFrameIndex=B;var Q=v(oe);Q.textContent=B+1;var ie=p(Q,2),me=v(ie,!0);u(ie),u(oe);var R=p(oe,2),le=v(R);le.__click=W=>{W.stopPropagation(),F.folio.duplicateFrame(B)},j(le,"title",__({key:"hud.actions.duplicate"})+" (Ctrl+D)");var _e=p(le,2);{var ce=W=>{var se=La();se.__click=Me=>{Me.stopPropagation(),F.folio.removeFrame(B)},j(se,"title",__({key:"hud.actions.delete"})+" (Alt+D)"),C(W,se)};U(_e,W=>{r.project.frames.length>1&&W(ce)})}var he=p(_e,2);{var ke=W=>{var se=Ma();C(W,se)};U(he,W=>{B===r.project.activeFrameIndex&&W(ke)})}u(R),u(H),O(()=>{z(H,1,`group flex cursor-grab items-center justify-between rounded-xl px-2 transition-all ${B===r.project.activeFrameIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${d(i)===B&&d(t)!==B?"border-t-2 border-brand":""} ${d(t)===B?"opacity-40":""}`),j(H,"aria-current",B===r.project.activeFrameIndex?"true":void 0),G(me,d(N).name)}),Ae("dragstart",H,()=>s(B)),Ae("dragover",H,W=>a(W,B)),Ae("drop",H,W=>n(W,B)),Ae("dragend",H,o),C(D,H)}),u(V),ne(3,V,()=>Pe,()=>({duration:150})),C(w,V)},y=w=>{var V=Oa();de(V,21,()=>r.project.activeFrame.veils,ve,(D,N,B)=>{var H=Da(),oe=v(H),Q=v(oe);Q.__click=ee=>{ee.stopPropagation(),F.folio.toggleVisibility(B)},j(Q,"title",__({key:"hud.ledger.visibility"}));var ie=v(Q),me=v(ie,!0);u(ie),u(Q);var R=p(Q,2);R.__click=()=>r.project.activeFrame.activeVeilIndex=B;var le=v(R,!0);u(R),u(oe);var _e=p(oe,2),ce=v(_e);ce.__click=ee=>{ee.stopPropagation(),F.folio.toggleLock(B)},j(ce,"title",__({key:"hud.ledger.lock"}));var he=v(ce),ke=v(he,!0);u(he),u(ce);var W=p(ce,2);W.__click=ee=>{ee.stopPropagation(),F.folio.duplicateVeil(B)},j(W,"title",__({key:"hud.actions.duplicate"})+" (Ctrl+D)");var se=p(W,2);{var Me=ee=>{var Ce=Ba();Ce.__click=ae=>{ae.stopPropagation(),F.folio.removeVeil(B)},j(Ce,"title",__({key:"hud.actions.delete"})+" (Alt+D)"),C(ee,Ce)};U(se,ee=>{r.project.activeFrame.veils.length>1&&ee(Me)})}var Ve=p(se,2);{var ye=ee=>{var Ce=ja();C(ee,Ce)};U(Ve,ee=>{B===r.project.activeFrame.activeVeilIndex&&ee(ye)})}u(_e),u(H),O(()=>{z(H,1,`group flex cursor-grab items-center justify-between rounded-xl px-2 transition-all ${B===r.project.activeFrame.activeVeilIndex?"bg-brand/10 text-brand ring-1 ring-brand/20":"hover:bg-black/5"} ${d(i)===B&&d(t)!==B?"border-t-2 border-brand":""} ${d(t)===B?"opacity-40":""}`),j(H,"aria-current",B===r.project.activeFrame.activeVeilIndex?"true":void 0),z(Q,1,`ml-2 text-xs transition-opacity ${d(N).isVisible?"opacity-100":"opacity-20"}`),G(me,d(N).isVisible?"ðï¸":"ð¶ï¸"),z(R,1,`flex-1 truncate py-3 text-left font-serif text-sm font-medium text-studio-text ${d(N).isVisible?"":"opacity-40"}`),G(le,d(N).name),z(ce,1,`text-[10px] transition-opacity ${d(N).isLocked?"opacity-100":"opacity-20"}`),G(ke,d(N).isLocked?"ð":"ð")}),Ae("dragstart",H,()=>s(B)),Ae("dragover",H,ee=>a(ee,B)),Ae("drop",H,ee=>n(ee,B)),Ae("dragend",H,o),C(D,H)}),u(V),ne(3,V,()=>Pe,()=>({duration:150})),C(w,V)};U(k,w=>{r.studio.folioActiveTab==="frames"?w(b):w(y,!1)})}u(A);var S=p(A,2),M=v(S);M.__click=()=>{r.studio.folioActiveTab==="frames"?F.folio.addFrame():F.folio.addVeil()};var I=p(v(M));u(M);var T=p(M,2),E=v(T,!0);u(T),u(S),u(c),O((w,V)=>{j(f,"aria-selected",r.studio.folioActiveTab==="frames"),z(f,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.folioActiveTab==="frames"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),j(x,"aria-selected",r.studio.folioActiveTab==="veils"),z(x,1,`flex flex-1 items-center justify-center gap-2 py-2 text-[10px] font-bold tracking-widest uppercase transition-all ${r.studio.folioActiveTab==="veils"?"rounded-xl bg-white text-brand shadow-sm":"opacity-40 hover:opacity-60"}`),G(I,` ${w??""}`),G(E,V)},[()=>r.studio.folioActiveTab==="frames"?__({key:"hud.actions.add_frame"}):__({key:"hud.actions.add_veil"}),()=>r.studio.folioActiveTab==="frames"?r.project.frames.length+" "+__({key:"hud.ledger.frames"}):r.project.activeFrame.veils.length+" "+__({key:"hud.ledger.veils"})]),C(l,c),Y()}ue(["click"]);var $a=L('<aside class="side-panel-left flex h-full w-full flex-col gap-6 p-4"><div class="flex-1 overflow-y-auto"><!></div></aside>');function Ga(l){var e=$a(),t=v(e),i=v(t);Ra(i,{}),u(t),u(e),C(l,e)}var Ua=L('<button class="group artisan-checker-small relative h-5 w-5 shrink-0 rounded-md border-2 border-white shadow-sm transition-all hover:scale-110 active:scale-95"><div class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity group-hover:opacity-100"><span class="text-[6px] drop-shadow-sm">ð</span></div></button>'),Ha=L('<div class="flex h-5 w-5 items-center justify-center rounded-md border-2 border-dashed border-studio-text/10"><span class="text-[6px] opacity-20">ð§µ</span></div>'),za=L('<div class="artisan-panel flex w-full flex-col gap-4 px-3 py-4 shadow-sm"><div class="flex flex-col items-center gap-2"><span class="font-serif text-[7px] font-bold uppercase opacity-30">Active Dye</span> <div class="artisan-checker-small h-8 w-8 rounded-lg border-2 border-white shadow-md transition-colors"></div> <span class="font-mono text-[8px] font-bold tracking-tighter uppercase opacity-40"> </span></div> <div class="h-px w-full bg-studio-text/10"></div> <div class="flex flex-col gap-3"><span class="text-center font-serif text-[7px] font-bold uppercase opacity-30">Used Dyes</span> <div class="no-scrollbar flex max-h-[150px] flex-row flex-wrap gap-1.5 overflow-y-auto svelte-1dy8mnv"></div></div></div>');function Ka(l,e){q(e,!1),be();var t=za(),i=v(t),s=p(v(i),2),a=p(s,2),n=v(a,!0);u(a),u(i);var o=p(i,4),c=p(v(o),2);de(c,5,()=>r.usedColors,h=>h,(h,f)=>{var g=Ua();g.__click=()=>F.dye.setDye(d(f)),O(()=>{J(g,`background-color: ${d(f)??""};`),j(g,"title",d(f))}),ne(3,g,()=>Sa,()=>({duration:200})),C(h,g)},h=>{var f=Ha();C(h,f)}),u(c),u(o),u(t),O(()=>{J(s,`background-color: ${r.paletteState.activeDye??""};`),G(n,r.paletteState.activeDye)}),C(l,t),Y()}ue(["click"]);var qa=L('<div class="artisan-panel stats-panel w-full rounded-xl px-4 py-3 shadow-sm" role="status"><div class="flex flex-col gap-2"><div class="flex flex-col"><span class="font-serif text-[7px] font-bold text-studio-text/30 uppercase"></span> <span class="font-mono text-[10px] font-bold text-studio-text tabular-nums"> </span></div> <div class="h-px w-full bg-studio-text/10" aria-hidden="true"></div> <div class="flex flex-col"><span class="font-serif text-[7px] font-bold text-studio-text/30 uppercase"></span> <span class="font-mono text-[10px] font-bold text-studio-text tabular-nums"> </span></div></div></div>');function Ya(l,e){q(e,!1),be();var t=qa(),i=v(t),s=v(i),a=v(s);a.textContent=__({key:"stats.needle_focus"});var n=p(a,2),o=v(n);u(n),u(s);var c=p(s,4),h=v(c);h.textContent=__({key:"stats.linen_size"});var f=p(h,2),g=v(f);u(f),u(c),u(i),u(t),O(()=>{G(o,`${r.displayCoords.x??""}, ${r.displayCoords.y??""}`),G(g,`${r.linen.width??""}Ã${r.linen.height??""}`)}),C(l,t),Y()}var Qe=gt(()=>r),Qa=L('<button role="radio"></button>'),Xa=L('<div class="artisan-panel flex w-full flex-col gap-3 rounded-xl p-3 shadow-sm" role="region"><span class="text-center font-serif text-[7px] font-bold text-studio-text/30 uppercase"></span> <div class="grid grid-cols-4 gap-2" role="radiogroup"><!> <button class="flex h-8 w-8 items-center justify-center rounded-lg border-2 border-dashed border-brand/40 bg-gradient-to-tr from-rose-200 to-sky-200 shadow-sm transition-all hover:scale-110 hover:border-brand"><span class="text-xs" aria-hidden="true">ï¼</span></button></div></div>');function Za(l,e){q(e,!1),be();var t=Xa();j(t,"aria-label",__({key:"shortcuts.groups.the_hand"}));var i=v(t);i.textContent=__({key:"shortcuts.groups.swatches"});var s=p(i,2),a=v(s);de(a,1,()=>Qe().palette,ve,(o,c,h)=>{var f=Qa();f.__click=()=>F.dye.select(h),O((g,x)=>{z(f,1,`artisan-checker-small h-8 w-8 rounded-lg border-2 transition-all ${Qe().activeDye===d(c)?"scale-110 border-brand shadow-md ring-2 ring-white":"border-white opacity-70 hover:scale-105 hover:opacity-100"}`),J(f,`background-color: ${d(c)??""};`),j(f,"aria-label",g),j(f,"title",x),j(f,"aria-checked",Qe().activeDye===d(c))},[()=>__({key:"shortcuts.labels.SELECT_DYE",replace:{index:h+1}}),()=>__({key:"shortcuts.labels.SELECT_DYE",replace:{index:h+1}})+` (${(h+1)%10})`]),C(o,f)});var n=p(a,2);n.__click=()=>Qe(Qe().studio.showDyeBasin=!0),j(n,"title",__({key:"dye_basin.title"})+" (B)"),j(n,"aria-label",__({key:"dye_basin.title"})),u(s),u(t),C(l,t),Y()}ue(["click"]);var Wa=L('<aside class="side-panel-right flex h-full w-full flex-col gap-6 p-4"><div class="flex flex-col gap-4"><!> <!></div> <div class="flex-1"></div> <!></aside>');function Ja(l){var e=Wa(),t=v(e),i=v(t);Ka(i,{});var s=p(i,2);Za(s,{}),u(t);var a=p(t,4);Ya(a,{}),u(e),C(l,e)}var er=L('<span class="text-xs" aria-hidden="true"> </span>'),tr=L('<span class="ml-1 border-l border-studio-text/20 pl-2 font-mono text-[9px] tracking-tighter not-italic"> </span>'),ir=L("<div><!> <span> </span> <!></div>"),sr=L('<div class="text-[8px] font-bold tracking-[0.2em] text-studio-text/20 uppercase"> </div>'),ar=L('<div role="status" aria-live="polite"><div class="flex w-[180px] items-center"><!></div> <!></div>');function rr(l,e){q(e,!1),be();var t=ar(),i=v(t),s=v(i);fs(s,()=>fe.current.type,o=>{var c=ir(),h=v(c);{var f=k=>{var b=er(),y=v(b,!0);u(b),O(()=>G(y,fe.current.icon)),C(k,b)};U(h,k=>{fe.current.icon&&k(f)})}var g=p(h,2),x=v(g,!0);u(g);var m=p(g,2);{var A=k=>{var b=tr(),y=v(b);u(b),O(()=>G(y,`v${r.version??""}`)),C(k,b)};U(m,k=>{fe.current.type==="RESTING"&&k(A)})}u(c),O(()=>{z(c,1,`status-tag flex items-center gap-2 ${fe.current.isPulse?"animate-pulse":""}`),J(c,`
					border-color: color-mix(in srgb, ${fe.current.color??""} 20%, transparent);
					background-color: color-mix(in srgb, ${fe.current.color??""} 10%, transparent);
					color: ${fe.current.color??""};
				`),z(g,1,ks(fe.current.type==="RESTING"?"font-serif italic opacity-60":"font-bold")),G(x,fe.current.label)}),C(o,c)}),u(i);var a=p(i,2);{var n=o=>{const c=dt(()=>r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));var h=sr(),f=v(h,!0);u(h),O((g,x)=>{j(h,"aria-label",g),G(f,x)},[()=>__({key:"project.archived",replace:{time:d(c)}}),()=>__({key:"project.archived",replace:{time:d(c)}})]),C(o,h)};U(a,o=>{r.project.lastSaved&&o(n)})}u(t),O(()=>z(t,1,`flex items-center gap-4 transition-opacity duration-1000 ${r.needle.isVisible?"opacity-100":"opacity-0"}`)),C(l,t),Y()}var nr=L('<span class="rounded bg-brand/10 px-1.5 py-0.5 font-mono text-[9px] font-black text-brand uppercase"> </span>'),or=L('<span class="font-mono text-[9px] text-studio-text/20 italic"></span>'),lr=L('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic"></span> <div class="flex min-w-[120px] gap-1.5"><!></div></div>');function cr(l,e){q(e,!1),be();var t=lr(),i=v(t);i.textContent=`${__({key:"ledger.chord"})??""}:`;var s=p(i,2),a=v(s);{var n=c=>{var h=Le(),f=re(h);de(f,1,()=>Te.activeKeys,ve,(g,x)=>{var m=nr(),A=v(m,!0);u(m),O(()=>G(A,d(x)===" "?"Space":d(x))),C(g,m)}),C(c,h)},o=c=>{var h=or();h.textContent=__({key:"ledger.none"}),C(c,h)};U(a,c=>{Te.activeKeys.length>0?c(n):c(o,!1)})}u(s),u(t),C(l,t),Y()}var dr=L('<div class="flex items-center gap-2"><span class="font-serif text-[8px] font-black tracking-widest text-brand/40 uppercase italic"></span> <span class="font-mono text-[9px] font-bold text-brand uppercase"> </span></div>');function ur(l,e){q(e,!1),be();var t=dr(),i=v(t);i.textContent=`${__({key:"ledger.stance"})??""}:`;var s=p(i,2),a=v(s,!0);u(s),u(t),O(()=>G(a,fe.current.type)),C(l,t),Y()}var hr=L('<div class="flex items-center gap-1.5"><span aria-hidden="true">ð¹</span> <span class="font-serif text-[8px] font-bold tracking-wider text-brand/40 uppercase italic"><!></span></div>');function vr(l,e){q(e,!1),be();var t=hr();j(t,"title",__({key:"ledger.atmosphere.title"}));var i=v(t),s=p(i,2),a=v(s);{var n=c=>{var h=Ze();h.nodeValue=__({key:"ledger.atmosphere.silent"}),C(c,h)},o=c=>{var h=Le(),f=re(h);{var g=m=>{var A=Ze();A.nodeValue=__({key:"ledger.atmosphere.weaving"}),C(m,A)},x=m=>{var A=Ze();A.nodeValue=__({key:"ledger.atmosphere.resonance"}),C(m,A)};U(f,m=>{r.usageMinutes<60?m(g):m(x,!1)},!0)}C(c,h)};U(a,c=>{r.usageMinutes<30?c(n):c(o,!1)})}u(s),u(t),O(()=>z(i,1,`text-[9px] ${r.usageMinutes>=30?"animate-pulse":"opacity-20 grayscale"}`)),C(l,t),Y()}var pr=L('<div class="flex items-center gap-1.5"><span class="text-[9px] opacity-40" aria-hidden="true">â³</span> <span class="font-mono text-[9px] font-bold text-brand/60 tabular-nums"> </span></div>');function fr(l,e){q(e,!1),be();var t=pr();j(t,"title",__({key:"ledger.timer"}));var i=p(v(t),2),s=v(i,!0);u(i),u(t),O(()=>G(s,r.studio.sessionTimeLabel)),C(l,t),Y()}var gr=L('<div class="flex items-center gap-1.5" role="status"><span class="text-[9px] text-brand/60" aria-hidden="true">ð¸ï¸</span> <span class="font-serif text-[8px] font-bold tracking-wider text-brand/60 uppercase italic"> </span></div>');function xr(l,e){q(e,!0);let t=X(()=>r.selection.getPoints(r.linen.width).length);var i=Le(),s=re(i);{var a=n=>{var o=gr(),c=p(v(o),2),h=v(c,!0);u(c),u(o),O((f,g)=>{j(o,"title",f),G(h,g)},[()=>__({key:"stats.active_motif",replace:{count:d(t)}}),()=>__({key:"stats.active_motif",replace:{count:d(t)}})]),ne(3,o,()=>Pe),C(n,o)};U(s,n=>{d(t)>0&&n(a)})}C(l,i),Y()}var br=L('<div class="flex items-center gap-1.5"><span class="text-[10px]" aria-hidden="true">ð¾</span> <span class="font-mono text-[8px] font-bold tracking-tighter text-brand uppercase"> </span></div> <div class="h-3 w-px bg-brand/20" aria-hidden="true"></div>',1),mr=L('<div class="flex items-center gap-4 text-studio-text/40" role="status"><!> <div class="flex gap-3 font-mono text-[8px] font-bold tracking-tighter uppercase"><span> </span> <span> </span> <span> </span></div> <div class="h-3 w-px bg-brand/20" aria-hidden="true"></div> <span class="font-mono text-[9px] font-black tracking-widest text-brand/60 uppercase"></span></div>');function _r(l,e){q(e,!1),be();var t=mr(),i=v(t);{var s=m=>{var A=br(),k=re(A),b=p(v(k),2),y=v(b,!0);u(b),u(k),et(2),O(S=>G(y,S),[()=>__({key:"project.archived",replace:{time:r.project.lastSaved.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}})]),ne(3,k,()=>Pe),C(m,A)};U(i,m=>{r.project.lastSaved&&m(s)})}var a=p(i,2),n=v(a),o=v(n);u(n);var c=p(n,2),h=v(c);u(c);var f=p(c,2),g=v(f);u(f),u(a);var x=p(a,4);x.textContent=__({key:"stats.technical_ledger"}),u(t),O(m=>{G(o,`Pos: ${r.needle.pos.x??""},${r.needle.pos.y??""}`),G(h,`Size: ${r.linen.width??""}x${r.linen.height??""}`),G(g,`Zoom: ${m??""}%`)},[()=>Math.round(r.studio.zoomLevel*100)]),C(l,t),Y()}var yr=L('<div class="flex flex-1 items-center justify-between px-6 opacity-60 transition-opacity hover:opacity-100"><div class="flex items-center gap-6"><!> <div class="h-3 w-px bg-brand/10"></div> <!> <div class="h-3 w-px bg-brand/10"></div> <div class="flex items-center gap-4"><!> <!> <div class="h-3 w-px bg-brand/10"></div> <!></div></div> <!></div>');function Ar(l){var e=yr(),t=v(e),i=v(t);cr(i,{});var s=p(i,4);ur(s,{});var a=p(s,4),n=v(a);fr(n,{});var o=p(n,2);vr(o,{});var c=p(o,4);xr(c,{}),u(a),u(t);var h=p(t,2);_r(h,{}),u(e),C(l,e)}var Be=gt(()=>r),wr=L('<div class="flex items-center gap-3 border-r border-black/5 pr-3" role="toolbar" aria-label="Spindle Controls"><button><span class="text-[10px]" aria-hidden="true"> </span> <span class="font-tiny5 tracking-widest uppercase"> </span></button> <div class="flex items-center gap-1.5 rounded-lg bg-black/5 px-2 py-0.5"><label for="pace-input" class="font-serif text-[8px] font-black tracking-tighter text-studio-text/30 uppercase"></label> <input id="pace-input" type="number" min="1" max="60" class="w-6 bg-transparent text-center font-mono text-[10px] font-bold text-studio-text focus:outline-none"/> <span class="font-serif text-[8px] text-studio-text/20" aria-hidden="true">FPS</span></div> <button><span class="text-[10px]" aria-hidden="true">ð»</span> <span class="font-serif text-[8px] font-black tracking-wider text-studio-text/60 uppercase">Ghosts</span></button></div>');function kr(l,e){q(e,!1),be();var t=wr(),i=v(t);i.__click=()=>gi.togglePlayback(),j(i,"title",__({key:"shortcuts.labels.PLAY_PULSE"})+" (P)"),j(i,"aria-label",__({key:"shortcuts.labels.PLAY_PULSE"}));var s=v(i),a=v(s,!0);u(s);var n=p(s,2),o=v(n,!0);u(n),u(i);var c=p(i,2),h=v(c);h.textContent=__({key:"artifact.fps_label"});var f=p(h,2);ge(f),et(2),u(c);var g=p(c,2);g.__click=()=>Be(Be().studio.showGhostThreads=!Be().studio.showGhostThreads),j(g,"title",__({key:"shortcuts.labels.TOGGLE_GHOST_THREADS"})+" (Alt+G)"),j(g,"aria-label",__({key:"shortcuts.labels.TOGGLE_GHOST_THREADS"})),u(t),O(()=>{z(i,1,`artisan-primary-btn flex items-center gap-1.5 !px-3 !py-1 text-[10px] ${Be().project.isPlaying?"bg-brand":"bg-slate-700"}`),G(a,Be().project.isPlaying?"â¹":"â¶"),G(o,Be().project.isPlaying?"Stop":"Play"),z(g,1,`flex items-center gap-1.5 rounded-lg px-2.5 py-0.5 transition-all ${Be().studio.showGhostThreads?"bg-brand/10 text-brand ring-1 ring-brand/20":"bg-black/5 opacity-40 hover:opacity-100"}`)}),xe(f,()=>Be().studio.fps,x=>Be(Be().studio.fps=x)),C(l,t),Y()}ue(["click"]);var Sr=L("<div></div>"),Cr=L("<div></div>"),Er=L('<div class="h-1 w-1 animate-pulse rounded-full bg-brand"></div>'),Tr=L('<div><div role="button" tabindex="0"><div class="absolute inset-0 grid opacity-10 group-hover:opacity-30"></div> <div class="absolute top-1 left-1.5 flex items-center gap-1.5"><span class="font-mono text-[9px] font-black italic opacity-30"> </span> <!></div> <div class="absolute right-1.5 bottom-1 flex items-center gap-0.5 opacity-30 transition-opacity group-hover:opacity-100"><input type="number" step="10" min="10" class="w-7 bg-transparent text-right font-mono text-[8px] font-bold focus:outline-none"/> <span class="font-serif text-[7px] font-black text-brand uppercase">ms</span></div> <div class="absolute inset-0 flex items-center justify-center gap-2 bg-white/95 opacity-0 transition-opacity group-hover:opacity-100"><button class="p-1 transition-transform hover:scale-125">ð</button> <button class="p-1 transition-transform hover:scale-125">ðï¸</button></div></div></div>');function Ir(l,e){q(e,!0);let t=te(e,"frame",7),i=X(()=>t().compositeStitches),s=X(()=>Math.max(40,t().duration*.6));var a=Tr(),n=v(a);n.__click=()=>r.project.activeFrameIndex=e.index,n.__keydown=S=>S.key==="Enter"&&(r.project.activeFrameIndex=e.index);var o=v(n);de(o,21,()=>d(i),ve,(S,M)=>{var I=Le(),T=re(I);{var E=V=>{var D=Sr();O(()=>J(D,`background-color: ${d(M)??""};`)),C(V,D)},w=V=>{var D=Cr();C(V,D)};U(T,V=>{d(M)?V(E):V(w,!1)})}C(S,I)}),u(o);var c=p(o,2),h=v(c),f=v(h,!0);u(h);var g=p(h,2);{var x=S=>{var M=Er();C(S,M)};U(g,S=>{e.isActive&&S(x)})}u(c);var m=p(c,2),A=v(m);ge(A),et(2),u(m);var k=p(m,2),b=v(k);b.__click=S=>{S.stopPropagation(),F.folio.duplicateFrame(e.index)};var y=p(b,2);y.__click=S=>{S.stopPropagation(),F.folio.removeFrame(e.index)},u(k),u(n),u(a),O(()=>{z(a,1,`relative h-12 flex-shrink-0 transition-all ${e.isDragged?"opacity-20":""}`),J(a,`width: ${d(s)??""}px;`),z(n,1,`group relative h-full w-full cursor-pointer overflow-hidden border-r border-black/10 transition-all ${e.isActive?"bg-brand/5 shadow-[inset_0_0_0_1px_rgba(211,54,130,0.3)]":"bg-black/5 hover:bg-white/40"} ${e.isDropTarget?"border-l-2 border-l-brand":""}`),J(o,`grid-template-columns: repeat(${t().width??""}, 1fr); grid-template-rows: repeat(${t().height??""}, 1fr);`),G(f,e.index+1)}),xe(A,()=>t().duration,S=>t().duration=S),C(l,a),Y()}ue(["click","keydown"]);var Pr=L('<div class="absolute flex flex-col items-center gap-0.5"><div class="h-1.5 w-px bg-brand/20"></div> <span class="font-mono text-[6px] text-brand/40"> </span></div>'),Lr=L('<div draggable="true" role="listitem"><!></div>'),Mr=L('<div class="relative flex flex-1 flex-col overflow-hidden rounded-lg border border-black/10 bg-black/5 shadow-inner"><div class="relative h-4 w-full overflow-hidden border-b border-black/5 bg-[#eee8d5]"><div class="flex items-center px-2"></div></div> <div class="custom-scrollbar relative flex flex-1 items-start overflow-x-auto overflow-y-hidden svelte-n1ejs0" role="list" aria-label="Spindle Timeline"><div class="flex h-full min-w-full items-center bg-[#eee8d5]/40"><!> <button class="flex h-12 w-10 shrink-0 items-center justify-center border-r border-black/5 bg-black/5 text-lg text-black/20 transition-all hover:bg-brand/10 hover:text-brand" title="New Frame (Alt+N)">ï¼</button></div> <div class="pointer-events-none absolute top-0 bottom-0 z-20 w-px bg-brand transition-all duration-100 ease-out"><div class="absolute -top-1 -left-1.5 h-3 w-3 rounded-full border-2 border-brand bg-[#fdf6e3] shadow-md"></div></div></div></div>');function Vr(l,e){q(e,!0);let t=P(null),i=P(null);function s(S){_(t,S,!0)}function a(S,M){S.preventDefault(),_(i,M,!0)}function n(S,M){S.preventDefault(),d(t)!==null&&F.folio.reorderFrame(d(t),M),_(t,null),_(i,null)}let o=X(()=>{const S=r.project.activeFrameIndex;let M=0;for(let I=0;I<S;I++)M+=Math.max(40,r.project.frames[I].duration*.6);return M}),c=X(()=>r.project.frames.reduce((S,M)=>S+M.duration,0)),h=X(()=>{const S=[];for(let I=0;I<=d(c);I+=200)S.push(I);return S});var f=Mr(),g=v(f),x=v(g);de(x,21,()=>d(h),ve,(S,M)=>{var I=Pr(),T=p(v(I),2),E=v(T);u(T),u(I),O(()=>{J(I,`left: ${d(M)*.6}px;`),G(E,`${d(M)??""}ms`)}),C(S,I)}),u(x),u(g);var m=p(g,2),A=v(m),k=v(A);de(k,19,()=>r.project.frames,S=>S.id,(S,M,I)=>{var T=Lr(),E=v(T);{let w=X(()=>d(I)===r.project.activeFrameIndex),V=X(()=>d(t)===d(I)),D=X(()=>d(i)===d(I)&&d(t)!==d(I));Ir(E,{get frame(){return d(M)},get index(){return d(I)},get isActive(){return d(w)},get isDragged(){return d(V)},get isDropTarget(){return d(D)}})}u(T),Ae("dragstart",T,()=>s(d(I))),Ae("dragover",T,w=>a(w,d(I))),Ae("drop",T,w=>n(w,d(I))),Ae("dragend",T,()=>{_(t,null),_(i,null)}),C(S,T)});var b=p(k,2);b.__click=()=>F.folio.addFrame(),u(A);var y=p(A,2);u(m),u(f),O(()=>J(y,`left: ${d(o)??""}px;`)),C(l,f),Y()}ue(["click"]);var Fr=L('<div class="artisan-panel flex h-28 w-full flex-col gap-1.5 overflow-hidden px-4 py-2 shadow-2xl transition-all hover:bg-white/40" role="region"><div class="flex items-center justify-between border-b border-black/5 pb-1"><div class="flex items-center gap-4"><div class="flex items-center gap-1.5"><span class="text-[10px] opacity-40" aria-hidden="true">â³</span> <span class="font-tiny5 text-[9px] tracking-[0.2em] text-brand uppercase"></span></div> <!></div> <div class="flex items-center gap-4"><div class="flex flex-col items-end gap-0"><span class="font-serif text-[7px] font-black tracking-widest text-studio-text/20 uppercase"></span> <span class="font-mono text-[8px] font-bold text-brand/60"> </span></div></div></div> <!></div>');function Br(l,e){q(e,!1),be();var t=Fr();j(t,"aria-label",__({key:"ledger.spindle_title"}));var i=v(t),s=v(i),a=v(s),n=p(v(a),2);n.textContent=__({key:"ledger.spindle_title"}),u(a);var o=p(a,2);kr(o,{}),u(s);var c=p(s,2),h=v(c),f=v(h);f.textContent=__({key:"ledger.kinetic_track"});var g=p(f,2),x=v(g,!0);u(g),u(h),u(c),u(i);var m=p(i,2);Vr(m,{}),u(t),O(A=>G(x,A),[()=>__({key:"ledger.thread_count",replace:{count:r.project.frames.length}})]),C(l,t),Y()}var jr=L('<footer class="hud-panel flex w-full flex-col border-t-2 border-grid-border bg-canvas-bg px-4 py-1"><!> <div class="flex h-10 w-full items-center justify-between"><div class="flex items-center gap-4"><!></div> <!></div></footer>');function Dr(l){var e=jr(),t=v(e);Br(t,{});var i=p(t,2),s=v(i),a=v(s);rr(a,{}),u(s);var n=p(s,2);Ar(n),u(i),u(e),C(l,e)}var Or=L('<div class="absolute top-0 bottom-0 w-px -translate-x-1/2 bg-studio-text/10"></div>'),Nr=L('<div class="absolute right-0 left-0 h-px -translate-y-1/2 bg-studio-text/10"></div>'),Rr=L('<div class="pointer-events-none absolute inset-0 z-20 overflow-hidden"><div class="absolute top-0 bottom-0 left-1/2 w-px -translate-x-1/2 bg-studio-text/30"></div> <div class="absolute top-1/2 right-0 left-0 h-px -translate-y-1/2 bg-studio-text/30"></div> <!> <!></div>');function $r(l,e){q(e,!1),be();var t=Rr(),i=p(v(t),4);de(i,0,()=>[-24,-16,-8,8,16,24],ve,(a,n)=>{const o=dt(()=>50+n/r.linen.width*100);var c=Le(),h=re(c);{var f=g=>{var x=Or();O(()=>J(x,`left: ${d(o)??""}%`)),C(g,x)};U(h,g=>{d(o)>0&&d(o)<100&&g(f)})}C(a,c)});var s=p(i,2);de(s,0,()=>[-24,-16,-8,8,16,24],ve,(a,n)=>{const o=dt(()=>50+n/r.linen.height*100);var c=Le(),h=re(c);{var f=g=>{var x=Nr();O(()=>J(x,`top: ${d(o)??""}%`)),C(g,x)};U(h,g=>{d(o)>0&&d(o)<100&&g(f)})}C(a,c)}),u(t),C(l,t),Y()}var Gr=L('<div class="absolute inset-[-4px] z-0 animate-ping rounded-sm border-2 border-white opacity-20"></div> <div class="absolute -top-10 left-1/2 z-[110] flex -translate-x-1/2 flex-col items-center"><div class="relative h-7 w-7 overflow-hidden rounded-xl rounded-br-none border-4 border-white bg-white shadow-xl ring-1 ring-black/5" style="transform: rotate(45deg);"><div class="h-full w-full -rotate-45"></div></div> <div class="-mt-0.5 h-2 w-0.5 rounded-xl bg-white opacity-80 shadow-sm"></div></div>',1),Ur=L('<div class="cursor-container absolute inset-0 svelte-4tpgo2"><div class="bloom-wrapper svelte-4tpgo2"><div class="petal p-top svelte-4tpgo2"></div> <div class="petal p-bottom svelte-4tpgo2"></div> <div class="petal p-left svelte-4tpgo2"></div> <div class="petal p-right svelte-4tpgo2"></div> <div class="center-dot svelte-4tpgo2"></div></div> <!></div>');function Hr(l,e){q(e,!1),be();var t=Le(),i=re(t);{var s=a=>{var n=Ur(),o=p(v(n),2);{var c=h=>{var f=Gr(),g=re(f),x=p(g,2),m=v(x),A=v(m);u(m),et(2),u(x),O(()=>{J(g,`background-color: ${r.activeDye??""};`),J(A,`background-color: ${r.activeDye??""};`)}),ne(3,g,()=>Pe,()=>({duration:400})),ne(1,x,()=>_i,()=>({y:-10,duration:400})),ne(2,x,()=>Pe,()=>({duration:400})),C(h,f)};U(o,h=>{r.isPicking&&h(c)})}u(n),ne(3,n,()=>Pe,()=>({duration:800})),C(a,n)};U(i,a=>{r.isNeedleVisible&&a(s)})}C(l,t),Y()}var zr=L("<div><!></div>");function Kr(l,e){let t=X(()=>e.activeX===e.x&&e.activeY===e.y),i=X(()=>e.color===null);var s=zr(),a=v(s);{var n=o=>{Hr(o,{})};U(a,o=>{d(t)&&o(n)})}u(s),O(()=>{z(s,1,`cell-stitch relative h-full w-full ${d(t)?"z-30":"z-10"}`),J(s,`background-color: ${(d(i)?"transparent":e.color)??""};`)}),C(l,s)}var qr=ft('<line stroke-dasharray="0.2, 0.2" class="marching-ants-svg svelte-1onh8x1"></line>'),Yr=ft('<line stroke="var(--color-brand)" stroke-width="0.05" stroke-dasharray="0.1, 0.1"></line>'),Qr=ft('<circle r="0.2" fill="var(--color-brand)"></circle><!>',1),Xr=L('<div class="absolute bg-brand/10"></div>'),Zr=L('<svg class="pointer-events-none absolute inset-0 z-40 h-full w-full overflow-visible" style="grid-column: 1 / -1; grid-row: 1 / -1;" shape-rendering="crispEdges"><defs><pattern id="ants" width="1" height="1" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="1" y2="0" stroke="var(--ants-color)" stroke-width="0.1" stroke-dasharray="0.2, 0.2"></line></pattern></defs><!><!></svg> <div class="pointer-events-none absolute inset-0 z-[39]" style="grid-column: 1 / -1; grid-row: 1 / -1;"></div>',1);function Wr(l,e){q(e,!0);let t=X(()=>r.selection.getBoundaryEdges(r.linen.width)),i=X(()=>r.selection.vertices),s=X(()=>fe.current.type==="LOOMING");var a=Le(),n=re(a);{var o=c=>{var h=Zr(),f=re(h),g=p(v(f));de(g,17,()=>d(t),ve,(k,b)=>{var y=qr();j(y,"stroke-width",.08),O(()=>{j(y,"x1",d(b).x1),j(y,"y1",d(b).y1),j(y,"x2",d(b).x2),j(y,"y2",d(b).y2),j(y,"stroke",d(s)?"var(--color-brand)":"rgba(211, 54, 130, 0.8)")}),C(k,y)});var x=p(g);{var m=k=>{var b=Le(),y=re(b);de(y,17,()=>d(i),ve,(S,M,I)=>{const T=X(()=>d(i)[I+1]||d(i)[0]);var E=Qr(),w=re(E),V=p(w);{var D=N=>{var B=Yr();O(()=>{j(B,"x1",d(M).x+.5),j(B,"y1",d(M).y+.5),j(B,"x2",d(T).x+.5),j(B,"y2",d(T).y+.5)}),C(N,B)};U(V,N=>{d(i).length>1&&I<d(i).length-(d(i).length>=3?0:1)&&N(D)})}O(()=>{j(w,"cx",d(M).x+.5),j(w,"cy",d(M).y+.5)}),C(S,E)}),C(k,b)};U(x,k=>{d(i).length>0&&k(m)})}u(f);var A=p(f,2);de(A,21,()=>r.selection.getPoints(r.linen.width),ve,(k,b)=>{var y=Xr();O(()=>J(y,`
                left: ${d(b).x/r.linen.width*100}%; 
                top: ${d(b).y/r.linen.height*100}%; 
                width: ${100/r.linen.width}%; 
                height: ${100/r.linen.height}%;
            `)),C(k,y)}),u(A),O(()=>j(f,"viewBox",`0 0 ${r.linen.width??""} ${r.linen.height??""}`)),C(c,h)};U(n,c=>{r.selection.isActive&&c(o)})}C(l,a),Y()}var Jr=L("<div></div>"),en=L('<div class="ghost-frame pointer-events-none absolute inset-0 z-0 svelte-1syggvx"></div>');function tn(l,e){let t=te(e,"opacity",3,.2);var i=en();de(i,21,()=>e.stitches,ve,(s,a,n)=>{var o=Le(),c=re(o);{var h=f=>{var g=Jr();O(x=>J(g,`grid-column: ${n%e.width+1}; grid-row: ${x??""}; background-color: ${d(a)??""};`),[()=>Math.floor(n/e.width)+1]),C(f,g)};U(c,f=>{d(a)&&f(h)})}C(s,o)}),u(i),O(()=>J(i,`
        display: grid;
        grid-template-columns: repeat(${e.width??""}, 1fr); 
        grid-template-rows: repeat(${e.height??""}, 1fr);
        opacity: ${t()??""};
    `)),C(l,i)}var sn=ft('<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline>'),an=L('<div class="loom-viewport relative flex h-full w-full items-center justify-center overflow-hidden svelte-jw6f5"><div class="loom-container absolute top-1/2 left-1/2 origin-center transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] svelte-jw6f5"><div class="stitch-grid-pattern artisan-checker-small relative h-full w-full shadow-[0_10px_40px_rgba(0,0,0,0.06)] ring-1 ring-black/5" role="grid" tabindex="0"><!> <!> <!> <svg class="pointer-events-none absolute inset-0 z-[20] h-full w-full overflow-visible" preserveAspectRatio="none"><!></svg> <!></div></div></div>');function rn(l,e){q(e,!0);let t=P(null),i=X(()=>r.linen.width),s=X(()=>r.linen.height),a=X(()=>`calc(100% * ${d(i)} / (${d(i)} + 2))`),n=X(()=>`calc(100% * ${d(s)} / (${d(s)} + 2))`),o=X(()=>{if(!r.studio.showGhostThreads)return[];const T=r.project.activeFrameIndex,E=[];return T>0&&E.push({stitches:r.project.frames[T-1].compositeStitches,opacity:.3}),T>1&&E.push({stitches:r.project.frames[T-2].compositeStitches,opacity:.1}),E});Ie(()=>{d(t)});let c=X(()=>$e.isSnappedState),h=X(()=>r.linen.strokePoints.map(T=>`${T.x},${T.y}`).join(" "));var f=an();Ae("pointermove",Zt,T=>d(t)&&$e.handleMove(T,d(t))),Ae("pointerup",Zt,()=>$e.handleEnd());var g=v(f),x=v(g);x.__contextmenu=T=>T.preventDefault(),x.__pointerdown=T=>d(t)&&$e.handleStart(T,d(t));var m=v(x);$r(m,{});var A=p(m,2);{var k=T=>{var E=Le(),w=re(E);de(w,17,()=>d(o),ve,(V,D)=>{tn(V,{get stitches(){return d(D).stitches},get width(){return d(i)},get height(){return d(s)},get opacity(){return d(D).opacity}})}),C(T,E)};U(A,T=>{r.studio.showGhostThreads&&T(k)})}var b=p(A,2);de(b,17,()=>r.linen.compositeStitches,ve,(T,E,w)=>{const V=X(()=>w%d(i)),D=X(()=>Math.floor(w/d(i)));Kr(T,{get color(){return d(E)},get x(){return d(V)},get y(){return d(D)},get activeX(){return r.needle.pos.x},get activeY(){return r.needle.pos.y}})});var y=p(b,2),S=v(y);{var M=T=>{var E=sn();O(()=>{j(E,"points",d(h)),j(E,"stroke",r.paletteState.activeDye),j(E,"stroke-width",d(c)?"0.08":"0.03"),j(E,"stroke-dasharray",d(c)?"none":"0.1 0.1"),z(E,0,`${d(c)?"drop-shadow-md":"marching-ants"} transition-all duration-300`,"svelte-jw6f5"),J(E,`opacity: ${d(c)?"1":"0.4"}`)}),C(T,E)};U(S,T=>{r.linen.strokePoints.length>1&&T(M)})}u(y);var I=p(y,2);Wr(I,{}),u(x),hi(x,T=>_(t,T),()=>d(t)),u(g),u(f),O(()=>{J(g,`
			transform: ${r.cameraTransform??""};
			aspect-ratio: ${d(i)??""} / ${d(s)??""};
			width: min(${d(a)??""}, calc(${d(n)??""} * (${d(i)??""} / ${d(s)??""})));
		`),J(x,`
				display: grid;
				grid-template-columns: repeat(${d(i)??""}, 1fr); 
				grid-template-rows: repeat(${d(s)??""}, 1fr);
				--grid-cols: ${d(i)??""}; 
				--grid-rows: ${d(s)??""}; 
				background-color: ${r.studio.canvasBgColor??""};
				touch-action: none;
			`),j(y,"viewBox",`0 0 ${d(i)??""} ${d(s)??""}`)}),C(l,f),Y()}ue(["contextmenu","pointerdown"]);class nn{#e=P(!0);get isEnabled(){return d(this.#e)}set isEnabled(e){_(this.#e,e,!0)}#t=P(!1);get screenShake(){return d(this.#t)}set screenShake(e){_(this.#t,e,!0)}#i=P(null);get flashColor(){return d(this.#i)}set flashColor(e){_(this.#i,e,!0)}emit(e){this.isEnabled&&(this.playAudio(e),this.triggerVisual(e),typeof navigator.vibrate=="function"&&this.triggerHaptic(e))}playAudio(e){switch(e){case"STITCH":$.playStitch();break;case"UNSTITCH":$.playUnstitch();break;case"MOVE":$.playMove();break;case"STARTUP":$.playStartup();break;case"READY":$.playReady();break}}triggerVisual(e){e==="CLEAR_LINEN"&&(this.screenShake=!0,setTimeout(()=>this.screenShake=!1,200)),e==="READY"&&(this.flashColor="rgba(211, 54, 130, 0.1)",setTimeout(()=>this.flashColor=null,500))}triggerHaptic(e){e==="STITCH"&&navigator.vibrate(5),e==="UNSTITCH"&&navigator.vibrate(10)}}const ri=new nn;function yi(l){return--l*l*l*l*l+1}const on="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAveSURBVHgB7dzLb5z3dcfh886FHHEoizQpyQpl6+K6jRdB3KIN4nhhKksnRf0f2AYSZ5l2V8GLCAicdNdd0SaLchcU6MJABKMtEIgqml6QLGTErlzUUVibimXZskSJpMjhXMoRsrWi3wEZjcTnAQhv3q8lUdR8yFmcCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAdOFTyQvjf3tT+vqurPYsRs/54u/OUHP/6LYOT81eN/+teDweCZGDH9iPOvLZ89EzxwGsGDavhCMB8jZvsFKhhNv4nHfIyYWlUtBQ+kWgBAgoAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQ4pjgCvj/3wstR1f6+ZPPM1Mk4OjEbu639hSeKnr/66cdx7mfnizZRVQunP/jxK8E9+97c1xaqqnqpZHPqT56PQ48eLJnEvi/OFT1fb7ei9eThos27//qz+MkPflS06Q/6r7x2+c2F4L7yEwgAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDSCHbUman5qfrk5DMlm321sS9ONMZLJrGvXvZ8Vm9to+j5RncQB6fL7i3Va7Wp7w6+Pl+yaXS7S6ev/NNSPAQyXzNT7QPHxsbGSiYx1mxGqf7qZpTqrRZ+zdTq8bmnnyzaxGBw/LtV2ddMb3X1wpkbizeCHSMgO2z4QrD9ST1XsplpPXLnOOIo2rh0tej5ifZ4fPVLzxdtfnX5/168cu2jF0s2/XpteHxxIR4C4+2J4Z+96JjmH5x4Kk7MHY/dtvnLT4qer7XLv7F5/NgT8Xuv/VHR5ic/+NF3Gu9e+k7JpjE5eSpuxGKwY7yFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApLiF9Vu8PvfCyyXPHxp75FirXnbkbnbskXhY9Dvd6F5fK9q0+rU4/rnjJZNYWV15/vV4IR4G0wdmnj8weaBo097XjlE02OpG79P1ok0Mqqi3V4smR04ej1Lvv/2/L74+eOF4yea1y28uBJ+pCu7q+0e/Pih5fmY7Bs/Ofj64d43pdowfnSna/Ncvfh5Lv16Kh8GJ7Xh+6Qt/HHtVfXoixp6YLtqMPz6z/XUzWbR54/W/icsX3yvanF4+6zXyLryFBUCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApDimyH3XW9uMzeVrRZtjU4fj0KMHizbv/PKdWLtdeOiv0NT+qfj9Y08Vbdr7JgIeRALCfTcYXvDd/igxe3TmzhHGEsPji7sdkGajGSfmjgXsBd7CAiBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUtzC2mEbvc1YuvlR0abdbMXBfQeCe7d17VZ0r68WbZ5uHoknZ2aLNq2Th4qebzabAXuFgOyw3qAfa92Nok2zXg/K9G93otT+eiti+FGgXXjxF/YSb2EBkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApbmHBXaz94v2i5+vt8WidPBywF/gJBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASHELawT0B4NY724UbZpVI5p1f327rd5uFT1fjdWjt1b2d1nVa1FrjQX3btDpRW+17PM86PWDneUVaATc7Kzf+Sgx156JqfpksLtaJw8VPT+Mx8alq0WbxnQ7xo/OBPeu89GNKNXf6AQ7y1tYAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAiltYv01VLZQ8vtHfOv5hZ2W+ZNOqNWO6MVEyibXuZpTaPzYR9cr3DCW619eKnu93usHuu/L+cqyu3Cza1Gu1N7b/PZcf0eIzVcGO+sbsl+drUT9XsjkydiCenjgSu+3EI4djolF2XZbdt9ePKdanJ2Lsiemizb+9+S/x3tsXo9Cp08tnF4Md49tRAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgRUAASBEQAFIEBIAUAQEgxTHFHdbtti40m51XSjar3c35i+sfvlSyeWzsQPEBxqvrK9GsrxZt5tqzwb2rtcaiObu/aDM8wLi5fK1oM7yfVW8/HHfNrnywHO+/8/OizfWPry3EoH++aNTrLwU7SkB22MKNxeG1z4WSzTcPfiVudTaKAjJVGI+hte7GduGKJgJSqKpXd17cSwwv/m5eXSna3IlH2S8zslZXbsV7b/930aa/HY/XLr+5ENxX3sICIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABS3MIaAfWt/mK30ThVsrmydfPbVzorL5Zsntp3OCbr4yWTWLr5UdHzrUYzHpt4NPaq/sZWbFwq+5xVY41onTxUtBkebRxF12/diAvvvlW02ehsDo8ininZbK2tXwjuOwEZAX974z+Xtv+zVLJ5debZl6Mq+wFya9CLUncOMHLPBr1+9NY2izaN7YA8LJd1t7a24uqnHxdtoqp+dXr57GLwwPEWFgApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkFIFe8a3Zp87N4iYL9l8derzsdumxtsx156Nh0G9PR6tk4eLNt3ra7G5fK1oM350JhrT7dht//DP/xiFFk8vny06DMqDy08gAKQICAApAgJAioAAkCIgAKQICAApAgJAioAAkCIgAKQICAApAgJASiPYM/qDwVu1quz82fXu+nzJ842qHvvr4yWT4e8r1rsbRZtm1YhmffS+fAe9fvTWyv4s/U436u1WlCr9dW521mNr0ItCiyUPV1V1IdgzHFPkrl6dfW5Q8vx0YyL+cPKJ2G1z7ZmYGp+Mh8HwKOLwOGKJ4fHF4RHGEv9x7WJc27wVJU4vn/UawWfyFhYAKQICQIqAAJAiIACkCAgAKQICQIqAAJAiIACkCAgAKQICQIqAAJDimCJ3VQ1ioeT5zqB7/MPOynzJplVr3rmhVWKtuxml9o9NRL0ave+ZBp1u8V2rT1avx+r6zaJNLao3oqpuBOwQh9LYUd+Y/fJ8LernSjZHxg7E0xNHYredeORwTDTKr96Oogs3LsXy+idR6NTp5bOLATvEW1gApAgIACkCAkCKgACQIiAApAgIACkCAkCKgACQIiAApAgIACkCAkCKY4rsqG63daHZ7LxSslntbs5fXP/wpZLNY2MHig8wXl1fiWZ9tWgz156N3Xb59qdx8davizab/c5CDPrni0a9/lLADhIQdtTCjcXhtdeFks03D34lbnU2igIyVRiPobXuxnbhiia/k4Dc7N6Oi6uXizaDweD8D6/9+0LAfeQtLABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIMUtLO67+lZ/sdtonCrZXNm6+e0rnZUXY5f9z8bV2G23e5vn+1GdKdlM9poXAu6zKuAB9OrMswtR1YoOMI6qahALf3ftp0UXjGEUeAsLgBQBASBFQABIERAAUgQEgBQBASBFQABIERAAUgQEgBQBASBFQABIcQuLPeNbs8+dG0TMxy7a/v8v/vCTnxYdhoQHlZ9AAEgREABSBASAFAEBIEVAAEgREABSBASAFAEBIEVAAEgREABSBASAlEbAHtEfDN6qVbt+/u1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKPq/wHHEEo6B7wOjAAAAABJRU5ErkJggg==";var ln=L(`<div class="fixed inset-0 z-[2000] flex flex-col items-center justify-center bg-canvas-bg" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');" role="dialog" aria-modal="true"><div class="absolute h-[500px] w-[500px] animate-pulse rounded-full bg-brand/5 blur-[120px]" aria-hidden="true"></div> <div class="relative flex flex-col items-center gap-2"><div class="mb-8 flex animate-bounce items-center justify-center"><img alt="Rupa Artisan Icon" class="h-32 w-auto drop-shadow-2xl transition-transform duration-[3s] ease-in-out"/></div> <div><!></div></div> <div class="absolute bottom-24 flex flex-col items-center gap-8"><div class="flex flex-col items-center gap-4"><div class="h-1.5 w-64 overflow-hidden rounded-full bg-studio-text/5 ring-1 ring-studio-text/10" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div></div></div> <div class="flex flex-col items-center gap-1 text-center"><span class="h-4 font-serif text-[12px] text-studio-text/60 italic"> </span> <span class="font-mono text-[9px] font-bold tracking-widest text-studio-text/20 uppercase"> </span></div></div></div></div>`);function cn(l,e){q(e,!0);let t=P(!0),i=P(0),s=P(0),a=P(!1);const n=5;function o(){ri.emit("READY"),_(t,!1),setTimeout(()=>{r.isAppReady=!0,r.showArtisanCodex=!0},800)}Je(()=>{ri.emit("STARTUP");const g=setInterval(()=>{if(d(i)<100){const x=Math.random()*15;_(i,Math.min(100,d(i)+x),!0),_(s,Math.min(n-1,Math.floor(d(i)/100*n)),!0)}else clearInterval(g),setTimeout(()=>{_(a,!0),o()},600)},400);return()=>{clearInterval(g)}});var c=Le(),h=re(c);{var f=g=>{var x=ln();j(x,"aria-label",__({key:"codex.title"}));var m=p(v(x),2),A=v(m),k=v(A);J(k,`transform: scale(${1+Math.sin(Date.now()/1e3)*.05});`),u(A);var b=p(A,2),y=v(b);mi(y,{size:"lg"}),u(b),u(m);var S=p(m,2),M=v(S),I=v(M),T=v(I);u(I);var E=p(I,2),w=v(E),V=v(w,!0);u(w);var D=p(w,2),N=v(D,!0);u(D),u(E),u(M),u(S),u(x),O((B,H)=>{j(x,"aria-busy",!d(a)),j(k,"src",on),j(I,"aria-valuenow",d(i)),z(T,1,`h-full bg-brand/60 transition-all duration-500 ease-out ${d(a)?"opacity-0":""}`),J(T,`width: ${d(i)??""}%`),G(V,B),G(N,H)},[()=>d(a)?__({key:"common:splash.welcome"}):__({key:`common:splash.phases.${d(s)}`}),()=>__({key:"common:splash.version",replace:{version:r.version}})]),ne(1,A,()=>pt,()=>({duration:1500,start:.9,easing:yi})),ne(1,b,()=>_i,()=>({y:20,duration:1e3,delay:400})),ne(2,x,()=>Pe,()=>({duration:1e3})),C(g,x)};U(h,g=>{d(t)&&g(f)})}C(l,c),Y()}var dn=L('<div class="flex flex-col gap-2"><div class="flex justify-between font-serif text-[10px] font-bold tracking-wider uppercase opacity-40"><span> </span> <span> </span></div> <input type="range"/></div>');function lt(l,e){q(e,!0);let t=te(e,"value",15),i=te(e,"min",3,0),s=te(e,"step",3,1),a=te(e,"unit",3,""),n=te(e,"isHue",3,!1);var o=dn(),c=v(o),h=v(c),f=v(h,!0);u(h);var g=p(h,2),x=v(g);u(g),u(c);var m=p(c,2);ge(m);let A;u(o),O(k=>{G(f,e.label),G(x,`${k??""}${a()??""}`),j(m,"min",i()),j(m,"max",e.max),j(m,"step",s()),A=z(m,1,"custom-slider svelte-7qe4gg",null,A,{"hue-slider":n()})},[()=>s()<1?t().toFixed(2):Math.round(t())]),xe(m,t),C(l,o),Y()}var un=L('<div class="fixed inset-0 z-[1300] flex items-center justify-center bg-black/20 backdrop-blur-sm" role="presentation"><div class="flex w-[400px] flex-col gap-8 rounded-xl border-8 border-white bg-canvas-bg p-10 shadow-2xl" role="dialog" aria-labelledby="dye-basin-title" aria-modal="true"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><span class="text-3xl" aria-hidden="true">â²</span> <div class="flex flex-col"><h2 id="dye-basin-title" class="font-tiny5 text-3xl leading-none text-brand"></h2> <span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/40 uppercase"></span></div></div> <div class="artisan-checker-small h-12 w-12 rounded-xl border-2 border-white shadow-inner" aria-label="Color Preview"></div></div> <div class="flex flex-col gap-6"><!> <!> <!> <!></div> <div class="flex flex-col gap-4"><div class="flex items-center gap-4 rounded-xl border border-black/5 bg-white/50 p-4"><label for="hex-input" class="font-mono text-xs font-bold text-studio-text/40"></label> <input id="hex-input" type="text" class="w-full bg-transparent font-mono text-lg font-bold text-studio-text uppercase focus:outline-none"/></div> <div class="flex gap-3"><button class="artisan-secondary-btn flex h-14 w-14 items-center justify-center p-0 text-xl"><span aria-hidden="true">ð</span></button> <button class="artisan-primary-btn flex-1 py-4"></button></div></div></div></div>');function Nt(l,e){q(e,!0);let t=te(e,"value",15),i=P(0),s=P(0),a=P(0),n=P(1);Ie(()=>{const B=vt.unravel(t());Ge(()=>{_(i,B.h,!0),_(s,B.s,!0),_(a,B.l,!0),_(n,B.a,!0)})}),Ie(()=>{const B=vt.spin({h:d(i),s:d(s),l:d(a),a:d(n)});Ge(()=>{t(B)})}),Ie(()=>(Ge(()=>r.pushEscapeAction(e.onClose)),()=>r.popEscapeAction(e.onClose)));var o=un();o.__mousedown=B=>B.target===B.currentTarget&&e.onClose();var c=v(o),h=v(c),f=v(h),g=p(v(f),2),x=v(g);x.textContent=__({key:"dye_basin.title"});var m=p(x,2);m.textContent=__({key:"dye_basin.subtitle"}),u(g),u(f);var A=p(f,2);u(h);var k=p(h,2),b=v(k);lt(b,{label:__({key:"dye_basin.sliders.hue"}),max:360,unit:"Â°",isHue:!0,get value(){return d(i)},set value(B){_(i,B,!0)}});var y=p(b,2);lt(y,{label:__({key:"dye_basin.sliders.saturation"}),max:100,unit:"%",get value(){return d(s)},set value(B){_(s,B,!0)}});var S=p(y,2);lt(S,{label:__({key:"dye_basin.sliders.lightness"}),max:100,unit:"%",get value(){return d(a)},set value(B){_(a,B,!0)}});var M=p(S,2);lt(M,{label:__({key:"dye_basin.sliders.alpha"}),min:0,max:1,step:.01,unit:"",get value(){return d(n)},set value(B){_(n,B,!0)}}),u(k);var I=p(k,2),T=v(I),E=v(T);E.textContent=__({key:"dye_basin.hex_label"});var w=p(E,2);ge(w),u(T);var V=p(T,2),D=v(V);D.__click=()=>{F.pickDye(),e.onClose()},j(D,"title",__({key:"dye_basin.eye_drop"})),j(D,"aria-label",__({key:"dye_basin.eye_drop"}));var N=p(D,2);N.__click=function(...B){e.onClose?.apply(this,B)},N.textContent=__({key:"dye_basin.seal"}),u(V),u(I),u(c),u(o),O(()=>J(A,`background-color: ${t()??""};`)),xe(w,t),ne(1,c,()=>pt,()=>({duration:200,start:.95})),ne(2,c,()=>pt,()=>({duration:150,start:1,opacity:0})),ne(3,o,()=>Pe,()=>({duration:150})),C(l,o),Y()}ue(["mousedown","click"]);var hn=L("<span> </span>"),vn=L('<button><span class="font-serif text-sm font-bold tracking-tight"> </span> <!></button>');function pn(l,e){q(e,!0);var t=vn();t.__click=()=>{e.action.action(),e.onSelect()};var i=v(t),s=v(i,!0);u(i);var a=p(i,2);{var n=o=>{var c=hn(),h=v(c,!0);u(c),O(()=>{z(c,1,`font-mono text-[10px] font-bold uppercase ${e.isSelected?"text-white/60":"opacity-20"}`),G(h,e.action.shortcut)}),C(o,c)};U(a,o=>{e.action.shortcut&&o(n)})}u(t),O(()=>{z(t,1,`artisan-action-btn flex items-center justify-between rounded-xl px-6 py-4 transition-all ${e.isSelected?"active bg-brand text-white shadow-lg":"hover:bg-black/5"}`),G(s,e.action.label)}),Ae("mouseenter",t,function(...o){e.onSelect?.apply(this,o)}),C(l,t),Y()}ue(["click"]);var fn=L('<div class="p-8 text-center font-serif text-sm text-studio-text/40 italic"> </div>'),gn=L('<div class="flex flex-col gap-1"></div>'),xn=L('<div class="fixed inset-0 z-[1200] flex items-start justify-center bg-black/10 pt-[15vh] backdrop-blur-sm" role="presentation"><div class="flex w-[600px] flex-col overflow-hidden rounded-xl border border-black/5 bg-canvas-bg/95 shadow-2xl" role="dialog" aria-labelledby="catalog-title" aria-modal="true"><div class="relative flex items-center border-b border-black/5 bg-white/40 p-6"><span class="mr-4 text-2xl opacity-40" aria-hidden="true">ð</span> <h2 id="catalog-title" class="sr-only"></h2> <input id="catalog-search" type="text" class="w-full bg-transparent font-serif text-xl text-studio-text focus:outline-none"/></div> <div class="custom-scrollbar max-h-[50vh] overflow-y-auto p-4 svelte-1fnfmu0" role="list"><!></div> <div class="flex items-center justify-between border-t border-black/5 bg-black/5 px-8 py-4"><span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"></span> <span class="font-serif text-[9px] font-bold tracking-[0.2em] text-studio-text/30 uppercase"> </span></div></div></div>');function bn(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.studio.showPatternCatalog=!1),i=P(""),s=P(0);const n=Te.getActions().map(E=>({...E,id:E.intent.toLowerCase().replace(/_/g,"-"),action:()=>{jt(async()=>{const{loom:w}=await Promise.resolve().then(()=>_a);return{loom:w}},void 0,import.meta.url).then(({loom:w})=>{w.handleIntent(E.intent)})}}));let o=X(()=>n.filter(E=>E.label.toLowerCase().includes(d(i).toLowerCase())));Ie(()=>{d(i),_(s,0)}),Ie(()=>{d(s),d(o);const E=document.querySelector(".artisan-action-btn.active");E&&E.scrollIntoView({block:"nearest"})});function c(E){E.key==="ArrowDown"?(E.preventDefault(),_(s,(d(s)+1)%d(o).length)):E.key==="ArrowUp"?(E.preventDefault(),_(s,(d(s)-1+d(o).length)%d(o).length)):E.key==="Enter"?(E.preventDefault(),d(o)[d(s)]&&(d(o)[d(s)].action(),t()())):E.key==="Escape"&&t()()}Je(()=>document.getElementById("catalog-search")?.focus()),Ie(()=>(Ge(()=>r.studio.pushEscapeAction(t())),()=>r.studio.popEscapeAction(t())));var h=xn();h.__mousedown=E=>E.target===E.currentTarget&&t()(),h.__keydown=c;var f=v(h),g=v(f),x=p(v(g),2);x.textContent=__({key:"hud.basin.catalog_title"});var m=p(x,2);ge(m),j(m,"placeholder",__({key:"hud.basin.catalog_search"})),u(g);var A=p(g,2),k=v(A);{var b=E=>{var w=fn(),V=v(w,!0);u(w),O(D=>G(V,D),[()=>__({key:"hud.basin.catalog_no_results",replace:{query:d(i)}})]),C(E,w)},y=E=>{var w=gn();de(w,21,()=>d(o),ve,(V,D,N)=>{{let B=X(()=>d(s)===N);pn(V,{get action(){return d(D)},get isSelected(){return d(B)},onSelect:()=>_(s,N,!0)})}}),u(w),C(E,w)};U(k,E=>{d(o).length===0?E(b):E(y,!1)})}u(A);var S=p(A,2),M=v(S);M.textContent=__({key:"hud.basin.catalog_footer"});var I=p(M,2),T=v(I,!0);u(I),u(S),u(f),u(h),O(E=>G(T,E),[()=>__({key:"hud.basin.catalog_count",replace:{count:d(o).length}})]),xe(m,()=>d(i),E=>_(i,E)),ne(3,f,()=>pt,()=>({duration:150,start:.98})),C(l,h),Y()}ue(["mousedown","keydown"]);var mn=L('<span class="text-3xl"> </span>'),_n=L('<span class="mt-1 font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-30"> </span>'),yn=L('<div class="fixed inset-0 z-[1100] flex items-center justify-center bg-black/25 backdrop-blur-md"><div class="flex flex-col gap-8 overflow-hidden rounded-xl border-8 border-white bg-[#fdf6e3] p-10 shadow-2xl ring-1 ring-black/5"><div class="flex items-center justify-between border-b border-studio-text/5 pb-6"><div class="flex items-center gap-4"><!> <div class="flex flex-col"><h2 class="font-tiny5 text-3xl leading-none text-brand"> </h2> <!></div></div> <button class="rounded-xl border border-black/5 bg-white/50 px-4 py-2 text-[10px] font-bold tracking-widest uppercase opacity-40 transition-all hover:opacity-100">Close</button></div> <div><!></div></div></div>');function Ue(l,e){q(e,!0);let t=te(e,"title",3,""),i=te(e,"subtitle",3,""),s=te(e,"icon",3,""),a=te(e,"width",3,"500px"),n=te(e,"maxHeight",3,"85vh"),o=te(e,"scrollable",3,!0);function c(w,{duration:V=600}){return{duration:V,css:D=>{const N=yi(D);return`
					opacity: ${D};
					transform: scaleX(${.9+N*.1}) scaleY(${.4+N*.6});
					clip-path: inset(0 ${(1-N)*50}% 0 ${(1-N)*50}%);
				`}}}Ie(()=>(Ge(()=>{r.pushEscapeAction(e.onClose)}),()=>r.popEscapeAction(e.onClose)));var h=yn();h.__mousedown=w=>{w.stopPropagation(),w.target===w.currentTarget&&e.onClose()};var f=v(h);f.__mousedown=w=>w.stopPropagation();var g=v(f),x=v(g),m=v(x);{var A=w=>{var V=mn(),D=v(V,!0);u(V),O(()=>G(D,s())),C(w,V)};U(m,w=>{s()&&w(A)})}var k=p(m,2),b=v(k),y=v(b,!0);u(b);var S=p(b,2);{var M=w=>{var V=_n(),D=v(V,!0);u(V),O(()=>G(D,i())),C(w,V)};U(S,w=>{i()&&w(M)})}u(k),u(x);var I=p(x,2);I.__click=function(...w){e.onClose?.apply(this,w)},u(g);var T=p(g,2),E=v(T);vs(E,()=>e.children),u(T),u(f),u(h),O(()=>{J(f,`width: ${a()??""}; max-height: ${n()??""};`),G(y,t()),z(T,1,`custom-scrollbar flex-1 ${o()?"overflow-y-auto pr-2":"flex flex-col overflow-hidden"}`,"svelte-32v57s")}),ne(1,f,()=>c,()=>({duration:500})),ne(2,f,()=>Pe,()=>({duration:150})),ne(3,h,()=>Pe,()=>({duration:200})),C(l,h),Y()}ue(["mousedown","click"]);var An=L('<div class="flex flex-col items-center gap-3"><div class="artisan-checker-small flex items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white/10 p-2 shadow-inner"><canvas class="rounded-sm shadow-sm"></canvas></div> <div class="flex flex-col items-center gap-1 text-center"><span class="font-tiny5 text-[10px] tracking-widest text-brand uppercase"> </span> <span class="font-mono text-[8px] font-bold tracking-tighter opacity-30"> </span></div></div>');function wn(l,e){q(e,!0);let t=P(null);Ie(()=>{if(!d(t))return;const g=d(t).getContext("2d");if(!g)return;const x=r.linen.width,m=r.linen.height,A=r.linen.compositeStitches,k=400,b=Math.min(k/x,k/m);d(t).width=x*b,d(t).height=m*b,g.imageSmoothingEnabled=!1,e.bgColor==="transparent"?g.clearRect(0,0,d(t).width,d(t).height):(g.fillStyle=e.bgColor,g.fillRect(0,0,d(t).width,d(t).height)),A.forEach((y,S)=>{if(y===null)return;const M=S%x,I=Math.floor(S/x);g.fillStyle=y,g.fillRect(Math.floor(M*b),Math.floor(I*b),Math.ceil(b),Math.ceil(b))})});var i=An(),s=v(i),a=v(s);hi(a,g=>_(t,g),()=>d(t)),u(s);var n=p(s,2),o=v(n),c=v(o);u(o);var h=p(o,2),f=v(h);u(h),u(n),u(i),O((g,x)=>{G(c,`${e.format??""} Artifact`),G(f,`${g??""} Ã ${x??""} pixels`)},[()=>Math.round(r.linen.width*e.scale),()=>Math.round(r.linen.height*e.scale)]),C(l,i),Y()}var kn=L('<span class="font-serif text-[9px] font-bold text-brand italic opacity-60"></span>'),Sn=L('<div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="fps-input" type="number" min="1" max="60" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div>',1),Cn=L('<button class="flex items-center gap-2 font-serif text-[10px] font-bold tracking-widest text-brand uppercase opacity-60 hover:opacity-100"><span aria-hidden="true">ð¨</span> </button>'),En=L('<div class="flex h-[550px] items-start gap-12 overflow-hidden"><div class="flex aspect-square w-[420px] shrink-0 items-center justify-center rounded-2xl bg-black/5 p-6 ring-1 ring-black/5" role="img" aria-label="Artifact Preview"><!></div> <div class="custom-scrollbar flex h-full flex-1 flex-col gap-8 overflow-y-auto pr-4" role="group" aria-label="Export Settings"><div class="flex flex-col gap-3"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"></span> <div class="grid grid-cols-2 gap-3" role="radiogroup" aria-label="Static Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">ð¼ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð¸ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð·</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button></div></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] text-studio-text/30 uppercase" aria-hidden="true"></span> <!></div> <div role="radiogroup" aria-label="Kinetic Formats"><button role="radio"><span class="text-2xl" aria-hidden="true">ð¬</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð½ï¸</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button> <button role="radio"><span class="text-2xl" aria-hidden="true">ð</span> <div class="text-center"><h3 class="font-serif text-[10px] font-bold tracking-tight uppercase"></h3></div></button></div></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="scale-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="scale-input" type="number" min="1" max="100" class="w-24 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:outline-none"/></div> <!> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></span> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <div class="flex flex-wrap items-center gap-3" role="radiogroup" aria-label="Background Type"><button style="background: repeating-conic-gradient(#eee8d5 0% 25%, #fff 0% 50%) 50% / 10px 10px;" title="Transparent" role="radio"></button> <button title="Studio Cream" role="radio"></button> <button title="Deep Black" role="radio"></button> <div class="flex items-center gap-2"><button title="Custom Backdrop" role="radio"></button></div></div> <!></div></div> <button class="artisan-primary-btn w-full py-5 text-xl"></button></div></div>'),Tn=L("<!> <!>",1);function In(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.showArtifactCrate=!1),i=P("png"),s=P(!1),a=P(pe(r.studio.canvasBgColor));Je(()=>{r.studio.canvasBgColor!=="#eee8d5"&&(r.studio.exportBgColor=r.studio.canvasBgColor,_(a,r.studio.canvasBgColor,!0))}),Ie(()=>{r.studio.exportBgColor!=="transparent"&&r.studio.exportBgColor!=="#eee8d5"&&r.studio.exportBgColor!=="#000000"&&(r.studio.exportBgColor=d(a))}),Ie(()=>{const f=["webm","gif","mp4"].includes(d(i))||d(i)==="svg"&&r.project.frames.length>1;r.project.frames.length<=1&&f&&_(i,"png")});var n=Tn(),o=re(n);{var c=f=>{Nt(f,{onClose:()=>_(s,!1),get value(){return d(a)},set value(g){_(a,g,!0)}})};U(o,f=>{d(s)&&f(c)})}var h=p(o,2);Ue(h,{title:__({key:"artifact.title"}),subtitle:__({key:"artifact.subtitle"}),icon:"ð§º",get onClose(){return t()},width:"1000px",scrollable:!1,children:(f,g)=>{var x=En(),m=v(x),A=v(m);wn(A,{get format(){return d(i)},get scale(){return r.studio.exportScale},get bgColor(){return r.studio.exportBgColor}}),u(m);var k=p(m,2),b=v(k),y=v(b);y.textContent=__({key:"artifact.static_title"});var S=p(y,2),M=v(S);M.__click=()=>_(i,"png");var I=p(v(M),2),T=v(I);T.textContent=__({key:"artifact.formats.png"}),u(I),u(M);var E=p(M,2);E.__click=()=>_(i,"webp");var w=p(v(E),2),V=v(w);V.textContent=__({key:"artifact.formats.webp"}),u(w),u(E);var D=p(E,2);D.__click=()=>_(i,"jpg");var N=p(v(D),2),B=v(N);B.textContent=__({key:"artifact.formats.jpg"}),u(N),u(D);var H=p(D,2);H.__click=()=>_(i,"svg");var oe=p(v(H),2),Q=v(oe);Q.textContent=__({key:"artifact.formats.svg_static"}),u(oe),u(H),u(S),u(b);var ie=p(b,2),me=v(ie),R=v(me);R.textContent=__({key:"artifact.kinetic_title"});var le=p(R,2);{var _e=Se=>{var Fe=kn();Fe.textContent=__({key:"artifact.requires_frames"}),C(Se,Fe)};U(le,Se=>{r.project.frames.length<=1&&Se(_e)})}u(me);var ce=p(me,2),he=v(ce);he.__click=()=>_(i,"webm");var ke=p(v(he),2),W=v(ke);W.textContent=__({key:"artifact.formats.webm"}),u(ke),u(he);var se=p(he,2);se.__click=()=>_(i,"gif");var Me=p(v(se),2),Ve=v(Me);Ve.textContent=__({key:"artifact.formats.gif"}),u(Me),u(se);var ye=p(se,2);ye.__click=()=>_(i,"mp4");var ee=p(v(ye),2),Ce=v(ee);Ce.textContent=__({key:"artifact.formats.mp4"}),u(ee),u(ye);var ae=p(ye,2);ae.__click=()=>_(i,"svg");var He=p(v(ae),2),tt=v(He);tt.textContent=__({key:"artifact.formats.svg_kinetic"}),u(He),u(ae),u(ce),u(ie);var Ke=p(ie,2),xt=v(Ke),bt=v(xt),Rt=v(bt);Rt.textContent=__({key:"artifact.scale_label"});var Ai=p(Rt,2);Ai.textContent=__({key:"artifact.scale_desc"}),u(bt);var $t=p(bt,2);ge($t),u(xt);var Gt=p(xt,2);{var wi=Se=>{var Fe=Sn(),nt=p(re(Fe),2),yt=v(nt),qt=v(yt);qt.textContent=__({key:"artifact.fps_label"});var Ei=p(qt,2);Ei.textContent=__({key:"artifact.fps_desc"}),u(yt);var Yt=p(yt,2);ge(Yt),u(nt),xe(Yt,()=>r.studio.fps,Ti=>r.studio.fps=Ti),C(Se,Fe)};U(Gt,Se=>{(d(i)==="webm"||d(i)==="gif"||d(i)==="mp4"||d(i)==="svg"&&r.project.frames.length>1)&&Se(wi)})}var Ut=p(Gt,4),mt=v(Ut),Ht=v(mt);Ht.textContent=__({key:"artifact.bg_label"});var ki=p(Ht,2);ki.textContent=__({key:"artifact.bg_desc"}),u(mt);var _t=p(mt,2),it=v(_t);it.__click=()=>r.studio.exportBgColor="transparent";var st=p(it,2);st.__click=()=>r.studio.exportBgColor="#eee8d5";var at=p(st,2);at.__click=()=>r.studio.exportBgColor="#000000";var zt=p(at,2),rt=v(zt);rt.__click=()=>{_(a,d(a),!0),r.studio.exportBgColor=d(a),_(s,!0)},u(zt),u(_t);var Si=p(_t,2);{var Ci=Se=>{var Fe=Cn();Fe.__click=()=>{_(a,r.studio.canvasBgColor,!0),r.studio.exportBgColor=d(a)};var nt=p(v(Fe));nt.nodeValue=` ${__({key:"artifact.match_linen"})??""}`,u(Fe),C(Se,Fe)};U(Si,Se=>{r.studio.canvasBgColor!=="#eee8d5"&&Se(Ci)})}u(Ut),u(Ke);var Kt=p(Ke,2);Kt.__click=()=>e.onExport(d(i),r.studio.exportScale,r.studio.exportBgColor),Kt.textContent=__({key:"artifact.export_action"}),u(k),u(x),O(()=>{z(M,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="png"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),j(M,"aria-checked",d(i)==="png"),z(E,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="webp"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),j(E,"aria-checked",d(i)==="webp"),z(D,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="jpg"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),j(D,"aria-checked",d(i)==="jpg"),z(H,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="svg"&&r.project.frames.length<=1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"}`),j(H,"aria-checked",d(i)==="svg"&&r.project.frames.length<=1),z(ce,1,`grid grid-cols-2 gap-3 ${r.project.frames.length<=1?"opacity-40":""}`),z(he,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="webm"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),he.disabled=r.project.frames.length<=1,j(he,"aria-checked",d(i)==="webm"),z(se,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="gif"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),se.disabled=r.project.frames.length<=1,j(se,"aria-checked",d(i)==="gif"),z(ye,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="mp4"?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),ye.disabled=r.project.frames.length<=1,j(ye,"aria-checked",d(i)==="mp4"),z(ae,1,`flex flex-col items-center gap-3 rounded-xl border-2 p-4 transition-all ${d(i)==="svg"&&r.project.frames.length>1?"border-brand bg-brand/5":"border-black/5 bg-white/40 opacity-40 hover:opacity-100"} ${r.project.frames.length<=1?"pointer-events-none opacity-20":""}`),ae.disabled=r.project.frames.length<=1,j(ae,"aria-checked",d(i)==="svg"&&r.project.frames.length>1),z(it,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="transparent"?"border-brand":"border-black/5"}`),j(it,"aria-checked",r.studio.exportBgColor==="transparent"),z(st,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#eee8d5"?"border-brand":"border-black/5"} bg-[#eee8d5]`),j(st,"aria-checked",r.studio.exportBgColor==="#eee8d5"),z(at,1,`h-10 w-10 rounded-xl border-2 ${r.studio.exportBgColor==="#000000"?"border-brand":"border-black/5"} bg-black`),j(at,"aria-checked",r.studio.exportBgColor==="#000000"),z(rt,1,`h-10 w-16 rounded-xl border-2 ${r.studio.exportBgColor===d(a)?"border-brand":"border-black/5"} artisan-checker-small transition-transform hover:scale-105`),J(rt,`background-color: ${d(a)??""};`),j(rt,"aria-checked",r.studio.exportBgColor===d(a))}),xe($t,()=>r.studio.exportScale,Se=>r.studio.exportScale=Se),C(f,x)},$$slots:{default:!0}}),C(l,n),Y()}ue(["click"]);var Pn=L('<div class="flex items-center justify-between"><span class="font-serif text-sm opacity-60"> </span> <kbd class="rounded border border-black/10 bg-white/50 px-2 py-1 font-mono text-[10px] font-bold shadow-sm"> </kbd></div>');function Ln(l,e){q(e,!0);var t=Pn(),i=v(t),s=v(i,!0);u(i);var a=p(i,2),n=v(a,!0);u(a),u(t),O(o=>{G(s,e.label),G(n,o)},[()=>e.customKey||Te.getLabel(e.intent)]),C(l,t),Y()}var Mn=L('<div class="flex flex-col gap-4"><h3 class="border-b border-black/5 pb-2 font-serif text-sm font-bold tracking-[0.2em] text-brand/60 uppercase"> </h3> <div class="grid grid-cols-2 gap-x-12 gap-y-4"></div></div>');function Vn(l,e){q(e,!0);var t=Mn(),i=v(t),s=v(i,!0);u(i);var a=p(i,2);de(a,21,()=>e.group.items,ve,(n,o)=>{Ln(n,{get intent(){return d(o).intent},get label(){return d(o).label},get customKey(){return d(o).customKey}})}),u(a),u(t),O(()=>G(s,e.group.group)),C(l,t),Y()}var Fn=L('<div class="flex flex-col gap-12" role="document"><header class="flex flex-col gap-2 rounded-2xl bg-brand/5 p-6 ring-1 ring-brand/10" aria-labelledby="guide-header-title"><h3 id="guide-header-title" class="font-tiny5 text-xl text-brand uppercase"></h3> <p class="font-serif text-xs leading-relaxed text-studio-text/60"></p></header> <div class="grid grid-cols-2 gap-x-16 gap-y-12"></div> <footer class="mt-4 border-t border-black/5 pt-8 text-center"><p class="font-serif text-[10px] text-studio-text/40 italic"></p></footer></div>');function Bn(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.studio.showArtisanGuide=!1);const i=X(()=>Te.getGroupedActions());Ue(l,{title:__({key:"guide.title"}),subtitle:__({key:"guide.subtitle"}),icon:"ðª¡",get onClose(){return t()},width:"1000px",children:(s,a)=>{var n=Fn(),o=v(n),c=v(o);c.textContent=__({key:"guide.header_title"});var h=p(c,2);h.textContent=__({key:"guide.header_desc"}),u(o);var f=p(o,2);de(f,21,()=>d(i),ve,(m,A)=>{Vn(m,{get group(){return d(A)}})}),u(f);var g=p(f,2),x=v(g);x.textContent=`"${__({key:"guide.footer_quote"})??""}"`,u(g),u(n),C(s,n)},$$slots:{default:!0}}),Y()}var jn=L(`<div class="flex flex-col gap-6"><div class="rounded-xl border border-black/5 bg-white/50 p-6"><h3 class="mb-2 font-serif text-sm font-bold tracking-tight uppercase opacity-60">Pattern Book (.rupa)</h3> <p class="font-serif text-sm opacity-50">Save your work as a dedicated file on your machine or in your browser's archive.</p></div> <div class="flex flex-col gap-3"><button class="artisan-primary-btn w-full">Archive to Pattern Book</button> <button class="artisan-secondary-btn w-full">Restore from Pattern Book</button></div></div>`);function Dn(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.studio.showArchivePattern=!1);Ue(l,{title:"Archive Pattern",subtitle:"Preserving Digital Stitches",icon:"ð¾",get onClose(){return t()},width:"400px",children:(i,s)=>{var a=jn(),n=p(v(a),2),o=v(n);o.__click=()=>{F.persistence.save(),t()()};var c=p(o,2);c.__click=()=>{F.persistence.load(),t()()},u(n),u(a),C(i,a)},$$slots:{default:!0}}),Y()}ue(["click"]);var On=L('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-2"><label for="project-name" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="project-name" type="text" placeholder="Unnamed Pattern" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-serif text-lg text-studio-text focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="width" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="width" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="height" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="height" type="number" min="4" max="128" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="stab-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <span class="font-mono text-sm font-bold text-brand"> </span></div> <input id="stab-input" type="range" min="0" max="100" class="h-1.5 w-full cursor-pointer appearance-none rounded-lg bg-black/5 accent-brand"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><label for="fps-input" class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></label> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <input id="fps-input" type="number" min="1" max="60" class="w-20 rounded-xl border border-black/10 bg-white px-4 py-2 font-mono text-lg text-studio-text focus:border-brand focus:outline-none"/></div> <div class="h-px w-full bg-black/5" aria-hidden="true"></div> <div class="flex items-center justify-between"><div class="flex flex-col gap-1"><span class="font-serif text-sm font-bold tracking-tight text-studio-text/60 uppercase"></span> <span class="font-serif text-[10px] text-studio-text/40"></span></div> <button class="group relative flex items-center gap-3" aria-label="Change Backdrop Color"><div class="artisan-checker-small h-10 w-16 rounded-xl border-2 border-white shadow-sm transition-transform group-hover:scale-105"></div> <div class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-brand text-[8px] text-white opacity-0 transition-opacity group-hover:opacity-100">ð¨</div></button></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"></p></div> <button class="artisan-primary-btn w-full py-4 text-lg"></button></div>'),Nn=L("<!> <!>",1);function Rn(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.studio.showLinenSettings=!1),i=P(pe(r.linen.width)),s=P(pe(r.linen.height)),a=P(!1);function n(){F.manipulation.resize(d(i),d(s)),t()()}var o=Nn(),c=re(o);{var h=g=>{Nt(g,{onClose:()=>_(a,!1),get value(){return r.studio.canvasBgColor},set value(x){r.studio.canvasBgColor=x}})};U(c,g=>{d(a)&&g(h)})}var f=p(c,2);Ue(f,{title:__({key:"settings.title"}),subtitle:__({key:"settings.subtitle"}),icon:"ð",get onClose(){return t()},width:"450px",children:(g,x)=>{var m=On(),A=v(m),k=v(A),b=v(k);b.textContent=__({key:"settings.project_name"});var y=p(b,2);ge(y),u(k);var S=p(k,4),M=v(S),I=v(M);I.textContent=__({key:"settings.width"});var T=p(I,2);ge(T),u(M);var E=p(M,2),w=v(E);w.textContent=__({key:"settings.height"});var V=p(w,2);ge(V),u(E),u(S);var D=p(S,4),N=v(D),B=v(N),H=v(B);H.textContent=__({key:"settings.stabilization"});var oe=p(H,2);oe.textContent=__({key:"settings.stabilization_desc"}),u(B);var Q=p(B,2),ie=v(Q);u(Q),u(N);var me=p(N,2);ge(me),u(D);var R=p(D,4),le=v(R),_e=v(le);_e.textContent=__({key:"settings.weave_pace"});var ce=p(_e,2);ce.textContent=__({key:"settings.fps_desc"}),u(le);var he=p(le,2);ge(he),u(R);var ke=p(R,4),W=v(ke),se=v(W);se.textContent=__({key:"settings.backdrop"});var Me=p(se,2);Me.textContent=__({key:"settings.backdrop_desc"}),u(W);var Ve=p(W,2);Ve.__click=()=>_(a,!0);var ye=v(Ve);et(2),u(Ve),u(ke);var ee=p(ke,2);ee.textContent=__({key:"settings.note"}),u(A);var Ce=p(A,2);Ce.__click=n,Ce.textContent=__({key:"settings.apply"}),u(m),O(()=>{G(ie,`${r.studio.stabilization??""}%`),J(ye,`background-color: ${r.studio.canvasBgColor??""};`)}),xe(y,()=>r.project.name,ae=>r.project.name=ae),xe(T,()=>d(i),ae=>_(i,ae)),xe(V,()=>d(s),ae=>_(s,ae)),xe(me,()=>r.studio.stabilization,ae=>r.studio.stabilization=ae),xe(he,()=>r.studio.fps,ae=>r.studio.fps=ae),C(g,m)},$$slots:{default:!0}}),C(l,o),Y()}ue(["click"]);var $n=L('<div class="flex flex-col gap-8" role="form"><div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="grid grid-cols-2 gap-8"><div class="flex flex-col gap-2"><label for="goto-x" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="goto-x" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div> <div class="flex flex-col gap-2"><label for="goto-y" class="font-serif text-[10px] font-bold tracking-widest text-studio-text/40 uppercase"></label> <input id="goto-y" type="number" class="rounded-xl border border-black/10 bg-white px-4 py-3 font-mono text-xl text-studio-text focus:border-brand focus:outline-none"/></div></div> <p class="font-serif text-[10px] leading-relaxed text-studio-text/40 italic"> </p></div> <button class="artisan-primary-btn w-full py-4 text-lg"></button></div>');function Gn(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.studio.showGoTo=!1),i=P(pe(r.displayCoords.x)),s=P(pe(r.displayCoords.y));function a(){F.jumpTo(d(i),d(s)),t()()}function n(o){o.key==="Enter"&&a()}Je(()=>{document.getElementById("goto-x")?.focus()}),Ue(l,{title:__({key:"goto.title"}),subtitle:__({key:"goto.subtitle"}),icon:"ð",get onClose(){return t()},width:"400px",children:(o,c)=>{var h=$n(),f=v(h),g=v(f),x=v(g),m=v(x);m.textContent=__({key:"goto.label_x"});var A=p(m,2);ge(A),A.__keydown=n,u(x);var k=p(x,2),b=v(k);b.textContent=__({key:"goto.label_y"});var y=p(b,2);ge(y),y.__keydown=n,u(k),u(g);var S=p(g,2),M=v(S,!0);u(S),u(f);var I=p(f,2);I.__click=a,I.textContent=__({key:"goto.action"}),u(h),O(T=>G(M,T),[()=>__({key:"goto.current",replace:{x:r.displayCoords.x,y:r.displayCoords.y}})]),xe(A,()=>d(i),T=>_(i,T)),xe(y,()=>d(s),T=>_(s,T)),C(o,h)},$$slots:{default:!0}}),Y()}ue(["keydown","click"]);var Un=L('<div class="flex flex-col gap-8"><div class="flex items-center justify-between rounded-xl border border-black/5 bg-white/40 p-6 shadow-sm"><div class="flex flex-col"><span class="font-serif text-sm font-bold tracking-tight uppercase opacity-60">Master Mute</span> <span class="font-serif text-[10px] opacity-40">Silence all studio resonance</span></div> <button> </button></div> <div class="flex flex-col gap-6 rounded-xl border border-black/5 bg-white/40 p-8"><div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Stitch Resonance (SFX)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div> <div class="flex flex-col gap-3"><div class="flex items-center justify-between"><span class="font-serif text-[10px] font-bold tracking-[0.2em] uppercase opacity-40">Ambient Piano (BGM)</span> <span class="font-mono text-xs font-bold opacity-40"> </span></div> <input type="range" min="0" max="1" step="0.01" class="artisan-range w-full svelte-e9dsua"/></div></div> <div class="rounded-xl bg-black/5 p-6"><h3 class="font-tiny5 mb-2 text-lg text-brand">Atmosphere Protocol</h3> <div class="flex flex-col gap-2 font-serif text-[11px] leading-relaxed opacity-60"><div class="flex justify-between"><span>Session Duration:</span> <span class="font-mono"> </span></div> <p class="italic"><!></p></div></div> <button class="artisan-primary-btn w-full py-4">Seal Settings</button></div>');function Hn(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.studio.showAudioBasin=!1);Ie(()=>(Ge(()=>r.pushEscapeAction(t())),()=>r.popEscapeAction(t()))),Ue(l,{title:"Audio Basin",subtitle:"Harmony & Atmosphere Tuning",icon:"ð",get onClose(){return t()},width:"450px",children:(i,s)=>{var a=Un(),n=v(a),o=p(v(n),2);o.__click=()=>r.toggleMute();var c=v(o,!0);u(o),u(n);var h=p(n,2),f=v(h),g=v(f),x=p(v(g),2),m=v(x);u(x),u(g);var A=p(g,2);ge(A),u(f);var k=p(f,2),b=v(k),y=p(v(b),2),S=v(y);u(y),u(b);var M=p(b,2);ge(M),u(k),u(h);var I=p(h,2),T=p(v(I),2),E=v(T),w=p(v(E),2),V=v(w);u(w),u(E);var D=p(E,2),N=v(D);{var B=Q=>{var ie=Ze(`The piano awaits in silence. It will begin to weave its melody after 30 minutes of
						artisanry.`);C(Q,ie)},H=Q=>{var ie=Ze("The piano has begun its weave. Volume will reach full depth at 60 minutes.");C(Q,ie)};U(N,Q=>{r.usageMinutes<30?Q(B):Q(H,!1)})}u(D),u(T),u(I);var oe=p(I,2);oe.__click=function(...Q){t()?.apply(this,Q)},u(a),O((Q,ie)=>{z(o,1,`artisan-secondary-btn !px-6 !py-2 ${r.isMuted?"bg-brand text-white":""}`),G(c,r.isMuted?"ð Muted":"ð Active"),G(m,`${Q??""}%`),G(S,`${ie??""}%`),G(V,`${r.usageMinutes??""} minutes`)},[()=>Math.round(r.sfxVolume*100),()=>Math.round(r.bgmVolume*100)]),xe(A,()=>r.sfxVolume,Q=>r.sfxVolume=Q),xe(M,()=>r.bgmVolume,Q=>r.bgmVolume=Q),C(i,a)},$$slots:{default:!0}}),Y()}ue(["click"]);var zn=L('<div class="flex flex-col gap-12" role="document"><section class="flex flex-col gap-6" aria-labelledby="philosophy-title"><div class="flex items-center gap-4 border-b border-black/5 pb-4"><span class="text-3xl" aria-hidden="true">ð¯ï¸</span> <h3 id="philosophy-title" class="font-tiny5 text-3xl tracking-tighter text-brand uppercase"></h3></div> <div class="space-y-4 font-serif text-base leading-relaxed text-studio-text/80"><p></p> <p></p> <p class="text-brand/60 italic"></p></div></section> <div class="grid grid-cols-3 gap-6" role="list"><div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ðª¡</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ðº</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div> <div class="flex flex-col gap-3 rounded-2xl border border-black/5 bg-white/40 p-6 shadow-sm transition-all hover:bg-white/60" role="listitem"><div class="text-2xl" aria-hidden="true">ð¡ï¸</div> <h4 class="font-tiny5 text-lg tracking-tight text-brand uppercase"></h4> <p class="font-serif text-[12px] leading-relaxed text-studio-text/60"></p></div></div> <section class="flex flex-col gap-8 rounded-3xl bg-brand/5 p-10 ring-1 ring-brand/10" aria-labelledby="techniques-title"><h3 id="techniques-title" class="font-tiny5 text-2xl tracking-tighter text-brand uppercase"></h3> <div class="grid grid-cols-2 gap-x-12 gap-y-8"><div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ð§µ</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ðª</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">â³</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div> <div class="flex gap-5"><div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-white text-2xl shadow-sm" aria-hidden="true">ð¹</div> <div class="flex flex-col gap-1"><span class="font-serif text-sm font-black tracking-widest text-studio-text/80 uppercase"></span> <p class="font-serif text-[11px] leading-relaxed text-studio-text/60"></p></div></div></div></section> <footer class="flex flex-col items-center gap-6 border-t border-black/5 pt-10 text-center"><div class="flex flex-col items-center gap-2"><p class="font-serif text-sm text-studio-text/50 italic"></p> <span class="font-tiny5 text-[10px] tracking-[0.3em] text-studio-text/30 uppercase"></span></div> <div class="flex items-center gap-4"><button class="artisan-secondary-btn px-10 py-4"></button> <button class="artisan-primary-btn px-16 py-4 text-xl"></button></div></footer></div>');function Kn(l,e){q(e,!0);let t=te(e,"onClose",3,()=>r.studio.showArtisanCodex=!1);Ue(l,{title:__({key:"codex.title"}),subtitle:__({key:"codex.subtitle"}),icon:"ð",get onClose(){return t()},width:"850px",children:(i,s)=>{var a=zn(),n=v(a),o=v(n),c=p(v(o),2);c.textContent=__({key:"codex.philosophy.title"}),u(o);var h=p(o,2),f=v(h);f.textContent=__({key:"codex.philosophy.p1"});var g=p(f,2);g.textContent=__({key:"codex.philosophy.p2"});var x=p(g,2);x.textContent=__({key:"codex.philosophy.p3"}),u(h),u(n);var m=p(n,2),A=v(m),k=p(v(A),2);k.textContent=__({key:"codex.pillars.needle.title"});var b=p(k,2);b.textContent=__({key:"codex.pillars.needle.desc"}),u(A);var y=p(A,2),S=p(v(y),2);S.textContent=__({key:"codex.pillars.dyes.title"});var M=p(S,2);M.textContent=__({key:"codex.pillars.dyes.desc"}),u(y);var I=p(y,2),T=p(v(I),2);T.textContent=__({key:"codex.pillars.veils.title"});var E=p(T,2);E.textContent=__({key:"codex.pillars.veils.desc"}),u(I),u(m);var w=p(m,2),V=v(w);V.textContent=__({key:"codex.techniques.title"});var D=p(V,2),N=v(D),B=p(v(N),2),H=v(B);H.textContent=__({key:"codex.techniques.threading.title"});var oe=p(H,2);oe.textContent=__({key:"codex.techniques.threading.desc"}),u(B),u(N);var Q=p(N,2),ie=p(v(Q),2),me=v(ie);me.textContent=__({key:"codex.techniques.spirit_pick.title"});var R=p(me,2);R.textContent=__({key:"codex.techniques.spirit_pick.desc"}),u(ie),u(Q);var le=p(Q,2),_e=p(v(le),2),ce=v(_e);ce.textContent=__({key:"codex.techniques.spindle.title"});var he=p(ce,2);he.textContent=__({key:"codex.techniques.spindle.desc"}),u(_e),u(le);var ke=p(le,2),W=p(v(ke),2),se=v(W);se.textContent=__({key:"codex.techniques.resonance.title"});var Me=p(se,2);Me.textContent=__({key:"codex.techniques.resonance.desc"}),u(W),u(ke),u(D),u(w);var Ve=p(w,2),ye=v(Ve),ee=v(ye);ee.textContent=`"${__({key:"codex.footer.quote"})??""}"`;var Ce=p(ee,2);Ce.textContent=__({key:"codex.footer.guild"}),u(ye);var ae=p(ye,2),He=v(ae);He.__click=()=>{t()(),r.studio.showArtisanGuide=!0},He.textContent=__({key:"codex.footer.all_shortcuts"});var tt=p(He,2);tt.__click=function(...Ke){t()?.apply(this,Ke)},tt.textContent=__({key:"codex.footer.enter"}),u(ae),u(Ve),u(a),C(i,a)},$$slots:{default:!0}}),Y()}ue(["click"]);var Z=gt(()=>r),qn=L('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="flex h-screen w-screen flex-col overflow-hidden bg-canvas-bg selection:bg-brand/20"><!> <div class="flex flex-1 overflow-hidden"><aside class="flex w-64 flex-col overflow-hidden"><!></aside> <main class="relative flex flex-1 items-center justify-center overflow-hidden bg-grid-border/20 p-6"><div><!></div></main> <aside class="flex w-72 flex-col overflow-hidden"><!></aside></div> <!></div>',1);function io(l,e){q(e,!1),Je(()=>bi.mount()),be();var t=qn(),i=re(t);cn(i,{});var s=p(i,2);{var a=R=>{Bn(R,{onClose:()=>Z(Z().studio.showArtisanGuide=!1)})};U(s,R=>{Z().studio.showArtisanGuide&&R(a)})}var n=p(s,2);{var o=R=>{bn(R,{onClose:()=>Z(Z().studio.showPatternCatalog=!1)})};U(n,R=>{Z().studio.showPatternCatalog&&R(o)})}var c=p(n,2);{var h=R=>{Nt(R,{onClose:()=>Z(Z().studio.showDyeBasin=!1),get value(){return Z().paletteState.activeDye},set value(le){Z(Z().paletteState.activeDye=le)},$$legacy:!0})};U(c,R=>{Z().studio.showDyeBasin&&R(h)})}var f=p(c,2);{var g=R=>{In(R,{onExport:(le,_e,ce)=>F.createArtifact(le,_e,ce),onClose:()=>Z(Z().studio.showArtifactCrate=!1)})};U(f,R=>{Z().studio.showArtifactCrate&&R(g)})}var x=p(f,2);{var m=R=>{Dn(R,{onClose:()=>Z(Z().studio.showArchivePattern=!1)})};U(x,R=>{Z().studio.showArchivePattern&&R(m)})}var A=p(x,2);{var k=R=>{Rn(R,{onClose:()=>Z(Z().studio.showLinenSettings=!1)})};U(A,R=>{Z().studio.showLinenSettings&&R(k)})}var b=p(A,2);{var y=R=>{Gn(R,{onClose:()=>Z(Z().studio.showGoTo=!1)})};U(b,R=>{Z().studio.showGoTo&&R(y)})}var S=p(b,2);{var M=R=>{Hn(R,{onClose:()=>Z(Z().studio.showAudioBasin=!1)})};U(S,R=>{Z().studio.showAudioBasin&&R(M)})}var I=p(S,2);{var T=R=>{Kn(R,{onClose:()=>Z(Z().studio.showArtisanCodex=!1)})};U(I,R=>{Z().studio.showArtisanCodex&&R(T)})}var E=p(I,2),w=v(E);Pa(w);var V=p(w,2),D=v(V),N=v(D);Ga(N),u(D);var B=p(D,2),H=v(B),oe=v(H);rn(oe,{}),u(H),u(B);var Q=p(B,2),ie=v(Q);Ja(ie),u(Q),u(V);var me=p(V,2);Dr(me),u(E),O(()=>z(H,1,`artisan-frame flex h-full w-full items-center justify-center overflow-hidden shadow-2xl transition-all duration-700 ease-out ${Z().project.isPlaying&&Z().project.frames.length>1?"ring-8 ring-palette-0 ring-inset animate-pulse":""}`)),C(l,t),Y()}export{io as component};
